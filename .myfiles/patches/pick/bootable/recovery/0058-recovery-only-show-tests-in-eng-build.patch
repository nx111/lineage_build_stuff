From 290809bfadaa7441c0dcf5856951fb1b0be22d78 Mon Sep 17 00:00:00 2001
From: Alessandro Astone <ales.astone@gmail.com>
Date: Fri, 29 Mar 2019 17:16:56 +0100
Subject: [PATCH 58/62] recovery: only show tests in eng build

Change-Id: If783711ecd0d20728ec27ebc572b57e6d9bee760
---
 Android.mk | 4 ++++
 device.cpp | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/Android.mk b/Android.mk
index 2b62b441..5b3a2578 100644
--- a/Android.mk
+++ b/Android.mk
@@ -281,6 +281,10 @@ ifeq ($(BOARD_HAS_DOWNLOAD_MODE), true)
     LOCAL_CFLAGS += -DDOWNLOAD_MODE
 endif
 
+ifeq ($(TARGET_BUILD_VARIANT),eng)
+    LOCAL_CFLAGS += -DSHOW_TESTS
+endif
+
 LOCAL_MODULE_PATH := $(TARGET_RECOVERY_ROOT_OUT)/sbin
 
 ifeq ($(TARGET_RECOVERY_UI_LIB),)
diff --git a/device.cpp b/device.cpp
index f1d2a3b7..d5d7e703 100644
--- a/device.cpp
+++ b/device.cpp
@@ -82,8 +82,10 @@ static const MenuItem ADVANCED_MENU_ITEMS[] = {
   MenuItem("Reboot to recovery"),
   MenuItem("Mount system"),
   MenuItem("View logs"),
+#ifdef SHOW_TESTS
   MenuItem("Run graphics test"),
   MenuItem("Run locale test"),
+#endif
   MenuItem("Power off"),
 };
 static const MenuItemVector advanced_menu_items_ =
@@ -95,8 +97,10 @@ static const Device::BuiltinAction ADVANCED_MENU_ACTIONS[] = {
   Device::REBOOT_RECOVERY,
   Device::MOUNT_SYSTEM,
   Device::VIEW_RECOVERY_LOGS,
+#ifdef SHOW_TESTS
   Device::RUN_GRAPHICS_TEST,
   Device::RUN_LOCALE_TEST,
+#endif
   Device::SHUTDOWN,
 };
 static const Device::MenuActionVector advanced_menu_actions_ =
-- 
2.17.1

