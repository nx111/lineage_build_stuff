From 8e7448a3812bfa5b060cfba1bbc896df187f0030 Mon Sep 17 00:00:00 2001
From: jrior001 <jriordan001@gmail.com>
Date: Sun, 24 Mar 2019 17:57:07 -0400
Subject: [PATCH 50/62] recovery: add reboot to recovery option

Change-Id: I8684e188577fa16073723e0093e221b767a3826d
---
 device.cpp   |  2 ++
 device.h     | 11 ++++++-----
 recovery.cpp |  5 +++++
 3 files changed, 13 insertions(+), 5 deletions(-)

diff --git a/device.cpp b/device.cpp
index 23690315..07d8f570 100644
--- a/device.cpp
+++ b/device.cpp
@@ -79,6 +79,7 @@ static const MenuItem ADVANCED_MENU_ITEMS[] = {
 #else
   MenuItem("Reboot to bootloader"),
 #endif
+  MenuItem("Reboot to recovery"),
   MenuItem("Mount system"),
   MenuItem("View logs"),
   MenuItem("Run graphics test"),
@@ -91,6 +92,7 @@ static const MenuItemVector advanced_menu_items_ =
 
 static const Device::BuiltinAction ADVANCED_MENU_ACTIONS[] = {
   Device::REBOOT_BOOTLOADER,
+  Device::REBOOT_RECOVERY,
   Device::MOUNT_SYSTEM,
   Device::VIEW_RECOVERY_LOGS,
   Device::RUN_GRAPHICS_TEST,
diff --git a/device.h b/device.h
index e8f669ed..4f36d754 100644
--- a/device.h
+++ b/device.h
@@ -66,11 +66,12 @@ class Device {
     WIPE_SYSTEM = 12,
     // Advanced menu
     REBOOT_BOOTLOADER = 20,
-    MOUNT_SYSTEM = 21,
-    VIEW_RECOVERY_LOGS = 22,
-    RUN_GRAPHICS_TEST = 23,
-    RUN_LOCALE_TEST = 24,
-    SHUTDOWN = 25,
+    REBOOT_RECOVERY = 21,
+    MOUNT_SYSTEM = 22,
+    VIEW_RECOVERY_LOGS = 23,
+    RUN_GRAPHICS_TEST = 24,
+    RUN_LOCALE_TEST = 25,
+    SHUTDOWN = 26,
   };
 
   typedef std::vector<MenuItem> MenuItemVector;
diff --git a/recovery.cpp b/recovery.cpp
index ac200578..380f4f5d 100644
--- a/recovery.cpp
+++ b/recovery.cpp
@@ -1366,6 +1366,7 @@ static Device::BuiltinAction prompt_and_wait(Device* device, int status) {
       case Device::REBOOT:
       case Device::SHUTDOWN:
       case Device::REBOOT_BOOTLOADER:
+      case Device::REBOOT_RECOVERY:
         return chosen_action;
 
       case Device::WIPE_DATA:
@@ -2012,6 +2013,10 @@ int main(int argc, char **argv) {
 #endif
       break;
 
+    case Device::REBOOT_RECOVERY:
+      ui->Print("Rebooting to recovery...\n");
+      android::base::SetProperty(ANDROID_RB_PROPERTY, "reboot,recovery");
+      break;
     default:
       ui->Print("Rebooting...\n");
       reboot("reboot,");
-- 
2.17.1

