From 92b8940d6e8854a6c6e64538c826d2076aec6f8d Mon Sep 17 00:00:00 2001
From: Daniel Hillenbrand <codeworkx@cyanogenmod.org>
Date: Sat, 26 Sep 2015 14:02:46 +0100
Subject: [PATCH 24/44] minui: support to pan display (FBIOPAN_DISPLAY)

Needed for newer hisilicon boards

Change-Id: I9a5d640b1168de518885b89f63499c6f31958b75
---
 minui/Android.mk         | 4 ++++
 minui/graphics_fbdev.cpp | 5 +++++
 2 files changed, 9 insertions(+)

diff --git a/minui/Android.mk b/minui/Android.mk
index ae1552b1..f33fde53 100644
--- a/minui/Android.mk
+++ b/minui/Android.mk
@@ -67,6 +67,10 @@ else
   LOCAL_CFLAGS += -DDEFAULT_ROTATION=ROTATION_NONE
 endif
 
+ifneq ($(BOARD_RECOVERY_NEEDS_FBIOPAN_DISPLAY),)
+  LOCAL_CFLAGS += -DBOARD_RECOVERY_NEEDS_FBIOPAN_DISPLAY
+endif
+
 include $(BUILD_STATIC_LIBRARY)
 
 # libminui (shared library)
diff --git a/minui/graphics_fbdev.cpp b/minui/graphics_fbdev.cpp
index 746f42aa..b705db86 100644
--- a/minui/graphics_fbdev.cpp
+++ b/minui/graphics_fbdev.cpp
@@ -44,6 +44,11 @@ void MinuiBackendFbdev::SetDisplayedFramebuffer(unsigned n) {
   if (ioctl(fb_fd, FBIOPUT_VSCREENINFO, &vi) < 0) {
     perror("active fb swap failed");
   }
+#ifdef BOARD_RECOVERY_NEEDS_FBIOPAN_DISPLAY
+  if (ioctl(fb_fd, FBIOPAN_DISPLAY, &vi) < 0) {
+    perror("pan failed");
+  }
+#endif
   displayed_buffer = n;
 }
 
-- 
2.17.1

