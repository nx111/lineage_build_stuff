From ccf9a89d492d93d74c13368c76eed631f9e634b3 Mon Sep 17 00:00:00 2001
From: Tom Marshall <tdm.code@gmail.com>
Date: Mon, 7 Jan 2019 14:31:55 -0800
Subject: [PATCH 32/44] recovery: Add awk lib and driver

Change-Id: I013c596319737ca5b7c0470d6921a7e16b8ceca3
---
 Android.mk      | 4 ++++
 recovery.cpp    | 1 +
 recovery_cmds.h | 1 +
 3 files changed, 6 insertions(+)

diff --git a/Android.mk b/Android.mk
index 185a7225..c2c30f16 100644
--- a/Android.mk
+++ b/Android.mk
@@ -199,6 +199,9 @@ LOCAL_STATIC_LIBRARIES += \
     libselinux \
     libz
 
+LOCAL_WHOLE_STATIC_LIBRARIES += \
+    libawk_main
+
 # Libraries for FS tools
 LOCAL_WHOLE_STATIC_LIBRARIES += \
     libext2fs \
@@ -288,6 +291,7 @@ RECOVERY_TOOLS := \
     gzip \
     unzip \
     zip \
+    awk \
     $(FILESYSTEM_TOOLS)
 LOCAL_POST_INSTALL_CMD := $(hide) $(foreach t,$(RECOVERY_TOOLS),ln -sf ${LOCAL_MODULE} $(LOCAL_MODULE_PATH)/$(t);)
 
diff --git a/recovery.cpp b/recovery.cpp
index 2e480f02..91c7bc9c 100644
--- a/recovery.cpp
+++ b/recovery.cpp
@@ -95,6 +95,7 @@ static const struct recovery_cmd recovery_cmds[] = {
   { "unzip",          miniunz_main },
   { "zip",            minizip_main },
   { "sh",             mksh_main },
+  { "awk",            awk_main },
 
   /* Filesystem tools */
   { "e2fsdroid",        e2fsdroid_main },
diff --git a/recovery_cmds.h b/recovery_cmds.h
index b2bf8ad4..770e4083 100644
--- a/recovery_cmds.h
+++ b/recovery_cmds.h
@@ -29,6 +29,7 @@ int poweroff_main(int argc, char **argv);
 int start_main(int argc, char **argv);
 int stop_main(int argc, char **argv);
 int mksh_main(int argc, char **argv);
+int awk_main(int argc, char **argv);
 
 /* Filesystem tools */
 int e2fsdroid_main(int argc, char **argv);
-- 
2.17.1

