From 7d24d804bf72266819d340068c78676f3645bc3c Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Tue, 12 Feb 2019 21:14:17 +0200
Subject: [PATCH 05/15] Remove minivold rules

* We no longer have minivold in recovery

Change-Id: I4987d295d88d38492a77584949466d6c3fc9eea3
---
 common/private/file_contexts | 3 ---
 common/private/vold.te       | 8 --------
 2 files changed, 11 deletions(-)

diff --git a/common/private/file_contexts b/common/private/file_contexts
index e02958a..300a14f 100644
--- a/common/private/file_contexts
+++ b/common/private/file_contexts
@@ -19,8 +19,5 @@
 /system/bin/backuptool_ab\.sh                     u:object_r:otapreopt_chroot_exec:s0
 /system/bin/backuptool_postinstall\.sh            u:object_r:otapreopt_chroot_exec:s0
 
-# Recovery
-/sbin/minivold                          u:object_r:vold_exec:s0
-
 # Sysinit
 /system/bin/sysinit                     u:object_r:sysinit_exec:s0
diff --git a/common/private/vold.te b/common/private/vold.te
index be1cf24..6668157 100644
--- a/common/private/vold.te
+++ b/common/private/vold.te
@@ -1,5 +1,3 @@
-domain_trans(init, rootfs, vold)
-
 # NTFS-3g wants to drop permission
 allow vold self:capability { setgid setuid };
 
@@ -7,9 +5,3 @@ allow vold self:capability { setgid setuid };
 allow vold mkfs_exec:file rx_file_perms;
 allow vold mnt_media_rw_stub_file:dir r_dir_perms;
 allow vold storage_stub_file:dir rw_dir_perms;
-
-# Vold can also run as minivold in the rootfs
-recovery_only(`
-  allow vold rootfs:dir { add_name write };
-  allow vold rootfs:file execute_no_trans;
-')
-- 
2.17.1

