From bf1b17dea1202fa7db7c4cd603da4de46b658984 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Fri, 22 Mar 2019 23:06:29 +0200
Subject: [PATCH 7/7] sepolicy: Allow recovery read time

Change-Id: I125604ca341ec1bf62f6209594aeb92f3a8ba1c4
---
 vendor/common/recovery.te | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/vendor/common/recovery.te b/vendor/common/recovery.te
index 2d23f9fd..6e4021d7 100755
--- a/vendor/common/recovery.te
+++ b/vendor/common/recovery.te
@@ -24,4 +24,14 @@ recovery_only(`
     allow recovery configfs:dir rw_dir_perms;
     set_prop(recovery, ffs_prop)
     get_prop(recovery, vendor_boot_mode_prop)
+
+    # Mount /mnt/vendor/persist to read time
+    typeattribute recovery system_writes_mnt_vendor_violators;
+    allow recovery mnt_vendor_file:dir mounton;
+
+    # Read time
+    r_dir_file(recovery, time_data_file)
+    r_dir_file(recovery, vendor_time_data_file)
+    r_dir_file(recovery, persist_time_file)
+    allow recovery mnt_vendor_file:dir search;
 ')
-- 
2.17.1

