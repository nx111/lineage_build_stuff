From f800daab56872389ed040053c45964dcba18e116 Mon Sep 17 00:00:00 2001
From: "Kevin F. Haggerty" <haggertk@lineageos.org>
Date: Mon, 21 Jan 2019 16:17:09 -0700
Subject: [PATCH 02/25] crypto: Allow kernel to compile without
 CONFIG_CRYPTO_FIPS

Change-Id: Ia1d316880d4ae656004c8db002a7fe25cc576fef
Signed-off-by: Kevin F. Haggerty <haggertk@lineageos.org>
---
 crypto/internal.h | 2 +-
 crypto/proc.c     | 2 +-
 crypto/tcrypt.c   | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/crypto/internal.h b/crypto/internal.h
index 1c3da10214b0..429abde1f839 100644
--- a/crypto/internal.h
+++ b/crypto/internal.h
@@ -80,7 +80,7 @@ void crypto_init_proc(int *fips_error);
 int do_integrity_check(void);
 int testmgr_crypto_proc_init(void);
 #else
-void __init crypto_init_proc(void);
+void crypto_init_proc(void);
 #endif
 void __exit crypto_exit_proc(void);
 #else
diff --git a/crypto/proc.c b/crypto/proc.c
index f291329ac39e..9c10ab6be53a 100644
--- a/crypto/proc.c
+++ b/crypto/proc.c
@@ -149,7 +149,7 @@ void crypto_init_proc(int *fips_error)
 	crypto_proc_fips_init();
 }
 #else
-void __init crypto_init_proc(void)
+void crypto_init_proc(void)
 {
 	proc_create("crypto", 0, NULL, &proc_crypto_ops);
 	crypto_proc_fips_init();
diff --git a/crypto/tcrypt.c b/crypto/tcrypt.c
index a10f56244147..8e62a0a5a406 100644
--- a/crypto/tcrypt.c
+++ b/crypto/tcrypt.c
@@ -72,7 +72,7 @@ static char *check[] = {
 	"lzo", "cts", "zlib", NULL
 };
 
-#ifdef CONFIG_CRYPTO_DRBG
+#if defined(CONFIG_CRYPTO_DRBG) && defined(CONFIG_CRYPTO_FIPS)
 static char *drbg_cores[] = {
 #ifdef CONFIG_CRYPTO_DRBG_CTR
 	"ctr_aes128",
-- 
2.17.1

