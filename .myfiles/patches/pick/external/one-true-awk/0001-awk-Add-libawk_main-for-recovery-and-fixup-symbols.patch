From 9c43dddc626acbafd0dc994478cfd2ada670e61c Mon Sep 17 00:00:00 2001
From: Tom Marshall <tdm.code@gmail.com>
Date: Tue, 6 Mar 2018 23:28:59 +0100
Subject: [PATCH] awk: Add libawk_main for recovery and fixup symbols

Change-Id: I9d7c1c224db05ae523b081b82a588d5e7ac0bf6d
---
 Android.bp | 6 ++++++
 proto.h    | 6 ++++++
 2 files changed, 12 insertions(+)

diff --git a/Android.bp b/Android.bp
index aed5304..f8a5d7e 100644
--- a/Android.bp
+++ b/Android.bp
@@ -41,3 +41,9 @@ cc_binary {
     stem: "awk",
     vendor: true,
 }
+
+cc_library_static {
+    name: "libawk_main",
+    defaults: ["awk-defaults"],
+    cflags: ["-Dmain=awk_main"],
+}
diff --git a/proto.h b/proto.h
index 9a657ef..e185200 100644
--- a/proto.h
+++ b/proto.h
@@ -22,6 +22,12 @@ ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
 THIS SOFTWARE.
 ****************************************************************/
 
+#define execute awk_execute
+#define yyerror awk_yyerror
+#define yylex awk_yylex
+#define tfree awk_tfree
+#define hash awk_hash
+
 extern	int	yywrap(void);
 extern	void	setfname(Cell *);
 extern	int	constnode(Node *);
-- 
2.17.1

