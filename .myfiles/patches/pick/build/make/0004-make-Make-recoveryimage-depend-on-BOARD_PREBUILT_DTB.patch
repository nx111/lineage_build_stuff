From 701538776eb538d0c64b5a3386709e19227e547f Mon Sep 17 00:00:00 2001
From: Rashed Abdel-Tawab <rashed@linux.com>
Date: Thu, 16 May 2019 13:57:34 -0700
Subject: [PATCH 4/4] make: Make recoveryimage depend on
 BOARD_PREBUILT_DTBOIMAGE on non-A/B

Change-Id: I50cf5f97773478b94140a3a6b31712a68513eba5
---
 core/Makefile | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/core/Makefile b/core/Makefile
index df60b1071..d0e9e2849 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -1384,6 +1384,9 @@ else
 RECOVERY_RESOURCE_ZIP :=
 endif
 
+# Declare this empty so we can append to it later
+RECOVERYIMAGE_EXTRA_DEPS :=
+
 INTERNAL_RECOVERYIMAGE_ARGS := \
 	$(addprefix --second ,$(INSTALLED_2NDBOOTLOADER_TARGET)) \
 	--kernel $(recovery_kernel) \
@@ -1399,12 +1402,13 @@ endif
 ifdef BOARD_KERNEL_PAGESIZE
   INTERNAL_RECOVERYIMAGE_ARGS += --pagesize $(BOARD_KERNEL_PAGESIZE)
 endif
-ifdef BOARD_INCLUDE_RECOVERY_DTBO
+ifeq ($(strip $(BOARD_INCLUDE_RECOVERY_DTBO)),true)
   INTERNAL_RECOVERYIMAGE_ARGS += --recovery_dtbo $(BOARD_PREBUILT_DTBOIMAGE)
+  RECOVERYIMAGE_EXTRA_DEPS    += $(BOARD_PREBUILT_DTBOIMAGE)
 endif
 ifeq ($(strip $(BOARD_KERNEL_SEPARATED_DT)),true)
   INTERNAL_RECOVERYIMAGE_ARGS += --dt $(INSTALLED_DTIMAGE_TARGET)
-  RECOVERYIMAGE_EXTRA_DEPS    := $(INSTALLED_DTIMAGE_TARGET)
+  RECOVERYIMAGE_EXTRA_DEPS    += $(INSTALLED_DTIMAGE_TARGET)
 endif
 
 # Keys authorized to sign OTA packages this build will accept.  The
-- 
2.17.1

