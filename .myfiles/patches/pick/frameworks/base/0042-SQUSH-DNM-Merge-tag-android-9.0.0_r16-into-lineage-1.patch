From aea9610d04ecbcc2bba352968c33a2ec2fb5d88a Mon Sep 17 00:00:00 2001
From: Luca Stefani <luca.stefani.ge1@gmail.com>
Date: Tue, 6 Nov 2018 14:51:23 +0100
Subject: [PATCH 42/47] [SQUSH][DNM] Merge tag 'android-9.0.0_r16' into
 lineage-16.0
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

commit 19463c58be6a14171b8c56ef69a3b1b6b3ec2799
Merge: e9e3f8a4466 e1fb58dcea9
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Oct 19 22:26:47 2018 +0000

    Merge cherrypicks of [5316628, 5317104] into sparse-5052819-L66800000220839881

    Change-Id: I6776d65c54fba4d553f809131c77e0ee679c0140

commit e1fb58dcea9d56fc558d295e7ed5844c98efe7cf
Author: Amith Yamasani <yamasani@google.com>
Date:   Wed Sep 5 18:52:35 2018 -0700

    Keep app in high memory adjust if moving from TOP to FGS

    If an app was in the TOP state and immediately moved
    to a foreground service state, then try harder to keep it
    in memory for another 20 seconds before releasing the
    memory to bound foreground services. Using an oom_adj value
    of 50 which is between "fore" and "vis". So BFGS apps might
    get killed ("vis") before this recently FGS'ed app. That
    way any app that has a lot of state in memory that it needs
    to persist before getting killed has a chance to do so.

    Also bind NotificationListeners with a special bind flag
    to rank them below FGS (perceptible adj) so that they
    can be killed before any other foreground services or
    bound services get killed.

    Bug: 110969183
    Test: Manual for now. Take a bunch of portrait
          pictures and hit home, while being under memory
          pressure with a bunch of notification listeners.
    Change-Id: Ie8934c2331afe6450c582b209869aeca7272f58a
    Merged-In: Ie8934c2331afe6450c582b209869aeca7272f58a
    (cherry picked from commit b735830a1e71e72c4e72260d7eab0382b4ee19df)

commit e9e3f8a4466f52a11ea9da0dd7799dcdded5ad11
Merge: 30e398d7ba8 a4568bd2095
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Sep 28 23:13:10 2018 +0000

    Merge cherrypicks of [5141854, 5140474] into pi-qpr1-release

    Change-Id: I06f63095c26ffb6cb482ea66b4f2663296c968ba

commit a4568bd2095ab29dd5fc799988b15383adb6ce2e
Author: Hongming Jin <hongmingjin@google.com>
Date:   Fri Sep 28 19:23:22 2018 +0000

    Revert "RESTRICT AUTOMERGE: Check both self and shared user id package for requested permissions."

    This reverts commit 5e37e9d962c476202590bef32b87c2eb794d61a1.

    Reason for revert: Not a security fix and the security fix needs this cl is reverted.
    Bug: 114365189

    Change-Id: Ia12ce2692b47a1d59be0b199b1fbfa415767e145
    (cherry picked from commit 0b103c697331a5bcae2f65de4a3864bca0b592ff)

commit a3431a2b0d155893188dea4f58df544be0e48931
Author: Hongming Jin <hongmingjin@google.com>
Date:   Fri Sep 28 19:21:46 2018 +0000

    Revert "RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package."

    This reverts commit fde947837c848b51a830b74b28f96f9808405492.

    Reason for revert: triggers other issue.
    Bug: 114365189

    Change-Id: I37523a1778d55153253cf10df1ede68c5acb8178
    (cherry picked from commit 06cc74977fcebe8a270e6bcd812dcfb31c32492c)

commit 30e398d7ba8cabcb71b10bfaf0193e5f061ca65e
Merge: 706f708d34d 6a947f048a7
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Mon Sep 10 23:21:03 2018 +0000

    Merge cherrypicks of [4986743, 4986744, 4987539, 4987168, 4986376, 4986377, 4986378, 4986889, 4986745, 4986746, 4986747, 4986748, 4986749, 4986750, 4986773, 4987169, 4987170, 4987611, 4987631, 4987632, 4987633, 4987634, 4986890, 4987612, 4987651, 4987598, 4987613, 4987614, 4987615, 4987599, 4986379, 4986380, 4987652, 4987653, 4987691, 4986774] into pi-qpr1-release

    Change-Id: Idfec2f26918d14afde9ef01367ffb1ecd1dde548

commit 6a947f048a76a5936fd2b693e01f849aef22c907
Author: Michael Wachenschwanz <mwachens@google.com>
Date:   Fri Aug 24 21:50:35 2018 -0700

    Verify number of Map entries written to Parcel

    Make sure the number of entries written by Parcel#writeMapInternal
    matches the size written. If a mismatch were allowed, an exploitable
    scenario could occur where the data read from the Parcel would not
    match the data written.

    Fixes: 112859604
    Test: cts-tradefed run cts -m CtsOsTestCases -t android.os.cts.ParcelTest

    Change-Id: I325d08a8b66b6e80fe76501359c41b6656848607
    Merged-In: I325d08a8b66b6e80fe76501359c41b6656848607
    (cherry picked from commit 057a01d1f38e9b46d3faa4059fdd7c8717681ea0)

commit 8e81142af3dceb913ca50f67df3ded84233f932a
Author: Wayne Lin <waynewhlin@google.com>
Date:   Thu Aug 30 17:25:56 2018 +0800

    Changing SUPL_ES=1 for SUPL end point control

    SUPL_ES=1 ensures the GnssLocationProvider and related framework code
    accepts incoming SMS SUPL_INIT messages with ES-bit=1
    (which allow redirection of the ESLP
    end-point e.g. to the current local emergency services provider when
    you are travelling) only during an emergency call

    Bug: 111899241
    Bug: 112159033
    Test: Build pass
    Change-Id: I7dcd9c173a1d56fcf0da15257db5b8d1322b39d6
    (cherry picked from commit 5b63dcc6a617cbab74dbda1f4cd759c75efa3aa5)

commit 25060bbde58faf298a7ed5cd9b0bf48acf0c2405
Author: Hongming Jin <hongmingjin@google.com>
Date:   Wed Aug 8 15:01:57 2018 -0700

    RESTRICT AUTOMERGE: Check both self and shared user id package for requested permissions.

    Bug: 111752150
    Test: Manual local test

    Change-Id: I80383300cd5d2455d08a0ad91000efa85404903b
    (cherry picked from commit 5e37e9d962c476202590bef32b87c2eb794d61a1)

commit 181dc252ddec574464882970d3fab290e8b625b5
Author: dwchen <dwchen@google.com>
Date:   Mon Aug 20 10:17:48 2018 -0700

    Fixes possible issue with no-op creator.

    Leaving a no-op CREATOR can lead to issues. We throw a run-time
    exception to prevent anyone from using this. The StatsLogEventWrapper is
    meant to be write-only since it's only used to send data to statsd.

    Bug: 112550251
    Test: Tested with provided POC app by external researcher.
    Change-Id: I001d84e2a61a1cd8a4f59aa156ca52f73ad0f6e1
    (cherry picked from commit 78622d57ad102c054306b01321b6b2dbec3f9d1d)

commit 706f708d34d6aaa6f954b4eeffc126da61d0eae3
Merge: 0ec8d66578d f3113c78fb1
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Wed Sep 5 23:35:40 2018 +0000

    Merge cherrypicks of [4948448, 4948511, 4948299, 4947854, 4947306, 4946150, 4948531, 4946116, 4948532] into pi-qpr1-release

    Change-Id: I9938da9c9b2a3e53b6987d0d1e5d61a9177485f1

commit f3113c78fb1af9f5520feecb4d796b7b51e40432
Author: Tyler Gunn <tgunn@google.com>
Date:   Tue Aug 28 08:39:39 2018 -0700

    Add equality method for PhoneAccount.

    Checks for equality between two PhoneAccounts, not taking into account
    the icon, which cannot be compared with equality.

    Test: Manual as part of telephony account registry updates.
    Test: Added new unit tests to test equality.
    Bug: 112884689
    Merged-In: Change-Id: Ibd0c69425bf185dc6b79db4ca4e9ca4a770320a3
    Change-Id: Ibd0c69425bf185dc6b79db4ca4e9ca4a770320a3
    (cherry picked from commit a04bd3d292ce29ad6f8c94348ea1c8ce80d29e8e)
    (cherry picked from commit 5df50b83bcc22a3d23de6f48d5d93418bfb63f1d)

commit 0ec8d66578d16b4e7d792c8e2829d4e942734292
Merge: 1853d11d8f0 a433d41005b
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 31 04:27:14 2018 +0000

    Merge cherrypicks of [4913949, 4913979] into pi-qpr1-release

    Change-Id: Ida0d6a734faa333574d13d4319bf149ad9bfa1d7

commit a433d41005bbf06be09fb2d505ea0726f7d4bfbf
Author: Matthew Ng <ngmatthew@google.com>
Date:   Thu Aug 9 13:55:05 2018 -0700

    Reduce NearestTouchFrame size to prevent button taps on nav bar

    The NearestTouchFrame spanned the entire nav bar that took any tap to
    hit the nearest button such as the back button. Reducing it prevents
    taps from the edge of the nav bar. Related: ag/4179853

    Change-Id: I25a73cc995ed8d479ca9d5da85ec8a7cb629769d
    Fixes: 112298917
    Test: tap the left side of the nav bar
    (cherry picked from commit 9e90f24dc5dc2574700c46288617bea18b28bf29)
    (cherry picked from commit 7daaaad74a29eca0e2a56b29fe55e2f615b05415)

commit 1853d11d8f0c672950024ed882ffab80be29a2f1
Merge: 1c360feda14 7df76c43d8f
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 24 22:57:28 2018 +0000

    Merge cherrypicks of [4871294] into pi-qpr1-release

    Change-Id: I94a38b8375529c17492adf346429a48d5969c733

commit 7df76c43d8f92254f0a189c90f4bc1ffd38e54ca
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Thu Aug 23 12:39:05 2018 +0200

    DO NOT MERGE Use correct lock when killing processes

    Test: Switch display cutout
    Bug: 113093654
    Change-Id: I2ca076a214da86656b6c71ebe1f63eb92e340ac0
    (cherry picked from commit 1fd30aa5581dec8cfa5113fe436bcd963d0a35f9)

commit 1c360feda14448ec54d2e600e01e9c1468b1a654
Merge: c619060612f dbb8dc5a712
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 24 22:00:48 2018 +0000

    Merge cherrypicks of [4871059, 4868580, 4869372] into pi-qpr1-release

    Change-Id: I4f32356294ed679fa8f6374099f471de85486a36

commit dbb8dc5a712c50b81dd5ba1403d0707914be9c82
Author: Eva Bertels <evabertels@google.com>
Date:   Thu Aug 16 12:46:12 2018 +0100

    Added check for misprovisioned Pixel 2 device.

    Some Pixel devices had a wrong brand value provisioned into keymaster.
    Due to this misprovisioning those devices fail device ID attestation because it includes a check for the correct brand value.
    This is now solved by re-trying Device ID attestation if we are running on a potentially misprovisioned device, allowing for the known incorrect brand value.

    Bug: 69471841
    Test: atest com.android.cts.devicepolicy.MixedDeviceOwnerTest#testKeyManagement
    Change-Id: If715ebdd4ab6d7fcfffab60b40fd2dc8fa1fda44
    Merged-In: Ia0da5478d6092c1927d26600a6893ae8ce53da51
    (cherry picked from commit 3f821a8e17f97a6f0b3ae408b2e7f2bfde666df4)

commit c619060612f7bcac51765df26258c214b7188911
Merge: f766c3666cc e1b0d4a2532
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 24 03:04:13 2018 +0000

    Snap for 4974682 from e1b0d4a25324db201aee059fb0a25c2a2fb6b88f to pi-qpr1-release

    Change-Id: Ie4bd913ccb175f035e4d284226db33be943a1ecf

commit e1b0d4a25324db201aee059fb0a25c2a2fb6b88f
Author: Dongwon Kang <dwkang@google.com>
Date:   Wed Aug 22 08:20:30 2018 -0700

    Fix a typo in javadoc.

    Test: javadoc fix.
    Bug: 112882126
    Change-Id: I69f55aaa49103690a796ff394fcd1934891a52f2

commit f766c3666cc197aa69a08cc9ee3ba9346c562d6e
Merge: a99c657655f fcb7982a492
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Thu Aug 23 03:06:22 2018 +0000

    Snap for 4972147 from fcb7982a492413dd928433bfb73ae2ca1e222397 to pi-qpr1-release

    Change-Id: Ib9fe15999e374e3fc58127b6415e8b019a5b960c

commit fcb7982a492413dd928433bfb73ae2ca1e222397
Merge: e387ce18d84 3a04d242688
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Aug 22 23:26:00 2018 +0000

    Merge "DO NOT MERGE Do not kill processes when screen size changes" into pi-dev

commit e387ce18d8487020b80cd454bc1442345128fa8b
Merge: ab39f605b1d 9ee5dff83c1
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Aug 22 23:06:35 2018 +0000

    Merge "BootAnimation: Fix boot animation with hidden cutout" into pi-dev

commit 3a04d242688f4c74925b53ef444371bb08a43d46
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Aug 22 23:09:27 2018 +0200

    DO NOT MERGE Do not kill processes when screen size changes

    Causes too much of a process restart storm.

    Test: Switch cutout option
    Bug: 112876936
    Change-Id: I76909bd292c7d6b28c673f068c408885da0d92c1

commit 9ee5dff83c1cae93dff281735b60134dbd26dd8a
Author: Adrian Roos <roosa@google.com>
Date:   Wed Aug 22 20:19:49 2018 +0200

    BootAnimation: Fix boot animation with hidden cutout

    We do this by storing the masking inset in a persistent property.
    The boot animation then animates itself to where it would be if that
    masking inset were applied, then changes the viewport.

    For this to work, we also need to make sure the DisplayManagerService
    has the right overlay right at the start.

    Bug: 112876936
    Test: Hide cutout, then reboot. Verify boot animation is smooth.
    Change-Id: I3e988b2340b2e0d2be3939bdc6878704c234ccc8

commit ab39f605b1d64fad6b6c3ee0ddcb28cb7c77fddf
Merge: 3d91fa44b76 da4997312c7
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Aug 22 17:11:58 2018 +0000

    Merge "DO NOT MERGE Fix display freezing when screen size mismatches" into pi-dev

commit da4997312c79bfb5b5c6fb31833fc2ce401c4457
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Aug 22 15:43:17 2018 +0200

    DO NOT MERGE Fix display freezing when screen size mismatches

    If we have a display size change, make sure to set different
    scaling mode such that we can show the buffer even if there is
    a size mismatch.

    Test: Rotate screen
    Test: Change cutout type
    Bug: 112876936
    Change-Id: Iedc7774d69730a95b98ba46d4f274bc3b7e66bd1

commit 3d91fa44b76f52d76157d81f980680b983835660
Merge: 2bd9a25007f c50a9bd24d2
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Aug 22 14:52:42 2018 +0000

    Merge "Update severe (5%/1 hour) warning to send through battery saver" into pi-dev

commit c50a9bd24d2a243f77e09cc331bf9b10446d436a
Author: Salvador Martinez <dehboxturtle@google.com>
Date:   Fri Aug 3 14:07:44 2018 -0700

    Update severe (5%/1 hour) warning to send through battery saver

    Now that battery saver is sticky this notification never shows
    and we are getting reports from people that the notification
    they were expecting never showed up. It turns out that a lot
    of these were due to people not realizing battery saver was on.
    To remedy the worst case situation (your phone is about to die
    soon but no 15%/3 hour notification came up) we should always
    show the severe warning even if battery saver is on. This only
    affects the hybrid warning, not the legacy percentage based
    version.

    Test: unit tests
    Bug: 111596093
    Change-Id: I92453b68b6ee8aad8f862147c877f4e789afc55c
    Merged-In: I92453b68b6ee8aad8f862147c877f4e789afc55c

commit 2bd9a25007fcec5612944af7db0d1aa4d9849351
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Tue Aug 21 17:41:13 2018 +0200

    DO NOT MERGE Kill most processes when display size changes

    This isn't something apps generally can handle, so we kill all of
    them for now.

    Test: Change cutout overlay that changes display size
    Test: Rotate screen
    Bug: 112876936
    Change-Id: Ic3b0f1b3ae1e9bd93ac8f2c6952aa093878602b8

commit a99c657655fab3cbdf2b35e2cebdc001990ae684
Merge: 44b2fa6114b 2c9fd5fbbb4
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Wed Aug 22 03:14:04 2018 +0000

    Snap for 4969136 from 2c9fd5fbbb43541ce4291c07bf61bdbe5dc70252 to pi-qpr1-release

    Change-Id: I348dc5200bd75dc04d6af22983e9c0bf2643dcd6

commit 2c9fd5fbbb43541ce4291c07bf61bdbe5dc70252
Merge: 9c5b761f294 64c9d90a63a
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Tue Aug 21 23:26:55 2018 +0000

    Merge "ScreenDecorations: Update corner radius when configuration changes" into pi-dev

commit 9c5b761f2940521d8cb75cc97882b6664217e448
Merge: c05c2d1e48c 843f6f78819
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Aug 21 21:54:42 2018 +0000

    Merge "Cutout emulation: string changes" into pi-dev

commit 64c9d90a63a0712018c0ecadc541d7d8b38ea49b
Author: Adrian Roos <roosa@google.com>
Date:   Mon Aug 20 13:43:38 2018 +0200

    ScreenDecorations: Update corner radius when configuration changes

    Bug: 112876936
    Test: atest ScreenDecorationsTest
    Change-Id: I4359b3da4a47dcf434f018fe3e62e18354d1be47

commit c05c2d1e48c650ab80d751941dfd2076736ba016
Merge: c9443e38944 8c28c7c2d91
Author: Adrian Roos <roosa@google.com>
Date:   Tue Aug 21 19:51:58 2018 +0000

    Merge "Cutout: Add developer setting to mask the display cutout" into pi-dev

commit 8c28c7c2d91fde8bac708e15bb12e53d0693e5c9
Author: Adrian Roos <roosa@google.com>
Date:   Mon Aug 20 13:43:38 2018 +0200

    Cutout: Add developer setting to mask the display cutout

    Adds an option to mask the cutout by effectively shrinking the logical display
    such that developers can test apps as if the device did not have a notch.

    Bug: 112876936
    Test: Go to Settings > Developer Options > Simulate display with cutout > "No cutout". Cutout should be hidden. Rotate screen, take screenshots, screenrecord, screen off animation should all work as expected.
    Change-Id: I5cdb201734d238bf3785ab55843114e4b5b4ee41

commit 843f6f78819e29cb4cb61c55614569211f0439b7
Author: Adrian Roos <roosa@google.com>
Date:   Tue Aug 21 18:29:38 2018 +0200

    Cutout emulation: string changes

    Bug: 112876936
    Test: Open developer options, go to "display cutout", verify strings.
    Change-Id: I1d22f56ca7fa8c817da2407f36613e4fc132a3a9

commit 44b2fa6114b64125eea887a48c699069b7957eea
Merge: 7a1bc135d3c c9443e38944
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Tue Aug 21 03:02:17 2018 +0000

    Snap for 4966094 from c9443e38944b11d32f63fd87aca2e5ceb5235767 to pi-qpr1-release

    Change-Id: I729e9afd508d1ce9d778f365b017024bda3d7afc

commit c9443e38944b11d32f63fd87aca2e5ceb5235767
Merge: 61ce5164807 42260339986
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Aug 21 01:18:09 2018 +0000

    Merge "Improved AutofillManager and Activity dump() methods:" into pi-dev

commit 61ce5164807c904a2323ddf0cebe8502923ac5ec
Merge: abd5538ecdb 334d1bceb52
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Aug 21 01:10:28 2018 +0000

    Merge "Never clear QS tile state." into pi-dev

commit abd5538ecdbbcf36364730f32d057a9cbdf9ad7d
Merge: d412914643b 2cbe8cd0fdc
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Aug 21 00:36:55 2018 +0000

    Merge "Fixes deadzone consuming touch for 3 button layout" into pi-dev

commit d412914643babc043191b377b97819066cfa800b
Merge: e4e1b4fbec5 2ec961dad3e
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Aug 20 23:44:32 2018 +0000

    Merge "Send widget registration broadcasts before BOOT_COMPLETE" into pi-dev

commit 334d1bceb526cc343428ab8ff625800b15f21283
Author: Amin Shaikh <ashaikh@google.com>
Date:   Thu Aug 16 10:49:48 2018 -0400

    Never clear QS tile state.

    QSTile#clearState puts QS tiles in an invalid state that may not be
    immediately rectified through QSTile#refreshState. In the case of
    configuration changes, if a subclass implementation of
    QSTile#handleSetListening does not trigger a refresh state, the
    invalid state causes incorrect click handling.

    Change-Id: I17eba133cf08c45a768e9e0ed8fda623e85b4370
    Fixes: 69738120
    Fixes: 110480955
    Test: manual
    (cherry picked from commit 299c45c85d41975514022263fa6a29329eb5a0bc)

commit e4e1b4fbec5cb1429a7b58ae57f075de7921735c
Merge: 664dde335c7 a6ab55dc113
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Aug 20 23:08:45 2018 +0000

    Merge changes I5610b42b,Ib7a52bd0 into pi-dev

    * changes:
      ResourceManager: Disable APK Assets cache for real.
      ResourceManager: Disable APK Assets cache.

commit 664dde335c7f882d67ab367614bf72e08bc99302
Merge: 2d41269fa3e 73ab97c449c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Aug 20 22:28:14 2018 +0000

    Merge "ScreenDecorations: Fix stuck / delayed rotations" into pi-dev

commit 2d41269fa3e78b1e59dfecc4b3ebf004056235b6
Merge: 2a7122cf9d5 fe0a59b076e
Author: Winson Chung <winsonc@google.com>
Date:   Mon Aug 20 21:57:42 2018 +0000

    Merge "Workaround regression in multiwindow mode change callback" into pi-dev

commit 2a7122cf9d51280cf677cb3849452d25a9f47c0f
Merge: db7648f374a f8a96ddcb8e
Author: Winson Chung <winsonc@google.com>
Date:   Mon Aug 20 21:24:57 2018 +0000

    Merge "Fix race condition in BoundsAnimationController" into pi-dev

commit db7648f374a335900163ae9c7f8f411b5a8a8852
Merge: e4d35b6dc08 3438421295c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Aug 20 20:29:21 2018 +0000

    Merge "Log AutofillClient on CompatibilityBridge.onAccessibilityEvent()." into pi-dev

commit 2cbe8cd0fdce500f428100059370d6c1b86c1180
Author: Matthew Ng <ngmatthew@google.com>
Date:   Mon Aug 20 11:27:40 2018 -0700

    Fixes deadzone consuming touch for 3 button layout

    Change-Id: Ie21af8dab462412ba0a0a4fb0d71ab1bda750c4f
    Fixes: 112842731
    Test: manual, set 3 button layout, tap right above home button

commit e4d35b6dc082b9457d472a18df3897e84ddda9ba
Merge: ccefa79c075 a9aacf9bfde
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Aug 20 19:07:10 2018 +0000

    Merge "Log CompatibilityBridge.onAccessibilityEvent()" into pi-dev

commit ccefa79c075e56e9c153b1ab021993ebc92cfea7
Merge: 14c6b42b725 038e259cf54
Author: Selim Cinek <cinek@google.com>
Date:   Mon Aug 20 17:58:25 2018 +0000

    Merge "Fixed a leak of a notification when replying to a conversation" into pi-dev

commit 14c6b42b725e63f240a80fa5c630149dde71520a
Merge: 30fdcbad943 fcb10a09dae
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Aug 20 17:11:18 2018 +0000

    Merge "Fixed OneTimeListener so AUTOFILL_SAVE_UI metric is properly saved." into pi-dev

commit a6ab55dc113b4b6ca1a94ba9b256cca1a8986dfa
Author: Richard Uhler <ruhler@google.com>
Date:   Mon Aug 20 14:11:37 2018 +0100

    ResourceManager: Disable APK Assets cache for real.

    Test: atest -v google/perf/app-startup/benchmark-app-hermetic/cold-dropcache-test
    Bug: 111385832
    Change-Id: I5610b42b51d3b12cc8587cae6556557362bf67d0
    (cherry picked from commit 93090515b9702c3ebf205b96587233dbb2c0069b)

commit 77e9589274f85e30d68affd3f3defc109ae1041f
Author: Narayan Kamath <narayan@google.com>
Date:   Mon Aug 13 12:53:38 2018 +0100

    ResourceManager: Disable APK Assets cache.

    The WeakReference based cache of Assets in use elsewhere in the
    process remains unchanged.

    Note that this change is larger than it needs to be because it is
    an error to create an LruCache of size zero.

    There seems to be no measurable difference as measured by the standard
    app startup benchmarks.

    Test: atest -v google/perf/app-startup/benchmark-app-hermetic/cold-dropcache-test
    Bug: 111385832
    (cherry picked from commit bc95621811b0c15904a4783aae34e94aa109f764)

    Change-Id: Ib7a52bd03f6f13cdb76b82abc307d17227c4c1dc

commit 7a1bc135d3c001aa75dfb122d89fae45b0ff92ac
Merge: c827c2923a4 30fdcbad943
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Mon Aug 20 03:07:15 2018 +0000

    Snap for 4963492 from 30fdcbad9436606df62ceb784160e73c46792cab to pi-qpr1-release

    Change-Id: I598612f2434ab4e1f784a29aa1f7710ac57254f6

commit 30fdcbad9436606df62ceb784160e73c46792cab
Merge: 375e397b092 3729e9ce4e1
Author: Makoto Onuki <omakoto@google.com>
Date:   Fri Aug 17 23:33:50 2018 +0000

    Merge "Default to FULL synchronous mode for sqlite DBs in system server" into pi-dev

commit 375e397b092281b501dac0049919d978bd5b51e0
Merge: 99168a63713 71a3d85bcbe
Author: Pavel Grafov <pgrafov@google.com>
Date:   Fri Aug 17 22:03:59 2018 +0000

    Merge "Use DPM's counter for invalid password attempts" into pi-dev

commit 99168a6371363e09f75e0ed4e81c32e9ccb969c7
Merge: 283f55f7de5 3c2fd6a1d79
Author: Selim Cinek <cinek@google.com>
Date:   Fri Aug 17 21:37:04 2018 +0000

    Merge "Fixed an issue where the message could be empty" into pi-dev

commit fcb10a09daed31dbaa0e1dbac3d07806a6307189
Author: Felipe Leme <felipeal@google.com>
Date:   Tue Aug 7 12:36:35 2018 -0700

    Fixed OneTimeListener so AUTOFILL_SAVE_UI metric is properly saved.

    Test: adb shell logcat -b events | grep sysui
    Test: atest CtsAutoFillServiceTestCases # to make sure it didn't break anything

    Fixes: 112315388

    Change-Id: Iecf374578b33a4fcfa84fe4f07613e05c9777fa9
    (cherry picked from commit 373d49ebe8d21410ea0d334d2fd99435f128325e)

commit 42260339986d16768a12db5785fa2e9a3488df85
Author: Felipe Leme <felipeal@google.com>
Date:   Wed Aug 15 08:44:12 2018 -0700

    Improved AutofillManager and Activity dump() methods:

    - Print compatibility mode info and activity token on AutofillManager.dump().
    - Add --autofill option on Activity so it just dump autofill state.

    Also fixed checkstyle import warnings on ActivityManagerShellCommand.

    Bug: 112417431
    Bug: 112584717

    Test: adb shell dumpsys activity top --autofill

    Change-Id: Id56b56a5d7e591d5204663a1da1322a15f8ef3aa
    (cherry picked from commit b546ca79163a59c65344726b5a41c7d739822ccd)

commit 3729e9ce4e17f82ed86566af0e7010b03bab28b5
Author: Makoto Onuki <omakoto@google.com>
Date:   Tue Aug 7 15:57:13 2018 -0700

    Default to FULL synchronous mode for sqlite DBs in system server

    Test: change pin and immediately crash the kernel with
    adb shell 'su root sh -c "echo c >/proc/sysrq-trigger"' and boot
    Bug: 112175067

    Change-Id: Ia5f43f3118e2297fbea43c805ef2f4577bf8a9bf
    (cherry picked from commit 50e00c8dc48849280410e38bb05a1f11ce24ef01)

commit 283f55f7de5b9866bf73ded9a36047637f9251b0
Merge: 41d7d89c4f7 43e75d98d8e
Author: Laura Davis <laurabd@google.com>
Date:   Fri Aug 17 20:58:43 2018 +0000

    Merge "Docs: Inserted links to relevant guide pages." into pi-dev

commit 41d7d89c4f7294155729e2c205c738878a306d6b
Merge: 644c277193f eec1710e4d9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 17 20:58:35 2018 +0000

    Merge "Ensure that popupTheme is always specified in the top-level theme." into pi-dev

commit 3438421295ce12cd8ffd1de67476ef9d06e37658
Author: Felipe Leme <felipeal@google.com>
Date:   Thu Aug 16 10:49:03 2018 -0700

    Log AutofillClient on CompatibilityBridge.onAccessibilityEvent().

    This is useful to identify cases where a browser used a trampoline activity to
    launch its rendering activity.

    Bug: 112584717
    Bug: 112690889

    Test: adb logcat AutofillManager

    Change-Id: I5e58cd8c8dc67ddeed8aa0996233dca9b89cc0d3
    (cherry picked from commit 7d4461d133decb5d903c26b88e8261935aaba617)

commit a9aacf9bfde5a9f59242b88394a76d2a0f3c5cb8
Author: Felipe Leme <felipeal@google.com>
Date:   Mon Aug 13 18:15:32 2018 -0700

    Log CompatibilityBridge.onAccessibilityEvent()

    Altough these are super spammy, they're super valuable when debugging why
    compat mode doesn't work.

    Bug: 112417431
    Fixes: 112584717

    Test: adb logcat AutofillManager

    Change-Id: I1574b51b1c6caf783038b82ff207986b726b2e8b
    (cherry picked from commit 5d35d3d2d6b85e0ab9a0fb9e2922ca69876d1447)

commit 644c277193f40d1523a668c3e30c43397b57fce4
Merge: 7e646bf9223 cc22fcc2959
Author: Todd Kennedy <toddke@google.com>
Date:   Fri Aug 17 12:56:57 2018 -0700

    [automerger skipped] Merge "RESTRICT AUTOMERGE Relax security exception for backport" into oc-dev am: 5b78b0015e am: dff5d48b7e
    am: cc22fcc295  -s ours

    Change-Id: Ie86f686d9216e04ddd11fd75b1fb5fa8a25ab751

commit cc22fcc2959dd62572a8b5a84851134cea506014
Merge: ffec86ff237 dff5d48b7eb
Author: Todd Kennedy <toddke@google.com>
Date:   Fri Aug 17 12:47:28 2018 -0700

    Merge "RESTRICT AUTOMERGE Relax security exception for backport" into oc-dev am: 5b78b0015e
    am: dff5d48b7e

    Change-Id: I4e419bcce7375da6b09c01c6a78e127de6dbf189

commit dff5d48b7eb2b527e998a9f3ff794ccd9539b85d
Merge: e88da3d679e 5b78b0015e0
Author: Todd Kennedy <toddke@google.com>
Date:   Fri Aug 17 12:19:09 2018 -0700

    Merge "RESTRICT AUTOMERGE Relax security exception for backport" into oc-dev
    am: 5b78b0015e

    Change-Id: I2da67334d41640ecac6f2b9b31c93d16ee48dc22

commit 5b78b0015e0ce0d16358409cae60eedf5ff7212f
Merge: fc28b6b7243 a2405766db1
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 17 18:56:28 2018 +0000

    Merge "RESTRICT AUTOMERGE Relax security exception for backport" into oc-dev

commit 7e646bf92238467be8ff88c28381783789640156
Merge: 121d4eee01f 9bad9cb1d3f
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 17 18:04:44 2018 +0000

    Merge "Fix memory leak in ApplicationStates" into pi-dev

commit c827c2923a4d8e0e9d676f348b958aa9370c1435
Merge: be8bf8b1a76 121d4eee01f
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 17 03:07:01 2018 +0000

    Snap for 4959688 from 121d4eee01f16e5b0c355f0f7813839ecb52aa87 to pi-qpr1-release

    Change-Id: If4f6a0077880729a11015a2164b6b887bad368a1

commit 43e75d98d8e6180aa82e372269487a9a6711b2ff
Author: Laura Davis <laurabd@google.com>
Date:   Fri Aug 10 15:46:06 2018 -0700

    Docs: Inserted links to relevant guide pages.

    This is the proof of concept for adding relevant
    links in API pages to narrative content.
    The design doc is hosted at:
    https://docs.google.com/document/d/1Y6bFua27Gs7ONZ27gz0nHz3Djv0WND_V_rX-XvbeB3U/edit?usp=sharing

    Test: make ds-docs

    Bug: 112478848
    Change-Id: Ic3842629c802fe89582d4d7b4a153e54d4ba1713

commit 038e259cf54c4fdfc98bda4eeb42fb5de740ad50
Author: Selim Cinek <cinek@google.com>
Date:   Thu Aug 16 16:30:45 2018 -0700

    Fixed a leak of a notification when replying to a conversation

    When replying to a child in a group, the notification could get
    removed, but forced to stay in the parent. This behavior doesn't
    make sense if we're keeping around the notification.

    Change-Id: I920eded257726fe8536f769357a5736ebf076051
    Fixes: 112714177
    Test: add group of 2, reply on child, observe no leak

commit 121d4eee01f16e5b0c355f0f7813839ecb52aa87
Merge: f87f8a48202 de23d28d07b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Aug 16 23:00:33 2018 +0000

    Merge "Camera: Documentation update to remove physicalIds" into pi-dev

commit de23d28d07b4095009dd3eed1cfd49a35e2b77d6
Author: Shuzhen Wang <shuzhenwang@google.com>
Date:   Wed Aug 15 14:01:45 2018 -0700

    Camera: Documentation update to remove physicalIds

    Public API doesn't see android.logicalcam.physicalIds. Remove it
    from public doc.

    Bug: 112655222
    Test: make offline-sdk-docs
    Change-Id: Idf6958fb7c117912e33ece4fbaed04cb8e5e14c0

commit f87f8a482023c71f3dc8a6eb6640bef9f273932e
Merge: 5cd354c89cd 7d9a33efb75
Author: Hall Liu <hallliu@google.com>
Date:   Thu Aug 16 22:57:13 2018 +0000

    Merge "Add carrier config for auto redialing 911" into pi-dev

commit fe0a59b076e849f5ad4168474e48a78a18ed6612
Author: Winson Chung <winsonc@google.com>
Date:   Wed Aug 8 16:10:20 2018 -0700

    Workaround regression in multiwindow mode change callback

    - Revert to O behaviour of sending same MW mode as PIP mode when updated

    Bug: 112198479
    Test: atest android.app.cts.TaskDescriptionTest
    Change-Id: I31387b5dfb2b3f4e8f82b2ba2c26b1672fc77272
    (cherry picked from commit 059955f992d77062058d25b9280b14eae5b0bdde)

commit 71a3d85bcbe978356e2146636f9e9928c70d1603
Author: Pavel Grafov <pgrafov@google.com>
Date:   Wed Aug 15 15:45:31 2018 +0100

    Use DPM's counter for invalid password attempts

    Currently Keyguard uses separate counter for invalid password attempts
    that is not persisted and is always initialized to zero after boot,
    so if the user made several attempts and rebooted the device, the
    device will show more allowed attempts before wipe than actually
    available. The counter is also incorrectly reset to zero when
    fingerprint is used successfully.

    With this CL the same counter is used for that message and for actual
    wipe triggering, it is persisted and is not reset upon reboot or
    fingerprint authehtication.

    Counting failed password attempts should be available in DevicePolicyManager
    even without PackageManager.FEATURE_DEVICE_ADMIN.

    Test: manual, tried using fingerprint and rebooting.
    Bug: 112588257
    Merged-In: I1f4012a95c6f6758885206f69e7ebe2c3704a567
    Change-Id: I1f4012a95c6f6758885206f69e7ebe2c3704a567

commit be8bf8b1a764555684fe3fedf154f38410cac7d6
Merge: bc6676ff5b2 5cd354c89cd
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Thu Aug 16 03:04:54 2018 +0000

    Snap for 4957529 from 5cd354c89cd3a48aa306e7f8fcaafb4417fa0a40 to pi-qpr1-release

    Change-Id: Ic9ddfa63b532ef9f0d14de6d06e678b2c11e8b3f

commit 5cd354c89cd3a48aa306e7f8fcaafb4417fa0a40
Merge: 6b188c070ee c80ffb4b0f2
Author: Eric Laurent <elaurent@google.com>
Date:   Thu Aug 16 01:42:21 2018 +0000

    Merge "add config option for safe volume warning" into pi-dev

commit 6b188c070ee8c69aca99bb65b29a2f5c78c5da1a
Merge: 1465046e394 277a5dc6249
Author: Beverly Tai <beverlyt@google.com>
Date:   Thu Aug 16 01:15:11 2018 +0000

    Merge "DO NOT MERGE: Ensure zen SystemConditions are subscribed" into pi-dev

commit 1465046e3940b5693b43d3f86098d5cb0dfc7bbd
Merge: 877a819e40d 2e068a3bec5
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Aug 15 23:16:52 2018 +0000

    Merge "Addition of HW Revision to Wifi metrics" into pi-dev

commit 877a819e40d20eb386f372b6ba011521cfc0132c
Merge: 5bcc3cb284e ffec86ff237
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 15:03:11 2018 -0700

    [automerger skipped] Merge changes from topic "am-0f30ee3d-94a0-4dc3-bb14-762781265ad9" into oc-dev am: fc28b6b724  -s ours am: e88da3d679  -s ours
    am: ffec86ff23  -s ours

    Change-Id: Idf8692b0d521c7c7082bd242318a3e1c3d8c5ceb

commit 5bcc3cb284e3b59e2b075bc3df0debd5c2c47d66
Merge: 7204970c5e5 55ff3c76c58
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 14:49:03 2018 -0700

    [automerger skipped] Merge changes from topic "am-c709fe3e-1c07-4ecd-9998-2477e3445dd4" into oc-dev am: d5e6e1e83e  -s ours am: e82c4b82cc  -s ours
    am: 55ff3c76c5  -s ours

    Change-Id: Ib2c05b9de6ab2984ea3dcc86e8b6eae9a4e95f83

commit 7204970c5e56d46765b3cc1caa604b878dcdaeb8
Merge: 8913a063290 35856900479
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 14:38:07 2018 -0700

    [automerger skipped] Merge "Fix crash during cursor moving on BiDi text" into oc-dev am: e385255db4 am: 06829a62b1  -s ours
    am: 3585690047  -s ours

    Change-Id: I3990f8533376209673b25f714e154bd94147b91b

commit ffec86ff2370165e7a2cfbf39b5d79feb767310c
Merge: 55ff3c76c58 e88da3d679e
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 14:01:02 2018 -0700

    [automerger skipped] Merge changes from topic "am-0f30ee3d-94a0-4dc3-bb14-762781265ad9" into oc-dev am: fc28b6b724  -s ours
    am: e88da3d679  -s ours

    Change-Id: Ic3ad5eefc164ba31cd4f256b9ee39d8bc3aa1d5a

commit 2e068a3bec55f9c192580fef5e55b992e1481d3b
Author: Siddharth Ray <siddharthr@google.com>
Date:   Fri Aug 10 17:36:17 2018 -0700

    Addition of HW Revision to Wifi metrics

    BUG:112541087
    Change-Id: If71584373f2a62c7c915c3dec3777d02878b7fda
    Merged-In: If71584373f2a62c7c915c3dec3777d02878b7fda

commit 55ff3c76c5880f74eaa89166ab336ea0c4a06f96
Merge: 35856900479 e82c4b82cc0
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 13:48:07 2018 -0700

    [automerger skipped] Merge changes from topic "am-c709fe3e-1c07-4ecd-9998-2477e3445dd4" into oc-dev am: d5e6e1e83e  -s ours
    am: e82c4b82cc  -s ours

    Change-Id: I1b7c3d8c456fa438233fa0884567b06f3b63eb4f

commit 358569004799130b61f89a639a772a934aad849b
Merge: 2cd112082b0 06829a62b11
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 13:38:40 2018 -0700

    [automerger skipped] Merge "Fix crash during cursor moving on BiDi text" into oc-dev am: e385255db4
    am: 06829a62b1  -s ours

    Change-Id: I9563f6fc8afa112e8a8455ffde9a221432cbcbf9

commit e88da3d679e13b4923d16fc3062a14138b9cf96c
Merge: e82c4b82cc0 fc28b6b7243
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 13:04:26 2018 -0700

    [automerger skipped] Merge changes from topic "am-0f30ee3d-94a0-4dc3-bb14-762781265ad9" into oc-dev
    am: fc28b6b724  -s ours

    Change-Id: I74179d805d746ccbb32546fb268cb52c8c9db514

commit 8913a0632903ad36695286b4be123633026244e3
Merge: aba234f4d9a 2cd112082b0
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 12:53:33 2018 -0700

    [automerger skipped] Merge "Fix crash during cursor moving on BiDi text" into oc-mr1-dev
    am: 2cd112082b  -s ours

    Change-Id: I075c5213415607a56dff509e79c76e089f6df04e

commit e82c4b82cc0d9551b6ccbe4926b97799054762be
Merge: 06829a62b11 d5e6e1e83e3
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 12:52:34 2018 -0700

    [automerger skipped] Merge changes from topic "am-c709fe3e-1c07-4ecd-9998-2477e3445dd4" into oc-dev
    am: d5e6e1e83e  -s ours

    Change-Id: Ie4fb9ca93c435f53cfe6db23b4902b094506b618

commit aba234f4d9a48034c4cd81c4e930f97ad387969b
Merge: f052c26a7dc 65f4293f344
Author: Kevin Hufnagle <khufnagle@google.com>
Date:   Wed Aug 15 19:47:34 2018 +0000

    Merge "docs: Added units for AccessibilityServiceInfo#notificationTimeout." into pi-dev

commit 06829a62b11ea685a925f56775065e3e9a454b66
Merge: 3f4c1ece822 e385255db4a
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 12:43:55 2018 -0700

    Merge "Fix crash during cursor moving on BiDi text" into oc-dev
    am: e385255db4

    Change-Id: Ib094039b1c515af77fcc3c051352de5cb15861cb

commit fc28b6b724325de5b7704a2ccf5713ebc321acb4
Merge: d5e6e1e83e3 01ff91a07cc
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 19:23:35 2018 +0000

    Merge changes from topic "am-0f30ee3d-94a0-4dc3-bb14-762781265ad9" into oc-dev

    * changes:
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b am: 74ffd2bc55 am: f7f008f573 am: 7693ce7eaf am: 11ba74cce9
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b am: 74ffd2bc55 am: f7f008f573 am: 7693ce7eaf
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b am: 74ffd2bc55 am: f7f008f573
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b am: 74ffd2bc55
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2
      [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea
      Fix crash during cursor moving on BiDi text

commit d5e6e1e83e3a804301e1026d803b73769ad8ed5e
Merge: e385255db4a dfec065bd50
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 19:17:04 2018 +0000

    Merge changes from topic "am-c709fe3e-1c07-4ecd-9998-2477e3445dd4" into oc-dev

    * changes:
      [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb am: 12baaa2bc3 am: 99e3f649b4 am: a959ee227a am: 8f85f5ffd2
      [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb am: 12baaa2bc3 am: 99e3f649b4 am: a959ee227a
      [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb am: 12baaa2bc3 am: 99e3f649b4
      [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb am: 12baaa2bc3
      [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb
      Fix crash during cursor moving on BiDi text

commit e385255db4a725628288d1adbfbb665e2f192a4c
Merge: 9d85c1ff53a f496a7cdc6e
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 19:16:40 2018 +0000

    Merge "Fix crash during cursor moving on BiDi text" into oc-dev

commit 2cd112082b08a19c007d26069571867f99aa7569
Merge: f0d9a094d2d d30c55e3ccf
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 19:16:21 2018 +0000

    Merge "Fix crash during cursor moving on BiDi text" into oc-mr1-dev

commit f052c26a7dcf75da3b6bd4483f9273a24787ba0c
Merge: b0b70b8e87d a1076fdaa54
Author: Mihai Popa <popam@google.com>
Date:   Wed Aug 15 19:16:02 2018 +0000

    Merge "Fix crash during cursor moving on BiDi text" into pi-dev

commit dfec065bd504bdf9673ca2678b6183aa89017672
Merge: 9d85c1ff53a 8f85f5ffd23
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 19:13:15 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb am: 12baaa2bc3 am: 99e3f649b4 am: a959ee227a am: 8f85f5ffd2

    Change-Id: If854f61c2516a61ac36426c10eafd30bf638e919

commit 8f85f5ffd235325ac7a8a03b2adb9eba12c96351
Merge: cdc0a14f3e6 a959ee227a7
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 19:13:10 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb am: 12baaa2bc3 am: 99e3f649b4 am: a959ee227a

    Change-Id: I7cb6623befc84f76e783b8800aa18ce28a8cc2b7

commit a959ee227a708acbb59bcb197bd04358456a520a
Merge: 96e845cc4c8 99e3f649b43
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 19:13:04 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb am: 12baaa2bc3 am: 99e3f649b4

    Change-Id: I16bff43cf755e443ed53f7a45469351c498f977f

commit 99e3f649b43273c5a135416f036aa874f9a41685
Merge: 7ae6e6566fb 12baaa2bc3b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 19:12:59 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb am: 12baaa2bc3

    Change-Id: Iaf0aded3004f33fdb52dd0c19779329991b24746

commit 12baaa2bc3b082ab132bb6808fee6856f98feee3
Merge: fce27e8502a 82c84d5fbb6
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 19:12:52 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 82c84d5fbb

    Change-Id: I221d974ba9402c088235d5bdb3c94e91cf4167ba

commit 82c84d5fbb692f5ed56175c55031e30566c18ee2
Author: Seigo Nonaka <nona@google.com>
Date:   Thu Jul 19 16:22:02 2018 -0700

    Fix crash during cursor moving on BiDi text

    The crash was introduced by Ib66ef392c19c937718e7101f6d48fac3abe51ad0
    The root cause of the crashing is requesting out-of-line access for the
    horizontal width. This invalid access is silently ignored by
    TextLine#measure() method but new implementation end up with out of
    bounds access.

    To makes behavior as old implementation, calling getHorizontal instead
    of accessing measured result array.

    Bug: 78464361, 111580019
    Test: Manually done
    Change-Id: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8
    (cherry picked from commit 960647d582911ae7ab8b9491097898e6c313aaf1)
    Merged-In: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8

commit d30c55e3ccf25668fcbccf29c94224fd1d2e67b6
Author: Seigo Nonaka <nona@google.com>
Date:   Thu Jul 19 16:22:02 2018 -0700

    Fix crash during cursor moving on BiDi text

    The crash was introduced by Ib66ef392c19c937718e7101f6d48fac3abe51ad0
    The root cause of the crashing is requesting out-of-line access for the
    horizontal width. This invalid access is silently ignored by
    TextLine#measure() method but new implementation end up with out of
    bounds access.

    To makes behavior as old implementation, calling getHorizontal instead
    of accessing measured result array.

    Bug: 78464361, 111580019
    Test: Manually done
    Change-Id: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8
    (cherry picked from commit 960647d582911ae7ab8b9491097898e6c313aaf1)
    Merged-In: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8

commit f496a7cdc6ec1b04e0eb0cb19e4d382f2d823b8f
Author: Seigo Nonaka <nona@google.com>
Date:   Thu Jul 19 16:22:02 2018 -0700

    Fix crash during cursor moving on BiDi text

    The crash was introduced by Ib66ef392c19c937718e7101f6d48fac3abe51ad0
    The root cause of the crashing is requesting out-of-line access for the
    horizontal width. This invalid access is silently ignored by
    TextLine#measure() method but new implementation end up with out of
    bounds access.

    To makes behavior as old implementation, calling getHorizontal instead
    of accessing measured result array.

    Bug: 78464361, 111580019
    Test: Manually done
    Change-Id: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8
    (cherry picked from commit 960647d582911ae7ab8b9491097898e6c313aaf1)
    Merged-In: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8

commit a1076fdaa54ebf56bb32bea43fb278f7470ff307
Author: Seigo Nonaka <nona@google.com>
Date:   Thu Jul 19 16:22:02 2018 -0700

    Fix crash during cursor moving on BiDi text

    The crash was introduced by Ib66ef392c19c937718e7101f6d48fac3abe51ad0
    The root cause of the crashing is requesting out-of-line access for the
    horizontal width. This invalid access is silently ignored by
    TextLine#measure() method but new implementation end up with out of
    bounds access.

    To makes behavior as old implementation, calling getHorizontal instead
    of accessing measured result array.

    Bug: 78464361, 111580019
    Test: Manually done
    Change-Id: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8
    (cherry picked from commit 960647d582911ae7ab8b9491097898e6c313aaf1)
    Merged-In: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8

commit b0b70b8e87d2c22d95207a0c9cfcf2838898d871
Merge: 0e43e2ef967 dcbed5fbe65
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Aug 15 18:59:12 2018 +0000

    Merge "Add HW Revision to GNSS Metrics" into pi-dev

commit 0e43e2ef9675cdcc7126869725ac17148a4bd30b
Merge: 2e2dcda172a 6064a17fa40
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Aug 15 18:53:16 2018 +0000

    Merge "Fix symmetric key generation in strongbox" into pi-dev

commit eec1710e4d968608f28098fc66476bb79d9a125a
Author: Alan Viverette <alanv@google.com>
Date:   Fri Aug 10 10:08:34 2018 -0400

    Ensure that popupTheme is always specified in the top-level theme.

    Also adds missing contextPopupMenuStyle definition.

    Bug: 112398006
    Test: manual
    Change-Id: If9b5d765b5b6e05d66397eda5838916f933e7132

commit bc6676ff5b20ab84a8425bf82e23151db0c6aa94
Merge: 797db3e6739 2e2dcda172a
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Wed Aug 15 03:10:26 2018 +0000

    Snap for 4954419 from 2e2dcda172a4523be095c21b07be78b6b211143c to pi-qpr1-release

    Change-Id: I55b2c2598e94e1999617e95a9ec0721b5dd33918

commit 65f4293f344c3d6e6764ad13053a2891c78a31d3
Author: Kevin Hufnagle <khufnagle@google.com>
Date:   Tue Aug 14 17:44:53 2018 -0700

    docs: Added units for AccessibilityServiceInfo#notificationTimeout.

    This field uses "milliseconds" as the time unit.

    Test: make ds-docs -j32

    Bug: 36949594
    Change-Id: Id2e55ed7c96364913bb7ad028798fad5f976d3ca

commit 01ff91a07cc6844ae4a717ec2d96e74c5f736a76
Merge: 9d85c1ff53a 11ba74cce9e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:29:36 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b am: 74ffd2bc55 am: f7f008f573 am: 7693ce7eaf am: 11ba74cce9

    Change-Id: Ia5fad0a4e89e6ff44c546ab71f37f657a3313f0d

commit 11ba74cce9e377a194b444df9d8c2f3a28c7fd40
Merge: cdc0a14f3e6 7693ce7eafc
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:29:30 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b am: 74ffd2bc55 am: f7f008f573 am: 7693ce7eaf

    Change-Id: Ic311029be8ab99f4aaae526d980da0f2436c5459

commit 7693ce7eafca70cfb796563d7ae78f80909cde5d
Merge: 96e845cc4c8 f7f008f5739
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:29:23 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b am: 74ffd2bc55 am: f7f008f573

    Change-Id: I4122a5c548c4b3395bb546c459c34f10b319ad29

commit f7f008f573976670a86b9b68e1d89df9df921230
Merge: 7ae6e6566fb 74ffd2bc556
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:29:16 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b am: 74ffd2bc55

    Change-Id: I680848db0e845617323ecca36c380fdf890789d9

commit 74ffd2bc556443e6f34b4947c0328b593a7c6aa5
Merge: fce27e8502a 65082f8f5b0
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:29:09 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9 am: 65082f8f5b

    Change-Id: I27b2220f568a37ff16b0dfc3376d7e46cb3659c9

commit 65082f8f5b0a85164f283a96ded58745431ea0e5
Merge: 8aecc35a204 04c7154fd95
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:28:52 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f am: 04c7154fd9

    Change-Id: Ic801a54fa6cb048ddf911c7b315849ab40bd7a52

commit 04c7154fd95d5599cee3b4de3d911323ae4a6dff
Merge: b27b3c7fce2 723f13d01f1
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:28:41 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2 skipped: 723f13d01f

    Change-Id: If1607fb19bd806cb6d0f9b9010032e95df6549a8

commit 723f13d01f146123c74994e38bc6ec69893ec062
Merge: a31be05c5b5 b7a2d47ec29
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:26:19 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea am: b7a2d47ec2

    Change-Id: I6995aab201805b64e81022db295356ef8abda30c

commit b7a2d47ec29c47bf53414f5e049d8154910bf626
Merge: 70e4dec56bb 95218ce7ea4
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 15 00:26:10 2018 +0000

    [automerger] Fix crash during cursor moving on BiDi text am: 95218ce7ea

    Change-Id: Id97c3f508a0dcd82978b06891b3a979921d4be3a

commit 95218ce7ea43c7633ca8c9f6e2aca9baaba4c3e5
Author: Seigo Nonaka <nona@google.com>
Date:   Thu Jul 19 16:22:02 2018 -0700

    Fix crash during cursor moving on BiDi text

    The crash was introduced by Ib66ef392c19c937718e7101f6d48fac3abe51ad0
    The root cause of the crashing is requesting out-of-line access for the
    horizontal width. This invalid access is silently ignored by
    TextLine#measure() method but new implementation end up with out of
    bounds access.

    To makes behavior as old implementation, calling getHorizontal instead
    of accessing measured result array.

    Bug: 111580019
    Test: Manually done
    Change-Id: I5c5778718f6b397adbb1e4f2cf95e9f635f6e5c8
    Merged-In: Ib66ef392c19c937718e7101f6d48fac3abe51ad0

commit 3c2fd6a1d7999994246e438694259140b9d78e06
Author: Selim Cinek <cinek@google.com>
Date:   Tue Aug 14 17:24:45 2018 -0700

    Fixed an issue where the message could be empty

    We're now making sure that the last message can never be too short
    and we will therefore always see at least one message

    Bug: 111576198
    Test: Send message with "Text\r\n"
    Change-Id: I4db0708511c45710540653501c845df5dd813545

commit 2ec961dad3eae53c7d3d674cc0540d1f5add6a26
Author: Christopher Tate <ctate@google.com>
Date:   Fri Jul 27 16:48:37 2018 -0700

    Send widget registration broadcasts before BOOT_COMPLETE

    Widget presence in the home app is important for usability, but it
    depends on a broadcast-based handshake at boot time.  This handshake
    occurring after the BOOT_COMPLETED broadcast was initiated means
    that in practice widgets may not become available for literal
    minutes following unlock, as it can take this long for the
    boot-complete broadcast to clear and let the systen proceed with
    dispatch of the widget handshakes.

    We address this by hoisting the widget setup broadcast to occur
    just *before* the boot-completed broadcast, rather than as part
    of general listener reaction to the global "this user has been
    unlocked" notification.

    Bug: 76154638
    Test: manual (note broadcast ordering following boot)
    Change-Id: I7c1a9f7a84fee71f71d2dcd52362a29c2436b01d
    Merged-In: Ibd97268f995ec673f21d8f5df257041cf61a058d

commit 2e2dcda172a4523be095c21b07be78b6b211143c
Merge: bfd66d50872 f0d9a094d2d
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 14:40:47 2018 -0700

    Merge changes from topic "am-81126cf1-3777-4130-82b2-fbb9b5f9bcf8" into oc-dev am: 9d85c1ff53 am: 3f4c1ece82
    am: f0d9a094d2

    Change-Id: I9e66651d9ef14a832b12c45a043466a1f9757606

commit bfd66d50872d299e54bc19c7af6430c23b9e3504
Merge: 9ef8b6521cb 3b8808869ae
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 14:29:50 2018 -0700

    [automerger skipped] Merge "RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package." into oc-dev am: 5315bbfbc7 am: 02d1a54dcf
    am: 3b8808869a  -s ours

    Change-Id: I73c45e48807b6c188a6258f6a758ec358b0d024b

commit f0d9a094d2d86133e17aca88621a956bf89aeb45
Merge: 3b8808869ae 3f4c1ece822
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 13:46:06 2018 -0700

    Merge changes from topic "am-81126cf1-3777-4130-82b2-fbb9b5f9bcf8" into oc-dev am: 9d85c1ff53
    am: 3f4c1ece82

    Change-Id: I0df7f7f048ebdc8fbfc608ec8e532fbf9fa3a866

commit 3b8808869aeb6451439b2c103ebc7c0434793ceb
Merge: 3375c14aefe 02d1a54dcfa
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 13:36:38 2018 -0700

    Merge "RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package." into oc-dev am: 5315bbfbc7
    am: 02d1a54dcf

    Change-Id: Id2ce7a146a5fc65e8c9c24560376a387cef76ca0

commit 3f4c1ece822af7b8e3167ed607eeba2db469385f
Merge: 02d1a54dcfa 9d85c1ff53a
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 13:16:40 2018 -0700

    Merge changes from topic "am-81126cf1-3777-4130-82b2-fbb9b5f9bcf8" into oc-dev
    am: 9d85c1ff53

    Change-Id: I96184594285add35eacbac8e61da3120e4ce67a1

commit 9ef8b6521cb0c2112b477b6aeb988464ba554446
Merge: 81c0878e2db df66bfaa0df
Author: Joshua Baxter <jbax@google.com>
Date:   Tue Aug 14 20:02:53 2018 +0000

    Merge "docs: fixed typo" into pi-dev

commit 02d1a54dcfa85d3d9d7411142424939399b9b5a0
Merge: 5e8e47d4f88 5315bbfbc7c
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 12:59:29 2018 -0700

    Merge "RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package." into oc-dev
    am: 5315bbfbc7

    Change-Id: Ibde8da5add8ee9e51c03b1ebb68b80313a7a5bb6

commit 9d85c1ff53a80c03cc05e644dd28a232ba052258
Merge: 5315bbfbc7c ecde0c2a39f
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 19:40:27 2018 +0000

    Merge changes from topic "am-81126cf1-3777-4130-82b2-fbb9b5f9bcf8" into oc-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815 am: 9310c5bdd3 skipped: c565a7f7e2
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815 am: 9310c5bdd3
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb
      RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package.

commit cdc0a14f3e6a57f202cc03fd306f20cfa1c58fda
Merge: a2ad2596b7f c565a7f7e2e
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 19:40:27 2018 +0000

    Merge changes from topic "am-81126cf1-3777-4130-82b2-fbb9b5f9bcf8" into nyc-mr2-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815 am: 9310c5bdd3
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb
      RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package.

commit 96e845cc4c85426f44cc9f995b376a816bbf2f6c
Merge: b2e2b1386fe 9310c5bdd36
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 19:40:27 2018 +0000

    Merge changes from topic "am-81126cf1-3777-4130-82b2-fbb9b5f9bcf8" into cw-f-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb
      RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package.

commit 7ae6e6566fb90ec486e7f31d5ccbcaf18acd3b69
Merge: 424304f893f a491c048150
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 19:40:27 2018 +0000

    Merge changes from topic "am-81126cf1-3777-4130-82b2-fbb9b5f9bcf8" into nyc-mr1-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb
      RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package.

commit fce27e8502ad334ca61d0dca73af391a09e7638a
Merge: c09bb997e8d 7d252f5ed7b
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 19:40:27 2018 +0000

    Merge changes from topic "am-81126cf1-3777-4130-82b2-fbb9b5f9bcf8" into nyc-dr1-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb
      RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package.

commit 8aecc35a204f53cfab33aae0d55818f4df22cb2e
Merge: 8e95967f092 fa69d725eb9
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 19:40:27 2018 +0000

    Merge "RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package." into nyc-dev

commit 5315bbfbc7c3a922527c7f59fdb7a7671b505ab0
Merge: f0095ec4d67 82107644043
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 19:40:14 2018 +0000

    Merge "RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package." into oc-dev

commit 81c0878e2dba1e9074b62daa327101af829154e3
Merge: b76b6c5a439 fde947837c8
Author: Atanas Kirilov <akirilov@google.com>
Date:   Tue Aug 14 19:40:04 2018 +0000

    Merge "RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package." into pi-dev

commit 277a5dc6249741e54137a561fb8b31946ed64446
Author: Beverly <beverlyt@google.com>
Date:   Tue Aug 14 09:43:11 2018 -0400

    DO NOT MERGE: Ensure zen SystemConditions are subscribed

    Test: ZenModeHelperTest
    Bug: 112500368
    Change-Id: I5ac4edcee5a6dc7c4877aa147016c09e53a0b033

commit b76b6c5a439f502d08ec9de32409d60c0d8f4edc
Merge: 37a29795e45 53267721066
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Aug 14 18:22:49 2018 +0000

    Merge "Update WebView#clearClientCertPreferences docs." into pi-dev

commit 37a29795e459166790b90506b14ce5300e2961be
Merge: 0d758300535 b93f8dd3cc3
Author: Laura Davis <laurabd@google.com>
Date:   Tue Aug 14 17:59:30 2018 +0000

    Merge "Docs: Removed narrative content and edited links." into pi-dev

commit 0d75830053538103788952e437d6347f44d0b38b
Merge: 36362afdc16 e4b86644bb2
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Aug 14 14:09:20 2018 +0000

    Merge "Update WebBackForwardList javadoc." into pi-dev

commit 36362afdc16c2b92fb4f6ff9dd9e73b5bf21405b
Merge: d82da978c1b 7def66c676a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Aug 14 13:43:46 2018 +0000

    Merge "Clarify WebView's lack of plugin support." into pi-dev

commit 7def66c676ae7eec96a6314a2230b9bc5b70366f
Author: Torne (Richard Coles) <torne@google.com>
Date:   Thu Jun 28 19:33:27 2018 -0400

    Clarify WebView's lack of plugin support.

    Update docs to clarify that plugins are in fact not supported from K
    onward and that enabling them doesn't do anything.

    Bug: 112579915
    Test: m offline-sdk-docs
    Change-Id: I8678ea716be0adc4cd3a6fae1b4776e312ec29e0
    (cherry picked from commit 1676c95ddc1562cf6826027f96b64e0ab739ed50)

commit 797db3e67399c4f341c150356d0b924bb3e37111
Merge: e3cc89147b0 d82da978c1b
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Tue Aug 14 03:13:11 2018 +0000

    Snap for 4951295 from d82da978c1b1d40b1f0d7c4066517f714f2704fe to pi-qpr1-release

    Change-Id: I845f43521dab6a9a9cbfc3975f9f85e93b1040a3

commit d82da978c1b1d40b1f0d7c4066517f714f2704fe
Merge: ce01dba2b74 a9aa1be6c76
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Aug 13 23:12:59 2018 +0000

    Merge "docs: fixed typo" into pi-dev

commit dcbed5fbe654d31b15c418e33e24370a7106d128
Author: Siddharth Ray <siddharthr@google.com>
Date:   Mon Aug 13 10:25:53 2018 -0700

    Add HW Revision to GNSS Metrics

    Test:
    adb shell dumpsys location
    Hardware Version: EVT2.0

    BUG:112541087
    Change-Id: I6278188f15f22ff7b4f5cc30c4c225e0f95ec53d

commit ce01dba2b746d65d3528211761c122026f34f952
Merge: 3621bf192cb 2ef26755473
Author: Joshua Baxter <jbax@google.com>
Date:   Mon Aug 13 22:46:02 2018 +0000

    Merge "docs: fixed typo" into pi-dev

commit 3621bf192cba6ba6059c1aeb1570757e82b7772f
Merge: 8cb78fcb1ef 01c80136ba5
Author: Joshua Baxter <jbax@google.com>
Date:   Mon Aug 13 22:43:17 2018 +0000

    Merge "docs: fixed typo" into pi-dev

commit 5326772106647cc586c4a5935775cd6555c06c92
Author: Torne (Richard Coles) <torne@google.com>
Date:   Wed Jun 20 15:31:49 2018 -0400

    Update WebView#clearClientCertPreferences docs.

    Remove the reference to the specific ACTION_STORAGE_CHANGED intent as
    other intents are used instead on newer OS versions; just note that it's
    cleared automatically when the keychain is updated and don't specify the
    exact mechanism.

    Change-Id: Ic677832a1384e0eb2498d06e7aa34507fd2e7278
    Fixes: 30371615
    Test: make offline-sdk-docs
    (cherry picked from commit 01eb1282138b8c06351efa7e91baac6f98c54660)

commit e4b86644bb285d1aa7224898ede5c08a1a8ad1dc
Author: Torne (Richard Coles) <torne@google.com>
Date:   Tue Jun 19 16:29:54 2018 -0400

    Update WebBackForwardList javadoc.

    Update javadoc for WebBackForwardList and WebHistoryItem. Remove
    references to history items being updated as this no longer occurs, and
    clarify in clone() that there's no need to acutally do this any more.

    Also remove a bunch of implementation notes about
    atomicity/synchronisation that are being rendered attached to the return
    value and likely aren't even true any more, let alone relevant to
    developers.

    Bug: 74593032
    Test: make offline-sdk-docs
    Change-Id: I4ce33133d2ff18e7376d768c7a2e076ecd2a8b95
    (cherry picked from commit 8949046528941e593c3b03c2f67fc323d6ae1fa9)

commit c80ffb4b0f2981e54ede0f663f965e08cad0409d
Author: Eric Laurent <elaurent@google.com>
Date:   Mon Jul 30 18:45:21 2018 -0700

    add config option for safe volume warning

    Add boolean configuration option config_safe_media_disable_on_volume_up
    to customize the behavior of safe volume warning dialog:
    - When true the dialog can be dismissed with a single press on Vol+ key
    (default AOSP behavior)
    - When false it cannot.

    Initially disabled for Vodaphone DE, UK, ES and IT.

    Bug: 65155536
    Bug: 111667485
    Test: make
    Change-Id: I538d91e570fc962c93264db000dfcfdce90da1f0

commit e3cc89147b0b04477a92bae476678a23603065d9
Merge: 23fe45f5d71 8cb78fcb1ef
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Mon Aug 13 03:12:57 2018 +0000

    Snap for 4949382 from 8cb78fcb1ef1f196b36f841bc5c04288f5b6299f to pi-qpr1-release

    Change-Id: I95d0db4e6b6035249937c06338ae5a8093fa5d94

commit 8cb78fcb1ef1f196b36f841bc5c04288f5b6299f
Merge: 5c16aa778a7 8046ba6ef32
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 21:01:52 2018 +0000

    Merge "Sending BATTERY_LEVEL_CHANGED when plug type changes" into pi-dev

commit 5c16aa778a744f128c99b474279c2f552eee7079
Merge: a0bda20ae03 3375c14aefe
Author: Jeff Sharkey <jsharkey@google.com>
Date:   Fri Aug 10 12:52:50 2018 -0700

    [automerger skipped] Merge changes from topic "back111085900" into oc-dev am: f0095ec4d6 am: 5e8e47d4f8
    am: 3375c14aef  -s ours

    Change-Id: I345878aeec43a19778f70e0bf325b3e278bab682

commit a0bda20ae0338ec8ac6dc9eaf479aa1556fb90f9
Merge: 205895e6e87 d270842f22e
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 12:46:36 2018 -0700

    [automerger skipped] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 5a55a72fcd am: 628667ac86
    am: d270842f22  -s ours

    Change-Id: I6bf1c307208a1db1bdb67574801a472dbc27f97d

commit 205895e6e87e93d61bbb03dacf2e471ba21da599
Merge: b630be0b516 2adafa92bcb
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 12:45:27 2018 -0700

    [automerger skipped] [automerger] DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete. am: 8e95967f09 am: c09bb997e8 am: 424304f893 am: b2e2b1386f skipped: a2ad2596b7 am: 4ccfb1d0aa am: efe1afbf93
    am: 2adafa92bc  -s ours

    Change-Id: Iec62f49c864d2380025b9a64dab868bcce7512fc

commit b630be0b51646ff7c8a972cf5af1488ed1163733
Merge: 3eef28d461b 798655e2e11
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 12:44:12 2018 -0700

    [automerger skipped] [automerger] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 286fd5652a am: 8ecd22c0a4 am: 97d0d2c209 am: ca5fd693bc skipped: 19d2af61df am: f5c1a7ca27 am: b2ed78a197
    am: 798655e2e1  -s ours

    Change-Id: I8c70a90fc10d8707b65e09ccddfe3acb984d3d92

commit 3375c14aefe5479d452dc0fcaffa7e86460b230a
Merge: d270842f22e 5e8e47d4f88
Author: Jeff Sharkey <jsharkey@google.com>
Date:   Fri Aug 10 12:28:13 2018 -0700

    Merge changes from topic "back111085900" into oc-dev am: f0095ec4d6
    am: 5e8e47d4f8

    Change-Id: I251eeddbbd73f0747920d757d6a210d0d5b772f5

commit d270842f22e22a47c0311690ca13c300b525a7f2
Merge: 2adafa92bcb 628667ac860
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 12:23:42 2018 -0700

    DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 5a55a72fcd
    am: 628667ac86

    Change-Id: I8f8645a99e8b3bd07cd82722b8af888d46955030

commit 2adafa92bcbec4f9f2ef12051c755f9abbc503c7
Merge: 798655e2e11 efe1afbf93b
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 12:20:08 2018 -0700

    [automerger] DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete. am: 8e95967f09 am: c09bb997e8 am: 424304f893 am: b2e2b1386f skipped: a2ad2596b7 am: 4ccfb1d0aa
    am: efe1afbf93

    Change-Id: I7ebe940777eba8ee575a0f970b462e447f241d53

commit 798655e2e114230ffa52e6017537cc026f29fc34
Merge: 130a2041e7d b2ed78a1976
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 12:12:07 2018 -0700

    [automerger] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 286fd5652a am: 8ecd22c0a4 am: 97d0d2c209 am: ca5fd693bc skipped: 19d2af61df am: f5c1a7ca27
    am: b2ed78a197

    Change-Id: I695962bed5fdd932b434244a5c50d33dce34f08b

commit 5e8e47d4f8829cd7cb2e58bd1b6cb96e7c7cd1f1
Merge: 628667ac860 f0095ec4d67
Author: Jeff Sharkey <jsharkey@google.com>
Date:   Fri Aug 10 11:12:36 2018 -0700

    Merge changes from topic "back111085900" into oc-dev
    am: f0095ec4d6

    Change-Id: Ie563f7c17a201dadfe8a6696d2cf99aebc07b855

commit 628667ac86032f4c5c6538bb868dd96d7c8e55ee
Merge: efe1afbf93b 5a55a72fcd1
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 11:05:51 2018 -0700

    DO NOT MERGE. Execute "strict" queries with extra parentheses.
    am: 5a55a72fcd

    Change-Id: I4be4620726e30ca4131320bde074a2e572c51a42

commit efe1afbf93b328e96176b3becc888e457f95c0ed
Merge: b2ed78a1976 4ccfb1d0aa0
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 10:58:44 2018 -0700

    [automerger] DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete. am: 8e95967f09 am: c09bb997e8 am: 424304f893 am: b2e2b1386f skipped: a2ad2596b7
    am: 4ccfb1d0aa

    Change-Id: Iffccf38fd5e090757a2610d7b2cea6f9eacfb51b

commit b2ed78a19765263a0553fc50a5f5cd0ce3c9382a
Merge: 1e4d88926f6 f5c1a7ca277
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Fri Aug 10 10:50:44 2018 -0700

    [automerger] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 286fd5652a am: 8ecd22c0a4 am: 97d0d2c209 am: ca5fd693bc skipped: 19d2af61df
    am: f5c1a7ca27

    Change-Id: I931e17dba1218ea342f9ec0f17a8a8432e77fc20

commit f0095ec4d67669bc4b0a68df8ef13deab4d94470
Merge: 4ccfb1d0aa0 09d49531334
Author: Jeff Sharkey <jsharkey@google.com>
Date:   Fri Aug 10 17:26:54 2018 +0000

    Merge changes from topic "back111085900" into oc-dev

    * changes:
      DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete.
      DO NOT MERGE. Execute "strict" queries with extra parentheses.

commit 3eef28d461b4fb20cd389f6eb6d620d1dfbbb221
Merge: 1f91ee38856 506994268bc
Author: Jeff Sharkey <jsharkey@google.com>
Date:   Fri Aug 10 17:26:54 2018 +0000

    Merge changes from topic "back111085900" into pi-dev

    * changes:
      DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete.
      DO NOT MERGE. Execute "strict" queries with extra parentheses.

commit 1f91ee3885620c96373335a9d4cdaa867126b412
Merge: dfba41947b6 0ff9946abe9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 17:18:36 2018 +0000

    Merge "Pinner: Don't pin apps for work profile." into pi-dev

commit dfba41947b6fa22bf0451a92a3a26cf78038998f
Merge: 2df4d93b012 3eab951217a
Author: Michal Karpinski <mkarpinski@google.com>
Date:   Fri Aug 10 08:32:57 2018 +0000

    Merge "DO NOT MERGE Log various information about non-foreground activity starts" into pi-dev

commit 23fe45f5d71d33b0bf67e810d793970279201645
Merge: e75ec61d814 2df4d93b012
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 10 03:09:42 2018 +0000

    Snap for 4945494 from 2df4d93b012c995d226121da944a677307eb5ef5 to pi-qpr1-release

    Change-Id: I9620dbd93c5e69b2d19f4189535868869f0100d7

commit b93f8dd3cc3f12506fe57776cbb4c2870e65d258
Author: Laura Davis <laurabd@google.com>
Date:   Tue Aug 7 09:53:52 2018 -0700

    Docs: Removed narrative content and edited links.

    Removed unused imports android.app.Activity and
    android.os.UserHandle because of checkstyle fail.

    Test: make ds-docs

    Bug: 111760788
    Change-Id: I2852fea6c4b55a3422712c113d081abd40d02dfd

commit 0ff9946abe9569808fb6b559aefb0c77f514c5ec
Author: Carmen Jackson <carmenjackson@google.com>
Date:   Thu Aug 9 14:51:39 2018 -0700

    Pinner: Don't pin apps for work profile.

    Since the Home and Camera intents aren't set to relevant apps for the
    work profile, we don't want to pin those. However, the pinner will
    trigger on boot for the work profile, after the primary profile has
    pinned, and clear the currently pinned apps to try to pin the work
    profile apps. This change skips rerunning the pinner for the work
    profile.

    Bug: 112357464
    Test: Added logging and tested device with a work profile. After reboot,
    saw that the apps for the primary profile are pinned and the ones for
    the work profile are not. Previously, apps for the work profile were
    attempted to be pinned.
    Change-Id: I0a7fdeab4287dcb6765c0fb47647ddc36db405b6

commit 2df4d93b012c995d226121da944a677307eb5ef5
Merge: 4db243a3db0 f2043b4af5a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Aug 9 22:03:33 2018 +0000

    Merge "Clarify WebViewClient.shouldOverrideUrlLoading docs" into pi-dev

commit 4db243a3db0879bb9734e6e3dea1fd661c8074b9
Author: Howard Ro <yro@google.com>
Date:   Tue Aug 7 15:44:25 2018 -0700

    Add a logging for ACTION_BAN_APP_NOTES

    Bug: 111215354
    Test: adb logcat -b events
    Change-Id: I4e26adac7a7ad5053b919605b8a25e18bd93cac7
    Merged-In: I4e26adac7a7ad5053b919605b8a25e18bd93cac7

commit 4ccfb1d0aa025163b404802c4731390846349be9
Merge: f5c1a7ca277 a2ad2596b7f
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:16:05 2018 +0000

    [automerger] DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete. am: 8e95967f09 am: c09bb997e8 am: 424304f893 am: b2e2b1386f skipped: a2ad2596b7

    Change-Id: I18dbb198314da3b3722e5b0dfbd9f1dd1e203d4a

commit a2ad2596b7f95ac1782a8e85fe1278083326fa48
Merge: 19d2af61df3 b2e2b1386fe
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:16:00 2018 +0000

    [automerger] DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete. am: 8e95967f09 am: c09bb997e8 am: 424304f893 am: b2e2b1386f

    Change-Id: Icdb977d8cb260d5210d103f306de550b3f8fed96

commit b2e2b1386fe5f1ae6cc3189ae4ea2d04f4bec583
Merge: ca5fd693bc7 424304f893f
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:15:55 2018 +0000

    [automerger] DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete. am: 8e95967f09 am: c09bb997e8 am: 424304f893

    Change-Id: I4c0f715b12df5e7ffb4f3a1b7cf9ae5da4be22ca

commit 424304f893f0c803563194b092b384dc17c23f96
Merge: 97d0d2c209d c09bb997e8d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:15:51 2018 +0000

    [automerger] DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete. am: 8e95967f09 am: c09bb997e8

    Change-Id: I544bf2c6b5d0177aa70a6fb7bd4225d4d04881fd

commit c09bb997e8d5d48ee33bcb7949bf603ff9b455a1
Merge: 8ecd22c0a4d 8e95967f092
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:15:45 2018 +0000

    [automerger] DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete. am: 8e95967f09

    Change-Id: I6cdb5a5dd5531ad53ef02174ff5063788d11029d

commit f5c1a7ca2778dbae675404ccc1e8a56b41d246ef
Merge: 05519b7e3d0 19d2af61df3
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:15:44 2018 +0000

    [automerger] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 286fd5652a am: 8ecd22c0a4 am: 97d0d2c209 am: ca5fd693bc skipped: 19d2af61df

    Change-Id: I66ddfbffbec736061780c86c9c9e542fe2a200ba

commit 19d2af61df39f568b37c0e976d5ea3322a70bc9a
Merge: cfc6d8607e2 ca5fd693bc7
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:15:39 2018 +0000

    [automerger] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 286fd5652a am: 8ecd22c0a4 am: 97d0d2c209 am: ca5fd693bc

    Change-Id: Iccacb48d382a3fd8012dff81c3d8482afe0e5f14

commit ca5fd693bc7eef0488af259a1fe4f2a60870c0c3
Merge: 23162a8897f 97d0d2c209d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:15:33 2018 +0000

    [automerger] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 286fd5652a am: 8ecd22c0a4 am: 97d0d2c209

    Change-Id: I92820ffe7b45077bc4beaf97144a7b7eb3117af0

commit 97d0d2c209d528d27083d880fa8ee2cdedc4fbd2
Merge: 1bce1217ca1 8ecd22c0a4d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:15:28 2018 +0000

    [automerger] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 286fd5652a am: 8ecd22c0a4

    Change-Id: Ia9f489c55def0f592383ac2a10f5bd0b34c2663d

commit 8ecd22c0a4d790baeee6ca3d575aff8f29f2357b
Merge: 00b57fc9b76 286fd5652a9
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:15:19 2018 +0000

    [automerger] DO NOT MERGE. Execute "strict" queries with extra parentheses. am: 286fd5652a

    Change-Id: Ia877305c642c3b7741941d2e438fe77f1d1550f3

commit 73ab97c449cea038b897cafb45e37978b2dc47a0
Author: Adrian Roos <roosa@google.com>
Date:   Thu Aug 2 15:56:15 2018 +0200

    ScreenDecorations: Fix stuck / delayed rotations

    Fixes the issue of stuck or delayed decor overlay rotations. The current logic
    cannot handle the case where the overlay has not finished rotating when we start
    another rotation.

    To work around that, we make sure that the rotation finishes fast enough for that
    not to happen, by decoupling it from the rest of SystemUI's traversals on a dedicated
    thread.

    Also fixes an issue in ScreenDecorations where we restarted drawing even though that
    was not needed, which further delayed finishing the rotation of the overlay.

    Also fixes an issue in ScreenDecorations where a spurious traversal after rotation
    started but before SysUI was notified could draw in the wrong orientation. To prevent
    that, we validate that our rotation matches the display rotation and restart the draw
    otherwise.

    In the future, we should investigate whether we can make this more robust by allowing
    stacked rotations, or forbidding rotations while the overlay is not done yet. We should
    also make the synchronization between WM and SysUI on what rotation is being drawn more
    explict and thus more robust.

    Change-Id: I5303a6a8e6392d309c0fe672ff6d1386ae18f235
    Merged-In: Id8fe1c7f6b38de8cd3ce5f4170ea37adf8cb9f3d
    Bug: 111761727
    Test: Ensure you have a lot of notifications, and enable cutout emulation, open camera, quickly rotate phone between landscape and portrait repeatedly, ensure there are no artifacts on screen.
    Test: atest ScreenDecorationsTest

commit 3eab951217abbb2c1e77c3814bbe60c7b50fee26
Author: Michal Karpinski <mkarpinski@google.com>
Date:   Fri Jul 20 15:32:00 2018 +0100

    DO NOT MERGE Log various information about non-foreground activity starts

    Logging activity starts to TRON, but only if the caller app
    doesn't have any foreground activity present.

    Example event:
    08-03 15:21:30.813  1231  3220 I sysui_multi_action: [757,1513,758,4,805,1533306090812,1514,10147,1515,com.google.android.talk,1516,1018,1517,0,1518,1000,1519,1000,1520,0,1521,10147,1522,com.google.android.talk,1523,1018,1524,0,1525,pendingintent:u0a12:com.google.android.talk/com.google.android.apps.hangouts.phone.ConversationActivity,1526,com.google.android.talk/com.google.android.apps.hangouts.phone.BabelHomeActivity,1527,1,1528,com.google.android.apps.hangouts.phone.conversationlist,1540,1,1541,com.google.android.apps.hangouts.phone.BabelHomeActivity,1542,3146240,1543,{com.google.android.talk/com.google.android.apps.hangouts.phone.BabelHomeActivity},1544,com.google.android.talk/com.google.android.apps.hangouts.phone.BabelHomeActivity,1545,com.google.android.talk,1546,1,1547,0,1551,0,1552,0]

    (cherry-picked from 201bc0c14e9e2c5d868fa5acff7edc3e8cc0f6b7)

    Bug: b/111866309
    Context: go/activity-starts-logging-tron
    Test: 1) enable logging with: adb shell settings put global activity_starts_logging_enabled 1
          2) open some activities and observe: adb logcat -b events | grep "sysui_multi_action: \[757,1513"
    Test: atest FrameworksServicesTests:ActivityStarterTests

    Change-Id: Ie7dee51c574e544d12e83d279afda46b336f2013

commit e75ec61d8149de4ee7705cecfb4131db0fe52c10
Merge: aff93b4de42 5c7dd60026a
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Thu Aug 9 03:08:04 2018 +0000

    Snap for 4942392 from 5c7dd60026ac25d50bd793113ba05babadf21386 to pi-qpr1-release

    Change-Id: Ib8ee91bb77cd838477dc1c2d37116723173829a5

commit 8046ba6ef327597e573a6af33e51893f3fb59309
Author: Suprabh Shukla <suprabh@google.com>
Date:   Wed Aug 8 18:16:22 2018 -0700

    Sending BATTERY_LEVEL_CHANGED when plug type changes

    Test: manual:
    adb shell dumpsys battery unplug|reset
    should trigger the broadcast

    Bug: 112322475
    Change-Id: I16b13274100903cb738a047c76d25cf30e480b88

commit 5c7dd60026ac25d50bd793113ba05babadf21386
Merge: 71b35bceddb 130a2041e7d
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Aug 8 18:15:26 2018 -0700

    [automerger skipped] DO NOT MERGE. Persistable Uri grants still require permissions. am: 05519b7e3d am: 1e4d88926f
    am: 130a2041e7  -s ours

    Change-Id: I71aecf8896fc494a75bd222e8c146ebce3654d53

commit 130a2041e7d36ff2427b7d1754a5a25ae0a0ae01
Merge: b9504e591a6 1e4d88926f6
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Aug 8 17:53:03 2018 -0700

    DO NOT MERGE. Persistable Uri grants still require permissions. am: 05519b7e3d
    am: 1e4d88926f

    Change-Id: I267a65ad3c2e73b697f832059567f4f2c2438792

commit 1e4d88926f6ec3e9fb038afda888f709cd9bc845
Merge: c93b4747524 05519b7e3d0
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Aug 8 17:23:00 2018 -0700

    DO NOT MERGE. Persistable Uri grants still require permissions.
    am: 05519b7e3d

    Change-Id: I6d42f089fec6c268b35885d3169644853ab734c5

commit 71b35bceddbafe494e1a3788d25dbcd9a39518d8
Merge: fd245851827 d6a6e7127cc
Author: Jeff Sharkey <jsharkey@google.com>
Date:   Thu Aug 9 00:06:30 2018 +0000

    Merge "DO NOT MERGE. Persistable Uri grants still require permissions." into pi-dev

commit f2043b4af5aac963d35c8248a2cec2d62bb7e1c4
Author: Paul Miller <paulmiller@google.com>
Date:   Wed Jul 25 18:11:26 2018 -0700

    Clarify WebViewClient.shouldOverrideUrlLoading docs

    Call out more explicitly the antipattern of calling loadUrl with the
    same URL and returning true, and repeat this on the deprecated version.
    Simplify the wording about returning true v.s. false. Switch to the
    "note" style used elsewhere on the page.

    BUG:111843379
    Change-Id: I36c31a8e0f4754c314b8a4d72cc497c9c3a3e242
    Test: make docs
    (cherry picked from commit 3819a6467b984119fd48ac54ae9a24d59e9ade95)

commit aff93b4de42cf538553bd875c8cd8af13ccbf9c2
Merge: 2824c42518a fd245851827
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Wed Aug 8 03:05:19 2018 +0000

    Snap for 4939496 from fd2458518271f1c442733003d00a2ff1373f9fb9 to pi-qpr1-release

    Change-Id: Ia4ed13c89e9f942f77a14efb72e9c14392a2f477

commit fd2458518271f1c442733003d00a2ff1373f9fb9
Merge: 97229ed3e80 a04c80089d7
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Aug 8 00:04:41 2018 +0000

    Merge "Fix to mark disableApkUnlessMatchedSku hidden for all users" into pi-dev

commit d6a6e7127cc341ca875d9d13cf7a864d9f20b479
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Tue Aug 7 15:02:17 2018 -0600

    DO NOT MERGE. Persistable Uri grants still require permissions.

    When FLAG_GRANT_PERSISTABLE_URI_PERMISSION is requested, we still
    need to check permissions between the source and target packages,
    instead of shortcutting past them.

    The spirit of the original change is remains intact: if the caller
    requested FLAG_GRANT_PERSISTABLE_URI_PERMISSION, then we avoid
    returning "-1", which would prevent the grant data structure from
    being allocated.

    Bug: 111934948
    Test: atest android.appsecurity.cts.AppSecurityTests
    Change-Id: Ief0fc922aa09fc3d9bb6a126c2ff5855347cd030
    Merged-In: Ief0fc922aa09fc3d9bb6a126c2ff5855347cd030

commit 05519b7e3d0f3d16ddfe6ee3892c8468a2c10c62
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Tue Aug 7 15:02:17 2018 -0600

    DO NOT MERGE. Persistable Uri grants still require permissions.

    When FLAG_GRANT_PERSISTABLE_URI_PERMISSION is requested, we still
    need to check permissions between the source and target packages,
    instead of shortcutting past them.

    The spirit of the original change is remains intact: if the caller
    requested FLAG_GRANT_PERSISTABLE_URI_PERMISSION, then we avoid
    returning "-1", which would prevent the grant data structure from
    being allocated.

    Bug: 111934948
    Test: atest android.appsecurity.cts.AppSecurityTests
    Change-Id: Ief0fc922aa09fc3d9bb6a126c2ff5855347cd030
    Merged-In: Ief0fc922aa09fc3d9bb6a126c2ff5855347cd030

commit a04c80089d75a52bb52a8ad6517be98258d41c0c
Author: Ruchi Kandoi <kandoiruchi@google.com>
Date:   Fri Aug 3 11:05:41 2018 -0700

    Fix to mark disableApkUnlessMatchedSku hidden for all users

    Bug: 111795497
    Test: manual; switch to guest & secondary user
    Change-Id: I8ba64f52953b8a86adaea343ed52eaa6865a0019

commit 97229ed3e8090c2f5cd3eabe6df5bcf841b832c1
Merge: 8f938095b4a a861ff7a647
Author: Andrew Solovay <asolovay@google.com>
Date:   Tue Aug 7 18:49:47 2018 +0000

    Merge "docs: Adding links to "about version" pages" into pi-dev

commit 8f938095b4a5f1b8734a1032ea4b2f251a33f2cd
Merge: 4deb5938085 2ea8e0b31fa
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Aug 7 18:20:16 2018 +0000

    Merge "wifi.proto: Add metric for installed passpoint profile type" into pi-dev

commit 9bad9cb1d3f5bcb76c0a0014842b6f9b1235a323
Author: Fan Zhang <zhfan@google.com>
Date:   Thu Jun 7 11:36:32 2018 -0700

    Fix memory leak in ApplicationStates

    - Use app context in dreambackend
    - Use WeakReference in LocalBluetoothManager to track foreground
      activity
    - Use WeakReference in ApplicationsState to track active sessions

    Bug: 80507279
    Bug: 109894607
    Test: hprof
    Change-Id: I0e868182a364efbd110eb77ebd6cdbd83f164669
    Merged-In: I0e868182a364efbd110eb77ebd6cdbd83f164669

commit 2824c42518a980876b3b7eac7e6473a190b8ff13
Merge: 208a501c92e 4deb5938085
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Tue Aug 7 03:05:27 2018 +0000

    Snap for 4937098 from 4deb5938085e0b1690450b5ed706e1a200899ba8 to pi-qpr1-release

    Change-Id: Ia3dcbf4ef1e9fdd8b6819bc08ca3d3410968a0b6

commit a861ff7a6479d86a651fb92118ef3b68b49429e2
Author: Andrew Solovay <asolovay@google.com>
Date:   Mon Aug 6 13:43:30 2018 -0700

    docs: Adding links to "about version" pages

    For the various Build.VERSION_CODES.<version_name> constants, adding
    a link to the appropriate "about this release" page in
    /about/versions/ , if there is one.

    Staged doc to:
    http://go/dac-stage/reference/android/os/Build.VERSION_CODES

    Bug: 80546406
    Test: make ds-docs
    Change-Id: If363445c938d325172da6beeed25e821121c5539

commit 4deb5938085e0b1690450b5ed706e1a200899ba8
Merge: a7a496f3a14 e6e6ec4849a
Author: Hall Liu <hallliu@google.com>
Date:   Mon Aug 6 22:57:35 2018 +0000

    Merge "Don't insert certain numbers into the call log" into pi-dev

commit e6e6ec4849a1bffec6e7bf993500b8ed533cd87c
Author: Hall Liu <hallliu@google.com>
Date:   Fri Aug 3 18:25:24 2018 -0700

    Don't insert certain numbers into the call log

    For regulatory requirements, prevent certain sensitive numbers from
    being logged in the call log. The numbers can either be specified in the
    carrier config or in the mcc config for the device.

    Bug: 111470439
    Test: unit, manual
    Change-Id: Icc4db12def802c2ce5485422a0ec199e3e7452fa

commit a7a496f3a14ffb467257286da2bfe0056091e83b
Merge: e85115fdb77 64439c1e8c9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Aug 6 17:25:48 2018 +0000

    Merge "No disclaimer when switching profile for system SMS and dialer apps." into pi-dev

commit f8a96ddcb8e37b3da4ce5027689db20e626220fd
Author: Winson Chung <winsonc@google.com>
Date:   Mon Jul 16 12:42:37 2018 -0700

    Fix race condition in BoundsAnimationController

    - The SfVsyncFrameCallbackProvider needs to be initialized with the
      associated handler thread's Choreographer instance.

    Bug: 111465953
    Test: Take a systrace and ensure the animation is running on the right
          thread

    Change-Id: Ia70b09d391fd2d154e00d081cfcf0d2354e51db2
    (cherry picked from commit 3749a052c9890b114a7286ce4961f3894d776c54)

commit 208a501c92e54cfb1fe65e181ffb554075f73778
Merge: 9870ed68200 e85115fdb77
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Mon Aug 6 03:02:10 2018 +0000

    Snap for 4933870 from e85115fdb7737516dcbb5d164ae94d35dcea8747 to pi-qpr1-release

    Change-Id: I4ea83684b3bc1da308aefb898d30a24e67210b35

commit e85115fdb7737516dcbb5d164ae94d35dcea8747
Merge: f8f459a2cc3 08bd163e2db
Author: Eino-Ville Talvala <etalvala@google.com>
Date:   Sat Aug 4 23:06:05 2018 +0000

    Merge "Camera: Documentation updates for calibration and distortion correction" into pi-dev

commit 506994268bc4fa07d8798b7737a2952f74b8fd04
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Jul 25 14:52:14 2018 -0600

    DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete.

    Developers often accept selection clauses from untrusted code, and
    SQLiteQueryBuilder already supports a "strict" mode to help catch
    SQL injection attacks.  This change extends the builder to support
    update() and delete() calls, so that we can help secure those
    selection clauses too.

    Bug: 111085900
    Test: atest packages/providers/DownloadProvider/tests/
    Test: atest cts/tests/app/src/android/app/cts/DownloadManagerTest.java
    Test: atest cts/tests/tests/database/src/android/database/sqlite/cts/SQLiteQueryBuilderTest.java
    Change-Id: Ib4fc8400f184755ee7e971ab5f2095186341730c
    Merged-In: Ib4fc8400f184755ee7e971ab5f2095186341730c

commit 57b04a86802ff879af78e782a8582462323e34e7
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Jul 25 14:01:59 2018 -0600

    DO NOT MERGE. Execute "strict" queries with extra parentheses.

    SQLiteQueryBuilder has a setStrict() mode which can be used to
    detect SQL attacks from untrusted sources, which it does by running
    each query twice: once with an extra set of parentheses, and if that
    succeeds, it runs the original query verbatim.

    This sadly doesn't catch inputs of the type "1=1) OR (1=1", which
    creates valid statements for both tests above, but the final executed
    query ends up leaking data due to SQLite operator precedence.

    Instead, we need to continue compiling both variants, but we need
    to execute the query with the additional parentheses to ensure
    data won't be leaked.

    Test: atest cts/tests/tests/database/src/android/database/sqlite/cts/SQLiteQueryBuilderTest.java
    Bug: 111085900
    Change-Id: I6e8746fa48f9de13adae37d2990de11c9c585381
    Merged-In: I6e8746fa48f9de13adae37d2990de11c9c585381

commit 09d49531334ce6bc4ac45de1d3d0edb1495c0566
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Jul 25 14:52:14 2018 -0600

    DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete.

    Developers often accept selection clauses from untrusted code, and
    SQLiteQueryBuilder already supports a "strict" mode to help catch
    SQL injection attacks.  This change extends the builder to support
    update() and delete() calls, so that we can help secure those
    selection clauses too.

    Bug: 111085900
    Test: atest packages/providers/DownloadProvider/tests/
    Test: atest cts/tests/app/src/android/app/cts/DownloadManagerTest.java
    Test: atest cts/tests/tests/database/src/android/database/sqlite/cts/SQLiteQueryBuilderTest.java
    Change-Id: Ib4fc8400f184755ee7e971ab5f2095186341730c
    Merged-In: Ib4fc8400f184755ee7e971ab5f2095186341730c

commit 5a55a72fcd18fb676eb4c114e62048068f71c01a
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Jul 25 14:01:59 2018 -0600

    DO NOT MERGE. Execute "strict" queries with extra parentheses.

    SQLiteQueryBuilder has a setStrict() mode which can be used to
    detect SQL attacks from untrusted sources, which it does by running
    each query twice: once with an extra set of parentheses, and if that
    succeeds, it runs the original query verbatim.

    This sadly doesn't catch inputs of the type "1=1) OR (1=1", which
    creates valid statements for both tests above, but the final executed
    query ends up leaking data due to SQLite operator precedence.

    Instead, we need to continue compiling both variants, but we need
    to execute the query with the additional parentheses to ensure
    data won't be leaked.

    Test: atest cts/tests/tests/database/src/android/database/sqlite/cts/SQLiteQueryBuilderTest.java
    Bug: 111085900
    Change-Id: I6e8746fa48f9de13adae37d2990de11c9c585381
    Merged-In: I6e8746fa48f9de13adae37d2990de11c9c585381

commit 8e95967f092b4ffa593861452e55621b4e528acf
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Jul 25 14:52:14 2018 -0600

    DO NOT MERGE. Extend SQLiteQueryBuilder for update and delete.

    Developers often accept selection clauses from untrusted code, and
    SQLiteQueryBuilder already supports a "strict" mode to help catch
    SQL injection attacks.  This change extends the builder to support
    update() and delete() calls, so that we can help secure those
    selection clauses too.

    Bug: 111085900
    Test: atest packages/providers/DownloadProvider/tests/
    Test: atest cts/tests/app/src/android/app/cts/DownloadManagerTest.java
    Test: atest cts/tests/tests/database/src/android/database/sqlite/cts/SQLiteQueryBuilderTest.java
    Change-Id: Ib4fc8400f184755ee7e971ab5f2095186341730c
    Merged-In: Ib4fc8400f184755ee7e971ab5f2095186341730c

commit 286fd5652a9804bfd185980dc07ad239e1169929
Author: Jeff Sharkey <jsharkey@android.com>
Date:   Wed Jul 25 14:01:59 2018 -0600

    DO NOT MERGE. Execute "strict" queries with extra parentheses.

    SQLiteQueryBuilder has a setStrict() mode which can be used to
    detect SQL attacks from untrusted sources, which it does by running
    each query twice: once with an extra set of parentheses, and if that
    succeeds, it runs the original query verbatim.

    This sadly doesn't catch inputs of the type "1=1) OR (1=1", which
    creates valid statements for both tests above, but the final executed
    query ends up leaking data due to SQLite operator precedence.

    Instead, we need to continue compiling both variants, but we need
    to execute the query with the additional parentheses to ensure
    data won't be leaked.

    Test: atest cts/tests/tests/database/src/android/database/sqlite/cts/SQLiteQueryBuilderTest.java
    Bug: 111085900
    Change-Id: I6e8746fa48f9de13adae37d2990de11c9c585381
    Merged-In: I6e8746fa48f9de13adae37d2990de11c9c585381

commit 9870ed68200840a5dd9c6f6db5c691a4efbf818b
Merge: 7e88efed125 f8f459a2cc3
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 3 03:05:16 2018 +0000

    Snap for 4930082 from f8f459a2cc3e0abb88323fa08243c302998deb6c to pi-qpr1-release

    Change-Id: I8e20451615f6e578c33860f0d4845aa82cc504e8

commit f8f459a2cc3e0abb88323fa08243c302998deb6c
Merge: 9d80381ad8b d967f8210c2
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Aug 2 22:36:10 2018 +0000

    Merge "Do not restart tethering while enabling tethering." into pi-dev

commit 08bd163e2db8c7e073a3d633cbf4cb0f53fe3c14
Author: Eino-Ville Talvala <etalvala@google.com>
Date:   Wed Aug 1 17:23:09 2018 -0700

    Camera: Documentation updates for calibration and distortion correction

    - Add more notes on coordinate axes
    - Add more text on metadata when distortion correction is active
    - Note that poseTranslation needs to be negated in many use cases
    - Fix coordinate system references for OIS reporting, add more information
    - Note that pixel centers at half-integers for the camera API metadata
      such as lens intrinsics

    Bug: 79371566
    Bug: 74434422
    Bug: 109742048
    Bug: 109834325
    Bug: 109817371
    Bug: 112107924
    Test: Manual reading of added text
    Change-Id: I450e80b79ef66ce8d82a4dee835db6abd1e598a3

commit 64439c1e8c93d9e929f2f9d901d1f523bc060aaf
Author: arangelov <arangelov@google.com>
Date:   Tue Jul 31 14:18:47 2018 +0100

    No disclaimer when switching profile for system SMS and dialer apps.

    This CL prevents the Toast message from showing when the following
    conditions are met:
    1. App is system app
    2. Intent action is either ACTION_DIAL or ACTION_CALL or if it is
    ACTION_SENDTO, only skip if data scheme is one of "sms:", "smsto:",
    "mms:" or "mmsto:".

    Bug: 111228250
    Test: atest FrameworksCoreTests:IntentForwarderActivityTest
    Change-Id: Idef71ff2928e9e3d72bad4ba8ff17f9306e91d25

commit 7e88efed125070c46cf26b38f1b4c6947ed83725
Merge: 41d65928f05 9d80381ad8b
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Thu Aug 2 03:04:24 2018 +0000

    Snap for 4927333 from 9d80381ad8b4217a42ff47f2161d8ba95e407701 to pi-qpr1-release

    Change-Id: I582ac2a7c5235e110cd0d30387351ea113c18933

commit 9d80381ad8b4217a42ff47f2161d8ba95e407701
Merge: ae3f6561466 e3834650856
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Aug 1 23:19:52 2018 +0000

    Merge "Set initial KSV state after inflation" into pi-dev

commit d967f8210c2a9d969ace3e7c1e4ef8595ceb97b1
Author: Amin Shaikh <ashaikh@google.com>
Date:   Tue Jun 19 17:58:35 2018 -0400

    Do not restart tethering while enabling tethering.

    Change-Id: I64194cfbcf830d867593681ab960fea0213ef24a
    Fixes: 110303540
    Test: manual
    (cherry picked from commit aa4735f69c2009128fe38823040a2037ebe577c5)

commit ae3f6561466542804aa69e7e2dcecedf37c20511
Merge: 63e36667da7 e27c3511d87
Author: Laura Davis <laurabd@google.com>
Date:   Wed Aug 1 17:47:04 2018 +0000

    Merge "Docs: fixed typo and made minor edits" into pi-dev

commit 63e36667da78e6edc0959e05e1c8cdf461dac8ef
Merge: 614e26dbcba 42d27af0daf
Author: Laura Davis <laurabd@google.com>
Date:   Wed Aug 1 17:46:37 2018 +0000

    Merge "Docs: fixed typo" into pi-dev

commit 2ea8e0b31faab0e59e92f2c8bb8a73022de2ebd5
Author: Ecco Park <eccopark@google.com>
Date:   Mon Jul 23 15:53:10 2018 -0700

    wifi.proto: Add metric for installed passpoint profile type

    Bug: 111473296
    Test: Unit Tests

    Merged-In: Ia6c6641697ecea1a51d7931d5f0f5b25963ae198
    Change-Id: Ia6c6641697ecea1a51d7931d5f0f5b25963ae198
    Signed-off-by: Ecco Park <eccopark@google.com>

commit 6064a17fa40fc73888a445958c660d942c557d8e
Author: Janis Danisevskis <jdanis@google.com>
Date:   Tue Jun 5 18:47:23 2018 -0700

    Fix symmetric key generation in strongbox

    The strongbox flag was not passed to keystore by
    AndroidKeyStoreKeyGeneratorSpi. As a result keys, that were supposed to
    be generated in strongbox would silently be generated in TEE.

    Test: There is no reliable way to test this other than instrumenting or
          debugging the strongbox implementation. This was done by the
          author of this patch.
    Bug: 109769728
    Change-Id: I8a08838440030fab7b774762c3d6af0d3b6a4ad8
    Merged-In: I8a08838440030fab7b774762c3d6af0d3b6a4ad8

commit 41d65928f051505d84715a619d121b04da5996cc
Merge: 77347d02d0d 614e26dbcba
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Tue Jul 31 03:02:51 2018 +0000

    Snap for 4922203 from 614e26dbcba08f0a10ae97293c4bc45622556e0e to pi-qpr1-release

    Change-Id: Ic6695fc3f1490070cc8a83312beef7d4aee9c7f8

commit e27c3511d8720bfb00feda5fcc9fb7204d98f586
Author: Laura Davis <laurabd@google.com>
Date:   Thu Jul 26 15:21:45 2018 -0700

    Docs: fixed typo and made minor edits

    Test: make ds-docs

    Bug: 111734031
    Bug: 111734470
    Change-Id: Ic120368fef0c0673ce954cdf0927a4705b3edcd2

commit 614e26dbcba08f0a10ae97293c4bc45622556e0e
Merge: 69556e89f30 259ca36bb0f
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 30 17:16:20 2018 +0000

    Merge "Work profile without password shouldn't be locked." into pi-dev

commit 69556e89f308d22c57fc8ecf45f9445d471c7cc7
Merge: f5940ac5283 b9504e591a6
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 23:32:29 2018 -0700

    Merge changes from topic "am-c65d7988-0ca0-4757-9d9c-21f4575eec01" into oc-dev am: 515700b4fe am: c93b474752
    am: b9504e591a

    Change-Id: I2b24a15f259b6c587e9bfc4fa01b4a8aa888f75a

commit f5940ac5283dcb6848443455b50e79dc6bd7b146
Merge: 105d24717fc ff99070f785
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 23:24:16 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1c484c5d96 skipped: b71941c9bb am: 976bb372c3  -s ours am: 27c3ba01ff  -s ours
    am: ff99070f78  -s ours

    Change-Id: I52d966e5fe7a7e6d0c3ee6c0df4d424c0d7f59ff

commit b9504e591a668b6151a33c04cea6d0421c20d5b8
Merge: ff99070f785 c93b4747524
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 23:04:31 2018 -0700

    Merge changes from topic "am-c65d7988-0ca0-4757-9d9c-21f4575eec01" into oc-dev am: 515700b4fe
    am: c93b474752

    Change-Id: I94c7b1d7e9bda726390fc5ceba62f8286a06bc42

commit 105d24717fc5aec581299f7a0d9d2e90a7bf0bab
Merge: 424d01398b0 ab2d9d3e375
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:59:05 2018 -0700

    Merge changes from topic "am-1155d171-2145-4903-8420-80ecfd6c6b08" into oc-dev am: d0025407df am: 0834c94a93
    am: ab2d9d3e37

    Change-Id: Ib76a04e7bab429bbdcfee69bb0240feaf154d1d2

commit ff99070f7858d1c45d1f6822c936efe7ad875e73
Merge: ab2d9d3e375 27c3ba01ff9
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:58:06 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1c484c5d96 skipped: b71941c9bb am: 976bb372c3  -s ours
    am: 27c3ba01ff  -s ours

    Change-Id: Id3d12a61dbf1a9e7eeabf1c12c39b8aa43ffe52b

commit 424d01398b00e26fbd04a2a738236f6f42883312
Merge: dce81b39c75 3b822cd0777
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:51:02 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f9a5e160d0 skipped: eff2a7b637 am: 70ebabc63d  -s ours am: 786ae0d322  -s ours
    am: 3b822cd077  -s ours

    Change-Id: I50130dce613f0c7e4a596ea9dcde87de43d02fc6

commit ab2d9d3e3753886c4ab2157ebfbba655038e89c5
Merge: 3b822cd0777 0834c94a931
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:46:54 2018 -0700

    Merge changes from topic "am-1155d171-2145-4903-8420-80ecfd6c6b08" into oc-dev am: d0025407df
    am: 0834c94a93

    Change-Id: I82eb8a2dfab9d3ce1d7b8de91950d9c2069da2db

commit c93b474752483e7e99e63709f8511ca76c235680
Merge: 27c3ba01ff9 515700b4feb
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:43:33 2018 -0700

    Merge changes from topic "am-c65d7988-0ca0-4757-9d9c-21f4575eec01" into oc-dev
    am: 515700b4fe

    Change-Id: I0f58a9fe2bb437e8caf854b4ca8f5c4bc0f10c7d

commit 27c3ba01ff9f08abc56beca2b86d5322c14bfc04
Merge: 0834c94a931 976bb372c3b
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:41:40 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1c484c5d96 skipped: b71941c9bb
    am: 976bb372c3  -s ours

    Change-Id: I971275a90e048fec4861d2e866ec53c5d1b0a356

commit 3b822cd07776d06b3166541837fa109e630431bb
Merge: acdedf31226 786ae0d3226
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:40:28 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f9a5e160d0 skipped: eff2a7b637 am: 70ebabc63d  -s ours
    am: 786ae0d322  -s ours

    Change-Id: I1a741c23da3317c1b711a1a58cbf23bc4e97837e

commit dce81b39c751110277d7d33447c1de6a3740bed8
Merge: 11768fd80fe acdedf31226
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:22:52 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 4c781e19f5 skipped: b3e44fae1f am: 843fb76d1f  -s ours am: ffe456e49c  -s ours
    am: acdedf3122  -s ours

    Change-Id: I61f0ab91a21552f0dc61c7173a971aa07bef88aa

commit acdedf312261339dee722d9c2a984703e163bf8e
Merge: 64cb4be8878 ffe456e49c1
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:19:49 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 4c781e19f5 skipped: b3e44fae1f am: 843fb76d1f  -s ours
    am: ffe456e49c  -s ours

    Change-Id: Ifc2aceed944b28d1a9d923f01eb92ab374d67d6b

commit 0834c94a931a9ede373ce822b3cebf02f029adfb
Merge: 786ae0d3226 d0025407dfb
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:18:03 2018 -0700

    Merge changes from topic "am-1155d171-2145-4903-8420-80ecfd6c6b08" into oc-dev
    am: d0025407df

    Change-Id: I7186be0877b4649e3246a05ea610c7c5ee75e542

commit 786ae0d32260c0c42c13b4cc3cf07ef9ccc92494
Merge: ffe456e49c1 70ebabc63d0
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:15:41 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f9a5e160d0 skipped: eff2a7b637
    am: 70ebabc63d  -s ours

    Change-Id: I06839e68100abc88459588a4fec9ef4e04f65c08

commit cfc6d8607e2b3f4b7c91eba5e20e5c6cc16de91f
Merge: 1f2e1df6c7f b71941c9bb8
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 30 05:14:30 2018 +0000

    Merge changes from topic "am-c65d7988-0ca0-4757-9d9c-21f4575eec01" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 1c484c5d96
      Import translations. DO NOT MERGE

commit 23162a8897fe2cefa0e090ba7785adc75cc10c67
Merge: 36b8d424481 1c484c5d961
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 30 05:14:30 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 515700b4feb35ac615c8ca38165f629a67c4d99f
Merge: d0025407dfb 976bb372c3b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 30 05:14:30 2018 +0000

    Merge changes from topic "am-c65d7988-0ca0-4757-9d9c-21f4575eec01" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 1c484c5d96 skipped: b71941c9bb
      [automerger skipped] Import translations. DO NOT MERGE skipped: 1c484c5d96
      Import translations. DO NOT MERGE

commit ffe456e49c1ecd4a2220b8c6cd96610386a6a7c7
Merge: dccb62bcca2 843fb76d1f9
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 22:10:47 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 4c781e19f5 skipped: b3e44fae1f
    am: 843fb76d1f  -s ours

    Change-Id: Id1336208575063e2fe1231b7655731132beb7953

commit d0025407dfb8b601f154c433459abd199f4191ff
Merge: 843fb76d1f9 70ebabc63d0
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 30 05:04:27 2018 +0000

    Merge changes from topic "am-1155d171-2145-4903-8420-80ecfd6c6b08" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: f9a5e160d0 skipped: eff2a7b637
      [automerger skipped] Import translations. DO NOT MERGE skipped: f9a5e160d0
      Import translations. DO NOT MERGE

commit 1f2e1df6c7f983819daadff67ec7b60eae7728f6
Merge: b3e44fae1f8 eff2a7b637e
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 30 05:04:27 2018 +0000

    Merge changes from topic "am-1155d171-2145-4903-8420-80ecfd6c6b08" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: f9a5e160d0
      Import translations. DO NOT MERGE

commit 36b8d4244813bba27d4da5e7034c9f840d1d01d0
Merge: 4c781e19f54 f9a5e160d08
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 30 05:04:27 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 77347d02d0d0a12094f21201d42046834c5d0d53
Merge: 5d8a3bba4c1 11768fd80fe
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Mon Jul 30 03:06:36 2018 +0000

    Snap for 4920102 from 11768fd80fe62e66df0651b3301315afeb234abb to pi-qpr1-release

    Change-Id: I0775c09c2847d4251dd414019b3d3f4ba0a5b76a

commit 843fb76d1f9793822690b6a62fbc9496c8917543
Merge: e43837e258a b3e44fae1f8
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jul 29 15:53:30 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 4c781e19f5 skipped: b3e44fae1f

    Change-Id: I877e44ea6efe845c0c30a3280b512c1253d727ce

commit b3e44fae1f841c94813450eaaf2f2cd26fd16ccf
Merge: d6143e93077 4c781e19f54
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jul 29 15:53:26 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 4c781e19f5

    Change-Id: Ib62c14bc0bb4d205821e8f3b6312c5dca7773fde

commit 4c781e19f54316a40fc336469e62a23c7669b274
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 08:53:11 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I556f15b9dc9c144d1ddd3bee21f823a52afdfbf4
    Auto-generated-cl: translation import

commit 976bb372c3b70d37f5336c32faeca09df524f5c2
Merge: e43837e258a b71941c9bb8
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jul 29 15:40:55 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1c484c5d96 skipped: b71941c9bb

    Change-Id: I5326a09d8328b9767c6420e08e59374910b3ce49

commit b71941c9bb88f38fcd7d570ecf92d01fbce69e12
Merge: d6143e93077 1c484c5d961
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jul 29 15:40:50 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1c484c5d96

    Change-Id: I5f7b6e78d38bebadba08ce1e2d18302f5e7464ee

commit 1c484c5d9610717cc40489098f80bffdd8c92aa3
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 08:40:30 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I544bbffa43bdf203519441dd1d1b66b54bb54238
    Auto-generated-cl: translation import

commit 70ebabc63d084509e6c79429cf9bb87b63fe5eaa
Merge: e43837e258a eff2a7b637e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jul 29 14:41:02 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: f9a5e160d0 skipped: eff2a7b637

    Change-Id: Ib22e9ba37dcb69862e8f4c46577e8c240c429c6c

commit eff2a7b637eea4dc843969ea9c506b9d9e729e51
Merge: d6143e93077 f9a5e160d08
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jul 29 14:40:54 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: f9a5e160d0

    Change-Id: Ic133994f8f27708e96772601a2dcb5e6173dae28

commit f9a5e160d08810a2e70281416ea9db7e0f937fc7
Author: Bill Yi <byi@google.com>
Date:   Sun Jul 29 07:40:09 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I2ae5687befc9fd492b9baa7a5ca0bc674a30ebb2
    Auto-generated-cl: translation import

commit 11768fd80fe62e66df0651b3301315afeb234abb
Merge: e8b7b306723 926f7d815cc
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 27 23:03:19 2018 +0000

    Merge "Don't flash system bars while showing an immersive app on lockscreen" into pi-dev

commit e8b7b3067230592b5fc31c22018b2154eb03d634
Merge: 5ad001eb4f5 8fec01a1415
Author: Winson Chung <winsonc@google.com>
Date:   Fri Jul 27 20:44:17 2018 +0000

    Merge "Revert to O home button behaviour for over lockscreen activities" into pi-dev

commit 42d27af0daf4c01022e4c6466d81f7fb6ff18191
Author: Laura Davis <laurabd@google.com>
Date:   Fri Jul 27 12:07:27 2018 -0700

    Docs: fixed typo

    Test: make ds-docs

    Bug: 111817624
    Change-Id: I908e06419ab56220b41be6f821cff3258691b3b9

commit 259ca36bb0f5e1060af63e2fa331af15964ebc12
Author: Pavel Grafov <pgrafov@google.com>
Date:   Fri Jul 27 14:04:57 2018 +0100

    Work profile without password shouldn't be locked.

    NB: there are two functions named setDeviceLockedForUser,
    one that is called from refreshDeviceLockedForUser is NOT
    changed in this CL.

    Currently setDeviceLockedForUser is called for a work profile
    with separate challenge in the following cases
    1) with "true" when it gets locked (screen off or timeout) or
    2) with "false" when the user solves work challenge

    The 2nd case never happens if work challenge is empty,
    since there is nothing to show to the user, so
    mDeviceLockedForUser is set to "true" for the profile.
    refreshDeviceLockedForUser funciton doesn't change values
    for work profiles so it remains "true" forever. In addition
    if the value is absent in the map, isDeviceLocked defaults
    to "true". This way for those profiles it always returns
    "true" to Quickstep/Overview which causes the bug.

    This CL changes this behavior in two ways:

    1) refreshDeviceLockedForUser now sets the value to "false"
    for managed profiles that have separate but empty challenge.
    This method is called early enough after reboot and for every
    credential change, so it updates the value promptly.
    2) setDeviceLocked for those profiles becomes no-op.

    This way "false" is maintained in mDeviceLockedForUser.

    For profiles with nonempty (both unified and separate)
    challenge the behavior is unchanged.

    Another probably more efficient approach would be to initialize
    it to "false" for those profiles early enough and track whether
    challenge becomes empty, but that seems more risky as it adds
    new logic to boot phases and would require a call from
    LockSettingsService or similar. This seems too risky at this point.

    Test: manual, tried locking, unlocking, rebooting in all four
    possible states and transitions between them:
    1) Challenge can be separate or unified
    2) Independently it can be empty or nonempty
    Bug: 111838890
    Change-Id: I189035ccd773b1cafed335bceff171a6c42b767f

commit 5d8a3bba4c1132e60477010e99a36139bb1a9fac
Merge: 3d3c6531e19 5ad001eb4f5
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Jul 27 03:13:32 2018 +0000

    Snap for 4916303 from 5ad001eb4f5152cf8d534608ebd2d369e383e8b9 to pi-qpr1-release

    Change-Id: Ib3033bf0876b52d2d579359681ff542d0bf34b7d

commit 7d9a33efb75f949750c4dff9d7a5bb475b1047e4
Author: Hall Liu <hallliu@google.com>
Date:   Wed Jul 25 18:48:55 2018 -0700

    Add carrier config for auto redialing 911

    Bug: 111235453
    Test: manual (modify IMS stack locally to always return the 380 error
    when dialing in airplane mode)

    Change-Id: I029d2227ce62bb11fa91e9d5338a667d6e3dd59b

commit 8fec01a1415e7ae54df587c36dfdc94daa270557
Author: Winson Chung <winsonc@google.com>
Date:   Thu Jul 26 14:00:22 2018 -0700

    Revert to O home button behaviour for over lockscreen activities

    - Reverting specific changes from ag/3458963

    Bug: 111789245
    Test: Launch camera, hit home
    Change-Id: Ib0fe79dbe125e418193f991f22d09777e2bbc3bb

commit 5ad001eb4f5152cf8d534608ebd2d369e383e8b9
Author: kopriva <kopriva@google.com>
Date:   Mon Jul 23 18:19:39 2018 -0700

    docs: added Android P behavior change note to untagSocket reference

    staged here:
    https://android-dot-devsite.googleplex.com/reference/android/net/TrafficStats#untagSocket(java.net.Socket)

    Test: make ds-docs

    Exempt-From-Owner-Approval: Docs-only change

    Bug: 110484513
    Change-Id: I24575e6f4451a019b60c5bf60e17e14a928c6cc3

commit 926f7d815cc33d2b2c86a78d111c386cf758fc10
Author: Tiger Huang <tigerhuang@google.com>
Date:   Fri Jun 29 15:26:52 2018 +0800

    Don't flash system bars while showing an immersive app on lockscreen

    Before applying this patch, when a show-when-locked immersive app is
    showing, the system bars would quickly show and hide, which are
    redundant to the user.

    The root cause is that, for nav bar, we have a policy to show nav bar
    if the width and height of status bar are MATCH_PARENT and status bar
    has no PRIVATE_FLAG_KEYGUARD. When keyguard is becoming status bar,
    its keyguard flag would be removed first, and then the height would
    be changed to the bar height. So the nav bar would be shown between
    these events. For status bar, we force showing it when it is expanded
    by checking its width and height are MATCH_PARENT or not.

    To fix the issue, this change introduces a new private flag which
    indicates that the status bar window is now in an explicit expanded
    state. We check this flag instead of checking the width and height of
    status bar.

    This change also fix a bug that: when AOD is enabled, if the
    foreground app has FLAG_SHOW_WHEN_LOCKED, FLAG_TURN_SCREEN_ON, and
    FLAG_FULLSCREEN, clicking on the power key would make it show the app
    again instead of AOD. (not 100%, but chances)

    Bug: 80147982
    Test: 1. go/wm-smoke
          2. Launch a show-when-locked turn-screen-on immersive app on
             AOD, and see if any system bar flashes.
          3. Launch a show-when-locked turn-screen-on immersive app on
             lockscreen, and see if any system bar flashes.
          4. a. Enable AOD in Settings.
             b. Open a show-when-locked turn-screen-on immersive app.
             c. Click on power key, and see if AOD shows.
          5. Launch an immersive app and drag down the status bar, see
             if nav bar keeps there as long as status bar is expanded.

    Change-Id: Ie885d504eb73ae8a86736b2c3ed4fb03eb9f739e
    Merged-In: Ie885d504eb73ae8a86736b2c3ed4fb03eb9f739e
    (cherry picked from commit 3404601e073ee2fb7867e3aa50a730bcf51eda07)

commit b0e3c67824cd68812ca0dd92bc84358c6a57c733
Merge: c63d09990a6 879fb6886b1
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 25 20:56:37 2018 +0000

    Merge "Try harder to find a camera app to pin." into pi-dev

commit c63d09990a6ce2853c43b905ecf03ff7be7486f6
Merge: 772c197912d 4bcf9b8ac78
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 25 20:51:31 2018 +0000

    Merge "Improve isolation of DND providers" into pi-dev

commit 772c197912def927ebfab8b37fe8a059bd87fd19
Merge: 447b8b6394a 0610dd18341
Author: Calin Juravle <calin@google.com>
Date:   Wed Jul 25 19:55:09 2018 +0000

    Merge "Annotate the compilation reason with dex metadata information" into pi-dev

commit 447b8b6394abb198f98a901e2848c2cd8af125d2
Merge: 693a915de8e 5c704e6deb1
Author: Andrew Solovay <asolovay@google.com>
Date:   Wed Jul 25 18:57:58 2018 +0000

    Merge "docs: Updating setDomainSuffixMatch() for Android P" into pi-dev

commit 5c704e6deb1f975ce2deef3d0dce1b1455dc1067
Author: Andrew Solovay <asolovay@google.com>
Date:   Mon Jul 23 15:00:25 2018 -0700

    docs: Updating setDomainSuffixMatch() for Android P

    Small update to reflect P-related change (that common-name verification
    is no longer supported), per
    https://android-dot-devsite.googleplex.com/about/versions/p/android-9.0-changes#certificate-common-name

    Also added some missing paragraph breaks while I was doing it.

    Doc is staged to:

    http://go/dac-stage/reference/android/net/wifi/WifiEnterpriseConfig#setDomainSuffixMatch(java.lang.String)

    Exempt-From-Owner-Approval: Docs-only change
    Bug: 110483059
    Test: make ds-docs
    Change-Id: I50b6eb70bf16c17dd0ae4e54711c5bb599c47c1a

commit 4bcf9b8ac78e5089a38cb68d907a25984de472eb
Author: Julia Reynolds <juliacr@google.com>
Date:   Fri Jul 13 15:12:29 2018 -0400

    Improve isolation of DND providers

    Specifically, a change in state from one DND provider
    shouldn't result in another's state being cleared if they
    aren't yet bound (or are intentionally unbound).

    Fixes: 111251709
    Test: cts, cts-verifier

    Change-Id: I42a0ba935577e708d9df02e2a6d3620e42395a51
    (cherry picked from commit 8f05600189b1fbd3953cfcbead03e748394eb2e3)

commit 693a915de8e5d00efa76d75397fdfc52883172b6
Merge: 9352e362d1a fc22296ff5e
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 25 00:49:42 2018 +0000

    Merge "Fixed an issue where the keyguard statusbar could be showing" into pi-dev

commit 9352e362d1afbecf055113d3bacea53d4fa1b101
Merge: aa7766b4d49 dcb24ca4713
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 25 00:48:12 2018 +0000

    Merge "WM: Guard against released surfaces in forced rotator" into pi-dev

commit 879fb6886b1917179deda95a9f0ceff20ad82c8a
Author: Carmen Jackson <carmenjackson@google.com>
Date:   Fri Jul 20 16:43:09 2018 -0700

    Try harder to find a camera app to pin.

    Currently, the pinner service pins whatever Camera app is being pointed
    to by MediaStore.INTENT_ACTION_STILL_IMAGE_CAMERA. This change updates
    that logic to try pinning whatever is in
    MediaStore.INTENT_ACTION_STILL_IMAGE_CAMERA_SECURE if the first intent
    doesn't exist. If neither of those resolve to a single target, this
    change reviews the targets in
    MediaStore.INTENT_ACTION_STILL_IMAGE_CAMERA and pins the Camera app with
    the System flag, making the assumption that the System app is the one
    that we'd want to pin if the user hasn't resolved the intent manually.

    Bug: 111655213
    Test: Results show from just after boot, with logging added to ensure all code paths are covered

    Two camera apps installed (Snapchat chosen by manually resolving the double-tap intent).
    Two launchers installed (Nova Launcher chosen by selecting it in Settings)

    07-24 21:45:38.014  1158  6329 E carmen  : getting application info for intent: Intent { act=android.intent.action.MAIN cat=[android.intent.category.HOME] flg=0x100 } defaultToSystemApp false
    07-24 21:45:38.014  1158  6329 E carmen  : only one app for this intent: ResolveInfo{f871a08 com.teslacoilsw.launcher/.NovaLauncher m=0x108000}
    07-24 21:45:38.014  1158  6329 E carmen  : getting application info for intent: Intent { act=android.media.action.STILL_IMAGE_CAMERA } defaultToSystemApp false
    07-24 21:45:38.014  1158  6329 E carmen  : only one app for this intent: ResolveInfo{a4b5a1 com.snapchat.android/.LandingPageActivity m=0x108000}

    $ adb shell dumpsys pinner

    Camera uid=10162 active=false
      /data/app/com.snapchat.android-TXaPziuyDrKJhSP_OsPBhQ==/base.apk 76214272
      /data/app/com.snapchat.android-TXaPziuyDrKJhSP_OsPBhQ==/oat/arm/base.vdex 57143296
      /data/app/com.snapchat.android-TXaPziuyDrKJhSP_OsPBhQ==/oat/arm/base.odex 1462272
    Home uid=10160 active=false
      /data/app/com.teslacoilsw.launcher-RxwR4RYHwo8fCUIe3yRTtA==/base.apk 6291456
      /data/app/com.teslacoilsw.launcher-RxwR4RYHwo8fCUIe3yRTtA==/oat/arm64/base.vdex 5488640
      /data/app/com.teslacoilsw.launcher-RxwR4RYHwo8fCUIe3yRTtA==/oat/arm64/base.odex 131072
    Total size: 246603776

    Two camera apps installed, neither resolved (double tapping power key shows disambiguation dialog).
    Two launchers installed (Pixel Launcher chosen by selecting it in Settings)
    Then reboot:

    07-24 21:51:34.319  1186  6132 E carmen  : getting application info for intent: Intent { act=android.intent.action.MAIN cat=[android.intent.category.HOME] flg=0x100 } defaultToSystemApp false
    07-24 21:51:34.319  1186  6132 E carmen  : only one app for this intent: ResolveInfo{bb98d44 com.google.android.apps.nexuslauncher/.NexusLauncherActivity m=0x108000}
    07-24 21:51:34.319  1186  6132 E carmen  : getting application info for intent: Intent { act=android.media.action.STILL_IMAGE_CAMERA } defaultToSystemApp false
    07-24 21:51:34.319  1186  6132 E carmen  : returning null
    07-24 21:51:34.319  1186  6132 E carmen  : getting application info for intent: Intent { act=android.media.action.STILL_IMAGE_CAMERA_SECURE } defaultToSystemApp false
    07-24 21:51:34.319  1186  6132 E carmen  : only one app for this intent: ResolveInfo{da40e2d com.google.android.GoogleCamera/com.android.camera.SecureCameraActivity m=0x108000}

    $ adb shell dumpsys pinner
    Camera uid=10131 active=false
      /data/app/com.google.android.GoogleCamera-03j4UhJ73NQ42OkVl_VgHw==/base.apk 70901760
      /data/app/com.google.android.GoogleCamera-03j4UhJ73NQ42OkVl_VgHw==/oat/arm64/base.vdex 12369920
      /data/app/com.google.android.GoogleCamera-03j4UhJ73NQ42OkVl_VgHw==/oat/arm64/base.odex 249856
    Home uid=10059 active=false
      /system/priv-app/NexusLauncherPrebuilt/NexusLauncherPrebuilt.apk 5664768
      /data/dalvik-cache/arm64/system@priv-app@NexusLauncherPrebuilt@NexusLauncherPrebuilt.apk@classes.vdex 36864
      /data/dalvik-cache/arm64/system@priv-app@NexusLauncherPrebuilt@NexusLauncherPrebuilt.apk@classes.dex 90112
    Total size: 189186048

    Commenting out the _SECURE intent check, with two camera apps and neither one chosen:
    07-24 22:18:31.314  1174  1198 E carmen  : getting application info for intent: Intent { act=android.intent.action.MAIN cat=[android.intent.category.HOME] flg=0x100 } defaultToSystemApp false
    07-24 22:18:31.314  1174  1198 E carmen  : only one app for this intent: ResolveInfo{e4399e1 com.google.android.apps.nexuslauncher/.NexusLauncherActivity m=0x108000}
    07-24 22:18:31.350  1174  1198 E carmen  : getting application info for intent: Intent { act=android.media.action.STILL_IMAGE_CAMERA } defaultToSystemApp false
    07-24 22:18:31.351  1174  1198 E carmen  : returning null
    07-24 22:18:31.351  1174  1198 E carmen  : getting application info for intent: Intent { act=android.media.action.STILL_IMAGE_CAMERA } defaultToSystemApp true
    07-24 22:18:31.351  1174  1198 E carmen  : multiple apps for this intent, choosing system app: ApplicationInfo{845c229 com.google.android.GoogleCamera}

    $ adb shell dumpsys pinner
    Camera uid=10131 active=false
      /data/app/com.google.android.GoogleCamera-03j4UhJ73NQ42OkVl_VgHw==/base.apk 70901760
      /data/app/com.google.android.GoogleCamera-03j4UhJ73NQ42OkVl_VgHw==/oat/arm64/base.vdex 11657216
      /data/app/com.google.android.GoogleCamera-03j4UhJ73NQ42OkVl_VgHw==/oat/arm64/base.odex 397312
    Home uid=10059 active=true
      /system/priv-app/NexusLauncherPrebuilt/NexusLauncherPrebuilt.apk 5664768
      /data/dalvik-cache/arm64/system@priv-app@NexusLauncherPrebuilt@NexusLauncherPrebuilt.apk@classes.vdex 36864
      /data/dalvik-cache/arm64/system@priv-app@NexusLauncherPrebuilt@NexusLauncherPrebuilt.apk@classes.dex 90112
    Total size: 188616704

    Change-Id: Ib90c91ac394adf269aaa8d3603af84a9ad4375f9

commit fc22296ff5eefb328b4cddb9ee16b2bf38d7bc6b
Author: Selim Cinek <cinek@google.com>
Date:   Fri Jul 20 20:09:23 2018 -0700

    Fixed an issue where the keyguard statusbar could be showing

    Test: unlock with AoD on with fingerprint, pull down shade.
    Change-Id: I9a5f0f1ae9880f048a3655f5199106cdda03eba5
    Fixes: 111127399

commit aa7766b4d4990bc80764f942ee49ad7ba8d6334b
Merge: 5d0af8d3573 51810d56f38
Author: Selim Cinek <cinek@google.com>
Date:   Tue Jul 24 14:55:11 2018 +0000

    Merge "Fixed a bug where the shelf could be stuck translating" into pi-dev

commit dcb24ca47138219f41b730af8cdcd2db8f553562
Author: Adrian Roos <roosa@google.com>
Date:   Mon Jul 23 15:07:11 2018 +0200

    WM: Guard against released surfaces in forced rotator

    Change-Id: Ibce67ccede8f114b82779a74853e43b3abe44c55
    Fixes: 111670701
    Test: Rotate phone with cutout enabled, verify cutout overlay is still properly synchornized and SystemUI does not crash.

commit 5d0af8d357389f58add0c6001a6566f89d4609be
Merge: 8aa960f6b10 d8a884fa108
Author: Kumar Anand <kumaranand@google.com>
Date:   Mon Jul 23 22:52:38 2018 +0000

    Merge "WiFi: Add configs for SAR support of SoftAP" into pi-dev

commit 0610dd183418c40b999504fd985b33e024252ef9
Author: Calin Juravle <calin@google.com>
Date:   Fri Jul 20 15:51:17 2018 -0700

    Annotate the compilation reason with dex metadata information

    Test: manual, adb logcat -b events | grep sysui_multi_action
    Bug: 111699831

    (cherry picked from commit 4103281f5eaa072342f36637f7950b5ba456875b)

    Merged-In: I9ae1f802404e5d1af50b060c448913153abc3ba4
    Change-Id: I7eec1e3113696a86d098295bda3c46c5d5bf903a

commit 8aa960f6b107d68f6dd3109381a345940f5b91c4
Merge: 15cbfefb03a d3a87062eec
Author: Chiachang Wang <chiachangwang@google.com>
Date:   Mon Jul 23 02:36:10 2018 +0000

    Merge "Push DNS configuration on network validation" into pi-dev

commit 15cbfefb03ae72f4d347458ec67c4ab82caf428c
Merge: 0587bdd59f8 a5c3fb10f25
Author: Chiachang Wang <chiachangwang@google.com>
Date:   Mon Jul 23 01:44:51 2018 +0000

    Merge "DO NOT MERGE: use legacy way to get tcp packet count" into pi-dev

commit 0587bdd59f8892871e1137d6a5d428380df4a6af
Merge: 228bf4f3203 b3a81a1fad8
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Sat Jul 21 00:59:59 2018 +0000

    Merge "Fix a NPE in BatteryStatsImpl" into pi-dev

commit 51810d56f38188dc884f831c51fc24dbbb8499f1
Author: Selim Cinek <cinek@google.com>
Date:   Fri Jul 20 17:54:48 2018 -0700

    Fixed a bug where the shelf could be stuck translating

    Because we were reusing the existing translation, we could
    get stuck in a bad state.

    Test: unlock right during the locking motion where the icons appear.
    Change-Id: I0e25836a983d67a6bc27475dda90d9b3404dac27
    Fixes: 111551574

commit 228bf4f32036e7d9af3c80fd4b4c997688fc1e6f
Merge: edb7637654a 0c37f926e6a
Author: Siyamed Sinir <siyamed@google.com>
Date:   Fri Jul 20 22:58:43 2018 +0000

    Merge "Remove requirement for kiss emoji should have gender" into pi-dev

commit edb7637654afd8d08498ca62de166e5be2c5f2d4
Merge: 952acb2ceb6 4a4c17bd75d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 21:39:06 2018 +0000

    Merge "Make Recents onboarding less aggressive." into pi-dev

commit fde947837c848b51a830b74b28f96f9808405492
Author: Hongming Jin <hongmingjin@google.com>
Date:   Tue Jun 19 12:35:37 2018 -0700

    RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package.

    Bug: 67319274
    Test: run cts-dev --module CtsPermissionTestCases --test android.permission.cts.RemovePermissionTest#permissionShouldBeRevokedIfRemoved
    Change-Id: Id23535d6c4d2fcf5c86dc1338af13a561b32154c

commit 952acb2ceb69efb92f4c1ed1fd5648c7544bd423
Merge: 1b3b966afcd bdbb9e18f4a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:42:37 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit 1b3b966afcdb024b0b6fc95f0d1bfcc85b88cc5a
Merge: b862d624cf2 31b17bcd8d6
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:41:20 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit b862d624cf223714fa2ccd1e10fdaade5c634e0d
Merge: 71cf7adf805 0453230e18d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:28:49 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit 71cf7adf805b0a6337aa2ccc001b5bc9bfb43e75
Merge: f4ffb02e21c 1ebed6c6a88
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:24:14 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit f4ffb02e21c224650e809a52ce6195811883811c
Merge: 705292355ea cf17f70ab9d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:23:33 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit 705292355ea35f1954e9534d47f3bd5cb738fa9b
Merge: 56bb0b72190 6b9cf4fd5c8
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:21:37 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit 1ebed6c6a8817d552856440e84ac54094e15ca71
Author: Bill Yi <byi@google.com>
Date:   Fri Jul 20 10:03:48 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: I41d34c587e13dc69f9dfe253f88b08a6a6c127c7

commit 31b17bcd8d6473161f2fc406a707f2743ce4cadb
Author: Bill Yi <byi@google.com>
Date:   Fri Jul 20 08:07:01 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: Ie0f93184e2d531e523fa029e7fb354d06fa1b199

commit bdbb9e18f4af45489505a5b7e6f39ca2b84c450a
Author: Bill Yi <byi@google.com>
Date:   Fri Jul 20 07:59:45 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: Icde2664f6b4d13a40d38bfe0a1ad51214506457f

commit cf17f70ab9d0e6d773541ed7e9a14c772dbab90a
Author: Bill Yi <byi@google.com>
Date:   Fri Jul 20 07:52:44 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: I7c460571c761166c1c3ed8a6d3ff1461ece96a9f

commit 6b9cf4fd5c8faece78361ac909a9d41efcab0a6e
Author: Bill Yi <byi@google.com>
Date:   Fri Jul 20 05:44:22 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: I381f16450d501059c8ca07a6ece058bd476003bb

commit 0453230e18d9e4b26b51fdcfd7be84c37d47662b
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 19 17:52:07 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: Id42ee657b863d89294c4d6f77c4823e7ba463bc6

commit 56bb0b7219059d15eb1ed0fb16154f3ab5499d21
Author: Jinguang Dong <dongjinguang@huawei.com>
Date:   Tue Jul 17 11:53:18 2018 +0800

    Ensure dropbox could copy tombstone files to special folder.

    Process of tombstoned have changed the generation flow for
    tombstone, and dropbox could not be notified when generating new
    tombstone file any more, so dropbox could not copy and compress
    tombstone file to /data/system/dropbox. We need to modify
    observer events from CLOSE_WRITE to CREATE, and it could
    work normally.

    Bug: http://b/111608961
    Test: 1 After tombstone is triggered, we could see the tombstone
          file in the data/system/dropbox directory.

    Signed-off-by: Haoran Li <lihaoran5@huawei.com>

    Change-Id: I9d6a31773e4a58658ffab214b1e337f27e9f3ae6
    (cherry picked from commit fe8d2c9a8c86bc842871129600ad9fbbb9b60ab3)

commit a2405766db1ef38ed71ba4a84746bd8116e59661
Author: Todd Kennedy <toddke@google.com>
Date:   Wed Jul 18 06:57:33 2018 -0700

    RESTRICT AUTOMERGE Relax security exception for backport

    The original backport for this bug threw an exception when the caller
    didn't hold the INTERACT_ACROSS_USERS permission; even when it queried
    for its own packages.

    Now, we simply ignore the request to match any user.

    Bug: 77821568
    Test: manual
    Change-Id: I5716b50a7fb18def20323b872ddef06fa9723b13

commit 821076440434443af4257c5ba0b7b1f037735041
Author: akirilov <akirilov@google.com>
Date:   Wed Jul 18 17:50:05 2018 -0700

    RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package.

    Bug: 67319274
    Test: run cts-dev --module CtsPermissionTestCases --test android.permission.cts.RemovePermissionTest#permissionShouldBeRevokedIfRemoved
    Change-Id: I2771c048e13529e168121c5a5501aa26fc21e30f

commit ecde0c2a39f6f20bb6753ab2c6cac313ee46a541
Merge: e43837e258a c565a7f7e2e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 19 21:29:40 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815 am: 9310c5bdd3 skipped: c565a7f7e2

    Change-Id: I04c37f5288e234f5eaafa436877fc9279c68bd05

commit c565a7f7e2ed714b375d9810dd792dda81adcc7e
Merge: d6143e93077 9310c5bdd36
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 19 21:29:33 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815 am: 9310c5bdd3

    Change-Id: I83e62233a15ffa1a02ac62e7d1323d342876756f

commit 9310c5bdd366b1c96bbdd94018e8a3196f8560d0
Merge: 47c831e6757 a491c048150
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 19 21:29:26 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7 am: a491c04815

    Change-Id: Id6b495855c7ca0d33aa965556546622bff487dcd

commit a491c048150732e893ac231d1a5ac10db0230ba8
Merge: 1bce1217ca1 7d252f5ed7b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 19 21:29:18 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb am: 7d252f5ed7

    Change-Id: I16ddc194ac2f38676e929f98aebf7776dcaeed53

commit 7d252f5ed7be8608721dee0a4b220f8d55cea299
Merge: 00b57fc9b76 fa69d725eb9
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 19 21:29:08 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package. am: fa69d725eb

    Change-Id: I7bfd11dd549f814b59742c7565c4a39ed3df66fe

commit fa69d725eb99b8c20a15135304bf5be4ea811573
Author: akirilov <akirilov@google.com>
Date:   Wed Jul 18 17:50:05 2018 -0700

    RESTRICT AUTOMERGE: Revoke permissions defined in a to-be removed package.

    Bug: 67319274
    Test: run cts-dev --module CtsPermissionTestCases --test android.permission.cts.RemovePermissionTest#permissionShouldBeRevokedIfRemoved
    Change-Id: I69edee8ed044cc2a8cdb01515f7996b004209c81

commit 0c37f926e6a83d4d24b2a8fe562a858b4c565eac
Author: Siyamed Sinir <siyamed@google.com>
Date:   Thu Jul 12 12:02:18 2018 -0700

    Remove requirement for kiss emoji should have gender

    Test: m fontchain_lint
    Test: m
    Test: Visual test on device after full build

    Bug: 110037531
    Change-Id: Iac26c7c7c0e1a8a500a93f19d99831113529b201
    (cherry picked from commit 77a1b149109d99ff2c73d1b8ba9a943e6961af48)

commit 3d3c6531e1933c48daa31bce894aab6cd2aedd31
Merge: c93ab691d37 c565700b94b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 19 16:12:17 2018 +0000

    Merge "Camera: hardware level related doc update" into pi-dev

commit c93ab691d37dd3492447b21dd0999226fd48f4df
Merge: f5d4ea61320 57d53712318
Author: Jason Monk <jmonk@google.com>
Date:   Wed Jul 18 23:56:54 2018 +0000

    Merge "Don't make Settings' content providers no release." into pi-dev

commit f5d4ea6132065a99927a47faaab4dd2fcedea6dd
Merge: 2f8a3a4bb8b ff129aefe2b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 18 23:39:26 2018 +0000

    Merge "Fix TextureView.getBitmap with scale layer transform" into pi-dev

commit 2f8a3a4bb8ba700321af9e050a95640f6ac60ce3
Merge: ca53cf7f9a0 7823ee73ee5
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Jul 18 21:47:59 2018 +0000

    Merge "Move allocateBuffers to RT" into pi-dev

commit 4a4c17bd75d6f657ae871257525a1a307535c707
Author: Tracy Zhou <tracyzhou@google.com>
Date:   Wed Jul 18 14:03:26 2018 -0700

    Make Recents onboarding less aggressive.

    Tip appears the 1st time - when user swipe up from home for 3 times & never gone into overview from app.
    Tip appears the 2nd time - if user "X" or ignores the 1st tip, we show it again after user opens 5 apps.
    Tip appears the 3rd time - if user "X" or ignores the 2nd tip, we show it again after user opens 40 apps. (before it was 10 apps)
    Tip never appears again - if user "X" or ignore the 3rd tip.

    Change-Id: I8077be8ef9ae3a45d8a6ae131cec8dc10a614bc1
    Fixes: 111413686
    Test: manual test

commit ca53cf7f9a0b234cc0a562e69f7d95f4e1c11c31
Merge: 31e9d9d32b4 cf845036e5c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 18 19:58:14 2018 +0000

    Merge "DO NOT MERGE: Use quick_qs_total_height when QS is not disabled" into pi-dev

commit d8a884fa10823fd5f4dd58db027552daf44d499b
Author: Ahmed ElArabawy <arabawy@google.com>
Date:   Thu Jul 12 14:11:45 2018 -0700

    WiFi: Add configs for SAR support of SoftAP

    This commit adds the configurations for support of SoftAP in
    SAR for WiFi.

    Bug: 65174506
    Test: Run Wifi unit test suite
    Test: ./frameworks/opt/net/wifi/tests/wifitests/runtests.sh

    Change-Id: I3c217b57790def0bd686109a2b2f882139b5bc5f
    Merged-In: I3c217b57790def0bd686109a2b2f882139b5bc5f

commit 57d537123186ba9ed8feb72bb52d60bcecddccbf
Author: Jason Monk <jmonk@google.com>
Date:   Wed Jul 18 10:44:10 2018 -0400

    Don't make Settings' content providers no release.

    Test: Settings no longer in memory
    Bug: 110985973
    Change-Id: I80570ad52cd986083d735c1b6c0d8b34d7feb58f

commit 31e9d9d32b445fb7c79753183e505fad06a6ad17
Merge: 9d77aaec850 0c84996a12a
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Jul 18 11:57:08 2018 +0000

    Merge "Repin home once setup is complete" into pi-dev

commit 9d77aaec850b54e3bc1657025fe87399b89c8ba1
Merge: b4f7c414a68 d2aa4e1913c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 18 00:56:18 2018 +0000

    Merge "Fix for incorrect cycle evaluation in computeOomAdj DO NOT MERGE" into pi-dev

commit cf845036e5cbca2345bdb548c4a3e1729b699269
Author: Evan Laird <evanlaird@google.com>
Date:   Tue Jul 17 15:55:40 2018 -0400

    DO NOT MERGE: Use quick_qs_total_height when QS is not disabled

    A change in the logic of QuickStatusBarHeader#updateResources
    mistakenly used quick_qs_offset_height for the total height of the qqs
    panel instead of quick_qs_total_height. This caused the quick-quick
    settings panel to be too short on devices which don't have a large
    notch.

    Test: visual, on device without a notch
    Change-Id: I0deed2560328501e547b04239133e350cdac4ff6
    Fixes: 111554577

commit b4f7c414a6868c33e1a995d5f6249c6bce3af46d
Merge: 776b4e2dfa6 b444e2d99ed
Author: Laura Davis <laurabd@google.com>
Date:   Tue Jul 17 18:23:09 2018 +0000

    Merge "Docs: Removed narrative content." into pi-dev

commit 776b4e2dfa6367484295e823e4fb1a6750664384
Merge: cf0b1271105 e350e7396ff
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jul 17 16:26:23 2018 +0000

    Merge "Hide apks not needed for a specific sku" into pi-dev

commit 7823ee73ee504fcb5b0448b0b8f1b4804309df45
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Tue Jul 17 15:24:16 2018 +0200

    Move allocateBuffers to RT

    Such that it gets executed after setSurface, in order that
    mReqUsage has the correct flags set.

    Test: Take trace, ensure that allocateBuffers actually allocates
    in the right format/usage by ensuring that dequeueBuffer doesn't
    trash them immediately again.
    Bug: 111517695
    Change-Id: I94b402d7b29d565155a77a2d09106246261712d2

commit 0c84996a12ace0a81ecfeb5f3a79e55127a06af0
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Sun Jul 15 14:24:38 2018 +0200

    Repin home once setup is complete

    On a fresh device, the home intent resovles to SetupWizard. After
    setup is complete, it will resolve to the regular home app. In
    order to accomodate for that, repin home app once user setup is
    complete.

    Test: Wipe device, complete SUW, inspect pinner
    Bug: 111132016
    Change-Id: I904ecd2fed26bc1a3baf45c1b54da5fc6352d773

commit b444e2d99ede90ac48abdf21c874d5b2109a2b34
Author: Laura Davis <laurabd@google.com>
Date:   Fri Jul 13 15:12:35 2018 -0700

    Docs: Removed narrative content.

    Test: make ds-docs

    Bug: 110268338
    Change-Id: Ifaa4096d075500f1c7a53b1eec9e1944ed2ddda6

commit ff129aefe2b68c5dc6fe51a9b1d34f98750d4973
Author: Stan Iliev <stani@google.com>
Date:   Thu Jul 12 16:53:59 2018 -0400

    Fix TextureView.getBitmap with scale layer transform

    Fix TextureView.getBitmap to capture content only from the layer.

    Bug: 111401911
    Test: A new test TextureViewTest.testTransformScale is passing
    Change-Id: I2b9cee17fc48de7b12ed03d5b4f173ce5445dbfe

commit cf0b12711057a2a23dc08f1ac6acfe67892b945d
Merge: c450d1401e6 28e663cbed2
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 16 20:57:43 2018 +0000

    Merge "Loosen resource file verification" into pi-dev

commit 28e663cbed28fb6c8c8dec0849e0277daf67651b
Author: Todd Kennedy <toddke@google.com>
Date:   Thu Jul 12 13:15:54 2018 -0700

    Loosen resource file verification

    Bug: 77808145
    Test: Tried to install corrupt APK prior to the change, install failed
    Test: Tried to install corrupt APK after the change, install succeeded
    Test: atest CtsAppSecurityHostTestCases:CorruptApkTests
    Change-Id: I19a69e52a17c1080beaf2cc575c32f564b1033a3

commit c450d1401e68cc2492153e4aae6878c5003ce5db
Merge: 632c036d8c9 64cb4be8878
Author: Robert Shih <robertshih@google.com>
Date:   Mon Jul 16 13:38:43 2018 -0700

    Merge changes from topic "am-9e4fa925-b00a-40e6-8fb0-e5a4244e6284" into oc-dev am: e43837e258 am: dccb62bcca
    am: 64cb4be887

    Change-Id: Id7d4599c5d7d7c803e86afa88be582773c80741f

commit 64cb4be88784d5f48da7092a8772c01e82a2b43e
Merge: 213af1a79e2 dccb62bcca2
Author: Robert Shih <robertshih@google.com>
Date:   Mon Jul 16 13:13:13 2018 -0700

    Merge changes from topic "am-9e4fa925-b00a-40e6-8fb0-e5a4244e6284" into oc-dev am: e43837e258
    am: dccb62bcca

    Change-Id: I9e6762b25f001e31da7df0bb25984856989b9fd9

commit 632c036d8c9d6744fcf20cc456576c711489d1f9
Merge: 15ae72085fc 99e1424e0aa
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 16 20:04:23 2018 +0000

    Merge "Fix crash on calling getAppStandbyBucket()" into pi-dev

commit dccb62bcca25502ae6a9f0d086bc30ceb1c23950
Merge: d1f53d13a9d e43837e258a
Author: Robert Shih <robertshih@google.com>
Date:   Mon Jul 16 12:51:28 2018 -0700

    Merge changes from topic "am-9e4fa925-b00a-40e6-8fb0-e5a4244e6284" into oc-dev
    am: e43837e258

    Change-Id: Ib0ef741f0188ff3e6edc52e20eae997e9dba56e4

commit b794b4cb9e5c541ef6142f689bcbe70aa56829f5
Merge: abe5a73a4a8 0d2dc943dca
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 16 19:25:14 2018 +0000

    Merge "Fix TrackInfo parcel write" into nyc-dev

commit e43837e258a45607b98c366fa933b8c2682a0127
Merge: 8f1c70e49b9 7b414ce7108
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 16 19:25:14 2018 +0000

    Merge changes from topic "am-9e4fa925-b00a-40e6-8fb0-e5a4244e6284" into oc-dev

    * changes:
      [automerger] Fix TrackInfo parcel write am: 0d2dc943dc am: 00b57fc9b7 am: 1bce1217ca am: 47c831e675 am: d6143e9307
      [automerger] Fix TrackInfo parcel write am: 0d2dc943dc am: 00b57fc9b7 am: 1bce1217ca am: 47c831e675
      [automerger] Fix TrackInfo parcel write am: 0d2dc943dc am: 00b57fc9b7 am: 1bce1217ca
      [automerger] Fix TrackInfo parcel write am: 0d2dc943dc am: 00b57fc9b7
      [automerger] Fix TrackInfo parcel write am: 0d2dc943dc
      Fix TrackInfo parcel write

commit 15ae72085fc55eb441d2ff7f3d6b04c8e776925b
Merge: 0e5e46f874a 55135d5d5f7
Author: Chong Zhang <chz@google.com>
Date:   Mon Jul 16 19:12:32 2018 +0000

    Merge "Fix broken javadoc link in MediaFormat" into pi-dev

commit 0e5e46f874a3ecf7ab0a9a7953132a23f5ef59e4
Merge: 9ef41ccf428 7119800f4b4
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Fri Jul 13 22:36:08 2018 +0000

    Merge "Pin compiled code of HOME app" into pi-dev

commit c565700b94bc5f1fe3cbaeddd77e3312b2bf9098
Author: Yin-Chia Yeh <yinchiayeh@google.com>
Date:   Fri Jul 13 13:42:43 2018 -0700

    Camera: hardware level related doc update

    Codegen doc update + CameraDevice manual update about EXTERNAL
    hardware level.

    Test: check offline-sdk-docs output
    Bug: 77861412
    Change-Id: I70c87a176cf873cf8bec2037f973a94fe99aef2e

commit 9ef41ccf428a6213da542474b478ea85c4c88285
Merge: 762470b663f fb53deca41c
Author: Shrijana Ghimire <shrijana@google.com>
Date:   Fri Jul 13 19:03:24 2018 +0000

    Merge "docs: Fixed typos in AdapterView Javadoc." into pi-dev

commit 762470b663f0b328205254ade507b46532556754
Merge: c2f735b844c 6bbccf5bc19
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 13 18:40:05 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit c2f735b844ccfc5be0fd53cb2bb31292889bab15
Merge: 66bbd64d7d0 20fe3217f48
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 13 18:04:45 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit 66bbd64d7d0317b605d62b930fdfb891573cae1e
Merge: b32be39c6d0 213af1a79e2
Author: Bernie Innocenti <codewiz@google.com>
Date:   Fri Jul 13 09:42:28 2018 -0700

    [automerger skipped] Merge "vpn: allow IPSec traffic through Always-on VPN" into oc-dev am: 8f1c70e49b am: d1f53d13a9  -s ours
    am: 213af1a79e  -s ours

    Change-Id: If0154030422d4ddd2b4383f9e107125d67f7b409

commit 213af1a79e2514f0b7ee7814e485fb80573fd43a
Merge: 1e5152b5397 d1f53d13a9d
Author: Bernie Innocenti <codewiz@google.com>
Date:   Fri Jul 13 09:28:11 2018 -0700

    [automerger skipped] Merge "vpn: allow IPSec traffic through Always-on VPN" into oc-dev am: 8f1c70e49b
    am: d1f53d13a9  -s ours

    Change-Id: I293fc38d50e75b0b021dff6af045ac8a2aa6927f

commit d1f53d13a9d2b22fc2e7573b1b05d8ae9fc56126
Merge: 262d6935a05 8f1c70e49b9
Author: Bernie Innocenti <codewiz@google.com>
Date:   Fri Jul 13 09:17:40 2018 -0700

    Merge "vpn: allow IPSec traffic through Always-on VPN" into oc-dev
    am: 8f1c70e49b

    Change-Id: Ic103dfa909ca4567a815b16f0794baf74c1cf068

commit b32be39c6d0d3ed2adc81c2cda4aaffcd5266679
Merge: 903d59735ec 1e5152b5397
Author: Bernie Innocenti <codewiz@google.com>
Date:   Fri Jul 13 09:17:17 2018 -0700

    [automerger skipped] Merge "vpn: allow IPSec traffic through Always-on VPN" into oc-mr1-dev
    am: 1e5152b539  -s ours

    Change-Id: I2ada9a973b1728122a2beb5f47d105af4507c742

commit 8f1c70e49b9553e604ea2d4ae14eb7d162263c51
Merge: 71bd8398560 cb8cc6cc5a6
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 13 16:05:32 2018 +0000

    Merge "vpn: allow IPSec traffic through Always-on VPN" into oc-dev

commit 1e5152b5397686bef4705e6bf132765c4461a764
Merge: d9bd9d1c041 ef2910dc709
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 13 16:05:27 2018 +0000

    Merge "vpn: allow IPSec traffic through Always-on VPN" into oc-mr1-dev

commit 7119800f4b4c78b5e40df205a391c400c10d2f01
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Mon Jul 9 17:57:10 2018 +0200

    Pin compiled code of HOME app

    Keeping the code in memory of the currently set home app is
    important for latency as we don't have any kind of starting
    window/splash screen when pressing the home app to hide any latency.

    Memory impact:

    Pinning dex/vdex:

    In practical scenarios, this should be < 500kb.
    The home app is usually profile-speed compiled, for which the
    resulting dex/vdex files are about 2 mb. However, during regular
    use, at least 1.5 MB of it is referenced in memory. This makes
    sense: By definition profile-speed only compiles the things that
    is usually frequently executed during regular execution.

    Pinning apk:
    With Launcher 3 in practical scenarios this should be about 3.7 MB,
    as the APK is about 5.7 MB but 2 MB are usually referenced in any
    case.

    Bug: 111132016
    Bug: 78585335
    Test: Inspect "adb shell dumpsys pinner" after boot.
    Test: Check for pinned files after updating camera/home.
    Test: Check for pinned files after user switch with different
    default apps.
    Test: Check for pinned files after bg-dexopt.
    Test: Check for pinned files after bg-dexopt + kill pid.

    Change-Id: I6cdbc06d089efeb1c72a51216879ba0573502009
    Merged-In: I6cdbc06d089efeb1c72a51216879ba0573502009

commit 903d59735ec238c2630dd5707b06f9bac1b23572
Merge: 090e9d232c6 ae07a6bf53c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 13 13:19:48 2018 +0000

    Merge "vpn: allow IPSec traffic through Always-on VPN" into pi-dev

commit 20fe3217f48f335c93ab134bf078c0087e534cc5
Author: Bill Yi <byi@google.com>
Date:   Fri Jul 13 04:12:01 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: I123ada1f5523bb94ee1b7df86889f557566256cd

commit 7b414ce71081647bc336db76cc8cb35854cf0105
Merge: 71bd8398560 d6143e93077
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:57:21 2018 +0000

    [automerger] Fix TrackInfo parcel write am: 0d2dc943dc am: 00b57fc9b7 am: 1bce1217ca am: 47c831e675 am: d6143e9307

    Change-Id: I67d3d47cf3ba616d8b8d963d7092895621f63200

commit d6143e93077f2f7e530c4b66e702dec29d6cc7bd
Merge: 31597b6253b 47c831e6757
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:57:15 2018 +0000

    [automerger] Fix TrackInfo parcel write am: 0d2dc943dc am: 00b57fc9b7 am: 1bce1217ca am: 47c831e675

    Change-Id: I1f39ec37a6e4fa163caf51702e0924cc9c89ee04

commit 47c831e6757271b527346d695553f9fa88612a41
Merge: 40f239c454d 1bce1217ca1
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:57:08 2018 +0000

    [automerger] Fix TrackInfo parcel write am: 0d2dc943dc am: 00b57fc9b7 am: 1bce1217ca

    Change-Id: I29f00c9b6dca76c5b780d659d122e08a0d7e581c

commit 1bce1217ca17267c54e0960c203a9336d0e697e2
Merge: 77e6e346440 00b57fc9b76
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:57:02 2018 +0000

    [automerger] Fix TrackInfo parcel write am: 0d2dc943dc am: 00b57fc9b7

    Change-Id: Ida72e9fed175aa9497af5c5f607640c07cb04cf5

commit 00b57fc9b76819db3a2ca365a6c6e1ff8e114636
Merge: 2895b320b4d 0d2dc943dca
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:56:56 2018 +0000

    [automerger] Fix TrackInfo parcel write am: 0d2dc943dc

    Change-Id: I7ea941c8cffa147d2c6a46f0428899bf001a2672

commit 0d2dc943dcaa3d7c8479e22ae62be9753ea2643c
Author: Robert Shih <robertshih@google.com>
Date:   Mon Jul 9 13:38:31 2018 -0700

    Fix TrackInfo parcel write

    Bug: 77600398
    Change-Id: Ia316f1c5dc4879f6851fdb78fe8b9039579be7bc

commit 090e9d232c6ba24ec9078e7cc3406aad3a548c3d
Merge: 650ead619e6 13c89f2b1f3
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 23:34:50 2018 +0000

    Merge "DO NOT MERGE: Use minimumHeight in QS header" into pi-dev

commit e350e7396ff0aac58686112652ec50847715b5a6
Author: Ruchi Kandoi <kandoiruchi@google.com>
Date:   Thu Jun 28 15:05:27 2018 -0700

    Hide apks not needed for a specific sku

    Test: Manual; Check if apks are installed/uninstalled.
    Bug: 109675640
    Change-Id: I20c27f25ae35cfa6f875930fed2b6805b1268fd7

commit 650ead619e6b128d1afbb720778dd126a0793df6
Merge: 7775af27781 511ac80149a
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Thu Jul 12 21:32:53 2018 +0000

    Merge "DO NOT MERGE Remove WTF spam" into pi-dev

commit 7775af277815b1a5453838f63af34d19c3517af3
Merge: 4ab42d5b8aa bc4d0326a04
Author: Winson Chung <winsonc@google.com>
Date:   Thu Jul 12 20:46:44 2018 +0000

    Merge "Acquire service lock in AppTaskImpl.moveToFront()" into pi-dev

commit 4ab42d5b8aa2cb2e36f46b34962dd23832f45280
Merge: 698e7ebb0be d9bd9d1c041
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 13:37:57 2018 -0700

    Merge changes from topic "am-9f47cb6c-9cea-4b25-9f9b-e0e460e471ac" into oc-dev am: 71bd839856 am: 262d6935a0
    am: d9bd9d1c04

    Change-Id: Id7b15870681b4971920a36db92198bb32d92ef51

commit 13c89f2b1f35d84440bec8bec9d759c3e2de6e07
Author: Evan Laird <evanlaird@google.com>
Date:   Mon Jul 2 17:43:59 2018 -0400

    DO NOT MERGE: Use minimumHeight in QS header

    Allow QuickStatusBarHeader to use a minimum hieight so that it doesn't
    draw underneath of a notch when display densities are low.

    Bug: 78110564
    Test: visual
    Change-Id: I44df89c3b98dc0bdb8455b36e7ad023b92676c9d

commit 698e7ebb0beef1485627a58c741241e95aa9f6c3
Merge: 5bf0d3e61cf f85971f3a2c
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 13:27:05 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f4037fb69e skipped: 741c97faa9 am: 0c31d81cd1  -s ours am: afb05522f1  -s ours
    am: f85971f3a2  -s ours

    Change-Id: I0891178936b34370816eb9c15fd4103ecee586cc

commit 5bf0d3e61cf6fdb93725ad7365165e0f5f52d0a8
Merge: 26da9f18ed6 847b7d112e6
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 13:24:55 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: e059d5fb83 skipped: e97378c657 am: 9935787f3b  -s ours am: bf789ba0d1  -s ours
    am: 847b7d112e  -s ours

    Change-Id: I236fce4894fa4dda79e34ed191560598dcd2a4c4

commit d9bd9d1c0419e4dad89c4b732df5c916a185d339
Merge: f85971f3a2c 262d6935a05
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 13:17:45 2018 -0700

    Merge changes from topic "am-9f47cb6c-9cea-4b25-9f9b-e0e460e471ac" into oc-dev am: 71bd839856
    am: 262d6935a0

    Change-Id: Ic9027e92228853ab6dffacf72c0afc3920946d19

commit f85971f3a2c16f1cf2a841b45b97408f86695f8d
Merge: 847b7d112e6 afb05522f1f
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 13:10:22 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f4037fb69e skipped: 741c97faa9 am: 0c31d81cd1  -s ours
    am: afb05522f1  -s ours

    Change-Id: I92e39d42756e8d5d7f517802ddbdc8e539024d88

commit 847b7d112e65f455c530410ddef13049854629b8
Merge: e9b67d2b223 bf789ba0d1e
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 13:08:42 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: e059d5fb83 skipped: e97378c657 am: 9935787f3b  -s ours
    am: bf789ba0d1  -s ours

    Change-Id: I157f816f170fc9af6263e552a46612fab2760f63

commit 262d6935a0595ef52c116738f084dfcfa44308fb
Merge: afb05522f1f 71bd8398560
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 12:47:58 2018 -0700

    Merge changes from topic "am-9f47cb6c-9cea-4b25-9f9b-e0e460e471ac" into oc-dev
    am: 71bd839856

    Change-Id: Ic7c05906f4d2f9fecc9ab93ab90b9869d8b176be

commit afb05522f1f510d6301da768f086363552c4073b
Merge: bf789ba0d1e 0c31d81cd15
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 12:45:19 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f4037fb69e skipped: 741c97faa9
    am: 0c31d81cd1  -s ours

    Change-Id: I404ba441a96f77be638d89c0c43f950200a94376

commit bf789ba0d1e78633b45cd1df357a39d6e2e11a0c
Merge: bf8733b1625 9935787f3bc
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 12:41:11 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: e059d5fb83 skipped: e97378c657
    am: 9935787f3b  -s ours

    Change-Id: I1ef782ee8a7ed8da6baed44c052f1fa3a08c1af4

commit 71bd8398560dd300a839384f7001f8e7f7aeb9a8
Merge: 9935787f3bc 0c31d81cd15
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 19:26:31 2018 +0000

    Merge changes from topic "am-9f47cb6c-9cea-4b25-9f9b-e0e460e471ac" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: f4037fb69e skipped: 741c97faa9
      [automerger skipped] Import translations. DO NOT MERGE skipped: f4037fb69e
      Import translations. DO NOT MERGE

commit 31597b6253bff8407986f69dd2d84cf3ab0ddb8c
Merge: e97378c6571 741c97faa9a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 19:26:31 2018 +0000

    Merge changes from topic "am-9f47cb6c-9cea-4b25-9f9b-e0e460e471ac" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: f4037fb69e
      Import translations. DO NOT MERGE

commit 40f239c454de80cfc47d106712ca01764b5e3b62
Merge: 9049eb3f936 f4037fb69e2
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 19:26:31 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 9049eb3f936f87b66ccfb60048ffc5b026ba9b42
Merge: 49e97ea1dcc e059d5fb83e
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 19:18:55 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 6bbccf5bc197783ad1e23359ca7920d21e5f50cf
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 12 11:15:44 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: Id078d2f27ad8fb15561b5c0175ecef5c7e84b5e3

commit bc4d0326a04c19500f44283fbfab581257d3c75e
Author: Wale Ogunwale <ogunwale@google.com>
Date:   Wed Jul 11 15:22:01 2018 -0700

    Acquire service lock in AppTaskImpl.moveToFront()

    Oversight from previous refactor in O release done in ag/2987716

    Change-Id: I2e2d6e55251eb319ddee0db97eedc1c574736ead
    Merged-In: I2e2d6e55251eb319ddee0db97eedc1c574736ead
    Fixes: 111336376
    Test: builds

commit 26da9f18ed66c6b769cc8f2ea0078483020bfe88
Merge: 2fca393cc16 2cc04e654c2
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 17:26:37 2018 +0000

    Merge "Camera: Use session configuraion when recording tests" into pi-dev

commit 2fca393cc16d00253bbcda0e0362b0127de855e0
Merge: 267b960dab6 5f967a39414
Author: Donghui Han <donghuihan@google.com>
Date:   Thu Jul 12 17:19:36 2018 +0000

    Merge "camera2: Treat face detect mode larger than FULL as FULL" into pi-dev

commit 511ac80149a81202ba9e9fb3eeb1127e84fd9783
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Thu Jul 12 13:55:08 2018 +0200

    DO NOT MERGE Remove WTF spam

    Root cause has been identified, but fix is too risky. Instead, we
    remove the WTF for now and readd the fix as well as the WTF
    in master.

    Note that due to defensive programming, in case we land in the WTF
    case, it doesn't cause any real bug.

    Test: boots
    Bug: 110834518
    Change-Id: I0da1e48e420c3fcde0e818b7fe0527da9155a159

commit 9935787f3bc53936b565b6dc7c9d0d57a21fd8ac
Merge: cab2fa779ec e97378c6571
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 01:50:59 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: e059d5fb83 skipped: e97378c657

    Change-Id: I444e7a4567e0319e0a1999ca1a83418b14812d5d

commit e97378c65711a17df1a19b95bc0e442b768a8914
Merge: c2cfe453f21 e059d5fb83e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 01:50:52 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: e059d5fb83

    Change-Id: I119e6fba2ffa56ca9a8b24df821025abf4bf9580

commit e059d5fb83e9e7e83a89717ce2177387f48362c9
Author: Bill Yi <byi@google.com>
Date:   Wed Jul 11 18:50:30 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I989a9b371c1dc0c713b67c0a8cef4f3bdc0c457c
    Auto-generated-cl: translation import

commit 0c31d81cd15b529f91070b1b00db9e9fb9e08ad5
Merge: cab2fa779ec 741c97faa9a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jul 11 23:43:09 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: f4037fb69e skipped: 741c97faa9

    Change-Id: Ib3e6c7f2885ac23d45a68e7e20d981969067eb3b

commit 741c97faa9a50d5767caceb77933434caa7228bd
Merge: c2cfe453f21 f4037fb69e2
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jul 11 23:43:02 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: f4037fb69e

    Change-Id: I37e47c3e87c8e9143731af2b4bf0d92fc4ce7f38

commit f4037fb69e270e9bec76235d3153a4b903eb0b8d
Author: Bill Yi <byi@google.com>
Date:   Wed Jul 11 16:42:32 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I9878d930e5aa4e4fe1883f28063e167240bb99b5
    Auto-generated-cl: translation import

commit 267b960dab63200b6ba4dc53dfc7e7ed064986fc
Merge: b9ed290b012 e9b67d2b223
Author: Arthur Ishiguro <arthuri@google.com>
Date:   Wed Jul 11 14:40:57 2018 -0700

    [automerger] Resolve inconsistent parcel read in NanoAppFilter am: abe5a73a4a am: 2895b320b4 am: 77e6e34644 am: 49e97ea1dc am: c2cfe453f2 am: cab2fa779e am: bf8733b162
    am: e9b67d2b22

    Change-Id: Ia3222d7b97b2d1083404d607738fc15d2646999c

commit e9b67d2b223bc8ce709e1031528e8e7e18913ff8
Merge: 199b3ee0d88 bf8733b1625
Author: Arthur Ishiguro <arthuri@google.com>
Date:   Wed Jul 11 14:27:45 2018 -0700

    [automerger] Resolve inconsistent parcel read in NanoAppFilter am: abe5a73a4a am: 2895b320b4 am: 77e6e34644 am: 49e97ea1dc am: c2cfe453f2 am: cab2fa779e
    am: bf8733b162

    Change-Id: I4fe6469031d7ef6fcc6d9b46da4dbc5845ea62d2

commit bf8733b16258cd6497be085c9abe82aac1904323
Merge: 75576617874 cab2fa779ec
Author: Arthur Ishiguro <arthuri@google.com>
Date:   Wed Jul 11 14:13:30 2018 -0700

    [automerger] Resolve inconsistent parcel read in NanoAppFilter am: abe5a73a4a am: 2895b320b4 am: 77e6e34644 am: 49e97ea1dc am: c2cfe453f2
    am: cab2fa779e

    Change-Id: Ifdd69396d202951f8b9ed5fe6e5766133955a5e5

commit b9ed290b012bd887e44793aa2114f5e6187a10a4
Merge: 3f4232a8016 2b56813688d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 11 17:47:36 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit 99e1424e0aa9e7dc4a5ccbff011d7161201921d1
Author: Amith Yamasani <yamasani@google.com>
Date:   Wed Jul 11 10:44:17 2018 -0700

    Fix crash on calling getAppStandbyBucket()

    MATCH_ANY_USER, which was locked down recently, is not
    really needed in this context, so removed it.

    Bug: 111145886
    Test: cts CtsAppUsageHostTestCases
    Change-Id: I1bb9df0c7370015365bea414599b2b83084a1846

commit 5f967a394149e56cb658c399f36132b819d5185a
Author: Donghui Han <donghuihan@google.com>
Date:   Tue Jul 10 16:32:39 2018 -0700

    camera2: Treat face detect mode larger than FULL as FULL

    This change treats any face detect mode larger than FULL mode
    in the capture result as FULL mode. So in case the face detect
    mode is larger than FULL, it is assumed that the FULL mode
    STATISTICS_FACE is supported in the capture result.

    Bug: 111131913
    Test: CTS, GCA
    Change-Id: I3a6a29ce8d9d8ab66918baaea3162797e18276d2

commit 3f4232a8016970a1a25c2c689017063ead9e5349
Merge: 729bfdf9a8d b6ba4334b46
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Jul 11 12:10:29 2018 +0000

    Merge "Send interaction hint when starting window animation" into pi-dev

commit 729bfdf9a8d4dce22376fd52391acfa9dc5d9a00
Merge: f00bfbe46e2 926f071688d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 11 00:43:02 2018 +0000

    Merge "Only query for estimate on battery level change" into pi-dev

commit 2b56813688dc202e4d9ebfe6516439e71714b1c2
Author: Bill Yi <byi@google.com>
Date:   Tue Jul 10 17:34:55 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: Ice16b70aac3532e8a2ba725315868dc6d60c4fde

commit 926f071688d91135575fbfc708e4bb884c86e780
Author: Salvador Martinez <dehboxturtle@google.com>
Date:   Tue Jul 3 18:07:07 2018 -0700

    Only query for estimate on battery level change

    SysUI is querying for an estimate too much, this change gates
    it on being the first estimate or the battery level having
    changed so that we don't waste system resources.

    Test: atest PowerUITest
    Bug: 110259498
    Change-Id: I6fb5c08d6388e463d6216de41b3fd49bbc489b81

commit f00bfbe46e20298fa05b23f7e71937af0ebf593b
Merge: 8fe381f0fdd 543692372b0
Author: Julia Reynolds <juliacr@google.com>
Date:   Tue Jul 10 12:49:16 2018 +0000

    Merge "Be more strict about triggering notification lights" into pi-dev

commit d2aa4e1913c05d8c21e81eef3ad941565aded7d6
Author: Amith Yamasani <yamasani@google.com>
Date:   Mon Jul 9 12:07:35 2018 -0700

    Fix for incorrect cycle evaluation in computeOomAdj DO NOT MERGE

    Use the conservative value of adj and procstate if at least
    one evaluation pass was completed, even if the value is not
    final. The later iterations through the procs that have
    cycles will elevate the apps if necessary. Otherwise the
    dependencies will just get stuck in a low state.

    Bug: 79643956
    Test: Manual test of connecting to AA and turning off screen
          atest CtsAppTestCases:ActivityManagerProcessStateTest

    Change-Id: If520eb239935782e2487b16e8bb650ded775f184

commit 8fe381f0fdde205835587aa84444d4d2ccad8d7a
Merge: a2b1e5f013c 3c0dc27a4da
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jul 10 00:28:57 2018 +0000

    Merge "Always close file descriptors" into pi-dev

commit a2b1e5f013cb4e25c8509cd51db6d1ac23a065ef
Merge: 4db8f31c43b c2eca4758be
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 9 23:49:42 2018 +0000

    Merge "Fix leak where system held onto slice providers" into pi-dev

commit 4db8f31c43bc0de90337787520faba9b3141a6e5
Merge: ec328eea490 2cadc5cd56c
Author: Chavi Weingarten <chaviw@google.com>
Date:   Mon Jul 9 23:45:34 2018 +0000

    Merge "WM: Add debug information for forced seamless rotation" into pi-dev

commit ec328eea490fa28c175bae94e49c4c40b774f77a
Merge: c4cf07a16f2 17eb1bd6e4d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 9 22:47:29 2018 +0000

    Merge "Fix readImmediately for CTS" into pi-dev

commit b6ba4334b46c378a7a8480de023e04f8079b2dd3
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Tue Jul 10 00:36:57 2018 +0200

    Send interaction hint when starting window animation

    If we are starting a window animation, there is a very strong
    correlation that usually just before the user took some kind of
    action.

    However, in some cases the power hint may be lost of there are not
    continiously produced frames between the user interaction and the
    window animation, like when opening the IME but it takes a while
    until the IME comes up, or when the status bar automatically hides
    after being temporarily shown in a fullscreen app.

    Test: SurfaceAnimationRunnerTest
    Test: Go to an immersive_sticky app, swipe down from top, wait
    until status bar hides, make sure interaction hint gets sent.
    Bug: 111253599

    Change-Id: Id517d48a63d4c528265a808c49043d936d804625

commit 2cadc5cd56c09f87f1d772ed5028ea1796f18a4e
Author: Adrian Roos <roosa@google.com>
Date:   Fri Jul 6 02:39:54 2018 -0700

    WM: Add debug information for forced seamless rotation

    Bug: 111062294
    Test: adb shell dumpsys window ScreenDecoration
    Change-Id: I2521cfde6cdc04644666eff753226d6d008d378f
    Merged-In: I2521cfde6cdc04644666eff753226d6d008d378f

commit 55135d5d5f7017991b682ae35ed703db91fb493e
Author: Chong Zhang <chz@google.com>
Date:   Mon Jul 9 11:39:35 2018 -0700

    Fix broken javadoc link in MediaFormat

    bug: 74979696
    Change-Id: I83965f3d1d395cb0953da9605b27861a1d84cde7

commit 543692372b0bcfba1f04bd650cfd69a3df8ceb34
Author: Julia Reynolds <juliacr@google.com>
Date:   Tue Jul 3 10:43:35 2018 -0400

    Be more strict about triggering notification lights

    Don't trigger lights if they should be suppressed by notification flags.

    Don't log that notification lights happened if global or temporary
    settings have turned them off

    Test: runtest systemui-notification, verify
    notification_itnerruptiveness numbers for a fresh 3p app that uses
    lights
    Bug: 111069748

    Change-Id: I68750bf39eb76ef0bda40ddacfd90e1be79e8575
    (cherry picked from commit 28149f65f9f036f746957d1323efda20aed94ba3)

commit c4cf07a16f27ed795cfea6b0f2e650b63f2b5552
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Thu Jul 5 18:28:12 2018 +0200

    Fix janky wakeup animation

    Previous wake-up animation was totally broken before, as multiple
    animations were running with different interpolators and different
    durations, creating a really jaring experience for the front-door
    of the phone, which users see hundreds of times a day.

    Instead, we use a single animator to drive everything, and pass in
    both the interpolated and the linear value so the right value can
    be used in whichever place.

    Test: Wakeup/sleep phone with different numbers of notifications
    Fixes: 110980608
    Change-Id: If1758404a4c49fcd7dc9fa3c93bb18e42a586632

commit cab2fa779ec3f4bdb0941a631effa34c9da70695
Merge: cec93100ead c2cfe453f21
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 6 22:55:21 2018 +0000

    [automerger] Resolve inconsistent parcel read in NanoAppFilter am: abe5a73a4a am: 2895b320b4 am: 77e6e34644 am: 49e97ea1dc am: c2cfe453f2

    Change-Id: I6e3461125290f2835ff1f9a996beb92e64172386

commit c2cfe453f21cc6df58254413d18f3554be178b5e
Merge: 806a67bd086 49e97ea1dcc
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 6 22:55:14 2018 +0000

    [automerger] Resolve inconsistent parcel read in NanoAppFilter am: abe5a73a4a am: 2895b320b4 am: 77e6e34644 am: 49e97ea1dc

    Change-Id: I19c512999a0eae233e2cc7c4d31d0c62556e4ffd

commit 49e97ea1dcc0ead3e632684826ede9a149f762a0
Merge: de1a3a18ed1 77e6e346440
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 6 22:55:07 2018 +0000

    [automerger] Resolve inconsistent parcel read in NanoAppFilter am: abe5a73a4a am: 2895b320b4 am: 77e6e34644

    Change-Id: I87ad6c5bad9275df8b1a131b3ac0daf7ec8ed5e4

commit 77e6e3464400bf3901b5f4ce740421f642a6b590
Merge: f0aeb8e927f 2895b320b4d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 6 22:55:02 2018 +0000

    [automerger] Resolve inconsistent parcel read in NanoAppFilter am: abe5a73a4a am: 2895b320b4

    Change-Id: I26b97af90ef6ea8b640ff7198b2883297d4fb03e

commit 2895b320b4df87a69ea4c46dd3e5734c696ef6f7
Merge: b9c3b099e48 abe5a73a4a8
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 6 22:54:55 2018 +0000

    [automerger] Resolve inconsistent parcel read in NanoAppFilter am: abe5a73a4a

    Change-Id: Ieb925f073b80e4d624552e738d49b0996f0485ae

commit abe5a73a4a81e312a1690fbc10a6b99ce98b699a
Author: Arthur Ishiguro <arthuri@google.com>
Date:   Mon Jun 25 11:31:33 2018 -0700

    Resolve inconsistent parcel read in NanoAppFilter

    Bug: 77599679
    Test: Compile only
    Change-Id: Ib417a5cb4d51744442d2fb14437cabbe5fd1c266

commit 5c75b5b60e7ec757884d71ae2dd12ee1c71614a1
Merge: 6dc57344d66 c29b146daf3
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 22:10:50 2018 +0000

    Merge "Hide windows even when AOD is off" into pi-dev

commit 6dc57344d663773065a366b00d2746092f8901ff
Merge: 648f0b4c446 199b3ee0d88
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 23:40:19 2018 -0700

    Merge changes from topic "am-59bde7f2-9903-448c-9ad1-8364ed396cf3" into oc-dev am: cec93100ea am: 7557661787
    am: 199b3ee0d8

    Change-Id: I7330886e1c2ddcbb92c1a3fa03e9a4a8276d31a2

commit 648f0b4c446e3011aa4c5d2afead0fed969266ad
Merge: b5334fff171 c1a9ad2a19e
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 23:32:52 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: c28b092c5e skipped: 33cf864720 am: c6d9bee144  -s ours am: bf6bbefe57  -s ours
    am: c1a9ad2a19  -s ours

    Change-Id: Ib512c45c735b6259220d2e0934fa6132f533d421

commit b5334fff171547668d94dc4c790f0ee02472bd1d
Merge: 0ae92cd7faf f9a749eb82c
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 23:25:25 2018 -0700

    Merge changes from topic "am-8b8b3d01-a327-4923-ae09-35940a00b1b3" into oc-dev am: 72e16b1754 am: af687adf49
    am: f9a749eb82

    Change-Id: I4d285431b8384196b449c43360a118eddf98f15d

commit 0ae92cd7faf0aae89fcc13b64695aa6b01a25f14
Merge: d91868aee55 1080ba61c37
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 23:17:39 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: e35f1fdbae skipped: 39c48a1168 am: a05627322f  -s ours am: a8276b8de4  -s ours
    am: 1080ba61c3  -s ours

    Change-Id: I3284bfe82cef35b5e4b30c686f2fb5c381e858a8

commit d91868aee55c322cc9008c237af081d35d0b6ec2
Merge: 8dfe2e787c8 e2a7c24f038
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 23:12:01 2018 -0700

    Merge changes from topic "am-5c22e81a-5f3d-46c4-9d8f-58c6edfac103" into oc-dev am: 6005492cb2 am: 851e826783
    am: e2a7c24f03

    Change-Id: Ie4e2d6c9fe04adc0d26dc2d7a4d9e7c8ef89fb74

commit 8dfe2e787c8feb3b3d2a315771c6c26e587a8690
Merge: cd74671aa77 9bf5cb9b7f9
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 23:04:17 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: ff2f705557 skipped: 4740838b56 am: 8700285134  -s ours am: f2ea6f55d9  -s ours
    am: 9bf5cb9b7f  -s ours

    Change-Id: I92f228dd4920d493591d44e4ab6e7e6b731d9e8a

commit cd74671aa77337544c276d683823c888222490e8
Merge: 84729fca533 086abb7a593
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:38:26 2018 -0700

    Merge changes from topic "am-dd912fb1-a10b-413b-b531-a015abbbf9e3" into oc-dev am: 37d9749e81 am: b434b0c169
    am: 086abb7a59

    Change-Id: I50abf9cc8aeb4c0086c9f2b4d3f7620853d7d0cc

commit 199b3ee0d88aec0d57c4565e7f4d26b63cde9f6a
Merge: c1a9ad2a19e 75576617874
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:36:46 2018 -0700

    Merge changes from topic "am-59bde7f2-9903-448c-9ad1-8364ed396cf3" into oc-dev am: cec93100ea
    am: 7557661787

    Change-Id: I543dafa974e9f5c677957fd19d6f03fcf796213a

commit 84729fca53333cf93d2d2985a65692fc0054c846
Merge: 12835665f34 d635022d93a
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:30:53 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f02d29629d skipped: ace44c1ee6 am: eacf5ffefb  -s ours am: 67f18d810a  -s ours
    am: d635022d93  -s ours

    Change-Id: I21b5b66696cb1f6c6683e46c82ee71a7d8751c24

commit c1a9ad2a19eb6dd7105d0ec72bd3ef51a3944c31
Merge: f9a749eb82c bf6bbefe57f
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:30:27 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: c28b092c5e skipped: 33cf864720 am: c6d9bee144  -s ours
    am: bf6bbefe57  -s ours

    Change-Id: Ife52c79c0b85d9f09f1d2cf7b792239aaae24868

commit f9a749eb82c5d8c811464de8dc14971261f4ca47
Merge: 1080ba61c37 af687adf49d
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:25:31 2018 -0700

    Merge changes from topic "am-8b8b3d01-a327-4923-ae09-35940a00b1b3" into oc-dev am: 72e16b1754
    am: af687adf49

    Change-Id: I3885703da8f3f7bfe6b72c25d1f3ed19d6aeac9a

commit 1080ba61c37f5c5dc206c86c6fcfd7162c5eb076
Merge: e2a7c24f038 a8276b8de42
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:18:16 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: e35f1fdbae skipped: 39c48a1168 am: a05627322f  -s ours
    am: a8276b8de4  -s ours

    Change-Id: I13817952fd66ca2501a35a0e1223bc7d932a2ddc

commit e2a7c24f038083e943f71570a756d6d253e3e778
Merge: 9bf5cb9b7f9 851e8267830
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:12:53 2018 -0700

    Merge changes from topic "am-5c22e81a-5f3d-46c4-9d8f-58c6edfac103" into oc-dev am: 6005492cb2
    am: 851e826783

    Change-Id: I1b866e81f48a4d642657cd963fd8e04faa3c1537

commit 9bf5cb9b7f945f376b98d3d1014673719cc472f7
Merge: 086abb7a593 f2ea6f55d9e
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:05:37 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: ff2f705557 skipped: 4740838b56 am: 8700285134  -s ours
    am: f2ea6f55d9  -s ours

    Change-Id: Ic88b3b3dcc9ed3148c6e3d150705e7f40b36c8d0

commit 12835665f344f976d315f4d9348b84d3e6040d63
Merge: 8944491476a c3ff91a225a
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:02:12 2018 -0700

    Merge changes from topic "am-20b78215-c47d-481a-9e96-79127da1c87c" into oc-dev am: c1dc805861 am: 812ec62a14
    am: c3ff91a225

    Change-Id: I69dc7a8329df67e668addcd07d288709230cf48e

commit 086abb7a593f66dbd447025a5316169b1c84248d
Merge: d635022d93a b434b0c1690
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 22:00:12 2018 -0700

    Merge changes from topic "am-dd912fb1-a10b-413b-b531-a015abbbf9e3" into oc-dev am: 37d9749e81
    am: b434b0c169

    Change-Id: I817b45781ecea994292c346d9e3bd4584e0f2d1f

commit 8944491476ad5b416588d9d431547d005c6d7f9f
Merge: 402176177ca d18e450922b
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 21:53:48 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 32c08741ec skipped: 8062f299b1 am: 998f40e6c5  -s ours am: fcca5bb731  -s ours
    am: d18e450922  -s ours

    Change-Id: Icb43cc60577ca81ada301f283b9e3e1bf4cf6ccc

commit d635022d93a2323994a075361bf8e483717a85d5
Merge: c3ff91a225a 67f18d810ad
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 21:53:26 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f02d29629d skipped: ace44c1ee6 am: eacf5ffefb  -s ours
    am: 67f18d810a  -s ours

    Change-Id: Ifaeaf651a92fd5bd261180f0aaa68bb2da521fc0

commit c3ff91a225ad8599985c1b49653f658191e10a98
Merge: d18e450922b 812ec62a144
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 21:48:16 2018 -0700

    Merge changes from topic "am-20b78215-c47d-481a-9e96-79127da1c87c" into oc-dev am: c1dc805861
    am: 812ec62a14

    Change-Id: I66ce801571d91b5e3791a57cebfe9b56715515b7

commit d18e450922b1a98f9164679f089b5aa1064292e3
Merge: 5d61a6618bf fcca5bb7315
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 21:41:17 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 32c08741ec skipped: 8062f299b1 am: 998f40e6c5  -s ours
    am: fcca5bb731  -s ours

    Change-Id: Ib39dfb279c982016f6102a4ee6d26e6e5f925d91

commit 75576617874241136000f885fb724d0d4c1829cd
Merge: bf6bbefe57f cec93100ead
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 21:18:08 2018 -0700

    Merge changes from topic "am-59bde7f2-9903-448c-9ad1-8364ed396cf3" into oc-dev
    am: cec93100ea

    Change-Id: If8c2cd293875724b99a5177c7235ffbeb64c396e

commit bf6bbefe57f6c7362d41a4623e2b8b1599f38e75
Merge: af687adf49d c6d9bee144e
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 21:15:54 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: c28b092c5e skipped: 33cf864720
    am: c6d9bee144  -s ours

    Change-Id: If1145747718e78a0ad5f60015aa0398e1813c078

commit af687adf49d5f935c46468972e5b43bdab60d855
Merge: a8276b8de42 72e16b1754a
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 21:11:19 2018 -0700

    Merge changes from topic "am-8b8b3d01-a327-4923-ae09-35940a00b1b3" into oc-dev
    am: 72e16b1754

    Change-Id: I75a0f507a546413eeee64870ba94be647ee5de11

commit a8276b8de4218dbfaa9f08f93be7ab8c60bf3ce0
Merge: 851e8267830 a05627322ff
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 21:08:51 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: e35f1fdbae skipped: 39c48a1168
    am: a05627322f  -s ours

    Change-Id: I8b0805714082f83552ebb6cbd8290bcd0c39d6cd

commit 851e82678307c8d8b1af8929e7771e4163c97c71
Merge: f2ea6f55d9e 6005492cb27
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:58:16 2018 -0700

    Merge changes from topic "am-5c22e81a-5f3d-46c4-9d8f-58c6edfac103" into oc-dev
    am: 6005492cb2

    Change-Id: I71789a270fc86b5fc9c74c0de2cd122f1ac26c5e

commit 402176177ca81d12fc6c3436237fcd279b1cfc99
Merge: 9f950537e4e 5d61a6618bf
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:57:24 2018 -0700

    Merge changes from topic "am-5f59ad6e-1c79-44f8-a437-eac2cc321cdf" into oc-dev am: ec4d649d8f am: f051b28554
    am: 5d61a6618b

    Change-Id: I0eeeb695d9125b05d136700b3e03157c25a302fc

commit f2ea6f55d9eeff0f9b30e99be450ca33c64890e4
Merge: b434b0c1690 87002851341
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:56:04 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: ff2f705557 skipped: 4740838b56
    am: 8700285134  -s ours

    Change-Id: Ice563d38360e1be62c5f6b869dc69f1ce5dfff24

commit b434b0c1690f4118f393179fd3d7d3927960b799
Merge: 67f18d810ad 37d9749e81e
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:51:41 2018 -0700

    Merge changes from topic "am-dd912fb1-a10b-413b-b531-a015abbbf9e3" into oc-dev
    am: 37d9749e81

    Change-Id: I6258da69f13a1ea21b50d0756315619ef190a526

commit 67f18d810adb304b73fb5d98291cb4a4418a7bc9
Merge: 812ec62a144 eacf5ffefbc
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:49:13 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f02d29629d skipped: ace44c1ee6
    am: eacf5ffefb  -s ours

    Change-Id: I034e3f1a5916c01dc643cde92bd6f42187b5c480

commit 9f950537e4edb1eec743a121ed440bfe8d399a23
Merge: 05968703a2b d9d9d1dacab
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:48:58 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: cd4aea64f6 skipped: f028c34cdc am: 9204ce40e4  -s ours am: e45b804b65  -s ours
    am: d9d9d1daca  -s ours

    Change-Id: Id13c67950da4a13f9035c0e35b903237948f61a5

commit 812ec62a1447de4642b6feb947056b955c1bd3e2
Merge: fcca5bb7315 c1dc805861b
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:44:43 2018 -0700

    Merge changes from topic "am-20b78215-c47d-481a-9e96-79127da1c87c" into oc-dev
    am: c1dc805861

    Change-Id: I3a40076fd344300ac6dd812ea2c96012f88e36b0

commit fcca5bb73155bd79bce7d4d3d58a58c8acbd75a8
Merge: f051b28554a 998f40e6c57
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:42:12 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 32c08741ec skipped: 8062f299b1
    am: 998f40e6c5  -s ours

    Change-Id: Ifdbc60e6748887feedc47eb60843d231dae46146

commit 5d61a6618bfdb4eb6413be7b1d573044de84650e
Merge: d9d9d1dacab f051b28554a
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:23:45 2018 -0700

    Merge changes from topic "am-5f59ad6e-1c79-44f8-a437-eac2cc321cdf" into oc-dev am: ec4d649d8f
    am: f051b28554

    Change-Id: Ia57f2327964435888de185ed3cd461f6299daa62

commit d9d9d1dacab8f0d2752aca570de976e765f32aa6
Merge: 03e1c5f227c e45b804b65f
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:16:48 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: cd4aea64f6 skipped: f028c34cdc am: 9204ce40e4  -s ours
    am: e45b804b65  -s ours

    Change-Id: Iae41c56e1a5007b66a1a880d1ef5e4a351a5ca63

commit 05968703a2bd214c2e73160c5ced1bc69815f91c
Merge: 3f4b3c946dc 03e1c5f227c
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:07:47 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f8ecf21228 skipped: b586d4e9ab am: b3bf111bd5  -s ours am: 4065ce8773  -s ours
    am: 03e1c5f227  -s ours

    Change-Id: Iddcf2126b4c25970d87e3f90a66033a9a09c5ace

commit f051b28554a1628ebffc900192ffb9f04306b21c
Merge: e45b804b65f ec4d649d8f3
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:03:49 2018 -0700

    Merge changes from topic "am-5f59ad6e-1c79-44f8-a437-eac2cc321cdf" into oc-dev
    am: ec4d649d8f

    Change-Id: I874acb53e25065d4a9a8018f2f0e69d6d041fa8b

commit 03e1c5f227c4dfce58fb8d6cb4a9b9256323c75f
Merge: 0f4152e8152 4065ce8773f
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:02:41 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f8ecf21228 skipped: b586d4e9ab am: b3bf111bd5  -s ours
    am: 4065ce8773  -s ours

    Change-Id: I2f05f7f47f5e7aed365bee09afc30b019cb73993

commit e45b804b65f8f8b2ae6c8224b9d3db219b151309
Merge: 4065ce8773f 9204ce40e4d
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 20:01:40 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: cd4aea64f6 skipped: f028c34cdc
    am: 9204ce40e4  -s ours

    Change-Id: Ic798dfd5e7b85f7341d2c929519aa227a95e6f18

commit 4065ce8773f74672b333c52f9f309f534af5c07f
Merge: 245cc0559fb b3bf111bd50
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 19:57:42 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: f8ecf21228 skipped: b586d4e9ab
    am: b3bf111bd5  -s ours

    Change-Id: Ice5c1a283c59a8640868cdc3a8acc4afb97e5468

commit cec93100ead6e9f2dcdc60237d53dfc10f6c2936
Merge: 72e16b1754a c6d9bee144e
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:55:05 2018 +0000

    Merge changes from topic "am-59bde7f2-9903-448c-9ad1-8364ed396cf3" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: c28b092c5e skipped: 33cf864720
      [automerger skipped] Import translations. DO NOT MERGE skipped: c28b092c5e
      Import translations. DO NOT MERGE

commit de1a3a18ed14c9cbdd99330f3328802f31deb313
Merge: 6843be54c5e c28b092c5e4
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:55:05 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 806a67bd08665662bdc16fa8c3a53302e633457f
Merge: e906e8a9cf1 33cf864720c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:55:05 2018 +0000

    Merge changes from topic "am-59bde7f2-9903-448c-9ad1-8364ed396cf3" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: c28b092c5e
      Import translations. DO NOT MERGE

commit 72e16b1754a1c832bdf35abeb7abc36af7e02d95
Merge: 6005492cb27 a05627322ff
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:50:29 2018 +0000

    Merge changes from topic "am-8b8b3d01-a327-4923-ae09-35940a00b1b3" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: e35f1fdbae skipped: 39c48a1168
      [automerger skipped] Import translations. DO NOT MERGE skipped: e35f1fdbae
      Import translations. DO NOT MERGE

commit 6843be54c5eb7ba4dcab74462b80f340135ea031
Merge: d7bc81d956f e35f1fdbaed
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:50:29 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit e906e8a9cf10838255c082a97579ddf96b1da88d
Merge: e80af8d1e5c 39c48a11680
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:50:29 2018 +0000

    Merge changes from topic "am-8b8b3d01-a327-4923-ae09-35940a00b1b3" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: e35f1fdbae
      Import translations. DO NOT MERGE

commit 6005492cb2799c2e1b6828d31491b7ca3e2fac0a
Merge: 37d9749e81e 87002851341
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:46:51 2018 +0000

    Merge changes from topic "am-5c22e81a-5f3d-46c4-9d8f-58c6edfac103" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: ff2f705557 skipped: 4740838b56
      [automerger skipped] Import translations. DO NOT MERGE skipped: ff2f705557
      Import translations. DO NOT MERGE

commit d7bc81d956f5cc689ad98cab87db771534c1caed
Merge: 79257683dc8 ff2f7055576
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:46:51 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit e80af8d1e5c12de876b0e6bd084fed7c18f0aded
Merge: a18ed9c0266 4740838b56a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:46:51 2018 +0000

    Merge changes from topic "am-5c22e81a-5f3d-46c4-9d8f-58c6edfac103" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: ff2f705557
      Import translations. DO NOT MERGE

commit 37d9749e81e2713112c621321790578b5eb27415
Merge: c1dc805861b eacf5ffefbc
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:46:29 2018 +0000

    Merge changes from topic "am-dd912fb1-a10b-413b-b531-a015abbbf9e3" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: f02d29629d skipped: ace44c1ee6
      [automerger skipped] Import translations. DO NOT MERGE skipped: f02d29629d
      Import translations. DO NOT MERGE

commit 79257683dc83e46ac9e6ce7ef21249ea02d2c24c
Merge: a39ce2ab1e5 f02d29629d5
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:46:29 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit a18ed9c02666f6fe6a262b4d1cf44cef3261592a
Merge: 8b700c467c7 ace44c1ee6b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:46:29 2018 +0000

    Merge changes from topic "am-dd912fb1-a10b-413b-b531-a015abbbf9e3" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: f02d29629d
      Import translations. DO NOT MERGE

commit c1dc805861bef15447d843737682db50c86fa871
Merge: ec4d649d8f3 998f40e6c57
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:45:57 2018 +0000

    Merge changes from topic "am-20b78215-c47d-481a-9e96-79127da1c87c" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 32c08741ec skipped: 8062f299b1
      [automerger skipped] Import translations. DO NOT MERGE skipped: 32c08741ec
      Import translations. DO NOT MERGE

commit a39ce2ab1e5d1658e94bd082b96f999e9947f709
Merge: 6a38d2a53fd 32c08741ecb
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:45:57 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 8b700c467c7be97ab9f7376fa4a283192f89d717
Merge: e998b01b331 8062f299b1c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:45:57 2018 +0000

    Merge changes from topic "am-20b78215-c47d-481a-9e96-79127da1c87c" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 32c08741ec
      Import translations. DO NOT MERGE

commit ec4d649d8f34d716b008b7eeafa92953370594b7
Merge: b3bf111bd50 9204ce40e4d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:45:27 2018 +0000

    Merge changes from topic "am-5f59ad6e-1c79-44f8-a437-eac2cc321cdf" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: cd4aea64f6 skipped: f028c34cdc
      [automerger skipped] Import translations. DO NOT MERGE skipped: cd4aea64f6
      Import translations. DO NOT MERGE

commit 6a38d2a53fd6fb0639cefac9657a4ebb401decad
Merge: f8ecf21228b cd4aea64f63
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:45:27 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit e998b01b33166a4da6917925482c84ac990fe564
Merge: b586d4e9abc f028c34cdc5
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 6 02:45:27 2018 +0000

    Merge changes from topic "am-5f59ad6e-1c79-44f8-a437-eac2cc321cdf" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: cd4aea64f6
      Import translations. DO NOT MERGE

commit 3c0dc27a4da7c54efc2ee422fb66360ad4b58ae3
Author: Erik Kline <ek@google.com>
Date:   Wed Jul 4 17:57:51 2018 +0900

    Always close file descriptors

    Every error thrown leaked a netlink NETFILTER socket.

    Test: as follows
        - built, flashed, booted
        - runtest frameworks-net passes
        - enabled tethering and tried to cause conntrack updates to sessions
          that had expired (which causes ErrnoExceptions to be thrown)
          while monitoring lsof for system_server's NETFILTER sockets

    Bug: 32163131
    Bug: 64976634
    Bug: 110122306

    Merged-In: Id25f948b6b4d25ac033d9b608ab4a6b474f2c606
    Merged-In: I212cbbe134bba4580a6e73de9bb77e712d25c9a6

    Change-Id: Ib52b812e8434c27ad9f2596666400c13e03c2216

commit a05627322ff971adee53da31eaf461bbc670a272
Merge: 8b047ec8a21 39c48a11680
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 22:39:37 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: e35f1fdbae skipped: 39c48a1168

    Change-Id: I2850da8ee89c8ed1dcfc7fc443eb8a2dcb6346bd

commit 39c48a11680b16f0f1b1e16fefbe46230d165e54
Merge: 8c94fb33e0b e35f1fdbaed
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 22:39:28 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: e35f1fdbae

    Change-Id: I66b3bb58351d966fbe38e7448c985206e73af9d5

commit e35f1fdbaed731cda9434448c64577b91500b7ef
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 15:38:55 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I3ce8cc748d098e3854a7c2b19cdc0d0fe4281288
    Auto-generated-cl: translation import

commit 9204ce40e4d7b47becb1c2dc61f70ebbb2b7f758
Merge: 8b047ec8a21 f028c34cdc5
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 21:45:40 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: cd4aea64f6 skipped: f028c34cdc

    Change-Id: I5c0a1faf8d1dc7bf5d6fc831b61ab40697a422d5

commit f028c34cdc5bd7e89636e7700da561f4da7fb169
Merge: 8c94fb33e0b cd4aea64f63
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 21:45:32 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: cd4aea64f6

    Change-Id: I8ba42b65a49ff3e9c30e56dc8664bc8a942b4d25

commit cd4aea64f63e25dc752ead41477e1e099348f0ef
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 14:45:03 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: Ib37886b826a61cf234e745494df8f57f58aafda6
    Auto-generated-cl: translation import

commit 998f40e6c57dd738ade1980c6c06a6f72879978a
Merge: 8b047ec8a21 8062f299b1c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 21:38:44 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 32c08741ec skipped: 8062f299b1

    Change-Id: I99aab27eecf8e8d5d092cabc316b0d3b68a97b2c

commit 8062f299b1c914f782394a24c6548a5aac595fa8
Merge: 8c94fb33e0b 32c08741ecb
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 21:38:36 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 32c08741ec

    Change-Id: I09e334aa2acf3c0d32b27b9d18193450db041c6a

commit 32c08741ecb1303377e814e60e8cdc689eb325d9
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 14:38:05 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: Ie2a754e3f768b2de4d5ead7c9809143a0208a323
    Auto-generated-cl: translation import

commit eacf5ffefbcc52c974c5af74d955f9c5a0c55635
Merge: 8b047ec8a21 ace44c1ee6b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 21:26:20 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: f02d29629d skipped: ace44c1ee6

    Change-Id: I264d10bc17ca14d813f7626ea8c7f3fc48b7d2b7

commit ace44c1ee6bdda0b2ce48e82e40adeaca4c54375
Merge: 8c94fb33e0b f02d29629d5
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 21:26:12 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: f02d29629d

    Change-Id: I19af9b73c3da999252d25aa656b2ee5898b75662

commit f02d29629d52243126093f280717826b399b513e
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 14:25:39 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I3f4f14ff10346e7bd3ce6ae49fb7d62b0b97b29f
    Auto-generated-cl: translation import

commit 8700285134190dabe3d23696d73b889f37218e06
Merge: 8b047ec8a21 4740838b56a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 20:56:37 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: ff2f705557 skipped: 4740838b56

    Change-Id: I2021f802764dc2314c721ba918c587f235b0f575

commit 4740838b56a8593e1b0832c30d27d16e30ec4f81
Merge: 8c94fb33e0b ff2f7055576
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 20:56:29 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: ff2f705557

    Change-Id: Ia499ffa8340bfbf0f2b1ec7dd515ee5cf65f7fb8

commit ff2f7055576aad0613bb9f5dbb1d9e317eefd52c
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 13:55:54 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: Ie0db7263c998f8b70aa35b99d5207ceab763f25c
    Auto-generated-cl: translation import

commit b3bf111bd5044ccf85e6a9a678b13c18037b3e0d
Merge: 8b047ec8a21 b586d4e9abc
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 20:32:02 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: f8ecf21228 skipped: b586d4e9ab

    Change-Id: Idb16f83382ec0d792c15733b46fe31a99e89552a

commit b586d4e9abcaf3edd21e0b4f270c9239f450d2b7
Merge: 8c94fb33e0b f8ecf21228b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 20:31:54 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: f8ecf21228

    Change-Id: Ie556d4be250c4d6f4ade238bb905455aa0454b73

commit f8ecf21228b0850eee8b96ad5f35a5ef5824bbdc
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 13:31:17 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: If9dfa14b67b352f0e43cec9c151e75bcaa361e4d
    Auto-generated-cl: translation import

commit c6d9bee144e9d40fc8453633bfdf58d49261f145
Merge: 8b047ec8a21 33cf864720c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 20:25:00 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: c28b092c5e skipped: 33cf864720

    Change-Id: I0ff7f8debdd8198ed8e4b61898a27ba116b013f7

commit 33cf864720c2091e671ffb8cfbf671c515b94904
Merge: 8c94fb33e0b c28b092c5e4
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 5 20:24:50 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: c28b092c5e

    Change-Id: I8214434dd8cb7b4e173b0ff49e3b5bf7618125f2

commit c28b092c5e4fe8b74532fb9d87a9e55a97d56486
Author: Bill Yi <byi@google.com>
Date:   Thu Jul 5 13:24:08 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I49d05b7d8f35cccb3dfe0fef1b04f5e08490e7de
    Auto-generated-cl: translation import

commit 2cc04e654c2ba9b73f82206f63f232832690eb46
Author: chened <chened@google.com>
Date:   Thu Jul 5 17:24:45 2018 +0800

    Camera: Use session configuraion when recording tests

    Use session configuration API to pass the initial recording
    request.

    Bug: 111168889
    Test: atest
    frameworks/base/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/stress/Camera2RecordingTest.java

    Change-Id: Ie53a6b0fb0fd9573d135fdddb1a54b0afbd0d73b

commit 3f4b3c946dc1a7af46a53c415a17cc7f53909909
Author: Bill Yi <byi@google.com>
Date:   Wed Jul 4 16:58:23 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: I28cf7af28a854687af1b92930a9e79e02d685c35

commit d3a87062eeccf53c01da320910eb6dcb9832293d
Author: Erik Kline <ek@google.com>
Date:   Tue Jun 26 18:53:43 2018 +0900

    Push DNS configuration on network validation

    Test: as follows
        - built, flashed, booted
        - runtest frameworks-net passes
        - connected to captive portal network,
          saw failed validation attempt (opportunistic),
          passed portal, saw successful revalidation attempt
    Bug: 64133961
    Bug: 72344805
    Bug: 109928338
    Merged-In: Ic2046e053faf58e2edf2824e01145c61a9f2991f
    Merged-In: I209c38fab7f05909e61731a348b1b1a2b35feab2
    Change-Id: I0471685c2234af8a8c7f5b2ad3205eb6e36333c5

commit 0937d1807b4444eec50b18ad47fdbba5a94c34bd
Merge: 9654ecebd7d 614b9ce887e
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 4 02:34:42 2018 +0000

    Merge "DO NOT MERGE: Delay brightness change" into pi-dev

commit 614b9ce887ee7223d4af65c9a6d9a846b5dc10f1
Author: Lucas Dupin <dupin@google.com>
Date:   Mon Jul 2 11:17:14 2018 -0700

    DO NOT MERGE: Delay brightness change

    During a fingerprint wake-up, the display state changes bumping up
    the display brightness. This means that the screen will flash
    bright if the scrims couldn't draw and blank the screen yet.

    The fix updates the state of the keyguard, waits for the frame to be
    pushed to the display (can take up to 2 frames since we're using
    triple buffers), when then asks PowerManager to wake-up the device.

    Fixes: 80415238
    Test: fp unlock with AOD on and off on devices with displays from
          multiple vendors
    Change-Id: I60f0e265c4af87cc1cb4fcf31e89558a330a4b71
    Merged-In: I752f9bd5ffd754166ffee7dc15960909dd3f1a81

commit 9654ecebd7d916981c20a62a455627c4083e46b0
Merge: a14e1b3950d 3669711d873
Author: Tor Norbye <tnorbye@google.com>
Date:   Tue Jul 3 23:11:25 2018 +0000

    Merge "Include annotations in metalava stubs" into pi-dev

commit 17eb1bd6e4d0a3062df6787a7564f02abfade50c
Author: Hall Liu <hallliu@google.com>
Date:   Tue Jul 3 15:17:41 2018 -0700

    Fix readImmediately for CTS

    The readImmediately API (only used by CTS so far) was broken by a
    previous change that unknowingly changed the semantics of ready().
    Fixing this so that CTS tests work again.

    Change-Id: I6970713eae2a01dd07e30778ca8ee0d9bc7dfeb9
    Fixes: 111125833
    Test: CTS

commit a14e1b3950d81e73a9cc6d06bf3ec2afa906acd8
Merge: 42e713d7a30 f5a13f8b3a0
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jul 3 20:24:58 2018 +0000

    Merge "Add active admin app to power white list." into pi-dev

commit 42e713d7a30a4a1262b352915d66323ae2f28fac
Merge: cd64600ba82 d35502fb5f5
Author: Lucas Dupin <dupin@google.com>
Date:   Tue Jul 3 18:52:23 2018 +0000

    Merge "Cross fade wake-up from pulsing" into pi-dev

commit cd64600ba82f4e7cacd3f715aaea3b585ad60e5e
Merge: fb11e4c9b1a 3bf75781cac
Author: Jean-Michel Trivi <jmtrivi@google.com>
Date:   Tue Jul 3 18:49:33 2018 +0000

    Merge "AudioService: history of A2DP commands" into pi-dev

commit fb11e4c9b1af9219c8e90d2c295b2d003cb1129d
Merge: 6f7cfb0627d 5fa8af2b10d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jul 3 18:39:18 2018 +0000

    Merge "Add system_server to system group only if per_app_memcg is true" into pi-dev

commit 6f7cfb0627d02f394e864ddd29b086520cad64d2
Merge: 9ccabdbc45e 5a5c6e0e44f
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jul 3 18:31:06 2018 +0000

    Merge "Correctly preserve key generation parameters" into pi-dev

commit c2eca4758be4aac21ccb555464edddd2aa9c7645
Author: Jason Monk <jmonk@google.com>
Date:   Tue Jul 3 11:08:32 2018 -0400

    Fix leak where system held onto slice providers

    Test: uiservicestests
    Bug: 110985973
    Change-Id: Ie8fab3c7b8c22d302825fb147d2c3468f9ae7172
    (cherry picked from commit e1c0c2cb8dd5624d4b881f1ecfeef66fc86890f0)

commit 3bf75781cacb1cd181be43e454fef29c83cbeab9
Author: Jean-Michel Trivi <jmtrivi@google.com>
Date:   Mon Jul 2 10:48:04 2018 -0700

    AudioService: history of A2DP commands

    Keep history of command coming from A2dpService in AudioService
      logger.

    Bug: 110186160
    Test: connect/disconnect A2DP device and take bugreport,
          or run $ adb shell dumpsys audio

    Change-Id: Ice65c20e91aa2675fbacb1c326a53d5b02bba3e5

commit f5a13f8b3a0ce1a3ee6e49802e32db3f3fb38d6d
Author: Lei Yu <jackqdyulei@google.com>
Date:   Thu Jun 28 14:06:29 2018 -0700

    Add active admin app to power white list.

    So user can't restrict it in settings app.

    Bug: 110337989
    Test: RunSettingsLibTests
    Change-Id: Ie32dc8b2204369c9ca8f704436d5c988f76481ae
    Merged-In: Ie32dc8b2204369c9ca8f704436d5c988f76481ae

commit 9ccabdbc45eef085b5ad74824e9a369e572e712d
Merge: 4764921dcc6 761fb3b5e65
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jul 3 00:01:52 2018 +0000

    Merge "add three new carrier configs for call forwarding, Caller ID and Call Waiting." into pi-dev

commit c29b146daf35a54dc317ad12c0f609e37a91ea56
Author: Lucas Dupin <dupin@google.com>
Date:   Mon Jul 2 13:15:23 2018 -0700

    Hide windows even when AOD is off

    AOD might be off but it can become visible when the user double taps
    or lifts the phone. We should prepare the window manager for these
    cases.

    Test: turn AOD on and off, set screen lock to 'None', double tap display
    Fixes: 110938816
    Change-Id: I6f2db86579d5b86a86fcd1a4515ee77c78460c9d
    Merged-In: I6f2db86579d5b86a86fcd1a4515ee77c78460c9d

commit 4764921dcc61f01cb011e2e64a117855910f7a61
Merge: 5baaf461a63 606405180fc
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Mon Jul 2 21:35:50 2018 +0000

    Merge "Only use simple rects for cutout region" into pi-dev

commit 3669711d873cb07a6385394b41b13f72211964c3
Author: Colin Cross <ccross@android.com>
Date:   Mon Jul 2 14:04:10 2018 -0700

    Include annotations in metalava stubs

    Pass --include-annotation-classes tools/metalava/stub-annotations
    to metalava so that the stubs end up in the final jar.  They will be
    post-processed with metalava --rewrite-annotations to avoid affecting
    the public SDK.

    Bug: 110532131
    Test: m out/target/common/obj/JAVA_LIBRARIES/metalava_android_stubs_current_intermediates/classes.jar
    Change-Id: Icb9268a72aa7de82ed6ad88aef9ac813796f9bf9
    Merged-In: I116643925a3a9594e8590c3714e93d0fb0ac372f

commit 5baaf461a63fdf609ef9d78295a209dca5e22abc
Merge: d7b59466281 8c556d72f1c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jul 2 18:39:55 2018 +0000

    Merge "Move charging indication vertically on time tick" into pi-dev

commit 8c556d72f1cbe1d3e22cb1d97851b63c7ddc886a
Author: Lucas Dupin <dupin@google.com>
Date:   Wed Jun 27 11:44:57 2018 -0700

    Move charging indication vertically on time tick

    Before, a new translation was only calculated when the device enters
    AOD, and then, during time tick, we would only move it 5px wich isn't
    enough.
    Now, the translation varies 5dps vertically on every time tick.

    Fixes: 110888643
    Test: take screenshots for N minutes and compare them
    Change-Id: Ia3f239d669b83aad0d97d8d7a7f7374f4890777d
    Merged-In: Ia3f239d669b83aad0d97d8d7a7f7374f4890777d

commit d35502fb5f5910f87b3b205d5171a0747b60e87a
Author: Lucas Dupin <dupin@google.com>
Date:   Wed Jun 27 13:35:52 2018 -0700

    Cross fade wake-up from pulsing

    Activate WM animation and remove scrims when
    fading keyguard from the pulsing state to prettify
    animation on new devices.

    Test: wake up with fp from pulsing to launcher
    Test: wake up with fp from pulsing to app
    Fixes: 110824274
    Change-Id: I0446f26939a2e25cd50d0d39f3fc703019196f7a

commit 606405180fc02618f0680295f29e92e946277e80
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Fri Jun 29 01:14:31 2018 +0200

    Only use simple rects for cutout region

    Otherwise there is a big performance hit in all kinds of
    situations where we do operations with the region, specifically
    when:

    - updating input windows
    - insetting the cutout during layout
    - touch dispatch

    Test: DisplayCutoutTest, WmDisplayCutoutTest
    Bug: 110464019
    Bug: 110452325
    Change-Id: I94a25c3794ecd33b8b7204ca308ac91623498f13

commit d7b59466281e2e0afc6c5db3ef08692bcc8f3a8a
Merge: 704a0d61747 060571655e1
Author: SongFerng Wang <songferngwang@google.com>
Date:   Sat Jun 30 06:22:12 2018 +0000

    Merge "add three new carrier configs for call forwarding, Caller ID and Call Waiting." into pi-dev

commit b3a81a1fad84b4f57c09673b685d8543071f0707
Author: Mike Ma <yanmin@google.com>
Date:   Fri Jun 29 12:18:27 2018 -0700

    Fix a NPE in BatteryStatsImpl

    ServiceManager.getService("batteryproperties")) may return null for some
    devices right after boot. (We don't know why, need further investigation)
    This causes async batterystats update to crash, leaving BatteryStats in a
    bad state (OnBattery() == true, but mOnBatteryTimeBase is not running),
    which does not accept aggregated stats update anymore.

    Bug: 109930230
    Test: manual
    Change-Id: I0654beff95f0a2b9df2567f1a2efffd3330e58ff
    (cherry picked from commit c6dfed1ce06c18097a81275eeeeb6e6e66d8e932)

commit 060571655e1f862483aedd8dc78eb76f59e54073
Author: SongFerngWang <songferngwang@google.com>
Date:   Thu Jun 28 17:28:22 2018 +0800

    add three new carrier configs for call forwarding, Caller ID and Call Waiting.

    The carrier configs control the call forwarding and additional
    settings button in the Call Settings menu and caller ID and
    call waiting in additional settings menu.

    Bug: 110121209
    Test: manual - test case as below :
    1.flag clir on and flag cw on ,do CLIR show/hide,
        and make call to other device.(PASS
    2.flag clir on and flag cw on ,do CW on/off,and CW function work.PASS
    3.flag clir off and flag cw on ,no CLIR in additional settings pagePASS
    4.flag clir off and flag cw on ,do CW on/off,and CW function work.PASS
    5.flag clir on and flag cw off ,do CLIR show/hide ,
        and make call to other device.PASS
    6.flag clir on and flag cw off ,no CW in additional settings pagePASS
    7.flag clir off and flag cw off,
        no Additional Settings in call feature settingsPASS
    8.flag cf off,no cf in call settings page (PASS)

    Change-Id: I29d7a71ad57b3b05ccc6025154f63119b35dab71

commit 5fa8af2b10d24fb6c08099d258bf887baf68ffb0
Author: Minchan Kim <minchan@google.com>
Date:   Wed Jun 27 11:32:40 2018 +0900

    Add system_server to system group only if per_app_memcg is true

    P18 or other high-performance devices shouldn't use per-memcg so
    it was disabled on those devices[1]. However, we didn't turn off
    for system_server memcg so those devices still have two seperate
    LRU groups which would have less efficient memory reclaim.

    Therefore, this patch makes memcg use for system_server only if
    per_app_memcg is enabled.

    [1] https://googleplex-android-review.git.corp.google.com/c/platform/system/core/+/4178592

    Bug: 110858093
    Test: confirm via cat /dev/memcg/system/tasks is none
    Change-Id: Ic0e3157bf8ff5de69767797b5508946ca3efeb68
    Signed-off-by: Minchan Kim <minchan@google.com>

commit 761fb3b5e65900983fb4b370a9c9b863b30454f6
Author: SongFerngWang <songferngwang@google.com>
Date:   Fri Jun 29 15:40:20 2018 +0800

    add three new carrier configs for call forwarding, Caller ID and Call Waiting.

    The carrier configs control the call forwarding and additional
    settings button in the Call Settings menu and caller ID and
    call waiting in additional settings menu.

    Bug: 110121209
    Test: manual - test case as below :
    1.flag clir on and flag cw on ,do CLIR show/hide,
        and make call to other device.(PASS
    2.flag clir on and flag cw on ,do CW on/off,and CW function work.PASS
    3.flag clir off and flag cw on ,no CLIR in additional settings pagePASS
    4.flag clir off and flag cw on ,do CW on/off,and CW function work.PASS
    5.flag clir on and flag cw off ,do CLIR show/hide ,
        and make call to other device.PASS
    6.flag clir on and flag cw off ,no CW in additional settings pagePASS
    7.flag clir off and flag cw off,
        no Additional Settings in call feature settingsPASS
    8.flag cf off,no cf in call settings page (PASS)

    Change-Id: I91a64d43e61c38ac1d744b99a2f8f03bbcf49deb

commit 704a0d617471843160106714d17356494d29657c
Merge: fffc3080842 1a388515739
Author: Lucas Dupin <dupin@google.com>
Date:   Fri Jun 29 18:27:46 2018 +0000

    Merge "AOD animation polish" into pi-dev

commit fffc3080842a57b13919a6ffffe3f72662fd6838
Merge: f83e814b18a 22e89f4773d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jun 29 17:23:13 2018 +0000

    Merge "Add new carrier config for CDMA registered PLMN when not roaming." into pi-dev

commit f83e814b18af93dba58a8498d085c4dbe1efd587
Merge: 15c1e47e266 97f62bf61db
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 28 21:33:24 2018 +0000

    Merge "Fix in Wifi activity updates" into pi-dev

commit 15c1e47e266570fcf1d29204f0ddb25fa0d6bdc1
Merge: ed60140a931 7c71bb27030
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 28 20:01:36 2018 +0000

    Merge "Force redraw after wallpaper is loaded" into pi-dev

commit 1a38851573929b2ceab57269f78f97ce03cff08a
Author: Lucas Dupin <dupin@google.com>
Date:   Thu Jun 28 11:09:09 2018 -0700

    AOD animation polish

    Change-Id: I03220e30d52aadc5aab8edddf759debd3302c95d
    Fixes: 110227946
    Test: visual

commit ed60140a9319ec32d1b7d937723883a401b0becb
Merge: 143c65d520b 908111d2d79
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 28 17:25:37 2018 +0000

    Merge "Do not create highlight if track width is invalid" into pi-dev

commit 5a5c6e0e44fbccbf5608c1955debf1650890f5a6
Author: Eran Messeri <eranm@google.com>
Date:   Thu Jun 28 11:20:44 2018 +0100

    Correctly preserve key generation parameters

    Due to an oversight, some of the key generation parameters that are set
    in KeyGenParameterSpec were not preserved when parceling the object
    (they should have been added to ParcelableKeyGenParameterSpec but were
    not).

    This means these parameters will be ignored when generating keys using
    the DevicePolicyManager.generateKeyPair method, leading to an
    inconsistent key generation behaviour between the DevicePolicyManager
    and KeyStore.

    In particular, this would prevent callers from using StrongBox when
    generating keys for use in the KeyChain.

    Fix the issue by simply persisting these parameters in
    ParcelableKeyGenParameterSpec and making sure that the Builder copies
    them too from the source KeyGenParameterSpec.

    Left to do is put in place an automated measure to find out
    discrepancies between the two classes.

    Bug: 110915980
    Bug: 110882855
    Bug: 109953656
    Test: atest KeystoreTests
    Change-Id: Ic64bd2921b6dfc97ea34ecba55f532312963ffcb

commit cb8cc6cc5a64b2b313bc6c9308da5991ee293a78
Author: Bernie Innocenti <codewiz@google.com>
Date:   Mon May 28 22:04:37 2018 +0900

    vpn: allow IPSec traffic through Always-on VPN

    This won't leak any traffic outside the VPN as long as there are no
    processes owned by uid 0 which generate network traffic (which is
    currently the case).

    Bug: 69873852
    Test: compared the output of 'adb shell ip rule show' before and after
    Test: runtest -x frameworks/base/tests/net/java/com/android/server/connectivity/VpnTest.java
    Test: local CTS tests run: android.net.cts.VpnServiceTest
    Test: local CTS tests run: com.android.cts.devicepolicy.MixedDeviceOwnerTest
    Change-Id: I8758e576c9d961d73f62bfcf0559dd7ecee6e8e6
    Merged-In: I8758e576c9d961d73f62bfcf0559dd7ecee6e8e6
    Merged-In: I1f9b78c8f828ec2df7aba71b39d62be0c4db2550
    Merged-In: I8edeb0942e661c8385ff0cd3fdb72e6f62a8f218
    (cherry picked from commit 00000fe55a4729f8339afdc7eab5c970b2549813)

commit 143c65d520b197a271d6de282fc7759d8009ce44
Merge: bed68535c0e fe6d4769a86
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 28 05:07:38 2018 +0000

    Merge "Correct the keystore alias used for secure imports" into pi-dev

commit bed68535c0ee9fbb1991863a81e2362bf75fe133
Merge: 387e0bf842b 45f17c5bef4
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 28 03:49:05 2018 +0000

    Merge "P is for PAINT." into pi-dev

commit 387e0bf842b2dc5fd88cc2440feba05a34469c93
Merge: 5fb8ac20107 0f4152e8152
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 18:48:55 2018 -0700

    Merge changes from topic "am-32ac52b1-d1ae-4650-b9ae-368d8cd519cb" into oc-dev am: 8b047ec8a2 am: 245cc0559f
    am: 0f4152e815

    Change-Id: I49e413e32d9db706eaa5a56fc84f9998a47b8a9e

commit 5fb8ac20107566dea76ce58547d04dc4b6ef9b51
Merge: d63cfc92615 ab3235ad5b5
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 18:35:46 2018 -0700

    Merge "Backport Prevent shortcut info package name spoofing" into oc-dev am: c6dbcc137e am: dcc95b94f8
    am: ab3235ad5b

    Change-Id: I1152d43ce2eec7cd5692d61df725bcd8b455aca3

commit d63cfc926150d6ea9aad985cf468616489873f10
Merge: 1028b26d460 2b8be3932b8
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 18:29:36 2018 -0700

    Merge changes from topic "am-8acf63d1-cfe0-4950-98c3-1d2367987749" into oc-dev am: 000036eb4c am: 00bf4c5b5c
    am: 2b8be3932b

    Change-Id: I2ad28e6a718946be431fcda0cbb8efa719b46db3

commit 0f4152e81523dc11c58ace98ab9d315472d4f4a1
Merge: ab3235ad5b5 245cc0559fb
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 18:27:10 2018 -0700

    Merge changes from topic "am-32ac52b1-d1ae-4650-b9ae-368d8cd519cb" into oc-dev am: 8b047ec8a2
    am: 245cc0559f

    Change-Id: I904c603cf4838f12067b9548058b85e53a843fd0

commit 245cc0559fbbff289b8ea9f09d653d614e245637
Merge: dcc95b94f81 8b047ec8a21
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 17:57:17 2018 -0700

    Merge changes from topic "am-32ac52b1-d1ae-4650-b9ae-368d8cd519cb" into oc-dev
    am: 8b047ec8a2

    Change-Id: I0c6522feec4b1baccf3c2c8ffb0d79bdebedb9b2

commit ab3235ad5b596a7b4081ed530421c79730309349
Merge: 2b8be3932b8 dcc95b94f81
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 17:37:57 2018 -0700

    Merge "Backport Prevent shortcut info package name spoofing" into oc-dev am: c6dbcc137e
    am: dcc95b94f8

    Change-Id: I23209ea505140a48177b1b4fe78d36699240653e

commit dcc95b94f8104548d6c26720f80290e72088cebd
Merge: 00bf4c5b5c8 c6dbcc137ea
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 17:25:10 2018 -0700

    Merge "Backport Prevent shortcut info package name spoofing" into oc-dev
    am: c6dbcc137e

    Change-Id: Ib3becad73fadba2be82e44bc6fb4afc3c1921a6a

commit 2b8be3932b89b9314b7a3a0acbdce6168a5b3a18
Merge: 1b67b798cf8 00bf4c5b5c8
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 17:21:25 2018 -0700

    Merge changes from topic "am-8acf63d1-cfe0-4950-98c3-1d2367987749" into oc-dev am: 000036eb4c
    am: 00bf4c5b5c

    Change-Id: I5cfc94bc9781c29a423a95a43d775e6bea6271b7

commit 1028b26d46016ed2695782dd76df67c751a64576
Merge: 9504cd35ec1 1b67b798cf8
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 17:09:53 2018 -0700

    [automerger skipped] Merge "Backporting of b/77821568" into oc-dev am: 9774459633 am: f3f6e2f9ee
    am: 1b67b798cf  -s ours

    Change-Id: I1f209b583519e73c0912db7583b34324003a5526

commit 00bf4c5b5c824aa0f26a8b3548fdf6e018bd06be
Merge: f3f6e2f9ee4 000036eb4c7
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 16:56:45 2018 -0700

    Merge changes from topic "am-8acf63d1-cfe0-4950-98c3-1d2367987749" into oc-dev
    am: 000036eb4c

    Change-Id: Ic71e3f93036902b2d9452c05e7cdb6e4df2fb0e0

commit 1b67b798cf89605ec417063d368198db25cc659d
Merge: ebd047e92fe f3f6e2f9ee4
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 16:56:36 2018 -0700

    Merge "Backporting of b/77821568" into oc-dev am: 9774459633
    am: f3f6e2f9ee

    Change-Id: I1445ecb89dba24df5e89089fbf0aff308331aea0

commit f3f6e2f9ee42d5b483941e858e643732f4c1666d
Merge: 3cca4e7b068 97744596339
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 16:42:36 2018 -0700

    Merge "Backporting of b/77821568" into oc-dev
    am: 9774459633

    Change-Id: Ie0d176b94d15be65918b5f67bf9ed7f49f632def

commit f0aeb8e927f4dd015790bab18443f337968ca1a5
Merge: 24d402096e5 2f7d50058ae
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:29:41 2018 +0000

    Merge "RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing" into nyc-mr1-dev

commit 8b047ec8a218e132c29cf5657fbaf9ba9df586fe
Merge: c6dbcc137ea aad860012e5
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:29:41 2018 +0000

    Merge changes from topic "am-32ac52b1-d1ae-4650-b9ae-368d8cd519cb" into oc-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a am: 06848a3f8f skipped: c3e741e530
      [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a am: 06848a3f8f
      [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a
      RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing

commit 8c94fb33e0b65a299516bced51e03438a33f88f0
Merge: e0f893ebb03 c3e741e5300
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:29:41 2018 +0000

    Merge changes from topic "am-32ac52b1-d1ae-4650-b9ae-368d8cd519cb" into nyc-mr2-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a am: 06848a3f8f
      [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a
      RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing

commit 75b5dc8fb91c69cb4d94274dc4e6f5a6aaeb457d
Merge: 3d38ba1f9bb 06848a3f8fa
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:29:41 2018 +0000

    Merge changes from topic "am-32ac52b1-d1ae-4650-b9ae-368d8cd519cb" into cw-f-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a
      RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing

commit c6dbcc137ea49c1fe0f47aa9a46de5c8f9e3bb8c
Merge: 000036eb4c7 9e21579a112
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:26:08 2018 +0000

    Merge "Backport Prevent shortcut info package name spoofing" into oc-dev

commit 000036eb4c7f05ec6c8d8e52519b9ed865c8ad07
Merge: 97744596339 3ea3c00d942
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:25:42 2018 +0000

    Merge changes from topic "am-8acf63d1-cfe0-4950-98c3-1d2367987749" into oc-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e am: 0eda2602cd skipped: 430c4395a3
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e am: 0eda2602cd
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c
      RESTRICT AUTOMERGE: Backporting of b/77821568

commit e0f893ebb036ded7acc87523bb68f5dd4d1b4a75
Merge: 6f3df0d16b7 430c4395a3a
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:25:42 2018 +0000

    Merge changes from topic "am-8acf63d1-cfe0-4950-98c3-1d2367987749" into nyc-mr2-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e am: 0eda2602cd
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c
      RESTRICT AUTOMERGE: Backporting of b/77821568

commit 3d38ba1f9bb53c3695a27f242feb28a3f5e56040
Merge: 0c8cc417d59 0eda2602cd2
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:25:42 2018 +0000

    Merge changes from topic "am-8acf63d1-cfe0-4950-98c3-1d2367987749" into cw-f-dev

    * changes:
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4
      [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c
      RESTRICT AUTOMERGE: Backporting of b/77821568

commit 97744596339239ef8f6f58743945c7e0294d99f2
Merge: 3c047ea7fa0 d22e9dfb6a6
Author: Atanas Kirilov <akirilov@google.com>
Date:   Wed Jun 27 23:25:27 2018 +0000

    Merge "Backporting of b/77821568" into oc-dev

commit 45f17c5bef44a01dcf2295fdf4cbdb95151490d6
Author: Dan Sandler <dsandler@android.com>
Date:   Wed May 2 20:01:38 2018 -0400

    P is for PAINT.

    Bug: 109925861
    Test: adb shell am start \
            -a android.intent.action.MAIN \
            -c com.android.internal.category.PLATLOGO
    Merged-In: Ic3020007c716be264e9523d6dbae9e13a95fa571
    Change-Id: Ic3020007c716be264e9523d6dbae9e13a95fa571

commit 97f62bf61db50288d3057127ea184b0937437df9
Author: Siddharth Ray <siddharthr@google.com>
Date:   Sun Jun 17 18:28:44 2018 -0700

    Fix in Wifi activity updates

    When Wifi firmware resets link layer stats, it sometimes returns a value
    for On time which is much larger than the duration of the report.
    On time = Idle time + Rx time + Tx time.
    This change prevents those errors from affecting Wifi power metrics.

    BUG:110325882
    Test:
    adb shell dumpsys batterystats
    WiFi Scan time:  12s 302ms
    WiFi Idle time:   5m 48s 634ms
    WiFi Rx time:     24s 232ms
    WiFi Tx time:     10s 510ms

    Change-Id: I7b69fc728b275f89154dd0c1d7382576ebfadc29

commit 9504cd35ec19878c1d72d5c8353f4fa761f0d846
Merge: a5c846c3fa7 da49a5ed331
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 27 19:26:42 2018 +0000

    Merge "ImageReader: Set inverse diplay transform if needed" into pi-dev

commit ef2910dc709d698b6476e8d462c608d04c784a26
Author: Bernie Innocenti <codewiz@google.com>
Date:   Mon May 28 22:04:37 2018 +0900

    vpn: allow IPSec traffic through Always-on VPN

    This won't leak any traffic outside the VPN as long as there are no
    processes owned by uid 0 which generate network traffic (which is
    currently the case).

    Bug: 69873852
    Test: compared the output of 'adb shell ip rule show' before and after
    Test: runtest -x frameworks/base/tests/net/java/com/android/server/connectivity/VpnTest.java
    Test: local CTS tests run: android.net.cts.VpnServiceTest
    Test: local CTS tests run: com.android.cts.devicepolicy.MixedDeviceOwnerTest
    Change-Id: I8758e576c9d961d73f62bfcf0559dd7ecee6e8e6
    Merged-In: I8758e576c9d961d73f62bfcf0559dd7ecee6e8e6
    Merged-In: I1f9b78c8f828ec2df7aba71b39d62be0c4db2550
    Merged-In: I8edeb0942e661c8385ff0cd3fdb72e6f62a8f218
    (cherry picked from commit 00000fe55a4729f8339afdc7eab5c970b2549813)

commit a5c846c3fa74d680eddca6b994b7cf8449d301ef
Author: Dan Sandler <dsandler@android.com>
Date:   Thu Jun 21 13:57:28 2018 -0400

    Activate dark theme when the UiMode is UI_MODE_NIGHT_YES.

    This change also activates night mode when the device enters
    battery saver (saving substantial power on OLED screens).

    Bug: 80307398
    Test: adb shell service call uimode 4 i32 1 # nightfall
          adb shell service call uimode 4 i32 2 # morningtide

    Change-Id: I9c08a749d4cd99ab7231363b045949eb2e830dfa

commit 694b4ae84690b75f400843cc5d65a3cae7679bd4
Merge: 6c90bf605e9 fdaa6494493
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 27 01:09:48 2018 +0000

    Merge "DO NOT MERGE Log notification interruptions to TRON" into pi-dev

commit e3834650856c0a49b543b3757a4370a68fe57ac6
Author: Lucas Dupin <dupin@google.com>
Date:   Tue Jun 26 15:58:51 2018 -0700

    Set initial KSV state after inflation

    In O and before, KeyguardSecurityVew#reset was always called
    before showing the view. In P it's not possible since reset()
    will make a series of binder calls and generate jank during
    swipe gesture.

    Because of this, reset() is called after inflation and only
    after the view isn't visible anymore.

    Fixes: 109972705
    Test: go/sysui-bouncer-tests
    Test: receive notification from AOD, double tap it.
    Change-Id: I9016924398930d470135851ba40c85f637a2c0d1

commit 6c90bf605e96e65b8949ecf3365f4d408faa7e71
Merge: 21ef4b3acbb 9ea21a43cd9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jun 26 23:24:30 2018 +0000

    Merge "Make BT icon more prominent" into pi-dev

commit 908111d2d79c5f48304f56176f35eecfaff15b63
Author: Matthew Ng <ngmatthew@google.com>
Date:   Tue Jun 26 15:22:56 2018 -0700

    Do not create highlight if track width is invalid

    Test: change display font size
    Change-Id: I29b97dee07d39b1b1efd4871b625a859d7fa2e09
    Fixes: 110814530

commit 21ef4b3acbb13ed6782ada2282e9ce3afe47a4a6
Merge: aa21ec053cf 730a25995ef
Author: Hall Liu <hallliu@google.com>
Date:   Tue Jun 26 22:00:17 2018 +0000

    Merge "Make RttTextStream's read interruptible" into pi-dev

commit aa21ec053cf2e80a0f53e650ed4e0da77c9f5c29
Merge: 70a9f39e6af 193677c2ed2
Author: Lucas Dupin <dupin@google.com>
Date:   Tue Jun 26 21:48:16 2018 +0000

    Merge "Do not animate scrims when launching camera" into pi-dev

commit fdaa64944935331841ba1ce8e193169578813bef
Author: Julia Reynolds <juliacr@google.com>
Date:   Mon Jun 18 09:29:19 2018 -0400

    DO NOT MERGE Log notification interruptions to TRON

    Test: manual
    Bug: 110209821
    Change-Id: Ic3521f36127aa0e928d0be5ce9819c78c2bc9bc5

commit 70a9f39e6af4412b64b118ee3431595ea961ffd5
Merge: 116158689c5 c19da782031
Author: Andrew Sapperstein <asapperstein@google.com>
Date:   Tue Jun 26 20:03:38 2018 +0000

    Merge "Hide system apps until installed (1/2)" into pi-dev

commit 193677c2ed2286b773edffb8b36e21347db759ce
Author: Lucas Dupin <dupin@google.com>
Date:   Mon Jun 11 19:16:03 2018 -0700

    Do not animate scrims when launching camera

    There's already a black overlay with a camera icon, it's not necessary
    to animate the scrims.

    Change-Id: I52472372420eb8ba052a17cdde147d24dafadce0
    Fixes: 109767309
    Test: double tap power button from lock screen and aod

commit 116158689c53c5b8873ee4757c2c6d308454ac60
Merge: fd77e69f284 b7ffb5fde54
Author: Laura Davis <laurabd@google.com>
Date:   Tue Jun 26 16:42:43 2018 +0000

    Merge "Docs: fixed variables" into pi-dev

commit fe6d4769a86b1ab4cf9b5b20ea08f4e3ccd00ec6
Author: Shawn Willden <swillden@google.com>
Date:   Sat Jun 23 15:38:02 2018 -0600

    Correct the keystore alias used for secure imports

    An Android-O timeframe refactor removed all use of keystore "skey"
    aliases.  Creating one not only partially reverses that refactor, but
    it also results in a key alias which cannot be deleted in some cases,
    causing AndroidKeyStoreTest failures during the second run of CTS.

    Bug: 80228327
    Test: CTS tests ImportWrappedKeyTest and AndroidKeyStoreTest, in that order
    Change-Id: I348ba421f29cdf6c65fc98be3a25d19938d559c1

commit fd77e69f284ed85e9f0ee4add387af399d114525
Merge: cea247e135d 5db9ae40013
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Tue Jun 26 11:34:03 2018 +0000

    Merge "Defer stop for all activities becoming invisible" into pi-dev

commit da49a5ed3312f104dd0a1d5a4e468d3558ac0a90
Author: Emilian Peev <epeev@google.com>
Date:   Tue Jun 26 10:13:39 2018 +0100

    ImageReader: Set inverse diplay transform if needed

    Image transform sometimes could be missing the inverse
    display flag. Any buffers that pass through BQs will
    have this bit reset and moved in a separate buffer item
    field. To restore and pass the original transform forward
    check whether the flag got reset and re-enable it
    accordingly.

    Bug: 110641448
    Test: Manual using application,
    Camera CTS

    Change-Id: Ia849f62333be40038a02768563b2f93e2ccf61ce

commit a5c3fb10f25768f62f796f75b4b9f6b4962b19ab
Author: junyulai <junyulai@google.com>
Date:   Mon Jun 25 21:51:14 2018 +0800

    DO NOT MERGE: use legacy way to get tcp packet count

    The current networkStats getIfaceStats implementation check if
    bpf is enabled, and use bpf to get all traffic stats. However,
    the bpf implementation did not contain tcp packet counts. So
    data stall detection in DcTracker could not get the packet
    count to trigger data stall. Hence the data stall never
    triggers for device that enables bpf.

    This solution is for short term solution that rollback the
    design to use xt_qtaguid for bpf enabled device.

    Bug: 110443385
    Test: 1. fake data stall to trigger data stall recovery
          2. enable debug log to make sure tcp packet count is
             correct
          3. runtest frameworks-net
          4. run cts -m CtsUsageStatsTestCases

    Change-Id: I1ce9e92fe194da2ea0a3eec014fd50bb50cdd44a

commit 730a25995efb2b5646a5d42ce83cfc3dbef6ee74
Author: Hall Liu <hallliu@google.com>
Date:   Mon Jun 25 19:48:33 2018 -0700

    Make RttTextStream's read interruptible

    Wrap the FileInputStream in a java.nio.Channel so that sending a
    Thread.interrupt() to the thread blocked on the read will actually do
    something.

    Change-Id: Icc11ba69167f448e2b33d9a1a13a1dfa5e5d0d58
    Fixes: 110570772
    Test: manual (follow repro steps in bug, but type really fast),treehugger

commit c19da782031418a8de2c20f56547c5956adeb9d5
Author: Rhed Jao <rhedjao@google.com>
Date:   Wed Jun 13 11:16:16 2018 +0800

    Hide system apps until installed (1/2)

    Applying this mechanism for system carrier apps to make visibility
    reasonable from the user's perspective. In other words, before
    hidden system apps have been installed, they wouldn't be listed
    via APIs in PackageManager which are used at all apps list and
    search in Settings and so on.

    Test: atest CarrierAppUtilsTest
    Test: atest PackageManagerTest
    Test: cts DeviceOwnerTest
    Test: gts ManagedProfileProvisioningHostsideTest
    Bug: 74068582
    Change-Id: I1f23aba589b98351a1871a44a3058b67c416f351

commit cea247e135dd8059098ac8c4aec7c573e830d878
Merge: e07aeea9268 d50edd004b6
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 25 23:20:23 2018 +0000

    Merge "Don't apply filter in readback, when there is no scaling" into pi-dev

commit 7c71bb2703043914d255ed09017ffa556f8440c5
Author: Santiago Etchebehere <santie@google.com>
Date:   Mon Jun 25 15:58:13 2018 -0700

    Force redraw after wallpaper is loaded

    Use mNeedsDrawAfterLoadingWallpaper to determine if redraw
    is needed.

    Test: manual: set different wallpapers, or use the sample
    app in b/110432281

    Change-Id: Ibd5639ce59e9b59869f067705b9db25f7de8b201

    Fixes: 110432281
    Bug: 110432281
    Bug: 109972857

commit e07aeea9268e9e7ea7c7849589d4c70ed3381d56
Merge: 0dabb070b86 3175696a46d
Author: Laura Davis <laurabd@google.com>
Date:   Mon Jun 25 21:27:48 2018 +0000

    Merge "docs: fixed broken link" into pi-dev

commit 5db9ae400139535381a0290efe2149cc63a24fc7
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Mon Jun 25 16:14:50 2018 +0200

    Defer stop for all activities becoming invisible

    If we are deferring a stop until a window is becoming visible,
    it's a good idea to also defer stopping all other activities that
    are go into stopping state to avoid flickers.

    Furthermore we need to fix an issue where activities weren't
    cleared from mActivitiesWaitingForVisibleActivity which messed
    up the newly introduced logic.

    This fixes an issue with quickstep when swiping right and the
    previous activity hasn't finished pausing yet when we start the
    new activity. In the normal case, prev=Launcher and all is fine,
    as we wait with stopping launcher until the animation is done. In
    the bad case, prev=the previous activity that was on screen before
    swiping, so Launcher doesn't get added to the waiting list, which
    means that it will be stopped too early, aborting the animation
    because Launcher is also driving it.

    Test: ActivityManagerDisplayLockedKeyguardTests
    Test: go/wm-smoke
    Test: Swipe right from Chrome to any other app, observe no jump
    Fixes: 80313326
    Bug: 110032866
    Change-Id: I39454fe218ac10ef73cc4ca23efc7c9fb3bc87ad

commit 0dabb070b8674f98556d566963aff8bc41bbb79b
Merge: 5f5c6e993fa a67c2d86018
Author: Laura Davis <laurabd@google.com>
Date:   Mon Jun 25 20:46:59 2018 +0000

    Merge "docs: fixed typo in deprecation message" into pi-dev

commit 5f5c6e993fa918bde8628bc7b9913f322b04ffed
Merge: 0f949c4f9cf 4fa3a9d4cf4
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 25 20:39:46 2018 +0000

    Merge "Quick scrub has gradient follow user drag" into pi-dev

commit 0f949c4f9cfcf9acf9b1256b5246ac47371ce476
Merge: f10ae7e7317 3311624d549
Author: Laura Davis <laurabd@google.com>
Date:   Mon Jun 25 20:09:17 2018 +0000

    Merge "docs: fixed broken link" into pi-dev

commit b7ffb5fde541185ff6d3495a73e0c4402a4f8b15
Author: Laura Davis <laurabd@google.com>
Date:   Mon Jun 25 13:05:24 2018 -0700

    Docs: fixed variables

    Test: make ds-docs

    Bug: 25134282
    Change-Id: Ic91dd3820a409f0f28e23575090e3fd624a0fac0

commit 4fa3a9d4cf454cfc00c4d3ee79ee6ac8864a2fed
Author: Matthew Ng <ngmatthew@google.com>
Date:   Tue Jun 12 16:42:11 2018 -0700

    Quick scrub has gradient follow user drag

    Removed the track drawable and draws a gradient translated to the
    position of the drag of the user as the track's background.

    Test: quickscrub
    Change-Id: Iee893e5f96f4954c77307c5ff9b762a04bd7de9a
    Fixes: 109882517

commit 9ea21a43cd9d99a2c86957204ac2d2906041f102
Author: Evan Laird <evanlaird@google.com>
Date:   Mon Jun 25 13:48:26 2018 -0400

    Make BT icon more prominent

    Bluetooth is now rated higher than work profile, cast, and vpn. Also
    move volume to the other side of location per the spec.

    Test: visual
    Change-Id: I169ec5e6d09355e0237aad2f6ee586069d93fd36
    Fixes: 110475634

commit f10ae7e7317b0c7241ff87163017cd5feda8af1f
Author: Pavel Grafov <pgrafov@google.com>
Date:   Mon Jun 25 12:13:38 2018 +0100

    Restore separate challenge state on error

    Otherwise if something goes wrong when tying the profile to the primary
    user, challenge will remain in inconsistent state and the user won't
    be able to unlock the profile.

    Bug: 110262879
    Test: manual, unified both compliant and uncompliant challenge.
    Change-Id: I2bea3867541f43cbabd5cabbe8a0f61acc2602ca

commit 0eb2be3a679b146e068cf99e2dbf45b4181c0bfa
Merge: a749cd584e8 95951a341ed
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Sat Jun 23 08:05:06 2018 +0000

    Merge "Conserve expansion after re-inflation" into pi-dev

commit 95951a341ed0208a455f8e32ba54734e70c36dcd
Author: Lucas Dupin <dupin@google.com>
Date:   Thu Jun 21 11:41:34 2018 -0700

    Conserve expansion after re-inflation

    We were updating most of the PhoneStatusBarView state during
    re-inflation but not the expansion and its fraction.

    Test: Pull down shade, run: adb shell service call overlay 4 s16 "com.android.systemui.theme.dark" i32 1 i32 0
    Test: Switch to guest user, switch back
    Test: Reboot, look at status bar
    Change-Id: I41669fb32419ad02a11586ba248a68b47d450413
    Merged-In: I41669fb32419ad02a11586ba248a68b47d450413
    Fixes: 110530608
    Fixes: 110147405
    Fixes: 79122419

commit a749cd584e8f5320e0c1ecc77edd5c2b13cc6d29
Merge: d2aadbfd936 470c698c5a1
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Sat Jun 23 00:11:04 2018 +0000

    Merge "Camera: Update surface sharing format restrictions" into pi-dev

commit a67c2d860188982192d7bd31d3ba9d6d13feb551
Author: Laura Davis <laurabd@google.com>
Date:   Mon Jun 11 10:33:17 2018 -0700

    docs: fixed typo in deprecation message

    Test: make ds-docs

    Bug: 68303139
    Change-Id: I7fc9f35bc118f8b661740a46f52d62beea1e67f1

commit d2aadbfd93699b8cc2c4d62bd526df0a6eaa1356
Merge: 95b7c25a58e 902fefdcd20
Author: Kevin Hufnagle <khufnagle@google.com>
Date:   Fri Jun 22 21:58:38 2018 +0000

    Merge "docs: Edited UNINSTALL_SHORTCUT permission desc." into pi-dev

commit d50edd004b60bec3f1d36066725129276b4a53ec
Author: Stan Iliev <stani@google.com>
Date:   Fri Jun 22 17:33:43 2018 -0400

    Don't apply filter in readback, when there is no scaling

    Fix check for scaling in SkiaOpenGLReadback: old code was not
    taking into account that matrix rotation swaps width/height.

    Test: Passed PixelCopyTest#testWindowProducerCopyToRGBA16F
    Bug: 110097060
    Change-Id: I0d26416fa72a026bc376417773d5a73548b1f1a5

commit 22e89f4773d9cbc8f5911b65b2dae3e3add7bdb6
Author: Amit Mahajan <amitmahajan@google.com>
Date:   Tue Jun 5 16:27:32 2018 -0700

    Add new carrier config for CDMA registered PLMN when not roaming.

    Test: manual
    Bug: 80145031
    Change-Id: I6533b4097f729df88f287348924563c6f459401c

commit 95b7c25a58e51f97cde349e1aef3c1d87c156830
Merge: 3a09ade4d1b 472d3e4898b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jun 22 19:24:08 2018 +0000

    Merge "Allow quickscrub after deadzone consumes touch" into pi-dev

commit 3a09ade4d1bbe42151f777889c6f66824f9b6f2a
Merge: cbf554b78b9 2f0d73cac89
Author: Andrii Kulian <akulian@google.com>
Date:   Fri Jun 22 18:14:25 2018 +0000

    Merge "Skip updating stack config if it is detached from a display" into pi-dev

commit cbf554b78b9cc00b027401b1022e95aed1344615
Merge: bd62416618a d41106c52e0
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jun 22 17:52:26 2018 +0000

    Merge "SettingsBackupAgent: notify of apBand conversion" into pi-dev

commit bd62416618a7bdd8fd5bfdb0464d2dcf805924a4
Merge: 7f4e9739e4e 34044ac429a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jun 22 17:12:54 2018 +0000

    Merge "Do not announce selected state for QS tiles." into pi-dev

commit 7f4e9739e4e304842e865e68b0c3573445ce9eba
Merge: a063da83f1e c9afb8ba064
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jun 22 15:19:20 2018 +0000

    Merge "Remove managed profile toast" into pi-dev

commit 472d3e4898b513441b5c9d5a171933f01c7895da
Author: Matthew Ng <ngmatthew@google.com>
Date:   Thu Jun 14 15:16:55 2018 -0700

    Allow quickscrub after deadzone consumes touch

    Moved deadzone detection to QuickScrubController so that quick scrub can
    still occur. If anything is consumed by deadzone, no other touches will
    occur however quickscrub can be detected and function with launcher. No
    other events except for touch down will be sent to launcher.

    Test: scrub right above the home button
    Change-Id: I4b4e7a8eacf8fe38d8644116a526c175adaba790
    Fixes: 80536498

commit a063da83f1e57fdea9fa36858181dd66c7080656
Merge: b2ad5f251cd 54ff81b81ea
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 21:18:36 2018 +0000

    Merge "Add config to disallow the battery % option" into pi-dev

commit b2ad5f251cdfd38cd90db204479cf41e4fadfe41
Merge: 43999195e92 ebd047e92fe
Author: Julia Reynolds <juliacr@google.com>
Date:   Thu Jun 21 14:15:26 2018 -0700

    Merge "Catch unbinding errors" into oc-mr1-dev
    am: ebd047e92f

    Change-Id: Ifd29c608bb23afb5ed630d9fc57d40f41b7d0921

commit ebd047e92fe9542101bb1498760c98c4cef94411
Merge: d4a1791bd7a 2107bea9c4b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 21:00:27 2018 +0000

    Merge "Catch unbinding errors" into oc-mr1-dev

commit 43999195e92c786c0414777252ef2bacabc13b6c
Merge: 1fa57517893 278e7d6db35
Author: Selim Cinek <cinek@google.com>
Date:   Thu Jun 21 20:40:56 2018 +0000

    Merge "Only enable setAntiBurnInOffsetX() in AOD(Ambient) condition" into pi-dev

commit 1fa575178935d979a499540806d8f7983b1bb6d3
Merge: cba5f927682 6b302d0afb2
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 18:55:33 2018 +0000

    Merge "Always ignore summaries" into pi-dev

commit cba5f927682a12a869a03ffdbf19e6fd15558588
Merge: 063ead3e1f2 17106bd99cd
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 18:35:27 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit 063ead3e1f225c2f666abc905d954f5e29287015
Merge: ebfd27503a5 43b3e9731d9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 18:33:40 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit ebfd27503a586954eadc14e6a018f1b241388562
Merge: 766259698af b881e8aedf7
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 18:11:30 2018 +0000

    Merge "Import translations. DO NOT MERGE" into pi-dev

commit 766259698af1daab809064d42c58de81c957a785
Merge: 0fb45603fed 1c27bb7a541
Author: Tyler Gunn <tgunn@google.com>
Date:   Thu Jun 21 18:10:16 2018 +0000

    Merge "Update docs and ensure PHONE_STATE is more predictable for unknown numbers." into pi-dev

commit c9afb8ba064174df8112d6cf2bea5b5d2170b47a
Author: Julia Reynolds <juliacr@google.com>
Date:   Tue Jun 19 15:12:42 2018 -0400

    Remove managed profile toast

    Change-Id: I9f324a94d7fab35b0f00a1bd9c675708dac6f85a
    Fixes: 110418889
    Test: atest SystemUITests

commit 43b3e9731d93aa2d35cc505332b269262c0e7582
Author: Bill Yi <byi@google.com>
Date:   Thu Jun 21 09:42:26 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: Ia75664c86821774661b830e2fc6ed8ef0392f58c

commit 0fb45603fed316e19385c683ea9c210fe069b6c2
Merge: 80167ec0c72 45611dd8d46
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 16:10:35 2018 +0000

    Merge "Fix issue with manual touch dispatch" into pi-dev

commit 6b302d0afb29f46bf699f8c566cbd7a758487432
Author: Julia Reynolds <juliacr@google.com>
Date:   Tue Jun 19 15:39:23 2018 -0400

    Always ignore summaries

    Test: runtest systemui-notification
    Bug: 78643290
    Change-Id: Ia036e528666af336897431dd11efeffc92accdc7
    (cherry picked from commit 760fa7613ef7ca7aee25c76a147cf29114268af2)

commit b881e8aedf746e5166a5a80460ca9b9e7f309814
Author: Bill Yi <byi@google.com>
Date:   Thu Jun 21 05:09:41 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: If0cc65463dca8363427a9021601aee4401caccaa

commit 17106bd99cd64ffcceaecb82dee8dd967f610e8c
Author: Bill Yi <byi@google.com>
Date:   Thu Jun 21 00:55:32 2018 -0700

    Import translations. DO NOT MERGE

    Auto-generated-cl: translation import

    Bug: 64712476
    Change-Id: I5e7887dbf5d42f3ff85a303356dc74c78c55b863

commit 80167ec0c723d9843fbe7056ea2a53c5a8c254b3
Merge: eec75058baa 59998305570
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 06:07:22 2018 +0000

    Merge "Stabilize hidden API lists" into pi-dev

commit eec75058baa2eff867b084b4ff0671e4c2e9f955
Merge: d7c87b74d9c 43536175f2c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 21 05:21:01 2018 +0000

    Merge "More light grey APIs." into pi-dev

commit d7c87b74d9cb8d1c334368316aee010635b18446
Merge: 89945c5a222 d4f64f27b0d
Author: Marco Nelissen <marcone@google.com>
Date:   Wed Jun 20 22:14:33 2018 +0000

    Merge "Fix race condition in MediaHTTPConnection" into pi-dev

commit 43536175f2c29b1dcb15e3e104bd1aa11a0f3a4a
Author: Nicolas Geoffray <ngeoffray@google.com>
Date:   Wed Jun 13 21:22:06 2018 +0100

    More light grey APIs.

    bug: 110157261
    bug: 110065832
    bug: 110179435
    bug: 110174713
    bug: 110191494
    bug: 110282922
    bug: 110289776
    bug: 110314356
    bug: 110340642
    bug: 110382035
    Bug: 110444248
    Bug: 110447432
    bug: 110378707

    Test: m
    Change-Id: I5d7c0f9d471eab22e23cc335f03cebecb642f871

commit 89945c5a222ab2761ab086588c1ac5434cca661f
Author: Julia Reynolds <juliacr@google.com>
Date:   Wed Jun 13 10:45:21 2018 -0400

    Don't throw uri exceptions for user chosen sounds

    Bug: 109889733
    Test: runtest systemui-notification
    Change-Id: I5ed599deca83f97899affce44e3ed8fbcacae366
    (cherry picked from commit 218871ee3ffffea964658be327ffd06e1e3eed61)

commit 1c27bb7a541d5a69b85c85f04e1f93dba7c76422
Author: Tyler Gunn <tgunn@google.com>
Date:   Tue Jun 19 09:55:43 2018 -0700

    Update docs and ensure PHONE_STATE is more predictable for unknown numbers.

    In P the PHONE_STATE broadcast behavior changed due to new permission
    requirements.  Updating the API docs for this broadcast to make it more
    clear to developers how the broadcast will work given different permission
    scenarios.

    Also, made a minor change to how the "EXTRA_INCOMING_NUMBER" is populated
    on the phone state broadcast.  Originally we opted to remove
    EXTRA_INCOMING_NUMBER when the number is empty.  Developer feedback reveals
    it is difficult to know for an unknown caller (where numer is empty)
    whether the broadcast they're receiving is the one associated with the
    broadcast for receivers with READ_CALL_LOG, or the one for receivers
    without it.  This minor change eliminates the need to count broadcasts and
    instead allows the developer to just focus on whether the extra is present
    or not.

    Test: make docs and verify the javadoc appears as expected.
    Test: Used test app to confirm functionality.
    Bug: 110190165
    Change-Id: I35967d53274b99d66b63f4ff5acb60a689745f9d

commit d4f64f27b0de1c5d21c93b4d73acd05ede28fde2
Author: Marco Nelissen <marcone@google.com>
Date:   Tue Jun 19 12:38:23 2018 -0700

    Fix race condition in MediaHTTPConnection

    getSize() and getMIMEType() rely on seekTo() having completed.
    If seekTo() was called on a different thread, for example because
    NuCachedSource2 was doing reads on a background thread, getSize()
    could return -1 if it was called after connection was established,
    but before the response had been parsed.

    Bug: 110230427
    Test: manual
    Change-Id: I469b47e025f1c7a7ef3123d3347668f0541e6f2d

commit 45611dd8d46183500dd28b75d07b29f4f174728f
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Tue Jun 19 17:27:08 2018 +0200

    Fix issue with manual touch dispatch

    Need to dispatch it to the view that guards against the disabled
    flags.

    Change-Id: I0082ef24ed6aa06631f475cc33a0cf3f5f138911
    Merged-In: I0082ef24ed6aa06631f475cc33a0cf3f5f138911
    Fixes: 110228458
    Test: Expand above notch from SUW

commit bbe6ee065d2f4ad0f6e27c3b1811b177e06dcb2b
Merge: 1e1635a45e5 9a5f05b22f6
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 20 07:47:35 2018 +0000

    Merge "Clean up RemoteCallbackList when we're done with it." into pi-dev

commit 1e1635a45e5cad1bca08ac71b9a4175fd1d5990b
Merge: 4cc443ae2e4 4080a1bd155
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 20 04:28:50 2018 +0000

    Merge "Prefer default Internet network for upstream tethering." into pi-dev

commit 278e7d6db351930a199b2f864809b7c22b971a71
Author: Bill Lin <lbill@google.com>
Date:   Wed Jun 13 18:07:15 2018 +0800

    Only enable setAntiBurnInOffsetX() in AOD(Ambient) condition

    NotificationPanelView detect the ACTION_DOWN X-position for expanding Panel
    and dispatch x-offset to QSFrame and StackScroller
    However, StackScroller reset the translateX via updateAntiBurnInTranslation()
    Base on previous patches to enhance setAntiBurnInOffsetX policy
         1. ag/3536525 (Fixes: 72527703)
         2. ag/3846247 (Fixes: 77541088)

    Test: atest packages/SystemUI/tests/src/com/android/systemui/statusbar/stack/NotificationStackScrollLayoutTest.java
    Change-Id: I52c86e865d97282e40b6f2847a2ff0190e4d80e9
    Fix: 110102296

commit 4cc443ae2e4811a968f2e5cd85f78db84e18d70d
Merge: 6eb9ce63b89 5f05f1e4055
Author: Brad Ebinger <breadley@google.com>
Date:   Tue Jun 19 22:36:52 2018 +0000

    Merge "Revert isResolvingImsBinding ITelephony interface" into pi-dev

commit 6eb9ce63b89d4028d4ce7428400aa113f77047b3
Merge: 941189bf283 9e2a8235bd1
Author: Yu-Han Yang <yuhany@google.com>
Date:   Tue Jun 19 21:08:48 2018 +0000

    Merge "Enable REQUEST_LOCATION from GNSS HAL" into pi-dev

commit 941189bf2839e5551de1a3d44e573dd3aae6c54b
Merge: 1b65af27d89 6c73e409fcc
Author: Shuzhen Wang <shuzhenwang@google.com>
Date:   Tue Jun 19 20:19:38 2018 +0000

    Merge "Camera: codegen doc update" into pi-dev

commit 902fefdcd2028d3cca7ec2fc313face518bcbf76
Author: Kevin Hufnagle <khufnagle@google.com>
Date:   Fri Feb 2 11:07:15 2018 -0800

    docs: Edited UNINSTALL_SHORTCUT permission desc.

    Added a callout and a message that more strongly discourages use of
    the UNINSTALL_SHORTCUT permission.

    Test: make ds-docs -j16

    Bug: 72864896
    Change-Id: Iacb7a1718c4688e9061bdfd3b50b7afc8f170abb

commit 5f05f1e405526208e59bc6cb5f061783855ae505
Author: Brad Ebinger <breadley@google.com>
Date:   Wed Jun 13 17:11:50 2018 -0700

    Revert isResolvingImsBinding ITelephony interface

    Reverting the only user of this interface.

    Bug: 109762920
    Test: GTS/Unit tests for ImsService
    Change-Id: Id2e1ac2e4fbbcb7f019e79568f21ee56c94b6c1f
    Merged-In: Id2e1ac2e4fbbcb7f019e79568f21ee56c94b6c1f

commit 470c698c5a16d85b3492415fd1ba4abf3540f0de
Author: Emilian Peev <epeev@google.com>
Date:   Tue Jun 19 13:43:18 2018 +0100

    Camera: Update surface sharing format restrictions

    Surface sharing supports all formats except jpeg and
    RAW private.

    Bug: 110412079
    Test: documentation builds without errors.
    Change-Id: I72c5d744fed1b62eedd7a83522021ebad17e49b7

commit 3175696a46d20d0b83bf8237e3230631c57a0797
Author: Laura Davis <laurabd@google.com>
Date:   Mon Jun 18 16:09:32 2018 -0700

    docs: fixed broken link

    Test: make ds-docs

    Bug: 76021493
    Change-Id: Ide61b82925270896e373083fdc1d5c27c9bdc819

commit d41106c52e0cdd6fb44381aa9a1b058889968846
Author: Rebecca Silberstein <silberst@google.com>
Date:   Fri Jun 1 17:31:40 2018 -0700

    SettingsBackupAgent: notify of apBand conversion

    Added support to notify user of a change to their softap configuration
    preferences after being restored via SettingsBackupAgent.

    Bug: 80251951
    Test: frameworks/opt/net/wifi/tests/wifitests/runtests.sh
    Test: manually confirmed configs are converted for different device
    Change-Id: I4cec15549d694cdb1a7b09f1426d027eec021122

commit 4080a1bd15572caf149762e45c958627feceb74d
Author: Erik Kline <ek@google.com>
Date:   Thu Jun 14 17:36:40 2018 +0900

    Prefer default Internet network for upstream tethering.

    Rather than use the crufty config.xml list of upstream transport types,
    use ConnectivityService's notion of the default network for the upstream.
    In cases where a DUN network is required and the default network is
    currently a mobile network, look for a DUN network (code in Tethering
    is currently responsible for requesting one).

    Test: as follows
        - built, flashed, booted
        - runtest frameworks-net
        - tethered via mobile, joined captive portal network, maintained
          laptop access via mobile until captive passed (then used wifi)
        - disabled client mode wifi, disabled mobile data, plugged in
          ethernet adapter, observed connectivity via ethernet
    Bug: 32163131
    Bug: 62648872
    Bug: 63282480
    Bug: 109786760
    Bug: 110118584
    Bug: 110260419
    Change-Id: I925b75994e31df8046f3ef9916a2457b4210485e

commit 6c73e409fccf4b2e1b4a5f4bac2eea1c07480e16
Author: Yin-Chia Yeh <yinchiayeh@google.com>
Date:   Fri Jun 15 15:37:08 2018 -0700

    Camera: codegen doc update

    Test: N/A. Doc update
    Bug: 109666939
    Change-Id: I2bd176a7f5ada755c8a79201d142a98131e2e82c

commit 3311624d549e2a6f168e6b8ab0abea4b9aa09296
Author: Laura Davis <laurabd@google.com>
Date:   Mon Jun 18 14:49:23 2018 -0700

    docs: fixed broken link

    Test: make ds-docs

    Bug: 110243990
    Change-Id: Ia6f487ce88d59def5d6974c0d63d67c29ec5cf34

commit 1b65af27d897ccfbfb7b61c7176cb6a670a9519c
Merge: 0e52664b0ca 7749c9a5e93
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 18 18:42:47 2018 +0000

    Merge "Fix NotificaitonPanelView x-axis shift with IME" into pi-dev

commit 0e52664b0cae01ab8cf53ae784bfec79ebd9bf98
Merge: ed9df0d1761 f8463ee0435
Author: Lucas Dupin <dupin@google.com>
Date:   Mon Jun 18 18:08:41 2018 +0000

    Merge "Fade to black without showing system wallpaper" into pi-dev

commit 7749c9a5e93b38f795afaa8409771645189dea2e
Author: felkachang <felkachang@google.com>
Date:   Mon Jun 11 15:56:15 2018 +0800

    Fix NotificaitonPanelView x-axis shift with IME

    IME will trigger the fitSystemWindow. And, there is a difference of
    the parameter insets between IME and no IME. The insets.right and
    insets.left report 0 without IME but positive number with IME
    because IME is a type of system window and trigger fitSystemWindow
    and then take the cutout as part of system window.

    StatusBarWindowView handle the following condition
    cutout > 0 && cutout == systemWindowInset and make its children not
    layout on the safe inset both of cut out and system window. In order
    to handle that cut out become system window, to take the maximum of
    cut out and system window to make sure that the safe inset is
    decided in StatusBarWindowView and its view decent only care about
    the corner cut out.

    Because StatusBarWindowView make both of PhoneStatusBarView's parent
    and NotificationPanelView to have the margin for both of cutout and
    system window, the counting of the padding and panel translation of
    the HeadsUpStatusBarView need to do the relative changes.

    Change-Id: Iafdc6a85e0e7d360b1bfc1e820f6e0779c32753f
    Fix: 79957419
    Fix: 109945733
    Fix: 109865908
    Test: atest SystemUITests

commit ed9df0d1761e186616bb8e174d04d6433d475c8b
Merge: 32066387e1e f4b04ae0bb9
Author: Selim Cinek <cinek@google.com>
Date:   Mon Jun 18 17:32:20 2018 +0000

    Merge "Fixed an issue where the contentHeight was wrong" into pi-dev

commit 32066387e1ead357943e25ebccedcf0ed15b12a3
Merge: e8a1e7a423a 2a6bdfd9082
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 18 16:57:24 2018 +0000

    Merge "Pulse animation synchronization" into pi-dev

commit f8463ee04358e7f421918bf07a9ebe653d3c7c4e
Author: Lucas Dupin <dupin@google.com>
Date:   Mon Jun 11 16:18:15 2018 -0700

    Fade to black without showing system wallpaper

    When on the lock screen, and going to AOD animated, user would
    temporarily see the system wallpaper. That's not what we want,
    we want to fade from semi-transparent black to black, on top
    of the backdrop - lock screen wallpaper or media art.

    Test: press power on the lock screen when playing media
    Test: press power on the lock screen after dismissing media
    Test: unlock from AOD
    Test: atest packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/ScrimControllerTest.java
    Fixes: 80575770
    Change-Id: I6796e844add889ff86be0cd2052db7c5d5073039

commit e8a1e7a423ae8bc29942c7eec394c60b170c0a68
Merge: 58150a7e6eb 0fca17c2a6a
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Mon Jun 18 15:52:09 2018 +0000

    Merge "DO NOT MERGE Fix crash in case of no overlays" into pi-dev

commit 58150a7e6eb2be82df97abb683971f764ddefc28
Merge: ef4a56f9e45 af0d6d26d17
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Mon Jun 18 15:25:03 2018 +0000

    Merge "Prevent showing windows while animating to avoid color mode switch" into pi-dev

commit 5999830557004ec70158e91cde2e9ff4e52dbb74
Author: David Brazdil <dbrazdil@google.com>
Date:   Fri Jun 15 14:05:42 2018 +0100

    Stabilize hidden API lists

    Hidden API lists are auto-generated using a combination of Doclava
    /Makefile rules and manually curated lists. As OEMs make their own
    changes to the framework, they might arrive at slightly different
    lists. This is not desirable as the entire ecosystem should enforce
    the same rules. This patch adds the files generated by Doclava to
    the code base, which will stabilize the lists for everyone.

    The problem is exacerbated by the fact that the Doclava-generated
    private-dex.txt contains only classes explored by Doclava. This can
    change rather unexpectedly as OEMs make changes and start/stop using
    internal classes otherwise only used in unexplored code. If the file
    is extended, they might start blacklisting new APIs. If the file
    shrinks, they might start whitelisting APIs they should restrict
    access to and have trouble passing CTS.

    (Avoid merging out of pi trees)

    Test: m ; check that produced lists have not changed
    Bug: 109824927
    Merged-In: I0e9653d9cd7e4b748870bacb6fbcecae535ebb2a
    Change-Id: I1463a06d6510e7051a64d5d516f4c589638ca11c

commit af0d6d26d172716e31f3ea7a12169ea39ac8e905
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Fri Jun 8 15:25:35 2018 +0200

    Prevent showing windows while animating to avoid color mode switch

    If we switch the color mode during a transition, it's pretty much
    guaranteed that SF is going to jank. To work around that, we
    disallow showing the real content while an activity with a
    non-standard-color mode is animating.

    Test: Reopen photos, observe no jank
    Bug: 79878256
    Change-Id: Id27db483844d9424ccfb9afdebd31325eae0cdd8

commit 0fca17c2a6a83d2d7300baa5ae52f3f05ee16384
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Mon Jun 18 14:24:11 2018 +0200

    DO NOT MERGE Fix crash in case of no overlays

    Fixes: 110330180
    Test: Rotate a device without overlays/cutout
    Change-Id: Ib0701e26893489fcee0de6aaec26901aef0b8348

commit ef4a56f9e45687c7cc5c0f2b95c4705779b5483f
Merge: 42fb737d139 8fed14cdcbb
Author: Ahmed ElArabawy <arabawy@google.com>
Date:   Mon Jun 18 12:26:40 2018 +0000

    Merge "WiFi: Add configs for SAR support of body sensors" into pi-dev

commit 42fb737d139697802d6213c6d4d568acd6c746fb
Merge: 8d70303da76 d4a1791bd7a
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 18 00:23:36 2018 -0700

    Merge changes from topic "am-aabaca13-84ab-4de5-bfa1-2add13867c06" into oc-dev am: 3c047ea7fa am: 3cca4e7b06
    am: d4a1791bd7

    Change-Id: I165a9d006345b6624877fc3b453ceb2b0baa83fb

commit 8d70303da765ca4819573d04eb07a13a8cb8ae00
Merge: 15123e02303 bc1dc5c3680
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 18 00:15:09 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 422582d9c4 skipped: b06ba83b23 am: 437da4c13d  -s ours am: f57c14b641  -s ours
    am: bc1dc5c368  -s ours

    Change-Id: Ied727ed9887bc299b944611f1caed5896d8e81ce

commit d4a1791bd7ab60bc619f4f897458eac0334c38f4
Merge: bc1dc5c3680 3cca4e7b068
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 18 00:09:08 2018 -0700

    Merge changes from topic "am-aabaca13-84ab-4de5-bfa1-2add13867c06" into oc-dev am: 3c047ea7fa
    am: 3cca4e7b06

    Change-Id: Ifaa547b16411e79759647dd9cc53ea76526f5e5d

commit bc1dc5c3680c49c79b4b24013df46b7fadfa54f9
Merge: 97ee1837475 f57c14b641a
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 18 00:02:54 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 422582d9c4 skipped: b06ba83b23 am: 437da4c13d  -s ours
    am: f57c14b641  -s ours

    Change-Id: Id5433baa969e08bd0253cb921bdaa541a1eaad3a

commit 3cca4e7b068ea4f0fd69394b50f4993dfeca106c
Merge: f57c14b641a 3c047ea7fa0
Author: Bill Yi <byi@google.com>
Date:   Sun Jun 17 23:55:44 2018 -0700

    Merge changes from topic "am-aabaca13-84ab-4de5-bfa1-2add13867c06" into oc-dev
    am: 3c047ea7fa

    Change-Id: Ie97567da2988d921748f9b4ca86f658a5222f43b

commit f57c14b641a6233191d688dbe5ec57c823b377dd
Merge: d996012ef50 437da4c13df
Author: Bill Yi <byi@google.com>
Date:   Sun Jun 17 23:53:27 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 422582d9c4 skipped: b06ba83b23
    am: 437da4c13d  -s ours

    Change-Id: I8227403ab7fa849fcc096d3a0acfa583843abf3b

commit 15123e02303f4b094a704317b1801b325ff6b3b7
Merge: c5901f5a068 97ee1837475
Author: Bill Yi <byi@google.com>
Date:   Sun Jun 17 23:33:25 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: cbc81e618d skipped: 693ad9800b am: cb1a10f5b6  -s ours am: d996012ef5  -s ours
    am: 97ee183747  -s ours

    Change-Id: I606378e5028548c5189a9fe554a868512112578c

commit 6f3df0d16b7f88b202ce04c79c061524dd7e6152
Merge: 693ad9800b4 b06ba83b23b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 18 06:27:04 2018 +0000

    Merge changes from topic "am-aabaca13-84ab-4de5-bfa1-2add13867c06" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 422582d9c4
      Import translations. DO NOT MERGE

commit 0c8cc417d596b9321a852a2f165684d9edaef1b9
Merge: cbc81e618d3 422582d9c48
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 18 06:27:04 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 3c047ea7fa0e63367e17d19c97dcdbc40b4dc1b9
Merge: cb1a10f5b60 437da4c13df
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 18 06:27:04 2018 +0000

    Merge changes from topic "am-aabaca13-84ab-4de5-bfa1-2add13867c06" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 422582d9c4 skipped: b06ba83b23
      [automerger skipped] Import translations. DO NOT MERGE skipped: 422582d9c4
      Import translations. DO NOT MERGE

commit 97ee18374758e610180ecb3d163ff3d337b5c031
Merge: ac40bb76a14 d996012ef50
Author: Bill Yi <byi@google.com>
Date:   Sun Jun 17 23:26:21 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: cbc81e618d skipped: 693ad9800b am: cb1a10f5b6  -s ours
    am: d996012ef5  -s ours

    Change-Id: Idcb8df6ed5993f00170408e685080aa525f291e1

commit d996012ef502730f312d4495497f0778a2799f34
Merge: c262f7a96ac cb1a10f5b60
Author: Bill Yi <byi@google.com>
Date:   Sun Jun 17 23:18:56 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: cbc81e618d skipped: 693ad9800b
    am: cb1a10f5b6  -s ours

    Change-Id: Ib5adcfbe4afabfee3e391ec528272f210b408a10

commit 437da4c13df1e5cddf74ea2c72803d19d1c2ff0d
Merge: c70d882667f b06ba83b23b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 17 12:14:12 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 422582d9c4 skipped: b06ba83b23

    Change-Id: Iae0ad51f828f91b8211e0671900f2ffa1265c655

commit b06ba83b23b2678e6ba0f7d8553de394a89380b8
Merge: 92010e84999 422582d9c48
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 17 12:14:05 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 422582d9c4

    Change-Id: I3f93da28223af89a03736689e7f35a723b864ff5

commit 422582d9c48124a2520eec6b58323d3196cc8a63
Author: Bill Yi <byi@google.com>
Date:   Sun Jun 17 05:13:32 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I681a0e79a709f3cabf8b661ec5229480d99dd840
    Auto-generated-cl: translation import

commit cb1a10f5b60cca8fccc40f76e1dde02c8131fff0
Merge: c70d882667f 693ad9800b4
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 17 10:03:39 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: cbc81e618d skipped: 693ad9800b

    Change-Id: I387f439df9441d64a658344837e4a2bd0f88a128

commit 693ad9800b4b87bbe84b399cece9b13de2da64fc
Merge: 92010e84999 cbc81e618d3
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 17 10:03:31 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: cbc81e618d

    Change-Id: I6a3ddad855bdc4ae74eab3e6e2cd42290176aab4

commit cbc81e618d3edf7111e0c31d7d5b3183a5256801
Author: Bill Yi <byi@google.com>
Date:   Sun Jun 17 03:02:56 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: Ied5693d3e59e24f43a7a1577471819c269c7d6df
    Auto-generated-cl: translation import

commit c5901f5a06884da28d89bf79d54a1d729acb8dec
Merge: a74fbef8ce1 94c28e75c61
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Sat Jun 16 03:16:06 2018 +0000

    Merge "Skip null values in Utils.safeForeach" into pi-dev

commit a74fbef8ce12d76229b6c025a0047344de2872f1
Merge: 37e96a8fa5d 6df6b027f0f
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Sat Jun 16 00:28:17 2018 +0000

    Merge "Don't back up Assist Gesture setup/sensitivity" into pi-dev

commit 2f0d73cac893d5d86b015ed44a2d4fee9a60bc29
Author: Andrii Kulian <akulian@google.com>
Date:   Fri Jun 15 14:32:04 2018 -0700

    Skip updating stack config if it is detached from a display

    Ensuring visibility or configuration of activities in a stack can be
    triggered from outside of system service by a client callback, e.g.
    ActivityManagerService#activityPaused(). We should skip doing that
    whenever we see that a stack is no longer attached to a display.

    This CL restores the behavior that was in place where the error might
    happen before switching to using
    ActivityStackSupervisor#ensureVisibilityAndConfig() and will only
    ensure system-wide activity visibility without updating config.

    Bug: 110074206
    Test: Build and run
    Change-Id: Ib347b56b66ce27e4ed8c263ffb425d336012a4ff

commit 2a6bdfd9082f40090e835f2eed6ad8abbfde93a0
Author: Lucas Dupin <dupin@google.com>
Date:   Tue Jun 12 17:45:21 2018 -0700

    Pulse animation synchronization

    Fade in pulsing notification after a delay and
    fix clock scale delay.

    Fixes: 109809484
    Fixes: 110204622
    Test: visual
    Change-Id: I3b62c4c2508d7b536287020801a58cb317e88ac0

commit 37e96a8fa5d07c497143bd806475fc45c8511a4a
Merge: b91dd1d944b 9bfc7a54ebb
Author: Selim Cinek <cinek@google.com>
Date:   Fri Jun 15 20:44:08 2018 +0000

    Merge "Hiding replied notification icons from AOD" into pi-dev

commit b91dd1d944b5ab38b0bf774269e91f8f1bdbf02d
Merge: 706303541e3 28c25e219a4
Author: Adrian Roos <roosa@google.com>
Date:   Fri Jun 15 20:28:13 2018 +0000

    Merge changes I90451c14,I9fb27a0a into pi-dev

    * changes:
      DO NOT MERGE WM: correctly draw the rounded corner / cutout overlay during rotation
      WM: Fix seamless rotation

commit 706303541e36685111f785e5dde2f0d73332c86f
Merge: af76df93e31 3c4636c7127
Author: Eric Laurent <elaurent@google.com>
Date:   Fri Jun 15 17:43:42 2018 +0000

    Merge "audioservice: fix a2dp connection race condition" into pi-dev

commit f4b04ae0bb9a24faaaadb21c7e1c89e78a540fd0
Author: Selim Cinek <cinek@google.com>
Date:   Wed Jun 13 18:23:45 2018 -0700

    Fixed an issue where the contentHeight was wrong

    The content height was using the regular topPadding which
    factored in the darkAmount, but wasn't updating the contentHeight.
    Since updating the contentHeight is pretty expensive, we are
    now using the regular topPadding whenever the lock screen
    isn't fully dark, which will make sure that everything is
    properly positioned and not faded.

    Change-Id: Ida9f29443efc1eb80924b0e755ea5338adfe23f7
    Fixes: 110091926
    Test: adb shell setprop debug.force_no_blanking true and observe proper layout after animations

commit 94c28e75c61a321255bcdca7b325917096d1ac73
Author: Beverly <beverlyt@google.com>
Date:   Fri Jun 15 11:04:02 2018 -0400

    Skip null values in Utils.safeForeach

    Test: ZenModeControllerImplTest.java
    Bug: 110209145
    Change-Id: I4234be630c84444a70d8cb380ca6a692a4ff5cbc

commit af76df93e31c9e36fc3706c62b7a8b7df683a1a5
Merge: 1250cd14076 004e489a251
Author: Philip P. Moltmann <moltmann@google.com>
Date:   Fri Jun 15 17:18:52 2018 +0000

    Merge "Abbreviate permission labels less aggressively" into pi-dev

commit 9a5f05b22f6349080f00a55330bb63552b2512c1
Author: Martijn Coenen <maco@google.com>
Date:   Fri Jun 15 10:35:13 2018 +0200

    Clean up RemoteCallbackList when we're done with it.

    When dispatching cancel callbacks for a pending intent,
    AMS drops its reference to the list without cleaning it up.
    This means that the enclosed callbacks (proxies) will stay
    alive until the remote process dies. For some processes like
    systemUI, this will happen rarely (if ever), and so sooner
    or later we would run into proxy resource limits for such
    processes.

    Since at this point we're done with the RemoteCallbackList,
    just clear it out.

    Bug: 109701487
    Test: builds, boots, callback list is cleaned out
    Change-Id: Ia1a108045fb1fd12cbd94a7c516a9eab8ebca099

commit 1250cd140767231a92919d94a0173b3d0bd9a730
Author: Tony Huang <tonyychuang@google.com>
Date:   Wed Jun 6 15:40:47 2018 +0800

    Fix solid circle show on message notification

    Message app or other apps will use some format code or controll
    code on SenderName to fit RTL or other design, and symbols will
    produced by these code. The special code pattern not include these
    code, so it will go charIcon flow.
    Although these code is not visible, we should just ignore them to
    get symbol strings

    Change-Id: I20ef459b10ba7504ec0c997ed815cb485817d2bc
    Fixes: 109746235
    Test: Check notification form message app on RTL
    Test: atest SystemUITests

commit 28c25e219a401c1d5f7591fec28308d221f20762
Author: Adrian Roos <roosa@google.com>
Date:   Thu May 31 18:07:28 2018 +0200

    DO NOT MERGE WM: correctly draw the rounded corner / cutout overlay during rotation

    When we freeze the screen, we really don't want the overlay to appear
    on the screenshot - otherwise this will lead to it rotating with the
    screen content. This means the overlay currently disappears during the
    transition. We cannot just draw it over the screenshot, because it
    might be in inconsistent state.

    We fix this by temporarily undoing the effects of the screen rotation
    transform on the overlay's window token. Then, once the window has
    performed relayout and is redrawn in the new orientation, we switch to
    that representation. This is mostly seamless rotation, with the
    difference that we force it always, and it must also work for 180
    degree rotation (which regular seamless rotation does not).

    Do not merge, because we want to harmonize seamless rotation and the
    newly added forced seamless rotation in Q.

    Also move the rounded corner overlay from the display overlay layer
    to the root of the hierarchy such that it can draw over the screen
    off animation's ColorLayer.

    Bug: 79112140
    Test: Enable display cutout overlay, rotate phone to all orientations, ensure that emulated display cutout never flashes or disappears.
    Test: atest CoordinateTransformsTest
    Change-Id: I90451c14dc28daa3f90a74c3117548fead25af3f

commit 41f7e9d10306603c7a4410938e77418f13f6e939
Author: Adrian Roos <roosa@google.com>
Date:   Thu Jun 7 15:29:34 2018 +0200

    WM: Fix seamless rotation

    With the introduction of the surface hierarchy, the seamless rotation
    behavior in WSA is no longer correct: it also applies the WindowState's
    offset, which leads to that being applied twice.

    Instead of doing that, we simply rotate the WSA surface within the place
    that WindowState dictates now.

    Finally, the location of the WindowState itself also needs to be
    transformed into the new orientation.

    Fixes: 109927566
    Test: atest CoordinateTransformsTest
    Test: atest 'WindowStateTests#testSeamlesslyRotateWindow'
    Change-Id: I9fb27a0a8a2bddc6ec88a4fcce6d6ea00929fb91

commit 3c4636c7127cd34728050d051ef3bd62829e877d
Author: Eric Laurent <elaurent@google.com>
Date:   Wed Jun 13 19:36:42 2018 -0700

    audioservice: fix a2dp connection race condition

    In case of fast (< 1 second) A2DP disconnect/connect sequence, there
    is a potential race condition where the delayed disconnection message
    (due to becoming noisy intent) is received after the not delayed
    connection message.

    - Make sure all messages related to device connection/disconnection
    (including MSG_A2DP_DEVICE_CONFIG_CHANGE and MSG_BTA2DP_DOCK_TIMEOUT)
    are handled by queueMsgUnderWakeLock().
    - Make sure messages are processed in the same order as API calls.
    - Add check for null address in makeA2dpDeviceUnavailableNow().

    Bug: 109903807
    Bug: 78837311
    Test: repro steps in bugs. A2DP connection and playback

    Change-Id: Ib81b3805f945f7206b1a60de74e9bbeeef89bdd0

commit b2b255a131779df29f808f7504593d72f143afb3
Merge: cf2d6475f9f 0bfed290914
Author: Tracy Zhou <tracyzhou@google.com>
Date:   Thu Jun 14 23:28:34 2018 +0000

    Merge "Revert "Change quickstep onboarding tip window type to"" into pi-dev

commit 9e2a8235bd18ddfe11de21293334e47c2b732708
Author: Yu-Han Yang <yuhany@google.com>
Date:   Thu Jun 14 12:10:08 2018 -0700

    Enable REQUEST_LOCATION from GNSS HAL

    - Set the default duration to be 10 seconds.

    Bug: 110054263
    Test: built and verified on device that it is enabled.
    Change-Id: Ib49ffba3f2b1a85d6aa0e323b4cda4d238bd913b

commit 004e489a251d6adf94922368e98a730185642123
Author: Philip P. Moltmann <moltmann@google.com>
Date:   Thu Jun 14 11:52:14 2018 -0700

    Abbreviate permission labels less aggressively

    We switched the package installer app to always abbreviate all labels
    loaded from foreign packages. This is done so that a foreign app cannot
    crorrupt the UI via super-long strings.

    The default abbreviation is very aggressive and abbreviates to ~5 cm.

    When an app with a targetSDK <= M gets installed, all permissions will
    get auto-granted. Hence when a user side-loads such an app, we show the
    permissions during install so that the user is aware of this.

    Unfortunately most permission labels and restrictions do not fit into a
    single line.

    This change allows much longer strings for permissions names and
    descriptions. It still abbreviates eventually and handles permission
    descriptions with weird characters (such as back-space) correctly.

    Fixes: 110209410
    Test: Side-loaded old app and verified that permission labels and
          descriptions are not abbreviated.

    Change-Id: Ie1db240883c9f5cb9c1b74ca7bdcb80625e3f7f2

commit cf2d6475f9fc885e8bc9761ef2d839eaad3f32b4
Author: Wale Ogunwale <ogunwale@google.com>
Date:   Thu Jun 14 08:55:42 2018 -0700

    Make testSplitscreenPortraitAppOrientationRequests pass to unblock release

    Work around to unblock the release for failing test
    ActivityManagerAppConfigurationTests#testSplitscreenPortraitAppOrientationRequests
    which shouldn't be failing since home stack shouldn't be visible. We need
    to dig deeper to see why it is failing.
    NOTE: Not failing on current master...

    Bug: 110159357
    Test: atest ActivityManagerAppConfigurationTests#testSplitscreenPortraitAppOrientationRequests
    Change-Id: I69423eef3661133b2a032a166745157b3e344751

commit f910fdb1daf1bd3c28222efde503e2ff8de5c027
Merge: b784e6f7bc0 439bd449d87
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 14 04:18:20 2018 +0000

    Merge "Smoother wake-up animation" into pi-dev

commit 439bd449d879ee35f3e487f871e59cab59ffc1a2
Author: Lucas Dupin <dupin@google.com>
Date:   Tue Jun 12 15:05:28 2018 -0700

    Smoother wake-up animation

    Removed overlapping interpolators and made the "screen off" animation
    slower when more than 1 notifications are visible.

    Fixes: 110081253
    Bug: 109809484
    Test: visual
    Change-Id: I355ac94d4e6a880f37ce1d68c15c693b6f09f7f8

commit b784e6f7bc0cfc4b47fce5759609057b92e98ee9
Merge: a102591e132 1e02f340e02
Author: Lucas Dupin <dupin@google.com>
Date:   Thu Jun 14 01:16:44 2018 +0000

    Merge "Config to enable/disable AOD via overlay" into pi-dev

commit 54ff81b81eaa33c8ccc182566e0b33881664d790
Author: Evan Laird <evanlaird@google.com>
Date:   Wed Jun 13 20:08:17 2018 -0400

    Add config to disallow the battery % option

    This config will be respected and override the value found in Settings
    if a user restores from a device which had SHOW_BATTERY_PERCENTAGE set
    to true. It is also respceted on the keyguard where we would typically
    show the battery percent if the device is charging.

    Percentage is still shown above QS though.

    Test: visual
    Change-Id: I1f59b68097ffcbb7dda9d2ec99ea0ba9062c6dff
    Bug: 80129194

commit 1e02f340e023d64b4a1146d5fb788f3324dbf842
Author: Lucas Dupin <dupin@google.com>
Date:   Wed Jun 13 12:54:29 2018 -0700

    Config to enable/disable AOD via overlay

    Bug: 109894567
    Test: mp droid; fastboot -w
    Change-Id: I3fda0bf486ae0c4b795ce34ba6823d8dc36a3796

commit a102591e13261b4a8cece6858e2327f50cb8f1df
Merge: 82614bed0b3 f1381bbe132
Author: Lucas Dupin <dupin@google.com>
Date:   Wed Jun 13 22:15:29 2018 +0000

    Merge "Avoid showing bouncer when in a launch transition" into pi-dev

commit 9e21579a11219581a0c08ff5dd6ac4dc22e988a4
Author: Makoto Onuki <omakoto@google.com>
Date:   Tue Jun 12 13:01:42 2018 -0700

    Backport Prevent shortcut info package name spoofing

    Test: cts-tradefed run cts -m CtsShortcutManagerTestCases -t android.content.pm.cts.shortcutmanager.ShortcutManagerFakingPublisherTest
    Bug: 109824443

    Change-Id: I90443973aaef157d357b98b739572866125b2bbc
    Merged-In: I78948446a63b428ae750464194558fd44a658493

commit aad860012e5e02f1eeb03fbda6094c30947e2169
Merge: c70d882667f c3e741e5300
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jun 13 21:43:03 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a am: 06848a3f8f skipped: c3e741e530

    Change-Id: I7aaf06ed4a169b6db7857a6eaa79358cfce7054b

commit c3e741e530072743e667adfd18a7c93bec711704
Merge: 92010e84999 06848a3f8fa
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jun 13 21:42:56 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a am: 06848a3f8f

    Change-Id: I0c720e9e4186238ba33eeceae2da377ba2831c29

commit 06848a3f8fa0b815d13d339c676191f6ebc50d33
Merge: b73ecf47127 2f7d50058ae
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jun 13 21:42:48 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing am: 2f7d50058a

    Change-Id: I1a8b7786bd91bf8c585da02891dad3ceee9db393

commit 2f7d50058aeb8c5e0a411d50e5bdc4b25b84de70
Author: Makoto Onuki <omakoto@google.com>
Date:   Tue Jun 12 13:01:42 2018 -0700

    RESTRICT AUTOMERGE: Prevent shortcut info package name spoofing

    Test: cts-tradefed run cts -m CtsShortcutManagerTestCases -t android.content.pm.cts.shortcutmanager.ShortcutManagerFakingPublisherTest
    Bug: 109824443
    Change-Id: I80b2680d9c7e067f1a36fc8ad1aac1d315022a71

commit 82614bed0b33edf59f6b9a219282b873c686f5e2
Merge: bcae0ff7a28 a6b5344bd37
Author: Robin Lee <rgl@google.com>
Date:   Wed Jun 13 20:56:11 2018 +0000

    Merge "Do not treat EXTRA_SMALL_ICON <int> as Parcelable" into pi-dev

commit d22e9dfb6a6ee7d86f50bf3b13c0588889e5dc53
Author: Hongming Jin <hongmingjin@google.com>
Date:   Fri May 18 10:47:57 2018 -0700

    Backporting of b/77821568

    Enforce permission check before returning application info
    Test: manually tested (see bug for repro steps)
    Bug: 77821568

    Change-Id: Iec13196250f0e5d8b54fd7060ed40e3fe3fe2827
    Merged-In: I7554805c36c0c2552163dad7b07cfc5f552b624e

commit bcae0ff7a2843ce86ba01d31cdfafe1d7cb90bd4
Merge: c6c9a78b4e9 22dbf294bb0
Author: Laura Davis <laurabd@google.com>
Date:   Wed Jun 13 18:11:23 2018 +0000

    Merge "docs: repaired link to internal section" into pi-dev

commit 3ea3c00d942c961ce3edcdb52839935218d7ac9b
Merge: c70d882667f 430c4395a3a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jun 13 18:09:48 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e am: 0eda2602cd skipped: 430c4395a3

    Change-Id: I38571525dec3ebc35284cc9a8ae0044a8e9e237c

commit 430c4395a3a16e6b9337e3bc5aa654a7ccdf61a7
Merge: 92010e84999 0eda2602cd2
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jun 13 18:09:40 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e am: 0eda2602cd

    Change-Id: I9692df95413c51715508b664b5bc3ea02462da55

commit 0eda2602cd2830e479d96f125ca4783c0c6be26c
Merge: b73ecf47127 24d402096e5
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jun 13 18:09:32 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4 am: 24d402096e

    Change-Id: Ia7340c71283b7f88378e34584b373cce180262ec

commit 24d402096e50f049a491e67be6f6f0ca3701225a
Merge: 390a0154314 b9c3b099e48
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jun 13 18:09:24 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c am: b9c3b099e4

    Change-Id: I8a090de1075d6d30590ac1e535de841164753758

commit b9c3b099e489d1a6cf695b2bd8450d56ebe7c285
Merge: f7bd2507b50 4bc1c2445ce
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Jun 13 18:09:16 2018 +0000

    [automerger] RESTRICT AUTOMERGE: Backporting of b/77821568 am: 4bc1c2445c

    Change-Id: I12a6a00f11b2d94d3ac112a2f18284e13062a814

commit 4bc1c2445ce6a6359095b54e46aaba6c7897c99f
Author: akirilov <akirilov@google.com>
Date:   Thu Jun 7 14:36:25 2018 -0700

    RESTRICT AUTOMERGE: Backporting of b/77821568

    Enforce permission check before returning application info
    Test: manually tested (see bug for repro steps)
    Bug: 77821568

    Change-Id: I5d81345b2d958c2bb0a62bbcb8bd8c714a1cf41e

commit c6c9a78b4e924bf12d526b61b899814a59072f31
Merge: 2125e5c59ec 0d4a99550d7
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Jun 13 12:36:23 2018 +0000

    Merge "Enable expanding of status bar just below the notch" into pi-dev

commit a6b5344bd3705d03b71002f3f5926b81c6ae6d70
Author: Robin Lee <rgl@google.com>
Date:   Mon Jun 11 11:18:55 2018 +0200

    Do not treat EXTRA_SMALL_ICON <int> as Parcelable

    It isn't one, and I should have read the documentation on it properly
    before treating it the same as EXTRA_LARGE_ICON (which is indeed a
    Parcelable).

    This fixes a chronic outpouring of technically-probably-harmless warning
    stack traces of the following nature which can be verified by running
    the framework tests and grepping logcat for this scary-looking string:

      java.lang.ClassCastException: java.lang.Integer cannot be cast to
      android.os.Parcelable
        at android.os.Bundle.getParcelable(Bundle.java:***)
        at android.app.Notification.fixDuplicateExtra
        at android.app.Notification.fixDuplicateExtras
        at android.app.Notification.readFromParcelImpl

    Duplicate Integer objects are harmless compared to the Bitmap so there
    is zero sense in recombining the objects after an RPC. We just drop the
    line which tries to do that.

    Test: make FrameworksCoreTests -j30 && \
    Test: adb install -r ${ANDROID_PRODUCT_OUT}/data/app/*/FrameworksCoreTests.apk && \
    Test: adb shell am instrument \
    Test:   -e class android.app.NotificationTest \
    Test:   -w com.android.frameworks.coretests/android.support.test.runner.AndroidJUnitRunner
    Change-Id: I2c88ab4e9d5322c05e2e7f68df85ed5b2f296f84
    Fix: 79404137
    (cherry picked from commit 62eea67846e3817e090031257bae7c42a8407548)

commit 0bfed2909148826f43176136996e109270235263
Author: Tracy Zhou <tracyzhou@google.com>
Date:   Thu Jun 7 22:54:29 2018 +0000

    Revert "Change quickstep onboarding tip window type to"

    This reverts commit 4df16fb106fad56e8515da7ea68f6eddf24daf27.

    Reason for revert: This change does not really fix the z-layering while this issue is mitigated by the the update of the tip UI. It also causes b/109836271

    Fixes: b/73990691
    Fixes: b/109836271
    Test: Manual test
    Change-Id: I6443e7d54e535e353a9ffc71c48ef8b6c3f47972

commit 2125e5c59ec2a5561a52927e42ea81cef0472421
Merge: f60f4a47616 b70fbc85f74
Author: Robert Greenwalt <rgreenwalt@google.com>
Date:   Tue Jun 12 22:26:39 2018 +0000

    Merge "Use Uppercase instead of Lowercase for PLMN Decode" into pi-dev

commit 34044ac429ada3b5f4b3bcb72c1fd30199cfbbc1
Author: Amin Shaikh <ashaikh@google.com>
Date:   Tue Jun 12 18:25:43 2018 -0400

    Do not announce selected state for QS tiles.

    Change-Id: Ia461baa4a12818a0e91c6e1862eb9e13e232e720
    Fixes: 110105146
    Test: manual

commit f60f4a4761695107581e41caec707799b2e4e3a6
Merge: 5c4b2f6e08f beeb7f4272c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jun 12 22:17:21 2018 +0000

    Merge "ScreenDecorations: fix cutout not showing in seascape" into pi-dev

commit f1381bbe1322a17e8e66b92b4a3c94369dc2cb1d
Author: Lucas Dupin <dupin@google.com>
Date:   Fri Jun 8 14:11:41 2018 -0700

    Avoid showing bouncer when in a launch transition

    The panel will collapse but the bouncer should not become visible,
    otherwise the IME might be requested.

    Test: go/sysui-bouncer-tests
    Test: atest packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManagerTest.java
    Change-Id: I0405cf1b956aa239b0684ac357a38cf4b2357cb2
    Fixes: 109879604

commit 5c4b2f6e08f92117a2c2ab9d7b5df4bb66304f6e
Merge: f8dc8e378a5 4d74d50f538
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jun 12 21:06:07 2018 +0000

    Merge "Allow unsuspending critical packages" into pi-dev

commit f8dc8e378a5691c8dc2ac4f8465c8d1e5012f9b4
Merge: 1d207b3af56 2657757c432
Author: Mike Digman <digman@google.com>
Date:   Tue Jun 12 20:27:00 2018 +0000

    Merge "Make rotate nav+qs icon consistent, understandable" into pi-dev

commit 1d207b3af5671703225277b52b7c046b8579fdab
Merge: b2dac061bbf ddb7b47dd0c
Author: Selim Cinek <cinek@google.com>
Date:   Tue Jun 12 18:04:01 2018 +0000

    Merge "Keeping the lockdown state in sync with the notification list" into pi-dev

commit fb53deca41ce2c7dbcfceb7a1d10f0b704ac9b65
Author: Shrijana Ghimire <shrijana@google.com>
Date:   Mon Jun 11 17:14:13 2018 -0700

    docs: Fixed typos in AdapterView Javadoc.

    Replaced the word 'as' with 'has' and replaced 'id' with 'if'.

    Test: make ds-docs

    Bug: 36946939
    Change-Id: I05828e2ee20309556ffbf56cff0093183dabc088

commit b2dac061bbf5c16a949bb29c0ec7ef7d2ba213b0
Merge: 8a12361b8c3 f49b106dca1
Author: Winson Chung <winsonc@google.com>
Date:   Tue Jun 12 06:45:15 2018 +0000

    Merge "Revert "Defer stop for all activities becoming invisible"" into pi-dev

commit 8a12361b8c30ca10770ce742b5262cc1544f6132
Merge: f8fe538f07d c106d9f958b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Tue Jun 12 03:59:07 2018 +0000

    Merge "AudioService: fix deallock setBluetoothScoOn vs setMode" into pi-dev

commit 9bfc7a54ebb22044dce8129b89632f6cb21c7ef2
Author: Selim Cinek <cinek@google.com>
Date:   Mon Jun 11 16:09:00 2018 -0700

    Hiding replied notification icons from AOD

    Previously we would only hide them from the
    statusbar, but not from AOD.

    Test: add notification, reply, observe no icon on AOD
    Change-Id: I10a2aeb1a94aa101f055fbdc2b611477fbe1ac1b
    Fixes: 78486801

commit 4d74d50f53882560ac20c06de53b40f030e31fec
Author: Suprabh Shukla <suprabh@google.com>
Date:   Mon Jun 11 15:11:01 2018 -0700

    Allow unsuspending critical packages

    PackageManager prevents certain packages from being suspended to ensure
    device is in a sane state. It should not disallow unsuspening these
    packages for the same reason.

    Test: Existing tests:
    atest FrameworksServicesTests:SuspendPackagesTest
    Manually, changed the default dialer, then
    adb shell pm suspend com.android.dialer
    change the default dialer to com.android.dialer, then
    adb shell pm unsuspend com.android.dialer
    should succeeed.

    Bug: 79846500
    Change-Id: Ie198f61bf3b092e497f978e60a27f9d52cdda9c7

commit ddb7b47dd0c875318669cc2d68f84de49710d138
Author: Selim Cinek <cinek@google.com>
Date:   Mon Jun 11 17:26:34 2018 -0700

    Keeping the lockdown state in sync with the notification list

    Whenever the lockdown was changed, the UI wasn't consistently
    updated, but only once another notification / update came
    in, which lead to notifications being invisisible or visible
    when they shouldn't have been.

    Change-Id: I17c1b4e0ef58d6aa05f4404e52e07a098d4fce4e
    Fixes: 78020486
    Test: manual, hit lockdown observe notification gone, coming back when unlocked

commit f49b106dca1b878319a09a1acf8582c05c360a30
Author: Winson Chung <winsonc@google.com>
Date:   Mon Jun 11 23:58:27 2018 +0000

    Revert "Defer stop for all activities becoming invisible"

    This reverts commit b824f87c65216e4dfe5e9ab0e63795466836bc0f (for b/80313326)

    Reason for revert: Cts issues (b/110032866)

    Bug: 80313326
    Bug: 110032866

    Change-Id: Iaca3a8650d30b475ef4331e98b4b14377072ee4d

commit 6df6b027f0f2ec76e639025c765273af7ee76c46
Author: Kevin Chyn <kchyn@google.com>
Date:   Wed Jun 6 17:16:50 2018 -0700

    Don't back up Assist Gesture setup/sensitivity

    Fixes: 72715022

    Test: With two devices, set up one, back up onto the other.
          SUW for Assist Gesture does not get skipped
    Test: atest SettingsBackupTest

    Change-Id: Id7348542a618c0366f89c47833af6f66bf52b18f

commit 2657757c432a95100ad6a2aed5a36c7dcd296aae
Author: Mike Digman <digman@google.com>
Date:   Mon Jun 11 11:41:33 2018 -0700

    Make rotate nav+qs icon consistent, understandable

    Now using the same iconography (but different angle) for nav
    and qs. Note nav viewport, size and pivot (for motion) change
    is intentional to match other navbar icon sizing.

    Test: manual
    Change-Id: I1abb33130cc724b6e63e008cf7301ebce383c8d1
    Fixes: 110052596

commit f8fe538f07d38d5d7ed751d4ad57edfa0be4e8bd
Merge: 9b70877ea8f ac40bb76a14
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 15:43:09 2018 -0700

    Merge changes from topic "am-8bf63f1b-ab99-4537-ad90-d648a4dd77b0" into oc-dev am: c70d882667 am: c262f7a96a
    am: ac40bb76a1

    Change-Id: Idecbdcc5616a974fe75d99667ec4a5e8d37d97c5

commit 9b70877ea8f6324c915463980959e6258fc8001e
Merge: 88db3b5aae8 c37cca5739a
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 15:35:45 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 9f043e5e58 skipped: cc2c91ba39 am: b1615a6d90  -s ours am: 2c56e9b54b  -s ours
    am: c37cca5739  -s ours

    Change-Id: If954d237d06c522c78198b0fadd8c6394978855a

commit 88db3b5aae82c3357fe492fcfcca907e571dd539
Merge: 7609e236129 f4a3d1faf25
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 15:17:06 2018 -0700

    Merge changes from topic "am-8eb97afa-063a-44e2-8d8e-6d5670eb50b6" into oc-dev am: 836d1db239 am: f527941ec8
    am: f4a3d1faf2

    Change-Id: I5bff44b8b6e7384eada300a2c904ab11c12e028f

commit 7609e2361298178e2ed1e3e4de35ca7a77caffd6
Merge: 995c542d0c6 9e7657c13d2
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 15:09:52 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 5e25fd88a8 skipped: c6a1d32ebe am: 6d30123999  -s ours am: f9efc3043a  -s ours
    am: 9e7657c13d  -s ours

    Change-Id: Ie100fd774ad3262f3edf1b5b2baaa3786200dccc

commit 995c542d0c6005a0898574999f46237bbc355b2c
Merge: 7cea26fc9e4 689cf0f8a2e
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 15:04:23 2018 -0700

    Merge changes from topic "am-63639373-f180-4cce-87e9-95ef192ab9ec" into oc-dev am: 3bbe3c7c93 am: 24701167ba
    am: 689cf0f8a2

    Change-Id: I211002b40f5acf9f7ad0a44e4530019df72c3b7c

commit 7cea26fc9e43a63c0a123e1da646e1af8f02ac3f
Merge: 6dbef2a7403 b10ebef583d
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 14:57:09 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 0be149db42 skipped: 3c2edd55ce am: 71f5cfa650  -s ours am: f2ce740a1e  -s ours
    am: b10ebef583  -s ours

    Change-Id: Ieb35e183766df1fae623f85ccb2c3a3291b35085

commit 6dbef2a740381ddeea855d362c176e1894f41c12
Merge: 287d484b236 64c1873c302
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 14:51:44 2018 -0700

    Merge changes from topic "am-da3e9584-98c5-4975-8207-a77d2301579a" into oc-dev am: bd9caf4c6f am: 2b605d89b9
    am: 64c1873c30

    Change-Id: Ie4a67f372f3a7d187a7c7fe9c5d364c460535376

commit 287d484b23662118a38e9532b19887aadfd6d6fc
Merge: a5f49873c1e 75677553999
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 14:44:34 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 05238c7743 skipped: 5e66cc00a4 am: dafe5854dd  -s ours am: 0c61c9baf6  -s ours
    am: 7567755399  -s ours

    Change-Id: If1fa2cf8485670184771de6faf7042b7c7b227eb

commit ac40bb76a14c1f2c76e3b3c63128372ae0a88cf3
Merge: c37cca5739a c262f7a96ac
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 14:43:19 2018 -0700

    Merge changes from topic "am-8bf63f1b-ab99-4537-ad90-d648a4dd77b0" into oc-dev am: c70d882667
    am: c262f7a96a

    Change-Id: If96c64288656012f02de0edfd0d8cf7ff26abae4

commit c37cca5739a735d3631f3956a84127659b287af8
Merge: f4a3d1faf25 2c56e9b54b8
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 14:36:55 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 9f043e5e58 skipped: cc2c91ba39 am: b1615a6d90  -s ours
    am: 2c56e9b54b  -s ours

    Change-Id: I947aee957d91c286204282e84162e9733ace9018

commit f4a3d1faf25ec0f8bab679f700524382474483f6
Merge: 9e7657c13d2 f527941ec82
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 14:31:45 2018 -0700

    Merge changes from topic "am-8eb97afa-063a-44e2-8d8e-6d5670eb50b6" into oc-dev am: 836d1db239
    am: f527941ec8

    Change-Id: I641ba8de65451ddfab0bd38dcdb09d98f1039fb1

commit 9e7657c13d23167fd5063e10a0e06e60de6cfc47
Merge: 689cf0f8a2e f9efc3043a9
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 14:25:28 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 5e25fd88a8 skipped: c6a1d32ebe am: 6d30123999  -s ours
    am: f9efc3043a  -s ours

    Change-Id: Ia4ef7b14406c4f0f15b9d17d107308f93282684b

commit 689cf0f8a2e3d3cfa83a7dc1db6c6432f1785aae
Merge: b10ebef583d 24701167ba6
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 14:01:09 2018 -0700

    Merge changes from topic "am-63639373-f180-4cce-87e9-95ef192ab9ec" into oc-dev am: 3bbe3c7c93
    am: 24701167ba

    Change-Id: I2cc8202e1abaf739a71126665599c3b262f5e7d7

commit b10ebef583d348d799840b0087bb83f4ec9f0b87
Merge: 64c1873c302 f2ce740a1e8
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 13:54:34 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 0be149db42 skipped: 3c2edd55ce am: 71f5cfa650  -s ours
    am: f2ce740a1e  -s ours

    Change-Id: Ibcaa1f68b57714de2a7295d93d1875274b750071

commit 64c1873c30208990e8e3ddc85b66686e095ceac9
Merge: 75677553999 2b605d89b9e
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 13:49:02 2018 -0700

    Merge changes from topic "am-da3e9584-98c5-4975-8207-a77d2301579a" into oc-dev am: bd9caf4c6f
    am: 2b605d89b9

    Change-Id: I1686e2207e5764167e1e75fcbf4d0be08bf4590d

commit 75677553999f902ee5110f55d0f272db726e4ba5
Merge: 053160d9659 0c61c9baf6a
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 13:42:05 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 05238c7743 skipped: 5e66cc00a4 am: dafe5854dd  -s ours
    am: 0c61c9baf6  -s ours

    Change-Id: Ie95321f3e530034575a32399abcb3d07f552c0e9

commit a5f49873c1e05d15642067fc59bb7bbaaa2dbd0c
Merge: b63aa6d5bb1 053160d9659
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:52:45 2018 -0700

    Merge changes from topic "am-84e9fe64-a976-466c-a8d7-d25febc3ff42" into oc-dev am: 5b882b9dd7 am: 9ce893db7d
    am: 053160d965

    Change-Id: I372e94fff2918832b307e6e7895636cfe0b218f3

commit b63aa6d5bb148346b116fcc6610799b33547f6e2
Merge: a3a2117e5f0 5caff8b3ac3
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:44:22 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1122b10e7d skipped: ab4ca0c33d am: d82564708f  -s ours am: 2e113959ff  -s ours
    am: 5caff8b3ac  -s ours

    Change-Id: I23a3341bc16e52343d398489b7e74a7903421cac

commit 053160d9659f6dc3e19e50833ae5ce52fa3ce37e
Merge: 5caff8b3ac3 9ce893db7da
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:34:18 2018 -0700

    Merge changes from topic "am-84e9fe64-a976-466c-a8d7-d25febc3ff42" into oc-dev am: 5b882b9dd7
    am: 9ce893db7d

    Change-Id: Ib2119bdd41d9266be01a34281f2b414a9d4d6d32

commit 5caff8b3ac3b4027ed247473f82ee576908f3d8a
Merge: 331b1882752 2e113959ff1
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:27:12 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1122b10e7d skipped: ab4ca0c33d am: d82564708f  -s ours
    am: 2e113959ff  -s ours

    Change-Id: I4e9f42dca080b08b61f706bb474c31c1ee1db4e5

commit c262f7a96acd6d0b5f6308094eed240f0c23cbd1
Merge: 2c56e9b54b8 c70d882667f
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:26:55 2018 -0700

    Merge changes from topic "am-8bf63f1b-ab99-4537-ad90-d648a4dd77b0" into oc-dev
    am: c70d882667

    Change-Id: I12e4db4d4d67cac9aa22f9c3fab1d141f29eb54b

commit 2c56e9b54b8bcce3dec93585d396e9f183f0de96
Merge: f527941ec82 b1615a6d905
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:24:25 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 9f043e5e58 skipped: cc2c91ba39
    am: b1615a6d90  -s ours

    Change-Id: I9f949a268c9c25c19c731269b3299b4ca2d7aa28

commit f527941ec82e05f6da2dc9d753a19046708dfd32
Merge: f9efc3043a9 836d1db2398
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:19:55 2018 -0700

    Merge changes from topic "am-8eb97afa-063a-44e2-8d8e-6d5670eb50b6" into oc-dev
    am: 836d1db239

    Change-Id: I519b06f3c9f41b874d0c1f37f0494bbbd080e50e

commit f9efc3043a94bba64d9048fae90e4456f43aae0e
Merge: 24701167ba6 6d301239999
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:17:38 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 5e25fd88a8 skipped: c6a1d32ebe
    am: 6d30123999  -s ours

    Change-Id: I1f2ad23fa8c9975b1be5e089a4001e5871958aee

commit a3a2117e5f06fefb0963e3a9b7c80b827d9e33bd
Merge: 4256a29fccc 331b1882752
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:10:01 2018 -0700

    Merge changes from topic "am-f1c23412-1f54-4840-90d6-b3eb7b06fc83" into oc-dev am: 59f13cbb8a am: 34d73a6f77
    am: 331b188275

    Change-Id: Ie7c5f82c79e8844493bd6dc203f294bc0d645150

commit 4256a29fccc25d5bddba91e7a6bd1f69b944bf25
Merge: 73eb5fee8d0 6c409c2e99d
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:01:59 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: ce28dfa9fa skipped: 4f7095b464 am: 124cc34793  -s ours am: b5af202209  -s ours
    am: 6c409c2e99  -s ours

    Change-Id: I1c2d8f7e5ccffd726c7111bb46e87e74616a28a4

commit 73eb5fee8d0a97963309efa1155ddd93d335a556
Merge: 9b1f560ee56 927396047c1
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 12:00:13 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: faed2889f4 skipped: 091681e295 am: 4228af93a7  -s ours am: fcd7cc11c7  -s ours
    am: 927396047c  -s ours

    Change-Id: Id8ad34a3a125dbe8fc7b19399ace436250ecc3a2

commit 24701167ba646595529cc82135502b3e63af9415
Merge: f2ce740a1e8 3bbe3c7c938
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:56:42 2018 -0700

    Merge changes from topic "am-63639373-f180-4cce-87e9-95ef192ab9ec" into oc-dev
    am: 3bbe3c7c93

    Change-Id: I15050b23d75c15ca69d1aeadddef4f8f955276ef

commit f2ce740a1e88fe79c6af555ce2c5a9c71fea7d19
Merge: 2b605d89b9e 71f5cfa6507
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:54:34 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 0be149db42 skipped: 3c2edd55ce
    am: 71f5cfa650  -s ours

    Change-Id: Ia5633210e4fced8acfffa5cde6588b3159f1036f

commit 331b18827526436721b663f6f24398a79929e115
Merge: 6c409c2e99d 34d73a6f77e
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:52:05 2018 -0700

    Merge changes from topic "am-f1c23412-1f54-4840-90d6-b3eb7b06fc83" into oc-dev am: 59f13cbb8a
    am: 34d73a6f77

    Change-Id: I92656bba49935224c4b97c8c36aaddeaf7360950

commit 2b605d89b9e2a1db8e6155289a95c7159b3da820
Merge: 0c61c9baf6a bd9caf4c6f2
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:50:24 2018 -0700

    Merge changes from topic "am-da3e9584-98c5-4975-8207-a77d2301579a" into oc-dev
    am: bd9caf4c6f

    Change-Id: I04decd84fba3ec690b6d77d2880b14245810b4fd

commit 0c61c9baf6ab894c4293ca9c1671af1b8b3194ac
Merge: 9ce893db7da dafe5854ddf
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:48:00 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 05238c7743 skipped: 5e66cc00a4
    am: dafe5854dd  -s ours

    Change-Id: I7f9086ba7bf5a1754e8dd5e46ccf080b0659b3b0

commit 6c409c2e99d72d68745dc4ad1bd3505ed47a060e
Merge: 927396047c1 b5af2022094
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:45:09 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: ce28dfa9fa skipped: 4f7095b464 am: 124cc34793  -s ours
    am: b5af202209  -s ours

    Change-Id: I1a8c18e58b587716dccc478fa188931df79d68c4

commit 9ce893db7daa9b9c91a25173be49b6984f8d2791
Merge: 2e113959ff1 5b882b9dd79
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:43:54 2018 -0700

    Merge changes from topic "am-84e9fe64-a976-466c-a8d7-d25febc3ff42" into oc-dev
    am: 5b882b9dd7

    Change-Id: Ieda6e812da1fb9f3ec55201f606dd4a843f63fd4

commit 2e113959ff1e4f9f5ff7eb7ce320e5c72e800e3d
Merge: 34d73a6f77e d82564708f1
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:41:53 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1122b10e7d skipped: ab4ca0c33d
    am: d82564708f  -s ours

    Change-Id: Ib7d487392cec9a11e587b50a5b91899a215599a8

commit 34d73a6f77e41dde0504a638e767603bdcafbc89
Merge: b5af2022094 59f13cbb8a2
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:37:03 2018 -0700

    Merge changes from topic "am-f1c23412-1f54-4840-90d6-b3eb7b06fc83" into oc-dev
    am: 59f13cbb8a

    Change-Id: I47a507e5c0142357a69e7520973e4f79d3d158a8

commit b5af2022094740988a52f31dabea92f51167d947
Merge: fcd7cc11c7c 124cc347935
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:35:00 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: ce28dfa9fa skipped: 4f7095b464
    am: 124cc34793  -s ours

    Change-Id: If5c49902987b4bd076509abf86aafe7407c2525b

commit 927396047c16e179f34b69d7404a633999c82777
Merge: 35dfd463788 fcd7cc11c7c
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:33:02 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: faed2889f4 skipped: 091681e295 am: 4228af93a7  -s ours
    am: fcd7cc11c7  -s ours

    Change-Id: I795a9504ea8873999aff1aed5ffb508787a903a1

commit fcd7cc11c7c16b2b973fb79926574cb77e9b5ee6
Merge: 53ff808f992 4228af93a77
Author: Bill Yi <byi@google.com>
Date:   Mon Jun 11 11:21:05 2018 -0700

    [automerger skipped] Import translations. DO NOT MERGE skipped: faed2889f4 skipped: 091681e295
    am: 4228af93a7  -s ours

    Change-Id: I50958128b0b470ee8d2a3ba83660172f210069c0

commit c70d882667fd0cb6ce283fcaef84d8a545a6be85
Merge: 836d1db2398 b1615a6d905
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:19:38 2018 +0000

    Merge changes from topic "am-8bf63f1b-ab99-4537-ad90-d648a4dd77b0" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 9f043e5e58 skipped: cc2c91ba39
      [automerger skipped] Import translations. DO NOT MERGE skipped: 9f043e5e58
      Import translations. DO NOT MERGE

commit 92010e84999a677438e10fd59298416045cae088
Merge: 9722c791dd3 cc2c91ba39c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:19:38 2018 +0000

    Merge changes from topic "am-8bf63f1b-ab99-4537-ad90-d648a4dd77b0" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 9f043e5e58
      Import translations. DO NOT MERGE

commit b73ecf4712731840c5c67414154bbc40f00e1c8c
Merge: 5bf64bc80e2 9f043e5e58a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:19:38 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 836d1db23982975f7850abd944ae59b1af0b7393
Merge: 3bbe3c7c938 6d301239999
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:11:29 2018 +0000

    Merge changes from topic "am-8eb97afa-063a-44e2-8d8e-6d5670eb50b6" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 5e25fd88a8 skipped: c6a1d32ebe
      [automerger skipped] Import translations. DO NOT MERGE skipped: 5e25fd88a8
      Import translations. DO NOT MERGE

commit 9722c791dd392fd59029bb951ca5f1dbf3f16c09
Merge: 3b2bd254791 c6a1d32ebec
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:11:29 2018 +0000

    Merge changes from topic "am-8eb97afa-063a-44e2-8d8e-6d5670eb50b6" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 5e25fd88a8
      Import translations. DO NOT MERGE

commit 5bf64bc80e20abe780bd10690c738b9ec6917542
Merge: fc79f16dd7e 5e25fd88a87
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:11:29 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 3bbe3c7c93814bbbb9f2bf10014a3f1e4b3c185f
Merge: bd9caf4c6f2 71f5cfa6507
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:06:41 2018 +0000

    Merge changes from topic "am-63639373-f180-4cce-87e9-95ef192ab9ec" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 0be149db42 skipped: 3c2edd55ce
      [automerger skipped] Import translations. DO NOT MERGE skipped: 0be149db42
      Import translations. DO NOT MERGE

commit 3b2bd254791373e9d197c98159618fbbd8aa7951
Merge: 43cb8624bd4 3c2edd55ce5
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:06:41 2018 +0000

    Merge changes from topic "am-63639373-f180-4cce-87e9-95ef192ab9ec" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 0be149db42
      Import translations. DO NOT MERGE

commit fc79f16dd7e14cec9752abd97205bd7abd977f7a
Merge: 78ef4437587 0be149db421
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:06:41 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit bd9caf4c6f257bea7a5b4e5bb0d2ffa23c830799
Merge: 5b882b9dd79 dafe5854ddf
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:05:42 2018 +0000

    Merge changes from topic "am-da3e9584-98c5-4975-8207-a77d2301579a" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 05238c7743 skipped: 5e66cc00a4
      [automerger skipped] Import translations. DO NOT MERGE skipped: 05238c7743
      Import translations. DO NOT MERGE

commit 43cb8624bd4a2cc82f795b652cdf884da5a06a16
Merge: 0e0ff9be813 5e66cc00a4a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:05:42 2018 +0000

    Merge changes from topic "am-da3e9584-98c5-4975-8207-a77d2301579a" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 05238c7743
      Import translations. DO NOT MERGE

commit 78ef44375870379516ebd3d2591bda636f339b79
Merge: e2b589dcae8 05238c77436
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:05:42 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 5b882b9dd79c9d8c036b77e837f0ce8d9832767f
Merge: 59f13cbb8a2 d82564708f1
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:03:31 2018 +0000

    Merge changes from topic "am-84e9fe64-a976-466c-a8d7-d25febc3ff42" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 1122b10e7d skipped: ab4ca0c33d
      [automerger skipped] Import translations. DO NOT MERGE skipped: 1122b10e7d
      Import translations. DO NOT MERGE

commit 0e0ff9be813114152009185f8ee63cd34355290e
Merge: e0c4d4fce4a ab4ca0c33d6
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:03:31 2018 +0000

    Merge changes from topic "am-84e9fe64-a976-466c-a8d7-d25febc3ff42" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: 1122b10e7d
      Import translations. DO NOT MERGE

commit e2b589dcae84421781a1f12e6d7fe2a68dff0ee8
Merge: b7f8fe09564 1122b10e7dc
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:03:31 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 59f13cbb8a2c94b6a34e215e6bcb47987d54d237
Merge: 4228af93a77 124cc347935
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:03:15 2018 +0000

    Merge changes from topic "am-f1c23412-1f54-4840-90d6-b3eb7b06fc83" into oc-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: ce28dfa9fa skipped: 4f7095b464
      [automerger skipped] Import translations. DO NOT MERGE skipped: ce28dfa9fa
      Import translations. DO NOT MERGE

commit e0c4d4fce4a1986123239a25f47fa630f56a424d
Merge: 091681e295d 4f7095b4641
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:03:15 2018 +0000

    Merge changes from topic "am-f1c23412-1f54-4840-90d6-b3eb7b06fc83" into nyc-mr2-dev

    * changes:
      [automerger skipped] Import translations. DO NOT MERGE skipped: ce28dfa9fa
      Import translations. DO NOT MERGE

commit b7f8fe09564cbad9a773bcaeb57fc1e43ea81eae
Merge: faed2889f4b ce28dfa9faf
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Mon Jun 11 18:03:15 2018 +0000

    Merge "Import translations. DO NOT MERGE" into cw-f-dev

commit 0d4a99550d7c8b5fee17951ea42edaf6c710870a
Author: Jorim Jaggi <jjaggi@google.com>
Date:   Wed Jun 6 17:22:56 2018 +0200

    Enable expanding of status bar just below the notch

    Test: Expand status bar with cutout emulation enabled
    Bug: 79435224
    Change-Id: I427f382578f4dc2abe347973323bb455cb67594d
    Merged-In: I427f382578f4dc2abe347973323bb455cb67594d

commit 4228af93a772380a2eec288ca381df5ba105c3a0
Merge: 2d31069face 091681e295d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 06:30:57 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: faed2889f4 skipped: 091681e295

    Change-Id: Idb34650f4e4ffa9086addb3fc25cf528c9b60aa8

commit 091681e295dc2c4048e65193fec75ca1c7447450
Merge: 6cce31524de faed2889f4b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 06:30:51 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: faed2889f4

    Change-Id: Ic0e6aac64c5724221ca6fa3d75d0d0d463cfe9ab

commit faed2889f4b3f7be9204a834485bbffb2a36b88c
Author: Bill Yi <byi@google.com>
Date:   Sat Jun 9 23:30:29 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I9dcb973ffe7bab8894c863087532615f8c360806
    Auto-generated-cl: translation import

commit 124cc3479351155146102be731d48b3fe2d94032
Merge: 2d31069face 4f7095b4641
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 06:24:19 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: ce28dfa9fa skipped: 4f7095b464

    Change-Id: I7b5711eabd8f101cc5c268c2469a7f94582e4144

commit 4f7095b46413b41a97fa7eae2c0486490a4c8031
Merge: 6cce31524de ce28dfa9faf
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 06:24:12 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: ce28dfa9fa

    Change-Id: I6e31b858c5da4119d4c331c2d568cb80e77711b5

commit ce28dfa9faf7446ea510e2e2f72bd8f3beb2d5b1
Author: Bill Yi <byi@google.com>
Date:   Sat Jun 9 23:23:50 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: Icccc1ebb6e107e09ed59b9b1b6a235e6d2f4f6fe
    Auto-generated-cl: translation import

commit d82564708f1400cfe610b28242cf30acd3873d09
Merge: 2d31069face ab4ca0c33d6
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 05:32:27 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1122b10e7d skipped: ab4ca0c33d

    Change-Id: I86175e2cc228f4675e51e31597dbb8df7139a84d

commit ab4ca0c33d6f30c059ec917d70a3f7895ae5a78b
Merge: 6cce31524de 1122b10e7dc
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 05:32:22 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 1122b10e7d

    Change-Id: Iff4d2ee449e66e45d078e3ed7b756de703099f9c

commit 1122b10e7dc7cb99b42004299d45e9f7ef0ce6f8
Author: Bill Yi <byi@google.com>
Date:   Sat Jun 9 22:32:06 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I78cebcdc6b07666675b4ef17fc9052e02b0ad087
    Auto-generated-cl: translation import

commit 71f5cfa65072102b75846e1cf7777251ce377552
Merge: 2d31069face 3c2edd55ce5
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 05:26:04 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 0be149db42 skipped: 3c2edd55ce

    Change-Id: I73ec9c33f82e9c2e15430a95b61c500e06ae4c38

commit 3c2edd55ce57d809c1e78dbf3194631891297c12
Merge: 6cce31524de 0be149db421
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 05:25:57 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 0be149db42

    Change-Id: I3860b45554cd0577a1aab3242537ff1735339ed3

commit 0be149db42163f35a38417aa3e8196d85fbcad1d
Author: Bill Yi <byi@google.com>
Date:   Sat Jun 9 22:25:32 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I476e13a712f47f3341ffd397570789e43120b9ae
    Auto-generated-cl: translation import

commit dafe5854ddf7a33320f912657eb9e16f4103493f
Merge: 2d31069face 5e66cc00a4a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 05:14:01 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 05238c7743 skipped: 5e66cc00a4

    Change-Id: I8b7d9d4aea3f4f8c049c7dc16bdb8294396c1606

commit 5e66cc00a4af0dfb9a95965dad33561e4d2bf9ed
Merge: 6cce31524de 05238c77436
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 05:13:55 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 05238c7743

    Change-Id: Iedcf37b86d6a03f8a8f47f1f9be1ffec5b25d107

commit 05238c77436ee575f4dd6fa5b1f385726f52734f
Author: Bill Yi <byi@google.com>
Date:   Sat Jun 9 22:13:39 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I1a91a7546288d359f218d7464c56941a60d67715
    Auto-generated-cl: translation import

commit b1615a6d905c56052c5ad868e39f97a2680f76d9
Merge: 2d31069face cc2c91ba39c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 05:01:56 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 9f043e5e58 skipped: cc2c91ba39

    Change-Id: I477c280a281f7b77477536bf3f3a4b09181f0333

commit cc2c91ba39ccbcb45276494c1c3d2d1a48e6043b
Merge: 6cce31524de 9f043e5e58a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 05:01:49 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 9f043e5e58

    Change-Id: Id7cfd1b43d8c60ebef0b5ffd6e88f2460d511ec3

commit 9f043e5e58acdb7b85c9f72cbab0bfb116cfb43a
Author: Bill Yi <byi@google.com>
Date:   Sat Jun 9 22:01:22 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I3ffe48b163bb272ff4b7daea639827cadba8a1c2
    Auto-generated-cl: translation import

commit 6d301239999fdbd02b57a9e9fafb67e6080d5de3
Merge: 2d31069face c6a1d32ebec
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 04:15:10 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 5e25fd88a8 skipped: c6a1d32ebe

    Change-Id: Ibff061c7234a3805ed90d8460ce4ca79d3d112ee

commit c6a1d32ebec7b8760706fe69bb2d560337b3638d
Merge: 6cce31524de 5e25fd88a87
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Sun Jun 10 04:15:01 2018 +0000

    [automerger skipped] Import translations. DO NOT MERGE skipped: 5e25fd88a8

    Change-Id: Iae2ab9a66d4834c4a85e6bb9eadaa6df54914726

commit 5e25fd88a875fd3f3f047c3afcff0a3f0279d3b5
Author: Bill Yi <byi@google.com>
Date:   Sat Jun 9 21:14:35 2018 -0700

    Import translations. DO NOT MERGE

    Change-Id: I0c0c18bb96c48d78238da765262543133e289c60
    Auto-generated-cl: translation import

commit beeb7f4272c7ba1fe61324ced141455fc06967a5
Author: Adrian Roos <roosa@google.com>
Date:   Thu May 31 19:54:53 2018 +0200

    ScreenDecorations: fix cutout not showing in seascape

    Now that we invert the gravity in seascape and upside down,
    we also need to invert which notch we draw in that window.

    Change-Id: I28d892a433d47f65b227220278cbc56bbbb7e674
    Fixes: 80530886
    Test: Rotate phone to seascape, turn on emulated notch. verify notch overlay is drawing.

commit 8fed14cdcbb27dc1731d166236920a4a059addfa
Author: Ahmed ElArabawy <arabawy@google.com>
Date:   Tue May 8 08:52:26 2018 -0700

    WiFi: Add configs for SAR support of body sensors

    This commit adds the configurations for support of body sensors in SAR
    for WiFi.
    It also modifies the name of the configuration to enable SAR.

    Bug: 65174506
    Test: Run Wifi unit test suite
    Test: ./frameworks/opt/net/wifi/tests/wifitests/runtests.sh

    Change-Id: I323b238a823494b8e25fc87886616a54f83b903e
    Signed-off-by: Ahmed ElArabawy <arabawy@google.com>

commit b70fbc85f7496dd1b43ed70f0c480184ba5e9585
Author: Nathan Harold <nharold@google.com>
Date:   Thu Jun 7 16:00:22 2018 -0700

    Use Uppercase instead of Lowercase for PLMN Decode

    A change to IccUtils converted from using lowercase
    to uppercase and broke the PLMN trimming logic.

    This resolves bugs where the platform may report
    5-digit PLMNs with an invalid trailing 'F' character.

    This fixes an issue introduced by aosp/575243, which
    impacts the Manual Network Selection menu and
    the public API.

    Bug: 79561854
    Test: compilation
    Change-Id: I5ea7867cd9c11fe4454188fd1f30bf58b2911712

commit 22dbf294bb0cc3bf4975a6836d3ad74b2f22a0b4
Author: Laura Davis <laurabd@google.com>
Date:   Thu Jun 7 10:41:49 2018 -0700

    docs: repaired link to internal section

    Test: make ds-docs

    Bug: 79236136
    Change-Id: Idf48cf7a055a0aa3841d6b4d0540724b43c61241

commit c106d9f958be76ab14a6724525f39bc3fec03fd2
Author: Jean-Michel Trivi <jmtrivi@google.com>
Date:   Thu Jun 7 12:28:27 2018 -0700

    AudioService: fix deallock setBluetoothScoOn vs setMode

    In AudioService:
    setBluetoothScoOn()
      > setBluetoothScoOnInt()
         > synchronized(mSettingsLock)
         > muteRingerModeStreams()
    	> synchronized (VolumeStreamState.class)
    vs
    setMode()
      > setModeInt()
         > synchronized (mSettingsLock)
            > synchronized (VolumeStreamState.class)

    The issue comes from setBluetoothScoOnInt() releasing the lock
      on mSettingsLock before calling muteRingerModeStreams(). This
      breaks the expected lock ordering in AudioService, where
      mSettingsLock must be locked before VolumeStreamState.class.

    Bug: 109746821
    Test: see bug
    Change-Id: I853ca60781efc506626b6345f27da701655ac359

commit ae07a6bf53cc9650039c4f2918baf58d522b49f9
Author: Bernie Innocenti <codewiz@google.com>
Date:   Mon May 28 22:04:37 2018 +0900

    vpn: allow IPSec traffic through Always-on VPN

    This won't leak any traffic outside the VPN as long as there are no
    processes owned by uid 0 which generate network traffic (which is
    currently the case).

    Bug: 69873852
    Test: compared the output of 'adb shell ip rule show' before and after
    Test: runtest -x frameworks/base/tests/net/java/com/android/server/connectivity/VpnTest.java
    Test: local CTS tests run: android.net.cts.VpnServiceTest
    Test: local CTS tests run: com.android.cts.devicepolicy.MixedDeviceOwnerTest
    Change-Id: I8758e576c9d961d73f62bfcf0559dd7ecee6e8e6
    Merged-In: I8758e576c9d961d73f62bfcf0559dd7ecee6e8e6
    Merged-In: I1f9b78c8f828ec2df7aba71b39d62be0c4db2550
    Merged-In: I8edeb0942e661c8385ff0cd3fdb72e6f62a8f218
    (cherry picked from commit 00000fe55a4729f8339afdc7eab5c970b2549813)

commit b27b3c7fce2905861e704c66c1e8dbe8c07492f6
Merge: fcf1757d041 09386896063
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge changes from topic "dynamic-ref-se-mnc-dev" into mnc-dr1.5-dev

    * changes:
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0
      Fix DynamicRefTable::load security bug

commit a31be05c5b5662bc710292ffd6af219dd7185fb5
Merge: 7ae28c3d563 aeb2fc64d92
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge changes from topic "dynamic-ref-se-mnc-dev" into cw-e-dev

    * changes:
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0
      Fix DynamicRefTable::load security bug

commit 70e4dec56bbcf618cc300a85af99630075ca98ff
Merge: ac3afe60a58 d65dbf91ce1
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge changes from topic "dynamic-ref-se-mnc-dev" into mnc-dr-dev

    * changes:
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0
      Fix DynamicRefTable::load security bug

commit 448b5656625d27da0003e5eef39b5801b2eebcb6
Merge: b87a87b8a9c 8cf0f988b0c
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge "Fix DynamicRefTable::load security bug" into mnc-dev

commit 390a01543140f1b2dd7ff1cc4714672a9f94dcc0
Merge: e70f2dbfad5 c7e3991628c
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge changes from topic "dynamic-ref-se-mnc-dev" into nyc-mr1-dev

    * changes:
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69 am: 69b14d2a1a
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0
      Fix DynamicRefTable::load security bug

commit f7bd2507b5022e745b31f3cc3ddd6aae9ac8b47e
Merge: 1d9938dc6a6 69b14d2a1a9
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge changes from topic "dynamic-ref-se-mnc-dev" into nyc-dr1-dev

    * changes:
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0
      Fix DynamicRefTable::load security bug

commit df97989c90972ecc3935c056279c0ce6221c7475
Merge: 186dbda9422 6f76fbfc693
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge changes from topic "dynamic-ref-se-mnc-dev" into nyc-dev

    * changes:
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0
      Fix DynamicRefTable::load security bug

commit 6cce31524de35c1a54d18aac60c1309428e9581c
Merge: 121d0df091f 648a950ce98
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge changes from topic "dynamic-ref-se-mnc-dev" into nyc-mr2-dev

    * changes:
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69 am: 69b14d2a1a am: c7e3991628 am: c3aa2a4d3f
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69 am: 69b14d2a1a am: c7e3991628
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69 am: 69b14d2a1a
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0
      Fix DynamicRefTable::load security bug

commit 6819dd44b1f5e213b63f241dd24533f3559fd3f7
Merge: cc6ed825470 c3aa2a4d3fb
Author: Ryan Mitchell <rtmitchell@google.com>
Date:   Wed Jun 6 23:33:08 2018 +0000

    Merge changes from topic "dynamic-ref-se-mnc-dev" into cw-f-dev

    * changes:
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69 am: 69b14d2a1a am: c7e3991628
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69 am: 69b14d2a1a
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606 am: 6f76fbfc69
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9 am: 0938689606
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce am: aeb2fc64d9
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0 am: d65dbf91ce
      [automerger] Fix DynamicRefTable::load security bug am: 8cf0f988b0
      Fix DynamicRefTable::load security bug

commit fcf1757d041ccb668986ab8aa0f57ebd279b0419
Merge: a60d0b2e934 6714a260e60
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge changes from topic "am-c1e91e5e-2686-4871-b188-107c0ddf3273" into mnc-dr1.5-dev

    * changes:
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008
      ResStringPool: Prevenet boot loop from se fix

commit 7ae28c3d56386580a3f227681b044138c3aaaa8d
Merge: eb86ac42e6c 5a632d1b590
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge changes from topic "am-c1e91e5e-2686-4871-b188-107c0ddf3273" into cw-e-dev

    * changes:
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008
      ResStringPool: Prevenet boot loop from se fix

commit ac3afe60a5822ab62c7d92eced414694520f1ebf
Merge: 5b224ccf41d fd1097e4364
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge changes from topic "am-c1e91e5e-2686-4871-b188-107c0ddf3273" into mnc-dr-dev

    * changes:
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008
      ResStringPool: Prevenet boot loop from se fix

commit b87a87b8a9c7a41fd52ff08674b5e6af5e867194
Merge: 3b6f84b77c3 c31cf80008f
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge "ResStringPool: Prevenet boot loop from se fix" into mnc-dev

commit e70f2dbfad50551985104c003fa1e31f1022124b
Merge: c62d5108874 ad43c89030d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge changes from topic "am-c1e91e5e-2686-4871-b188-107c0ddf3273" into nyc-mr1-dev

    * changes:
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404 am: 3926163983
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008
      ResStringPool: Prevenet boot loop from se fix

commit 1d9938dc6a6dcd246cdad2929b91297d1b5d42fd
Merge: acb5b014aff 39261639838
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge changes from topic "am-c1e91e5e-2686-4871-b188-107c0ddf3273" into nyc-dr1-dev

    * changes:
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008
      ResStringPool: Prevenet boot loop from se fix

commit 186dbda9422183c0af51f93fc3fdbd7da6f381aa
Merge: a16b03c540b 3a272fe404d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge changes from topic "am-c1e91e5e-2686-4871-b188-107c0ddf3273" into nyc-dev

    * changes:
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008
      ResStringPool: Prevenet boot loop from se fix

commit 121d0df091f9f85fcb14d9ac31b5baf21a84be77
Merge: 83d96880771 c51c6751d71
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge changes from topic "am-c1e91e5e-2686-4871-b188-107c0ddf3273" into nyc-mr2-dev

    * changes:
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404 am: 3926163983 am: ad43c89030 am: a659d7c233
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404 am: 3926163983 am: ad43c89030
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404 am: 3926163983
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008
      ResStringPool: Prevenet boot loop from se fix

commit cc6ed82547052a7e75b788586a7ec31693669afe
Merge: ea648c6a2b7 a659d7c2336
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 6 22:09:54 2018 +0000

    Merge changes from topic "am-c1e91e5e-2686-4871-b188-107c0ddf3273" into cw-f-dev

    * changes:
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404 am: 3926163983 am: ad43c89030
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404 am: 3926163983
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6 am: 3a272fe404
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59 am: 6714a260e6
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436 am: 5a632d1b59
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008 am: fd1097e436
      [automerger] ResStringPool: Prevenet boot loop from se fix am: c31cf80008
      ResStringPool: Prevenet boot loop from se fix

commit 01c80136ba574f9213bf07fedb794d420e1de119
Author: Joshua Baxter <jbax@google.com>
Date:   Mon Jun 4 14:27:59 2018 -0700

    docs: fixed typo

    Test: make ds-docs

    Bug: 36966026
    Change-Id: I4eaef8ba2b281451c77c7897af7273e3e8ac8cff

commit df66bfaa0df7327fa6f6457b01d789c0c0191066
Author: Joshua Baxter <jbax@google.com>
Date:   Mon Jun 4 13:30:17 2018 -0700

    docs: fixed typo

    Test: make ds-docs

    Bug: 78873111
    Change-Id: I7c50d83ee0c55dae6aecadc676fe784c1727ef7a

commit a9aa1be6c76be3d46bdf0c5ac04e735ffec6afe7
Author: Joshua Baxter <jbax@google.com>
Date:   Mon Jun 4 13:25:13 2018 -0700

    docs: fixed typo

    Test: make ds-docs

    Bug: 36944070
    Change-Id: I47ee8cb59516495c9271308e1de84e0dc7265fb6

commit 2ef26755473d812bab87e0e07ba1714b053c1e3e
Author: Joshua Baxter <jbax@google.com>
Date:   Fri May 25 11:25:50 2018 -0700

    docs: fixed typo

    Test: make ds-docs

    Bug: 79973165
    Change-Id: I058e1ee49ec29890764a7deac5f8e0d40a61ba7f

commit 2107bea9c4b1785576bb0f1db459346c4e8ea6f8
Author: Julia Reynolds <juliacr@google.com>
Date:   Fri Mar 30 10:19:35 2018 -0400

    Catch unbinding errors

    Test: none
    Change-Id: Ia8ca50c7c55b86fac84a04a5e4ef2aa36ae6bf6e
    Fixes: 72206319
    (cherry picked from commit 7e9659fadc308cbe2f33d9915f3461bead791386)

Change-Id: Ie760d5b76520f22cbb9c5154c7e8f9521f3199d5

# Conflicts:
#	core/java/android/view/WindowManager.java
#	core/res/res/values/config.xml
#	core/res/res/values/symbols.xml
#	packages/SystemUI/res/values/dimens.xml
#	packages/SystemUI/src/com/android/systemui/BatteryMeterView.java
#	packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
#	packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
#	packages/SystemUI/src/com/android/systemui/statusbar/stack/NotificationStackScrollLayout.java
#	services/core/java/com/android/server/policy/PhoneWindowManager.java
---
 Android.mk                                    |   3 +-
 cmds/bootanimation/BootAnimation.cpp          |  49 +-
 cmds/bootanimation/BootAnimation.h            |   4 +
 .../AccessibilityServiceInfo.java             |  33 +-
 core/java/android/animation/IntEvaluator.java |   4 +-
 core/java/android/app/Activity.java           |  14 +-
 .../android/app/ActivityManagerInternal.java  |  11 +
 core/java/android/app/ActivityThread.java     |  11 +
 core/java/android/app/Notification.java       |   1 -
 core/java/android/app/ResourcesManager.java   |  53 +-
 .../android/app/assist/AssistStructure.java   |  13 +-
 .../appwidget/AppWidgetManagerInternal.java   |  12 +-
 core/java/android/content/Context.java        |   9 +
 .../android/content/pm/ApplicationInfo.java   |   6 +
 .../android/content/pm/IPackageManager.aidl   |   3 +
 .../android/content/pm/PackageManager.java    |  11 +-
 .../android/content/pm/PackageParser.java     |  10 +-
 .../android/content/pm/ShortcutManager.java   | 272 +--------
 .../android/database/sqlite/SQLiteGlobal.java |  17 +
 .../camera2/CameraCharacteristics.java        |  70 ++-
 .../hardware/camera2/CameraDevice.java        |  20 +-
 .../hardware/camera2/CameraMetadata.java      |  10 +-
 .../hardware/camera2/CaptureRequest.java      | 173 ++++--
 .../hardware/camera2/CaptureResult.java       | 263 +++++++--
 .../camera2/impl/CameraMetadataNative.java    |   3 +
 .../camera2/params/OutputConfiguration.java   |   6 +-
 core/java/android/net/TrafficStats.java       |   8 +
 core/java/android/os/Build.java               |  30 +-
 core/java/android/os/Message.java             |   2 +-
 core/java/android/os/Parcel.java              |  10 +-
 .../java/android/os/StatsLogEventWrapper.java |  21 +-
 .../preference/PreferenceActivity.java        |   2 +-
 core/java/android/provider/Settings.java      |  18 +-
 .../android/service/autofill/Dataset.java     |  13 +-
 .../service/autofill/FillCallback.java        |   7 +-
 .../service/notification/Condition.java       |  16 +-
 .../service/notification/ZenModeConfig.java   |  40 +-
 .../java/android/speech/tts/TextToSpeech.java |   6 +-
 core/java/android/util/SparseArray.java       |  36 +-
 core/java/android/view/DisplayCutout.java     |  60 +-
 core/java/android/view/ThreadedRenderer.java  |   5 +
 core/java/android/view/ViewRootImpl.java      |   3 +-
 core/java/android/view/ViewStructure.java     |   7 +-
 core/java/android/view/WindowManager.java     |  15 +-
 .../accessibility/AccessibilityRecord.java    |   2 +-
 .../view/autofill/AutofillManager.java        |  53 +-
 .../android/webkit/WebBackForwardList.java    |   3 +-
 core/java/android/webkit/WebHistoryItem.java  |  12 +-
 core/java/android/webkit/WebSettings.java     |   8 +-
 core/java/android/webkit/WebView.java         | 287 +---------
 core/java/android/webkit/WebViewClient.java   |  60 +-
 core/java/android/widget/AbsListView.java     |   2 +-
 core/java/android/widget/AdapterView.java     |   4 +-
 core/java/android/widget/ImageView.java       |   2 +-
 .../internal/app/IntentForwarderActivity.java |  80 ++-
 .../internal/app/PlatLogoActivity.java        |  80 ++-
 .../hardware/AmbientDisplayConfiguration.java |   6 +-
 .../android/internal/os/BatteryStatsImpl.java |   4 +-
 .../internal/widget/MessagingLayout.java      |  14 +-
 .../widget/MessagingLinearLayout.java         |   9 +-
 .../java/com/android/server/BootReceiver.java |   4 +-
 core/jni/android_view_ThreadedRenderer.cpp    |   8 +
 core/jni/com_android_internal_os_Zygote.cpp   |  16 +-
 .../android/server/windowmanagerservice.proto |   2 +
 core/res/AndroidManifest.xml                  |  12 +-
 .../anim/lock_screen_behind_enter_fade_in.xml |   1 -
 core/res/res/values-af/strings.xml            |   3 +
 core/res/res/values-am/strings.xml            |   7 +-
 core/res/res/values-ar/strings.xml            |   9 +-
 core/res/res/values-as/strings.xml            |  12 +-
 core/res/res/values-az/strings.xml            |   3 +
 core/res/res/values-b+sr+Latn/strings.xml     |   3 +
 core/res/res/values-be/strings.xml            |   9 +-
 core/res/res/values-bg/strings.xml            |   3 +
 core/res/res/values-bn/strings.xml            |   7 +-
 core/res/res/values-bs/strings.xml            |  11 +-
 core/res/res/values-ca/strings.xml            |   9 +-
 core/res/res/values-cs/strings.xml            |   3 +
 core/res/res/values-da/strings.xml            |   7 +-
 core/res/res/values-de/strings.xml            |   3 +
 core/res/res/values-el/strings.xml            |   3 +
 core/res/res/values-en-rAU/strings.xml        |   3 +
 core/res/res/values-en-rCA/strings.xml        |   3 +
 core/res/res/values-en-rGB/strings.xml        |   3 +
 core/res/res/values-en-rIN/strings.xml        |   3 +
 core/res/res/values-en-rXC/strings.xml        |   3 +
 core/res/res/values-es-rUS/strings.xml        |   3 +
 core/res/res/values-es/strings.xml            |   7 +-
 core/res/res/values-et/strings.xml            |   3 +
 core/res/res/values-eu/strings.xml            |   3 +
 core/res/res/values-fa/strings.xml            |   3 +
 core/res/res/values-fi/strings.xml            |   3 +
 core/res/res/values-fr-rCA/strings.xml        |  13 +-
 core/res/res/values-fr/strings.xml            |   7 +-
 core/res/res/values-gl/strings.xml            |   3 +
 core/res/res/values-gu/strings.xml            |   3 +
 core/res/res/values-hi/strings.xml            |   7 +-
 core/res/res/values-hr/strings.xml            |   3 +
 core/res/res/values-hu/strings.xml            |   3 +
 core/res/res/values-hy/strings.xml            |  13 +-
 core/res/res/values-in/strings.xml            |  13 +-
 core/res/res/values-is/strings.xml            |   3 +
 core/res/res/values-it/strings.xml            |  17 +-
 core/res/res/values-iw/strings.xml            |   5 +-
 core/res/res/values-ja/strings.xml            |   3 +
 core/res/res/values-ka/strings.xml            |   3 +
 core/res/res/values-kk/strings.xml            |   3 +
 core/res/res/values-km/strings.xml            |   3 +
 core/res/res/values-kn/strings.xml            |   3 +
 core/res/res/values-ko/strings.xml            |   5 +-
 core/res/res/values-ky/strings.xml            |   5 +-
 core/res/res/values-lo/strings.xml            |   3 +
 core/res/res/values-lt/strings.xml            |   3 +
 core/res/res/values-lv/strings.xml            |   3 +
 core/res/res/values-mcc214-mnc01/config.xml   |   3 +
 core/res/res/values-mcc214/config.xml         |  28 +
 core/res/res/values-mcc222-mnc10/config.xml   |   4 +
 core/res/res/values-mcc234-mnc15/config.xml   |  25 +
 core/res/res/values-mcc234-mnc91/config.xml   |  25 +
 core/res/res/values-mcc262-mnc02/config.xml   |  25 +
 core/res/res/values-mcc302-mnc220/config.xml  |   2 +-
 core/res/res/values-mcc302-mnc221/config.xml  |   2 +-
 core/res/res/values-mcc302-mnc370/config.xml  |   2 +-
 core/res/res/values-mcc302-mnc610/config.xml  |   2 +-
 core/res/res/values-mcc302-mnc640/config.xml  |   2 +-
 core/res/res/values-mcc302-mnc720/config.xml  |   2 +-
 core/res/res/values-mk/strings.xml            |   3 +
 core/res/res/values-ml/strings.xml            |   3 +
 core/res/res/values-mn/strings.xml            |   3 +
 core/res/res/values-mr/strings.xml            |   3 +
 core/res/res/values-ms/strings.xml            |   3 +
 core/res/res/values-my/strings.xml            |   5 +-
 core/res/res/values-nb/strings.xml            |  17 +-
 core/res/res/values-ne/strings.xml            |   3 +
 core/res/res/values-nl/strings.xml            |  17 +-
 core/res/res/values-or/strings.xml            |  12 +-
 core/res/res/values-pa/strings.xml            |   3 +
 core/res/res/values-pl/strings.xml            |   9 +-
 core/res/res/values-pt-rBR/strings.xml        |   9 +-
 core/res/res/values-pt-rPT/strings.xml        |  11 +-
 core/res/res/values-pt/strings.xml            |   9 +-
 core/res/res/values-ro/strings.xml            |   3 +
 core/res/res/values-ru/strings.xml            |  23 +-
 core/res/res/values-si/strings.xml            |   3 +
 core/res/res/values-sk/strings.xml            |   7 +-
 core/res/res/values-sl/strings.xml            |   3 +
 core/res/res/values-sq/strings.xml            |   3 +
 core/res/res/values-sr/strings.xml            |   3 +
 core/res/res/values-sv/strings.xml            |  13 +-
 core/res/res/values-sw/strings.xml            |  31 +-
 core/res/res/values-ta/strings.xml            |   3 +
 core/res/res/values-te/strings.xml            |   3 +
 core/res/res/values-th/strings.xml            |   5 +-
 core/res/res/values-tl/strings.xml            |   3 +
 core/res/res/values-tr/strings.xml            |   5 +-
 core/res/res/values-uk/strings.xml            |   3 +
 core/res/res/values-ur/strings.xml            |   3 +
 core/res/res/values-uz/strings.xml            |   3 +
 core/res/res/values-vi/strings.xml            |   3 +
 core/res/res/values-zh-rCN/strings.xml        |   3 +
 core/res/res/values-zh-rHK/strings.xml        |   3 +
 core/res/res/values-zh-rTW/strings.xml        |   3 +
 core/res/res/values-zu/strings.xml            |   3 +
 core/res/res/values/config.xml                |  82 ++-
 core/res/res/values/dimens.xml                |   9 +
 core/res/res/values/strings.xml               |  15 +
 core/res/res/values/symbols.xml               |  27 +-
 core/res/res/values/themes.xml                |   1 +
 core/res/res/values/themes_holo.xml           |   3 +
 .../android/provider/SettingsBackupTest.java  |   3 +
 .../src/android/view/DisplayCutoutTest.java   |  14 +
 .../app/IntentForwarderActivityTest.java      | 205 ++++++-
 graphics/java/android/graphics/Canvas.java    |   6 +-
 .../AndroidKeyStoreKeyGeneratorSpi.java       |  11 +-
 .../security/keystore/AndroidKeyStoreSpi.java |   2 +-
 .../security/keystore/AttestationUtils.java   |  38 +-
 .../keystore/KeyGenParameterSpec.java         |   8 +
 .../ParcelableKeyGenParameterSpec.java        | 102 ++--
 .../ParcelableKeyGenParameterSpecTest.java    |   6 +
 libs/hwui/renderthread/RenderProxy.cpp        |   5 +
 libs/hwui/renderthread/RenderProxy.h          |   1 +
 .../location/gnssmetrics/GnssMetrics.java     |   3 +
 media/java/android/media/MediaCodec.java      |   2 +-
 media/java/android/media/MediaFormat.java     |   2 +-
 media/jni/android_media_ImageReader.cpp       |   6 +-
 .../helpers/CameraTestUtils.java              |  49 ++
 .../stress/Camera2RecordingTest.java          |   7 +-
 .../res/values-pt-rBR/strings.xml             |   2 +-
 .../res/values-pt/strings.xml                 |   2 +-
 packages/EasterEgg/Android.bp                 |  33 ++
 packages/EasterEgg/Android.mk                 |  29 -
 packages/EasterEgg/AndroidManifest.xml        |  93 +--
 .../toolbar_icon_color.xml}                   |  16 +-
 .../toolbar_icon_color.xml}                   |   9 +-
 packages/EasterEgg/res/drawable/back.xml      |  22 -
 packages/EasterEgg/res/drawable/belly.xml     |  22 -
 packages/EasterEgg/res/drawable/cap.xml       |  22 -
 packages/EasterEgg/res/drawable/collar.xml    |  22 -
 packages/EasterEgg/res/drawable/face_spot.xml |  22 -
 packages/EasterEgg/res/drawable/food_bits.xml |  33 --
 .../EasterEgg/res/drawable/food_chicken.xml   |  39 --
 .../EasterEgg/res/drawable/food_cookie.xml    |  35 --
 packages/EasterEgg/res/drawable/food_dish.xml |  24 -
 .../EasterEgg/res/drawable/food_donut.xml     |  24 -
 .../EasterEgg/res/drawable/food_sysuituna.xml |  24 -
 packages/EasterEgg/res/drawable/foot1.xml     |  22 -
 packages/EasterEgg/res/drawable/foot2.xml     |  22 -
 packages/EasterEgg/res/drawable/foot3.xml     |  22 -
 packages/EasterEgg/res/drawable/foot4.xml     |  22 -
 packages/EasterEgg/res/drawable/head.xml      |  22 -
 .../res/drawable/{bowtie.xml => ic_clear.xml} |  17 +-
 .../EasterEgg/res/drawable/ic_dropper.xml     |  39 ++
 .../EasterEgg/res/drawable/ic_hourglass.xml   |  27 +
 packages/EasterEgg/res/drawable/ic_share.xml  |  24 -
 packages/EasterEgg/res/drawable/icon.xml      |  33 +-
 .../filepaths.xml => drawable/icon_bg.xml}    |   9 +-
 packages/EasterEgg/res/drawable/left_ear.xml  |  22 -
 .../res/drawable/left_ear_inside.xml          |  22 -
 packages/EasterEgg/res/drawable/left_eye.xml  |  22 -
 packages/EasterEgg/res/drawable/leg2.xml      |  22 -
 .../EasterEgg/res/drawable/leg2_shadow.xml    |  22 -
 packages/EasterEgg/res/drawable/leg3.xml      |  22 -
 packages/EasterEgg/res/drawable/leg4.xml      |  22 -
 packages/EasterEgg/res/drawable/mouth.xml     |  27 -
 packages/EasterEgg/res/drawable/nose.xml      |  22 -
 packages/EasterEgg/res/drawable/octo_bg.xml   |   8 -
 packages/EasterEgg/res/drawable/p.xml         |  33 ++
 packages/EasterEgg/res/drawable/right_ear.xml |  22 -
 packages/EasterEgg/res/drawable/right_eye.xml |  22 -
 packages/EasterEgg/res/drawable/stat_icon.xml |  30 -
 packages/EasterEgg/res/drawable/tail.xml      |  26 -
 packages/EasterEgg/res/drawable/tail_cap.xml  |  22 -
 .../EasterEgg/res/drawable/tail_shadow.xml    |  22 -
 .../EasterEgg/res/drawable/toolbar_bg.xml     |  19 +
 .../{ic_close.xml => toolbar_button_bg.xml}   |  21 +-
 .../EasterEgg/res/layout/activity_paint.xml   |  48 ++
 .../{drawable/body.xml => layout/brushes.xml} |  21 +-
 packages/EasterEgg/res/layout/cat_view.xml    |  82 ---
 .../colors.xml}                               |  21 +-
 packages/EasterEgg/res/layout/edit_text.xml   |  30 -
 packages/EasterEgg/res/layout/food_layout.xml |  31 -
 .../EasterEgg/res/layout/neko_activity.xml    |  25 -
 packages/EasterEgg/res/layout/toolbar.xml     | 111 ++++
 .../EasterEgg/res/values-night/colors.xml     |  21 +
 .../EasterEgg/res/values-night/styles.xml     |  21 +
 .../res/values/attrs_toolbar_view.xml         |  19 +
 packages/EasterEgg/res/values/colors.xml      |  21 +
 packages/EasterEgg/res/values/strings.xml     |  39 +-
 packages/EasterEgg/res/values/styles.xml      |  23 +
 .../src/com/android/egg/neko/Cat.java         | 434 --------------
 .../src/com/android/egg/neko/Food.java        |  60 --
 .../egg/neko/NekoActivationActivity.java      |  57 --
 .../src/com/android/egg/neko/NekoDialog.java  | 107 ----
 .../src/com/android/egg/neko/NekoLand.java    | 338 -----------
 .../android/egg/neko/NekoLockedActivity.java  |  45 --
 .../src/com/android/egg/neko/NekoService.java | 165 ------
 .../src/com/android/egg/neko/NekoTile.java    | 114 ----
 .../src/com/android/egg/neko/PrefState.java   |  92 ---
 .../src/com/android/egg/octo/Ocquarium.java   |  89 ---
 .../com/android/egg/octo/OctopusDrawable.java | 436 --------------
 .../android/egg/octo/TaperedPathStroke.java   |  55 --
 .../egg/paint/BrushPropertyDrawable.kt        |  93 +++
 .../egg/paint/CutoutAvoidingToolbar.kt        |  88 +++
 .../com/android/egg/paint/PaintActivity.java  | 351 ++++++++++++
 .../src/com/android/egg/paint/Painting.kt     | 358 ++++++++++++
 .../src/com/android/egg/paint/Palette.kt      |  83 +++
 .../src/com/android/egg/paint/SpotFilter.kt   | 124 ++++
 .../src/com/android/egg/paint/ToolbarView.kt  |  77 +++
 .../PrintSpooler/res/values-ar/strings.xml    |   2 +-
 .../PrintSpooler/res/values-bg/strings.xml    |   2 +-
 .../PrintSpooler/res/values-da/strings.xml    |   6 +-
 .../PrintSpooler/res/values-hu/strings.xml    |   2 +-
 .../PrintSpooler/res/values-km/strings.xml    |   4 +-
 .../PrintSpooler/res/values-ml/strings.xml    |   2 +-
 .../PrintSpooler/res/values-my/strings.xml    |   8 +-
 .../res/values-pt-rPT/strings.xml             |   2 +-
 .../PrintSpooler/res/values-sk/strings.xml    |   2 +-
 .../PrintSpooler/res/values-sw/strings.xml    |   2 +-
 .../PrintSpooler/res/values-uz/strings.xml    |   2 +-
 .../SettingsLib/res/values-as/strings.xml     |  21 +-
 .../SettingsLib/res/values-bn/strings.xml     |   8 +-
 packages/SettingsLib/res/values-bs/arrays.xml |  50 +-
 .../SettingsLib/res/values-bs/strings.xml     |  64 +--
 .../SettingsLib/res/values-ca/strings.xml     |   4 +-
 .../SettingsLib/res/values-es/strings.xml     |   6 +-
 .../SettingsLib/res/values-fa/strings.xml     |   2 +-
 packages/SettingsLib/res/values-gl/arrays.xml |  14 +-
 .../SettingsLib/res/values-gl/strings.xml     |  10 +-
 .../SettingsLib/res/values-ja/strings.xml     |   2 +-
 .../SettingsLib/res/values-nb/strings.xml     |   2 +-
 .../SettingsLib/res/values-ne/strings.xml     |   2 +-
 .../SettingsLib/res/values-nl/strings.xml     |   4 +-
 .../SettingsLib/res/values-or/strings.xml     |   3 +-
 .../SettingsLib/res/values-pl/strings.xml     |   2 +-
 .../SettingsLib/res/values-pt-rBR/arrays.xml  |  10 +-
 .../SettingsLib/res/values-pt-rBR/strings.xml |   6 +-
 packages/SettingsLib/res/values-pt/arrays.xml |  10 +-
 .../SettingsLib/res/values-pt/strings.xml     |   6 +-
 .../SettingsLib/res/values-ru/strings.xml     |  10 +-
 packages/SettingsLib/res/values-sw/arrays.xml |  18 +-
 .../SettingsLib/res/values-sw/strings.xml     |  10 +-
 packages/SettingsLib/res/values-ta/arrays.xml |  40 +-
 .../SettingsLib/res/values-ta/strings.xml     |   6 +-
 .../applications/ApplicationsState.java       |  68 ++-
 .../bluetooth/LocalBluetoothManager.java      |  12 +-
 .../settingslib/dream/DreamBackend.java       |  12 +-
 .../settings/SettingsBackupAgent.java         |  12 +
 packages/Shell/res/values-hy/strings.xml      |  12 +-
 .../android/systemui/plugins/qs/QSTile.java   |   2 +-
 .../res-keyguard/values-bs/strings.xml        |   2 +-
 .../res/drawable-hdpi/qs_scrubber_track.9.png | Bin 365 -> 0 bytes
 .../res/drawable-mdpi/qs_scrubber_track.9.png | Bin 223 -> 0 bytes
 .../drawable-xhdpi/qs_scrubber_track.9.png    | Bin 386 -> 0 bytes
 .../drawable-xxhdpi/qs_scrubber_track.9.png   | Bin 685 -> 0 bytes
 .../drawable-xxxhdpi/qs_scrubber_track.9.png  | Bin 747 -> 0 bytes
 .../SystemUI/res/layout/navigation_layout.xml |  12 +-
 .../res/layout/navigation_layout_rot90.xml    |  20 +-
 packages/SystemUI/res/values-af/strings.xml   |   1 -
 packages/SystemUI/res/values-am/strings.xml   |   1 -
 packages/SystemUI/res/values-ar/strings.xml   |   1 -
 packages/SystemUI/res/values-as/strings.xml   |   7 +-
 .../SystemUI/res/values-as/strings_car.xml    |   6 +-
 packages/SystemUI/res/values-az/strings.xml   |   1 -
 .../SystemUI/res/values-b+sr+Latn/strings.xml |   1 -
 packages/SystemUI/res/values-be/strings.xml   |   1 -
 packages/SystemUI/res/values-bg/strings.xml   |   1 -
 packages/SystemUI/res/values-bn/strings.xml   |  19 +-
 packages/SystemUI/res/values-bs/strings.xml   |   5 +-
 packages/SystemUI/res/values-ca/strings.xml   |   3 +-
 packages/SystemUI/res/values-cs/strings.xml   |   1 -
 packages/SystemUI/res/values-da/strings.xml   |   5 +-
 packages/SystemUI/res/values-de/strings.xml   |   1 -
 packages/SystemUI/res/values-el/strings.xml   |   1 -
 .../SystemUI/res/values-en-rAU/strings.xml    |   1 -
 .../SystemUI/res/values-en-rCA/strings.xml    |   1 -
 .../SystemUI/res/values-en-rGB/strings.xml    |   1 -
 .../SystemUI/res/values-en-rIN/strings.xml    |   1 -
 .../SystemUI/res/values-en-rXC/strings.xml    |   1 -
 .../SystemUI/res/values-es-rUS/strings.xml    |   1 -
 packages/SystemUI/res/values-es/strings.xml   |   1 -
 packages/SystemUI/res/values-et/strings.xml   |   1 -
 packages/SystemUI/res/values-eu/strings.xml   |   5 +-
 packages/SystemUI/res/values-fa/strings.xml   |   1 -
 packages/SystemUI/res/values-fi/strings.xml   |   1 -
 .../SystemUI/res/values-fr-rCA/strings.xml    |   1 -
 packages/SystemUI/res/values-fr/strings.xml   |   1 -
 packages/SystemUI/res/values-gl/strings.xml   |   1 -
 packages/SystemUI/res/values-gu/strings.xml   |   1 -
 packages/SystemUI/res/values-hi/strings.xml   |   3 +-
 packages/SystemUI/res/values-hr/strings.xml   |   1 -
 packages/SystemUI/res/values-hu/strings.xml   |   1 -
 packages/SystemUI/res/values-hy/strings.xml   |  19 +-
 packages/SystemUI/res/values-in/strings.xml   |   3 +-
 packages/SystemUI/res/values-is/strings.xml   |   1 -
 packages/SystemUI/res/values-it/strings.xml   |   1 -
 packages/SystemUI/res/values-iw/strings.xml   |   1 -
 packages/SystemUI/res/values-ja/strings.xml   |   5 +-
 packages/SystemUI/res/values-ka/strings.xml   |   1 -
 packages/SystemUI/res/values-kk/strings.xml   |   1 -
 packages/SystemUI/res/values-km/strings.xml   |   1 -
 packages/SystemUI/res/values-kn/strings.xml   |   1 -
 packages/SystemUI/res/values-ko/strings.xml   |   1 -
 packages/SystemUI/res/values-ky/strings.xml   |   3 +-
 packages/SystemUI/res/values-lo/strings.xml   |   1 -
 packages/SystemUI/res/values-lt/strings.xml   |   5 +-
 packages/SystemUI/res/values-lv/strings.xml   |   1 -
 packages/SystemUI/res/values-mk/strings.xml   |   1 -
 packages/SystemUI/res/values-ml/strings.xml   |   1 -
 packages/SystemUI/res/values-mn/strings.xml   |   1 -
 packages/SystemUI/res/values-mr/strings.xml   |   1 -
 packages/SystemUI/res/values-ms/strings.xml   |   1 -
 packages/SystemUI/res/values-my/strings.xml   |   1 -
 packages/SystemUI/res/values-nb/strings.xml   |   3 +-
 packages/SystemUI/res/values-ne/strings.xml   |   1 -
 packages/SystemUI/res/values-nl/strings.xml   |   1 -
 packages/SystemUI/res/values-or/strings.xml   |  10 +-
 packages/SystemUI/res/values-pa/strings.xml   |   1 -
 packages/SystemUI/res/values-pl/strings.xml   |   1 -
 .../SystemUI/res/values-pt-rBR/strings.xml    |   1 -
 .../SystemUI/res/values-pt-rPT/strings.xml    |   1 -
 packages/SystemUI/res/values-pt/strings.xml   |   1 -
 packages/SystemUI/res/values-ro/strings.xml   |   1 -
 packages/SystemUI/res/values-ru/strings.xml   |   1 -
 packages/SystemUI/res/values-si/strings.xml   |   1 -
 packages/SystemUI/res/values-sk/strings.xml   |   1 -
 packages/SystemUI/res/values-sl/strings.xml   |   1 -
 packages/SystemUI/res/values-sq/strings.xml   |   1 -
 packages/SystemUI/res/values-sr/strings.xml   |   1 -
 packages/SystemUI/res/values-sv/strings.xml   |   1 -
 packages/SystemUI/res/values-sw/strings.xml   |   7 +-
 packages/SystemUI/res/values-ta/strings.xml   |   1 -
 packages/SystemUI/res/values-te/strings.xml   |   1 -
 packages/SystemUI/res/values-th/strings.xml   |   5 +-
 packages/SystemUI/res/values-tl/strings.xml   |   1 -
 packages/SystemUI/res/values-tr/strings.xml   |   1 -
 packages/SystemUI/res/values-uk/strings.xml   |   1 -
 packages/SystemUI/res/values-ur/strings.xml   |   1 -
 packages/SystemUI/res/values-uz/strings.xml   |   1 -
 packages/SystemUI/res/values-vi/strings.xml   |   1 -
 .../SystemUI/res/values-zh-rCN/strings.xml    |   1 -
 .../SystemUI/res/values-zh-rHK/strings.xml    |   1 -
 .../SystemUI/res/values-zh-rTW/strings.xml    |   1 -
 packages/SystemUI/res/values-zu/strings.xml   |   1 -
 packages/SystemUI/res/values/colors.xml       |   6 +-
 packages/SystemUI/res/values/dimens.xml       |  28 +-
 packages/SystemUI/res/values/strings.xml      |   3 -
 .../shared/system/NavigationBarCompat.java    |   1 +
 .../keyguard/KeyguardSecurityContainer.java   |  11 +-
 .../android/keyguard/KeyguardStatusView.java  |  20 +-
 .../keyguard/KeyguardUpdateMonitor.java       |  19 +-
 .../android/systemui/BatteryMeterView.java    |   9 +-
 .../com/android/systemui/ImageWallpaper.java  |   2 +-
 .../com/android/systemui/Interpolators.java   |  14 +
 .../android/systemui/ScreenDecorations.java   | 320 +++++++++--
 .../colorextraction/SysuiColorExtractor.java  |  11 +-
 .../keyguard/KeyguardViewMediator.java        |  24 +-
 .../power/PowerNotificationWarnings.java      |   9 +-
 .../com/android/systemui/power/PowerUI.java   |  25 +-
 .../src/com/android/systemui/qs/QSPanel.java  |   3 -
 .../systemui/qs/QuickStatusBarHeader.java     |  30 +-
 .../qs/customize/TileQueryHelper.java         |   1 -
 .../systemui/qs/tileimpl/QSTileBaseView.java  |   2 +
 .../systemui/qs/tileimpl/QSTileImpl.java      |  21 +-
 .../systemui/recents/RecentsOnboarding.java   |   8 +-
 .../statusbar/HeadsUpStatusBarView.java       |   6 +-
 .../statusbar/NotificationEntryManager.java   |  12 +-
 .../NotificationLockscreenUserManager.java    |  24 -
 .../systemui/statusbar/NotificationShelf.java |   5 +-
 .../phone/FingerprintUnlockController.java    |  33 +-
 .../phone/HeadsUpAppearanceController.java    |  12 +-
 .../statusbar/phone/HeadsUpManagerPhone.java  |  45 +-
 .../phone/KeyguardBottomAreaView.java         |  16 +-
 .../phone/KeyguardStatusBarView.java          |   5 +-
 .../statusbar/phone/NavigationBarView.java    |  15 +-
 .../phone/NotificationIconAreaController.java |  40 +-
 .../phone/NotificationPanelView.java          |  82 ++-
 .../systemui/statusbar/phone/PanelBar.java    |  10 +
 .../statusbar/phone/PhoneStatusBarView.java   |  33 +-
 .../statusbar/phone/QuickStepController.java  |  75 ++-
 .../statusbar/phone/ScrimController.java      |  39 +-
 .../systemui/statusbar/phone/ScrimState.java  |  22 +-
 .../systemui/statusbar/phone/StatusBar.java   |  65 ++-
 .../phone/StatusBarKeyguardViewManager.java   |   2 +-
 .../phone/StatusBarWindowManager.java         |  10 +
 .../statusbar/phone/StatusBarWindowView.java  |  49 +-
 .../policy/HotspotControllerImpl.java         |   4 +
 .../policy/ZenModeControllerImpl.java         |   4 -
 .../statusbar/stack/AnimationFilter.java      |   4 +
 .../stack/NotificationStackScrollLayout.java  | 177 +++---
 .../statusbar/stack/StackStateAnimator.java   |  26 +-
 .../src/com/android/systemui/util/Utils.java  |   7 +-
 .../systemui/volume/SafetyWarningDialog.java  |  13 +-
 .../systemui/ScreenDecorationsTest.java       |  47 +-
 .../SysuiColorExtractorTests.java             |   2 +-
 .../systemui/doze/DozeConfigurationTest.java  |   9 +-
 .../android/systemui/power/PowerUITest.java   |  52 +-
 .../statusbar/phone/ScrimControllerTest.java  |   9 +-
 .../StatusBarKeyguardViewManagerTest.java     |   8 +
 .../res/values-pl/strings.xml                 |   2 +-
 .../res/values/config.xml                     |   2 +
 .../res/values/strings.xml                    |   2 +-
 .../res/values-pl/strings.xml                 |   2 +-
 .../res/values/config.xml                     |   2 +
 .../res/values/strings.xml                    |   2 +-
 .../res/values-pl/strings.xml                 |   2 +-
 .../res/values/config.xml                     |   2 +
 .../res/values/strings.xml                    |   2 +-
 .../res/values-pl/strings.xml                 |   2 +-
 .../res/values/config.xml                     |   2 +
 .../res/values/strings.xml                    |   2 +-
 .../res/values-pl/strings.xml                 |   2 +-
 .../res/values/config.xml                     |   2 +
 .../res/values/strings.xml                    |   2 +-
 proto/src/gnss.proto                          |   3 +
 proto/src/metrics_constants.proto             | 318 ++++++++++-
 proto/src/system_messages.proto               |   4 +
 proto/src/wifi.proto                          |  33 ++
 .../server/appwidget/AppWidgetService.java    |   5 -
 .../appwidget/AppWidgetServiceImpl.java       |  16 +-
 .../android/server/autofill/ui/SaveUi.java    |   9 +-
 .../com/android/server/BatteryService.java    |   2 +-
 .../android/server/ConnectivityService.java   |  17 +-
 .../com/android/server/PinnerService.java     | 538 ++++++++++++++----
 .../com/android/server/TelephonyRegistry.java |   6 +-
 .../server/am/ActivityManagerConstants.java   |  38 +-
 .../server/am/ActivityManagerService.java     |  66 ++-
 .../am/ActivityManagerShellCommand.java       |   1 +
 .../server/am/ActivityMetricsLogger.java      | 132 +++++
 .../com/android/server/am/ActivityRecord.java |   8 +-
 .../com/android/server/am/ActivityStack.java  |  10 +
 .../server/am/ActivityStackSupervisor.java    |  13 +-
 .../server/am/ActivityStartController.java    |  13 +-
 .../android/server/am/ActivityStarter.java    |  76 ++-
 .../java/com/android/server/am/AppErrors.java |   3 +-
 .../server/am/BatteryExternalStatsWorker.java |  25 +-
 .../server/am/ContentProviderRecord.java      |   3 +-
 .../server/am/PendingIntentRecord.java        |   8 +-
 .../com/android/server/am/ProcessList.java    |   5 +
 .../com/android/server/am/ProcessRecord.java  |  10 +
 .../com/android/server/am/UserController.java |  14 +-
 .../android/server/audio/AudioService.java    |  38 +-
 .../server/connectivity/Tethering.java        |  22 +-
 .../tethering/TetheringConfiguration.java     |  14 +
 .../tethering/TetheringDependencies.java      |   5 +
 .../tethering/UpstreamNetworkMonitor.java     | 161 +++---
 .../com/android/server/display/ColorFade.java |   3 +-
 .../server/display/DisplayDeviceInfo.java     |   9 +
 .../server/display/DisplayManagerService.java |  45 +-
 .../server/display/LocalDisplayAdapter.java   |  10 +-
 .../server/display/LogicalDisplay.java        |  61 +-
 .../server/location/GnssLocationProvider.java |   2 +-
 .../locksettings/LockSettingsService.java     |  16 +-
 .../server/net/NetworkStatsService.java       |   8 +-
 .../notification/ConditionProviders.java      |   1 +
 .../server/notification/ManagedServices.java  |  10 +-
 .../NotificationManagerService.java           | 109 +++-
 .../notification/NotificationRecord.java      |  28 +-
 .../android/server/notification/ZenLog.java   |   3 +-
 .../notification/ZenModeConditions.java       |  29 +-
 .../server/notification/ZenModeHelper.java    |  54 +-
 .../server/om/OverlayManagerService.java      |  23 +-
 .../server/pm/BackgroundDexOptService.java    |   2 +-
 .../server/pm/PackageDexOptimizer.java        |  10 +-
 .../server/pm/PackageManagerService.java      |  97 +++-
 .../java/com/android/server/pm/Settings.java  |   3 +-
 .../server/pm/dex/ArtManagerService.java      |   9 +
 .../android/server/policy/BarController.java  |   2 +-
 .../server/policy/PhoneWindowManager.java     |  25 +-
 .../server/policy/WindowManagerPolicy.java    |   2 +
 .../server/slice/PinnedSliceState.java        |   4 +-
 .../server/trust/TrustManagerService.java     |  16 +-
 .../com/android/server/wm/AppWindowToken.java |  20 +-
 .../server/wm/BoundsAnimationController.java  |   9 +
 .../com/android/server/wm/DisplayContent.java |  53 +-
 .../server/wm/ForcedSeamlessRotator.java      | 110 ++++
 .../com/android/server/wm/InputMonitor.java   |   5 +
 .../server/wm/ScreenRotationAnimation.java    |   7 +
 .../server/wm/SurfaceAnimationRunner.java     |  13 +-
 .../android/server/wm/WindowContainer.java    |  14 +
 .../server/wm/WindowManagerService.java       |  21 +-
 .../com/android/server/wm/WindowState.java    |  73 ++-
 .../server/wm/WindowStateAnimator.java        |  55 +-
 .../com/android/server/wm/WindowToken.java    |   6 -
 .../server/wm/utils/CoordinateTransforms.java |  93 +++
 .../android/server/wm/utils/InsetUtils.java   |  27 +
 .../DevicePolicyManagerService.java           |  10 +-
 .../java/com/android/server/SystemServer.java |  16 +-
 .../android/net/netlink/NetlinkSocket.java    |   7 +-
 .../server/am/ActivityStarterTests.java       |  52 ++
 .../policy/PhoneWindowManagerTestBase.java    |  10 +-
 .../server/wm/SurfaceAnimationRunnerTest.java |  28 +-
 .../android/server/wm/WindowStateTests.java   |  32 ++
 .../wm/utils/CoordinateTransformsTest.java    | 133 ++++-
 .../server/wm/utils/InsetUtilsTest.java       |  29 +
 .../notification/BuzzBeepBlinkTest.java       | 175 +++++-
 .../NotificationManagerServiceTest.java       |  14 +
 .../notification/ZenModeHelperTest.java       |  35 +-
 .../server/slice/PinnedSliceStateTest.java    |   9 +-
 telecomm/java/android/telecom/Connection.java |  10 +-
 .../java/android/telecom/PhoneAccount.java    |  55 ++
 .../telephony/CarrierConfigManager.java       |  69 ++-
 .../android/telephony/TelephonyManager.java   |  47 +-
 .../internal/telephony/CarrierAppUtils.java   |  57 +-
 .../internal/telephony/ITelephony.aidl        |   6 -
 .../server/connectivity/TetheringTest.java    |  35 +-
 .../tethering/UpstreamNetworkMonitorTest.java | 147 ++++-
 .../testing/TestableContentResolver.java      |  30 +-
 .../testing/TestableContentResolverTest.java  |  61 ++
 tools/fonts/fontchain_linter.py               |   7 +-
 wifi/java/android/net/wifi/IWifiManager.aidl  |   2 +
 .../net/wifi/WifiEnterpriseConfig.java        |  11 +-
 wifi/java/android/net/wifi/WifiManager.java   |  15 +
 572 files changed, 8491 insertions(+), 5663 deletions(-)
 create mode 100644 core/res/res/values-mcc214/config.xml
 create mode 100644 core/res/res/values-mcc234-mnc15/config.xml
 create mode 100644 core/res/res/values-mcc234-mnc91/config.xml
 create mode 100644 core/res/res/values-mcc262-mnc02/config.xml
 create mode 100644 packages/EasterEgg/Android.bp
 delete mode 100644 packages/EasterEgg/Android.mk
 rename packages/EasterEgg/res/{drawable/leg1.xml => color-night/toolbar_icon_color.xml} (54%)
 rename packages/EasterEgg/res/{values/dimens.xml => color/toolbar_icon_color.xml} (71%)
 delete mode 100644 packages/EasterEgg/res/drawable/back.xml
 delete mode 100644 packages/EasterEgg/res/drawable/belly.xml
 delete mode 100644 packages/EasterEgg/res/drawable/cap.xml
 delete mode 100644 packages/EasterEgg/res/drawable/collar.xml
 delete mode 100644 packages/EasterEgg/res/drawable/face_spot.xml
 delete mode 100644 packages/EasterEgg/res/drawable/food_bits.xml
 delete mode 100644 packages/EasterEgg/res/drawable/food_chicken.xml
 delete mode 100644 packages/EasterEgg/res/drawable/food_cookie.xml
 delete mode 100644 packages/EasterEgg/res/drawable/food_dish.xml
 delete mode 100644 packages/EasterEgg/res/drawable/food_donut.xml
 delete mode 100644 packages/EasterEgg/res/drawable/food_sysuituna.xml
 delete mode 100644 packages/EasterEgg/res/drawable/foot1.xml
 delete mode 100644 packages/EasterEgg/res/drawable/foot2.xml
 delete mode 100644 packages/EasterEgg/res/drawable/foot3.xml
 delete mode 100644 packages/EasterEgg/res/drawable/foot4.xml
 delete mode 100644 packages/EasterEgg/res/drawable/head.xml
 rename packages/EasterEgg/res/drawable/{bowtie.xml => ic_clear.xml} (58%)
 create mode 100644 packages/EasterEgg/res/drawable/ic_dropper.xml
 create mode 100644 packages/EasterEgg/res/drawable/ic_hourglass.xml
 delete mode 100644 packages/EasterEgg/res/drawable/ic_share.xml
 rename packages/EasterEgg/res/{xml/filepaths.xml => drawable/icon_bg.xml} (71%)
 delete mode 100644 packages/EasterEgg/res/drawable/left_ear.xml
 delete mode 100644 packages/EasterEgg/res/drawable/left_ear_inside.xml
 delete mode 100644 packages/EasterEgg/res/drawable/left_eye.xml
 delete mode 100644 packages/EasterEgg/res/drawable/leg2.xml
 delete mode 100644 packages/EasterEgg/res/drawable/leg2_shadow.xml
 delete mode 100644 packages/EasterEgg/res/drawable/leg3.xml
 delete mode 100644 packages/EasterEgg/res/drawable/leg4.xml
 delete mode 100644 packages/EasterEgg/res/drawable/mouth.xml
 delete mode 100644 packages/EasterEgg/res/drawable/nose.xml
 delete mode 100644 packages/EasterEgg/res/drawable/octo_bg.xml
 create mode 100644 packages/EasterEgg/res/drawable/p.xml
 delete mode 100644 packages/EasterEgg/res/drawable/right_ear.xml
 delete mode 100644 packages/EasterEgg/res/drawable/right_eye.xml
 delete mode 100644 packages/EasterEgg/res/drawable/stat_icon.xml
 delete mode 100644 packages/EasterEgg/res/drawable/tail.xml
 delete mode 100644 packages/EasterEgg/res/drawable/tail_cap.xml
 delete mode 100644 packages/EasterEgg/res/drawable/tail_shadow.xml
 create mode 100644 packages/EasterEgg/res/drawable/toolbar_bg.xml
 rename packages/EasterEgg/res/drawable/{ic_close.xml => toolbar_button_bg.xml} (54%)
 create mode 100644 packages/EasterEgg/res/layout/activity_paint.xml
 rename packages/EasterEgg/res/{drawable/body.xml => layout/brushes.xml} (51%)
 delete mode 100644 packages/EasterEgg/res/layout/cat_view.xml
 rename packages/EasterEgg/res/{drawable/right_ear_inside.xml => layout/colors.xml} (51%)
 delete mode 100644 packages/EasterEgg/res/layout/edit_text.xml
 delete mode 100644 packages/EasterEgg/res/layout/food_layout.xml
 delete mode 100644 packages/EasterEgg/res/layout/neko_activity.xml
 create mode 100644 packages/EasterEgg/res/layout/toolbar.xml
 create mode 100644 packages/EasterEgg/res/values-night/colors.xml
 create mode 100644 packages/EasterEgg/res/values-night/styles.xml
 create mode 100644 packages/EasterEgg/res/values/attrs_toolbar_view.xml
 create mode 100644 packages/EasterEgg/res/values/colors.xml
 create mode 100644 packages/EasterEgg/res/values/styles.xml
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/Cat.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/Food.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/NekoActivationActivity.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/NekoDialog.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/NekoLand.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/NekoLockedActivity.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/NekoService.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/NekoTile.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/neko/PrefState.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/octo/Ocquarium.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/octo/OctopusDrawable.java
 delete mode 100644 packages/EasterEgg/src/com/android/egg/octo/TaperedPathStroke.java
 create mode 100644 packages/EasterEgg/src/com/android/egg/paint/BrushPropertyDrawable.kt
 create mode 100644 packages/EasterEgg/src/com/android/egg/paint/CutoutAvoidingToolbar.kt
 create mode 100644 packages/EasterEgg/src/com/android/egg/paint/PaintActivity.java
 create mode 100644 packages/EasterEgg/src/com/android/egg/paint/Painting.kt
 create mode 100644 packages/EasterEgg/src/com/android/egg/paint/Palette.kt
 create mode 100644 packages/EasterEgg/src/com/android/egg/paint/SpotFilter.kt
 create mode 100644 packages/EasterEgg/src/com/android/egg/paint/ToolbarView.kt
 delete mode 100644 packages/SystemUI/res/drawable-hdpi/qs_scrubber_track.9.png
 delete mode 100644 packages/SystemUI/res/drawable-mdpi/qs_scrubber_track.9.png
 delete mode 100644 packages/SystemUI/res/drawable-xhdpi/qs_scrubber_track.9.png
 delete mode 100644 packages/SystemUI/res/drawable-xxhdpi/qs_scrubber_track.9.png
 delete mode 100644 packages/SystemUI/res/drawable-xxxhdpi/qs_scrubber_track.9.png
 create mode 100644 services/core/java/com/android/server/wm/ForcedSeamlessRotator.java
 create mode 100644 tests/testables/tests/src/android/testing/TestableContentResolverTest.java

diff --git a/Android.mk b/Android.mk
index 25d8fc61c2a..bdad6c3d148 100644
--- a/Android.mk
+++ b/Android.mk
@@ -264,7 +264,8 @@ framework_metalava_docs_LOCAL_DROIDDOC_OPTIONS := \
     --hide RequiresPermission \
     --hide MissingPermission --hide BroadcastBehavior \
     --hide HiddenSuperclass --hide DeprecationMismatch --hide UnavailableSymbol \
-    --hide SdkConstant --hide HiddenTypeParameter --hide Todo --hide Typo
+    --hide SdkConstant --hide HiddenTypeParameter --hide Todo --hide Typo \
+    --include-annotation-classes tools/metalava/stub-annotations \
 
 # ====  Public API diff ===========================
 include $(CLEAR_VARS)
diff --git a/cmds/bootanimation/BootAnimation.cpp b/cmds/bootanimation/BootAnimation.cpp
index 8ffe5bf5931..ed6c25dc49c 100644
--- a/cmds/bootanimation/BootAnimation.cpp
+++ b/cmds/bootanimation/BootAnimation.cpp
@@ -302,6 +302,7 @@ status_t BootAnimation::readyToRun() {
     mHeight = h;
     mFlingerSurfaceControl = control;
     mFlingerSurface = s;
+    mTargetInset = -1;
 
     // If the device has encryption turned on or is in process
     // of being encrypted we show the encrypted boot animation.
@@ -942,6 +943,7 @@ bool BootAnimation::playAnimation(const Animation& animation)
                 if (mClockEnabled && mTimeIsAccurate && validClock(part)) {
                     drawClock(animation.clockFont, part.clockPosX, part.clockPosY);
                 }
+                handleViewport(frameDuration);
 
                 eglSwapBuffers(mDisplay, mSurface);
 
@@ -966,7 +968,7 @@ bool BootAnimation::playAnimation(const Animation& animation)
             usleep(part.pause * ns2us(frameDuration));
 
             // For infinite parts, we've now played them at least once, so perhaps exit
-            if(exitPending() && !part.count)
+            if(exitPending() && !part.count && mCurrentInset >= mTargetInset)
                 break;
         }
 
@@ -986,6 +988,51 @@ bool BootAnimation::playAnimation(const Animation& animation)
     return true;
 }
 
+void BootAnimation::handleViewport(nsecs_t timestep) {
+    if (mShuttingDown || !mFlingerSurfaceControl || mTargetInset == 0) {
+        return;
+    }
+    if (mTargetInset < 0) {
+        // Poll the amount for the top display inset. This will return -1 until persistent properties
+        // have been loaded.
+        mTargetInset = android::base::GetIntProperty("persist.sys.displayinset.top",
+                -1 /* default */, -1 /* min */, mHeight / 2 /* max */);
+    }
+    if (mTargetInset <= 0) {
+        return;
+    }
+
+    if (mCurrentInset < mTargetInset) {
+        // After the device boots, the inset will effectively be cropped away. We animate this here.
+        float fraction = static_cast<float>(mCurrentInset) / mTargetInset;
+        int interpolatedInset = (cosf((fraction + 1) * M_PI) / 2.0f + 0.5f) * mTargetInset;
+
+        SurfaceComposerClient::Transaction()
+                .setCrop(mFlingerSurfaceControl, Rect(0, interpolatedInset, mWidth, mHeight))
+                .apply();
+    } else {
+        // At the end of the animation, we switch to the viewport that DisplayManager will apply
+        // later. This changes the coordinate system, and means we must move the surface up by
+        // the inset amount.
+        sp<IBinder> dtoken(SurfaceComposerClient::getBuiltInDisplay(
+                ISurfaceComposer::eDisplayIdMain));
+
+        Rect layerStackRect(0, 0, mWidth, mHeight - mTargetInset);
+        Rect displayRect(0, mTargetInset, mWidth, mHeight);
+
+        SurfaceComposerClient::Transaction t;
+        t.setPosition(mFlingerSurfaceControl, 0, -mTargetInset)
+                .setCrop(mFlingerSurfaceControl, Rect(0, mTargetInset, mWidth, mHeight));
+        t.setDisplayProjection(dtoken, 0 /* orientation */, layerStackRect, displayRect);
+        t.apply();
+
+        mTargetInset = mCurrentInset = 0;
+    }
+
+    int delta = timestep * mTargetInset / ms2ns(200);
+    mCurrentInset += delta;
+}
+
 void BootAnimation::releaseAnimation(Animation* animation) const
 {
     for (Vector<Animation::Part>::iterator it = animation->parts.begin(),
diff --git a/cmds/bootanimation/BootAnimation.h b/cmds/bootanimation/BootAnimation.h
index 56e131523bc..b4699d88468 100644
--- a/cmds/bootanimation/BootAnimation.h
+++ b/cmds/bootanimation/BootAnimation.h
@@ -157,11 +157,15 @@ private:
 
     void checkExit();
 
+    void handleViewport(nsecs_t timestep);
+
     sp<SurfaceComposerClient>       mSession;
     AssetManager mAssets;
     Texture     mAndroid[2];
     int         mWidth;
     int         mHeight;
+    int         mCurrentInset;
+    int         mTargetInset;
     bool        mUseNpotTextures = false;
     EGLDisplay  mDisplay;
     EGLDisplay  mContext;
diff --git a/core/java/android/accessibilityservice/AccessibilityServiceInfo.java b/core/java/android/accessibilityservice/AccessibilityServiceInfo.java
index ed684d7a590..ecf6f129f91 100644
--- a/core/java/android/accessibilityservice/AccessibilityServiceInfo.java
+++ b/core/java/android/accessibilityservice/AccessibilityServiceInfo.java
@@ -29,7 +29,6 @@ import android.content.res.Resources;
 import android.content.res.TypedArray;
 import android.content.res.XmlResourceParser;
 import android.hardware.fingerprint.FingerprintManager;
-import android.os.Build;
 import android.os.Parcel;
 import android.os.Parcelable;
 import android.util.AttributeSet;
@@ -189,12 +188,10 @@ public class AccessibilityServiceInfo implements Parcelable {
      * content and also the accessibility service will receive accessibility events from
      * them.
      * <p>
-     * <strong>Note:</strong> For accessibility services targeting API version
-     * {@link Build.VERSION_CODES#JELLY_BEAN} or higher this flag has to be explicitly
-     * set for the system to regard views that are not important for accessibility. For
-     * accessibility services targeting API version lower than
-     * {@link Build.VERSION_CODES#JELLY_BEAN} this flag is ignored and all views are
-     * regarded for accessibility purposes.
+     * <strong>Note:</strong> For accessibility services targeting Android 4.1 (API level 16) or
+     * higher, this flag has to be explicitly set for the system to regard views that are not
+     * important for accessibility. For accessibility services targeting Android 4.0.4 (API level
+     * 15) or lower, this flag is ignored and all views are regarded for accessibility purposes.
      * </p>
      * <p>
      * Usually views not important for accessibility are layout managers that do not
@@ -219,19 +216,19 @@ public class AccessibilityServiceInfo implements Parcelable {
      * flag does not guarantee that the device will not be in touch exploration
      * mode since there may be another enabled service that requested it.
      * <p>
-     * For accessibility services targeting API version higher than
-     * {@link Build.VERSION_CODES#JELLY_BEAN_MR1} that want to set
-     * this flag have to declare this capability in their meta-data by setting
-     * the attribute {@link android.R.attr#canRequestTouchExplorationMode
-     * canRequestTouchExplorationMode} to true, otherwise this flag will
+     * For accessibility services targeting Android 4.3 (API level 18) or higher
+     * that want to set this flag have to declare this capability in their
+     * meta-data by setting the attribute
+     * {@link android.R.attr#canRequestTouchExplorationMode
+     * canRequestTouchExplorationMode} to true. Otherwise, this flag will
      * be ignored. For how to declare the meta-data of a service refer to
      * {@value AccessibilityService#SERVICE_META_DATA}.
      * </p>
      * <p>
-     * Services targeting API version equal to or lower than
-     * {@link Build.VERSION_CODES#JELLY_BEAN_MR1} will work normally, i.e.
-     * the first time they are run, if this flag is specified, a dialog is
-     * shown to the user to confirm enabling explore by touch.
+     * Services targeting Android 4.2.2 (API level 17) or lower will work
+     * normally. In other words, the first time they are run, if this flag is
+     * specified, a dialog is shown to the user to confirm enabling explore by
+     * touch.
      * </p>
      * @see android.R.styleable#AccessibilityService_canRequestTouchExplorationMode
      */
@@ -387,10 +384,10 @@ public class AccessibilityServiceInfo implements Parcelable {
     public int feedbackType;
 
     /**
-     * The timeout after the most recent event of a given type before an
+     * The timeout, in milliseconds, after the most recent event of a given type before an
      * {@link AccessibilityService} is notified.
      * <p>
-     *   <strong>Can be dynamically set at runtime.</strong>.
+     *   <strong>Can be dynamically set at runtime.</strong>
      * </p>
      * <p>
      * <strong>Note:</strong> The event notification timeout is useful to avoid propagating
diff --git a/core/java/android/animation/IntEvaluator.java b/core/java/android/animation/IntEvaluator.java
index 34fb0dc57bd..1de2ae7326e 100644
--- a/core/java/android/animation/IntEvaluator.java
+++ b/core/java/android/animation/IntEvaluator.java
@@ -24,7 +24,7 @@ public class IntEvaluator implements TypeEvaluator<Integer> {
     /**
      * This function returns the result of linearly interpolating the start and end values, with
      * <code>fraction</code> representing the proportion between the start and end values. The
-     * calculation is a simple parametric calculation: <code>result = x0 + t * (v1 - v0)</code>,
+     * calculation is a simple parametric calculation: <code>result = x0 + t * (x1 - x0)</code>,
      * where <code>x0</code> is <code>startValue</code>, <code>x1</code> is <code>endValue</code>,
      * and <code>t</code> is <code>fraction</code>.
      *
@@ -39,4 +39,4 @@ public class IntEvaluator implements TypeEvaluator<Integer> {
         int startInt = startValue;
         return (int)(startInt + fraction * (endValue - startInt));
     }
-}
\ No newline at end of file
+}
diff --git a/core/java/android/app/Activity.java b/core/java/android/app/Activity.java
index a6d2be0842a..68e8a52a9c2 100644
--- a/core/java/android/app/Activity.java
+++ b/core/java/android/app/Activity.java
@@ -6338,6 +6338,10 @@ public class Activity extends ContextThemeWrapper
     }
 
     void dumpInner(String prefix, FileDescriptor fd, PrintWriter writer, String[] args) {
+        if (args != null && args.length > 0 && args[0].equals("--autofill")) {
+            dumpAutofillManager(prefix, writer);
+            return;
+        }
         writer.print(prefix); writer.print("Local Activity ");
                 writer.print(Integer.toHexString(System.identityHashCode(this)));
                 writer.println(" State:");
@@ -6365,16 +6369,20 @@ public class Activity extends ContextThemeWrapper
 
         mHandler.getLooper().dump(new PrintWriterPrinter(writer), prefix);
 
+        dumpAutofillManager(prefix, writer);
+
+        ResourcesManager.getInstance().dump(prefix, writer);
+    }
+
+    void dumpAutofillManager(String prefix, PrintWriter writer) {
         final AutofillManager afm = getAutofillManager();
         if (afm != null) {
+            afm.dump(prefix, writer);
             writer.print(prefix); writer.print("Autofill Compat Mode: ");
             writer.println(isAutofillCompatibilityEnabled());
-            afm.dump(prefix, writer);
         } else {
             writer.print(prefix); writer.println("No AutofillManager");
         }
-
-        ResourcesManager.getInstance().dump(prefix, writer);
     }
 
     /**
diff --git a/core/java/android/app/ActivityManagerInternal.java b/core/java/android/app/ActivityManagerInternal.java
index 1d5f49a879d..14cae95508e 100644
--- a/core/java/android/app/ActivityManagerInternal.java
+++ b/core/java/android/app/ActivityManagerInternal.java
@@ -21,6 +21,7 @@ import android.annotation.Nullable;
 import android.content.ComponentName;
 import android.content.IIntentSender;
 import android.content.Intent;
+import android.content.pm.ApplicationInfo;
 import android.content.res.Configuration;
 import android.os.Bundle;
 import android.os.IBinder;
@@ -407,4 +408,14 @@ public abstract class ActivityManagerInternal {
      * has {@code permission}.
      */
     public abstract void enforceCallerIsRecentsOrHasPermission(String permission, String func);
+
+    /**
+     * @return The intent used to launch the home activity.
+     */
+    public abstract Intent getHomeIntent();
+
+    /**
+     * WindowManager notifies AM when display size of the default display changes.
+     */
+    public abstract void notifyDefaultDisplaySizeChanged();
 }
diff --git a/core/java/android/app/ActivityThread.java b/core/java/android/app/ActivityThread.java
index 87b334992d2..ab0b88c22d2 100644
--- a/core/java/android/app/ActivityThread.java
+++ b/core/java/android/app/ActivityThread.java
@@ -146,6 +146,7 @@ import com.android.internal.os.RuntimeInit;
 import com.android.internal.os.SomeArgs;
 import com.android.internal.util.ArrayUtils;
 import com.android.internal.util.FastPrintWriter;
+import com.android.internal.util.Preconditions;
 import com.android.internal.util.function.pooled.PooledLambda;
 import com.android.org.conscrypt.OpenSSLSocketImpl;
 import com.android.org.conscrypt.TrustedCertificateStore;
@@ -5144,6 +5145,16 @@ public final class ActivityThread extends ClientTransactionHandler {
         }
     }
 
+    /**
+     * Updates the application info.
+     *
+     * This only works in the system process. Must be called on the main thread.
+     */
+    public void handleSystemApplicationInfoChanged(@NonNull ApplicationInfo ai) {
+        Preconditions.checkState(mSystemThread, "Must only be called in the system process");
+        handleApplicationInfoChanged(ai);
+    }
+
     void handleApplicationInfoChanged(@NonNull final ApplicationInfo ai) {
         // Updates triggered by package installation go through a package update
         // receiver. Here we try to capture ApplicationInfo changes that are
diff --git a/core/java/android/app/Notification.java b/core/java/android/app/Notification.java
index 1ea93a41911..c22a43ec4af 100644
--- a/core/java/android/app/Notification.java
+++ b/core/java/android/app/Notification.java
@@ -2767,7 +2767,6 @@ public class Notification implements Parcelable
      */
     private void fixDuplicateExtras() {
         if (extras != null) {
-            fixDuplicateExtra(mSmallIcon, EXTRA_SMALL_ICON);
             fixDuplicateExtra(mLargeIcon, EXTRA_LARGE_ICON);
         }
     }
diff --git a/core/java/android/app/ResourcesManager.java b/core/java/android/app/ResourcesManager.java
index 30256b42e6a..8d0ad33a143 100644
--- a/core/java/android/app/ResourcesManager.java
+++ b/core/java/android/app/ResourcesManager.java
@@ -121,10 +121,13 @@ public class ResourcesManager {
         }
     }
 
+    private static final boolean ENABLE_APK_ASSETS_CACHE = false;
+
     /**
      * The ApkAssets we are caching and intend to hold strong references to.
      */
-    private final LruCache<ApkKey, ApkAssets> mLoadedApkAssets = new LruCache<>(3);
+    private final LruCache<ApkKey, ApkAssets> mLoadedApkAssets =
+            (ENABLE_APK_ASSETS_CACHE) ? new LruCache<>(3) : null;
 
     /**
      * The ApkAssets that are being referenced in the wild that we can reuse, even if they aren't
@@ -310,9 +313,12 @@ public class ResourcesManager {
     private @NonNull ApkAssets loadApkAssets(String path, boolean sharedLib, boolean overlay)
             throws IOException {
         final ApkKey newKey = new ApkKey(path, sharedLib, overlay);
-        ApkAssets apkAssets = mLoadedApkAssets.get(newKey);
-        if (apkAssets != null) {
-            return apkAssets;
+        ApkAssets apkAssets = null;
+        if (mLoadedApkAssets != null) {
+            apkAssets = mLoadedApkAssets.get(newKey);
+            if (apkAssets != null) {
+                return apkAssets;
+            }
         }
 
         // Optimistically check if this ApkAssets exists somewhere else.
@@ -320,7 +326,10 @@ public class ResourcesManager {
         if (apkAssetsRef != null) {
             apkAssets = apkAssetsRef.get();
             if (apkAssets != null) {
-                mLoadedApkAssets.put(newKey, apkAssets);
+                if (mLoadedApkAssets != null) {
+                    mLoadedApkAssets.put(newKey, apkAssets);
+                }
+
                 return apkAssets;
             } else {
                 // Clean up the reference.
@@ -335,7 +344,11 @@ public class ResourcesManager {
         } else {
             apkAssets = ApkAssets.loadFromPath(path, false /*system*/, sharedLib);
         }
-        mLoadedApkAssets.put(newKey, apkAssets);
+
+        if (mLoadedApkAssets != null) {
+            mLoadedApkAssets.put(newKey, apkAssets);
+        }
+
         mCachedApkAssets.put(newKey, new WeakReference<>(apkAssets));
         return apkAssets;
     }
@@ -434,18 +447,22 @@ public class ResourcesManager {
 
             pw.println("ResourcesManager:");
             pw.increaseIndent();
-            pw.print("cached apks: total=");
-            pw.print(mLoadedApkAssets.size());
-            pw.print(" created=");
-            pw.print(mLoadedApkAssets.createCount());
-            pw.print(" evicted=");
-            pw.print(mLoadedApkAssets.evictionCount());
-            pw.print(" hit=");
-            pw.print(mLoadedApkAssets.hitCount());
-            pw.print(" miss=");
-            pw.print(mLoadedApkAssets.missCount());
-            pw.print(" max=");
-            pw.print(mLoadedApkAssets.maxSize());
+            if (mLoadedApkAssets != null) {
+                pw.print("cached apks: total=");
+                pw.print(mLoadedApkAssets.size());
+                pw.print(" created=");
+                pw.print(mLoadedApkAssets.createCount());
+                pw.print(" evicted=");
+                pw.print(mLoadedApkAssets.evictionCount());
+                pw.print(" hit=");
+                pw.print(mLoadedApkAssets.hitCount());
+                pw.print(" miss=");
+                pw.print(mLoadedApkAssets.missCount());
+                pw.print(" max=");
+                pw.print(mLoadedApkAssets.maxSize());
+            } else {
+                pw.print("cached apks: 0 [cache disabled]");
+            }
             pw.println();
 
             pw.print("total apks: ");
diff --git a/core/java/android/app/assist/AssistStructure.java b/core/java/android/app/assist/AssistStructure.java
index d568662409d..dd61f286c88 100644
--- a/core/java/android/app/assist/AssistStructure.java
+++ b/core/java/android/app/assist/AssistStructure.java
@@ -41,18 +41,23 @@ import java.util.Arrays;
 import java.util.List;
 
 /**
- * Assist data automatically created by the platform's implementation of assist and autofill.
+ * <p>This API automatically creates assist data from the platform's
+ * implementation of assist and autofill.
  *
  * <p>The structure is used for assist purposes when created by
  * {@link android.app.Activity#onProvideAssistData}, {@link View#onProvideStructure(ViewStructure)},
  * or {@link View#onProvideVirtualStructure(ViewStructure)}.
  *
- * <p>The structure is used for autofill purposes when created by
+ * <p>The structure is also used for autofill purposes when created by
  * {@link View#onProvideAutofillStructure(ViewStructure, int)},
  * or {@link View#onProvideAutofillVirtualStructure(ViewStructure, int)}.
  *
- * <p>For performance reasons, some properties of the assist data might be available just for assist
- * or autofill purposes; in those case, the property availability will be document in its javadoc.
+ * <p>For performance reasons, some properties of the assist data might only be available for
+ * assist or autofill purposes. In those cases, a property's availability will be documented
+ * in its javadoc.
+ *
+ * <p>To learn about using Autofill in your app, read the
+ * <a href="/guide/topics/text/autofill">Autofill Framework</a> guides.
  */
 public class AssistStructure implements Parcelable {
     static final String TAG = "AssistStructure";
diff --git a/core/java/android/appwidget/AppWidgetManagerInternal.java b/core/java/android/appwidget/AppWidgetManagerInternal.java
index 7ab3d8bdd85..5694ca86045 100644
--- a/core/java/android/appwidget/AppWidgetManagerInternal.java
+++ b/core/java/android/appwidget/AppWidgetManagerInternal.java
@@ -16,12 +16,9 @@
 
 package android.appwidget;
 
-import android.annotation.NonNull;
 import android.annotation.Nullable;
 import android.util.ArraySet;
 
-import java.util.Set;
-
 /**
  * App widget manager local system service interface.
  *
@@ -36,4 +33,13 @@ public abstract class AppWidgetManagerInternal {
      * @return Whether the UID hosts widgets from the package.
      */
     public abstract @Nullable ArraySet<String> getHostedWidgetPackages(int uid);
+
+    /**
+     * Execute the widget-related work of unlocking a user.  This is intentionally
+     * invoked just <em>before</em> the boot-completed broadcast is issued, after
+     * the data-related work of unlock has completed.
+     *
+     * @param userId The user that is being unlocked.
+     */
+    public abstract void unlockUser(int userId);
 }
diff --git a/core/java/android/content/Context.java b/core/java/android/content/Context.java
index 90a94ee7608..b53202ef174 100644
--- a/core/java/android/content/Context.java
+++ b/core/java/android/content/Context.java
@@ -325,6 +325,15 @@ public abstract class Context {
      */
     public static final int BIND_ADJUST_WITH_ACTIVITY = 0x0080;
 
+    /**
+     * Flag for {@link #bindService}: If binding from something better than perceptible,
+     * still set the adjust below perceptible. This would be used for bound services that can
+     * afford to be evicted when under extreme memory pressure, but should be restarted as soon
+     * as possible.
+     * @hide
+     */
+    public static final int BIND_ADJUST_BELOW_PERCEPTIBLE = 0x0100;
+
     /**
      * @hide Flag for {@link #bindService}: allows binding to a service provided
      * by an instant app. Note that the caller may not have access to the instant
diff --git a/core/java/android/content/pm/ApplicationInfo.java b/core/java/android/content/pm/ApplicationInfo.java
index d65e051b70b..3120421622a 100644
--- a/core/java/android/content/pm/ApplicationInfo.java
+++ b/core/java/android/content/pm/ApplicationInfo.java
@@ -1120,6 +1120,9 @@ public class ApplicationInfo extends PackageItemInfo implements Parcelable {
     /** @hide */
     public String[] splitClassLoaderNames;
 
+    /** @hide */
+    public boolean hiddenUntilInstalled;
+
     /**
      * Represents the default policy. The actual policy used will depend on other properties of
      * the application, e.g. the target SDK version.
@@ -1460,6 +1463,7 @@ public class ApplicationInfo extends PackageItemInfo implements Parcelable {
         compileSdkVersion = orig.compileSdkVersion;
         compileSdkVersionCodename = orig.compileSdkVersionCodename;
         mHiddenApiPolicy = orig.mHiddenApiPolicy;
+        hiddenUntilInstalled = orig.hiddenUntilInstalled;
     }
 
     public String toString() {
@@ -1534,6 +1538,7 @@ public class ApplicationInfo extends PackageItemInfo implements Parcelable {
         dest.writeString(compileSdkVersionCodename);
         dest.writeString(appComponentFactory);
         dest.writeInt(mHiddenApiPolicy);
+        dest.writeInt(hiddenUntilInstalled ? 1 : 0);
     }
 
     public static final Parcelable.Creator<ApplicationInfo> CREATOR
@@ -1605,6 +1610,7 @@ public class ApplicationInfo extends PackageItemInfo implements Parcelable {
         compileSdkVersionCodename = source.readString();
         appComponentFactory = source.readString();
         mHiddenApiPolicy = source.readInt();
+        hiddenUntilInstalled = source.readInt() != 0;
     }
 
     /**
diff --git a/core/java/android/content/pm/IPackageManager.aidl b/core/java/android/content/pm/IPackageManager.aidl
index c988fa907f8..bc5b32c69b5 100644
--- a/core/java/android/content/pm/IPackageManager.aidl
+++ b/core/java/android/content/pm/IPackageManager.aidl
@@ -598,6 +598,9 @@ interface IPackageManager {
     boolean setApplicationHiddenSettingAsUser(String packageName, boolean hidden, int userId);
     boolean getApplicationHiddenSettingAsUser(String packageName, int userId);
 
+    void setSystemAppHiddenUntilInstalled(String packageName, boolean hidden);
+    boolean setSystemAppInstallState(String packageName, boolean installed, int userId);
+
     IPackageInstaller getPackageInstaller();
 
     boolean setBlockUninstallForUser(String packageName, boolean blockUninstall, int userId);
diff --git a/core/java/android/content/pm/PackageManager.java b/core/java/android/content/pm/PackageManager.java
index 7253e775800..68d0da970b6 100644
--- a/core/java/android/content/pm/PackageManager.java
+++ b/core/java/android/content/pm/PackageManager.java
@@ -147,6 +147,7 @@ public abstract class PackageManager {
             GET_DISABLED_COMPONENTS,
             GET_DISABLED_UNTIL_USED_COMPONENTS,
             GET_UNINSTALLED_PACKAGES,
+            MATCH_HIDDEN_UNTIL_INSTALLED_COMPONENTS,
     })
     @Retention(RetentionPolicy.SOURCE)
     public @interface PackageInfoFlags {}
@@ -164,6 +165,7 @@ public abstract class PackageManager {
             MATCH_STATIC_SHARED_LIBRARIES,
             GET_DISABLED_UNTIL_USED_COMPONENTS,
             GET_UNINSTALLED_PACKAGES,
+            MATCH_HIDDEN_UNTIL_INSTALLED_COMPONENTS,
     })
     @Retention(RetentionPolicy.SOURCE)
     public @interface ApplicationInfoFlags {}
@@ -521,6 +523,12 @@ public abstract class PackageManager {
      */
     public static final int MATCH_DEBUG_TRIAGED_MISSING = 0x10000000;
 
+    /**
+     * Internal flag used to indicate that a package is a hidden system app.
+     * @hide
+     */
+    public static final int MATCH_HIDDEN_UNTIL_INSTALLED_COMPONENTS =  0x20000000;
+
     /**
      * Flag for {@link #addCrossProfileIntentFilter}: if this flag is set: when
      * resolving an intent that matches the {@code CrossProfileIntentFilter},
@@ -4841,7 +4849,8 @@ public abstract class PackageManager {
      * on the system for other users, also install it for the specified user.
      * @hide
      */
-     @RequiresPermission(anyOf = {
+    @RequiresPermission(anyOf = {
+            Manifest.permission.INSTALL_EXISTING_PACKAGES,
             Manifest.permission.INSTALL_PACKAGES,
             Manifest.permission.INTERACT_ACROSS_USERS_FULL})
     public abstract int installExistingPackageAsUser(String packageName, @UserIdInt int userId)
diff --git a/core/java/android/content/pm/PackageParser.java b/core/java/android/content/pm/PackageParser.java
index 2da2cb4c928..edca4e625e9 100644
--- a/core/java/android/content/pm/PackageParser.java
+++ b/core/java/android/content/pm/PackageParser.java
@@ -639,11 +639,19 @@ public class PackageParser {
      */
     private static boolean checkUseInstalledOrHidden(int flags, PackageUserState state,
             ApplicationInfo appInfo) {
+        // Returns false if the package is hidden system app until installed.
+        if ((flags & PackageManager.MATCH_HIDDEN_UNTIL_INSTALLED_COMPONENTS) == 0
+                && !state.installed
+                && appInfo != null && appInfo.hiddenUntilInstalled) {
+            return false;
+        }
+
         // If available for the target user, or trying to match uninstalled packages and it's
         // a system app.
         return state.isAvailable(flags)
                 || (appInfo != null && appInfo.isSystemApp()
-                        && (flags & PackageManager.MATCH_KNOWN_PACKAGES) != 0);
+                        && ((flags & PackageManager.MATCH_KNOWN_PACKAGES) != 0
+                        || (flags & PackageManager.MATCH_HIDDEN_UNTIL_INSTALLED_COMPONENTS) != 0));
     }
 
     public static boolean isAvailable(PackageUserState state) {
diff --git a/core/java/android/content/pm/ShortcutManager.java b/core/java/android/content/pm/ShortcutManager.java
index 25e0ccd8d55..36849e63eeb 100644
--- a/core/java/android/content/pm/ShortcutManager.java
+++ b/core/java/android/content/pm/ShortcutManager.java
@@ -20,7 +20,6 @@ import android.annotation.Nullable;
 import android.annotation.SystemService;
 import android.annotation.TestApi;
 import android.annotation.UserIdInt;
-import android.app.Activity;
 import android.app.usage.UsageStatsManager;
 import android.content.Context;
 import android.content.Intent;
@@ -29,256 +28,23 @@ import android.graphics.drawable.AdaptiveIconDrawable;
 import android.os.Build.VERSION_CODES;
 import android.os.RemoteException;
 import android.os.ServiceManager;
-import android.os.UserHandle;
 
 import com.android.internal.annotations.VisibleForTesting;
 
 import java.util.List;
 
 /**
- * The ShortcutManager performs operations on an app's set of <em>shortcuts</em>. The
- * {@link ShortcutInfo} class contains information about each of the shortcuts themselves.
+ * <p><code>ShortcutManager</code> executes operations on an app's set of <i>shortcuts</i>, which
+ * represent specific tasks and actions that users can perform within your app. This page lists
+ * components of the <code>ShortcutManager</code> class that you can use to create and manage
+ * sets of shortcuts.
  *
- * <p>An app's shortcuts represent specific tasks and actions that users can perform within your
- * app. When a user selects a shortcut in the currently-active launcher, your app opens an activity
- * other than the app's starting activity, provided that the currently-active launcher supports app
- * shortcuts.</p>
+ * <p>To learn about methods that retrieve information about a single shortcut&mdash;including
+ * identifiers, type, and status&mdash;read the <code>
+ * <a href="/reference/android/content/pm/ShortcutInfo.html">ShortcutInfo</a></code> reference.
  *
- * <p>The types of shortcuts that you create for your app depend on the app's key use cases. For
- * example, an email app may publish the "compose new email" shortcut, which allows the app to
- * directly open the compose activity.</p>
- *
- * <p class="note"><b>Note:</b> Only main activities&mdash;activities that handle the
- * {@link Intent#ACTION_MAIN} action and the {@link Intent#CATEGORY_LAUNCHER} category&mdash;can
- * have shortcuts. If an app has multiple main activities, you need to define the set of shortcuts
- * for <em>each</em> activity.
- *
- * <p>This page discusses the implementation details of the <code>ShortcutManager</code> class. For
- * definitions of key terms and guidance on performing operations on shortcuts within your app, see
- * the <a href="/guide/topics/ui/shortcuts.html">App Shortcuts</a> feature guide.
- *
- * <h3>Shortcut characteristics</h3>
- *
- * This section describes in-depth details about each shortcut type's usage and availability.
- *
- * <p class="note"><b>Important security note:</b> All shortcut information is stored in
- * <a href="/training/articles/direct-boot.html">credential encrypted storage</a>, so your app
- * cannot access a user's shortcuts until after they've unlocked the device.
- *
- * <h4>Static and dynamic shortcuts</h4>
- *
- * <p>Static shortcuts and dynamic shortcuts are shown in a supported launcher when the user
- * performs a specific gesture. On currently-supported launchers, the gesture is a long-press on the
- * app's launcher icon, but the actual gesture may be different on other launcher apps.
- *
- * <p>The {@link LauncherApps} class provides APIs for launcher apps to access shortcuts.
- *
- * <h4>Pinned shortcuts</h4>
- *
- * <p>Because pinned shortcuts appear in the launcher itself, they're always visible. A pinned
- * shortcut is removed from the launcher only in the following situations:
- * <ul>
- *     <li>The user removes it.
- *     <li>The publisher app associated with the shortcut is uninstalled.
- *     <li>The user selects <b>Clear data</b> from the publisher app's <i>Storage</i> screen, within
- *     the system's <b>Settings</b> app.
- * </ul>
- *
- * <p>Because the system performs
- * <a href="/guide/topics/ui/shortcuts.html#backup-and-restore">backup and restore</a> on pinned
- * shortcuts automatically, these shortcuts' IDs should contain either stable, constant strings or
- * server-side identifiers, rather than identifiers generated locally that might not make sense on
- * other devices.
- *
- * <h3>Shortcut display order</h3>
- *
- * <p>When the launcher displays an app's shortcuts, they should appear in the following order:
- *
- * <ol>
- *   <li><b>Static shortcuts:</b> Shortcuts whose {@link ShortcutInfo#isDeclaredInManifest()} method
- *   returns {@code true}.</li>
- *   <li><b>Dynamic shortcuts:</b> Shortcuts whose {@link ShortcutInfo#isDynamic()} method returns
- *   {@code true}.</li>
- * </ol>
- *
- * <p>Within each shortcut type (static and dynamic), shortcuts are sorted in order of increasing
- * rank according to {@link ShortcutInfo#getRank()}.</p>
- *
- * <h4>Shortcut ranks</h4>
- *
- * <p>Shortcut ranks are non-negative, sequential integers that determine the order in which
- * shortcuts appear, assuming that the shortcuts are all in the same category. You can update ranks
- * of existing shortcuts when you call {@link #updateShortcuts(List)},
- * {@link #addDynamicShortcuts(List)}, or {@link #setDynamicShortcuts(List)}.
- *
- * <p class="note"><b>Note:</b> Ranks are auto-adjusted so that they're unique for each type of
- * shortcut (static or dynamic). For example, if there are 3 dynamic shortcuts with ranks 0, 1 and
- * 2, adding another dynamic shortcut with a rank of 1 represents a request to place this shortcut
- * at the second position. In response, the third and fourth shortcuts move closer to the bottom of
- * the shortcut list, with their ranks changing to 2 and 3, respectively.
- *
- * <h3>Options for static shortcuts</h3>
- *
- * The following list includes descriptions for the different attributes within a static shortcut.
- * You must provide a value for {@code android:shortcutId} and {@code android:shortcutShortLabel};
- * all other values are optional.
- *
- * <dl>
- *   <dt>{@code android:shortcutId}</dt>
- *   <dd><p>A string literal, which represents the shortcut when a {@code ShortcutManager} object
- *   performs operations on it.</p>
- *   <p class="note"><b>Note: </b>You cannot set this attribute's value to a resource string, such
- *   as <code>@string/foo</code>.</p>
- *   </dd>
- *
- *   <dt>{@code android:enabled}</dt>
- *   <dd><p>Whether the user can interact with the shortcut from a supported launcher.</p>
- *   <p>The default value is {@code true}. If you set it to {@code false}, you should also set
- *   {@code android:shortcutDisabledMessage} to a message that explains why you've disabled the
- *   shortcut. If you don't think you need to provide such a message, it's easiest to just remove
- *   the shortcut from the XML file entirely, rather than changing the values of the shortcut's
- *   {@code android:enabled} and {@code android:shortcutDisabledMessage} attributes.
- *   </dd>
- *
- *   <dt>{@code android:icon}</dt>
- *   <dd><p>The <a href="/topic/performance/graphics/index.html">bitmap</a> or
- *   <a href="/guide/practices/ui_guidelines/icon_design_adaptive.html">adaptive icon</a> that the
- *   launcher uses when displaying the shortcut to the user. This value can be either the path to an
- *   image or the resource file that contains the image. Use adaptive icons whenever possible to
- *   improve performance and consistency.</p>
- *   <p class="note"><b>Note: </b>Shortcut icons cannot include
- *   <a href="/training/material/drawables.html#DrawableTint">tints</a>.
- *   </dd>
- *
- *   <dt>{@code android:shortcutShortLabel}</dt>
- *   <dd><p>A concise phrase that describes the shortcut's purpose. For more information, see
- *   {@link ShortcutInfo.Builder#setShortLabel(CharSequence)}.</p>
- *   <p class="note"><b>Note: </b>This attribute's value must be a resource string, such as
- *   <code>@string/shortcut_short_label</code>.</p>
- *   </dd>
- *
- *   <dt>{@code android:shortcutLongLabel}</dt>
- *   <dd><p>An extended phrase that describes the shortcut's purpose. If there's enough space, the
- *   launcher displays this value instead of {@code android:shortcutShortLabel}. For more
- *   information, see {@link ShortcutInfo.Builder#setLongLabel(CharSequence)}.</p>
- *   <p class="note"><b>Note: </b>This attribute's value must be a resource string, such as
- *   <code>@string/shortcut_long_label</code>.</p>
- *   </dd>
- *
- *   <dt>{@code android:shortcutDisabledMessage}</dt>
- *   <dd><p>The message that appears in a supported launcher when the user attempts to launch a
- *   disabled shortcut. The message should explain to the user why the shortcut is now disabled.
- *   This attribute's value has no effect if {@code android:enabled} is {@code true}.</p>
- *   <p class="note"><b>Note: </b>This attribute's value must be a resource string, such as
- *   <code>@string/shortcut_disabled_message</code>.</p>
- *   </dd>
- * </dl>
- *
- * <h3>Inner elements that define static shortcuts</h3>
- *
- * <p>The XML file that lists an app's static shortcuts supports the following elements inside each
- * {@code <shortcut>} element. You must include an {@code intent} inner element for each
- * static shortcut that you define.</p>
- *
- * <dl>
- *   <dt>{@code intent}</dt>
- *   <dd><p>The action that the system launches when the user selects the shortcut. This intent must
- *   provide a value for the {@code android:action} attribute.</p>
- *   <p>You can provide multiple intents for a single shortcut. If you do so, the last defined
- *   activity is launched, and the other activities are placed in the
- *   <a href="/guide/components/tasks-and-back-stack.html">back stack</a>. See
- *   <a href="/guide/topics/ui/shortcuts.html#static">Using Static Shortcuts</a> and the
- *   {@link android.app.TaskStackBuilder} class reference for details.</p>
- *   <p class="note"><b>Note:</b> This {@code intent} element cannot include string resources.</p>
- *   <p>To learn more about how to configure intents, see
- *   <a href="{@docRoot}guide/topics/ui/settings.html#Intents">Using intents</a>.</p>
- *   </dd>
- *
- *   <dt>{@code categories}</dt>
- *   <dd><p>Provides a grouping for the types of actions that your app's shortcuts perform, such as
- *   creating new chat messages.</p>
- *   <p>For a list of supported shortcut categories, see the {@link ShortcutInfo} class reference
- *   for a list of supported shortcut categories.
- *   </dd>
- * </dl>
- *
- * <h3>Updating shortcuts</h3>
- *
- * <p>Each app's launcher icon can contain at most {@link #getMaxShortcutCountPerActivity()} number
- * of static and dynamic shortcuts combined. There is no limit to the number of pinned shortcuts
- * that an app can create, though.
- *
- * <p>When a dynamic shortcut is pinned, even when the publisher removes it as a dynamic shortcut,
- * the pinned shortcut is still visible and launchable.  This allows an app to have more than
- * {@link #getMaxShortcutCountPerActivity()} number of shortcuts.
- *
- * <p>As an example, suppose {@link #getMaxShortcutCountPerActivity()} is 5:
- * <ol>
- *     <li>A chat app publishes 5 dynamic shortcuts for the 5 most recent
- *     conversations (c1, c2, ..., c5).
- *
- *     <li>The user pins all 5 of the shortcuts.
- *
- *     <li>Later, the user has started 3 additional conversations (c6, c7, and c8), so the publisher
- *     app re-publishes its dynamic shortcuts. The new dynamic shortcut list is: c4, c5, ..., c8.
- *     <p>The publisher app has to remove c1, c2, and c3 because it can't have more than 5 dynamic
- *     shortcuts. However, c1, c2, and c3 are still pinned shortcuts that the user can access and
- *     launch.
- *     <p>At this point, the user can access a total of 8 shortcuts that link to activities in the
- *     publisher app, including the 3 pinned shortcuts, even though an app can have at most 5
- *     dynamic shortcuts.
- *
- *     <li>The app can use {@link #updateShortcuts(List)} to update <em>any</em> of the existing
- *     8 shortcuts, when, for example, the chat peers' icons have changed.
- *     <p>The {@link #addDynamicShortcuts(List)} and {@link #setDynamicShortcuts(List)} methods
- *     can also be used to update existing shortcuts with the same IDs, but they <b>cannot</b> be
- *     used for updating non-dynamic, pinned shortcuts because these 2 methods try to convert the
- *     given lists of shortcuts to dynamic shortcuts.
- * </ol>
- *
- * <h3>Shortcut intents</h3>
- *
- * <p>
- * Dynamic shortcuts can be published with any set of {@link Intent#addFlags Intent} flags.
- * Typically, {@link Intent#FLAG_ACTIVITY_CLEAR_TASK} is specified, possibly along with other
- * flags; otherwise, if the app is already running, the app is simply brought to
- * the foreground, and the target activity might not appear.
- *
- * <p>Static shortcuts <b>cannot</b> have custom intent flags.
- * The first intent of a static shortcut will always have {@link Intent#FLAG_ACTIVITY_NEW_TASK}
- * and {@link Intent#FLAG_ACTIVITY_CLEAR_TASK} set. This means, when the app is already running, all
- * the existing activities in your app are destroyed when a static shortcut is launched.
- * If this behavior is not desirable, you can use a <em>trampoline activity</em>, or an invisible
- * activity that starts another activity in {@link Activity#onCreate}, then calls
- * {@link Activity#finish()}:
- * <ol>
- *     <li>In the <code>AndroidManifest.xml</code> file, the trampoline activity should include the
- *     attribute assignment {@code android:taskAffinity=""}.
- *     <li>In the shortcuts resource file, the intent within the static shortcut should reference
- *     the trampoline activity.
- * </ol>
- *
- * <h3>Rate limiting</h3>
- *
- * <p>When <a href="/guide/topics/ui/shortcuts.html#rate-limit">rate limiting</a> is active,
- * {@link #isRateLimitingActive()} returns {@code true}.
- *
- * <p>Rate limiting is reset upon certain events, so even background apps can call these APIs until
- * the rate limit is reached again. These events include the following:
- * <ul>
- *   <li>An app comes to the foreground.
- *   <li>The system locale changes.
- *   <li>The user performs the <a href="/guide/topics/ui/notifiers/notifications.html#direct">inline
- *   reply</a> action on a notification.
- * </ul>
- *
- * <h3>Handling system locale changes</h3>
- *
- * <p>Apps should update dynamic and pinned shortcuts when they receive the
- * {@link Intent#ACTION_LOCALE_CHANGED} broadcast, indicating that the system locale has changed.
- * <p>When the system locale changes, <a href="/guide/topics/ui/shortcuts.html#rate-limit">rate
- * limiting</a> is reset, so even background apps can add and update dynamic shortcuts until the
- * rate limit is reached again.
+ * <p>For guidance about using shortcuts, see
+ * <a href="/guide/topics/ui/shortcuts/index.html">App shortcuts</a>.
  *
  * <h3>Retrieving class instances</h3>
  * <!-- Provides a heading for the content filled in by the @SystemService annotation below -->
@@ -458,8 +224,9 @@ public class ShortcutManager {
     }
 
     /**
-     * Disable pinned shortcuts.  For more details, see the Javadoc for the {@link ShortcutManager}
-     * class.
+     * Disable pinned shortcuts.  For more details, read
+     * <a href="/guide/topics/ui/shortcuts/managing-shortcuts.html#disable-shortcuts">
+     * Disable shortcuts</a>.
      *
      * @throws IllegalArgumentException If trying to disable immutable shortcuts.
      *
@@ -498,7 +265,9 @@ public class ShortcutManager {
     /**
      * Disable pinned shortcuts, showing the user a custom error message when they try to select
      * the disabled shortcuts.
-     * For more details, see the Javadoc for the {@link ShortcutManager} class.
+     * For more details, read
+     * <a href="/guide/topics/ui/shortcuts/managing-shortcuts.html#disable-shortcuts">
+     * Disable shortcuts</a>.
      *
      * @throws IllegalArgumentException If trying to disable immutable shortcuts.
      *
@@ -586,7 +355,8 @@ public class ShortcutManager {
     /**
      * Return {@code true} when rate-limiting is active for the caller app.
      *
-     * <p>See the class level javadoc for details.
+     * <p>For details, see <a href="/guide/topics/ui/shortcuts/managing-shortcuts#rate-limiting">
+     * Rate limiting</a>.
      *
      * @throws IllegalStateException when the user is locked.
      */
@@ -632,7 +402,9 @@ public class ShortcutManager {
      * Apps that publish shortcuts should call this method whenever the user
      * selects the shortcut containing the given ID or when the user completes
      * an action in the app that is equivalent to selecting the shortcut.
-     * For more details, see the Javadoc for the {@link ShortcutManager} class
+     * For more details, read about
+     * <a href="/guide/topics/ui/shortcuts/managing-shortcuts.html#track-usage">
+     * tracking shortcut usage</a>.
      *
      * <p>The information is accessible via {@link UsageStatsManager#queryEvents}
      * Typically, launcher apps use this information to build a prediction model
@@ -700,7 +472,9 @@ public class ShortcutManager {
      * @param resultIntent If not null, this intent will be sent when the shortcut is pinned.
      *    Use {@link android.app.PendingIntent#getIntentSender()} to create an {@link IntentSender}.
      *    To avoid background execution limits, use an unexported, manifest-declared receiver.
-     *    For more details, see the overview documentation for the {@link ShortcutManager} class.
+     *    For more details, see
+     *    <a href="/guide/topics/ui/shortcuts/creating-shortcuts.html#pinned">
+     *    Creating pinned shortcuts</a>.
      *
      * @return {@code TRUE} if the launcher supports this feature.  Note the API will return without
      *    waiting for the user to respond, so getting {@code TRUE} from this API does *not* mean
diff --git a/core/java/android/database/sqlite/SQLiteGlobal.java b/core/java/android/database/sqlite/SQLiteGlobal.java
index d6d9764c7c3..e6b6acf7b8e 100644
--- a/core/java/android/database/sqlite/SQLiteGlobal.java
+++ b/core/java/android/database/sqlite/SQLiteGlobal.java
@@ -39,11 +39,18 @@ import android.os.SystemProperties;
 public final class SQLiteGlobal {
     private static final String TAG = "SQLiteGlobal";
 
+    /** @hide */
+    public static final String SYNC_MODE_FULL = "FULL";
+
     private static final Object sLock = new Object();
+
     private static int sDefaultPageSize;
 
     private static native int nativeReleaseMemory();
 
+    /** @hide */
+    public static volatile String sDefaultSyncMode;
+
     private SQLiteGlobal() {
     }
 
@@ -103,6 +110,11 @@ public final class SQLiteGlobal {
      * Gets the default database synchronization mode when WAL is not in use.
      */
     public static String getDefaultSyncMode() {
+        // Use the FULL synchronous mode for system processes by default.
+        String defaultMode = sDefaultSyncMode;
+        if (defaultMode != null) {
+            return defaultMode;
+        }
         return SystemProperties.get("debug.sqlite.syncmode",
                 Resources.getSystem().getString(
                 com.android.internal.R.string.db_default_sync_mode));
@@ -112,6 +124,11 @@ public final class SQLiteGlobal {
      * Gets the database synchronization mode when in WAL mode.
      */
     public static String getWALSyncMode() {
+        // Use the FULL synchronous mode for system processes by default.
+        String defaultMode = sDefaultSyncMode;
+        if (defaultMode != null) {
+            return defaultMode;
+        }
         return SystemProperties.get("debug.sqlite.wal.syncmode",
                 Resources.getSystem().getString(
                 com.android.internal.R.string.db_wal_sync_mode));
diff --git a/core/java/android/hardware/camera2/CameraCharacteristics.java b/core/java/android/hardware/camera2/CameraCharacteristics.java
index 87c64cd1290..d027fd997b9 100644
--- a/core/java/android/hardware/camera2/CameraCharacteristics.java
+++ b/core/java/android/hardware/camera2/CameraCharacteristics.java
@@ -1249,7 +1249,9 @@ public final class CameraCharacteristics extends CameraMetadata<CameraCharacteri
      * <p>If this device is the largest or only camera device with a given facing, then this
      * position will be <code>(0, 0, 0)</code>; a camera device with a lens optical center located 3 cm
      * from the main sensor along the +X axis (to the right from the user's perspective) will
-     * report <code>(0.03, 0, 0)</code>.</p>
+     * report <code>(0.03, 0, 0)</code>.  Note that this means that, for many computer vision
+     * applications, the position needs to be negated to convert it to a translation from the
+     * camera to the origin.</p>
      * <p>To transform a pixel coordinates between two cameras facing the same direction, first
      * the source camera {@link CameraCharacteristics#LENS_DISTORTION android.lens.distortion} must be corrected for.  Then the source
      * camera {@link CameraCharacteristics#LENS_INTRINSIC_CALIBRATION android.lens.intrinsicCalibration} needs to be applied, followed by the
@@ -1261,7 +1263,8 @@ public final class CameraCharacteristics extends CameraMetadata<CameraCharacteri
      * <p>To compare this against a real image from the destination camera, the destination camera
      * image then needs to be corrected for radial distortion before comparison or sampling.</p>
      * <p>When {@link CameraCharacteristics#LENS_POSE_REFERENCE android.lens.poseReference} is GYROSCOPE, then this position is relative to
-     * the center of the primary gyroscope on the device.</p>
+     * the center of the primary gyroscope on the device. The axis definitions are the same as
+     * with PRIMARY_CAMERA.</p>
      * <p><b>Units</b>: Meters</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
@@ -1293,13 +1296,15 @@ public final class CameraCharacteristics extends CameraMetadata<CameraCharacteri
      * </code></pre>
      * <p>which can then be combined with the camera pose rotation
      * <code>R</code> and translation <code>t</code> ({@link CameraCharacteristics#LENS_POSE_ROTATION android.lens.poseRotation} and
-     * {@link CameraCharacteristics#LENS_POSE_TRANSLATION android.lens.poseTranslation}, respective) to calculate the
+     * {@link CameraCharacteristics#LENS_POSE_TRANSLATION android.lens.poseTranslation}, respectively) to calculate the
      * complete transform from world coordinates to pixel
      * coordinates:</p>
-     * <pre><code>P = [ K 0   * [ R t
-     *      0 1 ]     0 1 ]
+     * <pre><code>P = [ K 0   * [ R -Rt
+     *      0 1 ]      0 1 ]
      * </code></pre>
-     * <p>and with <code>p_w</code> being a point in the world coordinate system
+     * <p>(Note the negation of poseTranslation when mapping from camera
+     * to world coordinates, and multiplication by the rotation).</p>
+     * <p>With <code>p_w</code> being a point in the world coordinate system
      * and <code>p_s</code> being a point in the camera active pixel array
      * coordinate system, and with the mapping including the
      * homogeneous division by z:</p>
@@ -1321,6 +1326,13 @@ public final class CameraCharacteristics extends CameraMetadata<CameraCharacteri
      * activeArraySize rectangle), to determine the final pixel
      * coordinate of the world point for processed (non-RAW)
      * output buffers.</p>
+     * <p>For camera devices, the center of pixel <code>(x,y)</code> is located at
+     * coordinate <code>(x + 0.5, y + 0.5)</code>.  So on a device with a
+     * precorrection active array of size <code>(10,10)</code>, the valid pixel
+     * indices go from <code>(0,0)-(9,9)</code>, and an perfectly-built camera would
+     * have an optical center at the exact center of the pixel grid, at
+     * coordinates <code>(5.0, 5.0)</code>, which is the top-left corner of pixel
+     * <code>(5,5)</code>.</p>
      * <p><b>Units</b>:
      * Pixels in the
      * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}
@@ -2365,13 +2377,25 @@ public final class CameraCharacteristics extends CameraMetadata<CameraCharacteri
      * {@link CaptureRequest#SCALER_CROP_REGION android.scaler.cropRegion}, is defined relative to the active array rectangle given in
      * this field, with <code>(0, 0)</code> being the top-left of this rectangle.</p>
      * <p>The active array may be smaller than the full pixel array, since the full array may
-     * include black calibration pixels or other inactive regions, and geometric correction
-     * resulting in scaling or cropping may have been applied.</p>
+     * include black calibration pixels or other inactive regions.</p>
+     * <p>For devices that do not support {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the active
+     * array must be the same as {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.</p>
+     * <p>For devices that support {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the active array must
+     * be enclosed by {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}. The difference between
+     * pre-correction active array and active array accounts for scaling or cropping caused
+     * by lens geometric distortion correction.</p>
+     * <p>In general, application should always refer to active array size for controls like
+     * metering regions or crop region. Two exceptions are when the application is dealing with
+     * RAW image buffers (RAW_SENSOR, RAW10, RAW12 etc), or when application explicitly set
+     * {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} to OFF. In these cases, application should refer
+     * to {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.</p>
      * <p><b>Units</b>: Pixel coordinates on the image sensor</p>
      * <p>This key is available on all devices.</p>
      *
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CaptureRequest#SCALER_CROP_REGION
      * @see CameraCharacteristics#SENSOR_INFO_PIXEL_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.graphics.Rect> SENSOR_INFO_ACTIVE_ARRAY_SIZE =
@@ -2616,9 +2640,9 @@ public final class CameraCharacteristics extends CameraMetadata<CameraCharacteri
      * <ol>
      * <li>{@link CameraCharacteristics#LENS_DISTORTION android.lens.distortion}.</li>
      * </ol>
-     * <p>If all of the geometric distortion fields are no-ops, this rectangle will be the same
-     * as the post-distortion-corrected rectangle given in
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.</p>
+     * <p>If the camera device doesn't support geometric distortion correction, or all of the
+     * geometric distortion fields are no-ops, this rectangle will be the same as the
+     * post-distortion-corrected rectangle given in {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.</p>
      * <p>This rectangle is defined relative to the full pixel array; (0,0) is the top-left of
      * the full pixel array, and the size of the full pixel array is given by
      * {@link CameraCharacteristics#SENSOR_INFO_PIXEL_ARRAY_SIZE android.sensor.info.pixelArraySize}.</p>
@@ -3124,12 +3148,26 @@ public final class CameraCharacteristics extends CameraMetadata<CameraCharacteri
      * the following code snippet can be used:</p>
      * <pre><code>// Returns true if the device supports the required hardware level, or better.
      * boolean isHardwareLevelSupported(CameraCharacteristics c, int requiredLevel) {
+     *     final int[] sortedHwLevels = {
+     *         CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_LEGACY,
+     *         CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_EXTERNAL,
+     *         CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_LIMITED,
+     *         CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_FULL,
+     *         CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_3
+     *     };
      *     int deviceLevel = c.get(CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL);
-     *     if (deviceLevel == CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_LEGACY) {
-     *         return requiredLevel == deviceLevel;
+     *     if (requiredLevel == deviceLevel) {
+     *         return true;
+     *     }
+     *
+     *     for (int sortedlevel : sortedHwLevels) {
+     *         if (sortedlevel == requiredLevel) {
+     *             return true;
+     *         } else if (sortedlevel == deviceLevel) {
+     *             return false;
+     *         }
      *     }
-     *     // deviceLevel is not LEGACY, can use numerical sort
-     *     return requiredLevel &lt;= deviceLevel;
+     *     return false; // Should never reach here
      * }
      * </code></pre>
      * <p>At a high level, the levels are:</p>
@@ -3143,6 +3181,8 @@ public final class CameraCharacteristics extends CameraMetadata<CameraCharacteri
      *   post-processing settings, and image capture at a high rate.</li>
      * <li><code>LEVEL_3</code> devices additionally support YUV reprocessing and RAW image capture, along
      *   with additional output stream configurations.</li>
+     * <li><code>EXTERNAL</code> devices are similar to <code>LIMITED</code> devices with exceptions like some sensor or
+     *   lens information not reorted or less stable framerates.</li>
      * </ul>
      * <p>See the individual level enums for full descriptions of the supported capabilities.  The
      * {@link CameraCharacteristics#REQUEST_AVAILABLE_CAPABILITIES android.request.availableCapabilities} entry describes the device's capabilities at a
diff --git a/core/java/android/hardware/camera2/CameraDevice.java b/core/java/android/hardware/camera2/CameraDevice.java
index f47d4640c09..ce88697fa8d 100644
--- a/core/java/android/hardware/camera2/CameraDevice.java
+++ b/core/java/android/hardware/camera2/CameraDevice.java
@@ -44,19 +44,27 @@ import java.lang.annotation.RetentionPolicy;
  * {@link android.Manifest.permission#CAMERA Camera} permission in its manifest
  * in order to access camera devices.</p>
  *
- * <p>A given camera device may provide support at one of two levels: limited or
- * full. If a device only supports the limited level, then Camera2 exposes a
- * feature set that is roughly equivalent to the older
+ * <p>A given camera device may provide support at one of several levels defined
+ * in {@link CameraCharacteristics#INFO_SUPPORTED_HARDWARE_LEVEL}.
+ * If a device supports {@link CameraMetadata#INFO_SUPPORTED_HARDWARE_LEVEL_LEGACY LEGACY} level,
+ * the camera device is running in backward compatibility mode and has minimum camera2 API support.
+ * If a device supports the {@link CameraMetadata#INFO_SUPPORTED_HARDWARE_LEVEL_LIMITED LIMITED}
+ * level, then Camera2 exposes a feature set that is roughly equivalent to the older
  * {@link android.hardware.Camera Camera} API, although with a cleaner and more
- * efficient interface.  Devices that implement the full level of support
+ * efficient interface.
+ * If a device supports the {@link CameraMetadata#INFO_SUPPORTED_HARDWARE_LEVEL_EXTERNAL EXTERNAL}
+ * level, then the device is a removable camera that provides similar but slightly less features
+ * as the {@link CameraMetadata#INFO_SUPPORTED_HARDWARE_LEVEL_LIMITED LIMITED} level.
+ * Devices that implement the {@link CameraMetadata#INFO_SUPPORTED_HARDWARE_LEVEL_FULL FULL} or
+ * {@link CameraMetadata#INFO_SUPPORTED_HARDWARE_LEVEL_3 LEVEL3} level of support
  * provide substantially improved capabilities over the older camera
- * API. Applications that target the limited level devices will run unchanged on
- * the full-level devices; if your application requires a full-level device for
+ * API. If your application requires a full-level device for
  * proper operation, declare the "android.hardware.camera.level.full" feature in your
  * manifest.</p>
  *
  * @see CameraManager#openCamera
  * @see android.Manifest.permission#CAMERA
+ * @see CameraCharacteristics#INFO_SUPPORTED_HARDWARE_LEVEL
  */
 public abstract class CameraDevice implements AutoCloseable {
 
diff --git a/core/java/android/hardware/camera2/CameraMetadata.java b/core/java/android/hardware/camera2/CameraMetadata.java
index 1275a852ee2..caa99d5cb2a 100644
--- a/core/java/android/hardware/camera2/CameraMetadata.java
+++ b/core/java/android/hardware/camera2/CameraMetadata.java
@@ -819,11 +819,11 @@ public abstract class CameraMetadata<TKey> {
      * camera in the list of supported camera devices.</p>
      * <p>This capability requires the camera device to support the following:</p>
      * <ul>
-     * <li>This camera device must list the following static metadata entries in {@link android.hardware.camera2.CameraCharacteristics }:<ul>
-     * <li>android.logicalMultiCamera.physicalIds</li>
-     * <li>{@link CameraCharacteristics#LOGICAL_MULTI_CAMERA_SENSOR_SYNC_TYPE android.logicalMultiCamera.sensorSyncType}</li>
-     * </ul>
-     * </li>
+     * <li>The IDs of underlying physical cameras are returned via
+     *   {@link android.hardware.camera2.CameraCharacteristics#getPhysicalCameraIds }.</li>
+     * <li>This camera device must list static metadata
+     *   {@link CameraCharacteristics#LOGICAL_MULTI_CAMERA_SENSOR_SYNC_TYPE android.logicalMultiCamera.sensorSyncType} in
+     *   {@link android.hardware.camera2.CameraCharacteristics }.</li>
      * <li>The underlying physical cameras' static metadata must list the following entries,
      *   so that the application can correlate pixels from the physical streams:<ul>
      * <li>{@link CameraCharacteristics#LENS_POSE_REFERENCE android.lens.poseReference}</li>
diff --git a/core/java/android/hardware/camera2/CaptureRequest.java b/core/java/android/hardware/camera2/CaptureRequest.java
index 411a97e3eca..0c3fe778dda 100644
--- a/core/java/android/hardware/camera2/CaptureRequest.java
+++ b/core/java/android/hardware/camera2/CaptureRequest.java
@@ -1269,11 +1269,26 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * Otherwise will always be present.</p>
      * <p>The maximum number of regions supported by the device is determined by the value
      * of {@link CameraCharacteristics#CONTROL_MAX_REGIONS_AE android.control.maxRegionsAe}.</p>
-     * <p>The coordinate system is based on the active pixel array,
-     * with (0,0) being the top-left pixel in the active pixel array, and
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with (0,0) being
+     * the top-left pixel in the active pixel array, and
      * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the
-     * bottom-right pixel in the active pixel array.</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.height - 1) being the bottom-right
+     * pixel in the pre-correction active pixel array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
      * <p>The weight must be within <code>[0, 1000]</code>, and represents a weight
      * for every pixel in the area. This means that a large metering area
      * with the same weight as a smaller area will have more effect in
@@ -1289,15 +1304,20 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * region and output only the intersection rectangle as the metering region in the result
      * metadata.  If the region is entirely outside the crop region, it will be ignored and
      * not reported in the result metadata.</p>
-     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize} depending on
+     * distortion correction capability and mode</p>
      * <p><b>Range of valid values:</b><br>
      * Coordinates must be between <code>[(0,0), (width, height))</code> of
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}
+     * depending on distortion correction capability and mode</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
      * @see CameraCharacteristics#CONTROL_MAX_REGIONS_AE
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CaptureRequest#SCALER_CROP_REGION
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.hardware.camera2.params.MeteringRectangle[]> CONTROL_AE_REGIONS =
@@ -1443,11 +1463,26 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * Otherwise will always be present.</p>
      * <p>The maximum number of focus areas supported by the device is determined by the value
      * of {@link CameraCharacteristics#CONTROL_MAX_REGIONS_AF android.control.maxRegionsAf}.</p>
-     * <p>The coordinate system is based on the active pixel array,
-     * with (0,0) being the top-left pixel in the active pixel array, and
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with (0,0) being
+     * the top-left pixel in the active pixel array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.height - 1) being the bottom-right
+     * pixel in the pre-correction active pixel array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the active array, and
      * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the
-     * bottom-right pixel in the active pixel array.</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
      * <p>The weight must be within <code>[0, 1000]</code>, and represents a weight
      * for every pixel in the area. This means that a large metering area
      * with the same weight as a smaller area will have more effect in
@@ -1464,15 +1499,20 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * region and output only the intersection rectangle as the metering region in the result
      * metadata. If the region is entirely outside the crop region, it will be ignored and
      * not reported in the result metadata.</p>
-     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize} depending on
+     * distortion correction capability and mode</p>
      * <p><b>Range of valid values:</b><br>
      * Coordinates must be between <code>[(0,0), (width, height))</code> of
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}
+     * depending on distortion correction capability and mode</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
      * @see CameraCharacteristics#CONTROL_MAX_REGIONS_AF
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CaptureRequest#SCALER_CROP_REGION
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.hardware.camera2.params.MeteringRectangle[]> CONTROL_AF_REGIONS =
@@ -1612,11 +1652,26 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * Otherwise will always be present.</p>
      * <p>The maximum number of regions supported by the device is determined by the value
      * of {@link CameraCharacteristics#CONTROL_MAX_REGIONS_AWB android.control.maxRegionsAwb}.</p>
-     * <p>The coordinate system is based on the active pixel array,
-     * with (0,0) being the top-left pixel in the active pixel array, and
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with (0,0) being
+     * the top-left pixel in the active pixel array, and
      * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the
-     * bottom-right pixel in the active pixel array.</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.height - 1) being the bottom-right
+     * pixel in the pre-correction active pixel array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
      * <p>The weight must range from 0 to 1000, and represents a weight
      * for every pixel in the area. This means that a large metering area
      * with the same weight as a smaller area will have more effect in
@@ -1632,15 +1687,20 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * region and output only the intersection rectangle as the metering region in the result
      * metadata.  If the region is entirely outside the crop region, it will be ignored and
      * not reported in the result metadata.</p>
-     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize} depending on
+     * distortion correction capability and mode</p>
      * <p><b>Range of valid values:</b><br>
      * Coordinates must be between <code>[(0,0), (width, height))</code> of
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}
+     * depending on distortion correction capability and mode</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
      * @see CameraCharacteristics#CONTROL_MAX_REGIONS_AWB
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CaptureRequest#SCALER_CROP_REGION
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.hardware.camera2.params.MeteringRectangle[]> CONTROL_AWB_REGIONS =
@@ -2433,9 +2493,17 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
     /**
      * <p>The desired region of the sensor to read out for this capture.</p>
      * <p>This control can be used to implement digital zoom.</p>
-     * <p>The crop region coordinate system is based off
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with <code>(0, 0)</code> being the
-     * top-left corner of the sensor active array.</p>
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with <code>(0, 0)</code> being
+     * the top-left pixel of the active array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the active array.</p>
      * <p>Output streams use this rectangle to produce their output,
      * cropping to a smaller region if necessary to maintain the
      * stream's aspect ratio, then scaling the sensor input to
@@ -2454,20 +2522,30 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * outputs will crop horizontally (pillarbox), and 16:9
      * streams will match exactly. These additional crops will
      * be centered within the crop region.</p>
-     * <p>The width and height of the crop region cannot
-     * be set to be smaller than
+     * <p>If the coordinate system is {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, the width and height
+     * of the crop region cannot be set to be smaller than
      * <code>floor( activeArraySize.width / {@link CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM android.scaler.availableMaxDigitalZoom} )</code> and
      * <code>floor( activeArraySize.height / {@link CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM android.scaler.availableMaxDigitalZoom} )</code>, respectively.</p>
+     * <p>If the coordinate system is {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, the width
+     * and height of the crop region cannot be set to be smaller than
+     * <code>floor( preCorrectionActiveArraySize.width / {@link CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM android.scaler.availableMaxDigitalZoom} )</code>
+     * and
+     * <code>floor( preCorrectionActiveArraySize.height / {@link CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM android.scaler.availableMaxDigitalZoom} )</code>,
+     * respectively.</p>
      * <p>The camera device may adjust the crop region to account
      * for rounding and other hardware requirements; the final
      * crop region used will be included in the output capture
      * result.</p>
      * <p><b>Units</b>: Pixel coordinates relative to
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize} depending on distortion correction
+     * capability and mode</p>
      * <p>This key is available on all devices.</p>
      *
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.graphics.Rect> SCALER_CROP_REGION =
@@ -2785,8 +2863,14 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
             new Key<Integer>("android.statistics.lensShadingMapMode", int.class);
 
     /**
-     * <p>A control for selecting whether OIS position information is included in output
-     * result metadata.</p>
+     * <p>A control for selecting whether optical stabilization (OIS) position
+     * information is included in output result metadata.</p>
+     * <p>Since optical image stabilization generally involves motion much faster than the duration
+     * of individualq image exposure, multiple OIS samples can be included for a single capture
+     * result. For example, if the OIS reporting operates at 200 Hz, a typical camera operating
+     * at 30fps may have 6-7 OIS samples per capture result. This information can be combined
+     * with the rolling shutter skew to account for lens motion during image exposure in
+     * post-processing algorithms.</p>
      * <p><b>Possible values:</b>
      * <ul>
      *   <li>{@link #STATISTICS_OIS_DATA_MODE_OFF OFF}</li>
@@ -3186,15 +3270,28 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * any correction at all would slow down capture rate.  Every output stream will have a
      * similar amount of enhancement applied.</p>
      * <p>The correction only applies to processed outputs such as YUV, JPEG, or DEPTH16; it is not
-     * applied to any RAW output.  Metadata coordinates such as face rectangles or metering
-     * regions are also not affected by correction.</p>
-     * <p>Applications enabling distortion correction need to pay extra attention when converting
-     * image coordinates between corrected output buffers and the sensor array. For example, if
-     * the app supports tap-to-focus and enables correction, it then has to apply the distortion
-     * model described in {@link CameraCharacteristics#LENS_DISTORTION android.lens.distortion} to the image buffer tap coordinates to properly
-     * calculate the tap position on the sensor active array to be used with
-     * {@link CaptureRequest#CONTROL_AF_REGIONS android.control.afRegions}. The same applies in reverse to detected face rectangles if
-     * they need to be drawn on top of the corrected output buffers.</p>
+     * applied to any RAW output.</p>
+     * <p>This control will be on by default on devices that support this control. Applications
+     * disabling distortion correction need to pay extra attention with the coordinate system of
+     * metering regions, crop region, and face rectangles. When distortion correction is OFF,
+     * metadata coordinates follow the coordinate system of
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}. When distortion is not OFF, metadata
+     * coordinates follow the coordinate system of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.  The
+     * camera device will map these metadata fields to match the corrected image produced by the
+     * camera device, for both capture requests and results.  However, this mapping is not very
+     * precise, since rectangles do not generally map to rectangles when corrected.  Only linear
+     * scaling between the active array and precorrection active array coordinates is
+     * performed. Applications that require precise correction of metadata need to undo that
+     * linear scaling, and apply a more complete correction that takes into the account the app's
+     * own requirements.</p>
+     * <p>The full list of metadata that is affected in this way by distortion correction is:</p>
+     * <ul>
+     * <li>{@link CaptureRequest#CONTROL_AF_REGIONS android.control.afRegions}</li>
+     * <li>{@link CaptureRequest#CONTROL_AE_REGIONS android.control.aeRegions}</li>
+     * <li>{@link CaptureRequest#CONTROL_AWB_REGIONS android.control.awbRegions}</li>
+     * <li>{@link CaptureRequest#SCALER_CROP_REGION android.scaler.cropRegion}</li>
+     * <li>{@link CaptureResult#STATISTICS_FACES android.statistics.faces}</li>
+     * </ul>
      * <p><b>Possible values:</b>
      * <ul>
      *   <li>{@link #DISTORTION_CORRECTION_MODE_OFF OFF}</li>
@@ -3205,9 +3302,15 @@ public final class CaptureRequest extends CameraMetadata<CaptureRequest.Key<?>>
      * {@link CameraCharacteristics#DISTORTION_CORRECTION_AVAILABLE_MODES android.distortionCorrection.availableModes}</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
+     * @see CaptureRequest#CONTROL_AE_REGIONS
      * @see CaptureRequest#CONTROL_AF_REGIONS
+     * @see CaptureRequest#CONTROL_AWB_REGIONS
      * @see CameraCharacteristics#DISTORTION_CORRECTION_AVAILABLE_MODES
      * @see CameraCharacteristics#LENS_DISTORTION
+     * @see CaptureRequest#SCALER_CROP_REGION
+     * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
+     * @see CaptureResult#STATISTICS_FACES
      * @see #DISTORTION_CORRECTION_MODE_OFF
      * @see #DISTORTION_CORRECTION_MODE_FAST
      * @see #DISTORTION_CORRECTION_MODE_HIGH_QUALITY
diff --git a/core/java/android/hardware/camera2/CaptureResult.java b/core/java/android/hardware/camera2/CaptureResult.java
index 6439338428e..845f1d3cbcb 100644
--- a/core/java/android/hardware/camera2/CaptureResult.java
+++ b/core/java/android/hardware/camera2/CaptureResult.java
@@ -730,11 +730,26 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * Otherwise will always be present.</p>
      * <p>The maximum number of regions supported by the device is determined by the value
      * of {@link CameraCharacteristics#CONTROL_MAX_REGIONS_AE android.control.maxRegionsAe}.</p>
-     * <p>The coordinate system is based on the active pixel array,
-     * with (0,0) being the top-left pixel in the active pixel array, and
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with (0,0) being
+     * the top-left pixel in the active pixel array, and
      * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the
-     * bottom-right pixel in the active pixel array.</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.height - 1) being the bottom-right
+     * pixel in the pre-correction active pixel array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
      * <p>The weight must be within <code>[0, 1000]</code>, and represents a weight
      * for every pixel in the area. This means that a large metering area
      * with the same weight as a smaller area will have more effect in
@@ -750,15 +765,20 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * region and output only the intersection rectangle as the metering region in the result
      * metadata.  If the region is entirely outside the crop region, it will be ignored and
      * not reported in the result metadata.</p>
-     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize} depending on
+     * distortion correction capability and mode</p>
      * <p><b>Range of valid values:</b><br>
      * Coordinates must be between <code>[(0,0), (width, height))</code> of
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}
+     * depending on distortion correction capability and mode</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
      * @see CameraCharacteristics#CONTROL_MAX_REGIONS_AE
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CaptureRequest#SCALER_CROP_REGION
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.hardware.camera2.params.MeteringRectangle[]> CONTROL_AE_REGIONS =
@@ -1152,11 +1172,26 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * Otherwise will always be present.</p>
      * <p>The maximum number of focus areas supported by the device is determined by the value
      * of {@link CameraCharacteristics#CONTROL_MAX_REGIONS_AF android.control.maxRegionsAf}.</p>
-     * <p>The coordinate system is based on the active pixel array,
-     * with (0,0) being the top-left pixel in the active pixel array, and
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with (0,0) being
+     * the top-left pixel in the active pixel array, and
      * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the
-     * bottom-right pixel in the active pixel array.</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.height - 1) being the bottom-right
+     * pixel in the pre-correction active pixel array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
      * <p>The weight must be within <code>[0, 1000]</code>, and represents a weight
      * for every pixel in the area. This means that a large metering area
      * with the same weight as a smaller area will have more effect in
@@ -1173,15 +1208,20 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * region and output only the intersection rectangle as the metering region in the result
      * metadata. If the region is entirely outside the crop region, it will be ignored and
      * not reported in the result metadata.</p>
-     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize} depending on
+     * distortion correction capability and mode</p>
      * <p><b>Range of valid values:</b><br>
      * Coordinates must be between <code>[(0,0), (width, height))</code> of
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}
+     * depending on distortion correction capability and mode</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
      * @see CameraCharacteristics#CONTROL_MAX_REGIONS_AF
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CaptureRequest#SCALER_CROP_REGION
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.hardware.camera2.params.MeteringRectangle[]> CONTROL_AF_REGIONS =
@@ -1730,11 +1770,26 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * Otherwise will always be present.</p>
      * <p>The maximum number of regions supported by the device is determined by the value
      * of {@link CameraCharacteristics#CONTROL_MAX_REGIONS_AWB android.control.maxRegionsAwb}.</p>
-     * <p>The coordinate system is based on the active pixel array,
-     * with (0,0) being the top-left pixel in the active pixel array, and
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with (0,0) being
+     * the top-left pixel in the active pixel array, and
      * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the
-     * bottom-right pixel in the active pixel array.</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}.height - 1) being the bottom-right
+     * pixel in the pre-correction active pixel array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the active array, and
+     * ({@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.width - 1,
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.height - 1) being the bottom-right pixel in the
+     * active pixel array.</p>
      * <p>The weight must range from 0 to 1000, and represents a weight
      * for every pixel in the area. This means that a large metering area
      * with the same weight as a smaller area will have more effect in
@@ -1750,15 +1805,20 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * region and output only the intersection rectangle as the metering region in the result
      * metadata.  If the region is entirely outside the crop region, it will be ignored and
      * not reported in the result metadata.</p>
-     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * <p><b>Units</b>: Pixel coordinates within {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize} depending on
+     * distortion correction capability and mode</p>
      * <p><b>Range of valid values:</b><br>
      * Coordinates must be between <code>[(0,0), (width, height))</code> of
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}
+     * depending on distortion correction capability and mode</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
      * @see CameraCharacteristics#CONTROL_MAX_REGIONS_AWB
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CaptureRequest#SCALER_CROP_REGION
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.hardware.camera2.params.MeteringRectangle[]> CONTROL_AWB_REGIONS =
@@ -2792,7 +2852,9 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * <p>If this device is the largest or only camera device with a given facing, then this
      * position will be <code>(0, 0, 0)</code>; a camera device with a lens optical center located 3 cm
      * from the main sensor along the +X axis (to the right from the user's perspective) will
-     * report <code>(0.03, 0, 0)</code>.</p>
+     * report <code>(0.03, 0, 0)</code>.  Note that this means that, for many computer vision
+     * applications, the position needs to be negated to convert it to a translation from the
+     * camera to the origin.</p>
      * <p>To transform a pixel coordinates between two cameras facing the same direction, first
      * the source camera {@link CameraCharacteristics#LENS_DISTORTION android.lens.distortion} must be corrected for.  Then the source
      * camera {@link CameraCharacteristics#LENS_INTRINSIC_CALIBRATION android.lens.intrinsicCalibration} needs to be applied, followed by the
@@ -2804,7 +2866,8 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * <p>To compare this against a real image from the destination camera, the destination camera
      * image then needs to be corrected for radial distortion before comparison or sampling.</p>
      * <p>When {@link CameraCharacteristics#LENS_POSE_REFERENCE android.lens.poseReference} is GYROSCOPE, then this position is relative to
-     * the center of the primary gyroscope on the device.</p>
+     * the center of the primary gyroscope on the device. The axis definitions are the same as
+     * with PRIMARY_CAMERA.</p>
      * <p><b>Units</b>: Meters</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
@@ -2836,13 +2899,15 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * </code></pre>
      * <p>which can then be combined with the camera pose rotation
      * <code>R</code> and translation <code>t</code> ({@link CameraCharacteristics#LENS_POSE_ROTATION android.lens.poseRotation} and
-     * {@link CameraCharacteristics#LENS_POSE_TRANSLATION android.lens.poseTranslation}, respective) to calculate the
+     * {@link CameraCharacteristics#LENS_POSE_TRANSLATION android.lens.poseTranslation}, respectively) to calculate the
      * complete transform from world coordinates to pixel
      * coordinates:</p>
-     * <pre><code>P = [ K 0   * [ R t
-     *      0 1 ]     0 1 ]
+     * <pre><code>P = [ K 0   * [ R -Rt
+     *      0 1 ]      0 1 ]
      * </code></pre>
-     * <p>and with <code>p_w</code> being a point in the world coordinate system
+     * <p>(Note the negation of poseTranslation when mapping from camera
+     * to world coordinates, and multiplication by the rotation).</p>
+     * <p>With <code>p_w</code> being a point in the world coordinate system
      * and <code>p_s</code> being a point in the camera active pixel array
      * coordinate system, and with the mapping including the
      * homogeneous division by z:</p>
@@ -2864,6 +2929,13 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * activeArraySize rectangle), to determine the final pixel
      * coordinate of the world point for processed (non-RAW)
      * output buffers.</p>
+     * <p>For camera devices, the center of pixel <code>(x,y)</code> is located at
+     * coordinate <code>(x + 0.5, y + 0.5)</code>.  So on a device with a
+     * precorrection active array of size <code>(10,10)</code>, the valid pixel
+     * indices go from <code>(0,0)-(9,9)</code>, and an perfectly-built camera would
+     * have an optical center at the exact center of the pixel grid, at
+     * coordinates <code>(5.0, 5.0)</code>, which is the top-left corner of pixel
+     * <code>(5,5)</code>.</p>
      * <p><b>Units</b>:
      * Pixels in the
      * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}
@@ -3099,9 +3171,17 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
     /**
      * <p>The desired region of the sensor to read out for this capture.</p>
      * <p>This control can be used to implement digital zoom.</p>
-     * <p>The crop region coordinate system is based off
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with <code>(0, 0)</code> being the
-     * top-left corner of the sensor active array.</p>
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with <code>(0, 0)</code> being
+     * the top-left pixel of the active array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the active array.</p>
      * <p>Output streams use this rectangle to produce their output,
      * cropping to a smaller region if necessary to maintain the
      * stream's aspect ratio, then scaling the sensor input to
@@ -3120,20 +3200,30 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * outputs will crop horizontally (pillarbox), and 16:9
      * streams will match exactly. These additional crops will
      * be centered within the crop region.</p>
-     * <p>The width and height of the crop region cannot
-     * be set to be smaller than
+     * <p>If the coordinate system is {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, the width and height
+     * of the crop region cannot be set to be smaller than
      * <code>floor( activeArraySize.width / {@link CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM android.scaler.availableMaxDigitalZoom} )</code> and
      * <code>floor( activeArraySize.height / {@link CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM android.scaler.availableMaxDigitalZoom} )</code>, respectively.</p>
+     * <p>If the coordinate system is {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, the width
+     * and height of the crop region cannot be set to be smaller than
+     * <code>floor( preCorrectionActiveArraySize.width / {@link CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM android.scaler.availableMaxDigitalZoom} )</code>
+     * and
+     * <code>floor( preCorrectionActiveArraySize.height / {@link CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM android.scaler.availableMaxDigitalZoom} )</code>,
+     * respectively.</p>
      * <p>The camera device may adjust the crop region to account
      * for rounding and other hardware requirements; the final
      * crop region used will be included in the output capture
      * result.</p>
      * <p><b>Units</b>: Pixel coordinates relative to
-     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}</p>
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize} or
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize} depending on distortion correction
+     * capability and mode</p>
      * <p>This key is available on all devices.</p>
      *
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CameraCharacteristics#SCALER_AVAILABLE_MAX_DIGITAL_ZOOM
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      */
     @PublicKey
     public static final Key<android.graphics.Rect> SCALER_CROP_REGION =
@@ -3624,12 +3714,23 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
     /**
      * <p>List of landmarks for detected
      * faces.</p>
-     * <p>The coordinate system is that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with <code>(0, 0)</code> being
+     * the top-left pixel of the active array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
      * <code>(0, 0)</code> being the top-left pixel of the active array.</p>
      * <p>Only available if {@link CaptureRequest#STATISTICS_FACE_DETECT_MODE android.statistics.faceDetectMode} == FULL
      * This key is available on all devices.</p>
      *
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      * @see CaptureRequest#STATISTICS_FACE_DETECT_MODE
      * @hide
      */
@@ -3639,12 +3740,23 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
     /**
      * <p>List of the bounding rectangles for detected
      * faces.</p>
-     * <p>The coordinate system is that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
+     * <p>For devices not supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system always follows that of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with <code>(0, 0)</code> being
+     * the top-left pixel of the active array.</p>
+     * <p>For devices supporting {@link CaptureRequest#DISTORTION_CORRECTION_MODE android.distortionCorrection.mode} control, the coordinate
+     * system depends on the mode being set.
+     * When the distortion correction mode is OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}, with
+     * <code>(0, 0)</code> being the top-left pixel of the pre-correction active array.
+     * When the distortion correction mode is not OFF, the coordinate system follows
+     * {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}, with
      * <code>(0, 0)</code> being the top-left pixel of the active array.</p>
      * <p>Only available if {@link CaptureRequest#STATISTICS_FACE_DETECT_MODE android.statistics.faceDetectMode} != OFF
      * This key is available on all devices.</p>
      *
+     * @see CaptureRequest#DISTORTION_CORRECTION_MODE
      * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
      * @see CaptureRequest#STATISTICS_FACE_DETECT_MODE
      * @hide
      */
@@ -3977,8 +4089,14 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
             new Key<Integer>("android.statistics.lensShadingMapMode", int.class);
 
     /**
-     * <p>A control for selecting whether OIS position information is included in output
-     * result metadata.</p>
+     * <p>A control for selecting whether optical stabilization (OIS) position
+     * information is included in output result metadata.</p>
+     * <p>Since optical image stabilization generally involves motion much faster than the duration
+     * of individualq image exposure, multiple OIS samples can be included for a single capture
+     * result. For example, if the OIS reporting operates at 200 Hz, a typical camera operating
+     * at 30fps may have 6-7 OIS samples per capture result. This information can be combined
+     * with the rolling shutter skew to account for lens motion during image exposure in
+     * post-processing algorithms.</p>
      * <p><b>Possible values:</b>
      * <ul>
      *   <li>{@link #STATISTICS_OIS_DATA_MODE_OFF OFF}</li>
@@ -4012,11 +4130,15 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
     /**
      * <p>An array of shifts of OIS samples, in x direction.</p>
      * <p>The array contains the amount of shifts in x direction, in pixels, based on OIS samples.
-     * A positive value is a shift from left to right in active array coordinate system. For
-     * example, if the optical center is (1000, 500) in active array coordinates, a shift of
-     * (3, 0) puts the new optical center at (1003, 500).</p>
+     * A positive value is a shift from left to right in the pre-correction active array
+     * coordinate system. For example, if the optical center is (1000, 500) in pre-correction
+     * active array coordinates, a shift of (3, 0) puts the new optical center at (1003, 500).</p>
      * <p>The number of shifts must match the number of timestamps in
      * android.statistics.oisTimestamps.</p>
+     * <p>The OIS samples are not affected by whether lens distortion correction is enabled (on
+     * supporting devices). They are always reported in pre-correction active array coordinates,
+     * since the scaling of OIS shifts would depend on the specific spot on the sensor the shift
+     * is needed.</p>
      * <p><b>Units</b>: Pixels in active array.</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      * @hide
@@ -4027,11 +4149,15 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
     /**
      * <p>An array of shifts of OIS samples, in y direction.</p>
      * <p>The array contains the amount of shifts in y direction, in pixels, based on OIS samples.
-     * A positive value is a shift from top to bottom in active array coordinate system. For
-     * example, if the optical center is (1000, 500) in active array coordinates, a shift of
-     * (0, 5) puts the new optical center at (1000, 505).</p>
+     * A positive value is a shift from top to bottom in pre-correction active array coordinate
+     * system. For example, if the optical center is (1000, 500) in active array coordinates, a
+     * shift of (0, 5) puts the new optical center at (1000, 505).</p>
      * <p>The number of shifts must match the number of timestamps in
      * android.statistics.oisTimestamps.</p>
+     * <p>The OIS samples are not affected by whether lens distortion correction is enabled (on
+     * supporting devices). They are always reported in pre-correction active array coordinates,
+     * since the scaling of OIS shifts would depend on the specific spot on the sensor the shift
+     * is needed.</p>
      * <p><b>Units</b>: Pixels in active array.</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      * @hide
@@ -4040,15 +4166,21 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
             new Key<float[]>("android.statistics.oisYShifts", float[].class);
 
     /**
-     * <p>An array of OIS samples.</p>
+     * <p>An array of optical stabilization (OIS) position samples.</p>
      * <p>Each OIS sample contains the timestamp and the amount of shifts in x and y direction,
      * in pixels, of the OIS sample.</p>
-     * <p>A positive value for a shift in x direction is a shift from left to right in active array
-     * coordinate system. For example, if the optical center is (1000, 500) in active array
-     * coordinates, a shift of (3, 0) puts the new optical center at (1003, 500).</p>
-     * <p>A positive value for a shift in y direction is a shift from top to bottom in active array
-     * coordinate system. For example, if the optical center is (1000, 500) in active array
-     * coordinates, a shift of (0, 5) puts the new optical center at (1000, 505).</p>
+     * <p>A positive value for a shift in x direction is a shift from left to right in the
+     * pre-correction active array coordinate system. For example, if the optical center is
+     * (1000, 500) in pre-correction active array coordinates, a shift of (3, 0) puts the new
+     * optical center at (1003, 500).</p>
+     * <p>A positive value for a shift in y direction is a shift from top to bottom in
+     * pre-correction active array coordinate system. For example, if the optical center is
+     * (1000, 500) in active array coordinates, a shift of (0, 5) puts the new optical center at
+     * (1000, 505).</p>
+     * <p>The OIS samples are not affected by whether lens distortion correction is enabled (on
+     * supporting devices). They are always reported in pre-correction active array coordinates,
+     * since the scaling of OIS shifts would depend on the specific spot on the sensor the shift
+     * is needed.</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      */
     @PublicKey
@@ -4478,15 +4610,28 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * any correction at all would slow down capture rate.  Every output stream will have a
      * similar amount of enhancement applied.</p>
      * <p>The correction only applies to processed outputs such as YUV, JPEG, or DEPTH16; it is not
-     * applied to any RAW output.  Metadata coordinates such as face rectangles or metering
-     * regions are also not affected by correction.</p>
-     * <p>Applications enabling distortion correction need to pay extra attention when converting
-     * image coordinates between corrected output buffers and the sensor array. For example, if
-     * the app supports tap-to-focus and enables correction, it then has to apply the distortion
-     * model described in {@link CameraCharacteristics#LENS_DISTORTION android.lens.distortion} to the image buffer tap coordinates to properly
-     * calculate the tap position on the sensor active array to be used with
-     * {@link CaptureRequest#CONTROL_AF_REGIONS android.control.afRegions}. The same applies in reverse to detected face rectangles if
-     * they need to be drawn on top of the corrected output buffers.</p>
+     * applied to any RAW output.</p>
+     * <p>This control will be on by default on devices that support this control. Applications
+     * disabling distortion correction need to pay extra attention with the coordinate system of
+     * metering regions, crop region, and face rectangles. When distortion correction is OFF,
+     * metadata coordinates follow the coordinate system of
+     * {@link CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE android.sensor.info.preCorrectionActiveArraySize}. When distortion is not OFF, metadata
+     * coordinates follow the coordinate system of {@link CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE android.sensor.info.activeArraySize}.  The
+     * camera device will map these metadata fields to match the corrected image produced by the
+     * camera device, for both capture requests and results.  However, this mapping is not very
+     * precise, since rectangles do not generally map to rectangles when corrected.  Only linear
+     * scaling between the active array and precorrection active array coordinates is
+     * performed. Applications that require precise correction of metadata need to undo that
+     * linear scaling, and apply a more complete correction that takes into the account the app's
+     * own requirements.</p>
+     * <p>The full list of metadata that is affected in this way by distortion correction is:</p>
+     * <ul>
+     * <li>{@link CaptureRequest#CONTROL_AF_REGIONS android.control.afRegions}</li>
+     * <li>{@link CaptureRequest#CONTROL_AE_REGIONS android.control.aeRegions}</li>
+     * <li>{@link CaptureRequest#CONTROL_AWB_REGIONS android.control.awbRegions}</li>
+     * <li>{@link CaptureRequest#SCALER_CROP_REGION android.scaler.cropRegion}</li>
+     * <li>{@link CaptureResult#STATISTICS_FACES android.statistics.faces}</li>
+     * </ul>
      * <p><b>Possible values:</b>
      * <ul>
      *   <li>{@link #DISTORTION_CORRECTION_MODE_OFF OFF}</li>
@@ -4497,9 +4642,15 @@ public class CaptureResult extends CameraMetadata<CaptureResult.Key<?>> {
      * {@link CameraCharacteristics#DISTORTION_CORRECTION_AVAILABLE_MODES android.distortionCorrection.availableModes}</p>
      * <p><b>Optional</b> - This value may be {@code null} on some devices.</p>
      *
+     * @see CaptureRequest#CONTROL_AE_REGIONS
      * @see CaptureRequest#CONTROL_AF_REGIONS
+     * @see CaptureRequest#CONTROL_AWB_REGIONS
      * @see CameraCharacteristics#DISTORTION_CORRECTION_AVAILABLE_MODES
      * @see CameraCharacteristics#LENS_DISTORTION
+     * @see CaptureRequest#SCALER_CROP_REGION
+     * @see CameraCharacteristics#SENSOR_INFO_ACTIVE_ARRAY_SIZE
+     * @see CameraCharacteristics#SENSOR_INFO_PRE_CORRECTION_ACTIVE_ARRAY_SIZE
+     * @see CaptureResult#STATISTICS_FACES
      * @see #DISTORTION_CORRECTION_MODE_OFF
      * @see #DISTORTION_CORRECTION_MODE_FAST
      * @see #DISTORTION_CORRECTION_MODE_HIGH_QUALITY
diff --git a/core/java/android/hardware/camera2/impl/CameraMetadataNative.java b/core/java/android/hardware/camera2/impl/CameraMetadataNative.java
index 4baf2638d88..86bd30c19ca 100644
--- a/core/java/android/hardware/camera2/impl/CameraMetadataNative.java
+++ b/core/java/android/hardware/camera2/impl/CameraMetadataNative.java
@@ -747,6 +747,9 @@ public class CameraMetadataNative implements Parcelable {
         if (faceDetectMode == null) {
             Log.w(TAG, "Face detect mode metadata is null, assuming the mode is SIMPLE");
             faceDetectMode = CaptureResult.STATISTICS_FACE_DETECT_MODE_SIMPLE;
+        } else if (faceDetectMode > CaptureResult.STATISTICS_FACE_DETECT_MODE_FULL) {
+            // Face detect mode is larger than FULL, assuming the mode is FULL
+            faceDetectMode = CaptureResult.STATISTICS_FACE_DETECT_MODE_FULL;
         } else {
             if (faceDetectMode == CaptureResult.STATISTICS_FACE_DETECT_MODE_OFF) {
                 return new Face[0];
diff --git a/core/java/android/hardware/camera2/params/OutputConfiguration.java b/core/java/android/hardware/camera2/params/OutputConfiguration.java
index a040a09cf46..1ee3c933b32 100644
--- a/core/java/android/hardware/camera2/params/OutputConfiguration.java
+++ b/core/java/android/hardware/camera2/params/OutputConfiguration.java
@@ -82,9 +82,9 @@ import java.util.List;
  *
  * </ul>
  *
- * <p> As of {@link android.os.Build.VERSION_CODES#P Android P}, all formats can be used for
- * sharing, subject to device support. On prior API levels, only {@link ImageFormat#PRIVATE}
- * format may be used.</p>
+ * <p> As of {@link android.os.Build.VERSION_CODES#P Android P}, all formats except
+ * {@link ImageFormat#JPEG} and {@link ImageFormat#RAW_PRIVATE} can be used for sharing, subject to
+ * device support. On prior API levels, only {@link ImageFormat#PRIVATE} format may be used.</p>
  *
  * @see CameraDevice#createCaptureSessionByOutputConfigurations
  *
diff --git a/core/java/android/net/TrafficStats.java b/core/java/android/net/TrafficStats.java
index 40d53b741d6..f033268698e 100644
--- a/core/java/android/net/TrafficStats.java
+++ b/core/java/android/net/TrafficStats.java
@@ -329,6 +329,14 @@ public class TrafficStats {
 
     /**
      * Remove any statistics parameters from the given {@link Socket}.
+     * <p>
+     * In Android 8.1 (API level 27) and lower, a socket is automatically
+     * untagged when it's sent to another process using binder IPC with a
+     * {@code ParcelFileDescriptor} container. In Android 9.0 (API level 28)
+     * and higher, the socket tag is kept when the socket is sent to another
+     * process using binder IPC. You can mimic the previous behavior by
+     * calling {@code untagSocket()} before sending the socket to another
+     * process.
      */
     public static void untagSocket(Socket socket) throws SocketException {
         SocketTagger.get().untag(socket);
diff --git a/core/java/android/os/Build.java b/core/java/android/os/Build.java
index dfdeb346bef..51f4be26fc1 100644
--- a/core/java/android/os/Build.java
+++ b/core/java/android/os/Build.java
@@ -630,7 +630,8 @@ public class Build {
          * October 2013: Android 4.4, KitKat, another tasty treat.
          *
          * <p>Applications targeting this or a later release will get these
-         * new changes in behavior:</p>
+         * new changes in behavior. For more information about this release, see the
+         * <a href="/about/versions/kitkat/">Android KitKat overview</a>.</p>
          * <ul>
          * <li> The default result of
          * {@link android.preference.PreferenceActivity#isValidFragment(String)
@@ -680,7 +681,8 @@ public class Build {
          * November 2014: Lollipop.  A flat one with beautiful shadows.  But still tasty.
          *
          * <p>Applications targeting this or a later release will get these
-         * new changes in behavior:</p>
+         * new changes in behavior.  For more information about this release, see the
+         * <a href="/about/versions/lollipop/">Android Lollipop overview</a>.</p>
          * <ul>
          * <li> {@link android.content.Context#bindService Context.bindService} now
          * requires an explicit Intent, and will throw an exception if given an implicit
@@ -709,6 +711,8 @@ public class Build {
 
         /**
          * March 2015: Lollipop with an extra sugar coating on the outside!
+         * For more information about this release, see the
+         * <a href="/about/versions/android-5.1">Android 5.1 APIs</a>.
          */
         public static final int LOLLIPOP_MR1 = 22;
 
@@ -716,7 +720,8 @@ public class Build {
          * M is for Marshmallow!
          *
          * <p>Applications targeting this or a later release will get these
-         * new changes in behavior:</p>
+         * new changes in behavior. For more information about this release, see the
+         * <a href="/about/versions/marshmallow/">Android 6.0 Marshmallow overview</a>.</p>
          * <ul>
          * <li> Runtime permissions.  Dangerous permissions are no longer granted at
          * install time, but must be requested by the application at runtime through
@@ -747,7 +752,8 @@ public class Build {
          * N is for Nougat.
          *
          * <p>Applications targeting this or a later release will get these
-         * new changes in behavior:</p>
+         * new changes in behavior. For more information about this release, see
+         * the <a href="/about/versions/nougat/">Android Nougat overview</a>.</p>
          * <ul>
          * <li> {@link android.app.DownloadManager.Request#setAllowedNetworkTypes
          * DownloadManager.Request.setAllowedNetworkTypes}
@@ -797,7 +803,9 @@ public class Build {
         public static final int N = 24;
 
         /**
-         * N MR1: Nougat++.
+         * N MR1: Nougat++. For more information about this release, see
+         * <a href="/about/versions/nougat/android-7.1">Android 7.1 for
+         * Developers</a>.
          */
         public static final int N_MR1 = 25;
 
@@ -805,7 +813,8 @@ public class Build {
          * O.
          *
          * <p>Applications targeting this or a later release will get these
-         * new changes in behavior:</p>
+         * new changes in behavior. For more information about this release, see
+         * the <a href="/about/versions/oreo/">Android Oreo overview</a>.</p>
          * <ul>
          * <li><a href="{@docRoot}about/versions/oreo/background.html">Background execution limits</a>
          * are applied to the application.</li>
@@ -894,13 +903,16 @@ public class Build {
          * O MR1.
          *
          * <p>Applications targeting this or a later release will get these
-         * new changes in behavior:</p>
+         * new changes in behavior. For more information about this release, see
+         * <a href="/about/versions/oreo/android-8.1">Android 8.1 features and
+         * APIs</a>.</p>
          * <ul>
          * <li>Apps exporting and linking to apk shared libraries must explicitly
          * enumerate all signing certificates in a consistent order.</li>
          * <li>{@link android.R.attr#screenOrientation} can not be used to request a fixed
          * orientation if the associated activity is not fullscreen and opaque.</li>
          * </ul>
+         *
          */
         public static final int O_MR1 = 27;
 
@@ -908,7 +920,8 @@ public class Build {
          * P.
          *
          * <p>Applications targeting this or a later release will get these
-         * new changes in behavior:</p>
+         * new changes in behavior. For more information about this release, see the
+         * <a href="/about/versions/pie/">Android 9 Pie overview</a>.</p>
          * <ul>
          * <li>{@link android.app.Service#startForeground Service.startForeground} requires
          * that apps hold the permission
@@ -916,6 +929,7 @@ public class Build {
          * <li>{@link android.widget.LinearLayout} will always remeasure weighted children,
          * even if there is no excess space.</li>
          * </ul>
+         *
          */
         public static final int P = 28;
     }
diff --git a/core/java/android/os/Message.java b/core/java/android/os/Message.java
index b303e10fa64..455d8edd413 100644
--- a/core/java/android/os/Message.java
+++ b/core/java/android/os/Message.java
@@ -349,7 +349,7 @@ public final class Message implements Parcelable {
     }
 
     /**
-     * Retrieve the a {@link android.os.Handler Handler} implementation that
+     * Retrieve the {@link android.os.Handler Handler} implementation that
      * will receive this message. The object must implement
      * {@link android.os.Handler#handleMessage(android.os.Message)
      * Handler.handleMessage()}. Each Handler has its own name-space for
diff --git a/core/java/android/os/Parcel.java b/core/java/android/os/Parcel.java
index 514292872e9..460f12510d4 100644
--- a/core/java/android/os/Parcel.java
+++ b/core/java/android/os/Parcel.java
@@ -835,11 +835,19 @@ public final class Parcel {
             return;
         }
         Set<Map.Entry<String,Object>> entries = val.entrySet();
-        writeInt(entries.size());
+        int size = entries.size();
+        writeInt(size);
+
         for (Map.Entry<String,Object> e : entries) {
             writeValue(e.getKey());
             writeValue(e.getValue());
+            size--;
         }
+
+        if (size != 0) {
+            throw new BadParcelableException("Map size does not match number of entries!");
+        }
+
     }
 
     /**
diff --git a/core/java/android/os/StatsLogEventWrapper.java b/core/java/android/os/StatsLogEventWrapper.java
index d4d3dc838d9..7b3ea57ba0e 100644
--- a/core/java/android/os/StatsLogEventWrapper.java
+++ b/core/java/android/os/StatsLogEventWrapper.java
@@ -65,11 +65,17 @@ public final class StatsLogEventWrapper implements Parcelable {
     public static final Parcelable.Creator<StatsLogEventWrapper> CREATOR = new
             Parcelable.Creator<StatsLogEventWrapper>() {
                 public StatsLogEventWrapper createFromParcel(Parcel in) {
-                    return new StatsLogEventWrapper(in);
+                    android.util.EventLog.writeEvent(0x534e4554, "112550251",
+                            android.os.Binder.getCallingUid(), "");
+                    // Purposefully leaving this method not implemented.
+                    throw new RuntimeException("Not implemented");
                 }
 
                 public StatsLogEventWrapper[] newArray(int size) {
-                    return new StatsLogEventWrapper[size];
+                    android.util.EventLog.writeEvent(0x534e4554, "112550251",
+                            android.os.Binder.getCallingUid(), "");
+                    // Purposefully leaving this method not implemented.
+                    throw new RuntimeException("Not implemented");
                 }
             };
 
@@ -120,10 +126,6 @@ public final class StatsLogEventWrapper implements Parcelable {
         mStorage.write(bytes, 0, bytes.length);
     }
 
-    private StatsLogEventWrapper(Parcel in) {
-        readFromParcel(in);
-    }
-
     /**
      * Writes the stored fields to a byte array. Will first write a new-line character to denote
      * END_LIST before writing contents to byte array.
@@ -133,13 +135,6 @@ public final class StatsLogEventWrapper implements Parcelable {
         out.writeByteArray(mStorage.toByteArray());
     }
 
-    /**
-     * Not implemented.
-     */
-    public void readFromParcel(Parcel in) {
-        // Not needed since this java class is for sending to statsd only.
-    }
-
     /**
      * Boilerplate for Parcel.
      */
diff --git a/core/java/android/preference/PreferenceActivity.java b/core/java/android/preference/PreferenceActivity.java
index 02fa7edb2aa..257f2cf88ea 100644
--- a/core/java/android/preference/PreferenceActivity.java
+++ b/core/java/android/preference/PreferenceActivity.java
@@ -79,7 +79,7 @@ import java.util.List;
  * <li>On a small screen it may display only the headers as a single list when first launched.
  * Selecting one of the header items will only show the PreferenceFragment of that header (on
  * Android N and lower a new Activity is launched).
- * <li>On a large screen in may display both the headers and current PreferenceFragment together as
+ * <li>On a large screen it may display both the headers and current PreferenceFragment together as
  * panes. Selecting a header item switches to showing the correct PreferenceFragment for that item.
  * </ul>
  *
diff --git a/core/java/android/provider/Settings.java b/core/java/android/provider/Settings.java
index f6866a738f4..754886f293f 100644
--- a/core/java/android/provider/Settings.java
+++ b/core/java/android/provider/Settings.java
@@ -7597,9 +7597,6 @@ public final class Settings {
          */
         public static final String ASSIST_GESTURE_SENSITIVITY = "assist_gesture_sensitivity";
 
-        private static final Validator ASSIST_GESTURE_SENSITIVITY_VALIDATOR =
-                new SettingsValidators.InclusiveFloatRangeValidator(0.0f, 1.0f);
-
         /**
          * Whether the assist gesture should silence alerts.
          *
@@ -7629,8 +7626,6 @@ public final class Settings {
          */
         public static final String ASSIST_GESTURE_SETUP_COMPLETE = "assist_gesture_setup_complete";
 
-        private static final Validator ASSIST_GESTURE_SETUP_COMPLETE_VALIDATOR = BOOLEAN_VALIDATOR;
-
         /**
          * Control whether Night display is currently activated.
          * @hide
@@ -8086,8 +8081,6 @@ public final class Settings {
             NFC_PAYMENT_DEFAULT_COMPONENT,
             AUTOMATIC_STORAGE_MANAGER_DAYS_TO_RETAIN,
             ASSIST_GESTURE_ENABLED,
-            ASSIST_GESTURE_SENSITIVITY,
-            ASSIST_GESTURE_SETUP_COMPLETE,
             ASSIST_GESTURE_SILENCE_ALERTS_ENABLED,
             ASSIST_GESTURE_WAKE_ENABLED,
             VR_DISPLAY_MODE,
@@ -8226,8 +8219,6 @@ public final class Settings {
             VALIDATORS.put(AUTOMATIC_STORAGE_MANAGER_DAYS_TO_RETAIN,
                     AUTOMATIC_STORAGE_MANAGER_DAYS_TO_RETAIN_VALIDATOR);
             VALIDATORS.put(ASSIST_GESTURE_ENABLED, ASSIST_GESTURE_ENABLED_VALIDATOR);
-            VALIDATORS.put(ASSIST_GESTURE_SENSITIVITY, ASSIST_GESTURE_SENSITIVITY_VALIDATOR);
-            VALIDATORS.put(ASSIST_GESTURE_SETUP_COMPLETE, ASSIST_GESTURE_SETUP_COMPLETE_VALIDATOR);
             VALIDATORS.put(ASSIST_GESTURE_SILENCE_ALERTS_ENABLED,
                     ASSIST_GESTURE_SILENCE_ALERTS_ENABLED_VALIDATOR);
             VALIDATORS.put(ASSIST_GESTURE_WAKE_ENABLED, ASSIST_GESTURE_WAKE_ENABLED_VALIDATOR);
@@ -10586,6 +10577,15 @@ public final class Settings {
          */
         public static final String ACTIVITY_MANAGER_CONSTANTS = "activity_manager_constants";
 
+        /**
+         * Feature flag to enable or disable the activity starts logging feature.
+         * Type: int (0 for false, 1 for true)
+         * Default: 0
+         * @hide
+         */
+        public static final String ACTIVITY_STARTS_LOGGING_ENABLED
+                = "activity_starts_logging_enabled";
+
         /**
          * App ops specific settings.
          * This is encoded as a key=value list, separated by commas. Ex:
diff --git a/core/java/android/service/autofill/Dataset.java b/core/java/android/service/autofill/Dataset.java
index 52117679765..f8408bedd7b 100644
--- a/core/java/android/service/autofill/Dataset.java
+++ b/core/java/android/service/autofill/Dataset.java
@@ -33,8 +33,13 @@ import java.util.ArrayList;
 import java.util.regex.Pattern;
 
 /**
- * A dataset object represents a group of fields (key / value pairs) used to autofill parts of a
- * screen.
+ * <p>A <code>Dataset</code> object represents a group of fields (key / value pairs) used
+ * to autofill parts of a screen.
+ *
+ * <p>For more information about the role of datasets in the autofill workflow, read
+ * <a href="/guide/topics/text/autofill-services">Build autofill services</a> and the
+ * <code><a href="/reference/android/service/autofill/AutofillService">AutofillService</a></code>
+ * documentation.
  *
  * <a name="BasicUsage"></a>
  * <h3>Basic usage</h3>
@@ -88,10 +93,6 @@ import java.util.regex.Pattern;
  *   <li>All other datasets are hidden.
  * </ol>
  *
- * <a name="MoreInfo"></a>
- * <h3>More information</h3>
- * <p>See {@link android.service.autofill.AutofillService} for more information and examples about
- * the role of datasets in the autofill workflow.
  */
 public final class Dataset implements Parcelable {
 
diff --git a/core/java/android/service/autofill/FillCallback.java b/core/java/android/service/autofill/FillCallback.java
index 0257891e5f3..1695c130682 100644
--- a/core/java/android/service/autofill/FillCallback.java
+++ b/core/java/android/service/autofill/FillCallback.java
@@ -21,8 +21,11 @@ import android.app.Activity;
 import android.os.RemoteException;
 
 /**
- * Handles autofill requests from the {@link AutofillService} into the {@link Activity} being
- * autofilled.
+ * <p><code>FillCallback</code> handles autofill requests from the {@link AutofillService} into
+ * the {@link Activity} being autofilled.
+ *
+ * <p>To learn about using Autofill services in your app, read
+ * <a href="/guide/topics/text/autofill-services">Build autofill services</a>.
  */
 public final class FillCallback {
     private final IFillCallback mCallback;
diff --git a/core/java/android/service/notification/Condition.java b/core/java/android/service/notification/Condition.java
index b6c6bdc00bb..5a7a83f19b0 100644
--- a/core/java/android/service/notification/Condition.java
+++ b/core/java/android/service/notification/Condition.java
@@ -151,14 +151,14 @@ public final class Condition implements Parcelable {
     @Override
     public String toString() {
         return new StringBuilder(Condition.class.getSimpleName()).append('[')
-            .append("id=").append(id)
-            .append(",summary=").append(summary)
-            .append(",line1=").append(line1)
-            .append(",line2=").append(line2)
-            .append(",icon=").append(icon)
-            .append(",state=").append(stateToString(state))
-            .append(",flags=").append(flags)
-            .append(']').toString();
+                .append("state=").append(stateToString(state))
+                .append(",id=").append(id)
+                .append(",summary=").append(summary)
+                .append(",line1=").append(line1)
+                .append(",line2=").append(line2)
+                .append(",icon=").append(icon)
+                .append(",flags=").append(flags)
+                .append(']').toString();
     }
 
     /** @hide */
diff --git a/core/java/android/service/notification/ZenModeConfig.java b/core/java/android/service/notification/ZenModeConfig.java
index 5546e803342..5edf7ce4765 100644
--- a/core/java/android/service/notification/ZenModeConfig.java
+++ b/core/java/android/service/notification/ZenModeConfig.java
@@ -240,11 +240,29 @@ public class ZenModeConfig implements Parcelable {
                 .append(",allowMessagesFrom=").append(sourceToString(allowMessagesFrom))
                 .append(",suppressedVisualEffects=").append(suppressedVisualEffects)
                 .append(",areChannelsBypassingDnd=").append(areChannelsBypassingDnd)
-                .append(",automaticRules=").append(automaticRules)
-                .append(",manualRule=").append(manualRule)
+                .append(",\nautomaticRules=").append(rulesToString())
+                .append(",\nmanualRule=").append(manualRule)
                 .append(']').toString();
     }
 
+    private String rulesToString() {
+        if (automaticRules.isEmpty()) {
+            return "{}";
+        }
+
+        StringBuilder buffer = new StringBuilder(automaticRules.size() * 28);
+        buffer.append('{');
+        for (int i = 0; i < automaticRules.size(); i++) {
+            if (i > 0) {
+                buffer.append(",\n");
+            }
+            Object value = automaticRules.valueAt(i);
+            buffer.append(value);
+        }
+        buffer.append('}');
+        return buffer.toString();
+    }
+
     private Diff diff(ZenModeConfig to) {
         final Diff d = new Diff();
         if (to == null) {
@@ -1009,10 +1027,10 @@ public class ZenModeConfig implements Parcelable {
 
     public static ScheduleInfo tryParseScheduleConditionId(Uri conditionId) {
         final boolean isSchedule =  conditionId != null
-                && conditionId.getScheme().equals(Condition.SCHEME)
-                && conditionId.getAuthority().equals(ZenModeConfig.SYSTEM_AUTHORITY)
+                && Condition.SCHEME.equals(conditionId.getScheme())
+                && ZenModeConfig.SYSTEM_AUTHORITY.equals(conditionId.getAuthority())
                 && conditionId.getPathSegments().size() == 1
-                && conditionId.getPathSegments().get(0).equals(ZenModeConfig.SCHEDULE_PATH);
+                && ZenModeConfig.SCHEDULE_PATH.equals(conditionId.getPathSegments().get(0));
         if (!isSchedule) return null;
         final int[] start = tryParseHourAndMinute(conditionId.getQueryParameter("start"));
         final int[] end = tryParseHourAndMinute(conditionId.getQueryParameter("end"));
@@ -1110,10 +1128,10 @@ public class ZenModeConfig implements Parcelable {
 
     public static EventInfo tryParseEventConditionId(Uri conditionId) {
         final boolean isEvent = conditionId != null
-                && conditionId.getScheme().equals(Condition.SCHEME)
-                && conditionId.getAuthority().equals(ZenModeConfig.SYSTEM_AUTHORITY)
+                && Condition.SCHEME.equals(conditionId.getScheme())
+                && ZenModeConfig.SYSTEM_AUTHORITY.equals(conditionId.getAuthority())
                 && conditionId.getPathSegments().size() == 1
-                && conditionId.getPathSegments().get(0).equals(EVENT_PATH);
+                && EVENT_PATH.equals(conditionId.getPathSegments().get(0));
         if (!isEvent) return null;
         final EventInfo rt = new EventInfo();
         rt.userId = tryParseInt(conditionId.getQueryParameter("userId"), UserHandle.USER_NULL);
@@ -1322,14 +1340,14 @@ public class ZenModeConfig implements Parcelable {
         @Override
         public String toString() {
             return new StringBuilder(ZenRule.class.getSimpleName()).append('[')
-                    .append("enabled=").append(enabled)
+                    .append("id=").append(id)
+                    .append(",enabled=").append(String.valueOf(enabled).toUpperCase())
                     .append(",snoozing=").append(snoozing)
                     .append(",name=").append(name)
                     .append(",zenMode=").append(Global.zenModeToString(zenMode))
                     .append(",conditionId=").append(conditionId)
                     .append(",condition=").append(condition)
                     .append(",component=").append(component)
-                    .append(",id=").append(id)
                     .append(",creationTime=").append(creationTime)
                     .append(",enabler=").append(enabler)
                     .append(']').toString();
@@ -1461,7 +1479,7 @@ public class ZenModeConfig implements Parcelable {
             final int N = lines.size();
             for (int i = 0; i < N; i++) {
                 if (i > 0) {
-                    sb.append(',');
+                    sb.append(",\n");
                 }
                 sb.append(lines.get(i));
             }
diff --git a/core/java/android/speech/tts/TextToSpeech.java b/core/java/android/speech/tts/TextToSpeech.java
index 01562b328ec..6f1bd787587 100644
--- a/core/java/android/speech/tts/TextToSpeech.java
+++ b/core/java/android/speech/tts/TextToSpeech.java
@@ -33,7 +33,6 @@ import android.os.Bundle;
 import android.os.IBinder;
 import android.os.ParcelFileDescriptor;
 import android.os.RemoteException;
-import android.provider.Settings;
 import android.text.TextUtils;
 import android.util.Log;
 
@@ -487,8 +486,9 @@ public class TextToSpeech {
          * intent. The possible values for this extra are
          * {@link TextToSpeech#SUCCESS} and {@link TextToSpeech#ERROR}.
          *
-         * @deprecated No longer in use. If client ise interested in information about what
-         * changed, is should send ACTION_CHECK_TTS_DATA intent to discover available voices.
+         * @deprecated No longer in use. If client is interested in information about what
+         * changed, it should use the ACTION_CHECK_TTS_DATA
+         * intent to discover available voices.
          */
         @Deprecated
         public static final String EXTRA_TTS_DATA_INSTALLED = "dataInstalled";
diff --git a/core/java/android/util/SparseArray.java b/core/java/android/util/SparseArray.java
index b3400ef538b..af18caa0e12 100644
--- a/core/java/android/util/SparseArray.java
+++ b/core/java/android/util/SparseArray.java
@@ -22,32 +22,34 @@ import com.android.internal.util.GrowingArrayUtils;
 import libcore.util.EmptyArray;
 
 /**
- * SparseArrays map integers to Objects.  Unlike a normal array of Objects,
- * there can be gaps in the indices.  It is intended to be more memory efficient
- * than using a HashMap to map Integers to Objects, both because it avoids
+ * <code>SparseArray</code> maps integers to Objects and, unlike a normal array of Objects,
+ * its indices can contain gaps. <code>SparseArray</code> is intended to be more memory-efficient
+ * than a
+ * <a href="/reference/java/util/HashMap"><code>HashMap</code></a>, because it avoids
  * auto-boxing keys and its data structure doesn't rely on an extra entry object
  * for each mapping.
  *
  * <p>Note that this container keeps its mappings in an array data structure,
- * using a binary search to find keys.  The implementation is not intended to be appropriate for
+ * using a binary search to find keys. The implementation is not intended to be appropriate for
  * data structures
- * that may contain large numbers of items.  It is generally slower than a traditional
- * HashMap, since lookups require a binary search and adds and removes require inserting
- * and deleting entries in the array.  For containers holding up to hundreds of items,
- * the performance difference is not significant, less than 50%.</p>
+ * that may contain large numbers of items. It is generally slower than a
+ * <code>HashMap</code> because lookups require a binary search,
+ * and adds and removes require inserting
+ * and deleting entries in the array. For containers holding up to hundreds of items,
+ * the performance difference is less than 50%.
  *
  * <p>To help with performance, the container includes an optimization when removing
  * keys: instead of compacting its array immediately, it leaves the removed entry marked
- * as deleted.  The entry can then be re-used for the same key, or compacted later in
- * a single garbage collection step of all removed entries.  This garbage collection will
- * need to be performed at any time the array needs to be grown or the the map size or
- * entry values are retrieved.</p>
+ * as deleted. The entry can then be re-used for the same key or compacted later in
+ * a single garbage collection of all removed entries. This garbage collection
+ * must be performed whenever the array needs to be grown, or when the map size or
+ * entry values are retrieved.
  *
  * <p>It is possible to iterate over the items in this container using
  * {@link #keyAt(int)} and {@link #valueAt(int)}. Iterating over the keys using
- * <code>keyAt(int)</code> with ascending values of the index will return the
- * keys in ascending order, or the values corresponding to the keys in ascending
- * order in the case of <code>valueAt(int)</code>.</p>
+ * <code>keyAt(int)</code> with ascending values of the index returns the
+ * keys in ascending order. In the case of <code>valueAt(int)</code>, the
+ * values corresponding to the keys are returned in ascending order.
  */
 public class SparseArray<E> implements Cloneable {
     private static final Object DELETED = new Object();
@@ -333,7 +335,7 @@ public class SparseArray<E> implements Cloneable {
 
     /**
      * Returns an index for which {@link #valueAt} would return the
-     * specified key, or a negative number if no keys map to the
+     * specified value, or a negative number if no keys map to the
      * specified value.
      * <p>Beware that this is a linear search, unlike lookups by key,
      * and that multiple keys can map to the same value and this will
@@ -357,7 +359,7 @@ public class SparseArray<E> implements Cloneable {
 
     /**
      * Returns an index for which {@link #valueAt} would return the
-     * specified key, or a negative number if no keys map to the
+     * specified value, or a negative number if no keys map to the
      * specified value.
      * <p>Beware that this is a linear search, unlike lookups by key,
      * and that multiple keys can map to the same value and this will
diff --git a/core/java/android/view/DisplayCutout.java b/core/java/android/view/DisplayCutout.java
index 47bda538ae5..5f80d31651a 100644
--- a/core/java/android/view/DisplayCutout.java
+++ b/core/java/android/view/DisplayCutout.java
@@ -29,6 +29,7 @@ import android.graphics.Path;
 import android.graphics.Rect;
 import android.graphics.RectF;
 import android.graphics.Region;
+import android.graphics.Region.Op;
 import android.os.Parcel;
 import android.os.Parcelable;
 import android.text.TextUtils;
@@ -324,15 +325,11 @@ public final class DisplayCutout {
      *
      * @hide
      */
+    @VisibleForTesting
     public static DisplayCutout fromBoundingRect(int left, int top, int right, int bottom) {
-        Path path = new Path();
-        path.reset();
-        path.moveTo(left, top);
-        path.lineTo(left, bottom);
-        path.lineTo(right, bottom);
-        path.lineTo(right, top);
-        path.close();
-        return fromBounds(path);
+        Region r = Region.obtain();
+        r.set(left, top, right, bottom);
+        return fromBounds(r);
     }
 
     /**
@@ -340,26 +337,19 @@ public final class DisplayCutout {
      *
      * @hide
      */
-    public static DisplayCutout fromBounds(Path path) {
-        RectF clipRect = new RectF();
-        path.computeBounds(clipRect, false /* unused */);
-        Region clipRegion = Region.obtain();
-        clipRegion.set((int) clipRect.left, (int) clipRect.top,
-                (int) clipRect.right, (int) clipRect.bottom);
-
-        Region bounds = new Region();
-        bounds.setPath(path, clipRegion);
-        clipRegion.recycle();
-        return new DisplayCutout(ZERO_RECT, bounds, false /* copyArguments */);
+    public static DisplayCutout fromBounds(Region region) {
+        return new DisplayCutout(ZERO_RECT, region, false /* copyArguments */);
     }
 
     /**
-     * Creates the bounding path according to @android:string/config_mainBuiltInDisplayCutout.
+     * Creates the display cutout according to
+     * @android:string/config_mainBuiltInDisplayCutoutRectApproximation, which is the closest
+     * rectangle-base approximation of the cutout.
      *
      * @hide
      */
-    public static DisplayCutout fromResources(Resources res, int displayWidth, int displayHeight) {
-        return fromSpec(res.getString(R.string.config_mainBuiltInDisplayCutout),
+    public static DisplayCutout fromResourcesRectApproximation(Resources res, int displayWidth, int displayHeight) {
+        return fromSpec(res.getString(R.string.config_mainBuiltInDisplayCutoutRectApproximation),
                 displayWidth, displayHeight, DENSITY_DEVICE_STABLE / (float) DENSITY_DEFAULT);
     }
 
@@ -369,7 +359,8 @@ public final class DisplayCutout {
      * @hide
      */
     public static Path pathFromResources(Resources res, int displayWidth, int displayHeight) {
-        return pathAndDisplayCutoutFromSpec(res.getString(R.string.config_mainBuiltInDisplayCutout),
+        return pathAndDisplayCutoutFromSpec(
+                res.getString(R.string.config_mainBuiltInDisplayCutout),
                 displayWidth, displayHeight, DENSITY_DEVICE_STABLE / (float) DENSITY_DEFAULT).first;
     }
 
@@ -417,6 +408,7 @@ public final class DisplayCutout {
         }
 
         final Path p;
+        final Region r = Region.obtain();
         try {
             p = PathParser.createPathFromPathData(spec);
         } catch (Throwable e) {
@@ -431,6 +423,11 @@ public final class DisplayCutout {
         m.postTranslate(offsetX, 0);
         p.transform(m);
 
+        final Rect tmpRect = new Rect();
+        toRectAndAddToRegion(p, r, tmpRect);
+        final int topInset = tmpRect.bottom;
+
+        final int bottomInset;
         if (bottomSpec != null) {
             final Path bottomPath;
             try {
@@ -443,9 +440,17 @@ public final class DisplayCutout {
             m.postTranslate(0, displayHeight);
             bottomPath.transform(m);
             p.addPath(bottomPath);
+            toRectAndAddToRegion(bottomPath, r, tmpRect);
+            bottomInset = displayHeight - tmpRect.top;
+        } else {
+            bottomInset = 0;
         }
 
-        final Pair<Path, DisplayCutout> result = new Pair<>(p, fromBounds(p));
+        // Reuse tmpRect as the inset rect we store into the DisplayCutout instance.
+        tmpRect.set(0, topInset, 0, bottomInset);
+        final DisplayCutout cutout = new DisplayCutout(tmpRect, r, false /* copyArguments */);
+
+        final Pair<Path, DisplayCutout> result = new Pair<>(p, cutout);
         synchronized (CACHE_LOCK) {
             sCachedSpec = spec;
             sCachedDisplayWidth = displayWidth;
@@ -456,6 +461,13 @@ public final class DisplayCutout {
         return result;
     }
 
+    private static void toRectAndAddToRegion(Path p, Region inoutRegion, Rect inoutRect) {
+        final RectF rectF = new RectF();
+        p.computeBounds(rectF, false /* unused */);
+        rectF.round(inoutRect);
+        inoutRegion.op(inoutRect, Op.UNION);
+    }
+
     private static Region boundingRectsToRegion(List<Rect> rects) {
         Region result = Region.obtain();
         if (rects != null) {
diff --git a/core/java/android/view/ThreadedRenderer.java b/core/java/android/view/ThreadedRenderer.java
index 5b61015e9d4..5952d782fa2 100644
--- a/core/java/android/view/ThreadedRenderer.java
+++ b/core/java/android/view/ThreadedRenderer.java
@@ -961,6 +961,10 @@ public final class ThreadedRenderer {
         nSetDebuggingEnabled(enable);
     }
 
+    void allocateBuffers(Surface surface) {
+        nAllocateBuffers(mNativeProxy, surface);
+    }
+
     @Override
     protected void finalize() throws Throwable {
         try {
@@ -1251,4 +1255,5 @@ public final class ThreadedRenderer {
     private static native void nSetDebuggingEnabled(boolean enabled);
     private static native void nSetIsolatedProcess(boolean enabled);
     private static native void nSetContextPriority(int priority);
+    private static native void nAllocateBuffers(long nativeProxy, Surface window);
 }
diff --git a/core/java/android/view/ViewRootImpl.java b/core/java/android/view/ViewRootImpl.java
index b2e53ed78e6..6df0173d968 100644
--- a/core/java/android/view/ViewRootImpl.java
+++ b/core/java/android/view/ViewRootImpl.java
@@ -1641,7 +1641,6 @@ public final class ViewRootImpl implements ViewParent,
 
     private Rect ensureInsetsNonNegative(Rect insets, String kind) {
         if (insets.left < 0  || insets.top < 0  || insets.right < 0  || insets.bottom < 0) {
-            Log.wtf(mTag, "Negative " + kind + "Insets: " + insets + ", mFirst=" + mFirst);
             return new Rect(Math.max(0, insets.left),
                     Math.max(0, insets.top),
                     Math.max(0, insets.right),
@@ -2104,7 +2103,7 @@ public final class ViewRootImpl implements ViewParent,
                                         & View.PFLAG_REQUEST_TRANSPARENT_REGIONS) == 0) {
                                     // Don't pre-allocate if transparent regions
                                     // are requested as they may not be needed
-                                    mSurface.allocateBuffers();
+                                    mAttachInfo.mThreadedRenderer.allocateBuffers(mSurface);
                                 }
                             } catch (OutOfResourcesException e) {
                                 handleOutOfResourcesException(e);
diff --git a/core/java/android/view/ViewStructure.java b/core/java/android/view/ViewStructure.java
index 3f7ab2aed4a..38dcdd30d84 100644
--- a/core/java/android/view/ViewStructure.java
+++ b/core/java/android/view/ViewStructure.java
@@ -33,9 +33,14 @@ import com.android.internal.util.Preconditions;
 import java.util.List;
 
 /**
- * Container for storing additional per-view data generated by {@link View#onProvideStructure
+ * <p><code>ViewStructure</code> is a container for storing additional
+ * per-view data generated by {@link View#onProvideStructure
  * View.onProvideStructure} and {@link View#onProvideAutofillStructure
  * View.onProvideAutofillStructure}.
+ *
+ * <p>To learn more about using Autofill in your app, read the
+ * <a href="/guide/topics/text/autofill">Autofill Framework</a> guides.
+ *
  */
 public abstract class ViewStructure {
 
diff --git a/core/java/android/view/WindowManager.java b/core/java/android/view/WindowManager.java
index 565a0d384a5..f87a3537cc5 100644
--- a/core/java/android/view/WindowManager.java
+++ b/core/java/android/view/WindowManager.java
@@ -1720,6 +1720,15 @@ public interface WindowManager extends ViewManager {
          */
         public static final int PRIVATE_FLAG_WAS_NOT_FULLSCREEN = 0x02000000;
 
+        /**
+         * Flag to indicate that the status bar window is now in an explicit expanded state, meaning
+         * that status bar will not be hidden by any window with flag {@link #FLAG_FULLSCREEN} or
+         * {@link View#SYSTEM_UI_FLAG_FULLSCREEN} set.
+         * This can only be set by {@link LayoutParams#TYPE_STATUS_BAR}.
+         * @hide
+         */
+        public static final int PRIVATE_FLAG_STATUS_BAR_EXPANDED = 0x00800000;
+
         /**
          * Window flag: Overrides default power key behavior
         /**
@@ -1810,7 +1819,11 @@ public interface WindowManager extends ViewManager {
                 @ViewDebug.FlagToString(
                         mask = PRIVATE_FLAG_IS_SCREEN_DECOR,
                         equals = PRIVATE_FLAG_IS_SCREEN_DECOR,
-                        name = "IS_SCREEN_DECOR")
+                        name = "IS_SCREEN_DECOR"),
+                @ViewDebug.FlagToString(
+                        mask = PRIVATE_FLAG_STATUS_BAR_EXPANDED,
+                        equals = PRIVATE_FLAG_STATUS_BAR_EXPANDED,
+                        name = "STATUS_BAR_EXPANDED")
         })
         @TestApi
         public int privateFlags;
diff --git a/core/java/android/view/accessibility/AccessibilityRecord.java b/core/java/android/view/accessibility/AccessibilityRecord.java
index 0a709f8f52d..c2ddc927b04 100644
--- a/core/java/android/view/accessibility/AccessibilityRecord.java
+++ b/core/java/android/view/accessibility/AccessibilityRecord.java
@@ -625,7 +625,7 @@ public class AccessibilityRecord {
     }
 
     /**
-     * Sets the text before a change.
+     * Gets the text before a change.
      *
      * @return The text before the change.
      */
diff --git a/core/java/android/view/autofill/AutofillManager.java b/core/java/android/view/autofill/AutofillManager.java
index 7555ffff3e3..d21cb3e64b8 100644
--- a/core/java/android/view/autofill/AutofillManager.java
+++ b/core/java/android/view/autofill/AutofillManager.java
@@ -77,11 +77,16 @@ import java.util.Objects;
 import sun.misc.Cleaner;
 
 /**
- * The {@link AutofillManager} provides ways for apps and custom views to integrate with the
- * Autofill Framework lifecycle.
+ * <p>The {@link AutofillManager} class provides ways for apps and custom views to
+ * integrate with the Autofill Framework lifecycle.
+ *
+ * <p>To learn about using Autofill in your app, read
+ * the <a href="/guide/topics/text/autofill">Autofill Framework</a> guides.
+ *
+ * <h3 id="autofill-lifecycle">Autofill lifecycle</h3>
  *
  * <p>The autofill lifecycle starts with the creation of an autofill context associated with an
- * activity context; the autofill context is created when one of the following methods is called for
+ * activity context. The autofill context is created when one of the following methods is called for
  * the first time in an activity context, and the current user has an enabled autofill service:
  *
  * <ul>
@@ -90,7 +95,7 @@ import sun.misc.Cleaner;
  *   <li>{@link #requestAutofill(View)}
  * </ul>
  *
- * <p>Tipically, the context is automatically created when the first view of the activity is
+ * <p>Typically, the context is automatically created when the first view of the activity is
  * focused because {@code View.onFocusChanged()} indirectly calls
  * {@link #notifyViewEntered(View)}. App developers can call {@link #requestAutofill(View)} to
  * explicitly create it (for example, a custom view developer could offer a contextual menu action
@@ -134,7 +139,9 @@ import sun.misc.Cleaner;
  * shows an autofill save UI if the value of savable views have changed. If the user selects the
  * option to Save, the current value of the views is then sent to the autofill service.
  *
- * <p>It is safe to call into its methods from any thread.
+ * <h3 id="additional-notes">Additional notes</h3>
+ *
+ * <p>It is safe to call <code>AutofillManager</code> methods from any thread.
  */
 @SystemService(Context.AUTOFILL_MANAGER_SERVICE)
 @RequiresFeature(PackageManager.FEATURE_AUTOFILL)
@@ -2138,7 +2145,11 @@ public final class AutofillManager {
         pw.print(pfx); pw.print("sessionId: "); pw.println(mSessionId);
         pw.print(pfx); pw.print("state: "); pw.println(getStateAsStringLocked());
         pw.print(pfx); pw.print("context: "); pw.println(mContext);
-        pw.print(pfx); pw.print("client: "); pw.println(getClient());
+        final AutofillClient client = getClient();
+        if (client != null) {
+            pw.print(pfx); pw.print("client: "); pw.print(client);
+            pw.print(" ("); pw.print(client.autofillClientGetActivityToken()); pw.println(')');
+        }
         pw.print(pfx); pw.print("enabled: "); pw.println(mEnabled);
         pw.print(pfx); pw.print("hasService: "); pw.println(mService != null);
         pw.print(pfx); pw.print("hasCallback: "); pw.println(mCallback != null);
@@ -2157,8 +2168,24 @@ public final class AutofillManager {
         pw.print(pfx); pw.print("entered ids: "); pw.println(mEnteredIds);
         pw.print(pfx); pw.print("save trigger id: "); pw.println(mSaveTriggerId);
         pw.print(pfx); pw.print("save on finish(): "); pw.println(mSaveOnFinish);
-        pw.print(pfx); pw.print("compat mode enabled: "); pw.println(
-                isCompatibilityModeEnabledLocked());
+        pw.print(pfx); pw.print("compat mode enabled: ");
+        synchronized (mLock) {
+            if (mCompatibilityBridge != null) {
+                final String pfx2 = pfx + "  ";
+                pw.println("true");
+                pw.print(pfx2); pw.print("windowId: ");
+                pw.println(mCompatibilityBridge.mFocusedWindowId);
+                pw.print(pfx2); pw.print("nodeId: ");
+                pw.println(mCompatibilityBridge.mFocusedNodeId);
+                pw.print(pfx2); pw.print("virtualId: ");
+                pw.println(AccessibilityNodeInfo
+                        .getVirtualDescendantId(mCompatibilityBridge.mFocusedNodeId));
+                pw.print(pfx2); pw.print("focusedBounds: ");
+                pw.println(mCompatibilityBridge.mFocusedBounds);
+            } else {
+                pw.println("false");
+            }
+        }
         pw.print(pfx); pw.print("debug: "); pw.print(sDebug);
         pw.print(" verbose: "); pw.println(sVerbose);
     }
@@ -2292,7 +2319,15 @@ public final class AutofillManager {
         @Override
         public AccessibilityEvent onAccessibilityEvent(AccessibilityEvent event,
                 boolean accessibilityEnabled, int relevantEventTypes) {
-            switch (event.getEventType()) {
+            final int type = event.getEventType();
+            if (sVerbose) {
+                // NOTE: this is waaay spammy, but that's life.
+                Log.v(TAG, "onAccessibilityEvent(" + AccessibilityEvent.eventTypeToString(type)
+                        + "): virtualId="
+                        + AccessibilityNodeInfo.getVirtualDescendantId(event.getSourceNodeId())
+                        + ", client=" + getClient());
+            }
+            switch (type) {
                 case AccessibilityEvent.TYPE_VIEW_FOCUSED: {
                     synchronized (mLock) {
                         if (mFocusedWindowId == event.getWindowId()
diff --git a/core/java/android/webkit/WebBackForwardList.java b/core/java/android/webkit/WebBackForwardList.java
index 0c34e3c16ac..4d3bbe47592 100644
--- a/core/java/android/webkit/WebBackForwardList.java
+++ b/core/java/android/webkit/WebBackForwardList.java
@@ -57,7 +57,8 @@ public abstract class WebBackForwardList implements Cloneable, Serializable {
     /**
      * Clone the entire object to be used in the UI thread by clients of
      * WebView. This creates a copy that should never be modified by any of the
-     * webkit package classes.
+     * webkit package classes. On Android 4.4 and later there is no need to use
+     * this, as the object is already a read-only copy of the internal state.
      */
     protected abstract WebBackForwardList clone();
 }
diff --git a/core/java/android/webkit/WebHistoryItem.java b/core/java/android/webkit/WebHistoryItem.java
index 74db039e015..b9e704285f8 100644
--- a/core/java/android/webkit/WebHistoryItem.java
+++ b/core/java/android/webkit/WebHistoryItem.java
@@ -23,7 +23,7 @@ import android.graphics.Bitmap;
 /**
  * A convenience class for accessing fields in an entry in the back/forward list
  * of a WebView. Each WebHistoryItem is a snapshot of the requested history
- * item. Each history item may be updated during the load of a page.
+ * item.
  * @see WebBackForwardList
  */
 public abstract class WebHistoryItem implements Cloneable {
@@ -44,8 +44,6 @@ public abstract class WebHistoryItem implements Cloneable {
      * history item. See getTargetUrl() for the url that is the actual target of
      * this history item.
      * @return The base url of this history item.
-     * Note: The VM ensures 32-bit atomic read/write operations so we don't have
-     * to synchronize this method.
      */
     public abstract String getUrl();
 
@@ -60,22 +58,20 @@ public abstract class WebHistoryItem implements Cloneable {
     /**
      * Return the document title of this history item.
      * @return The document title of this history item.
-     * Note: The VM ensures 32-bit atomic read/write operations so we don't have
-     * to synchronize this method.
      */
     public abstract String getTitle();
 
     /**
      * Return the favicon of this history item or {@code null} if no favicon was found.
      * @return A Bitmap containing the favicon for this history item or {@code null}.
-     * Note: The VM ensures 32-bit atomic read/write operations so we don't have
-     * to synchronize this method.
      */
     @Nullable
     public abstract Bitmap getFavicon();
 
     /**
-     * Clone the history item for use by clients of WebView.
+     * Clone the history item for use by clients of WebView. On Android 4.4 and later
+     * there is no need to use this, as the object is already a read-only copy of the
+     * internal state.
      */
     protected abstract WebHistoryItem clone();
 }
diff --git a/core/java/android/webkit/WebSettings.java b/core/java/android/webkit/WebSettings.java
index cba11a84e9e..a08539566a1 100644
--- a/core/java/android/webkit/WebSettings.java
+++ b/core/java/android/webkit/WebSettings.java
@@ -987,7 +987,9 @@ public abstract class WebSettings {
      * {@link PluginState#OFF}.
      *
      * @param state a PluginState value
-     * @deprecated Plugins will not be supported in future, and should not be used.
+     * @deprecated Plugins are not supported in API level
+     *             {@link android.os.Build.VERSION_CODES#KITKAT} or later;
+     *             enabling plugins is a no-op.
      */
     @Deprecated
     public abstract void setPluginState(PluginState state);
@@ -1182,7 +1184,9 @@ public abstract class WebSettings {
      *
      * @return the plugin state as a {@link PluginState} value
      * @see #setPluginState
-     * @deprecated Plugins will not be supported in future, and should not be used.
+     * @deprecated Plugins are not supported in API level
+     *             {@link android.os.Build.VERSION_CODES#KITKAT} or later;
+     *             enabling plugins is a no-op.
      */
     @Deprecated
     public abstract PluginState getPluginState();
diff --git a/core/java/android/webkit/WebView.java b/core/java/android/webkit/WebView.java
index fc883c33bba..94288a934c6 100644
--- a/core/java/android/webkit/WebView.java
+++ b/core/java/android/webkit/WebView.java
@@ -42,7 +42,6 @@ import android.os.Message;
 import android.os.RemoteException;
 import android.os.StrictMode;
 import android.print.PrintDocumentAdapter;
-import android.security.KeyChain;
 import android.util.AttributeSet;
 import android.util.Log;
 import android.util.SparseArray;
@@ -74,280 +73,25 @@ import java.util.List;
 import java.util.Map;
 
 /**
- * <p>A View that displays web pages. This class is the basis upon which you
- * can roll your own web browser or simply display some online content within your Activity.
- * It uses the WebKit rendering engine to display
- * web pages and includes methods to navigate forward and backward
- * through a history, zoom in and out, perform text searches and more.
- *
- * <p>Note that, in order for your Activity to access the Internet and load web pages
- * in a WebView, you must add the {@code INTERNET} permissions to your
- * Android Manifest file:
- *
- * <pre>
- * {@code <uses-permission android:name="android.permission.INTERNET" />}
- * </pre>
- *
- * <p>This must be a child of the <a
- * href="{@docRoot}guide/topics/manifest/manifest-element.html">{@code <manifest>}</a>
- * element.
- *
- * <p>For more information, read
- * <a href="{@docRoot}guide/webapps/webview.html">Building Web Apps in WebView</a>.
+ * A View that displays web pages.
  *
  * <h3>Basic usage</h3>
  *
- * <p>By default, a WebView provides no browser-like widgets, does not
- * enable JavaScript and web page errors are ignored. If your goal is only
- * to display some HTML as a part of your UI, this is probably fine;
- * the user won't need to interact with the web page beyond reading
- * it, and the web page won't need to interact with the user. If you
- * actually want a full-blown web browser, then you probably want to
- * invoke the Browser application with a URL Intent rather than show it
- * with a WebView. For example:
- * <pre>
- * Uri uri = Uri.parse("https://www.example.com");
- * Intent intent = new Intent(Intent.ACTION_VIEW, uri);
- * startActivity(intent);
- * </pre>
- * <p>See {@link android.content.Intent} for more information.
- *
- * <p>To provide a WebView in your own Activity, include a {@code <WebView>} in your layout,
- * or set the entire Activity window as a WebView during {@link
- * android.app.Activity#onCreate(Bundle) onCreate()}:
- *
- * <pre class="prettyprint">
- * WebView webview = new WebView(this);
- * setContentView(webview);
- * </pre>
- *
- * <p>Then load the desired web page:
- *
- * <pre>
- * // Simplest usage: note that an exception will NOT be thrown
- * // if there is an error loading this page (see below).
- * webview.loadUrl("https://example.com/");
- *
- * // OR, you can also load from an HTML string:
- * String summary = "&lt;html>&lt;body>You scored &lt;b>192&lt;/b> points.&lt;/body>&lt;/html>";
- * webview.loadData(summary, "text/html", null);
- * // ... although note that there are restrictions on what this HTML can do.
- * // See {@link #loadData(String,String,String)} and {@link
- * #loadDataWithBaseURL(String,String,String,String,String)} for more info.
- * // Also see {@link #loadData(String,String,String)} for information on encoding special
- * // characters.
- * </pre>
- *
- * <p>A WebView has several customization points where you can add your
- * own behavior. These are:
- *
- * <ul>
- *   <li>Creating and setting a {@link android.webkit.WebChromeClient} subclass.
- *       This class is called when something that might impact a
- *       browser UI happens, for instance, progress updates and
- *       JavaScript alerts are sent here (see <a
- * href="{@docRoot}guide/developing/debug-tasks.html#DebuggingWebPages">Debugging Tasks</a>).
- *   </li>
- *   <li>Creating and setting a {@link android.webkit.WebViewClient} subclass.
- *       It will be called when things happen that impact the
- *       rendering of the content, eg, errors or form submissions. You
- *       can also intercept URL loading here (via {@link
- * android.webkit.WebViewClient#shouldOverrideUrlLoading(WebView,String)
- * shouldOverrideUrlLoading()}).</li>
- *   <li>Modifying the {@link android.webkit.WebSettings}, such as
- * enabling JavaScript with {@link android.webkit.WebSettings#setJavaScriptEnabled(boolean)
- * setJavaScriptEnabled()}. </li>
- *   <li>Injecting Java objects into the WebView using the
- *       {@link android.webkit.WebView#addJavascriptInterface} method. This
- *       method allows you to inject Java objects into a page's JavaScript
- *       context, so that they can be accessed by JavaScript in the page.</li>
- * </ul>
- *
- * <p>Here's a more complicated example, showing error handling,
- *    settings, and progress notification:
- *
- * <pre class="prettyprint">
- * // Let's display the progress in the activity title bar, like the
- * // browser app does.
- * getWindow().requestFeature(Window.FEATURE_PROGRESS);
- *
- * webview.getSettings().setJavaScriptEnabled(true);
- *
- * final Activity activity = this;
- * webview.setWebChromeClient(new WebChromeClient() {
- *   public void onProgressChanged(WebView view, int progress) {
- *     // Activities and WebViews measure progress with different scales.
- *     // The progress meter will automatically disappear when we reach 100%
- *     activity.setProgress(progress * 1000);
- *   }
- * });
- * webview.setWebViewClient(new WebViewClient() {
- *   public void onReceivedError(WebView view, int errorCode, String description, String failingUrl) {
- *     Toast.makeText(activity, "Oh no! " + description, Toast.LENGTH_SHORT).show();
- *   }
- * });
- *
- * webview.loadUrl("https://developer.android.com/");
- * </pre>
- *
- * <h3>Zoom</h3>
- *
- * <p>To enable the built-in zoom, set
- * {@link #getSettings() WebSettings}.{@link WebSettings#setBuiltInZoomControls(boolean)}
- * (introduced in API level {@link android.os.Build.VERSION_CODES#CUPCAKE}).
- *
- * <p class="note"><b>Note:</b> Using zoom if either the height or width is set to
- * {@link android.view.ViewGroup.LayoutParams#WRAP_CONTENT} may lead to undefined behavior
- * and should be avoided.
- *
- * <h3>Cookie and window management</h3>
- *
- * <p>For obvious security reasons, your application has its own
- * cache, cookie store etc.&mdash;it does not share the Browser
- * application's data.
- *
- * <p>By default, requests by the HTML to open new windows are
- * ignored. This is {@code true} whether they be opened by JavaScript or by
- * the target attribute on a link. You can customize your
- * {@link WebChromeClient} to provide your own behavior for opening multiple windows,
- * and render them in whatever manner you want.
- *
- * <p>The standard behavior for an Activity is to be destroyed and
- * recreated when the device orientation or any other configuration changes. This will cause
- * the WebView to reload the current page. If you don't want that, you
- * can set your Activity to handle the {@code orientation} and {@code keyboardHidden}
- * changes, and then just leave the WebView alone. It'll automatically
- * re-orient itself as appropriate. Read <a
- * href="{@docRoot}guide/topics/resources/runtime-changes.html">Handling Runtime Changes</a> for
- * more information about how to handle configuration changes during runtime.
- *
- *
- * <h3>Building web pages to support different screen densities</h3>
- *
- * <p>The screen density of a device is based on the screen resolution. A screen with low density
- * has fewer available pixels per inch, where a screen with high density
- * has more &mdash; sometimes significantly more &mdash; pixels per inch. The density of a
- * screen is important because, other things being equal, a UI element (such as a button) whose
- * height and width are defined in terms of screen pixels will appear larger on the lower density
- * screen and smaller on the higher density screen.
- * For simplicity, Android collapses all actual screen densities into three generalized densities:
- * high, medium, and low.
- * <p>By default, WebView scales a web page so that it is drawn at a size that matches the default
- * appearance on a medium density screen. So, it applies 1.5x scaling on a high density screen
- * (because its pixels are smaller) and 0.75x scaling on a low density screen (because its pixels
- * are bigger).
- * Starting with API level {@link android.os.Build.VERSION_CODES#ECLAIR}, WebView supports DOM, CSS,
- * and meta tag features to help you (as a web developer) target screens with different screen
- * densities.
- * <p>Here's a summary of the features you can use to handle different screen densities:
- * <ul>
- * <li>The {@code window.devicePixelRatio} DOM property. The value of this property specifies the
- * default scaling factor used for the current device. For example, if the value of {@code
- * window.devicePixelRatio} is "1.0", then the device is considered a medium density (mdpi) device
- * and default scaling is not applied to the web page; if the value is "1.5", then the device is
- * considered a high density device (hdpi) and the page content is scaled 1.5x; if the
- * value is "0.75", then the device is considered a low density device (ldpi) and the content is
- * scaled 0.75x.</li>
- * <li>The {@code -webkit-device-pixel-ratio} CSS media query. Use this to specify the screen
- * densities for which this style sheet is to be used. The corresponding value should be either
- * "0.75", "1", or "1.5", to indicate that the styles are for devices with low density, medium
- * density, or high density screens, respectively. For example:
- * <pre>
- * &lt;link rel="stylesheet" media="screen and (-webkit-device-pixel-ratio:1.5)" href="hdpi.css" /&gt;</pre>
- * <p>The {@code hdpi.css} stylesheet is only used for devices with a screen pixel ratio of 1.5,
- * which is the high density pixel ratio.
- * </li>
- * </ul>
- *
- * <h3>HTML5 Video support</h3>
- *
- * <p>In order to support inline HTML5 video in your application you need to have hardware
- * acceleration turned on.
- *
- * <h3>Full screen support</h3>
- *
- * <p>In order to support full screen &mdash; for video or other HTML content &mdash; you need to set a
- * {@link android.webkit.WebChromeClient} and implement both
- * {@link WebChromeClient#onShowCustomView(View, WebChromeClient.CustomViewCallback)}
- * and {@link WebChromeClient#onHideCustomView()}. If the implementation of either of these two methods is
- * missing then the web contents will not be allowed to enter full screen. Optionally you can implement
- * {@link WebChromeClient#getVideoLoadingProgressView()} to customize the View displayed whilst a video
- * is loading.
- *
- * <h3>HTML5 Geolocation API support</h3>
- *
- * <p>For applications targeting Android N and later releases
- * (API level > {@link android.os.Build.VERSION_CODES#M}) the geolocation api is only supported on
- * secure origins such as https. For such applications requests to geolocation api on non-secure
- * origins are automatically denied without invoking the corresponding
- * {@link WebChromeClient#onGeolocationPermissionsShowPrompt(String, GeolocationPermissions.Callback)}
- * method.
- *
- * <h3>Layout size</h3>
- * <p>
- * It is recommended to set the WebView layout height to a fixed value or to
- * {@link android.view.ViewGroup.LayoutParams#MATCH_PARENT} instead of using
- * {@link android.view.ViewGroup.LayoutParams#WRAP_CONTENT}.
- * When using {@link android.view.ViewGroup.LayoutParams#MATCH_PARENT}
- * for the height none of the WebView's parents should use a
- * {@link android.view.ViewGroup.LayoutParams#WRAP_CONTENT} layout height since that could result in
- * incorrect sizing of the views.
- *
- * <p>Setting the WebView's height to {@link android.view.ViewGroup.LayoutParams#WRAP_CONTENT}
- * enables the following behaviors:
- * <ul>
- * <li>The HTML body layout height is set to a fixed value. This means that elements with a height
- * relative to the HTML body may not be sized correctly. </li>
- * <li>For applications targeting {@link android.os.Build.VERSION_CODES#KITKAT} and earlier SDKs the
- * HTML viewport meta tag will be ignored in order to preserve backwards compatibility. </li>
- * </ul>
- *
- * <p>
- * Using a layout width of {@link android.view.ViewGroup.LayoutParams#WRAP_CONTENT} is not
- * supported. If such a width is used the WebView will attempt to use the width of the parent
- * instead.
- *
- * <h3>Metrics</h3>
- *
- * <p>
- * WebView may upload anonymous diagnostic data to Google when the user has consented. This data
- * helps Google improve WebView. Data is collected on a per-app basis for each app which has
- * instantiated a WebView. An individual app can opt out of this feature by putting the following
- * tag in its manifest's {@code <application>} element:
- * <pre>
- * &lt;manifest&gt;
- *     &lt;application&gt;
- *         ...
- *         &lt;meta-data android:name=&quot;android.webkit.WebView.MetricsOptOut&quot;
- *             android:value=&quot;true&quot; /&gt;
- *     &lt;/application&gt;
- * &lt;/manifest&gt;
- * </pre>
- * <p>
- * Data will only be uploaded for a given app if the user has consented AND the app has not opted
- * out.
  *
- * <h3>Safe Browsing</h3>
+ * <p>In most cases, we recommend using a standard web browser, like Chrome, to deliver
+ * content to the user. To learn more about web browsers, read the guide on
+ * <a href="/guide/components/intents-common#Browser">
+ * invoking a browser with an intent</a>.
  *
- * <p>
- * With Safe Browsing, WebView will block malicious URLs and present a warning UI to the user to
- * allow them to navigate back safely or proceed to the malicious page.
- * <p>
- * Safe Browsing is enabled by default on devices which support it. If your app needs to disable
- * Safe Browsing for all WebViews, it can do so in the manifest's {@code <application>} element:
- * <p>
- * <pre>
- * &lt;manifest&gt;
- *     &lt;application&gt;
- *         ...
- *         &lt;meta-data android:name=&quot;android.webkit.WebView.EnableSafeBrowsing&quot;
- *             android:value=&quot;false&quot; /&gt;
- *     &lt;/application&gt;
- * &lt;/manifest&gt;
- * </pre>
+ * <p>WebView objects allow you to display web content as part of your activity layout, but
+ * lack some of the features of fully-developed browsers. A WebView is useful when
+ * you need increased control over the UI and advanced configuration options that will allow
+ * you to embed web pages in a specially-designed environment for your app.
  *
- * <p>
- * Otherwise, see {@link WebSettings#setSafeBrowsingEnabled}.
+ * <p>To learn more about WebView and alternatives for serving web content, read the
+ * documentation on
+ * <a href="/guide/webapps/">
+ * Web-based content</a>.
  *
  */
 // Implementation notes.
@@ -1717,9 +1461,8 @@ public class WebView extends AbsoluteLayout
     /**
      * Clears the client certificate preferences stored in response
      * to proceeding/cancelling client cert requests. Note that WebView
-     * automatically clears these preferences when it receives a
-     * {@link KeyChain#ACTION_STORAGE_CHANGED} intent. The preferences are
-     * shared by all the WebViews that are created by the embedder application.
+     * automatically clears these preferences when the system keychain is updated.
+     * The preferences are shared by all the WebViews that are created by the embedder application.
      *
      * @param onCleared  A runnable to be invoked when client certs are cleared.
      *                   The runnable will be called in UI thread.
diff --git a/core/java/android/webkit/WebViewClient.java b/core/java/android/webkit/WebViewClient.java
index f686b664565..bdd7a090021 100644
--- a/core/java/android/webkit/WebViewClient.java
+++ b/core/java/android/webkit/WebViewClient.java
@@ -31,18 +31,25 @@ import java.lang.annotation.RetentionPolicy;
 public class WebViewClient {
 
     /**
-     * Give the host application a chance to take over the control when a new
-     * url is about to be loaded in the current WebView. If WebViewClient is not
-     * provided, by default WebView will ask Activity Manager to choose the
-     * proper handler for the url. If WebViewClient is provided, return {@code true}
-     * means the host application handles the url, while return {@code false} means the
-     * current WebView handles the url.
-     * This method is not called for requests using the POST "method".
+     * Give the host application a chance to take control when a URL is about to be loaded in the
+     * current WebView. If a WebViewClient is not provided, by default WebView will ask Activity
+     * Manager to choose the proper handler for the URL. If a WebViewClient is provided, returning
+     * {@code true} causes the current WebView to abort loading the URL, while returning
+     * {@code false} causes the WebView to continue loading the URL as usual.
+     *
+     * <p class="note"><b>Note:</b> Do not call {@link WebView#loadUrl(String)} with the same
+     * URL and then return {@code true}. This unnecessarily cancels the current load and starts a
+     * new load with the same URL. The correct way to continue loading a given URL is to simply
+     * return {@code false}, without calling {@link WebView#loadUrl(String)}.
+     *
+     * <p class="note"><b>Note:</b> This method is not called for POST requests.
+     *
+     * <p class="note"><b>Note:</b> This method may be called for subframes and with non-HTTP(S)
+     * schemes; calling {@link WebView#loadUrl(String)} with such a URL will fail.
      *
      * @param view The WebView that is initiating the callback.
-     * @param url The url to be loaded.
-     * @return {@code true} if the host application wants to leave the current WebView
-     *         and handle the url itself, otherwise return {@code false}.
+     * @param url The URL to be loaded.
+     * @return {@code true} to cancel the current load, otherwise return {@code false}.
      * @deprecated Use {@link #shouldOverrideUrlLoading(WebView, WebResourceRequest)
      *             shouldOverrideUrlLoading(WebView, WebResourceRequest)} instead.
      */
@@ -52,26 +59,25 @@ public class WebViewClient {
     }
 
     /**
-     * Give the host application a chance to take over the control when a new
-     * url is about to be loaded in the current WebView. If WebViewClient is not
-     * provided, by default WebView will ask Activity Manager to choose the
-     * proper handler for the url. If WebViewClient is provided, return {@code true}
-     * means the host application handles the url, while return {@code false} means the
-     * current WebView handles the url.
-     *
-     * <p>Notes:
-     * <ul>
-     * <li>This method is not called for requests using the POST &quot;method&quot;.</li>
-     * <li>This method is also called for subframes with non-http schemes, thus it is
-     * strongly disadvised to unconditionally call {@link WebView#loadUrl(String)}
-     * with the request's url from inside the method and then return {@code true},
-     * as this will make WebView to attempt loading a non-http url, and thus fail.</li>
-     * </ul>
+     * Give the host application a chance to take control when a URL is about to be loaded in the
+     * current WebView. If a WebViewClient is not provided, by default WebView will ask Activity
+     * Manager to choose the proper handler for the URL. If a WebViewClient is provided, returning
+     * {@code true} causes the current WebView to abort loading the URL, while returning
+     * {@code false} causes the WebView to continue loading the URL as usual.
+     *
+     * <p class="note"><b>Note:</b> Do not call {@link WebView#loadUrl(String)} with the request's
+     * URL and then return {@code true}. This unnecessarily cancels the current load and starts a
+     * new load with the same URL. The correct way to continue loading a given URL is to simply
+     * return {@code false}, without calling {@link WebView#loadUrl(String)}.
+     *
+     * <p class="note"><b>Note:</b> This method is not called for POST requests.
+     *
+     * <p class="note"><b>Note:</b> This method may be called for subframes and with non-HTTP(S)
+     * schemes; calling {@link WebView#loadUrl(String)} with such a URL will fail.
      *
      * @param view The WebView that is initiating the callback.
      * @param request Object containing the details of the request.
-     * @return {@code true} if the host application wants to leave the current WebView
-     *         and handle the url itself, otherwise return {@code false}.
+     * @return {@code true} to cancel the current load, otherwise return {@code false}.
      */
     public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {
         return shouldOverrideUrlLoading(view, request.getUrl().toString());
diff --git a/core/java/android/widget/AbsListView.java b/core/java/android/widget/AbsListView.java
index 298c61e403a..6238e169e9e 100644
--- a/core/java/android/widget/AbsListView.java
+++ b/core/java/android/widget/AbsListView.java
@@ -781,7 +781,7 @@ public abstract class AbsListView extends AdapterView<ListAdapter> implements Te
          * @param firstVisibleItem the index of the first visible cell (ignore if
          *        visibleItemCount == 0)
          * @param visibleItemCount the number of visible cells
-         * @param totalItemCount the number of items in the list adaptor
+         * @param totalItemCount the number of items in the list adapter
          */
         public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount,
                 int totalItemCount);
diff --git a/core/java/android/widget/AdapterView.java b/core/java/android/widget/AdapterView.java
index 6c192563658..4e77f0bf59b 100644
--- a/core/java/android/widget/AdapterView.java
+++ b/core/java/android/widget/AdapterView.java
@@ -293,7 +293,7 @@ public abstract class AdapterView<T extends Adapter> extends ViewGroup {
 
     /**
      * @return The callback to be invoked with an item in this AdapterView has
-     *         been clicked, or null id no callback has been set.
+     *         been clicked, or null if no callback has been set.
      */
     @Nullable
     public final OnItemClickListener getOnItemClickListener() {
@@ -365,7 +365,7 @@ public abstract class AdapterView<T extends Adapter> extends ViewGroup {
 
     /**
      * @return The callback to be invoked with an item in this AdapterView has
-     *         been clicked and held, or null id no callback as been set.
+     *         been clicked and held, or null if no callback has been set.
      */
     public final OnItemLongClickListener getOnItemLongClickListener() {
         return mOnItemLongClickListener;
diff --git a/core/java/android/widget/ImageView.java b/core/java/android/widget/ImageView.java
index 13729874d36..67b7100ab9b 100644
--- a/core/java/android/widget/ImageView.java
+++ b/core/java/android/widget/ImageView.java
@@ -80,7 +80,7 @@ import java.io.IOException;
  *
  * <p>
  * To learn more about Drawables, see: <a href="{@docRoot}guide/topics/resources/drawable-resource.html">Drawable Resources</a>.
- * To learn more about working with Bitmaps, see: <a href="{@docRoot}topic/performance/graphics/index.htm">Handling Bitmaps</a>.
+ * To learn more about working with Bitmaps, see: <a href="{@docRoot}topic/performance/graphics/index.html">Handling Bitmaps</a>.
  * </p>
  *
  * @attr ref android.R.styleable#ImageView_adjustViewBounds
diff --git a/core/java/com/android/internal/app/IntentForwarderActivity.java b/core/java/com/android/internal/app/IntentForwarderActivity.java
index 398d08791b5..4728124c17c 100644
--- a/core/java/com/android/internal/app/IntentForwarderActivity.java
+++ b/core/java/com/android/internal/app/IntentForwarderActivity.java
@@ -16,14 +16,21 @@
 
 package com.android.internal.app;
 
+import static android.content.pm.PackageManager.MATCH_DEFAULT_ONLY;
+
+import android.annotation.Nullable;
+import android.annotation.StringRes;
 import android.app.Activity;
 import android.app.ActivityManager;
 import android.app.ActivityThread;
 import android.app.AppGlobals;
 import android.app.admin.DevicePolicyManager;
 import android.content.Intent;
+import android.content.pm.ActivityInfo;
+import android.content.pm.ApplicationInfo;
 import android.content.pm.IPackageManager;
 import android.content.pm.PackageManager;
+import android.content.pm.ResolveInfo;
 import android.content.pm.UserInfo;
 import android.os.Bundle;
 import android.os.RemoteException;
@@ -31,12 +38,11 @@ import android.os.UserHandle;
 import android.os.UserManager;
 import android.util.Slog;
 import android.widget.Toast;
-
 import com.android.internal.annotations.VisibleForTesting;
-
+import java.util.Arrays;
+import java.util.HashSet;
 import java.util.List;
-
-import static android.content.pm.PackageManager.MATCH_DEFAULT_ONLY;
+import java.util.Set;
 
 /**
  * This is used in conjunction with
@@ -44,7 +50,6 @@ import static android.content.pm.PackageManager.MATCH_DEFAULT_ONLY;
  * be passed in and out of a managed profile.
  */
 public class IntentForwarderActivity extends Activity  {
-
     public static String TAG = "IntentForwarderActivity";
 
     public static String FORWARD_INTENT_TO_PARENT
@@ -53,6 +58,9 @@ public class IntentForwarderActivity extends Activity  {
     public static String FORWARD_INTENT_TO_MANAGED_PROFILE
             = "com.android.internal.app.ForwardIntentToManagedProfile";
 
+    private static final Set<String> ALLOWED_TEXT_MESSAGE_SCHEME
+            = new HashSet<>(Arrays.asList("sms", "smsto", "mms", "mmsto"));
+
     private Injector mInjector;
 
     @Override
@@ -93,19 +101,8 @@ public class IntentForwarderActivity extends Activity  {
                 newIntent.prepareToLeaveUser(callingUserId);
             }
 
-            final android.content.pm.ResolveInfo ri =
-                    mInjector.getPackageManager().resolveActivityAsUser(
-                            newIntent,
-                            MATCH_DEFAULT_ONLY,
-                            targetUserId);
-
-            // Don't show the disclosure if next activity is ResolverActivity or ChooserActivity
-            // as those will already have shown work / personal as neccesary etc.
-            final boolean shouldShowDisclosure = ri == null || ri.activityInfo == null ||
-                    !"android".equals(ri.activityInfo.packageName) ||
-                    !(ResolverActivity.class.getName().equals(ri.activityInfo.name)
-                            || ChooserActivity.class.getName().equals(ri.activityInfo.name));
-
+            final ResolveInfo ri = mInjector.resolveActivityAsUser(newIntent, MATCH_DEFAULT_ONLY,
+                    targetUserId);
             try {
                 startActivityAsCaller(newIntent, null, false, targetUserId);
             } catch (RuntimeException e) {
@@ -124,8 +121,8 @@ public class IntentForwarderActivity extends Activity  {
                         + ActivityThread.currentProcessName(), e);
             }
 
-            if (shouldShowDisclosure) {
-                Toast.makeText(this, getString(userMessageId), Toast.LENGTH_LONG).show();
+            if (shouldShowDisclosure(ri, intentReceived)) {
+                mInjector.showToast(userMessageId, Toast.LENGTH_LONG);
             }
         } else {
             Slog.wtf(TAG, "the intent: " + intentReceived + " cannot be forwarded from user "
@@ -134,6 +131,35 @@ public class IntentForwarderActivity extends Activity  {
         finish();
     }
 
+    private boolean shouldShowDisclosure(@Nullable ResolveInfo ri, Intent intent) {
+        if (ri == null || ri.activityInfo == null) {
+            return true;
+        }
+        if (ri.activityInfo.applicationInfo.isSystemApp()
+                && (isDialerIntent(intent) || isTextMessageIntent(intent))) {
+            return false;
+        }
+        return !isTargetResolverOrChooserActivity(ri.activityInfo);
+    }
+
+    private boolean isTextMessageIntent(Intent intent) {
+        return Intent.ACTION_SENDTO.equals(intent.getAction()) && intent.getData() != null
+            && ALLOWED_TEXT_MESSAGE_SCHEME.contains(intent.getData().getScheme());
+    }
+
+    private boolean isDialerIntent(Intent intent) {
+        return Intent.ACTION_DIAL.equals(intent.getAction())
+            || Intent.ACTION_CALL.equals(intent.getAction());
+    }
+
+    private boolean isTargetResolverOrChooserActivity(ActivityInfo activityInfo) {
+        if (!"android".equals(activityInfo.packageName)) {
+            return false;
+        }
+        return ResolverActivity.class.getName().equals(activityInfo.name)
+            || ChooserActivity.class.getName().equals(activityInfo.name);
+    }
+
     /**
      * Check whether the intent can be forwarded to target user. Return the intent used for
      * forwarding if it can be forwarded, {@code null} otherwise.
@@ -241,6 +267,16 @@ public class IntentForwarderActivity extends Activity  {
         public PackageManager getPackageManager() {
             return IntentForwarderActivity.this.getPackageManager();
         }
+
+        @Override
+        public ResolveInfo resolveActivityAsUser(Intent intent, int flags, int userId) {
+            return getPackageManager().resolveActivityAsUser(intent, flags, userId);
+        }
+
+        @Override
+        public void showToast(int messageId, int duration) {
+            Toast.makeText(IntentForwarderActivity.this, getString(messageId), duration).show();
+        }
     }
 
     public interface Injector {
@@ -249,5 +285,9 @@ public class IntentForwarderActivity extends Activity  {
         UserManager getUserManager();
 
         PackageManager getPackageManager();
+
+        ResolveInfo resolveActivityAsUser(Intent intent, int flags, int userId);
+
+        void showToast(@StringRes int messageId, int duration);
     }
 }
diff --git a/core/java/com/android/internal/app/PlatLogoActivity.java b/core/java/com/android/internal/app/PlatLogoActivity.java
index f6a69d9aeb9..57785443919 100644
--- a/core/java/com/android/internal/app/PlatLogoActivity.java
+++ b/core/java/com/android/internal/app/PlatLogoActivity.java
@@ -18,6 +18,9 @@ package com.android.internal.app;
 
 import android.animation.TimeAnimator;
 import android.app.Activity;
+import android.content.ActivityNotFoundException;
+import android.content.ContentResolver;
+import android.content.Intent;
 import android.graphics.Canvas;
 import android.graphics.Color;
 import android.graphics.ColorFilter;
@@ -25,12 +28,15 @@ import android.graphics.Paint;
 import android.graphics.Path;
 import android.graphics.drawable.Drawable;
 import android.os.Bundle;
+import android.provider.Settings;
 import android.util.Log;
 import android.view.MotionEvent;
 import android.view.MotionEvent.PointerCoords;
 import android.view.View;
 import android.widget.FrameLayout;
 
+import org.json.JSONObject;
+
 public class PlatLogoActivity extends Activity {
     FrameLayout layout;
     TimeAnimator anim;
@@ -87,7 +93,7 @@ public class PlatLogoActivity extends Activity {
             darkest = 0;
             for (int i=0; i<slots; i++) {
                 palette[i] = Color.HSVToColor(color);
-                color[0] += 360f/slots;
+                color[0] = (color[0] + 360f/slots) % 360f;
                 if (lum(palette[i]) < lum(palette[darkest])) darkest = i;
             }
 
@@ -178,27 +184,97 @@ public class PlatLogoActivity extends Activity {
         bg = new PBackground();
         layout.setBackground(bg);
 
+        final ContentResolver cr = getContentResolver();
+
         layout.setOnTouchListener(new View.OnTouchListener() {
+            final String TOUCH_STATS = "touch.stats";
+
             final PointerCoords pc0 = new PointerCoords();
             final PointerCoords pc1 = new PointerCoords();
 
+            double pressure_min, pressure_max;
+            int maxPointers;
+            int tapCount;
+
             @Override
             public boolean onTouch(View v, MotionEvent event) {
+                final float pressure = event.getPressure();
                 switch (event.getActionMasked()) {
                     case MotionEvent.ACTION_DOWN:
+                        pressure_min = pressure_max = pressure;
+                        // fall through
                     case MotionEvent.ACTION_MOVE:
-                        if (event.getPointerCount() > 1) {
+                        if (pressure < pressure_min) pressure_min = pressure;
+                        if (pressure > pressure_max) pressure_max = pressure;
+                        final int pc = event.getPointerCount();
+                        if (pc > maxPointers) maxPointers = pc;
+                        if (pc > 1) {
                             event.getPointerCoords(0, pc0);
                             event.getPointerCoords(1, pc1);
                             bg.setRadius((float) Math.hypot(pc0.x - pc1.x, pc0.y - pc1.y) / 2f);
                         }
                         break;
+                    case MotionEvent.ACTION_CANCEL:
+                    case MotionEvent.ACTION_UP:
+                        try {
+                            final String touchDataJson = Settings.System.getString(cr, TOUCH_STATS);
+                            final JSONObject touchData = new JSONObject(
+                                    touchDataJson != null ? touchDataJson : "{}");
+                            if (touchData.has("min")) {
+                                pressure_min = Math.min(pressure_min, touchData.getDouble("min"));
+                            }
+                            if (touchData.has("max")) {
+                                pressure_max = Math.max(pressure_max, touchData.getDouble("max"));
+                            }
+                            touchData.put("min", pressure_min);
+                            touchData.put("max", pressure_max);
+                            Settings.System.putString(cr, TOUCH_STATS, touchData.toString());
+                        } catch (Exception e) {
+                            Log.e("PlatLogoActivity", "Can't write touch settings", e);
+                        }
+
+                        if (maxPointers == 1) {
+                            tapCount ++;
+                            if (tapCount < 7) {
+                                bg.randomizePalette();
+                            } else {
+                                launchNextStage();
+                            }
+                        } else {
+                            tapCount = 0;
+                        }
+                        maxPointers = 0;
+                        break;
                 }
                 return true;
             }
         });
     }
 
+    private void launchNextStage() {
+        final ContentResolver cr = getContentResolver();
+
+        if (Settings.System.getLong(cr, Settings.System.EGG_MODE, 0) == 0) {
+            // For posterity: the moment this user unlocked the easter egg
+            try {
+                Settings.System.putLong(cr,
+                        Settings.System.EGG_MODE,
+                        System.currentTimeMillis());
+            } catch (RuntimeException e) {
+                Log.e("PlatLogoActivity", "Can't write settings", e);
+            }
+        }
+        try {
+            startActivity(new Intent(Intent.ACTION_MAIN)
+                    .setFlags(Intent.FLAG_ACTIVITY_NEW_TASK
+                        | Intent.FLAG_ACTIVITY_CLEAR_TASK)
+                    .addCategory("com.android.internal.category.PLATLOGO"));
+        } catch (ActivityNotFoundException ex) {
+            Log.e("PlatLogoActivity", "No more eggs.");
+        }
+        finish();
+    }
+
     @Override
     public void onStart() {
         super.onStart();
diff --git a/core/java/com/android/internal/hardware/AmbientDisplayConfiguration.java b/core/java/com/android/internal/hardware/AmbientDisplayConfiguration.java
index 26fb6b6415e..07bb4533c4e 100644
--- a/core/java/com/android/internal/hardware/AmbientDisplayConfiguration.java
+++ b/core/java/com/android/internal/hardware/AmbientDisplayConfiguration.java
@@ -27,9 +27,11 @@ import android.text.TextUtils;
 public class AmbientDisplayConfiguration {
 
     private final Context mContext;
+    private final boolean mAlwaysOnByDefault;
 
     public AmbientDisplayConfiguration(Context context) {
         mContext = context;
+        mAlwaysOnByDefault = mContext.getResources().getBoolean(R.bool.config_dozeAlwaysOnEnabled);
     }
 
     public boolean enabled(int user) {
@@ -101,8 +103,8 @@ public class AmbientDisplayConfiguration {
     }
 
     public boolean alwaysOnEnabled(int user) {
-        return boolSettingDefaultOn(Settings.Secure.DOZE_ALWAYS_ON, user) && alwaysOnAvailable()
-                && !accessibilityInversionEnabled(user);
+        return boolSetting(Settings.Secure.DOZE_ALWAYS_ON, user, mAlwaysOnByDefault ? 1 : 0)
+                && alwaysOnAvailable() && !accessibilityInversionEnabled(user);
     }
 
     public boolean alwaysOnAvailable() {
diff --git a/core/java/com/android/internal/os/BatteryStatsImpl.java b/core/java/com/android/internal/os/BatteryStatsImpl.java
index 4cc91ec3ae7..50d3a56454d 100644
--- a/core/java/com/android/internal/os/BatteryStatsImpl.java
+++ b/core/java/com/android/internal/os/BatteryStatsImpl.java
@@ -4021,7 +4021,9 @@ public class BatteryStatsImpl extends BatteryStats {
         try {
             IBatteryPropertiesRegistrar registrar = IBatteryPropertiesRegistrar.Stub.asInterface(
                     ServiceManager.getService("batteryproperties"));
-            registrar.scheduleUpdate();
+            if (registrar != null) {
+                registrar.scheduleUpdate();
+            }
         } catch (RemoteException e) {
             // Ignore.
         }
diff --git a/core/java/com/android/internal/widget/MessagingLayout.java b/core/java/com/android/internal/widget/MessagingLayout.java
index 0fd610908fd..4ba93bc50df 100644
--- a/core/java/com/android/internal/widget/MessagingLayout.java
+++ b/core/java/com/android/internal/widget/MessagingLayout.java
@@ -60,6 +60,13 @@ import java.util.regex.Pattern;
 public class MessagingLayout extends FrameLayout {
 
     private static final float COLOR_SHIFT_AMOUNT = 60;
+    /**
+     *  Pattren for filter some ingonable characters.
+     *  p{Z} for any kind of whitespace or invisible separator.
+     *  p{C} for any kind of punctuation character.
+     */
+    private static final Pattern IGNORABLE_CHAR_PATTERN
+            = Pattern.compile("[\\p{C}\\p{Z}]");
     private static final Pattern SPECIAL_CHAR_PATTERN
             = Pattern.compile ("[!@#$%&*()_+=|<>?{}\\[\\]~-]");
     private static final Consumer<MessagingMessage> REMOVE_MESSAGE
@@ -233,7 +240,10 @@ public class MessagingLayout extends FrameLayout {
                 continue;
             }
             if (!uniqueNames.containsKey(senderName)) {
-                char c = senderName.charAt(0);
+                // Only use visible characters to get uniqueNames
+                String pureSenderName = IGNORABLE_CHAR_PATTERN
+                        .matcher(senderName).replaceAll("" /* replacement */);
+                char c = pureSenderName.charAt(0);
                 if (uniqueCharacters.containsKey(c)) {
                     // this character was already used, lets make it more unique. We first need to
                     // resolve the existing character if it exists
@@ -245,7 +255,7 @@ public class MessagingLayout extends FrameLayout {
                     uniqueNames.put(senderName, findNameSplit((String) senderName));
                 } else {
                     uniqueNames.put(senderName, Character.toString(c));
-                    uniqueCharacters.put(c, senderName);
+                    uniqueCharacters.put(c, pureSenderName);
                 }
             }
         }
diff --git a/core/java/com/android/internal/widget/MessagingLinearLayout.java b/core/java/com/android/internal/widget/MessagingLinearLayout.java
index 64b1f241464..0c8613b460f 100644
--- a/core/java/com/android/internal/widget/MessagingLinearLayout.java
+++ b/core/java/com/android/internal/widget/MessagingLinearLayout.java
@@ -111,14 +111,16 @@ public class MessagingLinearLayout extends ViewGroup {
             final int childHeight = child.getMeasuredHeight();
             int newHeight = Math.max(totalHeight, totalHeight + childHeight + lp.topMargin +
                     lp.bottomMargin + spacing);
-            first = false;
             int measureType = MessagingChild.MEASURED_NORMAL;
             if (messagingChild != null) {
                 measureType = messagingChild.getMeasuredType();
                 linesRemaining -= messagingChild.getConsumedLines();
             }
-            boolean isShortened = measureType == MessagingChild.MEASURED_SHORTENED;
-            boolean isTooSmall = measureType == MessagingChild.MEASURED_TOO_SMALL;
+
+            // We never measure the first item as too small, we want to at least show something.
+            boolean isTooSmall = measureType == MessagingChild.MEASURED_TOO_SMALL && !first;
+            boolean isShortened = measureType == MessagingChild.MEASURED_SHORTENED
+                    || measureType == MessagingChild.MEASURED_TOO_SMALL && first;
             if (newHeight <= targetHeight && !isTooSmall) {
                 totalHeight = newHeight;
                 measuredWidth = Math.max(measuredWidth,
@@ -131,6 +133,7 @@ public class MessagingLinearLayout extends ViewGroup {
             } else {
                 break;
             }
+            first = false;
         }
 
         setMeasuredDimension(
diff --git a/core/java/com/android/server/BootReceiver.java b/core/java/com/android/server/BootReceiver.java
index 95534e264b8..621d5a6e5c5 100644
--- a/core/java/com/android/server/BootReceiver.java
+++ b/core/java/com/android/server/BootReceiver.java
@@ -258,13 +258,13 @@ public class BootReceiver extends BroadcastReceiver {
 
         // Start watching for new tombstone files; will record them as they occur.
         // This gets registered with the singleton file observer thread.
-        sTombstoneObserver = new FileObserver(TOMBSTONE_DIR.getPath(), FileObserver.CLOSE_WRITE) {
+        sTombstoneObserver = new FileObserver(TOMBSTONE_DIR.getPath(), FileObserver.CREATE) {
             @Override
             public void onEvent(int event, String path) {
                 HashMap<String, Long> timestamps = readTimestamps();
                 try {
                     File file = new File(TOMBSTONE_DIR, path);
-                    if (file.isFile()) {
+                    if (file.isFile() && file.getName().startsWith("tombstone_")) {
                         addFileToDropBox(db, timestamps, headers, file.getPath(), LOG_SIZE,
                                 TAG_TOMBSTONE);
                     }
diff --git a/core/jni/android_view_ThreadedRenderer.cpp b/core/jni/android_view_ThreadedRenderer.cpp
index ee9a123ab67..165316ca7b9 100644
--- a/core/jni/android_view_ThreadedRenderer.cpp
+++ b/core/jni/android_view_ThreadedRenderer.cpp
@@ -1060,6 +1060,13 @@ static void android_view_ThreadedRenderer_setContextPriority(JNIEnv*, jclass,
     Properties::contextPriority = contextPriority;
 }
 
+static void android_view_ThreadedRenderer_allocateBuffers(JNIEnv* env, jobject clazz,
+        jlong proxyPtr, jobject jsurface) {
+    RenderProxy* proxy = reinterpret_cast<RenderProxy*>(proxyPtr);
+    sp<Surface> surface = android_view_Surface_getSurface(env, jsurface);
+    proxy->allocateBuffers(surface);
+}
+
 // ----------------------------------------------------------------------------
 // FrameMetricsObserver
 // ----------------------------------------------------------------------------
@@ -1173,6 +1180,7 @@ static const JNINativeMethod gMethods[] = {
     { "nSetDebuggingEnabled", "(Z)V", (void*)android_view_ThreadedRenderer_setDebuggingEnabled },
     { "nSetIsolatedProcess", "(Z)V", (void*)android_view_ThreadedRenderer_setIsolatedProcess },
     { "nSetContextPriority", "(I)V", (void*)android_view_ThreadedRenderer_setContextPriority },
+    { "nAllocateBuffers", "(JLandroid/view/Surface;)V", (void*)android_view_ThreadedRenderer_allocateBuffers },
 };
 
 static JavaVM* mJvm = nullptr;
diff --git a/core/jni/com_android_internal_os_Zygote.cpp b/core/jni/com_android_internal_os_Zygote.cpp
index b2853c9f1c6..223af68b36b 100644
--- a/core/jni/com_android_internal_os_Zygote.cpp
+++ b/core/jni/com_android_internal_os_Zygote.cpp
@@ -45,6 +45,7 @@
 #include <unistd.h>
 
 #include "android-base/logging.h"
+#include <android-base/properties.h>
 #include <android-base/file.h>
 #include <android-base/stringprintf.h>
 #include <cutils/fs.h>
@@ -70,6 +71,7 @@ namespace {
 using android::String8;
 using android::base::StringPrintf;
 using android::base::WriteStringToFile;
+using android::base::GetBoolProperty;
 
 #define CREATE_ERROR(...) StringPrintf("%s:%d: ", __FILE__, __LINE__). \
                               append(StringPrintf(__VA_ARGS__))
@@ -889,12 +891,16 @@ static jint com_android_internal_os_Zygote_nativeForkSystemServer(
           RuntimeAbort(env, __LINE__, "System server process has died. Restarting Zygote!");
       }
 
-      // Assign system_server to the correct memory cgroup.
-      // Not all devices mount /dev/memcg so check for the file first
-      // to avoid unnecessarily printing errors and denials in the logs.
-      if (!access("/dev/memcg/system/tasks", F_OK) &&
+      bool low_ram_device = GetBoolProperty("ro.config.low_ram", false);
+      bool per_app_memcg = GetBoolProperty("ro.config.per_app_memcg", low_ram_device);
+      if (per_app_memcg) {
+          // Assign system_server to the correct memory cgroup.
+          // Not all devices mount /dev/memcg so check for the file first
+          // to avoid unnecessarily printing errors and denials in the logs.
+          if (!access("/dev/memcg/system/tasks", F_OK) &&
                 !WriteStringToFile(StringPrintf("%d", pid), "/dev/memcg/system/tasks")) {
-        ALOGE("couldn't write %d to /dev/memcg/system/tasks", pid);
+              ALOGE("couldn't write %d to /dev/memcg/system/tasks", pid);
+          }
       }
   }
   return pid;
diff --git a/core/proto/android/server/windowmanagerservice.proto b/core/proto/android/server/windowmanagerservice.proto
index 7467d8f2e96..2de53b97312 100644
--- a/core/proto/android/server/windowmanagerservice.proto
+++ b/core/proto/android/server/windowmanagerservice.proto
@@ -319,6 +319,8 @@ message WindowStateProto {
     optional bool removed = 36;
     optional bool is_on_screen = 37;
     optional bool is_visible = 38;
+    optional bool pending_forced_seamless_rotation = 39;
+    optional int64 finished_forced_seamless_rotation_frame = 40;
 }
 
 message IdentifierProto {
diff --git a/core/res/AndroidManifest.xml b/core/res/AndroidManifest.xml
index a16da093de9..2934503841f 100644
--- a/core/res/AndroidManifest.xml
+++ b/core/res/AndroidManifest.xml
@@ -2256,7 +2256,8 @@
         android:description="@string/permdesc_install_shortcut"
         android:protectionLevel="normal"/>
 
-    <!--This permission is no longer supported.
+    <!-- <p class="caution"><strong>Don't use this permission in your app.</strong><br>This
+         permission is no longer supported.
     -->
     <permission android:name="com.android.launcher.permission.UNINSTALL_SHORTCUT"
         android:label="@string/permlab_uninstall_shortcut"
@@ -3042,6 +3043,15 @@
     <permission android:name="android.permission.INSTALL_PACKAGE_UPDATES"
         android:protectionLevel="signature|privileged" />
 
+    <!-- Allows an application to install existing system packages. This is a limited
+         version of {@link android.Manifest.permission#INSTALL_PACKAGES}.
+         <p>Not for use by third-party applications.
+         TODO(b/80204953): remove this permission once we have a long-term solution.
+         @hide
+    -->
+    <permission android:name="com.android.permission.INSTALL_EXISTING_PACKAGES"
+        android:protectionLevel="signature|privileged" />
+
     <!-- @SystemApi Allows an application to clear user data.
          <p>Not for use by third-party applications
          @hide
diff --git a/core/res/res/anim/lock_screen_behind_enter_fade_in.xml b/core/res/res/anim/lock_screen_behind_enter_fade_in.xml
index e9475f52d22..ff95aeae168 100644
--- a/core/res/res/anim/lock_screen_behind_enter_fade_in.xml
+++ b/core/res/res/anim/lock_screen_behind_enter_fade_in.xml
@@ -16,7 +16,6 @@
   -->
 
 <alpha xmlns:android="http://schemas.android.com/apk/res/android"
-    android:background="#ff000000"
     android:detachWallpaper="true"
     android:shareInterpolator="false"
     android:interpolator="@interpolator/linear"
diff --git a/core/res/res/values-af/strings.xml b/core/res/res/values-af/strings.xml
index 41a44bb7ca5..df4d58a07f4 100644
--- a/core/res/res/values-af/strings.xml
+++ b/core/res/res/values-af/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"WiFi het geen internettoegang nie"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tik vir opsies"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Veranderings aan jou warmkolinstellings"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Jou warmkolband het verander."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Hierdie toestel steun nie jou voorkeur vir net 5GHz nie. Hierdie toestel sal in plaas daarvan die 5GHz-band gebruik wanneer dit beskikbaar is."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Het oorgeskakel na <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Toestel gebruik <xliff:g id="NEW_NETWORK">%1$s</xliff:g> wanneer <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> geen internettoegang het nie. Heffings kan geld."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Het oorgeskakel van <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> na <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-am/strings.xml b/core/res/res/values-am/strings.xml
index 50d44a15f61..63c0e8bd2ec 100644
--- a/core/res/res/values-am/strings.xml
+++ b/core/res/res/values-am/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"    5GHz       5GHz  "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">" <xliff:g id="NETWORK_TYPE">%1$s</xliff:g> "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>        <xliff:g id="NEW_NETWORK">%1$s</xliff:g>     "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g> "</string>
@@ -1789,7 +1792,7 @@
     <string name="work_mode_turn_on" msgid="2062544985670564875">""</string>
     <string name="deprecated_target_sdk_message" msgid="1449696506742572767">"   Android               "</string>
     <string name="deprecated_target_sdk_app_store" msgid="5032340500368495077">"  "</string>
-    <string name="new_sms_notification_title" msgid="8442817549127555977">"  "</string>
+    <string name="new_sms_notification_title" msgid="8442817549127555977">"  "</string>
     <string name="new_sms_notification_content" msgid="7002938807812083463">"   "</string>
     <string name="user_encrypted_title" msgid="9054897468831672082">"    "</string>
     <string name="user_encrypted_message" msgid="4923292604515744267">"  "</string>
@@ -1846,7 +1849,7 @@
     <string name="etws_primary_default_message_earthquake" msgid="5541962250262769193">"     "</string>
     <string name="etws_primary_default_message_tsunami" msgid="1887685943498368548">"                   "</string>
     <string name="etws_primary_default_message_earthquake_and_tsunami" msgid="998797956848445862">"     "</string>
-    <string name="etws_primary_default_message_test" msgid="2709597093560037455">"   "</string>
+    <string name="etws_primary_default_message_test" msgid="2709597093560037455">"   "</string>
     <string name="notification_reply_button_accessibility" msgid="3621714652387814344">" "</string>
     <string name="etws_primary_default_message_others" msgid="6293148756130398971"></string>
     <string name="mmcc_authentication_reject" msgid="5767701075994754356">"  "</string>
diff --git a/core/res/res/values-ar/strings.xml b/core/res/res/values-ar/strings.xml
index 70eea9b17c7..b8d8a50b2a8 100644
--- a/core/res/res/values-ar/strings.xml
+++ b/core/res/res/values-ar/strings.xml
@@ -1188,7 +1188,7 @@
     <string name="android_start_title" product="default" msgid="4536778526365907780">"   "</string>
     <string name="android_start_title" product="tablet" msgid="4929837533850340472">"    "</string>
     <string name="android_start_title" product="device" msgid="7467484093260449437">"   "</string>
-    <string name="android_upgrading_fstrim" msgid="8036718871534640010">"   ."</string>
+    <string name="android_upgrading_fstrim" msgid="8036718871534640010">"   ."</string>
     <string name="android_upgrading_notification_title" product="default" msgid="1511552415039349062">"   "</string>
     <string name="app_upgrading_toast" msgid="3008139776215597053">"  <xliff:g id="APPLICATION">%1$s</xliff:g>"</string>
     <string name="android_upgrading_apk" msgid="7904042682111526169">"   <xliff:g id="NUMBER_0">%1$d</xliff:g>  <xliff:g id="NUMBER_1">%2$d</xliff:g>."</string>
@@ -1263,6 +1263,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">" Wi-Fi   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   ."</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"      "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"      ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"          5  .       5    ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"   <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"  <xliff:g id="NEW_NETWORK">%1$s</xliff:g>        <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>       ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"   <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
@@ -1530,7 +1533,7 @@
     <string name="action_menu_overflow_description" msgid="2295659037509008453">"  "</string>
     <string name="action_bar_home_description_format" msgid="7965984360903693903">"%1$s %2$s"</string>
     <string name="action_bar_home_subtitle_description_format" msgid="6985546530471780727">"%1$s %2$s %3$s"</string>
-    <string name="storage_internal" msgid="3570990907910199483">"   "</string>
+    <string name="storage_internal" msgid="3570990907910199483">"   "</string>
     <string name="storage_sd_card" msgid="3282948861378286745">" SD"</string>
     <string name="storage_sd_card_label" msgid="6347111320774379257">" SD  <xliff:g id="MANUFACTURER">%s</xliff:g>"</string>
     <string name="storage_usb_drive" msgid="6261899683292244209">"  USB"</string>
@@ -1951,7 +1954,7 @@
     <string name="app_category_news" msgid="7496506240743986873">" "</string>
     <string name="app_category_maps" msgid="5878491404538024367">" "</string>
     <string name="app_category_productivity" msgid="3742083261781538852">""</string>
-    <string name="device_storage_monitor_notification_channel" msgid="3295871267414816228">"  "</string>
+    <string name="device_storage_monitor_notification_channel" msgid="3295871267414816228">"  "</string>
     <string name="adb_debugging_notification_channel_tv" msgid="5537766997350092316">"  USB"</string>
     <string name="time_picker_hour_label" msgid="2979075098868106450">""</string>
     <string name="time_picker_minute_label" msgid="5168864173796598399">""</string>
diff --git a/core/res/res/values-as/strings.xml b/core/res/res/values-as/strings.xml
index 91515e2b63e..fd3358c06cc 100644
--- a/core/res/res/values-as/strings.xml
+++ b/core/res/res/values-as/strings.xml
@@ -291,12 +291,9 @@
     <string name="permgrouplab_camera" msgid="4820372495894586615">""</string>
     <string name="permgroupdesc_camera" msgid="3250611594678347720">"\'   \'   "</string>
     <string name="permgrouprequest_camera" msgid="1299833592069671756">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;    \'    ?"</string>
-    <!-- no translation found for permgrouplab_calllog (8798646184930388160) -->
-    <skip />
-    <!-- no translation found for permgroupdesc_calllog (3006237336748283775) -->
-    <skip />
-    <!-- no translation found for permgrouprequest_calllog (8487355309583773267) -->
-    <skip />
+    <string name="permgrouplab_calllog" msgid="8798646184930388160">" "</string>
+    <string name="permgroupdesc_calllog" msgid="3006237336748283775">"\'     "</string>
+    <string name="permgrouprequest_calllog" msgid="8487355309583773267">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;  \'     ?"</string>
     <string name="permgrouplab_phone" msgid="5229115638567440675">""</string>
     <string name="permgroupdesc_phone" msgid="6234224354060641055">"\'      "</string>
     <string name="permgrouprequest_phone" msgid="9166979577750581037">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; \'       ?"</string>
@@ -1178,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"-  "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"          ,          "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>   \'"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>  ,   <xliff:g id="NEW_NETWORK">%1$s</xliff:g>     \' "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>    \'"</string>
diff --git a/core/res/res/values-az/strings.xml b/core/res/res/values-az/strings.xml
index 164b1fbd565..a32ea76c0e2 100644
--- a/core/res/res/values-az/strings.xml
+++ b/core/res/res/values-az/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi bksinin internet girii yoxdur"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Seimlr n tklayn"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Hotspot ayarlarnzda dyiiklik"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Hotspot qrupu dyidi."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Bu cihaz yalnz 5GHz n trcihinizi dstklmir. vzin latan olduqda bu cihaz 5GHz qrupundan istifad edck."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g> bk nvn keirildi"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> bksinin internet girii olmadqda, cihaz <xliff:g id="NEW_NETWORK">%1$s</xliff:g> bksini istifad edir. Xidmt haqq tutula bilr."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> bksindn <xliff:g id="NEW_NETWORK">%2$s</xliff:g> bksin keirildi"</string>
diff --git a/core/res/res/values-b+sr+Latn/strings.xml b/core/res/res/values-b+sr+Latn/strings.xml
index 30cc2850eed..3140b4e8465 100644
--- a/core/res/res/values-b+sr+Latn/strings.xml
+++ b/core/res/res/values-b+sr+Latn/strings.xml
@@ -1197,6 +1197,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi nema pristup internetu"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Dodirnite za opcije"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Promene podeavanja za hotspot"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Opseg hotspota je promenjen."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Ovaj ureaj ne podrava podeavanje samo za 5 GHz. Ureaj e koristiti opseg od 5 GHz kada bude dostupan."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Preli ste na tip mree <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Ureaj koristi tip mree <xliff:g id="NEW_NETWORK">%1$s</xliff:g> kada tip mree <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nema pristup internetu. Moda e se naplaivati trokovi."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Preli ste sa tipa mree <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> na tip mree <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-be/strings.xml b/core/res/res/values-be/strings.xml
index 879c506c320..37adabb922f 100644
--- a/core/res/res/values-be/strings.xml
+++ b/core/res/res/values-be/strings.xml
@@ -220,7 +220,7 @@
     <string name="global_actions" product="default" msgid="2406416831541615258">" "</string>
     <string name="global_action_lock" msgid="2844945191792119712">" "</string>
     <string name="global_action_power_off" msgid="4471879440839879722">""</string>
-    <string name="global_action_emergency" msgid="7112311161137421166">"SOS-"</string>
+    <string name="global_action_emergency" msgid="7112311161137421166">" "</string>
     <string name="global_action_bug_report" msgid="7934010578922304799">"  "</string>
     <string name="global_action_logout" msgid="935179188218826050">" "</string>
     <string name="global_action_screenshot" msgid="8329831278085426283">" "</string>
@@ -741,7 +741,7 @@
     <string name="lockscreen_instructions_when_pattern_enabled" msgid="46154051614126049">" \"\",  ,    ."</string>
     <string name="lockscreen_instructions_when_pattern_disabled" msgid="686260028797158364">" \"\",  ."</string>
     <string name="lockscreen_pattern_instructions" msgid="7478703254964810302">"  ,  "</string>
-    <string name="lockscreen_emergency_call" msgid="5298642613417801888">"SOS-"</string>
+    <string name="lockscreen_emergency_call" msgid="5298642613417801888">" "</string>
     <string name="lockscreen_return_to_call" msgid="5244259785500040021">"  "</string>
     <string name="lockscreen_pattern_correct" msgid="9039008650362261237">"!"</string>
     <string name="lockscreen_pattern_wrong" msgid="4317955014948108794">"  "</string>
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">" Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">",   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   -"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">" - ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"       5.    ,   ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"   <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"   <xliff:g id="NEW_NETWORK">%1$s</xliff:g>,    <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>    .   ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"   <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
@@ -1927,7 +1930,7 @@
     <string name="mmcc_imsi_unknown_in_hlr_msim_template" msgid="5636464607596778986">"SIM <xliff:g id="SIMNUMBER">%d</xliff:g> "</string>
     <string name="mmcc_illegal_ms_msim_template" msgid="5994323296399913454">"  SIM <xliff:g id="SIMNUMBER">%d</xliff:g>  "</string>
     <string name="mmcc_illegal_me_msim_template" msgid="5550259730350571826">"  SIM <xliff:g id="SIMNUMBER">%d</xliff:g>  "</string>
-    <string name="popup_window_default_title" msgid="4874318849712115433">" "</string>
+    <string name="popup_window_default_title" msgid="4874318849712115433">" "</string>
     <string name="slice_more_content" msgid="8504342889413274608">"+ <xliff:g id="NUMBER">%1$d</xliff:g>"</string>
     <string name="shortcut_restored_on_lower_version" msgid="4860853725206702336">"         "</string>
     <string name="shortcut_restore_not_supported" msgid="5028808567940014190">"   ,        "</string>
diff --git a/core/res/res/values-bg/strings.xml b/core/res/res/values-bg/strings.xml
index 9568a16ef26..9c014832b4c 100644
--- a/core/res/res/values-bg/strings.xml
+++ b/core/res/res/values-bg/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi     "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"       "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"        ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"             5 .      ,   ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"   <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"  <xliff:g id="NEW_NETWORK">%1$s</xliff:g>,  <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>    .     ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"   <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-bn/strings.xml b/core/res/res/values-bn/strings.xml
index c0836130b3c..b8e31480399 100644
--- a/core/res/res/values-bn/strings.xml
+++ b/core/res/res/values-bn/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"-    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"   5GHz        ,   5GHz   "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>   "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>      <xliff:g id="NEW_NETWORK">%1$s</xliff:g>      "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>   "</string>
@@ -1314,7 +1317,7 @@
     <string name="ext_media_status_ejecting" msgid="5463887263101234174">"  ..."</string>
     <string name="ext_media_status_formatting" msgid="1085079556538644861">"  ..."</string>
     <string name="ext_media_status_missing" msgid="5638633895221670766">"  "</string>
-    <string name="activity_list_empty" msgid="1675388330786841066">"     "</string>
+    <string name="activity_list_empty" msgid="1675388330786841066">"     "</string>
     <string name="permlab_route_media_output" msgid="6243022988998972085">"   "</string>
     <string name="permdesc_route_media_output" msgid="4932818749547244346">"         "</string>
     <string name="permlab_readInstallSessions" msgid="3713753067455750349">"  "</string>
@@ -1474,7 +1477,7 @@
     <string name="sha256_fingerprint" msgid="4391271286477279263">"SHA-256  :"</string>
     <string name="sha1_fingerprint" msgid="7930330235269404581">"SHA-1  :"</string>
     <string name="activity_chooser_view_see_all" msgid="4292569383976636200">" "</string>
-    <string name="activity_chooser_view_dialog_title_default" msgid="4710013864974040615">"  "</string>
+    <string name="activity_chooser_view_dialog_title_default" msgid="4710013864974040615">"  "</string>
     <string name="share_action_provider_share_with" msgid="5247684435979149216">"   "</string>
     <string name="sending" msgid="3245653681008218030">" ..."</string>
     <string name="launchBrowserDefault" msgid="2057951947297614725">"   ?"</string>
diff --git a/core/res/res/values-bs/strings.xml b/core/res/res/values-bs/strings.xml
index 32ab685adf0..34c74dd1089 100644
--- a/core/res/res/values-bs/strings.xml
+++ b/core/res/res/values-bs/strings.xml
@@ -458,7 +458,7 @@
     <string name="permlab_accessNetworkState" msgid="4951027964348974773">"prikaz mrenih veza"</string>
     <string name="permdesc_accessNetworkState" msgid="8318964424675960975">"Omoguava aplikaciji pregled informacija o mrenim vezama, npr. koje mree postoje i koje su povezane."</string>
     <string name="permlab_createNetworkSockets" msgid="7934516631384168107">"ima potpuni pristup mrei"</string>
-    <string name="permdesc_createNetworkSockets" msgid="3403062187779724185">"Omoguava aplikaciji kreiranje spojnih taaka sa mreom i koritenje prilagoenih mrenih protokola. Preglednik i druge aplikacije omoguavaju slanje podataka na internet, tako da ovo odobrenje nije potrebno za vrenje te radnje."</string>
+    <string name="permdesc_createNetworkSockets" msgid="3403062187779724185">"Omoguava aplikaciji kreiranje spojnih taaka s mreom i koritenje prilagoenih mrenih protokola. Preglednik i druge aplikacije omoguavaju slanje podataka na internet, tako da ovo odobrenje nije potrebno za vrenje te radnje."</string>
     <string name="permlab_changeNetworkState" msgid="958884291454327309">"izmjene povezivanja na mreu"</string>
     <string name="permdesc_changeNetworkState" msgid="6789123912476416214">"Dozvoljava aplikaciji izmjenu stanja mrene povezanosti."</string>
     <string name="permlab_changeTetherState" msgid="5952584964373017960">"izmjene podijeljenog povezivanja"</string>
@@ -502,11 +502,11 @@
     <string name="fingerprint_acquired_too_slow" msgid="59250885689661653">"Prst je uklonjen presporo. Pokuajte ponovo."</string>
   <string-array name="fingerprint_acquired_vendor">
   </string-array>
-    <string name="fingerprint_not_recognized" msgid="2690661881608146617">"Nije prepoznat"</string>
+    <string name="fingerprint_not_recognized" msgid="2690661881608146617">"Nije prepoznato"</string>
     <string name="fingerprint_authenticated" msgid="5309333983002526448">"Otisak prsta je potvren"</string>
     <string name="fingerprint_error_hw_not_available" msgid="7955921658939936596">"Hardver za otisak prsta nije dostupan."</string>
     <string name="fingerprint_error_no_space" msgid="1055819001126053318">"Otisak prsta se ne moe pohraniti. Uklonite postojei otisak prsta."</string>
-    <string name="fingerprint_error_timeout" msgid="3927186043737732875">"Vremensko ogranienje za otisak prsta je isteklo. Pokuajte ponovo."</string>
+    <string name="fingerprint_error_timeout" msgid="3927186043737732875">"Vrijeme za prepoznavanje otiska prsta je isteklo. Pokuajte ponovo."</string>
     <string name="fingerprint_error_canceled" msgid="4402024612660774395">"Radnja sa otiskom prsta je otkazana."</string>
     <string name="fingerprint_error_user_canceled" msgid="7999639584615291494">"Korisnik je otkazao radnju s otiskom prsta."</string>
     <string name="fingerprint_error_lockout" msgid="5536934748136933450">"Previe pokuaja. Pokuajte ponovo kasnije."</string>
@@ -1199,6 +1199,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"WiFi nema pristup internetu"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Dodirnite za opcije"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Promjene postavki vae pristupne take"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Opseg vae pristupne take je promijenjen."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Ovaj ureaj ne podrava vau postavku za mree od iskljuivo 5GHz. Ureaj e koristiti opseg of 5GHz kada je dostupan."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Prebaeno na: <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Kada <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nema pristup internetu, ureaj koristi mreu <xliff:g id="NEW_NETWORK">%1$s</xliff:g>. Mogua je naplata usluge."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Prebaeno iz mree <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> u <xliff:g id="NEW_NETWORK">%2$s</xliff:g> mreu"</string>
@@ -1223,7 +1226,7 @@
     <string name="accept" msgid="1645267259272829559">"Prihvati"</string>
     <string name="decline" msgid="2112225451706137894">"Odbijte"</string>
     <string name="wifi_p2p_invitation_sent_title" msgid="1318975185112070734">"Pozivnica poslana"</string>
-    <string name="wifi_p2p_invitation_to_connect_title" msgid="4958803948658533637">"Poziv za povezivanje"</string>
+    <string name="wifi_p2p_invitation_to_connect_title" msgid="4958803948658533637">"Pozivnica za povezivanje"</string>
     <string name="wifi_p2p_from_message" msgid="570389174731951769">"Poiljalac:"</string>
     <string name="wifi_p2p_to_message" msgid="248968974522044099">"Prima:"</string>
     <string name="wifi_p2p_enter_pin_message" msgid="5920929550367828970">"Unesite potrebni PIN:"</string>
diff --git a/core/res/res/values-ca/strings.xml b/core/res/res/values-ca/strings.xml
index 5599b0b2d7c..a3b0736aef0 100644
--- a/core/res/res/values-ca/strings.xml
+++ b/core/res/res/values-ca/strings.xml
@@ -133,8 +133,8 @@
     <item msgid="4397097370387921767">"Trucades per Wi-Fi %s"</item>
   </string-array>
     <string name="wifi_calling_off_summary" msgid="8720659586041656098">"Desactivat"</string>
-    <string name="wfc_mode_wifi_preferred_summary" msgid="1994113411286935263">"Preferncia per a la Wi-Fi"</string>
-    <string name="wfc_mode_cellular_preferred_summary" msgid="1988279625335345908">"Preferncia per a dades mbils"</string>
+    <string name="wfc_mode_wifi_preferred_summary" msgid="1994113411286935263">"Preferncia per la Wi-Fi"</string>
+    <string name="wfc_mode_cellular_preferred_summary" msgid="1988279625335345908">"Preferncia per dades mbils"</string>
     <string name="wfc_mode_wifi_only_summary" msgid="2379919155237869320">"Noms Wi-Fi"</string>
     <string name="cfTemplateNotForwarded" msgid="1683685883841272560">"<xliff:g id="BEARER_SERVICE_CODE">{0}</xliff:g>: no s\'ha desviat"</string>
     <string name="cfTemplateForwarded" msgid="1302922117498590521">"<xliff:g id="BEARER_SERVICE_CODE">{0}</xliff:g>: <xliff:g id="DIALING_NUMBER">{1}</xliff:g>"</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"La Wi-Fi no t accs a Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Toca per veure les opcions"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Canvis en la configuraci del punt d\'accs Wi-Fi"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Ha canviat la teva banda del punt d\'accs Wi-Fi."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Aquest dispositiu no admet utilitzar exclusivament una banda de 5GHz. El dispositiu utilitzar una banda de 5GHz quan estigui disponible."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Actualment en s: <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"El dispositiu utilitza <xliff:g id="NEW_NETWORK">%1$s</xliff:g> en cas que <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> no tingui accs a Internet. s possible que s\'hi apliquin crrecs."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Abans es feia servir la xarxa <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>; ara s\'utilitza <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
@@ -1254,7 +1257,7 @@
     <string name="usb_unsupported_audio_accessory_title" msgid="3529881374464628084">"S\'ha detectat un accessori d\'udio analgic"</string>
     <string name="usb_unsupported_audio_accessory_message" msgid="6309553946441565215">"El dispositiu connectat no s compatible amb aquest telfon. Toca per obtenir ms informaci."</string>
     <string name="adb_active_notification_title" msgid="6729044778949189918">"Depuraci USB activada"</string>
-    <string name="adb_active_notification_message" msgid="7463062450474107752">"Toca per desactivar la depuraci per USB"</string>
+    <string name="adb_active_notification_message" msgid="7463062450474107752">"Toca per desactivar la depuraci USB"</string>
     <string name="adb_active_notification_message" product="tv" msgid="8470296818270110396">"Selecciona per desactivar la depuraci USB"</string>
     <string name="taking_remote_bugreport_notification_title" msgid="6742483073875060934">"S\'est creant l\'informe d\'errors"</string>
     <string name="share_remote_bugreport_notification_title" msgid="4987095013583691873">"Vols compartir l\'informe d\'errors?"</string>
diff --git a/core/res/res/values-cs/strings.xml b/core/res/res/values-cs/strings.xml
index 1bdf4971534..c09bab7332b 100644
--- a/core/res/res/values-cs/strings.xml
+++ b/core/res/res/values-cs/strings.xml
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi nem pstup kinternetu"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Klepnutm zobrazte monosti"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Zmny nastaven hotspotu"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Psmo hotspotu se zmnilo."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Toto zazen nepodporuje vae nastaven jen 5GHz psma. Zazen pouije psmo 5GHz, jen kdy bude dostupn."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Pechod na s <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Kdy s <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nebude mt pstup kinternetu, zazen pouije s <xliff:g id="NEW_NETWORK">%1$s</xliff:g>. Mohou bt tovny poplatky."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Pechod ze st <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> na s <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-da/strings.xml b/core/res/res/values-da/strings.xml
index 4fd57dd72fb..be7f2a7bd29 100644
--- a/core/res/res/values-da/strings.xml
+++ b/core/res/res/values-da/strings.xml
@@ -587,7 +587,7 @@
     <string name="policylab_resetPassword" msgid="4934707632423915395">"Skifte skrmls"</string>
     <string name="policydesc_resetPassword" msgid="1278323891710619128">"Skifter skrmls"</string>
     <string name="policylab_forceLock" msgid="2274085384704248431">"Lse skrmen"</string>
-    <string name="policydesc_forceLock" msgid="1141797588403827138">"Kontrollerer, hvordan og hvornr skrmen lses."</string>
+    <string name="policydesc_forceLock" msgid="1141797588403827138">"Administrerer, hvordan og hvornr skrmen lses."</string>
     <string name="policylab_wipeData" msgid="3910545446758639713">"Slette alle data"</string>
     <string name="policydesc_wipeData" product="tablet" msgid="4306184096067756876">"Slet din tablets data uden varsel ved at gendanne fabriksindstillingerne."</string>
     <string name="policydesc_wipeData" product="tv" msgid="5816221315214527028">"Slet tv\'ets data uden varsel ved at nulstille til fabrinksindstillingerne."</string>
@@ -719,7 +719,7 @@
     <string name="sipAddressTypeHome" msgid="6093598181069359295">"Hjem"</string>
     <string name="sipAddressTypeWork" msgid="6920725730797099047">"Arbejde"</string>
     <string name="sipAddressTypeOther" msgid="4408436162950119849">"Andet"</string>
-    <string name="quick_contacts_not_available" msgid="746098007828579688">"Der blev ikke fundet nogen applikation, som kan vise denne kontaktperson."</string>
+    <string name="quick_contacts_not_available" msgid="746098007828579688">"Der blev ikke fundet nogen applikation, som kan vise denne kontakt."</string>
     <string name="keyguard_password_enter_pin_code" msgid="3037685796058495017">"Angiv pinkode"</string>
     <string name="keyguard_password_enter_puk_code" msgid="4800725266925845333">"Angiv PUK- og pinkode"</string>
     <string name="keyguard_password_enter_puk_prompt" msgid="1341112146710087048">"PUK-kode"</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi-netvrket har ikke internetadgang"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tryk for at se valgmuligheder"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"ndringer af dine indstillinger for hotspot"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Dit hotspotbnd er ndret."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Denne enhed understtter ikke din prference om kun 5 GHz. Denne enhed vil i stedet bruge 5 GHz-bndet, nr det er muligt."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Der blev skiftet til <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Enheden benytter <xliff:g id="NEW_NETWORK">%1$s</xliff:g>, nr der ikke er internetadgang via <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>. Der opkrves muligvis betaling."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Der blev skiftet fra <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> til <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-de/strings.xml b/core/res/res/values-de/strings.xml
index f4038aefc2c..27c4c77676e 100644
--- a/core/res/res/values-de/strings.xml
+++ b/core/res/res/values-de/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"WLAN hat keinen Internetzugriff"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Fr Optionen tippen"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"nderungen an deinen Hotspot-Einstellungen"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Dein Hotspot-Band hat sich gendert."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Dieses Gert untersttzt die ausschlieliche Nutzung von 5GHz nicht. Es greift aber immer auf das 5-GHz-Band zurck, wenn dieses verfgbar ist."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Zu <xliff:g id="NETWORK_TYPE">%1$s</xliff:g> gewechselt"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Auf dem Gert werden <xliff:g id="NEW_NETWORK">%1$s</xliff:g> genutzt, wenn ber <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> kein Internet verfgbar ist. Eventuell fallen Gebhren an."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Von \"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>\" zu \"<xliff:g id="NEW_NETWORK">%2$s</xliff:g>\" gewechselt"</string>
diff --git a/core/res/res/values-el/strings.xml b/core/res/res/values-el/strings.xml
index a51ff038c27..9f90921c824 100644
--- a/core/res/res/values-el/strings.xml
+++ b/core/res/res/values-el/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">" Wi-Fi     "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"     "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"     Wi-Fi"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"    Wi-Fi ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"           5 GHz . \' ,        5 GHz   ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"   <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"     <xliff:g id="NEW_NETWORK">%1$s</xliff:g>    <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>     .    ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"    <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>   <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-en-rAU/strings.xml b/core/res/res/values-en-rAU/strings.xml
index 5045f026892..04f71dc534f 100644
--- a/core/res/res/values-en-rAU/strings.xml
+++ b/core/res/res/values-en-rAU/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi has no Internet access"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tap for options"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Changes to your hotspot settings"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Your hotspot band has changed."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"This device doesnt support your preference for 5 GHz only. Instead, this device will use the 5 GHz band when available."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Switched to <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Device uses <xliff:g id="NEW_NETWORK">%1$s</xliff:g> when <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> has no Internet access. Charges may apply."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Switched from <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> to <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-en-rCA/strings.xml b/core/res/res/values-en-rCA/strings.xml
index 06971579bd6..0fc7c057443 100644
--- a/core/res/res/values-en-rCA/strings.xml
+++ b/core/res/res/values-en-rCA/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi has no Internet access"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tap for options"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Changes to your hotspot settings"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Your hotspot band has changed."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"This device doesnt support your preference for 5 GHz only. Instead, this device will use the 5 GHz band when available."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Switched to <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Device uses <xliff:g id="NEW_NETWORK">%1$s</xliff:g> when <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> has no Internet access. Charges may apply."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Switched from <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> to <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-en-rGB/strings.xml b/core/res/res/values-en-rGB/strings.xml
index 5045f026892..04f71dc534f 100644
--- a/core/res/res/values-en-rGB/strings.xml
+++ b/core/res/res/values-en-rGB/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi has no Internet access"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tap for options"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Changes to your hotspot settings"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Your hotspot band has changed."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"This device doesnt support your preference for 5 GHz only. Instead, this device will use the 5 GHz band when available."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Switched to <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Device uses <xliff:g id="NEW_NETWORK">%1$s</xliff:g> when <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> has no Internet access. Charges may apply."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Switched from <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> to <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-en-rIN/strings.xml b/core/res/res/values-en-rIN/strings.xml
index 5045f026892..04f71dc534f 100644
--- a/core/res/res/values-en-rIN/strings.xml
+++ b/core/res/res/values-en-rIN/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi has no Internet access"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tap for options"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Changes to your hotspot settings"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Your hotspot band has changed."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"This device doesnt support your preference for 5 GHz only. Instead, this device will use the 5 GHz band when available."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Switched to <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Device uses <xliff:g id="NEW_NETWORK">%1$s</xliff:g> when <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> has no Internet access. Charges may apply."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Switched from <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> to <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-en-rXC/strings.xml b/core/res/res/values-en-rXC/strings.xml
index a20395541a6..0519bc8f6b3 100644
--- a/core/res/res/values-en-rXC/strings.xml
+++ b/core/res/res/values-en-rXC/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi has no internet access"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tap for options"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Changes to your hotspot settings"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Your hotspot band has changed."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"This device doesnt support your preference for 5GHz only. Instead, this device will use the 5GHz band when available."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Switched to <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Device uses <xliff:g id="NEW_NETWORK">%1$s</xliff:g> when <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> has no internet access. Charges may apply."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Switched from <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> to <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-es-rUS/strings.xml b/core/res/res/values-es-rUS/strings.xml
index 3e916f72df7..f99503137b2 100644
--- a/core/res/res/values-es-rUS/strings.xml
+++ b/core/res/res/values-es-rUS/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"La red Wi-Fi no tiene acceso a Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Presiona para ver opciones"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Cambios en la configuracin de tu hotspot"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Cambi la banda de tu hotspot."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Si bien este dispositivo no admite la opcin para conectarse exclusivamente a bandas de 5GHz, las usar cuando estn disponibles."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Se cambi a <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"El dispositivo usa <xliff:g id="NEW_NETWORK">%1$s</xliff:g> cuando <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> no tiene acceso a Internet. Es posible que se apliquen cargos."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Se cambi de <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> a <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-es/strings.xml b/core/res/res/values-es/strings.xml
index ce2afbeb635..fddba785477 100644
--- a/core/res/res/values-es/strings.xml
+++ b/core/res/res/values-es/strings.xml
@@ -256,7 +256,7 @@
     <string name="notification_channel_network_alerts" msgid="2895141221414156525">"Alertas de la red"</string>
     <string name="notification_channel_network_available" msgid="4531717914138179517">"Red disponible"</string>
     <string name="notification_channel_vpn" msgid="8330103431055860618">"Estado de la VPN"</string>
-    <string name="notification_channel_device_admin" msgid="1568154104368069249">"Administracin del dispositivo"</string>
+    <string name="notification_channel_device_admin" msgid="1568154104368069249">"Administracin de dispositivos"</string>
     <string name="notification_channel_alerts" msgid="4496839309318519037">"Alertas"</string>
     <string name="notification_channel_retail_mode" msgid="6088920674914038779">"Demo para tiendas"</string>
     <string name="notification_channel_usb" msgid="9006850475328924681">"Conexin USB"</string>
@@ -605,7 +605,7 @@
     <string name="policylab_disableCamera" msgid="6395301023152297826">"Inhabilitar cmaras"</string>
     <string name="policydesc_disableCamera" msgid="2306349042834754597">"Evitar el uso de las cmaras del dispositivo"</string>
     <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Inhabilitar algunas funciones del bloqueo de pantalla"</string>
-    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Evita el uso de algunas funciones del bloqueo de pantalla."</string>
+    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Evitar el uso de algunas funciones del bloqueo de pantalla"</string>
   <string-array name="phoneTypes">
     <item msgid="8901098336658710359">"Casa"</item>
     <item msgid="869923650527136615">"Mvil"</item>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"La red Wi-Fi no tiene acceso a Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Toca para ver opciones"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Cambios en los ajustes de tu punto de acceso"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"La banda de tu punto de acceso ha cambiado."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Este dispositivo no admite la opcin de conectarse exclusivamente a bandas de 5GHz, pero las usar cuando estn disponibles."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Se ha cambiado a <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"El dispositivo utiliza <xliff:g id="NEW_NETWORK">%1$s</xliff:g> cuando <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> no tiene acceso a Internet. Es posible que se apliquen cargos."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Se ha cambiado de <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> a <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-et/strings.xml b/core/res/res/values-et/strings.xml
index fa256eb65ca..d62d8550506 100644
--- a/core/res/res/values-et/strings.xml
+++ b/core/res/res/values-et/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"WiFi-vrgul pole juurdepsu Internetile"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Puudutage valikute ngemiseks"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Muudatused teie leviala seadetes"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Teie leviala riba on muutunud."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"See seade ei toeta teie eelistatud ainult 5 GHz riba. Seade kasutab 5 GHz riba ainult siis, kui see on saadaval."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Llitati vrgule <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Seade kasutab vrku <xliff:g id="NEW_NETWORK">%1$s</xliff:g>, kui vrgul <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> puudub juurdeps Internetile. Rakenduda vivad tasud."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Llitati vrgult <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> vrgule <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-eu/strings.xml b/core/res/res/values-eu/strings.xml
index 916cb10156d..24d10931fe1 100644
--- a/core/res/res/values-eu/strings.xml
+++ b/core/res/res/values-eu/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Ezin da konektatu Internetera Wi-Fi bidez"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Sakatu aukerak ikusteko"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Aldaketak egin dira sare publikoaren ezarpenetan"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Aldatu da sare publikoaren banda."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Gailuak ez du onartzen 5GHz-ko banda soilik erabiltzeko hobespena. Horren ordez, erabilgarri dagoen bakoitzean erabiliko da 5GHz-ko banda."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g> erabiltzen ari zara orain"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> Internetera konektatzeko gauza ez denean, <xliff:g id="NEW_NETWORK">%1$s</xliff:g> erabiltzen du gailuak. Agian kostuak ordaindu beharko dituzu."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> erabiltzen ari zinen, baina <xliff:g id="NEW_NETWORK">%2$s</xliff:g> erabiltzen ari zara orain"</string>
diff --git a/core/res/res/values-fa/strings.xml b/core/res/res/values-fa/strings.xml
index 3d9967c1027..359e730783f 100644
--- a/core/res/res/values-fa/strings.xml
+++ b/core/res/res/values-fa/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"         .             ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">" <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>        <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  .     ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">" <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>  "</string>
diff --git a/core/res/res/values-fi/strings.xml b/core/res/res/values-fi/strings.xml
index 6dfbcadb16b..af2ae3cd356 100644
--- a/core/res/res/values-fi/strings.xml
+++ b/core/res/res/values-fi/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi ei ole yhteydess internetiin"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Nyt vaihtoehdot napauttamalla."</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Hotspot-asetustesi muutokset"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Hotspot-taajuutesi on muuttunut."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Tm laite ei tue asetustasi (vain 5GHz). Sen sijaan laite kytt 5GHz:n taajuutta sen ollessa kytettviss."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g> otettiin kyttn"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="NEW_NETWORK">%1$s</xliff:g> otetaan kyttn, kun <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> ei voi muodostaa yhteytt internetiin. Veloitukset ovat mahdollisia."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> poistettiin kytst ja <xliff:g id="NEW_NETWORK">%2$s</xliff:g> otettiin kyttn."</string>
diff --git a/core/res/res/values-fr-rCA/strings.xml b/core/res/res/values-fr-rCA/strings.xml
index 0ddae2a810b..fbcdcf9a9a1 100644
--- a/core/res/res/values-fr-rCA/strings.xml
+++ b/core/res/res/values-fr-rCA/strings.xml
@@ -272,22 +272,22 @@
     <string name="managed_profile_label" msgid="8947929265267690522">"Passer au profil professionnel"</string>
     <string name="permgrouplab_contacts" msgid="3657758145679177612">"Contacts"</string>
     <string name="permgroupdesc_contacts" msgid="6951499528303668046">"accder  vos contacts"</string>
-    <string name="permgrouprequest_contacts" msgid="6032805601881764300">"Autoriser <xliff:g id="APP_NAME">%1$s</xliff:g>  accder  vos contacts?"</string>
+    <string name="permgrouprequest_contacts" msgid="6032805601881764300">"Autoriser &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;  accder  vos contacts?"</string>
     <string name="permgrouplab_location" msgid="7275582855722310164">"Localisation"</string>
     <string name="permgroupdesc_location" msgid="1346617465127855033">"accder  la position de cet appareil"</string>
     <string name="permgrouprequest_location" msgid="3788275734953323491">"Autoriser &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;  accder  la position de cet appareil?"</string>
     <string name="permgrouplab_calendar" msgid="5863508437783683902">"Agenda"</string>
     <string name="permgroupdesc_calendar" msgid="3889615280211184106">"accder  votre agenda"</string>
-    <string name="permgrouprequest_calendar" msgid="289900767793189421">"Autoriser <xliff:g id="APP_NAME">%1$s</xliff:g>  accder  votre agenda?"</string>
+    <string name="permgrouprequest_calendar" msgid="289900767793189421">"Autoriser &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;  accder  votre agenda?"</string>
     <string name="permgrouplab_sms" msgid="228308803364967808">"Messagerie texte"</string>
     <string name="permgroupdesc_sms" msgid="4656988620100940350">"envoyer et afficher des messages texte"</string>
-    <string name="permgrouprequest_sms" msgid="7168124215838204719">"Autoriser <xliff:g id="APP_NAME">%1$s</xliff:g>  envoyer et  afficher des messages texte?"</string>
+    <string name="permgrouprequest_sms" msgid="7168124215838204719">"Autoriser &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;   envoyer et  afficher des messages texte?"</string>
     <string name="permgrouplab_storage" msgid="1971118770546336966">"Stockage"</string>
     <string name="permgroupdesc_storage" msgid="637758554581589203">"accder aux photos, aux contenus multimdias et aux fichiers sur votre appareil"</string>
     <string name="permgrouprequest_storage" msgid="7885942926944299560">"Autoriser <xliff:g id="APP_NAME">%1$s</xliff:g>  accder aux photos, aux mdias et aux fichiers de votre appareil?"</string>
     <string name="permgrouplab_microphone" msgid="171539900250043464">"Microphone"</string>
     <string name="permgroupdesc_microphone" msgid="4988812113943554584">"enregistrer des fichiers audio"</string>
-    <string name="permgrouprequest_microphone" msgid="9167492350681916038">"Autoriser <xliff:g id="APP_NAME">%1$s</xliff:g>  enregistrer de l\'audio?"</string>
+    <string name="permgrouprequest_microphone" msgid="9167492350681916038">"Autoriser &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&amp;gt  enregistrer l\'audio?"</string>
     <string name="permgrouplab_camera" msgid="4820372495894586615">"Appareil photo"</string>
     <string name="permgroupdesc_camera" msgid="3250611594678347720">"prendre des photos et filmer des vidos"</string>
     <string name="permgrouprequest_camera" msgid="1299833592069671756">"Autoriser <xliff:g id="APP_NAME">%1$s</xliff:g>  prendre des photos et  filmer des vidos?"</string>
@@ -296,7 +296,7 @@
     <string name="permgrouprequest_calllog" msgid="8487355309583773267">"Autoriser &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;  accder  vos journaux d\'appels?"</string>
     <string name="permgrouplab_phone" msgid="5229115638567440675">"Tlphone"</string>
     <string name="permgroupdesc_phone" msgid="6234224354060641055">"faire et grer des appels tlphoniques"</string>
-    <string name="permgrouprequest_phone" msgid="9166979577750581037">"Autoriser <xliff:g id="APP_NAME">%1$s</xliff:g>  faire et  grer les appels tlphoniques?"</string>
+    <string name="permgrouprequest_phone" msgid="9166979577750581037">"Autoriser &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;  faire et  grer les appels tlphoniques?"</string>
     <string name="permgrouplab_sensors" msgid="416037179223226722">"Capteurs corporels"</string>
     <string name="permgroupdesc_sensors" msgid="7147968539346634043">"accder aux donnes des capteurs sur vos signes vitaux"</string>
     <string name="permgrouprequest_sensors" msgid="6349806962814556786">"Autoriser <xliff:g id="APP_NAME">%1$s</xliff:g>  accder aux donnes des capteurs pour vos signes vitaux?"</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Le rseau Wi-Fi ne dispose d\'aucun accs  Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Touchez pour afficher les options"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Modifications apportes  vos paramtres de point d\'accs"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"La bande de votre point d\'accs a chang."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Cet appareil ne prend pas en charge votre prfrence pour la bande de 5GHz seulement. Au lieu de cela, cet appareil utilisera la bande de 5GHz lorsqu\'elle sera disponible."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Pass au rseau <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"L\'appareil utilise <xliff:g id="NEW_NETWORK">%1$s</xliff:g> quand <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> n\'a pas d\'accs  Internet. Des frais peuvent s\'appliquer."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Pass du rseau <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> au <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-fr/strings.xml b/core/res/res/values-fr/strings.xml
index 7425d7396f8..c556a9af76b 100644
--- a/core/res/res/values-fr/strings.xml
+++ b/core/res/res/values-fr/strings.xml
@@ -293,7 +293,7 @@
     <string name="permgrouprequest_camera" msgid="1299833592069671756">"Permettre  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; de prendre des photos et de filmer des vidos?"</string>
     <string name="permgrouplab_calllog" msgid="8798646184930388160">"Journaux d\'appels"</string>
     <string name="permgroupdesc_calllog" msgid="3006237336748283775">"Lire et crire les journaux d\'appels du tlphone"</string>
-    <string name="permgrouprequest_calllog" msgid="8487355309583773267">"Autoriser &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;  accder aux journaux d\'appels de votre tlphone?"</string>
+    <string name="permgrouprequest_calllog" msgid="8487355309583773267">"Permettre  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; d\'accder aux journaux d\'appels de votre tlphone?"</string>
     <string name="permgrouplab_phone" msgid="5229115638567440675">"Tlphone"</string>
     <string name="permgroupdesc_phone" msgid="6234224354060641055">"effectuer et grer des appels tlphoniques"</string>
     <string name="permgrouprequest_phone" msgid="9166979577750581037">"Permettre  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; de passer et grer des appels tlphoniques?"</string>
@@ -605,7 +605,7 @@
     <string name="policylab_disableCamera" msgid="6395301023152297826">"Dsactiver les appareils photo"</string>
     <string name="policydesc_disableCamera" msgid="2306349042834754597">"Empcher l\'utilisation de tous les appareils photos"</string>
     <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Dsact. options du verr. cran"</string>
-    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Empchez l\'utilisation de certaines fonctionnalits du verrouillage de l\'cran."</string>
+    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Empcher l\'utilisation de certaines fonctionnalits du verrouillage de l\'cran."</string>
   <string-array name="phoneTypes">
     <item msgid="8901098336658710359">"Domicile"</item>
     <item msgid="869923650527136615">"Mobile"</item>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Impossible de se connecter  Internet via le rseau Wi-Fi"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Appuyez ici pour afficher des options."</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Modifications apportes  vos paramtres de point d\'accs"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Votre bande de point d\'accs a t modifie."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Cet appareil n\'est pas compatible avec votre prfrence d\'utilisation de la bande 5GHz uniquement. Il utilisera la bande 5GHz lorsqu\'elle sera disponible."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Nouveau rseau: <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"L\'appareil utilise <xliff:g id="NEW_NETWORK">%1$s</xliff:g> lorsque <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> n\'a pas de connexion Internet. Des frais peuvent s\'appliquer."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Ancien rseau: <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>. Nouveau rseau: <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-gl/strings.xml b/core/res/res/values-gl/strings.xml
index 088ef5158ac..9759f7acb51 100644
--- a/core/res/res/values-gl/strings.xml
+++ b/core/res/res/values-gl/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"A wifi non ten acceso a Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Toca para ver opcins."</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Cambios na configuracin da zona wifi"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Modificouse a banda da zona wifi."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Este dispositivo non admite a opcin de conectarse s a bandas de 5GHz, pero usaraas se estn dispoibles."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Cambiouse a: <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"O dispositivo utiliza <xliff:g id="NEW_NETWORK">%1$s</xliff:g> cando <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> non ten acceso a Internet. Pdense aplicar cargos."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Cambiouse de <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> a <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-gu/strings.xml b/core/res/res/values-gu/strings.xml
index 3a42f3a09fb..220c7cc3185 100644
--- a/core/res/res/values-gu/strings.xml
+++ b/core/res/res/values-gu/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"-    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"    ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"    5GHz     .  ,     5GHz       ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>   "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>         <xliff:g id="NEW_NETWORK">%1$s</xliff:g>   .     ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>   "</string>
diff --git a/core/res/res/values-hi/strings.xml b/core/res/res/values-hi/strings.xml
index dd15ada4ea3..e4caa4d4fc8 100644
--- a/core/res/res/values-hi/strings.xml
+++ b/core/res/res/values-hi/strings.xml
@@ -275,7 +275,7 @@
     <string name="permgrouprequest_contacts" msgid="6032805601881764300">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;         ?"</string>
     <string name="permgrouplab_location" msgid="7275582855722310164">""</string>
     <string name="permgroupdesc_location" msgid="1346617465127855033">"      "</string>
-    <string name="permgrouprequest_location" msgid="3788275734953323491">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;             ?"</string>
+    <string name="permgrouprequest_location" msgid="3788275734953323491">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;     \'  \'       ?"</string>
     <string name="permgrouplab_calendar" msgid="5863508437783683902">""</string>
     <string name="permgroupdesc_calendar" msgid="3889615280211184106">"    "</string>
     <string name="permgrouprequest_calendar" msgid="289900767793189421">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;         ?"</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"-       "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"    "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"         "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"   5          ,    5    ,     ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>    "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>         <xliff:g id="NEW_NETWORK">%1$s</xliff:g>    .       ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>    "</string>
@@ -1673,7 +1676,7 @@
       <item quantity="other"><xliff:g id="COUNT">%d</xliff:g>   :  </item>
     </plurals>
     <string name="restr_pin_try_later" msgid="973144472490532377">"     "</string>
-    <string name="immersive_cling_title" msgid="8394201622932303336">"   "</string>
+    <string name="immersive_cling_title" msgid="8394201622932303336">"      "</string>
     <string name="immersive_cling_description" msgid="3482371193207536040">"   ,     ."</string>
     <string name="immersive_cling_positive" msgid="5016839404568297683">" "</string>
     <string name="done_label" msgid="2093726099505892398">" "</string>
diff --git a/core/res/res/values-hr/strings.xml b/core/res/res/values-hr/strings.xml
index d2c51f253d9..e910613d378 100644
--- a/core/res/res/values-hr/strings.xml
+++ b/core/res/res/values-hr/strings.xml
@@ -1197,6 +1197,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi nema pristup internetu"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Dodirnite za opcije"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Promjene postavki vae arine toke"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Promijenila se frekvencija vae arine toke."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Ovaj ureaj ne podrava vau postavku za upotrebu samo 5 GHz. Upotrebljavat e frekvenciju od 5 GHz kada je dostupna."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Prelazak na drugu mreu: <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Kada <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nema pristup internetu, na ureaju se upotrebljava <xliff:g id="NEW_NETWORK">%1$s</xliff:g>. Mogua je naplata naknade."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Mrea je promijenjena: <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> &gt; <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-hu/strings.xml b/core/res/res/values-hu/strings.xml
index 74104b1b92d..99b45ba00d6 100644
--- a/core/res/res/values-hu/strings.xml
+++ b/core/res/res/values-hu/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"A Wi-Fi-hlzaton nincs internetkapcsolat"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Koppintson a belltsok megjelentshez"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"A hotspot belltsainak mdostsa"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"A hotspot svja megvltozott."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Ez az eszkz nem tmogatja a csak 5 GHz-es svra vonatkoz belltst. Az eszkz akkor hasznl 5 GHz-es svot, ha a sv rendelkezsre ll."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"tvltva erre: <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="NEW_NETWORK">%1$s</xliff:g> hasznlata, ha nincs internet-hozzfrs <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>-kapcsolaton keresztl. A szolgltat djat szmthat fel."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"tvltva <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>-hlzatrl erre: <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-hy/strings.xml b/core/res/res/values-hy/strings.xml
index cb26a1a244f..a266f8160bd 100644
--- a/core/res/res/values-hy/strings.xml
+++ b/core/res/res/values-hy/strings.xml
@@ -219,16 +219,16 @@
     <string name="global_action_emergency" msgid="7112311161137421166">" "</string>
     <string name="global_action_bug_report" msgid="7934010578922304799">" "</string>
     <string name="global_action_logout" msgid="935179188218826050">" "</string>
-    <string name="global_action_screenshot" msgid="8329831278085426283">" "</string>
+    <string name="global_action_screenshot" msgid="8329831278085426283">""</string>
     <string name="bugreport_title" msgid="2667494803742548533">"  "</string>
     <string name="bugreport_message" msgid="398447048750350456">"            :          :   -  :"</string>
     <string name="bugreport_option_interactive_title" msgid="8635056131768862479">" "</string>
-    <string name="bugreport_option_interactive_summary" msgid="229299488536107968">"   :         ,         :        ,     :"</string>
+    <string name="bugreport_option_interactive_summary" msgid="229299488536107968">"   :         ,        :        ,     :"</string>
     <string name="bugreport_option_full_title" msgid="6354382025840076439">" "</string>
     <string name="bugreport_option_full_summary" msgid="7210859858969115745">"               ,        :           :"</string>
     <plurals name="bugreport_countdown" formatted="false" msgid="6878900193900090368">
-      <item quantity="one">        <xliff:g id="NUMBER_1">%d</xliff:g> :</item>
-      <item quantity="other">        <xliff:g id="NUMBER_1">%d</xliff:g> :</item>
+      <item quantity="one">  <xliff:g id="NUMBER_1">%d</xliff:g> :</item>
+      <item quantity="other">  <xliff:g id="NUMBER_1">%d</xliff:g> :</item>
     </plurals>
     <string name="global_action_toggle_silent_mode" msgid="8219525344246810925">" "</string>
     <string name="global_action_silent_mode_on_status" msgid="3289841937003758806">"  "</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"     5       "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"  <xliff:g id="NETWORK_TYPE">%1$s</xliff:g> "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>     ,    <xliff:g id="NEW_NETWORK">%1$s</xliff:g> :      :"</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>    <xliff:g id="NEW_NETWORK">%2$s</xliff:g> "</string>
@@ -1814,7 +1817,7 @@
     <string name="app_category_social" msgid="5842783057834965912">"  "</string>
     <string name="app_category_news" msgid="7496506240743986873">"  "</string>
     <string name="app_category_maps" msgid="5878491404538024367">"  "</string>
-    <string name="app_category_productivity" msgid="3742083261781538852">""</string>
+    <string name="app_category_productivity" msgid="3742083261781538852">""</string>
     <string name="device_storage_monitor_notification_channel" msgid="3295871267414816228">" "</string>
     <string name="adb_debugging_notification_channel_tv" msgid="5537766997350092316">"USB "</string>
     <string name="time_picker_hour_label" msgid="2979075098868106450">""</string>
diff --git a/core/res/res/values-in/strings.xml b/core/res/res/values-in/strings.xml
index 6368a6c76cf..9cbeaca3f3a 100644
--- a/core/res/res/values-in/strings.xml
+++ b/core/res/res/values-in/strings.xml
@@ -584,14 +584,14 @@
     <string name="policydesc_watchLogin_secondaryUser" product="tablet" msgid="4280246270601044505">"Memantau banyaknya sandi salah yang diketikkan saat membuka kunci layar, dan mengunci tablet atau menghapus semua data pengguna ini jika terlalu banyak sandi salah diketikkan."</string>
     <string name="policydesc_watchLogin_secondaryUser" product="TV" msgid="3484832653564483250">"Memantau banyaknya sandi salah yang diketikkan saat membuka kunci layar, dan mengunci TV atau menghapus semua data pengguna ini jika terlalu banyak sandi salah diketikkan."</string>
     <string name="policydesc_watchLogin_secondaryUser" product="default" msgid="2185480427217127147">"Memantau banyaknya sandi salah yang diketikkan saat membuka kunci layar, dan mengunci ponsel atau menghapus semua data pengguna ini jika terlalu banyak sandi salah diketikkan."</string>
-    <string name="policylab_resetPassword" msgid="4934707632423915395">"Ubah kunci layar"</string>
+    <string name="policylab_resetPassword" msgid="4934707632423915395">"Mengubah kunci layar"</string>
     <string name="policydesc_resetPassword" msgid="1278323891710619128">"Mengubah kunci layar."</string>
-    <string name="policylab_forceLock" msgid="2274085384704248431">"Kunci layar"</string>
-    <string name="policydesc_forceLock" msgid="1141797588403827138">"Kontrol cara dan kapan layar mengunci."</string>
-    <string name="policylab_wipeData" msgid="3910545446758639713">"Hapus semua data"</string>
+    <string name="policylab_forceLock" msgid="2274085384704248431">"Mengunci layar"</string>
+    <string name="policydesc_forceLock" msgid="1141797588403827138">"Mengontrol cara dan kapan layar mengunci."</string>
+    <string name="policylab_wipeData" msgid="3910545446758639713">"Menghapus semua data"</string>
     <string name="policydesc_wipeData" product="tablet" msgid="4306184096067756876">"Hapus data tablet tanpa peringatan dengan menyetel ulang data pabrik."</string>
     <string name="policydesc_wipeData" product="tv" msgid="5816221315214527028">"Menghapus data TV tanpa peringatan dengan mengembalikan ke setelan pabrik."</string>
-    <string name="policydesc_wipeData" product="default" msgid="5096895604574188391">"Hapus data ponsel tanpa peringatan dengan menyetel ulang data pabrik."</string>
+    <string name="policydesc_wipeData" product="default" msgid="5096895604574188391">"Menghapus data ponsel tanpa peringatan dengan melakukan reset ke setelan pabrik."</string>
     <string name="policylab_wipeData_secondaryUser" msgid="8362863289455531813">"Menghapus data pengguna"</string>
     <string name="policydesc_wipeData_secondaryUser" product="tablet" msgid="6336255514635308054">"Menghapus data pengguna ini di tablet ini tanpa peringatan."</string>
     <string name="policydesc_wipeData_secondaryUser" product="tv" msgid="2086473496848351810">"Menghapus data pengguna ini di TV ini tanpa peringatan."</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi tidak memiliki akses internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tap untuk melihat opsi"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Perubahan pada setelan hotspot Anda"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Pita hotspot Anda telah berubah."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Perangkat ini tidak mendukung preferensi Anda, yaitu hanya 5GHz. Sebagai gantinya, perangkat ini akan menggunakan pita frekuensi 5GHz jika tersedia."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Dialihkan ke <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Perangkat menggunakan <xliff:g id="NEW_NETWORK">%1$s</xliff:g> jika <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> tidak memiliki akses internet. Tarif mungkin berlaku."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Dialihkan dari <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> ke <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-is/strings.xml b/core/res/res/values-is/strings.xml
index 280ccd8552e..36a7b34ee74 100644
--- a/core/res/res/values-is/strings.xml
+++ b/core/res/res/values-is/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi er ekki me tengingu vi interneti"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"ttu til a sj valkosti"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Breytingar  stillingum heits reits"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Tnisvi heita reitsins hefur breyst."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"etta tki styur ekki val itt fyrir aeins 5 GHz.  stainn mun etta tki nota 5 GHz tnisvi egar a er  boi."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Skipt yfir  <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Tki notar <xliff:g id="NEW_NETWORK">%1$s</xliff:g> egar <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> er ekki me internetagang. Gjld kunna a eiga vi."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Skipt r <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> yfir  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-it/strings.xml b/core/res/res/values-it/strings.xml
index 6eab08bc451..113a824f47b 100644
--- a/core/res/res/values-it/strings.xml
+++ b/core/res/res/values-it/strings.xml
@@ -272,31 +272,31 @@
     <string name="managed_profile_label" msgid="8947929265267690522">"Passa a profilo di lavoro"</string>
     <string name="permgrouplab_contacts" msgid="3657758145679177612">"Contatti"</string>
     <string name="permgroupdesc_contacts" msgid="6951499528303668046">"accedere ai contatti"</string>
-    <string name="permgrouprequest_contacts" msgid="6032805601881764300">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere ai tuoi contatti?"</string>
+    <string name="permgrouprequest_contacts" msgid="6032805601881764300">"Consentire all\'app &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere ai tuoi contatti?"</string>
     <string name="permgrouplab_location" msgid="7275582855722310164">"Geolocalizzazione"</string>
     <string name="permgroupdesc_location" msgid="1346617465127855033">"accedere alla posizione di questo dispositivo"</string>
-    <string name="permgrouprequest_location" msgid="3788275734953323491">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere alla posizione di questo dispositivo?"</string>
+    <string name="permgrouprequest_location" msgid="3788275734953323491">"Consentire all\'app &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere alla posizione di questo dispositivo?"</string>
     <string name="permgrouplab_calendar" msgid="5863508437783683902">"Calendario"</string>
     <string name="permgroupdesc_calendar" msgid="3889615280211184106">"accedere al calendario"</string>
-    <string name="permgrouprequest_calendar" msgid="289900767793189421">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere al tuo calendario?"</string>
+    <string name="permgrouprequest_calendar" msgid="289900767793189421">"Consentire all\'app &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere al tuo calendario?"</string>
     <string name="permgrouplab_sms" msgid="228308803364967808">"SMS"</string>
     <string name="permgroupdesc_sms" msgid="4656988620100940350">"inviare e visualizzare SMS"</string>
-    <string name="permgrouprequest_sms" msgid="7168124215838204719">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di inviare e visualizzare SMS?"</string>
+    <string name="permgrouprequest_sms" msgid="7168124215838204719">"Consentire all\'app &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di inviare e visualizzare SMS?"</string>
     <string name="permgrouplab_storage" msgid="1971118770546336966">"Archiviazione"</string>
     <string name="permgroupdesc_storage" msgid="637758554581589203">"accedere a foto, contenuti multimediali e file sul dispositivo"</string>
     <string name="permgrouprequest_storage" msgid="7885942926944299560">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere a foto, contenuti multimediali e file memorizzati sul dispositivo?"</string>
     <string name="permgrouplab_microphone" msgid="171539900250043464">"Microfono"</string>
     <string name="permgroupdesc_microphone" msgid="4988812113943554584">"registrare audio"</string>
-    <string name="permgrouprequest_microphone" msgid="9167492350681916038">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di registrare audio?"</string>
+    <string name="permgrouprequest_microphone" msgid="9167492350681916038">"Consentire all\'app &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di registrare audio?"</string>
     <string name="permgrouplab_camera" msgid="4820372495894586615">"Fotocamera"</string>
     <string name="permgroupdesc_camera" msgid="3250611594678347720">"scattare foto e registrare video"</string>
     <string name="permgrouprequest_camera" msgid="1299833592069671756">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di scattare foto e registrare video?"</string>
     <string name="permgrouplab_calllog" msgid="8798646184930388160">"Registri chiamate"</string>
     <string name="permgroupdesc_calllog" msgid="3006237336748283775">"leggere e scrivere il registro chiamate del telefono"</string>
-    <string name="permgrouprequest_calllog" msgid="8487355309583773267">"Vuoi consentire all\'app &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere ai registri chiamate del tuo telefono?"</string>
+    <string name="permgrouprequest_calllog" msgid="8487355309583773267">"Consentire all\'app &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere ai registri chiamate del tuo telefono?"</string>
     <string name="permgrouplab_phone" msgid="5229115638567440675">"Telefono"</string>
     <string name="permgroupdesc_phone" msgid="6234224354060641055">"eseguire e gestire le telefonate"</string>
-    <string name="permgrouprequest_phone" msgid="9166979577750581037">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di effettuare e gestire telefonate?"</string>
+    <string name="permgrouprequest_phone" msgid="9166979577750581037">"Consentire all\'app &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di effettuare e gestire telefonate?"</string>
     <string name="permgrouplab_sensors" msgid="416037179223226722">"Sensori per il corpo"</string>
     <string name="permgroupdesc_sensors" msgid="7147968539346634043">"accedere ai dati dei sensori relativi ai tuoi parametri vitali"</string>
     <string name="permgrouprequest_sensors" msgid="6349806962814556786">"Consentire a &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; di accedere ai dati dei sensori relativi ai parametri vitali?"</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"La rete Wi-Fi non ha accesso a Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tocca per le opzioni"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Modifiche alle tue impostazioni dell\'hotspot"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"La tua banda di hotspot  cambiata."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Questo dispositivo non supporta la tua preferenza esclusiva per 5 GHz. Utilizzer invece la banda a 5 GHz solo quando  disponibile."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Passato a <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Il dispositivo utilizza <xliff:g id="NEW_NETWORK">%1$s</xliff:g> quando <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> non ha accesso a Internet. Potrebbero essere applicati costi."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Passato da <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> a <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-iw/strings.xml b/core/res/res/values-iw/strings.xml
index 0dd931839e8..bb747a34100 100644
--- a/core/res/res/values-iw/strings.xml
+++ b/core/res/res/values-iw/strings.xml
@@ -1084,7 +1084,7 @@
     <string name="capital_on" msgid="1544682755514494298">""</string>
     <string name="capital_off" msgid="6815870386972805832">""</string>
     <string name="whichApplication" msgid="4533185947064773386">"  "</string>
-    <string name="whichApplicationNamed" msgid="8260158865936942783">"    %1$s"</string>
+    <string name="whichApplicationNamed" msgid="8260158865936942783">"   %1$s"</string>
     <string name="whichApplicationLabel" msgid="7425855495383818784">" "</string>
     <string name="whichViewApplication" msgid="3272778576700572102">" "</string>
     <string name="whichViewApplicationNamed" msgid="2286418824011249620">"  %1$s"</string>
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">" -Wi-Fi   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"     "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"      -5GHz .  ,     5GHz  ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"  <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"   <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>   .   ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"  <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-ja/strings.xml b/core/res/res/values-ja/strings.xml
index 9bb9292ee5c..55efcf5fd06 100644
--- a/core/res/res/values-ja/strings.xml
+++ b/core/res/res/values-ja/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"WiFi "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">""</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">" "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">" "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" 5 GHz 5 GHz "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g><xliff:g id="NEW_NETWORK">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g><xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-ka/strings.xml b/core/res/res/values-ka/strings.xml
index e6f4839b4b0..b8794e1c26f 100644
--- a/core/res/res/values-ka/strings.xml
+++ b/core/res/res/values-ka/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"WiFi     "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"    ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"     5   .     ,   ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"  <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>   ,   <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  ,     ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"  <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> ( <xliff:g id="NEW_NETWORK">%2$s</xliff:g>)"</string>
diff --git a/core/res/res/values-kk/strings.xml b/core/res/res/values-kk/strings.xml
index 5e8eb20f2f6..392b02f12d9 100644
--- a/core/res/res/values-kk/strings.xml
+++ b/core/res/res/values-kk/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"  ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"   5     .       ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>      <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  .    ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>  "</string>
diff --git a/core/res/res/values-km/strings.xml b/core/res/res/values-km/strings.xml
index 1a9fadcd8bd..3959da68402 100644
--- a/core/res/res/values-km/strings.xml
+++ b/core/res/res/values-km/strings.xml
@@ -1177,6 +1177,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">""</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">""</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">""</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" 5GHz    5GHz "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">" <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>  "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">" <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-kn/strings.xml b/core/res/res/values-kn/strings.xml
index e3e079bf254..e835aea448a 100644
--- a/core/res/res/values-kn/strings.xml
+++ b/core/res/res/values-kn/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"     "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"  5GHz     . ,   5GHz    ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>   ,  <xliff:g id="NEW_NETWORK">%1$s</xliff:g> .  ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>  "</string>
diff --git a/core/res/res/values-ko/strings.xml b/core/res/res/values-ko/strings.xml
index c29273843ae..0d208266daa 100644
--- a/core/res/res/values-ko/strings.xml
+++ b/core/res/res/values-ko/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"  "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"  ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"  5GHz    .     5GHz  ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>() "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>()       <xliff:g id="NEW_NETWORK">%1$s</xliff:g>() .    ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> <xliff:g id="NEW_NETWORK">%2$s</xliff:g>() "</string>
@@ -1673,7 +1676,7 @@
       <item quantity="one">1   .</item>
     </plurals>
     <string name="restr_pin_try_later" msgid="973144472490532377">"  "</string>
-    <string name="immersive_cling_title" msgid="8394201622932303336">"   "</string>
+    <string name="immersive_cling_title" msgid="8394201622932303336">"  "</string>
     <string name="immersive_cling_description" msgid="3482371193207536040">"   ."</string>
     <string name="immersive_cling_positive" msgid="5016839404568297683">""</string>
     <string name="done_label" msgid="2093726099505892398">""</string>
diff --git a/core/res/res/values-ky/strings.xml b/core/res/res/values-ky/strings.xml
index f52eb01f2fb..acc011b8431 100644
--- a/core/res/res/values-ky/strings.xml
+++ b/core/res/res/values-ky/strings.xml
@@ -757,7 +757,7 @@
     <string name="lockscreen_transport_stop_description" msgid="5907083260651210034">""</string>
     <string name="lockscreen_transport_rew_description" msgid="6944412838651990410">" "</string>
     <string name="lockscreen_transport_ffw_description" msgid="42987149870928985">" "</string>
-    <string name="emergency_calls_only" msgid="6733978304386365407">"  "</string>
+    <string name="emergency_calls_only" msgid="6733978304386365407">"    "</string>
     <string name="lockscreen_network_locked_message" msgid="143389224986028501">" "</string>
     <string name="lockscreen_sim_puk_locked_message" msgid="7441797339976230">"SIM- PUK-."</string>
     <string name="lockscreen_sim_puk_locked_instructions" msgid="8127916255245181063">"       ."</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"    "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"  5     .  ,   5     ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>    ,  <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  .   ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>  "</string>
diff --git a/core/res/res/values-lo/strings.xml b/core/res/res/values-lo/strings.xml
index c27ffe7ad34..042423bc13b 100644
--- a/core/res/res/values-lo/strings.xml
+++ b/core/res/res/values-lo/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">""</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">""</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" 5GHz .  5GHz ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">" <xliff:g id="NETWORK_TYPE">%1$s</xliff:g> "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> . ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">" <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g> "</string>
diff --git a/core/res/res/values-lt/strings.xml b/core/res/res/values-lt/strings.xml
index 85173516f82..1a5443b085d 100644
--- a/core/res/res/values-lt/strings.xml
+++ b/core/res/res/values-lt/strings.xml
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"WiFi tinkle nra interneto ryio"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Palieskite, kad bt rodomos parinktys."</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Vieosios interneto prieigos tako nustatym pakeitimai"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Vieosios prieigos tako danio juosta pasikeit."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"iame renginyje nepalaikoma tik 5 GHz nuostata. Vietoj to iame renginyje bus naudojama 5 GHz danio juosta, kai bus pasiekiama."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Perjungta  tinkl <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"renginyje naudojamas kitas tinklas (<xliff:g id="NEW_NETWORK">%1$s</xliff:g>), kai dabartiniame tinkle (<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>) nra interneto ryio. Gali bti taikomi mokesiai."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Perjungta i tinklo <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  tinkl <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-lv/strings.xml b/core/res/res/values-lv/strings.xml
index 591f320925f..b1184523053 100644
--- a/core/res/res/values-lv/strings.xml
+++ b/core/res/res/values-lv/strings.xml
@@ -1197,6 +1197,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi tkl nav piekuves internetam."</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Pieskarieties, lai skattu iespjas."</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Izmaias tklja iestatjumos"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Ir maints tklja joslas platums."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"aj ierc netiek atbalstta jsu preference par tikai 5GHz joslu. 5GHz josla ierc tiks izmantota, kad t bs pieejama."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Prsldzs uz tklu <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Kad vien tkl (<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>) nav piekuves internetam, ierc tiek izmantots cits tkls (<xliff:g id="NEW_NETWORK">%1$s</xliff:g>). Var tikt piemrota maksa."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Prsldzs no tkla <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> uz tklu <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-mcc214-mnc01/config.xml b/core/res/res/values-mcc214-mnc01/config.xml
index 24150a782d2..41e24d77936 100644
--- a/core/res/res/values-mcc214-mnc01/config.xml
+++ b/core/res/res/values-mcc214-mnc01/config.xml
@@ -40,4 +40,7 @@
       <item>INTERNET,airtelnet.es,,,vodafone,vodafone,,,,,214,01,1,DUN</item>
     </string-array>
 
+    <!-- Whether safe headphone volume warning dialog is disabled on Vol+ (operator specific). -->
+    <bool name="config_safe_media_disable_on_volume_up">false</bool>
+
 </resources>
diff --git a/core/res/res/values-mcc214/config.xml b/core/res/res/values-mcc214/config.xml
new file mode 100644
index 00000000000..941084865be
--- /dev/null
+++ b/core/res/res/values-mcc214/config.xml
@@ -0,0 +1,28 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+/*
+** Copyright 2018, The Android Open Source Project
+**
+** Licensed under the Apache License, Version 2.0 (the "License");
+** you may not use this file except in compliance with the License.
+** You my obtain a copy of the License at
+**
+**     http://www.apache.org/licenses/LICENSE-2.0
+**
+** Unless required by applicable law or agreed to in writing, software
+** distributed under the License is distributed on an "AS IS" BASIS,
+** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+** See the License for the specific language governing permissions and
+** limitations under the License.
+*/
+-->
+
+<!-- These resources are around just to allow their values to be customized
+     for different hardware and product builds. -->
+<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
+  <!-- String array containing numbers that shouldn't be logged
+       016 present here for Spain's gender violence number -->
+  <string-array translatable="false" name="unloggable_phone_numbers">
+    <item>016</item>
+  </string-array>
+</resources>
diff --git a/core/res/res/values-mcc222-mnc10/config.xml b/core/res/res/values-mcc222-mnc10/config.xml
index c819de2ba43..0085a1b7e19 100644
--- a/core/res/res/values-mcc222-mnc10/config.xml
+++ b/core/res/res/values-mcc222-mnc10/config.xml
@@ -28,4 +28,8 @@
     <string-array translatable="false" name="config_tether_apndata">
       <item>Tethering Internet,web.omnitel.it,,,,,,,,,222,10,,DUN</item>
     </string-array>
+
+    <!-- Whether safe headphone volume warning dialog is disabled on Vol+ (operator specific). -->
+    <bool name="config_safe_media_disable_on_volume_up">false</bool>
+
 </resources>
diff --git a/core/res/res/values-mcc234-mnc15/config.xml b/core/res/res/values-mcc234-mnc15/config.xml
new file mode 100644
index 00000000000..84e779d240d
--- /dev/null
+++ b/core/res/res/values-mcc234-mnc15/config.xml
@@ -0,0 +1,25 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+/*
+** Copyright 2018, The Android Open Source Project
+**
+** Licensed under the Apache License, Version 2.0 (the "License");
+** you may not use this file except in compliance with the License.
+** You may obtain a copy of the License at
+**
+**     http://www.apache.org/licenses/LICENSE-2.0
+**
+** Unless required by applicable law or agreed to in writing, software
+** distributed under the License is distributed on an "AS IS" BASIS,
+** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+** See the License for the specific language governing permissions and
+** limitations under the License.
+*/
+-->
+
+<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
+
+    <!-- Whether safe headphone volume warning dialog is disabled on Vol+ (operator specific). -->
+    <bool name="config_safe_media_disable_on_volume_up">false</bool>
+
+</resources>
diff --git a/core/res/res/values-mcc234-mnc91/config.xml b/core/res/res/values-mcc234-mnc91/config.xml
new file mode 100644
index 00000000000..84e779d240d
--- /dev/null
+++ b/core/res/res/values-mcc234-mnc91/config.xml
@@ -0,0 +1,25 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+/*
+** Copyright 2018, The Android Open Source Project
+**
+** Licensed under the Apache License, Version 2.0 (the "License");
+** you may not use this file except in compliance with the License.
+** You may obtain a copy of the License at
+**
+**     http://www.apache.org/licenses/LICENSE-2.0
+**
+** Unless required by applicable law or agreed to in writing, software
+** distributed under the License is distributed on an "AS IS" BASIS,
+** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+** See the License for the specific language governing permissions and
+** limitations under the License.
+*/
+-->
+
+<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
+
+    <!-- Whether safe headphone volume warning dialog is disabled on Vol+ (operator specific). -->
+    <bool name="config_safe_media_disable_on_volume_up">false</bool>
+
+</resources>
diff --git a/core/res/res/values-mcc262-mnc02/config.xml b/core/res/res/values-mcc262-mnc02/config.xml
new file mode 100644
index 00000000000..84e779d240d
--- /dev/null
+++ b/core/res/res/values-mcc262-mnc02/config.xml
@@ -0,0 +1,25 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+/*
+** Copyright 2018, The Android Open Source Project
+**
+** Licensed under the Apache License, Version 2.0 (the "License");
+** you may not use this file except in compliance with the License.
+** You may obtain a copy of the License at
+**
+**     http://www.apache.org/licenses/LICENSE-2.0
+**
+** Unless required by applicable law or agreed to in writing, software
+** distributed under the License is distributed on an "AS IS" BASIS,
+** WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+** See the License for the specific language governing permissions and
+** limitations under the License.
+*/
+-->
+
+<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
+
+    <!-- Whether safe headphone volume warning dialog is disabled on Vol+ (operator specific). -->
+    <bool name="config_safe_media_disable_on_volume_up">false</bool>
+
+</resources>
diff --git a/core/res/res/values-mcc302-mnc220/config.xml b/core/res/res/values-mcc302-mnc220/config.xml
index 8774334f11b..5343e7cea84 100644
--- a/core/res/res/values-mcc302-mnc220/config.xml
+++ b/core/res/res/values-mcc302-mnc220/config.xml
@@ -40,7 +40,7 @@
         <item>SUPL_PORT=7275</item>
         <item>SUPL_VER=0x20000</item>
         <item>SUPL_MODE=1</item>
-        <item>SUPL_ES=0</item>
+        <item>SUPL_ES=1</item>
         <item>LPP_PROFILE=3</item>
         <item>USE_EMERGENCY_PDN_FOR_EMERGENCY_SUPL=1</item>
         <item>A_GLONASS_POS_PROTOCOL_SELECT=0</item>
diff --git a/core/res/res/values-mcc302-mnc221/config.xml b/core/res/res/values-mcc302-mnc221/config.xml
index 05896b18cfb..cb9466be77b 100644
--- a/core/res/res/values-mcc302-mnc221/config.xml
+++ b/core/res/res/values-mcc302-mnc221/config.xml
@@ -38,7 +38,7 @@
         <item>SUPL_PORT=7275</item>
         <item>SUPL_VER=0x20000</item>
         <item>SUPL_MODE=1</item>
-        <item>SUPL_ES=0</item>
+        <item>SUPL_ES=1</item>
         <item>LPP_PROFILE=3</item>
         <item>USE_EMERGENCY_PDN_FOR_EMERGENCY_SUPL=1</item>
         <item>A_GLONASS_POS_PROTOCOL_SELECT=0</item>
diff --git a/core/res/res/values-mcc302-mnc370/config.xml b/core/res/res/values-mcc302-mnc370/config.xml
index 1241a9d029d..b520d5d95a3 100644
--- a/core/res/res/values-mcc302-mnc370/config.xml
+++ b/core/res/res/values-mcc302-mnc370/config.xml
@@ -41,7 +41,7 @@
         <item>SUPL_PORT=7275</item>
         <item>SUPL_VER=0x20000</item>
         <item>SUPL_MODE=1</item>
-        <item>SUPL_ES=0</item>
+        <item>SUPL_ES=1</item>
         <item>LPP_PROFILE=2</item>
         <item>USE_EMERGENCY_PDN_FOR_EMERGENCY_SUPL=1</item>
         <item>A_GLONASS_POS_PROTOCOL_SELECT=0</item>
diff --git a/core/res/res/values-mcc302-mnc610/config.xml b/core/res/res/values-mcc302-mnc610/config.xml
index 232f14969ad..650aa62b4a4 100644
--- a/core/res/res/values-mcc302-mnc610/config.xml
+++ b/core/res/res/values-mcc302-mnc610/config.xml
@@ -28,7 +28,7 @@
         <item>SUPL_PORT=7275</item>
         <item>SUPL_VER=0x20000</item>
         <item>SUPL_MODE=1</item>
-        <item>SUPL_ES=0</item>
+        <item>SUPL_ES=1</item>
         <item>LPP_PROFILE=2</item>
         <item>USE_EMERGENCY_PDN_FOR_EMERGENCY_SUPL=1</item>
         <item>A_GLONASS_POS_PROTOCOL_SELECT=0</item>
diff --git a/core/res/res/values-mcc302-mnc640/config.xml b/core/res/res/values-mcc302-mnc640/config.xml
index 1d2e625952f..4bb68dcf04b 100644
--- a/core/res/res/values-mcc302-mnc640/config.xml
+++ b/core/res/res/values-mcc302-mnc640/config.xml
@@ -24,7 +24,7 @@
         <item>SUPL_PORT=7275</item>
         <item>SUPL_VER=0x20000</item>
         <item>SUPL_MODE=1</item>
-        <item>SUPL_ES=0</item>
+        <item>SUPL_ES=1</item>
         <item>LPP_PROFILE=2</item>
         <item>USE_EMERGENCY_PDN_FOR_EMERGENCY_SUPL=1</item>
         <item>A_GLONASS_POS_PROTOCOL_SELECT=0</item>
diff --git a/core/res/res/values-mcc302-mnc720/config.xml b/core/res/res/values-mcc302-mnc720/config.xml
index ef1ecd29845..11bfa056d29 100644
--- a/core/res/res/values-mcc302-mnc720/config.xml
+++ b/core/res/res/values-mcc302-mnc720/config.xml
@@ -43,7 +43,7 @@
         <item>SUPL_PORT=7275</item>
         <item>SUPL_VER=0x20000</item>
         <item>SUPL_MODE=1</item>
-        <item>SUPL_ES=0</item>
+        <item>SUPL_ES=1</item>
         <item>LPP_PROFILE=2</item>
         <item>USE_EMERGENCY_PDN_FOR_EMERGENCY_SUPL=1</item>
         <item>A_GLONASS_POS_PROTOCOL_SELECT=0</item>
diff --git a/core/res/res/values-mk/strings.xml b/core/res/res/values-mk/strings.xml
index 66d2ef86006..9f080148ac3 100644
--- a/core/res/res/values-mk/strings.xml
+++ b/core/res/res/values-mk/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"      "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"      ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"        5 GHz.  ,      5 GHz   ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"  <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"  <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>    .     ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"  <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-ml/strings.xml b/core/res/res/values-ml/strings.xml
index 710493483b9..48285fc0de0 100644
--- a/core/res/res/values-ml/strings.xml
+++ b/core/res/res/values-ml/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">" "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" , 5GHz     . , 5GHz    ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>-     <xliff:g id="NEW_NETWORK">%1$s</xliff:g> .  ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>   <xliff:g id="NEW_NETWORK">%2$s</xliff:g>  "</string>
diff --git a/core/res/res/values-mn/strings.xml b/core/res/res/values-mn/strings.xml
index 9a6c1743842..cd58304bc39 100644
--- a/core/res/res/values-mn/strings.xml
+++ b/core/res/res/values-mn/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi-   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"    "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"    ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"   \" 5\"    .     5      ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>     <xliff:g id="NEW_NETWORK">%1$s</xliff:g>- .   ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>- <xliff:g id="NEW_NETWORK">%2$s</xliff:g>  "</string>
diff --git a/core/res/res/values-mr/strings.xml b/core/res/res/values-mr/strings.xml
index a6c686d8e81..ed24749d383 100644
--- a/core/res/res/values-mr/strings.xml
+++ b/core/res/res/values-mr/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"-    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"    ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"    GHz     . ,   GHz    ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>   "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>      <xliff:g id="NEW_NETWORK">%1$s</xliff:g> .   ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>   "</string>
diff --git a/core/res/res/values-ms/strings.xml b/core/res/res/values-ms/strings.xml
index f849e112546..1677592f459 100644
--- a/core/res/res/values-ms/strings.xml
+++ b/core/res/res/values-ms/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi tiada akses Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Ketik untuk mendapatkan pilihan"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Perubahan kepada tetapan tempat liputan anda"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Jalur tempat liputan anda telah berubah."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Peranti ini tidak menyokong pilihan anda untuk 5GHz sahaja. Sebaliknya, peranti ini akan menggunakan jalur 5GHz apabila tersedia."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Beralih kepada <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Peranti menggunakan <xliff:g id="NEW_NETWORK">%1$s</xliff:g> apabila <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> tiada akses Internet. Bayaran mungkin dikenakan."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Beralih daripada <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> kepada <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-my/strings.xml b/core/res/res/values-my/strings.xml
index 150fe8bf37c..4ddcce39601 100644
--- a/core/res/res/values-my/strings.xml
+++ b/core/res/res/values-my/strings.xml
@@ -566,7 +566,7 @@
     <string name="permlab_accessDrmCertificates" msgid="7436886640723203615">"DRM  "</string>
     <string name="permdesc_accessDrmCertificates" msgid="8073288354426159089">"  DRM        "</string>
     <string name="permlab_handoverStatus" msgid="7820353257219300883">"Android     "</string>
-    <string name="permdesc_handoverStatus" msgid="4788144087245714948">"        "</string>
+    <string name="permdesc_handoverStatus" msgid="4788144087245714948">" Android       "</string>
     <string name="permlab_removeDrmCertificates" msgid="7044888287209892751">"DRM  "</string>
     <string name="permdesc_removeDrmCertificates" msgid="7272999075113400993">" DRM         "</string>
     <string name="permlab_bindCarrierMessagingService" msgid="1490229371796969158">"  "</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">" "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"  "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"  "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"  5GHz      5GHz  "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>     <xliff:g id="NEW_NETWORK">%1$s</xliff:g>    "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>  "</string>
diff --git a/core/res/res/values-nb/strings.xml b/core/res/res/values-nb/strings.xml
index d76bcfc8a22..dc04b537ef9 100644
--- a/core/res/res/values-nb/strings.xml
+++ b/core/res/res/values-nb/strings.xml
@@ -584,14 +584,14 @@
     <string name="policydesc_watchLogin_secondaryUser" product="tablet" msgid="4280246270601044505">"Overvker antallet feil passord som er skrevet inn nr skjermen lses opp, og lser nettbrettet eller sletter denne brukerens data nr for mange feil passord er skrevet inn."</string>
     <string name="policydesc_watchLogin_secondaryUser" product="TV" msgid="3484832653564483250">"Overvker antallet feil passord som er skrevet inn nr skjermen lses opp, og lser TV-en eller sletter denne brukerens data nr for mange feil passord er skrevet inn."</string>
     <string name="policydesc_watchLogin_secondaryUser" product="default" msgid="2185480427217127147">"Overvker antallet feil passord som er skrevet inn nr skjermen lses opp, og lser telefonen eller sletter denne brukerens data nr for mange feil passord er skrevet inn."</string>
-    <string name="policylab_resetPassword" msgid="4934707632423915395">"Endre skjermlsen"</string>
-    <string name="policydesc_resetPassword" msgid="1278323891710619128">"Endre skjermlsen."</string>
-    <string name="policylab_forceLock" msgid="2274085384704248431">"Ls skjermen"</string>
-    <string name="policydesc_forceLock" msgid="1141797588403827138">"Kontrollr hvordan og nr skjermen lses."</string>
-    <string name="policylab_wipeData" msgid="3910545446758639713">"Slett alle data"</string>
+    <string name="policylab_resetPassword" msgid="4934707632423915395">"Endring av skjermlsen"</string>
+    <string name="policydesc_resetPassword" msgid="1278323891710619128">"Kan endre skjermlsen."</string>
+    <string name="policylab_forceLock" msgid="2274085384704248431">"Lsing av skjermen"</string>
+    <string name="policydesc_forceLock" msgid="1141797588403827138">"Kan kontrollere hvordan og nr skjermen lses."</string>
+    <string name="policylab_wipeData" msgid="3910545446758639713">"Sletting av alle data"</string>
     <string name="policydesc_wipeData" product="tablet" msgid="4306184096067756876">"Tilbakestill nettbrettets data uten advarsel ved  tilbakestille til fabrikkstandard."</string>
     <string name="policydesc_wipeData" product="tv" msgid="5816221315214527028">"Slett TV-ens data uten advarsel ved  tilbakestille til fabrikkstandard."</string>
-    <string name="policydesc_wipeData" product="default" msgid="5096895604574188391">"Tilbakestill telefonens data uten advarsel, ved  tilbakestille til fabrikkstandard."</string>
+    <string name="policydesc_wipeData" product="default" msgid="5096895604574188391">"Telefonens data kan slettes uten advarsel ved  tilbakestille til fabrikkstandard."</string>
     <string name="policylab_wipeData_secondaryUser" msgid="8362863289455531813">"Slett brukerdataene"</string>
     <string name="policydesc_wipeData_secondaryUser" product="tablet" msgid="6336255514635308054">"Sletter denne brukerens data p dette nettbrettet uten advarsel."</string>
     <string name="policydesc_wipeData_secondaryUser" product="tv" msgid="2086473496848351810">"Sletter denne brukerens data p denne TV-en uten advarsel."</string>
@@ -604,7 +604,7 @@
     <string name="policydesc_encryptedStorage" msgid="2637732115325316992">"Krev at lagrede appdata krypteres."</string>
     <string name="policylab_disableCamera" msgid="6395301023152297826">"Deaktiver kameraer"</string>
     <string name="policydesc_disableCamera" msgid="2306349042834754597">"Hindre bruk av alle kameraer p enheten."</string>
-    <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Deaktiver enkelte skjermlsfunksjoner"</string>
+    <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Deaktivering av skjermlsfunksjoner"</string>
     <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Forhindrer bruk av enkelte skjermlsfunksjoner."</string>
   <string-array name="phoneTypes">
     <item msgid="8901098336658710359">"Hjemmenummer"</item>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi har ikke Internett-tilgang"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Trykk for  f alternativer"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Endres til innstillingene dine for Wi-Fi-soner"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Bndet ditt for Wi-Fi-sone er endret."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Denne enheten sttter ikke innstillingen din for bare 5 GHz. I stedet bruker enheten 5 GHz-bndet nr det er tilgjengelig."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Byttet til <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Enheten bruker <xliff:g id="NEW_NETWORK">%1$s</xliff:g> nr <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> ikke har Internett-tilgang. Avgifter kan plpe."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Byttet fra <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> til <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-ne/strings.xml b/core/res/res/values-ne/strings.xml
index 3efd224a838..8fbc7eec80e 100644
--- a/core/res/res/values-ne/strings.xml
+++ b/core/res/res/values-ne/strings.xml
@@ -1181,6 +1181,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi     "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"   5GHz     ,      5GHz   "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>        <xliff:g id="NEW_NETWORK">%1$s</xliff:g>     "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>   "</string>
diff --git a/core/res/res/values-nl/strings.xml b/core/res/res/values-nl/strings.xml
index 80cb7a9ac35..4c321ca3a4e 100644
--- a/core/res/res/values-nl/strings.xml
+++ b/core/res/res/values-nl/strings.xml
@@ -287,13 +287,13 @@
     <string name="permgrouprequest_storage" msgid="7885942926944299560">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; toegang geven tot foto\'s, media en bestanden op je apparaat?"</string>
     <string name="permgrouplab_microphone" msgid="171539900250043464">"Microfoon"</string>
     <string name="permgroupdesc_microphone" msgid="4988812113943554584">"audio opnemen"</string>
-    <string name="permgrouprequest_microphone" msgid="9167492350681916038">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; het volgende toestaan: audio opnemen."</string>
+    <string name="permgrouprequest_microphone" msgid="9167492350681916038">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; toestaan om audio op te nemen?"</string>
     <string name="permgrouplab_camera" msgid="4820372495894586615">"Camera"</string>
     <string name="permgroupdesc_camera" msgid="3250611594678347720">"foto\'s maken en video opnemen"</string>
     <string name="permgrouprequest_camera" msgid="1299833592069671756">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; toestaan om foto\'s te maken en video op te nemen?"</string>
     <string name="permgrouplab_calllog" msgid="8798646184930388160">"Gesprekkenlijsten"</string>
     <string name="permgroupdesc_calllog" msgid="3006237336748283775">"gesprekkenlijst lezen en schrijven"</string>
-    <string name="permgrouprequest_calllog" msgid="8487355309583773267">"Wil je &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; toegang tot je gesprekkenlijsten geven?"</string>
+    <string name="permgrouprequest_calllog" msgid="8487355309583773267">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; toegang geven tot je gesprekkenlijsten?"</string>
     <string name="permgrouplab_phone" msgid="5229115638567440675">"Telefoon"</string>
     <string name="permgroupdesc_phone" msgid="6234224354060641055">"telefoneren en oproepen beheren"</string>
     <string name="permgrouprequest_phone" msgid="9166979577750581037">"&lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; toestaan om telefoongesprekken te starten en te beheren?"</string>
@@ -585,13 +585,13 @@
     <string name="policydesc_watchLogin_secondaryUser" product="TV" msgid="3484832653564483250">"Bijhouden hoe vaak onjuiste wachtwoorden worden ingevoerd wanneer het scherm wordt ontgrendeld en de tv vergrendelen of alle gegevens van deze gebruiker wissen als te veel onjuiste wachtwoorden worden ingevoerd."</string>
     <string name="policydesc_watchLogin_secondaryUser" product="default" msgid="2185480427217127147">"Bijhouden hoe vaak onjuiste wachtwoorden worden ingevoerd wanneer het scherm wordt ontgrendeld en de telefoon vergrendelen of alle gegevens van deze gebruiker wissen als te veel onjuiste wachtwoorden worden ingevoerd."</string>
     <string name="policylab_resetPassword" msgid="4934707632423915395">"De schermvergrendeling wijzigen"</string>
-    <string name="policydesc_resetPassword" msgid="1278323891710619128">"De schermvergrendeling wijzigen."</string>
+    <string name="policydesc_resetPassword" msgid="1278323891710619128">"Wijzig de schermvergrendeling."</string>
     <string name="policylab_forceLock" msgid="2274085384704248431">"Het scherm vergrendelen"</string>
-    <string name="policydesc_forceLock" msgid="1141797588403827138">"Beheren hoe en wanneer het scherm wordt vergrendeld."</string>
+    <string name="policydesc_forceLock" msgid="1141797588403827138">"Beheer hoe en wanneer het scherm wordt vergrendeld."</string>
     <string name="policylab_wipeData" msgid="3910545446758639713">"Alle gegevens wissen"</string>
     <string name="policydesc_wipeData" product="tablet" msgid="4306184096067756876">"De gegevens van de tablet zonder waarschuwing wissen door de fabrieksinstellingen te herstellen."</string>
     <string name="policydesc_wipeData" product="tv" msgid="5816221315214527028">"De gegevens van de tv zonder waarschuwing wissen door de fabrieksinstellingen te herstellen."</string>
-    <string name="policydesc_wipeData" product="default" msgid="5096895604574188391">"De gegevens van de telefoon zonder waarschuwing wissen door de fabrieksinstellingen te herstellen."</string>
+    <string name="policydesc_wipeData" product="default" msgid="5096895604574188391">"Wis de gegevens van de telefoon zonder waarschuwing door de fabrieksinstellingen te herstellen."</string>
     <string name="policylab_wipeData_secondaryUser" msgid="8362863289455531813">"Gebruikersgegevens wissen"</string>
     <string name="policydesc_wipeData_secondaryUser" product="tablet" msgid="6336255514635308054">"De gegevens van deze gebruiker op deze tablet zonder waarschuwing wissen."</string>
     <string name="policydesc_wipeData_secondaryUser" product="tv" msgid="2086473496848351810">"De gegevens van deze gebruiker op deze tv zonder waarschuwing wissen."</string>
@@ -605,7 +605,7 @@
     <string name="policylab_disableCamera" msgid="6395301023152297826">"Camera\'s uitschakelen"</string>
     <string name="policydesc_disableCamera" msgid="2306349042834754597">"Het gebruik van alle apparaatcamera\'s voorkomen."</string>
     <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Bepaalde functies voor schermvergrendeling uitschakelen"</string>
-    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Gebruik van bepaalde functies voor schermvergrendeling voorkomen."</string>
+    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Voorkom het gebruik van bepaalde functies voor schermvergrendeling."</string>
   <string-array name="phoneTypes">
     <item msgid="8901098336658710359">"Thuis"</item>
     <item msgid="869923650527136615">"Mobiel"</item>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wifi-netwerk heeft geen internettoegang"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tik voor opties"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Wijzigingen in je hotspot-instellingen"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Je hotspot-band is gewijzigd."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Dit apparaat biedt geen ondersteuning voor je voorkeur voor alleen 5 GHz. In plaats daarvan gebruikt dit apparaat de 5-GHz-band wanneer deze beschikbaar is."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Overgeschakeld naar <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Apparaat gebruikt <xliff:g id="NEW_NETWORK">%1$s</xliff:g> wanneer <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> geen internetverbinding heeft. Er kunnen kosten in rekening worden gebracht."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Overgeschakeld van <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> naar <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
@@ -1550,7 +1553,7 @@
     <string name="kg_failed_attempts_almost_at_login" product="default" msgid="1437638152015574839">"Je hebt je ontgrendelingspatroon <xliff:g id="NUMBER_0">%1$d</xliff:g> keer onjuist getekend. Na nog eens <xliff:g id="NUMBER_1">%2$d</xliff:g> mislukte pogingen wordt u gevraagd je telefoon te ontgrendelen via een e-mailaccount.\n\n Probeer het over <xliff:g id="NUMBER_2">%3$d</xliff:g> seconden opnieuw."</string>
     <string name="kg_text_message_separator" product="default" msgid="4160700433287233771">"  "</string>
     <string name="kg_reordering_delete_drop_target_text" msgid="7899202978204438708">"Verwijderen"</string>
-    <string name="safe_media_volume_warning" product="default" msgid="2276318909314492312">"Volume verhogen tot boven het aanbevolen niveau?\n\nAls u langere tijd op hoog volume naar muziek luistert, raakt je gehoor mogelijk beschadigd."</string>
+    <string name="safe_media_volume_warning" product="default" msgid="2276318909314492312">"Volume verhogen tot boven het aanbevolen niveau?\n\nAls je langere tijd op hoog volume naar muziek luistert, raakt je gehoor mogelijk beschadigd."</string>
     <string name="accessibility_shortcut_warning_dialog_title" msgid="8404780875025725199">"Sneltoets voor toegankelijkheid gebruiken?"</string>
     <string name="accessibility_shortcut_toogle_warning" msgid="7256507885737444807">"Wanneer de snelkoppeling is ingeschakeld, kun je drie seconden op beide volumeknoppen drukken om een toegankelijkheidsfunctie te starten.\n\n Huidige toegankelijkheidsfunctie:\n <xliff:g id="SERVICE_NAME">%1$s</xliff:g>\n\n Je kunt de functie wijzigen in Instellingen &gt; Toegankelijkheid."</string>
     <string name="disable_accessibility_shortcut" msgid="627625354248453445">"Sneltoets uitschakelen"</string>
diff --git a/core/res/res/values-or/strings.xml b/core/res/res/values-or/strings.xml
index a9e51f454f7..998c1f73d90 100644
--- a/core/res/res/values-or/strings.xml
+++ b/core/res/res/values-or/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"-    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" 5GHz ,        ,   5GHz   "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g> "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>     <xliff:g id="NEW_NETWORK">%1$s</xliff:g>     "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g> "</string>
@@ -1694,8 +1697,7 @@
     <string name="package_updated_device_owner" msgid="1847154566357862089">"   "</string>
     <string name="package_deleted_device_owner" msgid="2307122077550236438">"   "</string>
     <string name="battery_saver_description_with_learn_more" msgid="6323937147992667707">"   ,             "<annotation id="url">" "</annotation></string>
-    <!-- no translation found for battery_saver_description (769989536172631582) -->
-    <skip />
+    <string name="battery_saver_description" msgid="769989536172631582">"   ,           "</string>
     <string name="data_saver_description" msgid="6015391409098303235">"     ,                 ,   ,        , ,        "</string>
     <string name="data_saver_enable_title" msgid="4674073932722787417">"   ?"</string>
     <string name="data_saver_enable_button" msgid="7147735965247211818">" "</string>
@@ -1874,10 +1876,8 @@
     <string name="volume_dialog_ringer_guidance_silent" msgid="2128975224280276122">"    "</string>
     <string name="notification_channel_system_changes" msgid="5072715579030948646">" "</string>
     <string name="notification_channel_do_not_disturb" msgid="6766940333105743037">"  "</string>
-    <!-- no translation found for zen_upgrade_notification_visd_title (3288313883409759733) -->
-    <skip />
-    <!-- no translation found for zen_upgrade_notification_visd_content (5533674060311631165) -->
-    <skip />
+    <string name="zen_upgrade_notification_visd_title" msgid="3288313883409759733">": \"  \"       "</string>
+    <string name="zen_upgrade_notification_visd_content" msgid="5533674060311631165">"     "</string>
     <string name="zen_upgrade_notification_title" msgid="3799603322910377294">"   "</string>
     <string name="zen_upgrade_notification_content" msgid="1794994264692424562">"       "</string>
     <string name="notification_app_name_system" msgid="4205032194610042794">""</string>
diff --git a/core/res/res/values-pa/strings.xml b/core/res/res/values-pa/strings.xml
index d0230d71a53..44f63c5522e 100644
--- a/core/res/res/values-pa/strings.xml
+++ b/core/res/res/values-pa/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"-      "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"   5GHz          ,     \' 5GHz  "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">" <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>  "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>   \'    \'  <xliff:g id="NEW_NETWORK">%1$s</xliff:g>         "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>   <xliff:g id="NEW_NETWORK">%2$s</xliff:g> \'  "</string>
diff --git a/core/res/res/values-pl/strings.xml b/core/res/res/values-pl/strings.xml
index f32749d009c..8bbac2f6d35 100644
--- a/core/res/res/values-pl/strings.xml
+++ b/core/res/res/values-pl/strings.xml
@@ -610,7 +610,7 @@
     <string name="policydesc_encryptedStorage" msgid="2637732115325316992">"Wymaganie szyfrowania przechowywanych danych aplikacji"</string>
     <string name="policylab_disableCamera" msgid="6395301023152297826">"Wycz aparaty"</string>
     <string name="policydesc_disableCamera" msgid="2306349042834754597">"Zapobieganie uywaniu wszystkich aparatw w urzdzeniu"</string>
-    <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Wy. niektrych funkcji bl. ekr."</string>
+    <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Wy. funkcji blokady ekranu"</string>
     <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Zapobieganie uyciu niektrych funkcji blokady ekranu."</string>
   <string-array name="phoneTypes">
     <item msgid="8901098336658710359">"Dom"</item>
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Sie Wi-Fi nie ma dostpu do internetu"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Kliknij, by wywietli opcje"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Zmieniono ustawienia hotspotu"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Zmieniono pasmo hotspotu."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"To urzdzenie nie moe korzysta tylko zczstotliwoci 5GHz. Bdzie korzysta ztego pasma, jeli bdzie ono dostpne."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Zmieniono na poczenie typu <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Urzdzenie korzysta zpoczenia typu <xliff:g id="NEW_NETWORK">%1$s</xliff:g>, gdy <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nie dostpu do internetu. Mog zosta naliczone opaty."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Przeczono zpoczenia typu <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> na <xliff:g id="NEW_NETWORK">%2$s</xliff:g>."</string>
@@ -1450,7 +1453,7 @@
     <string name="add_account_button_label" msgid="3611982894853435874">"Dodaj konto"</string>
     <string name="number_picker_increment_button" msgid="2412072272832284313">"Zwiksz"</string>
     <string name="number_picker_decrement_button" msgid="476050778386779067">"Zmniejsz"</string>
-    <string name="number_picker_increment_scroll_mode" msgid="5259126567490114216">"<xliff:g id="VALUE">%s</xliff:g> dotknij i przytrzymaj."</string>
+    <string name="number_picker_increment_scroll_mode" msgid="5259126567490114216">"<xliff:g id="VALUE">%s</xliff:g> nacinij iprzytrzymaj."</string>
     <string name="number_picker_increment_scroll_action" msgid="9101473045891835490">"Przesu w gr, by zwikszy, i w d, by zmniejszy."</string>
     <string name="time_picker_increment_minute_button" msgid="8865885114028614321">"Zmie minut na pniejsz"</string>
     <string name="time_picker_decrement_minute_button" msgid="6246834937080684791">"Zmie minut na wczeniejsz"</string>
@@ -1477,7 +1480,7 @@
     <string name="activitychooserview_choose_application_error" msgid="8624618365481126668">"Nie udao si uruchomi aplikacji <xliff:g id="APPLICATION_NAME">%s</xliff:g>"</string>
     <string name="shareactionprovider_share_with" msgid="806688056141131819">"Udostpnij przez:"</string>
     <string name="shareactionprovider_share_with_application" msgid="5627411384638389738">"Udostpnij przez <xliff:g id="APPLICATION_NAME">%s</xliff:g>"</string>
-    <string name="content_description_sliding_handle" msgid="415975056159262248">"Uchwyt przesuwny. Dotknij i przytrzymaj."</string>
+    <string name="content_description_sliding_handle" msgid="415975056159262248">"Uchwyt przesuwny. Nacinij i przytrzymaj."</string>
     <string name="description_target_unlock_tablet" msgid="3833195335629795055">"Przesu, aby odblokowa."</string>
     <string name="action_bar_home_description" msgid="5293600496601490216">"Przejd do strony gwnej"</string>
     <string name="action_bar_up_description" msgid="2237496562952152589">"Przejd wyej"</string>
diff --git a/core/res/res/values-pt-rBR/strings.xml b/core/res/res/values-pt-rBR/strings.xml
index 4b399ea785c..ab5035dd6e4 100644
--- a/core/res/res/values-pt-rBR/strings.xml
+++ b/core/res/res/values-pt-rBR/strings.xml
@@ -433,9 +433,9 @@
     <string name="permlab_wakeLock" product="tablet" msgid="1531731435011495015">"impedir modo de inatividade do tablet"</string>
     <string name="permlab_wakeLock" product="tv" msgid="2601193288949154131">"impedir a suspenso da TV"</string>
     <string name="permlab_wakeLock" product="default" msgid="573480187941496130">"impedir modo de inatividade do telefone"</string>
-    <string name="permdesc_wakeLock" product="tablet" msgid="7311319824400447868">"Permite que o app impea o tablet de entrar no modo de inatividade."</string>
+    <string name="permdesc_wakeLock" product="tablet" msgid="7311319824400447868">"Permite que o app impea a suspenso do tablet."</string>
     <string name="permdesc_wakeLock" product="tv" msgid="3208534859208996974">"Permite que o app impea a suspenso da TV."</string>
-    <string name="permdesc_wakeLock" product="default" msgid="8559100677372928754">"Permite que o app impea o telefone de entrar no modo de inatividade."</string>
+    <string name="permdesc_wakeLock" product="default" msgid="8559100677372928754">"Permite que o app impea a suspenso do telefone."</string>
     <string name="permlab_transmitIr" msgid="7545858504238530105">"transmitir infravermelhos"</string>
     <string name="permdesc_transmitIr" product="tablet" msgid="5358308854306529170">"Permite que o app use o transmissor infravermelho do tablet."</string>
     <string name="permdesc_transmitIr" product="tv" msgid="3926790828514867101">"Permite que o app use o transmissor de infravermelho da TV."</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"O WiFi no tem acesso  Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Toque para ver opes"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Mudanas nas suas configuraes de ponto de acesso"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Sua banda de ponto de acesso foi alterada."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Este dispositivo no  compatvel com sua preferncia apenas por 5 GHz. Em vez disso, o dispositivo usar a banda de 5 GHz quando ela estiver disponvel."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Alternado para <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"O dispositivo usa <xliff:g id="NEW_NETWORK">%1$s</xliff:g> quando <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> no tem acesso  Internet. Esse servio pode ser cobrado."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Alternado de <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> para <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
@@ -1395,7 +1398,7 @@
     <string name="gpsVerifYes" msgid="2346566072867213563">"Sim"</string>
     <string name="gpsVerifNo" msgid="1146564937346454865">"No"</string>
     <string name="sync_too_many_deletes" msgid="5296321850662746890">"Limite de excluso excedido"</string>
-    <string name="sync_too_many_deletes_desc" msgid="496551671008694245">"H <xliff:g id="NUMBER_OF_DELETED_ITEMS">%1$d</xliff:g> itens excludos para <xliff:g id="TYPE_OF_SYNC">%2$s</xliff:g>, conta <xliff:g id="ACCOUNT_NAME">%3$s</xliff:g>. O que voc deseja fazer?"</string>
+    <string name="sync_too_many_deletes_desc" msgid="496551671008694245">"H <xliff:g id="NUMBER_OF_DELETED_ITEMS">%1$d</xliff:g> itens excludos para <xliff:g id="TYPE_OF_SYNC">%2$s</xliff:g>, conta <xliff:g id="ACCOUNT_NAME">%3$s</xliff:g>. O que voc quer fazer?"</string>
     <string name="sync_really_delete" msgid="2572600103122596243">"Excluir os itens"</string>
     <string name="sync_undo_deletes" msgid="2941317360600338602">"Desfazer as excluses"</string>
     <string name="sync_do_nothing" msgid="3743764740430821845">"No fazer nada por enquanto"</string>
diff --git a/core/res/res/values-pt-rPT/strings.xml b/core/res/res/values-pt-rPT/strings.xml
index 62e202a46b9..f514d71b4d4 100644
--- a/core/res/res/values-pt-rPT/strings.xml
+++ b/core/res/res/values-pt-rPT/strings.xml
@@ -585,13 +585,13 @@
     <string name="policydesc_watchLogin_secondaryUser" product="TV" msgid="3484832653564483250">"Monitorizar o nmero de palavras-passe incorretas introduzidas ao desbloquear o ecr e bloquear a TV ou apagar todos os dados deste utilizador se forem introduzidas demasiadas palavras-passe incorretas."</string>
     <string name="policydesc_watchLogin_secondaryUser" product="default" msgid="2185480427217127147">"Monitorizar o nmero de palavras-passe incorretas introduzidas ao desbloquear o ecr e bloquear o telemvel ou apagar todos os dados deste utilizador se forem introduzidas demasiadas palavras-passe incorretas."</string>
     <string name="policylab_resetPassword" msgid="4934707632423915395">"Alterar o bloqueio de ecr"</string>
-    <string name="policydesc_resetPassword" msgid="1278323891710619128">"Alterar o bloqueio de ecr."</string>
+    <string name="policydesc_resetPassword" msgid="1278323891710619128">"Altera o bloqueio de ecr."</string>
     <string name="policylab_forceLock" msgid="2274085384704248431">"Bloquear o ecr"</string>
-    <string name="policydesc_forceLock" msgid="1141797588403827138">"Controlar como e quando ocorre o bloqueio do ecr."</string>
+    <string name="policydesc_forceLock" msgid="1141797588403827138">"Controla como e quando ocorre o bloqueio do ecr."</string>
     <string name="policylab_wipeData" msgid="3910545446758639713">"Apagar todos os dados"</string>
     <string name="policydesc_wipeData" product="tablet" msgid="4306184096067756876">"Apagar os dados do tablet sem avisar atravs de uma reposio de dados de fbrica."</string>
     <string name="policydesc_wipeData" product="tv" msgid="5816221315214527028">"Apagar os dados da TV sem aviso prvio ao executar uma reposio de dados de fbrica."</string>
-    <string name="policydesc_wipeData" product="default" msgid="5096895604574188391">"Apagar os dados do telemvel sem avisar atravs de uma reposio de dados de fbrica."</string>
+    <string name="policydesc_wipeData" product="default" msgid="5096895604574188391">"Apaga os dados do telemvel sem avisar ao efetuar uma reposio de dados de fbrica."</string>
     <string name="policylab_wipeData_secondaryUser" msgid="8362863289455531813">"Apagar os dados do utilizador"</string>
     <string name="policydesc_wipeData_secondaryUser" product="tablet" msgid="6336255514635308054">"Apagar os dados deste utilizador neste tablet sem aviso."</string>
     <string name="policydesc_wipeData_secondaryUser" product="tv" msgid="2086473496848351810">"Apagar os dados deste utilizador nesta TV sem aviso."</string>
@@ -605,7 +605,7 @@
     <string name="policylab_disableCamera" msgid="6395301023152297826">"Desativar cmaras"</string>
     <string name="policydesc_disableCamera" msgid="2306349042834754597">"Evitar a utilizao de todas as cmaras do dispositivo."</string>
     <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Desat. funcionalid. bloq. ecr"</string>
-    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Impea a utilizao de algumas funcionalidades de bloqueio de ecr."</string>
+    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Impede a utilizao de algumas funcionalidades de bloqueio de ecr."</string>
   <string-array name="phoneTypes">
     <item msgid="8901098336658710359">"Casa"</item>
     <item msgid="869923650527136615">"Mvel"</item>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"O Wi-Fi no tem acesso  Internet."</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Toque para obter mais opes"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Alteraes s definies de zona Wi-Fi"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"A banda da sua zona Wi-Fi foi alterada."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Este dispositivo no suporta a sua preferncia apenas para 5GHz. Em alternativa, este dispositivo vai utilizar a banda de 5GHz quando estiver disponvel."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Mudou para <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"O dispositivo utiliza <xliff:g id="NEW_NETWORK">%1$s</xliff:g> quando <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> no tem acesso  Internet. Podem aplicar-se custos."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Mudou de <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> para <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-pt/strings.xml b/core/res/res/values-pt/strings.xml
index 4b399ea785c..ab5035dd6e4 100644
--- a/core/res/res/values-pt/strings.xml
+++ b/core/res/res/values-pt/strings.xml
@@ -433,9 +433,9 @@
     <string name="permlab_wakeLock" product="tablet" msgid="1531731435011495015">"impedir modo de inatividade do tablet"</string>
     <string name="permlab_wakeLock" product="tv" msgid="2601193288949154131">"impedir a suspenso da TV"</string>
     <string name="permlab_wakeLock" product="default" msgid="573480187941496130">"impedir modo de inatividade do telefone"</string>
-    <string name="permdesc_wakeLock" product="tablet" msgid="7311319824400447868">"Permite que o app impea o tablet de entrar no modo de inatividade."</string>
+    <string name="permdesc_wakeLock" product="tablet" msgid="7311319824400447868">"Permite que o app impea a suspenso do tablet."</string>
     <string name="permdesc_wakeLock" product="tv" msgid="3208534859208996974">"Permite que o app impea a suspenso da TV."</string>
-    <string name="permdesc_wakeLock" product="default" msgid="8559100677372928754">"Permite que o app impea o telefone de entrar no modo de inatividade."</string>
+    <string name="permdesc_wakeLock" product="default" msgid="8559100677372928754">"Permite que o app impea a suspenso do telefone."</string>
     <string name="permlab_transmitIr" msgid="7545858504238530105">"transmitir infravermelhos"</string>
     <string name="permdesc_transmitIr" product="tablet" msgid="5358308854306529170">"Permite que o app use o transmissor infravermelho do tablet."</string>
     <string name="permdesc_transmitIr" product="tv" msgid="3926790828514867101">"Permite que o app use o transmissor de infravermelho da TV."</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"O WiFi no tem acesso  Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Toque para ver opes"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Mudanas nas suas configuraes de ponto de acesso"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Sua banda de ponto de acesso foi alterada."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Este dispositivo no  compatvel com sua preferncia apenas por 5 GHz. Em vez disso, o dispositivo usar a banda de 5 GHz quando ela estiver disponvel."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Alternado para <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"O dispositivo usa <xliff:g id="NEW_NETWORK">%1$s</xliff:g> quando <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> no tem acesso  Internet. Esse servio pode ser cobrado."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Alternado de <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> para <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
@@ -1395,7 +1398,7 @@
     <string name="gpsVerifYes" msgid="2346566072867213563">"Sim"</string>
     <string name="gpsVerifNo" msgid="1146564937346454865">"No"</string>
     <string name="sync_too_many_deletes" msgid="5296321850662746890">"Limite de excluso excedido"</string>
-    <string name="sync_too_many_deletes_desc" msgid="496551671008694245">"H <xliff:g id="NUMBER_OF_DELETED_ITEMS">%1$d</xliff:g> itens excludos para <xliff:g id="TYPE_OF_SYNC">%2$s</xliff:g>, conta <xliff:g id="ACCOUNT_NAME">%3$s</xliff:g>. O que voc deseja fazer?"</string>
+    <string name="sync_too_many_deletes_desc" msgid="496551671008694245">"H <xliff:g id="NUMBER_OF_DELETED_ITEMS">%1$d</xliff:g> itens excludos para <xliff:g id="TYPE_OF_SYNC">%2$s</xliff:g>, conta <xliff:g id="ACCOUNT_NAME">%3$s</xliff:g>. O que voc quer fazer?"</string>
     <string name="sync_really_delete" msgid="2572600103122596243">"Excluir os itens"</string>
     <string name="sync_undo_deletes" msgid="2941317360600338602">"Desfazer as excluses"</string>
     <string name="sync_do_nothing" msgid="3743764740430821845">"No fazer nada por enquanto"</string>
diff --git a/core/res/res/values-ro/strings.xml b/core/res/res/values-ro/strings.xml
index b54b11cd2d9..0bc99eedca7 100644
--- a/core/res/res/values-ro/strings.xml
+++ b/core/res/res/values-ro/strings.xml
@@ -1197,6 +1197,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Reeaua Wi-Fi nu are acces la internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Atingei pentru opiuni"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Modificri aduse setrilor pentru hotspot"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"S-a schimbat banda de frecven a hotspotului."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Dispozitivul nu accept doar preferina pentru 5 GHz. Dispozitivul va folosi banda de 5 GHz cnd este disponibil."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"S-a comutat la <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Dispozitivul folosete <xliff:g id="NEW_NETWORK">%1$s</xliff:g> cnd <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nu are acces la internet. Se pot aplica taxe."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"S-a comutat de la <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> la <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-ru/strings.xml b/core/res/res/values-ru/strings.xml
index 687a54231d1..9ac6a76cd63 100644
--- a/core/res/res/values-ru/strings.xml
+++ b/core/res/res/values-ru/strings.xml
@@ -278,22 +278,22 @@
     <string name="managed_profile_label" msgid="8947929265267690522">"   "</string>
     <string name="permgrouplab_contacts" msgid="3657758145679177612">""</string>
     <string name="permgroupdesc_contacts" msgid="6951499528303668046">"  "</string>
-    <string name="permgrouprequest_contacts" msgid="6032805601881764300">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;   ?"</string>
+    <string name="permgrouprequest_contacts" msgid="6032805601881764300">"  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;   ?"</string>
     <string name="permgrouplab_location" msgid="7275582855722310164">""</string>
     <string name="permgroupdesc_location" msgid="1346617465127855033">"     "</string>
-    <string name="permgrouprequest_location" msgid="3788275734953323491">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;      ?"</string>
+    <string name="permgrouprequest_location" msgid="3788275734953323491">"  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;      ?"</string>
     <string name="permgrouplab_calendar" msgid="5863508437783683902">""</string>
     <string name="permgroupdesc_calendar" msgid="3889615280211184106">"  "</string>
-    <string name="permgrouprequest_calendar" msgid="289900767793189421">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;   ?"</string>
+    <string name="permgrouprequest_calendar" msgid="289900767793189421">"  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;   ?"</string>
     <string name="permgrouplab_sms" msgid="228308803364967808">"SMS"</string>
     <string name="permgroupdesc_sms" msgid="4656988620100940350">"   SMS-"</string>
-    <string name="permgrouprequest_sms" msgid="7168124215838204719">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;    SMS?"</string>
+    <string name="permgrouprequest_sms" msgid="7168124215838204719">"  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;    SMS?"</string>
     <string name="permgrouplab_storage" msgid="1971118770546336966">""</string>
     <string name="permgroupdesc_storage" msgid="637758554581589203">"  ,      "</string>
     <string name="permgrouprequest_storage" msgid="7885942926944299560">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;   ,     ?"</string>
     <string name="permgrouplab_microphone" msgid="171539900250043464">""</string>
     <string name="permgroupdesc_microphone" msgid="4988812113943554584">" "</string>
-    <string name="permgrouprequest_microphone" msgid="9167492350681916038">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;  ?"</string>
+    <string name="permgrouprequest_microphone" msgid="9167492350681916038">"  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;  ?"</string>
     <string name="permgrouplab_camera" msgid="4820372495894586615">""</string>
     <string name="permgroupdesc_camera" msgid="3250611594678347720">"   "</string>
     <string name="permgrouprequest_camera" msgid="1299833592069671756">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;    ?"</string>
@@ -302,7 +302,7 @@
     <string name="permgrouprequest_calllog" msgid="8487355309583773267">"  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;    ?"</string>
     <string name="permgrouplab_phone" msgid="5229115638567440675">""</string>
     <string name="permgroupdesc_phone" msgid="6234224354060641055">"    "</string>
-    <string name="permgrouprequest_phone" msgid="9166979577750581037">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;     ?"</string>
+    <string name="permgrouprequest_phone" msgid="9166979577750581037">"  &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt;     ?"</string>
     <string name="permgrouplab_sensors" msgid="416037179223226722">" "</string>
     <string name="permgroupdesc_sensors" msgid="7147968539346634043">"      "</string>
     <string name="permgrouprequest_sensors" msgid="6349806962814556786">"  &lt;b&gt;\"<xliff:g id="APP_NAME">%1$s</xliff:g>\"&lt;/b&gt;       ?"</string>
@@ -475,16 +475,16 @@
     <string name="permdesc_changeWifiMulticastState" product="tv" msgid="9031975661145014160">" ,       Wi-Fi,     .     ,    ."</string>
     <string name="permdesc_changeWifiMulticastState" product="default" msgid="6851949706025349926">"   ,      Wi-Fi (   )   .     ,    ."</string>
     <string name="permlab_bluetoothAdmin" msgid="6006967373935926659">"   Bluetooth"</string>
-    <string name="permdesc_bluetoothAdmin" product="tablet" msgid="6921177471748882137">"         Bluetooth,          ."</string>
-    <string name="permdesc_bluetoothAdmin" product="tv" msgid="3373125682645601429">"  Bluetooth  ,      ."</string>
-    <string name="permdesc_bluetoothAdmin" product="default" msgid="8931682159331542137">"        Bluetooth,          ."</string>
+    <string name="permdesc_bluetoothAdmin" product="tablet" msgid="6921177471748882137">"         Bluetooth,          ."</string>
+    <string name="permdesc_bluetoothAdmin" product="tv" msgid="3373125682645601429">"  Bluetooth  ,       ."</string>
+    <string name="permdesc_bluetoothAdmin" product="default" msgid="8931682159331542137">"        Bluetooth,          ."</string>
     <string name="permlab_accessWimaxState" msgid="4195907010610205703">"/  WiMAX"</string>
     <string name="permdesc_accessWimaxState" msgid="6360102877261978887">"  ,   WiMAX,        WiMAX."</string>
     <string name="permlab_changeWimaxState" msgid="340465839241528618">"  WiMAX"</string>
     <string name="permdesc_changeWimaxState" product="tablet" msgid="3156456504084201805">"      WiMAX     ."</string>
     <string name="permdesc_changeWimaxState" product="tv" msgid="6022307083934827718">"    WiMAX     ."</string>
     <string name="permdesc_changeWimaxState" product="default" msgid="697025043004923798">"      WiMAX     ."</string>
-    <string name="permlab_bluetooth" msgid="6127769336339276828">"    Bluetooth"</string>
+    <string name="permlab_bluetooth" msgid="6127769336339276828">"    Bluetooth"</string>
     <string name="permdesc_bluetooth" product="tablet" msgid="3480722181852438628">"    Bluetooth   ,         ."</string>
     <string name="permdesc_bluetooth" product="tv" msgid="3974124940101104206">"   Bluetooth  ,          ."</string>
     <string name="permdesc_bluetooth" product="default" msgid="3207106324452312739">"    Bluetooth  ,         ."</string>
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">" Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">",   ."</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"       5.    ,   ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">" : <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"  <xliff:g id="NEW_NETWORK">%1$s</xliff:g>,     <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> .      ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"    <xliff:g id="NEW_NETWORK">%2$s</xliff:g>    <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>"</string>
diff --git a/core/res/res/values-si/strings.xml b/core/res/res/values-si/strings.xml
index dc3acbc8266..b658fdba89b 100644
--- a/core/res/res/values-si/strings.xml
+++ b/core/res/res/values-si/strings.xml
@@ -1177,6 +1177,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi    "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"     ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"  5GHz     .  ,       5GHz    ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>   "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="NEW_NETWORK">%1$s</xliff:g> <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>       .    ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>   "</string>
diff --git a/core/res/res/values-sk/strings.xml b/core/res/res/values-sk/strings.xml
index 1fce815dbec..8c81d6c2990 100644
--- a/core/res/res/values-sk/strings.xml
+++ b/core/res/res/values-sk/strings.xml
@@ -425,7 +425,7 @@
     <string name="permlab_vibrate" msgid="7696427026057705834">"ovlda vibrovanie"</string>
     <string name="permdesc_vibrate" msgid="6284989245902300945">"Umouje aplikcii ovlda vibrcie."</string>
     <string name="permlab_callPhone" msgid="3925836347681847954">"priamo vola na telefnne sla"</string>
-    <string name="permdesc_callPhone" msgid="3740797576113760827">"Umouje aplikcii vola telefnne sla bez vho zsahu. V dsledku toho sa mu tova neoakvan poplatky alebo sa mu uskutoni neoakvan hovory. Toto povolenie neumouje aplikcii vola na sla tiesovho volania."</string>
+    <string name="permdesc_callPhone" msgid="3740797576113760827">"Umouje aplikcii vola telefnne sla bez vho zsahu. V dsledku toho sa mu tova neoakvan poplatky alebo sa mu uskutoni neoakvan hovory. Toto povolenie neumouje aplikcii vola na tiesov linku."</string>
     <string name="permlab_accessImsCallService" msgid="3574943847181793918">"prstup k slube volania IMS"</string>
     <string name="permdesc_accessImsCallService" msgid="8992884015198298775">"Umouje aplikcii pouva slubu okamitch sprv (IMS) na volanie bez intervencie pouvatea."</string>
     <string name="permlab_readPhoneState" msgid="9178228524507610486">"ta stav a identitu telefnu"</string>
@@ -735,7 +735,7 @@
     <string name="keyguard_password_enter_pin_password_code" msgid="6391755146112503443">"Zadajte kd PIN na odomknutie"</string>
     <string name="keyguard_password_wrong_pin_code" msgid="2422225591006134936">"Nesprvny kd PIN."</string>
     <string name="keyguard_label_text" msgid="861796461028298424">"Ak chcete telefn odomkn, stlate Menu a nsledne 0."</string>
-    <string name="emergency_call_dialog_number_for_display" msgid="696192103195090970">"slo tiesovej linky"</string>
+    <string name="emergency_call_dialog_number_for_display" msgid="696192103195090970">"Tiesov linka"</string>
     <string name="lockscreen_carrier_default" msgid="6169005837238288522">"iadny signl"</string>
     <string name="lockscreen_screen_locked" msgid="7288443074806832904">"Obrazovka je uzamknut."</string>
     <string name="lockscreen_instructions_when_pattern_enabled" msgid="46154051614126049">"Ak chcete odomkn telefn alebo uskutoni tiesov volanie, stlate Menu."</string>
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Sie WiFi nem prstup kinternetu"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Klepnutm zskate monosti"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Zmeny nastaven hotspotu"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Psmo vho hotspotu sa zmenilo."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Toto zariadenie nepodporuje vau predvobu pouva iba 5GHz. Namiesto toho bude psmo 5GHz pouva vtedy, ke bude kdispozcii."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Prepnut na sie: <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Ke <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nem prstup kinternetu, zariadenie pouva <xliff:g id="NEW_NETWORK">%1$s</xliff:g>. Mu sa tova poplatky."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Prepnut zo siete <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> na sie <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-sl/strings.xml b/core/res/res/values-sl/strings.xml
index 3e66c4c483e..672baabf49b 100644
--- a/core/res/res/values-sl/strings.xml
+++ b/core/res/res/values-sl/strings.xml
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Omreje Wi-Fi nima dostopa do interneta"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Dotaknite se za monosti"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Spremembe nastavitev dostopne toke"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Pas dostopne toke je spremenjen."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Ta naprava ne podpira prednostne nastavitve samo za 5-GHz pas. Namesto tega bo ta naprava uporabljala 5-GHz pas, ko bo na voljo."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Preklopljeno na omreje vrste <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Naprava uporabi omreje vrste <xliff:g id="NEW_NETWORK">%1$s</xliff:g>, ko omreje vrste <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nima dostopa do interneta. Prenos podatkov se lahko zarauna."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Preklopljeno z omreja vrste <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> na omreje vrste <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-sq/strings.xml b/core/res/res/values-sq/strings.xml
index 15f7fd23298..2c527b71eb9 100644
--- a/core/res/res/values-sq/strings.xml
+++ b/core/res/res/values-sq/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi nuk ka qasje n internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Trokit pr opsionet"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Ndryshimet n cilsimet e zons s qasjes pr internet"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Brezi yt i zons s qasjes pr internet ka ndryshuar."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Kjo pajisje nuk e mbshtet preferencn pr vetm 5 GHz. Prkundrazi, pajisja do t prdor brezin 5 GHz nse ka."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Kaloi te <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Pajisja prdor <xliff:g id="NEW_NETWORK">%1$s</xliff:g> kur <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> nuk ka qasje n internet. Mund t zbatohen tarifa."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Kaloi nga <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> te <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-sr/strings.xml b/core/res/res/values-sr/strings.xml
index 698a617bf06..be1e81369c6 100644
--- a/core/res/res/values-sr/strings.xml
+++ b/core/res/res/values-sr/strings.xml
@@ -1197,6 +1197,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"       5 GHz.      5 GHz   ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"     <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"    <xliff:g id="NEW_NETWORK">%1$s</xliff:g>    <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>   .     ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"     <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>    <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-sv/strings.xml b/core/res/res/values-sv/strings.xml
index a35b7a01779..4c202cb22bb 100644
--- a/core/res/res/values-sv/strings.xml
+++ b/core/res/res/values-sv/strings.xml
@@ -272,19 +272,19 @@
     <string name="managed_profile_label" msgid="8947929265267690522">"Byt till jobbprofilen"</string>
     <string name="permgrouplab_contacts" msgid="3657758145679177612">"Kontakter"</string>
     <string name="permgroupdesc_contacts" msgid="6951499528303668046">"f tillgng till dina kontakter"</string>
-    <string name="permgrouprequest_contacts" msgid="6032805601881764300">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomstbehrighet till dina kontakter?"</string>
+    <string name="permgrouprequest_contacts" msgid="6032805601881764300">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomst till dina kontakter?"</string>
     <string name="permgrouplab_location" msgid="7275582855722310164">"Plats"</string>
     <string name="permgroupdesc_location" msgid="1346617465127855033">"komma t enhetens platsuppgifter"</string>
-    <string name="permgrouprequest_location" msgid="3788275734953323491">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomstbehrighet till enhetens plats?"</string>
+    <string name="permgrouprequest_location" msgid="3788275734953323491">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomst till enhetens plats?"</string>
     <string name="permgrouplab_calendar" msgid="5863508437783683902">"Kalender"</string>
     <string name="permgroupdesc_calendar" msgid="3889615280211184106">"f tillgng till din kalender"</string>
-    <string name="permgrouprequest_calendar" msgid="289900767793189421">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomstbehrighet till din kalender?"</string>
+    <string name="permgrouprequest_calendar" msgid="289900767793189421">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomst till din kalender?"</string>
     <string name="permgrouplab_sms" msgid="228308803364967808">"Sms"</string>
     <string name="permgroupdesc_sms" msgid="4656988620100940350">"skicka och visa sms"</string>
     <string name="permgrouprequest_sms" msgid="7168124215838204719">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; behrighet att skicka och visa sms?"</string>
     <string name="permgrouplab_storage" msgid="1971118770546336966">"Lagring"</string>
     <string name="permgroupdesc_storage" msgid="637758554581589203">"f tkomst till foton, media och filer p din enhet"</string>
-    <string name="permgrouprequest_storage" msgid="7885942926944299560">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomstbehrighet till foton, mediafiler och andra filer p enheten?"</string>
+    <string name="permgrouprequest_storage" msgid="7885942926944299560">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomst till foton, mediefiler och andra filer p enheten?"</string>
     <string name="permgrouplab_microphone" msgid="171539900250043464">"Mikrofon"</string>
     <string name="permgroupdesc_microphone" msgid="4988812113943554584">"spela in ljud"</string>
     <string name="permgrouprequest_microphone" msgid="9167492350681916038">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; behrighet att spela in ljud?"</string>
@@ -299,7 +299,7 @@
     <string name="permgrouprequest_phone" msgid="9166979577750581037">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; behrighet att ringa och hantera telefonsamtal?"</string>
     <string name="permgrouplab_sensors" msgid="416037179223226722">"Kroppssensorer"</string>
     <string name="permgroupdesc_sensors" msgid="7147968539346634043">"f tkomst till sensordata om dina vitalparametrar"</string>
-    <string name="permgrouprequest_sensors" msgid="6349806962814556786">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomstbehrighet till sensordata om vitalparametrar?"</string>
+    <string name="permgrouprequest_sensors" msgid="6349806962814556786">"Vill du ge &lt;b&gt;<xliff:g id="APP_NAME">%1$s</xliff:g>&lt;/b&gt; tkomst till sensordata om vitalparametrar?"</string>
     <string name="capability_title_canRetrieveWindowContent" msgid="3901717936930170320">"Hmta fnsterinnehll"</string>
     <string name="capability_desc_canRetrieveWindowContent" msgid="3772225008605310672">"Granska innehllet i ett fnster som du interagerar med."</string>
     <string name="capability_title_canRequestTouchExploration" msgid="3108723364676667320">"Aktivera Explore by touch"</string>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi-ntverket r inte anslutet till internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Tryck fr alternativ"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"ndringar i instllningarna fr surfzon"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Frekvensbandet fr surfzonen har ndrats."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Den hr enheten har inte std fr instllningen fr att endast anvnda 5GHz. I stllet anvnds 5GHz nr det r mjligt."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Byte av ntverk till <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="NEW_NETWORK">%1$s</xliff:g> anvnds p enheten nr det inte finns internettkomst via <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>. Avgifter kan tillkomma."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Byte av ntverk frn <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> till <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-sw/strings.xml b/core/res/res/values-sw/strings.xml
index 2669e2236c9..9831195d011 100644
--- a/core/res/res/values-sw/strings.xml
+++ b/core/res/res/values-sw/strings.xml
@@ -71,10 +71,10 @@
     <string name="RuacMmi" msgid="7827887459138308886">"Ukataaji wa simu zinazokera zisizohitajika"</string>
     <string name="CndMmi" msgid="3116446237081575808">"Kuonyeshwa kwa nambari inayopiga"</string>
     <string name="DndMmi" msgid="1265478932418334331">"Usinisumbue"</string>
-    <string name="CLIRDefaultOnNextCallOn" msgid="429415409145781923">"Chaguo msingi za ID ya mpigaji simu za kutozuia. Simu ifuatayo: Imezuiliwa"</string>
-    <string name="CLIRDefaultOnNextCallOff" msgid="3092918006077864624">"Chaguo msingi za kitambulisho cha mpigaji simu huwa kuzuiwa. Simu ifuatayo: Haijazuiliwa"</string>
-    <string name="CLIRDefaultOffNextCallOn" msgid="6179425182856418465">"Chaguo msingi za ID ya mpigaji simu za kutozuia. Simu ifuatayo:Imezuiliwa"</string>
-    <string name="CLIRDefaultOffNextCallOff" msgid="2567998633124408552">"Chaguo msingi za ID ya mpigaji simu za kutozuia. Simu ifuatayo: Haijazuiliwa"</string>
+    <string name="CLIRDefaultOnNextCallOn" msgid="429415409145781923">"Chaguomsingi za ID ya mpigaji simu za kutozuia. Simu ifuatayo: Imezuiliwa"</string>
+    <string name="CLIRDefaultOnNextCallOff" msgid="3092918006077864624">"Chaguomsingi za kitambulisho cha mpigaji simu huwa kuzuiwa. Simu ifuatayo: Haijazuiliwa"</string>
+    <string name="CLIRDefaultOffNextCallOn" msgid="6179425182856418465">"Chaguomsingi za ID ya mpigaji simu za kutozuia. Simu ifuatayo:Imezuiliwa"</string>
+    <string name="CLIRDefaultOffNextCallOff" msgid="2567998633124408552">"Chaguomsingi za ID ya mpigaji simu za kutozuia. Simu ifuatayo: Haijazuiliwa"</string>
     <string name="serviceNotProvisioned" msgid="8614830180508686666">"Huduma haitathminiwi."</string>
     <string name="CLIRPermanent" msgid="3377371145926835671">"Hauwezi kubadilisha mpangilio wa kitambulisho cha anayepiga."</string>
     <string name="RestrictedOnDataTitle" msgid="5221736429761078014">"Hakuna huduma ya data kwa vifaa vya mkononi"</string>
@@ -770,9 +770,9 @@
     <string name="lockscreen_failed_attempts_almost_at_wipe" product="tablet" msgid="6128106399745755604">"Umejaribu kufungua kompyuta kibao kwa njia isiyo sahihi mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Ukijaribu tena mara <xliff:g id="NUMBER_1">%2$d</xliff:g> bila mafanikio, kompyuta ndogo itarejeshwa kwenye mipangilio iliyotoka nayo kiwandani na data yote iliyomo itafutwa."</string>
     <string name="lockscreen_failed_attempts_almost_at_wipe" product="tv" msgid="950408382418270260">"Umekosea majaribio ya kufungua runinga mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Ukikosea majaribio <xliff:g id="NUMBER_1">%2$d</xliff:g> zaidi, runinga itarejeshwa katika hali iliyotoka nayo kiwandani na data yote ya watumiaji itafutwa."</string>
     <string name="lockscreen_failed_attempts_almost_at_wipe" product="default" msgid="8603565142156826565">"Umejaribu kufungua simu kwa njia isiyo sahihi mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Ukijaribu tena mara <xliff:g id="NUMBER_1">%2$d</xliff:g> bila mafanikio, simu itarejeshwa kwenye mipangilio iliyotoka nayo kiwandani na data yote iliyomo itafutwa."</string>
-    <string name="lockscreen_failed_attempts_now_wiping" product="tablet" msgid="280873516493934365">"Umejaribu kufungua kompyuta ndogo kwa njia isiyo sahihi mara <xliff:g id="NUMBER">%d</xliff:g>. Kompyuta ndogo haitaweza kuwekwa upya kwa kiwanda chaguo msingi."</string>
+    <string name="lockscreen_failed_attempts_now_wiping" product="tablet" msgid="280873516493934365">"Umejaribu kufungua kompyuta ndogo kwa njia isiyo sahihi mara <xliff:g id="NUMBER">%d</xliff:g>. Kompyuta ndogo haitaweza kuwekwa upya kwa kiwanda chaguomsingi."</string>
     <string name="lockscreen_failed_attempts_now_wiping" product="tv" msgid="3195755534096192191">"Umekosea majaribio ya kufungua runinga mara <xliff:g id="NUMBER">%d</xliff:g>. Sasa runinga itarejeshwa katika mipangilio iliyotoka nayo kiwandani."</string>
-    <string name="lockscreen_failed_attempts_now_wiping" product="default" msgid="3025504721764922246">"Umejaribu kufungua kompyuta ndogo kwa njia isiyo sahihi mara <xliff:g id="NUMBER">%d</xliff:g>. Kompyuta ndogo haitaweza kuwekwa upya kwa kiwanda chaguo msingi."</string>
+    <string name="lockscreen_failed_attempts_now_wiping" product="default" msgid="3025504721764922246">"Umejaribu kufungua kompyuta ndogo kwa njia isiyo sahihi mara <xliff:g id="NUMBER">%d</xliff:g>. Kompyuta ndogo haitaweza kuwekwa upya kwa kiwanda chaguomsingi."</string>
     <string name="lockscreen_too_many_failed_attempts_countdown" msgid="6251480343394389665">"Jaribu tena kwa sekunde <xliff:g id="NUMBER">%d</xliff:g>."</string>
     <string name="lockscreen_forgot_pattern_button_text" msgid="2626999449610695930">"Umesahau mchoro?"</string>
     <string name="lockscreen_glogin_forgot_pattern" msgid="2588521501166032747">"Fungua akaunti"</string>
@@ -1062,9 +1062,9 @@
     <string name="whichImageCaptureApplication" msgid="3680261417470652882">"Piga picha ukitumia"</string>
     <string name="whichImageCaptureApplicationNamed" msgid="8619384150737825003">"Piga picha ukitumia %1$s"</string>
     <string name="whichImageCaptureApplicationLabel" msgid="6390303445371527066">"Piga picha"</string>
-    <string name="alwaysUse" msgid="4583018368000610438">"Tumia kama chaguo msingi la kitendo hiki."</string>
+    <string name="alwaysUse" msgid="4583018368000610438">"Tumia kama chaguomsingi la kitendo hiki."</string>
     <string name="use_a_different_app" msgid="8134926230585710243">"Tumia programu tofauti"</string>
-    <string name="clearDefaultHintMsg" msgid="3252584689512077257">"Futa chaguo msingi katika mipangilio ya Mfumo &gt; Apps &gt; iliyopakuliwa."</string>
+    <string name="clearDefaultHintMsg" msgid="3252584689512077257">"Futa chaguomsingi katika mipangilio ya Mfumo &gt; Apps &gt; iliyopakuliwa."</string>
     <string name="chooseActivity" msgid="7486876147751803333">"Chagua kitendo"</string>
     <string name="chooseUsbActivity" msgid="6894748416073583509">"Chagua programu ya kifaa cha USB"</string>
     <string name="noApplications" msgid="2991814273936504689">"Hakuna programu zinazoweza kufanya tendo hili."</string>
@@ -1139,8 +1139,8 @@
     <string name="volume_icon_description_incall" msgid="8890073218154543397">"Sauti ya simu"</string>
     <string name="volume_icon_description_media" msgid="4217311719665194215">"Sauti ya faili"</string>
     <string name="volume_icon_description_notification" msgid="7044986546477282274">"Sauti ya arifa"</string>
-    <string name="ringtone_default" msgid="3789758980357696936">"Mlio chaguo msingi"</string>
-    <string name="ringtone_default_with_actual" msgid="1767304850491060581">"Chaguo msingi (<xliff:g id="ACTUAL_RINGTONE">%1$s</xliff:g>)"</string>
+    <string name="ringtone_default" msgid="3789758980357696936">"Mlio chaguomsingi"</string>
+    <string name="ringtone_default_with_actual" msgid="1767304850491060581">"Chaguomsingi (<xliff:g id="ACTUAL_RINGTONE">%1$s</xliff:g>)"</string>
     <string name="ringtone_silent" msgid="7937634392408977062">"Hamna"</string>
     <string name="ringtone_picker_title" msgid="3515143939175119094">"Toni za mlio"</string>
     <string name="ringtone_picker_title_alarm" msgid="6473325356070549702">"Sauti za kengele"</string>
@@ -1173,6 +1173,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi haina muunganisho wa intaneti"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Gusa ili upate chaguo"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Mabadiliko kwenye mipangilio ya mtandao pepe"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Bendi ya mtandao pepe wako imebadilika."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Kifaa hiki hakitumii mapendeleo yako ya GHz 5 pekee. Badala yake, kifaa hiki kitatumia bendi ya GHz 5 itakapopatikana."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Sasa inatumia <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Kifaa hutumia <xliff:g id="NEW_NETWORK">%1$s</xliff:g> wakati <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> haina intaneti. Huenda ukalipishwa."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Imebadilisha mtandao kutoka <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> na sasa inatumia <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
@@ -1537,12 +1540,12 @@
     <string name="kg_too_many_failed_pin_attempts_dialog_message" msgid="8276745642049502550">"Umeingiza nenosiri lako kwa makosa mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. \n\n Jaribu tena baada ya sekunde <xliff:g id="NUMBER_1">%2$d</xliff:g>."</string>
     <string name="kg_too_many_failed_password_attempts_dialog_message" msgid="7813713389422226531">"Umeingiza nenosiri lako kwa makosa mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. \n\n Jaribu tena baada ya sekunde <xliff:g id="NUMBER_1">%2$d</xliff:g>."</string>
     <string name="kg_too_many_failed_pattern_attempts_dialog_message" msgid="74089475965050805">"Umechora ruwaza yako ya kufunga kwa makosa mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. \n\n Jaribu tena baada ya sekunde <xliff:g id="NUMBER_1">%2$d</xliff:g>."</string>
-    <string name="kg_failed_attempts_almost_at_wipe" product="tablet" msgid="1575557200627128949">"Umejaribu kufungua kompyuta ndogo kwa njia isiyo sahihi mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Baada ya majaribio <xliff:g id="NUMBER_1">%2$d</xliff:g> zaidi yasiyofaulu, kompyuta ndogo itarejeshwa katika mfumo chaguo msingi ilivyotoka kiwandani data yote ya mtumiaji itapotea."</string>
+    <string name="kg_failed_attempts_almost_at_wipe" product="tablet" msgid="1575557200627128949">"Umejaribu kufungua kompyuta ndogo kwa njia isiyo sahihi mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Baada ya majaribio <xliff:g id="NUMBER_1">%2$d</xliff:g> zaidi yasiyofaulu, kompyuta ndogo itarejeshwa katika mfumo chaguomsingi ilivyotoka kiwandani data yote ya mtumiaji itapotea."</string>
     <string name="kg_failed_attempts_almost_at_wipe" product="tv" msgid="5621231220154419413">"Umekosea majaribio ya kufungua runinga mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Ukikosea majaribio mengine <xliff:g id="NUMBER_1">%2$d</xliff:g>, runinga itarejeshwa katika hali iliyotoka nayo kiwandani na data yote ya watumiaji itafutwa."</string>
-    <string name="kg_failed_attempts_almost_at_wipe" product="default" msgid="4051015943038199910">"Umejaribu kufungua simu kwa njia isiyo sahihi mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Baada ya majaribio <xliff:g id="NUMBER_1">%2$d</xliff:g> zaidi yasiyofaulu, simu itarejeshwa katika mfumo chaguo msingi ilivyotoka kiwandani na data yote ya mtumiaji itapotea."</string>
-    <string name="kg_failed_attempts_now_wiping" product="tablet" msgid="2072996269148483637">"Umejaribu kufungua kompyuta ndogo kwa njia isiyo sahihi mara <xliff:g id="NUMBER">%d</xliff:g>. Sasa kompyuta ndogo itarejeshwa katika mfumo chaguo msingi ilivyotoka kiwandani."</string>
+    <string name="kg_failed_attempts_almost_at_wipe" product="default" msgid="4051015943038199910">"Umejaribu kufungua simu kwa njia isiyo sahihi mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Baada ya majaribio <xliff:g id="NUMBER_1">%2$d</xliff:g> zaidi yasiyofaulu, simu itarejeshwa katika mfumo chaguomsingi ilivyotoka kiwandani na data yote ya mtumiaji itapotea."</string>
+    <string name="kg_failed_attempts_now_wiping" product="tablet" msgid="2072996269148483637">"Umejaribu kufungua kompyuta ndogo kwa njia isiyo sahihi mara <xliff:g id="NUMBER">%d</xliff:g>. Sasa kompyuta ndogo itarejeshwa katika mfumo chaguomsingi ilivyotoka kiwandani."</string>
     <string name="kg_failed_attempts_now_wiping" product="tv" msgid="4987878286750741463">"Umekosea majaribio ya kufungua runinga mara <xliff:g id="NUMBER">%d</xliff:g>. Sasa runinga itarejeshwa katika hali iliyotoka nayo kiwandani."</string>
-    <string name="kg_failed_attempts_now_wiping" product="default" msgid="4817627474419471518">"Umejaribu kufungua simu kwa njia isiyo sahihi mara <xliff:g id="NUMBER">%d</xliff:g>. Sasa simu  itarejeshwa katika mfumo chaguo msingi ilivyotoka kiwandani."</string>
+    <string name="kg_failed_attempts_now_wiping" product="default" msgid="4817627474419471518">"Umejaribu kufungua simu kwa njia isiyo sahihi mara <xliff:g id="NUMBER">%d</xliff:g>. Sasa simu  itarejeshwa katika mfumo chaguomsingi ilivyotoka kiwandani."</string>
     <string name="kg_failed_attempts_almost_at_login" product="tablet" msgid="3253575572118914370">"Umekosea katika kuweka mchoro wako wa kufungua mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Baada ya majaribio <xliff:g id="NUMBER_1">%2$d</xliff:g> bila kufaulu, utaombwa kufungua kompyuta yako ndogo kwa kutumia akaunti yako ya barua pepe.\n\n Jaribu tena baada ya sekunde <xliff:g id="NUMBER_2">%3$d</xliff:g>."</string>
     <string name="kg_failed_attempts_almost_at_login" product="tv" msgid="4224651132862313471">"Umekosea kuchora mchoro wa kufungua mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Ukikosea majaribio mengine <xliff:g id="NUMBER_1">%2$d</xliff:g>, utaombwa ufungue runinga yako ukitumia akaunti ya barua pepe.\n\n Jaribu tena baada ya sekunde <xliff:g id="NUMBER_2">%3$d</xliff:g>."</string>
     <string name="kg_failed_attempts_almost_at_login" product="default" msgid="1437638152015574839">"Umekosea kuchora mchoro wako wa kufungua mara <xliff:g id="NUMBER_0">%1$d</xliff:g>. Baada ya majaribio <xliff:g id="NUMBER_1">%2$d</xliff:g> yasiyofaulu, utaombwa kufungua simu yako kwa kutumia akaunti ya barua pepe.\n\n Jaribu tena baada ya sekunde <xliff:g id="NUMBER_2">%3$d</xliff:g>."</string>
diff --git a/core/res/res/values-ta/strings.xml b/core/res/res/values-ta/strings.xml
index 2dcfd98444b..6222d163a1e 100644
--- a/core/res/res/values-ta/strings.xml
+++ b/core/res/res/values-ta/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">", "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" , 5GHz     .  5GHz  ,   ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g> "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>    ,  <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  .  ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g> "</string>
diff --git a/core/res/res/values-te/strings.xml b/core/res/res/values-te/strings.xml
index 72d82b765f5..227b2edfdbc 100644
--- a/core/res/res/values-te/strings.xml
+++ b/core/res/res/values-te/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi   "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"   "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"  5GHz      . ,     5GHz  ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g> "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>    <xliff:g id="NEW_NETWORK">%1$s</xliff:g> .  ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g> "</string>
diff --git a/core/res/res/values-th/strings.xml b/core/res/res/values-th/strings.xml
index 46f1646332e..cabdf77c075 100644
--- a/core/res/res/values-th/strings.xml
+++ b/core/res/res/values-th/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">""</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">""</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">""</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" 5 GHz   5 GHz  "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">" <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="NEW_NETWORK">%1$s</xliff:g>  <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>  "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">" <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
@@ -1252,7 +1255,7 @@
     <string name="usb_notification_message" msgid="3370903770828407960">""</string>
     <string name="usb_power_notification_message" msgid="4647527153291917218">" "</string>
     <string name="usb_unsupported_audio_accessory_title" msgid="3529881374464628084">""</string>
-    <string name="usb_unsupported_audio_accessory_message" msgid="6309553946441565215">" "</string>
+    <string name="usb_unsupported_audio_accessory_message" msgid="6309553946441565215">" "</string>
     <string name="adb_active_notification_title" msgid="6729044778949189918">" USB "</string>
     <string name="adb_active_notification_message" msgid="7463062450474107752">" USB"</string>
     <string name="adb_active_notification_message" product="tv" msgid="8470296818270110396">" USB"</string>
diff --git a/core/res/res/values-tl/strings.xml b/core/res/res/values-tl/strings.xml
index 7559187ab73..f8c3f0bda0d 100644
--- a/core/res/res/values-tl/strings.xml
+++ b/core/res/res/values-tl/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Walang access sa internet ang Wi-Fi"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"I-tap para sa mga opsyon"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Mga pagbabago sa mga setting ng iyong hotspot"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Nagbago ang band ng iyong hotspot."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Hindi sinusuportahan ng device na ito ang kagustuhan mong gumamit lang ng 5GHz. Sa halip, gagamitin ng device na ito ang 5GHz na band kapag available."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Lumipat sa <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Ginagamit ng device ang <xliff:g id="NEW_NETWORK">%1$s</xliff:g> kapag walang access sa internet ang <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>. Maaaring may mga malapat na singilin."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Lumipat sa <xliff:g id="NEW_NETWORK">%2$s</xliff:g> mula sa <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>"</string>
diff --git a/core/res/res/values-tr/strings.xml b/core/res/res/values-tr/strings.xml
index 044473362a0..75fd77424a0 100644
--- a/core/res/res/values-tr/strings.xml
+++ b/core/res/res/values-tr/strings.xml
@@ -605,7 +605,7 @@
     <string name="policylab_disableCamera" msgid="6395301023152297826">"Kameralar devre d brak"</string>
     <string name="policydesc_disableCamera" msgid="2306349042834754597">"Tm cihaz kameralarnn kullanmn engelleme."</string>
     <string name="policylab_disableKeyguardFeatures" msgid="8552277871075367771">"Ekran kilidinin baz zelliklerini devre d brakma"</string>
-    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Ekran kilidinin baz zelliklerinin kullanlmasn nleyin."</string>
+    <string name="policydesc_disableKeyguardFeatures" msgid="2044755691354158439">"Ekran kilidinin baz zelliklerinin kullanlmasn nleme."</string>
   <string-array name="phoneTypes">
     <item msgid="8901098336658710359">"Ev"</item>
     <item msgid="869923650527136615">"Mobil"</item>
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Kablosuz balantnn internet eriimi yok"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Seenekler iin dokunun"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Hotspot ayarlarnz deiti"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Hotspot band deiti."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Bu cihaz yalnzca 5 GHz bandnn kullanlmasna ynelik tercihinizi desteklemiyor. Bunun yerine, bu cihaz 5 GHz bandn mevcut olduunda kullanacak."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g> ana geildi"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> ann internet eriimi olmadnda cihaz <xliff:g id="NEW_NETWORK">%1$s</xliff:g> an kullanr. Bunun iin deme alnabilir."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> andan <xliff:g id="NEW_NETWORK">%2$s</xliff:g> ana geildi"</string>
diff --git a/core/res/res/values-uk/strings.xml b/core/res/res/values-uk/strings.xml
index 4fdcb1a6247..4570c41d91f 100644
--- a/core/res/res/values-uk/strings.xml
+++ b/core/res/res/values-uk/strings.xml
@@ -1219,6 +1219,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">" Wi-Fi     "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">",   "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"    "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"   ."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"       5 .      5 ,  ."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"    <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"  <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>     ,  <xliff:g id="NEW_NETWORK">%1$s</xliff:g>.   ."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"    <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>   <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-ur/strings.xml b/core/res/res/values-ur/strings.xml
index 6674caa752f..e6a951cfdd9 100644
--- a/core/res/res/values-ur/strings.xml
+++ b/core/res/res/values-ur/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi      "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"  "</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"      "</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"       "</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"   5GHz            5GHz          "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>    "</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g>          <xliff:g id="NEW_NETWORK">%1$s</xliff:g>         "</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g>  <xliff:g id="NEW_NETWORK">%2$s</xliff:g>    "</string>
diff --git a/core/res/res/values-uz/strings.xml b/core/res/res/values-uz/strings.xml
index a3b5d5dd6c8..faaff4d37a1 100644
--- a/core/res/res/values-uz/strings.xml
+++ b/core/res/res/values-uz/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi tarmoqda internet aloqasi yoq"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Variantlarni korsatish uchun bosing"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Hotspot sozlamalari ozgartirildi"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Hotspot chastotasi ozgartirildi."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Qurilma faqat 5 GGs chastotada ishlay olmaydi. Bu chastotadan imkoniyatga qarab foydalaniladi."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g> tarmogiga ulanildi"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Agar <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> tarmoqda internet uzilsa, qurilma <xliff:g id="NEW_NETWORK">%1$s</xliff:g>ga ulanadi. Sarflangan trafik uchun haq olinishi mumkin."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> tarmogidan <xliff:g id="NEW_NETWORK">%2$s</xliff:g> tarmogiga otildi"</string>
diff --git a/core/res/res/values-vi/strings.xml b/core/res/res/values-vi/strings.xml
index 11adcc672c1..0f93be3f87c 100644
--- a/core/res/res/values-vi/strings.xml
+++ b/core/res/res/values-vi/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi khng c quyn truy cp Internet"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Nhn  bit ty chn"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Nhng thay i trong mc ci t im pht sng ca bn"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Bng tn ca im pht sng  thay i."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Thit b ny khng h tr ty chn ch s dng bng tn 5 GHz. Thay vo , thit b ny s s dng bng tn 5 GHz khi c th."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">" chuyn sang <xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Thit b s dng <xliff:g id="NEW_NETWORK">%1$s</xliff:g> khi <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> khng c quyn truy cp Internet. Bn c th phi tr ph."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">" chuyn t <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> sang <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-zh-rCN/strings.xml b/core/res/res/values-zh-rCN/strings.xml
index 1fc9610e47a..590d11e702d 100644
--- a/core/res/res/values-zh-rCN/strings.xml
+++ b/core/res/res/values-zh-rCN/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">" WLAN "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">""</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">""</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">""</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" 5GHz 5GHz "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g><xliff:g id="NEW_NETWORK">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g><xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-zh-rHK/strings.xml b/core/res/res/values-zh-rHK/strings.xml
index 9f3e7c293a5..f0f03b80bbb 100644
--- a/core/res/res/values-zh-rHK/strings.xml
+++ b/core/res/res/values-zh-rHK/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">""</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">""</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">""</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" 5 GHz  5 GHz "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">" <xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> <xliff:g id="NEW_NETWORK">%1$s</xliff:g> ()"</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g><xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-zh-rTW/strings.xml b/core/res/res/values-zh-rTW/strings.xml
index e732817e0d8..c41d0ec76d9 100644
--- a/core/res/res/values-zh-rTW/strings.xml
+++ b/core/res/res/values-zh-rTW/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"Wi-Fi "</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">""</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">""</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">""</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">" ( 5GHz) 5GHz "</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g><xliff:g id="NEW_NETWORK">%1$s</xliff:g>()"</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">" <xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> <xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values-zu/strings.xml b/core/res/res/values-zu/strings.xml
index 44b96f4a58c..d0b8694a1a0 100644
--- a/core/res/res/values-zu/strings.xml
+++ b/core/res/res/values-zu/strings.xml
@@ -1175,6 +1175,9 @@
     <skip />
     <string name="wifi_no_internet" msgid="8938267198124654938">"I-Wi-Fi ayinakho ukufinyelela kwe-inthanethi"</string>
     <string name="wifi_no_internet_detailed" msgid="8083079241212301741">"Thepha ukuze uthole izinketho"</string>
+    <string name="wifi_softap_config_change" msgid="8475911871165857607">"Ushintsho kuzilungiselelo zakho ze-hotspot"</string>
+    <string name="wifi_softap_config_change_summary" msgid="7601233252456548891">"Ibhendi yakho ye-hotspot ishintshile."</string>
+    <string name="wifi_softap_config_change_detailed" msgid="8022936822860678033">"Le divayisi ayisekeli okuncamelayo kwe-5GHz kuphela. Kunalokho, le divayisi izosebenzisa ibhendi ye-5GHz uma itholakala."</string>
     <string name="network_switch_metered" msgid="4671730921726992671">"Kushintshelwe ku-<xliff:g id="NETWORK_TYPE">%1$s</xliff:g>"</string>
     <string name="network_switch_metered_detail" msgid="775163331794506615">"Idivayisi isebenzisa i-<xliff:g id="NEW_NETWORK">%1$s</xliff:g> uma i-<xliff:g id="PREVIOUS_NETWORK">%2$s</xliff:g> inganakho ukufinyelela kwe-inthanethi. Kungasebenza izindleko."</string>
     <string name="network_switch_metered_toast" msgid="5779283181685974304">"Kushintshelewe kusuka ku-<xliff:g id="PREVIOUS_NETWORK">%1$s</xliff:g> kuya ku-<xliff:g id="NEW_NETWORK">%2$s</xliff:g>"</string>
diff --git a/core/res/res/values/config.xml b/core/res/res/values/config.xml
index 035dcab7e7b..f10d09a6928 100644
--- a/core/res/res/values/config.xml
+++ b/core/res/res/values/config.xml
@@ -42,13 +42,13 @@
         <item><xliff:g id="id">@string/status_bar_phone_evdo_signal</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_phone_signal</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_secure</xliff:g></item>
-        <item><xliff:g id="id">@string/status_bar_bluetooth</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_managed_profile</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_cast</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_vpn</xliff:g></item>
+        <item><xliff:g id="id">@string/status_bar_bluetooth</xliff:g></item>
+        <item><xliff:g id="id">@string/status_bar_location</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_mute</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_volume</xliff:g></item>
-        <item><xliff:g id="id">@string/status_bar_location</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_zen</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_ethernet</xliff:g></item>
         <item><xliff:g id="id">@string/status_bar_wifi</xliff:g></item>
@@ -493,13 +493,21 @@
 
          Note also: the order of this is important. The first upstream type
          for which a satisfying network exists is used.
-      -->
+    -->
     <integer-array translatable="false" name="config_tether_upstream_types">
         <item>1</item>
         <item>7</item>
         <item>0</item>
     </integer-array>
 
+    <!-- When true, the tethering upstream network follows the current default
+         Internet network (except when the current default network is mobile,
+         in which case a DUN network will be used if required).
+
+         When true, overrides the config_tether_upstream_types setting above.
+    -->
+    <bool translatable="false" name="config_tether_upstream_automatic">false</bool>
+
     <!-- If the DUN connection for this CDMA device supports more than just DUN -->
     <!-- traffic you should list them here. -->
     <!-- If this device is not CDMA this is ignored.  If this list is empty on -->
@@ -661,9 +669,31 @@
     <!-- Boolean indicating that wifi only link configuratios that have exact same credentials (i.e PSK) -->
     <bool translatable="false" name="config_wifi_only_link_same_credential_configurations">true</bool>
 
-    <!-- Boolean indicating whether framework needs to set the tx power limit for meeting SAR requirements
-         during voice calls -->
-    <bool translatable="false" name="config_wifi_framework_enable_voice_call_sar_tx_power_limit">false</bool>
+    <!-- Boolean indicating whether framework needs to set the tx power limit for meeting SAR requirements -->
+    <bool translatable="false" name="config_wifi_framework_enable_sar_tx_power_limit">false</bool>
+
+    <!-- Boolean indicating whether framework should use detection of softAP mode to set the tx
+         power limit for meeting SAR requirements -->
+    <bool translatable="false" name="config_wifi_framework_enable_soft_ap_sar_tx_power_limit">false</bool>
+
+    <!-- Boolean indicating whether framework needs to use body proximity to set the tx power limit
+         for meeting SAR requirements -->
+    <bool translatable="false" name="config_wifi_framework_enable_body_proximity_sar_tx_power_limit">false</bool>
+
+    <!-- String for the sensor type for body/head proximity for SAR -->
+    <string translatable="false" name="config_wifi_sar_sensor_type"></string>
+
+    <!-- Integer indicating event id by sar sensor for free space -->
+    <integer translatable="false" name="config_wifi_framework_sar_free_space_event_id">1</integer>
+
+    <!-- Integer indicating event id by sar sensor for near hand -->
+    <integer translatable="false" name="config_wifi_framework_sar_near_hand_event_id">2</integer>
+
+    <!-- Integer indicating event id by sar sensor for near head -->
+    <integer translatable="false" name="config_wifi_framework_sar_near_head_event_id">3</integer>
+
+    <!-- Integer indicating event id by sar sensor for near body -->
+    <integer translatable="false" name="config_wifi_framework_sar_near_body_event_id">4</integer>
 
     <!-- Wifi driver supports batched scan -->
     <bool translatable="false" name="config_wifi_batched_scan_supported">false</bool>
@@ -2087,6 +2117,10 @@
          states. -->
     <bool name="config_dozeAlwaysOnDisplayAvailable">false</bool>
 
+    <!-- Control whether the always on display mode is enabled by default. This value will be used
+         during initialization when the setting is still null. -->
+    <bool name="config_dozeAlwaysOnEnabled">true</bool>
+
     <!-- Whether the display blanks itself when transitioning from a doze to a non-doze state -->
     <bool name="config_displayBlanksAfterDoze">false</bool>
 
@@ -2329,6 +2363,9 @@
     <!-- Whether safe headphone volume is enabled or not (country specific). -->
     <bool name="config_safe_media_volume_enabled">true</bool>
 
+    <!-- Whether safe headphone volume warning dialog is disabled on Vol+ (operator specific). -->
+    <bool name="config_safe_media_disable_on_volume_up">true</bool>
+
     <!-- Set to true if the wifi display supports compositing content stored
          in gralloc protected buffers.  For this to be true, there must exist
          a protected hardware path for surface flinger to composite and send
@@ -2700,6 +2737,9 @@
          empty string is passed in -->
     <string name="config_ims_package"/>
 
+    <!-- String array containing numbers that shouldn't be logged. Country-specific. -->
+    <string-array name="unloggable_phone_numbers" />
+
     <!-- Flag specifying whether or not IMS will use the dynamic ImsResolver -->
     <bool name="config_dynamic_bind_ims">false</bool>
 
@@ -2746,7 +2786,7 @@
         <item>SUPL_PORT=7275</item>
         <item>SUPL_VER=0x20000</item>
         <item>SUPL_MODE=1</item>
-        <item>SUPL_ES=0</item>
+        <item>SUPL_ES=1</item>
         <item>LPP_PROFILE=0</item>
         <item>USE_EMERGENCY_PDN_FOR_EMERGENCY_SUPL=1</item>
         <item>A_GLONASS_POS_PROTOCOL_SELECT=0</item>
@@ -2933,11 +2973,23 @@
          -->
     <string translatable="false" name="config_mainBuiltInDisplayCutout"></string>
 
+    <!-- Like config_mainBuiltInDisplayCutout, but this path is used to report the
+         one single bounding rect per device edge to the app via
+         {@link DisplayCutout#getBoundingRect}. Note that this path should try to match the visual
+         appearance of the cutout as much as possible, and may be smaller than
+         config_mainBuiltInDisplayCutout
+         -->
+    <string translatable="false" name="config_mainBuiltInDisplayCutoutRectApproximation">@string/config_mainBuiltInDisplayCutout</string>
+
     <!-- Whether the display cutout region of the main built-in display should be forced to
          black in software (to avoid aliasing or emulate a cutout that is not physically existent).
          -->
     <bool name="config_fillMainBuiltInDisplayCutout">false</bool>
 
+    <!-- If true, and there is a cutout on the main built in display, the cutout will be masked
+         by shrinking the display such that it does not overlap the cutout area. -->
+    <bool name="config_maskMainBuiltInDisplayCutout">false</bool>
+
     <!-- Ultrasound support for Mic/speaker path -->
     <!-- Whether the default microphone audio source supports near-ultrasound frequencies
          (range of 18 - 21 kHz). -->
@@ -3139,6 +3191,9 @@
     <!-- True if camera app should be pinned via Pinner Service -->
     <bool name="config_pinnerCameraApp">false</bool>
 
+    <!-- True if home app should be pinned via Pinner Service -->
+    <bool name="config_pinnerHomeApp">false</bool>
+
     <!-- Number of days preloaded file cache should be preserved on a device before it can be
          deleted -->
     <integer name="config_keepPreloadsMinDays">7</integer>
@@ -3459,4 +3514,17 @@
     <!-- Minimal height of bottom stack when IME is displayed -->
     <dimen name="config_bottom_stack_minimal_height">0dp</dimen>
 
+    <!-- Applications which are disabled unless matching a particular sku -->
+    <string-array name="config_disableApksUnlessMatchedSku_apk_list" translatable="false" />
+    <string-array name="config_disableApkUnlessMatchedSku_skus_list" translatable="false" />
+
+    <!-- Whether or not we should show the option to show battery percentage -->
+    <bool name="config_battery_percentage_setting_available">true</bool>
+
+    <!-- Model of potentially misprovisioned devices. If none is specified in an overlay, an
+         empty string is passed in. -->
+    <string name="config_misprovisionedDeviceModel" translatable="false"></string>
+
+    <!-- Brand value for attestation of misprovisioned device. -->
+    <string name="config_misprovisionedBrandValue" translatable="false"></string>
 </resources>
diff --git a/core/res/res/values/dimens.xml b/core/res/res/values/dimens.xml
index 471170bbe93..73cb59e8464 100644
--- a/core/res/res/values/dimens.xml
+++ b/core/res/res/values/dimens.xml
@@ -61,6 +61,15 @@
     <!-- Margin at the edge of the screen to ignore touch events for in the windowshade. -->
     <dimen name="status_bar_edge_ignore">5dp</dimen>
 
+    <!-- Default radius of the software rounded corners. -->
+    <dimen name="rounded_corner_radius">0dp</dimen>
+    <!-- Radius of the software rounded corners at the top of the display in its natural
+        orientation. If zero, the value of rounded_corner_radius is used. -->
+    <dimen name="rounded_corner_radius_top">0dp</dimen>
+    <!-- Radius of the software rounded corners at the bottom of the display in its natural
+        orientation. If zero, the value of rounded_corner_radius is used. -->
+    <dimen name="rounded_corner_radius_bottom">0dp</dimen>
+
     <!-- Width of the window of the divider bar used to resize docked stacks. -->
     <dimen name="docked_stack_divider_thickness">48dp</dimen>
 
diff --git a/core/res/res/values/strings.xml b/core/res/res/values/strings.xml
index 2ba0b80ef00..2ba4da6738a 100644
--- a/core/res/res/values/strings.xml
+++ b/core/res/res/values/strings.xml
@@ -3169,6 +3169,21 @@
     <!-- A notification is shown when the user connects to a Wi-Fi network and the system detects that that network has no Internet access. This is the notification's message. -->
     <string name="wifi_no_internet_detailed">Tap for options</string>
 
+    <!-- A notification is shown when the user's softap config has been changed due to underlying
+         hardware restrictions. This is the notifications's title.
+         [CHAR_LIMIT=NONE] -->
+    <string name="wifi_softap_config_change">Changes to your hotspot settings</string>
+
+    <!-- A notification is shown when the user's softap config has been changed due to underlying
+         hardware restrictions. This is the notification's summary message.
+         [CHAR_LIMIT=NONE] -->
+    <string name="wifi_softap_config_change_summary">Your hotspot band has changed.</string>
+
+    <!-- A notification is shown when the user's softap config has been changed due to underlying
+         hardware restrictions. This is the notification's full message.
+         [CHAR_LIMIT=NONE] -->
+    <string name="wifi_softap_config_change_detailed">This device doesn\u2019t support your preference for 5GHz only. Instead, this device will use the 5GHz band when available.</string>
+
     <!-- A notification might be shown if the device switches to another network type (e.g., mobile data) because it detects that the network it was using (e.g., Wi-Fi) has lost Internet connectivity. This is the notification's title. %1$s is the network type that the device switched to, e.g., cellular data. It is one of the strings in the network_switch_type_name array. -->
     <string name="network_switch_metered">Switched to <xliff:g id="network_type">%1$s</xliff:g></string>
 
diff --git a/core/res/res/values/symbols.xml b/core/res/res/values/symbols.xml
index 8ba7ae499fb..99cca2c46ed 100644
--- a/core/res/res/values/symbols.xml
+++ b/core/res/res/values/symbols.xml
@@ -309,6 +309,7 @@
   <java-symbol type="bool" name="config_allowAnimationsInLowPowerMode" />
   <java-symbol type="bool" name="config_useDevInputEventForAudioJack" />
   <java-symbol type="bool" name="config_safe_media_volume_enabled" />
+  <java-symbol type="bool" name="config_safe_media_disable_on_volume_up" />
   <java-symbol type="bool" name="config_camera_sound_forced" />
   <java-symbol type="bool" name="config_dontPreferApn" />
   <java-symbol type="bool" name="config_restartRadioAfterProvisioning" />
@@ -336,7 +337,14 @@
   <java-symbol type="bool" name="config_wifi_framework_enable_associated_network_selection" />
   <java-symbol type="bool" name="config_wifi_framework_use_single_radio_chain_scan_results_network_selection" />
   <java-symbol type="bool" name="config_wifi_only_link_same_credential_configurations" />
-  <java-symbol type="bool" name="config_wifi_framework_enable_voice_call_sar_tx_power_limit" />
+  <java-symbol type="bool" name="config_wifi_framework_enable_sar_tx_power_limit" />
+  <java-symbol type="bool" name="config_wifi_framework_enable_soft_ap_sar_tx_power_limit" />
+  <java-symbol type="bool" name="config_wifi_framework_enable_body_proximity_sar_tx_power_limit" />
+  <java-symbol type="string" name="config_wifi_sar_sensor_type" />
+  <java-symbol type="integer" name="config_wifi_framework_sar_free_space_event_id" />
+  <java-symbol type="integer" name="config_wifi_framework_sar_near_hand_event_id" />
+  <java-symbol type="integer" name="config_wifi_framework_sar_near_head_event_id" />
+  <java-symbol type="integer" name="config_wifi_framework_sar_near_body_event_id" />
   <java-symbol type="bool" name="config_wifi_enable_disconnection_debounce" />
   <java-symbol type="bool" name="config_wifi_revert_country_code_on_cellular_loss" />
   <java-symbol type="bool" name="config_wifi_enable_wifi_firmware_debugging" />
@@ -1055,6 +1063,9 @@
   <java-symbol type="string" name="network_switch_type_name_unknown" />
   <java-symbol type="string" name="wifi_no_internet" />
   <java-symbol type="string" name="wifi_no_internet_detailed" />
+  <java-symbol type="string" name="wifi_softap_config_change" />
+  <java-symbol type="string" name="wifi_softap_config_change_summary" />
+  <java-symbol type="string" name="wifi_softap_config_change_detailed" />
   <java-symbol type="string" name="wifi_connect_alert_title" />
   <java-symbol type="string" name="wifi_connect_alert_message" />
   <java-symbol type="string" name="wifi_connect_default_application" />
@@ -1822,6 +1833,7 @@
   <java-symbol type="array" name="config_tether_bluetooth_regexs" />
   <java-symbol type="array" name="config_tether_dhcp_range" />
   <java-symbol type="array" name="config_tether_upstream_types" />
+  <java-symbol type="bool" name="config_tether_upstream_automatic" />
   <java-symbol type="array" name="config_tether_apndata" />
   <java-symbol type="array" name="config_tether_usb_regexs" />
   <java-symbol type="array" name="config_tether_wifi_regexs" />
@@ -2193,6 +2205,7 @@
   <java-symbol type="string" name="ext_media_move_failure_message" />
   <java-symbol type="style" name="Animation.RecentApplications" />
   <java-symbol type="integer" name="dock_enter_exit_duration" />
+  <java-symbol type="bool" name="config_battery_percentage_setting_available" />
 
   <!-- ImfTest -->
   <java-symbol type="layout" name="auto_complete_list" />
@@ -2232,6 +2245,7 @@
   <java-symbol type="drawable" name="decor_maximize_button_light" />
   <java-symbol type="color" name="decor_button_dark_color" />
   <java-symbol type="color" name="decor_button_light_color" />
+  <java-symbol type="array" name="unloggable_phone_numbers" />
 
   <!-- From TelephonyProvider -->
   <java-symbol type="xml" name="apns" />
@@ -2887,6 +2901,7 @@
   <!-- Pinner Service -->
   <java-symbol type="array" name="config_defaultPinnerServiceFiles" />
   <java-symbol type="bool" name="config_pinnerCameraApp" />
+  <java-symbol type="bool" name="config_pinnerHomeApp" />
 
   <java-symbol type="string" name="config_doubleTouchGestureEnableFile" />
 
@@ -3231,6 +3246,7 @@
   <java-symbol type="dimen" name="config_inCallNotificationVolume" />
   <java-symbol type="string" name="config_inCallNotificationSound" />
   <java-symbol type="bool" name="config_dozeAlwaysOnDisplayAvailable" />
+  <java-symbol type="bool" name="config_dozeAlwaysOnEnabled" />
   <java-symbol type="bool" name="config_displayBlanksAfterDoze" />
   <java-symbol type="bool" name="config_displayBrightnessBucketsInDoze" />
   <java-symbol type="integer" name="config_storageManagerDaystoRetainDefault" />
@@ -3326,6 +3342,7 @@
 
   <java-symbol type="string" name="global_action_logout" />
   <java-symbol type="string" name="config_mainBuiltInDisplayCutout" />
+  <java-symbol type="string" name="config_mainBuiltInDisplayCutoutRectApproximation" />
   <java-symbol type="drawable" name="messaging_user" />
   <java-symbol type="bool" name="config_fillMainBuiltInDisplayCutout" />
   <java-symbol type="drawable" name="ic_logout" />
@@ -3412,4 +3429,12 @@
 
   <!-- Minimal height of bottom stack when IME is displayed -->
   <java-symbol type="dimen" name="config_bottom_stack_minimal_height" />
+
+  <java-symbol type="bool" name="config_maskMainBuiltInDisplayCutout" />
+
+  <java-symbol type="array" name="config_disableApksUnlessMatchedSku_apk_list" />
+  <java-symbol type="array" name="config_disableApkUnlessMatchedSku_skus_list" />
+
+  <java-symbol type="string" name="config_misprovisionedDeviceModel" />
+  <java-symbol type="string" name="config_misprovisionedBrandValue" />
 </resources>
diff --git a/core/res/res/values/themes.xml b/core/res/res/values/themes.xml
index 48338166065..090f9afb551 100644
--- a/core/res/res/values/themes.xml
+++ b/core/res/res/values/themes.xml
@@ -306,6 +306,7 @@ please see themes_device_defaults.xml.
         <item name="quickContactBadgeStyleSmallWindowLarge">@style/Widget.QuickContactBadgeSmall.WindowLarge</item>
         <item name="listPopupWindowStyle">@style/Widget.ListPopupWindow</item>
         <item name="popupMenuStyle">@style/Widget.PopupMenu</item>
+        <item name="popupTheme">@null</item>
         <item name="activityChooserViewStyle">@style/Widget.ActivityChooserView</item>
         <item name="fragmentBreadCrumbsStyle">@style/Widget.FragmentBreadCrumbs</item>
         <item name="contextPopupMenuStyle">?attr/popupMenuStyle</item>
diff --git a/core/res/res/values/themes_holo.xml b/core/res/res/values/themes_holo.xml
index cb5b93dd7df..33832d4eb68 100644
--- a/core/res/res/values/themes_holo.xml
+++ b/core/res/res/values/themes_holo.xml
@@ -296,6 +296,7 @@ please see themes_device_defaults.xml.
         <item name="quickContactBadgeStyleSmallWindowLarge">@style/Widget.Holo.QuickContactBadgeSmall.WindowLarge</item>
         <item name="listPopupWindowStyle">@style/Widget.Holo.ListPopupWindow</item>
         <item name="popupMenuStyle">@style/Widget.Holo.PopupMenu</item>
+        <item name="popupTheme">@null</item>
         <item name="stackViewStyle">@style/Widget.Holo.StackView</item>
         <item name="activityChooserViewStyle">@style/Widget.Holo.ActivityChooserView</item>
         <item name="fragmentBreadCrumbsStyle">@style/Widget.Holo.FragmentBreadCrumbs</item>
@@ -658,9 +659,11 @@ please see themes_device_defaults.xml.
         <item name="quickContactBadgeStyleSmallWindowLarge">@style/Widget.Holo.QuickContactBadgeSmall.WindowLarge</item>
         <item name="listPopupWindowStyle">@style/Widget.Holo.Light.ListPopupWindow</item>
         <item name="popupMenuStyle">@style/Widget.Holo.Light.PopupMenu</item>
+        <item name="popupTheme">@null</item>
         <item name="stackViewStyle">@style/Widget.Holo.StackView</item>
         <item name="activityChooserViewStyle">@style/Widget.Holo.Light.ActivityChooserView</item>
         <item name="fragmentBreadCrumbsStyle">@style/Widget.Holo.Light.FragmentBreadCrumbs</item>
+        <item name="contextPopupMenuStyle">?attr/popupMenuStyle</item>
 
         <!-- Preference styles -->
         <item name="preferenceScreenStyle">@style/Preference.Holo.PreferenceScreen</item>
diff --git a/core/tests/coretests/src/android/provider/SettingsBackupTest.java b/core/tests/coretests/src/android/provider/SettingsBackupTest.java
index e1e25b77f56..d60b3393e43 100644
--- a/core/tests/coretests/src/android/provider/SettingsBackupTest.java
+++ b/core/tests/coretests/src/android/provider/SettingsBackupTest.java
@@ -99,6 +99,7 @@ public class SettingsBackupTest {
     private static final Set<String> BACKUP_BLACKLISTED_GLOBAL_SETTINGS =
             newHashSet(
                     Settings.Global.ACTIVITY_MANAGER_CONSTANTS,
+                    Settings.Global.ACTIVITY_STARTS_LOGGING_ENABLED,
                     Settings.Global.ADAPTIVE_BATTERY_MANAGEMENT_ENABLED,
                     Settings.Global.ADB_ENABLED,
                     Settings.Global.ADD_USERS_WHEN_LOCKED,
@@ -508,6 +509,8 @@ public class SettingsBackupTest {
                  Settings.Secure.ANR_SHOW_BACKGROUND,
                  Settings.Secure.ASSISTANT,
                  Settings.Secure.ASSIST_DISCLOSURE_ENABLED,
+                 Settings.Secure.ASSIST_GESTURE_SENSITIVITY,
+                 Settings.Secure.ASSIST_GESTURE_SETUP_COMPLETE,
                  Settings.Secure.ASSIST_SCREENSHOT_ENABLED,
                  Settings.Secure.ASSIST_STRUCTURE_ENABLED,
                  Settings.Secure.AUTOFILL_FEATURE_FIELD_CLASSIFICATION,
diff --git a/core/tests/coretests/src/android/view/DisplayCutoutTest.java b/core/tests/coretests/src/android/view/DisplayCutoutTest.java
index 6ee74cb9a74..fe45fe7d3aa 100644
--- a/core/tests/coretests/src/android/view/DisplayCutoutTest.java
+++ b/core/tests/coretests/src/android/view/DisplayCutoutTest.java
@@ -19,6 +19,7 @@ package android.view;
 import static android.view.DisplayCutout.NO_CUTOUT;
 import static android.view.DisplayCutout.fromSpec;
 
+import static org.hamcrest.Matchers.equalTo;
 import static org.hamcrest.Matchers.not;
 import static org.hamcrest.Matchers.sameInstance;
 import static org.junit.Assert.assertEquals;
@@ -219,6 +220,19 @@ public class DisplayCutoutTest {
         assertThat(fromSpec("L1,0 L1,1 L0,1 z", 200, 400, 1f), not(sameInstance(cached)));
     }
 
+    @Test
+    public void fromSpec_setsSafeInsets_top() {
+        DisplayCutout cutout = fromSpec("M -50,0 v 20 h 100 v -20 z", 200, 400, 2f);
+        assertThat(cutout.getSafeInsets(), equalTo(new Rect(0, 20, 0, 0)));
+    }
+
+    @Test
+    public void fromSpec_setsSafeInsets_top_and_bottom() {
+        DisplayCutout cutout = fromSpec("M -50,0 v 20 h 100 v -20 z"
+                + "@bottom M -50,0 v -10,0 h 100 v 20 z", 200, 400, 2f);
+        assertThat(cutout.getSafeInsets(), equalTo(new Rect(0, 20, 0, 10)));
+    }
+
     @Test
     public void parcel_unparcel_nocutout() {
         Parcel p = Parcel.obtain();
diff --git a/core/tests/coretests/src/com/android/internal/app/IntentForwarderActivityTest.java b/core/tests/coretests/src/com/android/internal/app/IntentForwarderActivityTest.java
index b18fa747557..c165b6be525 100644
--- a/core/tests/coretests/src/com/android/internal/app/IntentForwarderActivityTest.java
+++ b/core/tests/coretests/src/com/android/internal/app/IntentForwarderActivityTest.java
@@ -16,46 +16,50 @@
 
 package com.android.internal.app;
 
+import static junit.framework.Assert.assertEquals;
+import static junit.framework.Assert.assertNotNull;
+import static junit.framework.Assert.assertNull;
+import static org.mockito.ArgumentMatchers.any;
+import static org.mockito.ArgumentMatchers.anyInt;
+import static org.mockito.ArgumentMatchers.anyString;
+import static org.mockito.ArgumentMatchers.eq;
+import static org.mockito.ArgumentMatchers.nullable;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.spy;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
+
 import android.annotation.Nullable;
 import android.content.ComponentName;
 import android.content.Context;
 import android.content.Intent;
+import android.content.pm.ActivityInfo;
+import android.content.pm.ApplicationInfo;
 import android.content.pm.IPackageManager;
 import android.content.pm.PackageManager;
+import android.content.pm.ResolveInfo;
 import android.content.pm.UserInfo;
+import android.net.Uri;
 import android.os.Bundle;
+import android.os.RemoteException;
 import android.os.UserHandle;
 import android.os.UserManager;
 import android.support.test.InstrumentationRegistry;
 import android.support.test.rule.ActivityTestRule;
 import android.support.test.runner.AndroidJUnit4;
-import android.util.Log;
-
+import java.util.ArrayList;
+import java.util.List;
 import org.junit.Before;
 import org.junit.Rule;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.ArgumentCaptor;
 import org.mockito.Mock;
-import org.mockito.Mockito;
 import org.mockito.MockitoAnnotations;
 
-import java.util.ArrayList;
-import java.util.List;
-
-import static junit.framework.Assert.assertEquals;
-import static junit.framework.Assert.assertNotNull;
-import static junit.framework.Assert.assertNull;
-import static org.mockito.ArgumentMatchers.any;
-import static org.mockito.ArgumentMatchers.anyInt;
-import static org.mockito.ArgumentMatchers.anyString;
-import static org.mockito.ArgumentMatchers.eq;
-import static org.mockito.ArgumentMatchers.nullable;
-import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.when;
-
 @RunWith(AndroidJUnit4.class)
 public class IntentForwarderActivityTest {
+
     private static final ComponentName FORWARD_TO_MANAGED_PROFILE_COMPONENT_NAME =
             new ComponentName(
                     "android",
@@ -77,22 +81,26 @@ public class IntentForwarderActivityTest {
 
     private static IntentForwarderActivity.Injector sInjector;
     private static ComponentName sComponentName;
+    private static String sActivityName;
+    private static String sPackageName;
 
     @Mock private IPackageManager mIPm;
     @Mock private PackageManager mPm;
     @Mock private UserManager mUserManager;
+    @Mock private ApplicationInfo mApplicationInfo;
 
     @Rule
     public ActivityTestRule<IntentForwarderWrapperActivity> mActivityRule =
             new ActivityTestRule<>(IntentForwarderWrapperActivity.class, true, false);
 
     private Context mContext;
+    public static final String PHONE_NUMBER = "123-456-789";
 
     @Before
     public void setup() {
         MockitoAnnotations.initMocks(this);
         mContext = InstrumentationRegistry.getTargetContext();
-        sInjector = new TestInjector();
+        sInjector = spy(new TestInjector());
     }
 
     @Test
@@ -252,6 +260,149 @@ public class IntentForwarderActivityTest {
         assertEquals(MANAGED_PROFILE_INFO.id, activity.mUserIdActivityLaunchedIn);
     }
 
+    @Test
+    public void shouldSkipDisclosure_notWhitelisted() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_SEND)
+            .setType(TYPE_PLAIN_TEXT);
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_withResolverActivity() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        sActivityName = ResolverActivity.class.getName();
+        sPackageName = "android";
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_SEND)
+            .setType(TYPE_PLAIN_TEXT);
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector, never()).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_callIntent_call() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_CALL);
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector, never()).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_callIntent_dial() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_DIAL);
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector, never()).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_callIntent_notCallOrDial() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_ALARM_CHANGED);
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_textMessageIntent_sms() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_SENDTO)
+            .setData(Uri.fromParts("sms", PHONE_NUMBER, null));
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector, never()).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_textMessageIntent_smsto() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_SENDTO)
+            .setData(Uri.fromParts("smsto", PHONE_NUMBER, null));
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector, never()).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_textMessageIntent_mms() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_SENDTO)
+            .setData(Uri.fromParts("mms", PHONE_NUMBER, null));
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector, never()).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_textMessageIntent_mmsto() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_SENDTO)
+            .setData(Uri.fromParts("mmsto", PHONE_NUMBER, null));
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector, never()).showToast(anyInt(), anyInt());
+    }
+
+    @Test
+    public void shouldSkipDisclosure_textMessageIntent_invalidUri() throws RemoteException {
+        setupShouldSkipDisclosureTest();
+        Intent intent = new Intent(mContext, IntentForwarderWrapperActivity.class)
+            .setAction(Intent.ACTION_SENDTO)
+            .setData(Uri.fromParts("invalid", PHONE_NUMBER, null));
+
+        mActivityRule.launchActivity(intent);
+
+        verify(mIPm).canForwardTo(any(), any(), anyInt(), anyInt());
+        verify(sInjector).showToast(anyInt(), anyInt());
+    }
+
+    private void setupShouldSkipDisclosureTest() throws RemoteException {
+        sComponentName = FORWARD_TO_MANAGED_PROFILE_COMPONENT_NAME;
+        sActivityName = "MyTestActivity";
+        sPackageName = "test.package.name";
+        when(mApplicationInfo.isSystemApp()).thenReturn(true);
+        // Managed profile exists.
+        List<UserInfo> profiles = new ArrayList<>();
+        profiles.add(CURRENT_USER_INFO);
+        profiles.add(MANAGED_PROFILE_INFO);
+        when(mUserManager.getProfiles(anyInt())).thenReturn(profiles);
+        // Intent can be forwarded.
+        when(mIPm.canForwardTo(
+            any(Intent.class), nullable(String.class), anyInt(), anyInt())).thenReturn(true);
+    }
 
     public static class IntentForwarderWrapperActivity extends IntentForwarderActivity {
         private Intent mStartActivityIntent;
@@ -276,7 +427,7 @@ public class IntentForwarderActivityTest {
         }
     }
 
-    class TestInjector implements IntentForwarderActivity.Injector {
+    public class TestInjector implements IntentForwarderActivity.Injector {
 
         @Override
         public IPackageManager getIPackageManager() {
@@ -292,5 +443,21 @@ public class IntentForwarderActivityTest {
         public PackageManager getPackageManager() {
             return mPm;
         }
+
+        @Override
+        public ResolveInfo resolveActivityAsUser(Intent intent, int flags, int userId) {
+            ActivityInfo activityInfo = new ActivityInfo();
+            activityInfo.packageName = sPackageName;
+            activityInfo.name = sActivityName;
+            activityInfo.applicationInfo = mApplicationInfo;
+
+            ResolveInfo resolveInfo = new ResolveInfo();
+            resolveInfo.activityInfo = activityInfo;
+
+            return resolveInfo;
+        }
+
+        @Override
+        public void showToast(int messageId, int duration) {}
     }
 }
\ No newline at end of file
diff --git a/graphics/java/android/graphics/Canvas.java b/graphics/java/android/graphics/Canvas.java
index a465eeafa28..22c4e7557b7 100644
--- a/graphics/java/android/graphics/Canvas.java
+++ b/graphics/java/android/graphics/Canvas.java
@@ -1591,9 +1591,9 @@ public class Canvas extends BaseCanvas {
      * Draw the specified circle using the specified paint. If radius is <= 0, then nothing will be
      * drawn. The circle will be filled or framed based on the Style in the paint.
      *
-     * @param cx The x-coordinate of the center of the cirle to be drawn
-     * @param cy The y-coordinate of the center of the cirle to be drawn
-     * @param radius The radius of the cirle to be drawn
+     * @param cx The x-coordinate of the center of the circle to be drawn
+     * @param cy The y-coordinate of the center of the circle to be drawn
+     * @param radius The radius of the circle to be drawn
      * @param paint The paint used to draw the circle
      */
     public void drawCircle(float cx, float cy, float radius, @NonNull Paint paint) {
diff --git a/keystore/java/android/security/keystore/AndroidKeyStoreKeyGeneratorSpi.java b/keystore/java/android/security/keystore/AndroidKeyStoreKeyGeneratorSpi.java
index 419eb24e1cc..953cef7d30f 100644
--- a/keystore/java/android/security/keystore/AndroidKeyStoreKeyGeneratorSpi.java
+++ b/keystore/java/android/security/keystore/AndroidKeyStoreKeyGeneratorSpi.java
@@ -301,6 +301,9 @@ public abstract class AndroidKeyStoreKeyGeneratorSpi extends KeyGeneratorSpi {
                 KeyStoreCryptoOperationUtils.getRandomBytesToMixIntoKeystoreRng(
                         mRng, (mKeySizeBits + 7) / 8);
         int flags = 0;
+        if (spec.isStrongBoxBacked()) {
+            flags |= KeyStore.FLAG_STRONGBOX;
+        }
         String keyAliasInKeystore = Credentials.USER_PRIVATE_KEY + spec.getKeystoreAlias();
         KeyCharacteristics resultingKeyCharacteristics = new KeyCharacteristics();
         boolean success = false;
@@ -314,8 +317,12 @@ public abstract class AndroidKeyStoreKeyGeneratorSpi extends KeyGeneratorSpi {
                     flags,
                     resultingKeyCharacteristics);
             if (errorCode != KeyStore.NO_ERROR) {
-                throw new ProviderException(
-                        "Keystore operation failed", KeyStore.getKeyStoreException(errorCode));
+                if (errorCode == KeyStore.HARDWARE_TYPE_UNAVAILABLE) {
+                    throw new StrongBoxUnavailableException("Failed to generate key");
+                } else {
+                    throw new ProviderException(
+                            "Keystore operation failed", KeyStore.getKeyStoreException(errorCode));
+                }
             }
             @KeyProperties.KeyAlgorithmEnum String keyAlgorithmJCA;
             try {
diff --git a/keystore/java/android/security/keystore/AndroidKeyStoreSpi.java b/keystore/java/android/security/keystore/AndroidKeyStoreSpi.java
index 2b5a37bd84e..4c007cb70ba 100644
--- a/keystore/java/android/security/keystore/AndroidKeyStoreSpi.java
+++ b/keystore/java/android/security/keystore/AndroidKeyStoreSpi.java
@@ -811,7 +811,7 @@ public class AndroidKeyStoreSpi extends KeyStoreSpi {
         }
 
         int errorCode = mKeyStore.importWrappedKey(
-            Credentials.USER_SECRET_KEY + alias,
+            Credentials.USER_PRIVATE_KEY + alias,
             entry.getWrappedKeyBytes(),
             Credentials.USER_PRIVATE_KEY + entry.getWrappingKeyAlias(),
             maskingKey,
diff --git a/keystore/java/android/security/keystore/AttestationUtils.java b/keystore/java/android/security/keystore/AttestationUtils.java
index 1be8309bcf5..f7993eff6b0 100644
--- a/keystore/java/android/security/keystore/AttestationUtils.java
+++ b/keystore/java/android/security/keystore/AttestationUtils.java
@@ -22,9 +22,9 @@ import android.annotation.RequiresPermission;
 import android.annotation.SystemApi;
 import android.annotation.TestApi;
 import android.content.Context;
+import android.content.res.Resources;
 import android.os.Build;
 import android.security.KeyStore;
-import android.security.KeyStoreException;
 import android.security.keymaster.KeymasterArguments;
 import android.security.keymaster.KeymasterCertificateChain;
 import android.security.keymaster.KeymasterDefs;
@@ -117,6 +117,40 @@ public abstract class AttestationUtils {
     @NonNull public static KeymasterArguments prepareAttestationArguments(Context context,
             @NonNull int[] idTypes, @NonNull byte[] attestationChallenge) throws
             DeviceIdAttestationException {
+        return prepareAttestationArguments(context, idTypes,attestationChallenge, Build.BRAND);
+    }
+
+    /**
+     * Prepares Keymaster Arguments with attestation data for misprovisioned Pixel 2 device.
+     * See http://go/keyAttestationFailure and http://b/69471841 for more info.
+     * @hide should only be used by KeyChain.
+     */
+    @NonNull public static KeymasterArguments prepareAttestationArgumentsIfMisprovisioned(
+            Context context, @NonNull int[] idTypes, @NonNull byte[] attestationChallenge) throws
+            DeviceIdAttestationException {
+        if (!isPotentiallyMisprovisionedDevice(context)) {
+            return null;
+        }
+        Resources resources = context.getResources();
+        String misprovisionedBrand = resources.getString(
+                com.android.internal.R.string.config_misprovisionedBrandValue);
+        return prepareAttestationArguments(
+                    context, idTypes, attestationChallenge, misprovisionedBrand);
+    }
+
+    @NonNull private static boolean isPotentiallyMisprovisionedDevice(Context context) {
+        Resources resources = context.getResources();
+        String misprovisionedModel = resources.getString(
+                com.android.internal.R.string.config_misprovisionedDeviceModel);
+        String misprovisionedBrand = resources.getString(
+                com.android.internal.R.string.config_misprovisionedBrandValue);
+
+        return (Build.MODEL.equals(misprovisionedModel));
+    }
+
+    @NonNull private static KeymasterArguments prepareAttestationArguments(Context context,
+            @NonNull int[] idTypes, @NonNull byte[] attestationChallenge, String brand) throws
+            DeviceIdAttestationException {
         // Check method arguments, retrieve requested device IDs and prepare attestation arguments.
         if (attestationChallenge == null) {
             throw new NullPointerException("Missing attestation challenge");
@@ -169,7 +203,7 @@ public abstract class AttestationUtils {
             }
         }
         attestArgs.addBytes(KeymasterDefs.KM_TAG_ATTESTATION_ID_BRAND,
-                Build.BRAND.getBytes(StandardCharsets.UTF_8));
+                brand.getBytes(StandardCharsets.UTF_8));
         attestArgs.addBytes(KeymasterDefs.KM_TAG_ATTESTATION_ID_DEVICE,
                 Build.DEVICE.getBytes(StandardCharsets.UTF_8));
         attestArgs.addBytes(KeymasterDefs.KM_TAG_ATTESTATION_ID_PRODUCT,
diff --git a/keystore/java/android/security/keystore/KeyGenParameterSpec.java b/keystore/java/android/security/keystore/KeyGenParameterSpec.java
index b2e0f675f5f..553e86e175d 100644
--- a/keystore/java/android/security/keystore/KeyGenParameterSpec.java
+++ b/keystore/java/android/security/keystore/KeyGenParameterSpec.java
@@ -268,6 +268,11 @@ public final class KeyGenParameterSpec implements AlgorithmParameterSpec, UserAu
     private final boolean mIsStrongBoxBacked;
     private final boolean mUserConfirmationRequired;
     private final boolean mUnlockedDeviceRequired;
+    /*
+     * ***NOTE***: All new fields MUST also be added to the following:
+     * ParcelableKeyGenParameterSpec class.
+     * The KeyGenParameterSpec.Builder constructor that takes a KeyGenParameterSpec
+     */
 
     /**
      * @hide should be built with Builder
@@ -791,6 +796,9 @@ public final class KeyGenParameterSpec implements AlgorithmParameterSpec, UserAu
             mUniqueIdIncluded = sourceSpec.isUniqueIdIncluded();
             mUserAuthenticationValidWhileOnBody = sourceSpec.isUserAuthenticationValidWhileOnBody();
             mInvalidatedByBiometricEnrollment = sourceSpec.isInvalidatedByBiometricEnrollment();
+            mIsStrongBoxBacked = sourceSpec.isStrongBoxBacked();
+            mUserConfirmationRequired = sourceSpec.isUserConfirmationRequired();
+            mUnlockedDeviceRequired = sourceSpec.isUnlockedDeviceRequired();
         }
 
         /**
diff --git a/keystore/java/android/security/keystore/ParcelableKeyGenParameterSpec.java b/keystore/java/android/security/keystore/ParcelableKeyGenParameterSpec.java
index 911bbf8c4eb..8231dc98457 100644
--- a/keystore/java/android/security/keystore/ParcelableKeyGenParameterSpec.java
+++ b/keystore/java/android/security/keystore/ParcelableKeyGenParameterSpec.java
@@ -97,11 +97,14 @@ public final class ParcelableKeyGenParameterSpec implements Parcelable {
         out.writeBoolean(mSpec.isRandomizedEncryptionRequired());
         out.writeBoolean(mSpec.isUserAuthenticationRequired());
         out.writeInt(mSpec.getUserAuthenticationValidityDurationSeconds());
+        out.writeBoolean(mSpec.isUserPresenceRequired());
         out.writeByteArray(mSpec.getAttestationChallenge());
         out.writeBoolean(mSpec.isUniqueIdIncluded());
         out.writeBoolean(mSpec.isUserAuthenticationValidWhileOnBody());
         out.writeBoolean(mSpec.isInvalidatedByBiometricEnrollment());
-        out.writeBoolean(mSpec.isUserPresenceRequired());
+        out.writeBoolean(mSpec.isStrongBoxBacked());
+        out.writeBoolean(mSpec.isUserConfirmationRequired());
+        out.writeBoolean(mSpec.isUnlockedDeviceRequired());
     }
 
     private static Date readDateOrNull(Parcel in) {
@@ -114,19 +117,12 @@ public final class ParcelableKeyGenParameterSpec implements Parcelable {
     }
 
     private ParcelableKeyGenParameterSpec(Parcel in) {
-        String keystoreAlias = in.readString();
-        int purposes = in.readInt();
-        KeyGenParameterSpec.Builder builder = new KeyGenParameterSpec.Builder(
-                keystoreAlias, purposes);
-        builder.setUid(in.readInt());
-        // KeySize is -1 by default, if the KeyGenParameterSpec previously parcelled had the default
-        // value, do not set it as this will cause setKeySize to throw.
-        int keySize = in.readInt();
-        if (keySize >= 0) {
-            builder.setKeySize(keySize);
-        }
+        final String keystoreAlias = in.readString();
+        final int purposes = in.readInt();
+        final int uid = in.readInt();
+        final int keySize = in.readInt();
 
-        int keySpecType = in.readInt();
+        final int keySpecType = in.readInt();
         AlgorithmParameterSpec algorithmSpec = null;
         if (keySpecType == ALGORITHM_PARAMETER_SPEC_NONE) {
             algorithmSpec = null;
@@ -141,32 +137,60 @@ public final class ParcelableKeyGenParameterSpec implements Parcelable {
             throw new IllegalArgumentException(
                     String.format("Unknown algorithm parameter spec: %d", keySpecType));
         }
-        if (algorithmSpec != null) {
-            builder.setAlgorithmParameterSpec(algorithmSpec);
-        }
-        builder.setCertificateSubject(new X500Principal(in.createByteArray()));
-        builder.setCertificateSerialNumber(new BigInteger(in.createByteArray()));
-        builder.setCertificateNotBefore(new Date(in.readLong()));
-        builder.setCertificateNotAfter(new Date(in.readLong()));
-        builder.setKeyValidityStart(readDateOrNull(in));
-        builder.setKeyValidityForOriginationEnd(readDateOrNull(in));
-        builder.setKeyValidityForConsumptionEnd(readDateOrNull(in));
-        String[] digests = in.createStringArray();
-        if (digests != null) {
-            builder.setDigests(digests);
-        }
-        builder.setEncryptionPaddings(in.createStringArray());
-        builder.setSignaturePaddings(in.createStringArray());
-        builder.setBlockModes(in.createStringArray());
-        builder.setRandomizedEncryptionRequired(in.readBoolean());
-        builder.setUserAuthenticationRequired(in.readBoolean());
-        builder.setUserAuthenticationValidityDurationSeconds(in.readInt());
-        builder.setAttestationChallenge(in.createByteArray());
-        builder.setUniqueIdIncluded(in.readBoolean());
-        builder.setUserAuthenticationValidWhileOnBody(in.readBoolean());
-        builder.setInvalidatedByBiometricEnrollment(in.readBoolean());
-        builder.setUserPresenceRequired(in.readBoolean());
-        mSpec = builder.build();
+
+        final X500Principal certificateSubject = new X500Principal(in.createByteArray());
+        final BigInteger certificateSerialNumber = new BigInteger(in.createByteArray());
+        final Date certificateNotBefore = new Date(in.readLong());
+        final Date certificateNotAfter = new Date(in.readLong());
+        final Date keyValidityStartDate = readDateOrNull(in);
+        final Date keyValidityForOriginationEnd = readDateOrNull(in);
+        final Date keyValidityForConsumptionEnd = readDateOrNull(in);
+        final String[] digests = in.createStringArray();
+        final String[] encryptionPaddings = in.createStringArray();
+        final String[] signaturePaddings = in.createStringArray();
+        final String[] blockModes = in.createStringArray();
+        final boolean randomizedEncryptionRequired = in.readBoolean();
+        final boolean userAuthenticationRequired = in.readBoolean();
+        final int userAuthenticationValidityDurationSeconds = in.readInt();
+        final boolean userPresenceRequired = in.readBoolean();
+        final byte[] attestationChallenge = in.createByteArray();
+        final boolean uniqueIdIncluded = in.readBoolean();
+        final boolean userAuthenticationValidWhileOnBody = in.readBoolean();
+        final boolean invalidatedByBiometricEnrollment = in.readBoolean();
+        final boolean isStrongBoxBacked = in.readBoolean();
+        final boolean userConfirmationRequired = in.readBoolean();
+        final boolean unlockedDeviceRequired = in.readBoolean();
+        // The KeyGenParameterSpec is intentionally not constructed using a Builder here:
+        // The intention is for this class to break if new parameters are added to the
+        // KeyGenParameterSpec constructor (whereas using a builder would silently drop them).
+        mSpec = new KeyGenParameterSpec(
+                keystoreAlias,
+                uid,
+                keySize,
+                algorithmSpec,
+                certificateSubject,
+                certificateSerialNumber,
+                certificateNotBefore,
+                certificateNotAfter,
+                keyValidityStartDate,
+                keyValidityForOriginationEnd,
+                keyValidityForConsumptionEnd,
+                purposes,
+                digests,
+                encryptionPaddings,
+                signaturePaddings,
+                blockModes,
+                randomizedEncryptionRequired,
+                userAuthenticationRequired,
+                userAuthenticationValidityDurationSeconds,
+                userPresenceRequired,
+                attestationChallenge,
+                uniqueIdIncluded,
+                userAuthenticationValidWhileOnBody,
+                invalidatedByBiometricEnrollment,
+                isStrongBoxBacked,
+                userConfirmationRequired,
+                unlockedDeviceRequired);
     }
 
     public static final Creator<ParcelableKeyGenParameterSpec> CREATOR = new Creator<ParcelableKeyGenParameterSpec>() {
diff --git a/keystore/tests/src/android/security/ParcelableKeyGenParameterSpecTest.java b/keystore/tests/src/android/security/ParcelableKeyGenParameterSpecTest.java
index 254b6be77ea..32f8ec44d11 100644
--- a/keystore/tests/src/android/security/ParcelableKeyGenParameterSpecTest.java
+++ b/keystore/tests/src/android/security/ParcelableKeyGenParameterSpecTest.java
@@ -77,6 +77,9 @@ public final class ParcelableKeyGenParameterSpecTest {
                 .setUniqueIdIncluded(true)
                 .setUserAuthenticationValidWhileOnBody(true)
                 .setInvalidatedByBiometricEnrollment(true)
+                .setIsStrongBoxBacked(true)
+                .setUserConfirmationRequired(true)
+                .setUnlockedDeviceRequired(true)
                 .build();
     }
 
@@ -105,6 +108,9 @@ public final class ParcelableKeyGenParameterSpecTest {
         assertThat(spec.isUniqueIdIncluded(), is(true));
         assertThat(spec.isUserAuthenticationValidWhileOnBody(), is(true));
         assertThat(spec.isInvalidatedByBiometricEnrollment(), is(true));
+        assertThat(spec.isStrongBoxBacked(), is(true));
+        assertThat(spec.isUserConfirmationRequired(), is(true));
+        assertThat(spec.isUnlockedDeviceRequired(), is(true));
     }
 
     private Parcel parcelForReading(ParcelableKeyGenParameterSpec spec) {
diff --git a/libs/hwui/renderthread/RenderProxy.cpp b/libs/hwui/renderthread/RenderProxy.cpp
index 59048be768e..020761110ef 100644
--- a/libs/hwui/renderthread/RenderProxy.cpp
+++ b/libs/hwui/renderthread/RenderProxy.cpp
@@ -87,6 +87,11 @@ void RenderProxy::initialize(const sp<Surface>& surface) {
             [ this, surf = surface ]() mutable { mContext->setSurface(std::move(surf)); });
 }
 
+void RenderProxy::allocateBuffers(const sp<Surface>& surface) {
+    mRenderThread.queue().post(
+            [ surf = surface ]() mutable { surf->allocateBuffers(); });
+}
+
 void RenderProxy::updateSurface(const sp<Surface>& surface) {
     mRenderThread.queue().post(
             [ this, surf = surface ]() mutable { mContext->setSurface(std::move(surf)); });
diff --git a/libs/hwui/renderthread/RenderProxy.h b/libs/hwui/renderthread/RenderProxy.h
index ad534f0d96b..0d29b4bcc31 100644
--- a/libs/hwui/renderthread/RenderProxy.h
+++ b/libs/hwui/renderthread/RenderProxy.h
@@ -70,6 +70,7 @@ public:
     ANDROID_API void setName(const char* name);
 
     ANDROID_API void initialize(const sp<Surface>& surface);
+    ANDROID_API void allocateBuffers(const sp<Surface>& surface);
     ANDROID_API void updateSurface(const sp<Surface>& surface);
     ANDROID_API bool pauseSurface(const sp<Surface>& surface);
     ANDROID_API void setStopped(bool stopped);
diff --git a/location/java/com/android/internal/location/gnssmetrics/GnssMetrics.java b/location/java/com/android/internal/location/gnssmetrics/GnssMetrics.java
index 3643ca4a02f..8a02a82194d 100644
--- a/location/java/com/android/internal/location/gnssmetrics/GnssMetrics.java
+++ b/location/java/com/android/internal/location/gnssmetrics/GnssMetrics.java
@@ -18,6 +18,7 @@ package com.android.internal.location.gnssmetrics;
 
 import android.os.SystemClock;
 import android.os.connectivity.GpsBatteryStats;
+import android.os.SystemProperties;
 
 import android.text.format.DateUtils;
 import android.util.Base64;
@@ -175,6 +176,7 @@ public class GnssMetrics {
           = topFourAverageCn0Statistics.getStandardDeviation();
     }
     msg.powerMetrics = mGnssPowerMetrics.buildProto();
+    msg.hardwareRevision = SystemProperties.get("ro.boot.revision", "");
     String s = Base64.encodeToString(GnssLog.toByteArray(msg), Base64.DEFAULT);
     reset();
     return s;
@@ -239,6 +241,7 @@ public class GnssMetrics {
       s.append("  Energy consumed while on battery (mAh): ").append(
           stats.getEnergyConsumedMaMs() / ((double) DateUtils.HOUR_IN_MILLIS)).append("\n");
     }
+    s.append("Hardware Version: " + SystemProperties.get("ro.boot.revision", "")).append("\n");
     return s.toString();
   }
 
diff --git a/media/java/android/media/MediaCodec.java b/media/java/android/media/MediaCodec.java
index 2207a2a6d4f..bb7b0380f07 100644
--- a/media/java/android/media/MediaCodec.java
+++ b/media/java/android/media/MediaCodec.java
@@ -404,7 +404,7 @@ import java.util.Map;
  <p>
  The codec in turn will return a read-only output buffer via the {@link
  Callback#onOutputBufferAvailable onOutputBufferAvailable} callback in asynchronous mode, or in
- response to a {@link #dequeueOutputBuffer dequeuOutputBuffer} call in synchronous mode. After the
+ response to a {@link #dequeueOutputBuffer dequeueOutputBuffer} call in synchronous mode. After the
  output buffer has been processed, call one of the {@link #releaseOutputBuffer
  releaseOutputBuffer} methods to return the buffer to the codec.
  <p>
diff --git a/media/java/android/media/MediaFormat.java b/media/java/android/media/MediaFormat.java
index 7c68b559746..2a2f4fe757d 100644
--- a/media/java/android/media/MediaFormat.java
+++ b/media/java/android/media/MediaFormat.java
@@ -143,7 +143,7 @@ public final class MediaFormat {
      * MIME type for HEIF still image data encoded in HEVC.
      *
      * To decode such an image, {@link MediaCodec} decoder for
-     * {@ #MIMETYPE_VIDEO_HEVC} shall be used. The client needs to form
+     * {@link #MIMETYPE_VIDEO_HEVC} shall be used. The client needs to form
      * the correct {@link #MediaFormat} based on additional information in
      * the track format, and send it to {@link MediaCodec#configure}.
      *
diff --git a/media/jni/android_media_ImageReader.cpp b/media/jni/android_media_ImageReader.cpp
index c36858ad3d8..a45aa90f5f1 100644
--- a/media/jni/android_media_ImageReader.cpp
+++ b/media/jni/android_media_ImageReader.cpp
@@ -612,8 +612,12 @@ static jint ImageReader_imageSetup(JNIEnv* env, jobject thiz, jobject image) {
     Image_setBufferItem(env, image, buffer);
     env->SetLongField(image, gSurfaceImageClassInfo.mTimestamp,
             static_cast<jlong>(buffer->mTimestamp));
+    auto transform = buffer->mTransform;
+    if (buffer->mTransformToDisplayInverse) {
+        transform |= NATIVE_WINDOW_TRANSFORM_INVERSE_DISPLAY;
+    }
     env->SetIntField(image, gSurfaceImageClassInfo.mTransform,
-            static_cast<jint>(buffer->mTransform));
+            static_cast<jint>(transform));
     env->SetIntField(image, gSurfaceImageClassInfo.mScalingMode,
             static_cast<jint>(buffer->mScalingMode));
 
diff --git a/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/helpers/CameraTestUtils.java b/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/helpers/CameraTestUtils.java
index b2be4643083..5ab50925a26 100644
--- a/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/helpers/CameraTestUtils.java
+++ b/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/helpers/CameraTestUtils.java
@@ -43,6 +43,8 @@ import android.hardware.camera2.CaptureResult;
 import android.hardware.camera2.TotalCaptureResult;
 import android.hardware.camera2.params.InputConfiguration;
 import android.hardware.camera2.params.MeteringRectangle;
+import android.hardware.camera2.params.OutputConfiguration;
+import android.hardware.camera2.params.SessionConfiguration;
 import android.hardware.camera2.params.StreamConfigurationMap;
 import android.location.Location;
 import android.location.LocationManager;
@@ -75,6 +77,7 @@ import java.util.Date;
 import java.util.HashMap;
 import java.util.List;
 import java.util.concurrent.LinkedBlockingQueue;
+import java.util.concurrent.Executor;
 import java.util.concurrent.Semaphore;
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.atomic.AtomicLong;
@@ -693,6 +696,38 @@ public class CameraTestUtils extends Assert {
         return openCamera(manager, cameraId, /*listener*/null, handler);
     }
 
+    /**
+     * Configure a new camera session with output surfaces and initial session parameters.
+     *
+     * @param camera The CameraDevice to be configured.
+     * @param outputSurfaces The surface list that used for camera output.
+     * @param listener The callback CameraDevice will notify when session is available.
+     * @param handler The handler used to notify callbacks.
+     * @param initialRequest Initial request settings to use as session parameters.
+     */
+    public static CameraCaptureSession configureCameraSessionWithParameters(CameraDevice camera,
+            List<Surface> outputSurfaces, BlockingSessionCallback listener,
+            Handler handler, CaptureRequest initialRequest) throws CameraAccessException {
+        List<OutputConfiguration> outConfigurations = new ArrayList<>(outputSurfaces.size());
+        for (Surface surface : outputSurfaces) {
+            outConfigurations.add(new OutputConfiguration(surface));
+        }
+        SessionConfiguration sessionConfig = new SessionConfiguration(
+                SessionConfiguration.SESSION_REGULAR, outConfigurations,
+                new HandlerExecutor(handler), listener);
+        sessionConfig.setSessionParameters(initialRequest);
+        camera.createCaptureSession(sessionConfig);
+
+        CameraCaptureSession session = listener.waitAndGetSession(SESSION_CONFIGURE_TIMEOUT_MS);
+        assertFalse("Camera session should not be a reprocessable session",
+                session.isReprocessable());
+        assertFalse("Capture session type must be regular",
+                CameraConstrainedHighSpeedCaptureSession.class.isAssignableFrom(
+                        session.getClass()));
+
+        return session;
+    }
+
     /**
      * Configure a new camera session with output surfaces and type.
      *
@@ -1334,6 +1369,20 @@ public class CameraTestUtils extends Assert {
         }
     }
 
+    public static class HandlerExecutor implements Executor {
+        private final Handler mHandler;
+
+        public HandlerExecutor(Handler handler) {
+            assertNotNull("handler must be valid", handler);
+            mHandler = handler;
+        }
+
+        @Override
+        public void execute(Runnable runCmd) {
+            mHandler.post(runCmd);
+        }
+    }
+
     /**
      * Provide a mock for {@link CameraDevice.StateCallback}.
      *
diff --git a/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/stress/Camera2RecordingTest.java b/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/stress/Camera2RecordingTest.java
index ddb05f017cc..8f27fefca0d 100644
--- a/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/stress/Camera2RecordingTest.java
+++ b/media/tests/MediaFrameworkTest/src/com/android/mediaframeworktest/stress/Camera2RecordingTest.java
@@ -58,6 +58,7 @@ import static com.android.mediaframeworktest.helpers.CameraTestUtils.SIZE_BOUND_
 import static com.android.mediaframeworktest.helpers.CameraTestUtils.SimpleCaptureCallback;
 import static com.android.mediaframeworktest.helpers.CameraTestUtils.SimpleImageReaderListener;
 import static com.android.mediaframeworktest.helpers.CameraTestUtils.configureCameraSession;
+import static com.android.mediaframeworktest.helpers.CameraTestUtils.configureCameraSessionWithParameters;
 import static com.android.mediaframeworktest.helpers.CameraTestUtils.getSupportedVideoSizes;
 import static com.android.mediaframeworktest.helpers.CameraTestUtils.getValueNotNull;
 
@@ -872,7 +873,6 @@ public class Camera2RecordingTest extends Camera2SurfaceViewTestCase {
             outputSurfaces.add(mReaderSurface);
         }
         mSessionListener = new BlockingSessionCallback();
-        mSession = configureCameraSession(mCamera, outputSurfaces, mSessionListener, mHandler);
 
         CaptureRequest.Builder recordingRequestBuilder =
                 mCamera.createCaptureRequest(CameraDevice.TEMPLATE_RECORD);
@@ -885,7 +885,10 @@ public class Camera2RecordingTest extends Camera2SurfaceViewTestCase {
         }
         recordingRequestBuilder.addTarget(mRecordingSurface);
         recordingRequestBuilder.addTarget(mPreviewSurface);
-        mSession.setRepeatingRequest(recordingRequestBuilder.build(), listener, mHandler);
+        CaptureRequest recordingRequest = recordingRequestBuilder.build();
+        mSession = configureCameraSessionWithParameters(mCamera, outputSurfaces, mSessionListener,
+                mHandler, recordingRequest);
+        mSession.setRepeatingRequest(recordingRequest, listener, mHandler);
 
         if (useMediaRecorder) {
             mMediaRecorder.start();
diff --git a/packages/BackupRestoreConfirmation/res/values-pt-rBR/strings.xml b/packages/BackupRestoreConfirmation/res/values-pt-rBR/strings.xml
index baa4867ec43..d7c56b856e0 100644
--- a/packages/BackupRestoreConfirmation/res/values-pt-rBR/strings.xml
+++ b/packages/BackupRestoreConfirmation/res/values-pt-rBR/strings.xml
@@ -28,7 +28,7 @@
     <string name="device_encryption_restore_text" msgid="1570864916855208992">"Insira sua senha de criptografia do dispositivo abaixo."</string>
     <string name="device_encryption_backup_text" msgid="5866590762672844664">"Insira sua senha de criptografia do dispositivo abaixo. Ela tambm ser usada para criptografar o arquivo de backup."</string>
     <string name="backup_enc_password_text" msgid="4981585714795233099">"Digite uma senha para usar para criptografar os dados de backup por completo. Se isso for deixado em branco, sua senha atual de backup ser usada:"</string>
-    <string name="backup_enc_password_optional" msgid="1350137345907579306">"Se voc deseja criptografar os dados de backup por completo, digite uma senha abaixo:"</string>
+    <string name="backup_enc_password_optional" msgid="1350137345907579306">"Se voc quer criptografar os dados de backup por completo, digite uma senha abaixo:"</string>
     <string name="backup_enc_password_required" msgid="7889652203371654149">"Como seu dispositivo est criptografado,  necessrio criptografar seu backup. Insira uma senha abaixo:"</string>
     <string name="restore_enc_password_text" msgid="6140898525580710823">"Se os dados restaurados forem criptografada, digite a senha abaixo:"</string>
     <string name="toast_backup_started" msgid="550354281452756121">"Iniciando backup..."</string>
diff --git a/packages/BackupRestoreConfirmation/res/values-pt/strings.xml b/packages/BackupRestoreConfirmation/res/values-pt/strings.xml
index baa4867ec43..d7c56b856e0 100644
--- a/packages/BackupRestoreConfirmation/res/values-pt/strings.xml
+++ b/packages/BackupRestoreConfirmation/res/values-pt/strings.xml
@@ -28,7 +28,7 @@
     <string name="device_encryption_restore_text" msgid="1570864916855208992">"Insira sua senha de criptografia do dispositivo abaixo."</string>
     <string name="device_encryption_backup_text" msgid="5866590762672844664">"Insira sua senha de criptografia do dispositivo abaixo. Ela tambm ser usada para criptografar o arquivo de backup."</string>
     <string name="backup_enc_password_text" msgid="4981585714795233099">"Digite uma senha para usar para criptografar os dados de backup por completo. Se isso for deixado em branco, sua senha atual de backup ser usada:"</string>
-    <string name="backup_enc_password_optional" msgid="1350137345907579306">"Se voc deseja criptografar os dados de backup por completo, digite uma senha abaixo:"</string>
+    <string name="backup_enc_password_optional" msgid="1350137345907579306">"Se voc quer criptografar os dados de backup por completo, digite uma senha abaixo:"</string>
     <string name="backup_enc_password_required" msgid="7889652203371654149">"Como seu dispositivo est criptografado,  necessrio criptografar seu backup. Insira uma senha abaixo:"</string>
     <string name="restore_enc_password_text" msgid="6140898525580710823">"Se os dados restaurados forem criptografada, digite a senha abaixo:"</string>
     <string name="toast_backup_started" msgid="550354281452756121">"Iniciando backup..."</string>
diff --git a/packages/EasterEgg/Android.bp b/packages/EasterEgg/Android.bp
new file mode 100644
index 00000000000..43ed810b567
--- /dev/null
+++ b/packages/EasterEgg/Android.bp
@@ -0,0 +1,33 @@
+//
+// Copyright (C) 2018 The Android Open Source Project
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+//
+
+android_app {
+    // the build system in pi-dev can't quite handle R.java in kt
+    // so we will have a mix of java and kotlin files
+    srcs: ["src/**/*.java", "src/**/*.kt"],
+
+    resource_dirs: ["res"],
+
+    name: "EasterEgg",
+
+    certificate: "platform",
+
+	sdk_version: "current",
+
+    optimize: {
+        enabled: false,
+    }
+}
diff --git a/packages/EasterEgg/Android.mk b/packages/EasterEgg/Android.mk
deleted file mode 100644
index 605a75d1697..00000000000
--- a/packages/EasterEgg/Android.mk
+++ /dev/null
@@ -1,29 +0,0 @@
-LOCAL_PATH:= $(call my-dir)
-include $(CLEAR_VARS)
-
-LOCAL_MODULE_TAGS := optional
-
-LOCAL_STATIC_JAVA_LIBRARIES := \
-    jsr305
-
-LOCAL_STATIC_ANDROID_LIBRARIES := \
-    android-support-v4 \
-    android-support-v13 \
-    android-support-dynamic-animation \
-    android-support-v7-recyclerview \
-    android-support-v7-preference \
-    android-support-v7-appcompat \
-    android-support-v14-preference
-
-LOCAL_USE_AAPT2 := true
-
-LOCAL_SRC_FILES := $(call all-java-files-under, src)
-LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
-
-LOCAL_PACKAGE_NAME := EasterEgg
-LOCAL_PRIVATE_PLATFORM_APIS := true
-LOCAL_CERTIFICATE := platform
-
-include $(BUILD_PACKAGE)
-
-include $(call all-makefiles-under,$(LOCAL_PATH))
diff --git a/packages/EasterEgg/AndroidManifest.xml b/packages/EasterEgg/AndroidManifest.xml
index 172490dc917..6651d9a930f 100644
--- a/packages/EasterEgg/AndroidManifest.xml
+++ b/packages/EasterEgg/AndroidManifest.xml
@@ -1,8 +1,8 @@
 <?xml version="1.0" encoding="utf-8"?>
 <!--
-Copyright (C) 2016 The Android Open Source Project
+    Copyright (C) 2018 The Android Open Source Project
 
-   Licensed under the Apache License, Version 2.0 (the "License");
+    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
 
@@ -15,85 +15,28 @@ Copyright (C) 2016 The Android Open Source Project
     limitations under the License.
 -->
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
-          package="com.android.egg"
-          android:versionCode="1"
-          android:versionName="1.0">
+    package="com.android.egg"
+    android:versionCode="1"
+    android:versionName="1.0">
 
-    <uses-sdk android:minSdkVersion="26" />
+    <uses-sdk android:minSdkVersion="28" />
 
-    <uses-permission android:name="android.permission.SUBSTITUTE_NOTIFICATION_APP_NAME" />
-    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
+    <application
+        android:icon="@drawable/icon"
+        android:label="@string/app_name">
 
-    <application android:label="@string/app_name" android:icon="@drawable/icon">
-
-        <activity android:name=".octo.Ocquarium"
-            android:theme="@android:style/Theme.DeviceDefault.NoActionBar.Fullscreen"
-            android:label="@string/app_name">
-            <intent-filter>
-                <action android:name="android.intent.action.MAIN"/>
-                <category android:name="android.intent.category.DEFAULT" />
-                <category android:name="com.android.internal.category.PLATLOGO" />
-            </intent-filter>
-        </activity>
-
-        <!-- Android N lives on inside Android O... -->
-
-        <!-- Long press the QS tile to get here -->
-        <activity android:name=".neko.NekoLand"
-                  android:theme="@android:style/Theme.Material.NoActionBar"
-                  android:label="@string/app_name">
+        <activity
+            android:name=".paint.PaintActivity"
+            android:configChanges="orientation|keyboardHidden|screenSize|uiMode"
+            android:label="@string/app_name"
+            android:theme="@style/AppTheme">
             <intent-filter>
-                <action android:name="android.service.quicksettings.action.QS_TILE_PREFERENCES" />
                 <action android:name="android.intent.action.MAIN" />
-            </intent-filter>
-        </activity>
-
-        <!-- This is where the magic happens -->
-        <service
-            android:name=".neko.NekoService"
-            android:enabled="true"
-            android:permission="android.permission.BIND_JOB_SERVICE"
-            android:exported="true" >
-        </service>
-
-        <!-- Used to show over lock screen -->
-        <activity android:name=".neko.NekoLockedActivity"
-                  android:excludeFromRecents="true"
-                  android:theme="@android:style/Theme.Material.Light.Dialog.NoActionBar"
-                  android:showOnLockScreen="true" />
-
-        <!-- Used to enable easter egg -->
-        <activity android:name=".neko.NekoActivationActivity"
-            android:excludeFromRecents="true"
-            android:theme="@android:style/Theme.NoDisplay"
-            >
-            <intent-filter>
-                <action android:name="android.intent.action.MAIN"/>
                 <category android:name="android.intent.category.DEFAULT" />
+                <!--<category android:name="android.intent.category.LAUNCHER" />-->
+                <category android:name="com.android.internal.category.PLATLOGO" />
             </intent-filter>
         </activity>
-
-        <!-- The quick settings tile, disabled by default -->
-        <service
-            android:name=".neko.NekoTile"
-            android:permission="android.permission.BIND_QUICK_SETTINGS_TILE"
-            android:icon="@drawable/stat_icon"
-            android:enabled="false"
-            android:label="@string/default_tile_name">
-            <intent-filter>
-                <action android:name="android.service.quicksettings.action.QS_TILE" />
-            </intent-filter>
-        </service>
-
-        <!-- FileProvider for sending pictures -->
-        <provider
-                android:name="android.support.v4.content.FileProvider"
-                android:authorities="com.android.egg.fileprovider"
-                android:grantUriPermissions="true"
-                android:exported="false">
-            <meta-data
-                    android:name="android.support.FILE_PROVIDER_PATHS"
-                    android:resource="@xml/filepaths" />
-        </provider>
     </application>
-</manifest>
+
+</manifest>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/drawable/leg1.xml b/packages/EasterEgg/res/color-night/toolbar_icon_color.xml
similarity index 54%
rename from packages/EasterEgg/res/drawable/leg1.xml
rename to packages/EasterEgg/res/color-night/toolbar_icon_color.xml
index d72c746b623..c0a81520f84 100644
--- a/packages/EasterEgg/res/drawable/leg1.xml
+++ b/packages/EasterEgg/res/color-night/toolbar_icon_color.xml
@@ -1,7 +1,8 @@
+<?xml version="1.0" encoding="utf-8"?>
 <!--
-Copyright (C) 2016 The Android Open Source Project
+    Copyright (C) 2018 The Android Open Source Project
 
-   Licensed under the Apache License, Version 2.0 (the "License");
+    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
 
@@ -13,10 +14,7 @@ Copyright (C) 2016 The Android Open Source Project
     See the License for the specific language governing permissions and
     limitations under the License.
 -->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="leg1" android:fillColor="#FF000000" android:pathData="M9,37h5v6h-5z"/>
-</vector>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+    <item android:color="#FFFF3333" android:state_selected="true" />
+    <item android:color="#FFFFFFFF" />
+</selector>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/values/dimens.xml b/packages/EasterEgg/res/color/toolbar_icon_color.xml
similarity index 71%
rename from packages/EasterEgg/res/values/dimens.xml
rename to packages/EasterEgg/res/color/toolbar_icon_color.xml
index e9dcebd27f7..d3247e406a9 100644
--- a/packages/EasterEgg/res/values/dimens.xml
+++ b/packages/EasterEgg/res/color/toolbar_icon_color.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <!--
-Copyright (C) 2016 The Android Open Source Project
+Copyright (C) 2018 The Android Open Source Project
 
    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
@@ -14,6 +14,7 @@ Copyright (C) 2016 The Android Open Source Project
     See the License for the specific language governing permissions and
     limitations under the License.
 -->
-<resources xmlns:android="http://schemas.android.com/apk/res/android">
-    <dimen name="neko_display_size">64dp</dimen>
-</resources>
+<selector xmlns:android="http://schemas.android.com/apk/res/android">
+    <item android:color="#FFCC0000" android:state_selected="true" />
+    <item android:color="#FF000000" />
+</selector>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/drawable/back.xml b/packages/EasterEgg/res/drawable/back.xml
deleted file mode 100644
index b55d65cdf76..00000000000
--- a/packages/EasterEgg/res/drawable/back.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="back" android:fillColor="#FF000000" android:pathData="M37.1,22c-1.1,0 -1.9,0.8 -1.9,1.9v5.6c0,1.1 0.8,1.9 1.9,1.9H39v-1.9v-5.6V22H37.1z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/belly.xml b/packages/EasterEgg/res/drawable/belly.xml
deleted file mode 100644
index 8b0e9afac46..00000000000
--- a/packages/EasterEgg/res/drawable/belly.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="belly" android:fillColor="#FF000000" android:pathData="M20.5,25c-3.6,0 -6.5,2.9 -6.5,6.5V38h13v-6.5C27,27.9 24.1,25 20.5,25z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/cap.xml b/packages/EasterEgg/res/drawable/cap.xml
deleted file mode 100644
index d8b4cc58a26..00000000000
--- a/packages/EasterEgg/res/drawable/cap.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="cap" android:fillColor="#FF000000" android:pathData="M27.2,3.8c-1,-0.2 -2.1,-0.3 -3.2,-0.3s-2.1,0.1 -3.2,0.3c0.2,1.3 1.5,2.2 3.2,2.2C25.6,6.1 26.9,5.1 27.2,3.8z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/collar.xml b/packages/EasterEgg/res/drawable/collar.xml
deleted file mode 100644
index 5e4d0fd4f88..00000000000
--- a/packages/EasterEgg/res/drawable/collar.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="collar" android:fillColor="#FF000000" android:pathData="M9,18.4h30v1.7h-30z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/face_spot.xml b/packages/EasterEgg/res/drawable/face_spot.xml
deleted file mode 100644
index a89fb4fdaad..00000000000
--- a/packages/EasterEgg/res/drawable/face_spot.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="face_spot" android:fillColor="#FF000000" android:pathData="M19.5,15.2a4.5,3.2 0,1 0,9 0a4.5,3.2 0,1 0,-9 0z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/food_bits.xml b/packages/EasterEgg/res/drawable/food_bits.xml
deleted file mode 100644
index 1b2bb6f3694..00000000000
--- a/packages/EasterEgg/res/drawable/food_bits.xml
+++ /dev/null
@@ -1,33 +0,0 @@
-<!--
-Copyright (C) 2015 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M19.1,34l-3.5,1.3c-1,0.4,-2.2,-0.1,-2.6,-1.1l-1.2,-3c-0.4,-1,0.1,-2.2,1.1,-2.6l3.5,-1.3c1,-0.4,2.2,0.1,2.6,1.1l1.2,3   C20.6,32.4,20.1,33.6,19.1,34z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M25.2,28.1L22.9,28c-0.8,0,-1.5,-0.7,-1.4,-1.6l0.1,-2c0,-0.8,0.7,-1.5,1.6,-1.4l2.4,0.1c0.8,0,1.5,0.7,1.4,1.6l-0.1,2   C26.8,27.5,26.1,28.1,25.2,28.1z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M18.7,23.1L16.5,23c-0.5,0,-0.9,-0.4,-0.8,-0.9l0.1,-2.2c0,-0.5,0.4,-0.9,0.9,-0.8l2.2,0.1c0.5,0,0.9,0.4,0.8,0.9   l-0.1,2.2C19.6,22.8,19.2,23.1,18.7,23.1z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M32.2,35.3l-3.6,-1.8c-1,-0.5,-1.4,-1.7,-0.9,-2.7l1.6,-3.1c0.5,-1,1.7,-1.4,2.7,-0.9l3.6,1.8c1,0.5,1.4,1.7,0.9,2.7   l-1.6,3.1C34.4,35.4,33.2,35.7,32.2,35.3z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/food_chicken.xml b/packages/EasterEgg/res/drawable/food_chicken.xml
deleted file mode 100644
index 95b2fb55b79..00000000000
--- a/packages/EasterEgg/res/drawable/food_chicken.xml
+++ /dev/null
@@ -1,39 +0,0 @@
-<!--
-Copyright (C) 2015 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M9,12v14h10V11H9z M11.7,16.3c-0.7,0,-1.3,-0.6,-1.3,-1.3s0.6,-1.3,1.3,-1.3S13,14.3,13,15S12.4,16.3,11.7,16.3z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M5.7,20.1l1.6,-3.0l-1.6,-3.0l4.4,3.0z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M19.0,6.0l-2.3,2.3l-2.7,-2.6l-2.7,2.6l-2.3,-2.3l0.0,4.0l10.0,0.0z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M9,25c0,8.3,6.7,15,15,15s15,-6.7,15,-15H9z M29.9,31.5h-11v-1h12L29.9,31.5z M31.9,29.5h-13v-1h14L31.9,29.5z M33.9,27.5   h-15v-1h16L33.9,27.5z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M27.0,38.6h2.0v6.0h-2.0z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M17.4,44.6l-2.1999998,0.0l4.4000006,-6.0l2.1999989,0.0z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/food_cookie.xml b/packages/EasterEgg/res/drawable/food_cookie.xml
deleted file mode 100644
index 74dd134355e..00000000000
--- a/packages/EasterEgg/res/drawable/food_cookie.xml
+++ /dev/null
@@ -1,35 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
-Copyright (C) 2017 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-    android:width="24dp"
-    android:height="24dp"
-    android:viewportWidth="24"
-    android:viewportHeight="24">
-    <group>
-        <path
-            android:fillColor="#55FFFFFF"
-            android:fillType="evenOdd"
-            android:pathData="M5.71 18.29A8.99 8.99 0 0 0 22 13c0-3-1.46-5.65-3.71-7.29A8.99 8.99 0 0 0 2 11c0 3 1.46 5.65 3.71 7.29z"/>
-        <path
-            android:fillColor="#FFFFFFFF"
-            android:fillType="evenOdd"
-            android:pathData="M7.25 19.18A8.5 8.5 0 0 0 19.19 7.24 9 9 0 0 1 7.24 19.19z"/>
-        <path
-            android:fillColor="#55FFFFFF"
-            android:pathData="M10.5 3a0.5 0.5 0 1 1 1 0v2.05a0.5 0.5 0 1 1-1 0V3zm3.1 0.42a0.5 0.5 0 0 1 0.93 0.39l-0.8 1.88A0.5 0.5 0 1 1 12.8 5.3l0.8-1.88zm2.7 1.57a0.5 0.5 0 1 1 0.71 0.7l-1.45 1.46a0.5 0.5 0 0 1-0.7-0.71l1.44-1.45zm1.9 2.5a0.5 0.5 0 0 1 0.38 0.92l-1.9 0.77a0.5 0.5 0 0 1-0.37-0.93l1.9-0.77zM19 10.5a0.5 0.5 0 1 1 0 1h-2.05a0.5 0.5 0 0 1 0-1H19zm-0.42 3.1a0.5 0.5 0 0 1-0.39 0.93l-1.88-0.8a0.5 0.5 0 1 1 0.39-0.92l1.88 0.8zm-1.57 2.7a0.5 0.5 0 1 1-0.7 0.71l-1.46-1.45a0.5 0.5 0 0 1 0.71-0.7l1.45 1.44zm-2.5 1.9a0.5 0.5 0 1 1-0.92 0.38l-0.77-1.9a0.5 0.5 0 0 1 0.93-0.37l0.77 1.9zM11.5 19a0.5 0.5 0 1 1-1 0v-2.05a0.5 0.5 0 0 1 1 0V19zm-3.1-0.42a0.5 0.5 0 0 1-0.93-0.39l0.8-1.88A0.5 0.5 0 0 1 9.2 16.7l-0.8 1.88zm-2.7-1.57a0.5 0.5 0 1 1-0.71-0.7l1.45-1.46a0.5 0.5 0 0 1 0.7 0.71L5.7 17.01zm-1.9-2.48a0.5 0.5 0 0 1-0.38-0.92l1.88-0.8a0.5 0.5 0 0 1 0.4 0.92l-1.9 0.8zM3 11.5a0.5 0.5 0 1 1 0-1h2.05a0.5 0.5 0 1 1 0 1H3zm0.42-3.1A0.5 0.5 0 0 1 3.8 7.46l1.88 0.8A0.5 0.5 0 1 1 5.3 9.2L3.42 8.4zm1.57-2.7a0.5 0.5 0 1 1 0.7-0.71l1.46 1.45a0.5 0.5 0 0 1-0.71 0.7L4.99 5.7zm2.5-1.9A0.5 0.5 0 0 1 8.4 3.41l0.77 1.9a0.5 0.5 0 0 1-0.93 0.37L7.48 3.8z"/>
-    </group>
-</vector>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/drawable/food_dish.xml b/packages/EasterEgg/res/drawable/food_dish.xml
deleted file mode 100644
index 3fff6a90fad..00000000000
--- a/packages/EasterEgg/res/drawable/food_dish.xml
+++ /dev/null
@@ -1,24 +0,0 @@
-<!--
-Copyright (C) 2015 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M24,13.8C11.3,13.8,1,18.3,1,24c0,5.7,10.3,10.2,23,10.2S47,29.7,47,24C47,18.3,36.7,13.8,24,13.8z M33.7,26.6   c1.1,-0.6,1.8,-1.3,1.8,-2c0,-2.1,-5.2,-3.8,-11.7,-3.8s-11.7,1.7,-11.7,3.8c0,0.6,0.4,1.2,1.2,1.7c-1.7,-0.8,-2.8,-1.7,-2.8,-2.8   c0,-2.5,6,-4.5,13.4,-4.5s13.4,2,13.4,4.5C37.4,24.7,36,25.8,33.7,26.6z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/food_donut.xml b/packages/EasterEgg/res/drawable/food_donut.xml
deleted file mode 100644
index eaf831ea560..00000000000
--- a/packages/EasterEgg/res/drawable/food_donut.xml
+++ /dev/null
@@ -1,24 +0,0 @@
-<!--
-Copyright (C) 2015 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M24,4.5c-10.5,0,-19,8.5,-19,19s8.5,19,19,19s19,-8.5,19,-19S34.5,4.5,24,4.5z M35.2,15.5l1.6,-1.1   c0.3,-0.2,0.6,-0.1,0.8,0.1l0.1,0.1c0.2,0.3,0.1,0.6,-0.1,0.8l-1.6,1.1c-0.3,0.2,-0.6,0.1,-0.8,-0.1l-0.1,-0.1   C34.9,16.1,35,15.7,35.2,15.5z M32.7,10.7c0,-0.3,0.3,-0.5,0.6,-0.5l0.1,0c0.3,0,0.5,0.3,0.5,0.6l-0.2,2c0,0.3,-0.3,0.5,-0.6,0.5l-0.1,0   c-0.3,0,-0.5,-0.3,-0.5,-0.6L32.7,10.7z M31.7,15.1l1.5,-0.2c0.2,0,0.5,0.1,0.5,0.4l0,0.1c0,0.2,-0.1,0.5,-0.4,0.5l-1.5,0.2   c-0.2,0,-0.5,-0.1,-0.5,-0.4l0,-0.1C31.3,15.4,31.5,15.2,31.7,15.1z M28.8,10.6l1.6,-1.1c0.3,-0.2,0.6,-0.1,0.8,0.1l0.1,0.1   c0.2,0.3,0.1,0.6,-0.1,0.8l-1.6,1.1c-0.3,0.2,-0.6,0.1,-0.8,-0.1l-0.1,-0.1C28.4,11.1,28.5,10.8,28.8,10.6z M25.8,6   c0,-0.3,0.3,-0.5,0.6,-0.5l0.1,0c0.3,0,0.5,0.3,0.5,0.6l-0.2,2c0,0.3,-0.3,0.5,-0.6,0.5l-0.1,0c-0.3,0,-0.5,-0.3,-0.5,-0.6L25.8,6z    M20.7,6.5l1.9,-0.7c0.3,-0.1,0.6,0,0.7,0.3l0,0.1c0.1,0.3,0,0.6,-0.3,0.7l-1.9,0.7c-0.3,0.1,-0.6,0,-0.7,-0.3l0,-0.1   C20.3,6.9,20.4,6.6,20.7,6.5z M19.9,10.9l1.5,-0.2c0.2,0,0.5,0.1,0.5,0.4l0,0.1c0,0.2,-0.1,0.5,-0.4,0.5l-1.5,0.2   c-0.2,0,-0.5,-0.1,-0.5,-0.4l0,-0.1C19.5,11.1,19.7,10.9,19.9,10.9z M16,10.9L16,10.9c0.2,-0.3,0.4,-0.4,0.6,-0.3l1.3,0.7   c0.2,0.1,0.3,0.4,0.2,0.6L18,12c-0.1,0.2,-0.4,0.3,-0.6,0.2l-1.3,-0.7C15.9,11.4,15.8,11.1,16,10.9z M15.8,18.5c0.2,0,0.4,0.1,0.5,0.4   l0,0.1c0,0.2,-0.1,0.4,-0.4,0.5l-1.5,0.2c-0.2,0,-0.4,-0.1,-0.5,-0.4l0,-0.1c0,-0.2,0.1,-0.4,0.4,-0.5L15.8,18.5z M14,21.8l-1.6,1.1   c-0.3,0.2,-0.6,0.1,-0.8,-0.1l-0.1,-0.1c-0.2,-0.3,-0.1,-0.6,0.1,-0.8l1.6,-1.1c0.3,-0.2,0.6,-0.1,0.8,0.1l0.1,0.1   C14.3,21.3,14.3,21.6,14,21.8z M12.4,12L12.4,12c0.3,-0.2,0.5,-0.2,0.7,-0.1l1,1.1c0.2,0.2,0.2,0.4,0,0.6L14,13.7   c-0.2,0.2,-0.4,0.2,-0.6,0l-1,-1.1C12.2,12.4,12.2,12.1,12.4,12z M8.3,24.5c0,0.3,-0.3,0.5,-0.6,0.5l-0.1,0c-0.3,0,-0.5,-0.3,-0.5,-0.6   l0.2,-2c0,-0.3,0.3,-0.5,0.6,-0.5l0.1,0c0.3,0,0.5,0.3,0.5,0.6L8.3,24.5z M8.5,16.2v-0.1c0,-0.3,0.2,-0.6,0.6,-0.6h2   c0.3,0,0.6,0.2,0.6,0.6v0.1c0,0.3,-0.2,0.6,-0.6,0.6H9C8.7,16.7,8.5,16.5,8.5,16.2z M10.3,20.7c-0.3,0.2,-0.6,0.1,-0.8,-0.1l-0.1,-0.1   c-0.2,-0.3,-0.1,-0.6,0.1,-0.8l1.6,-1.1c0.3,-0.2,0.6,-0.1,0.8,0.1l0.1,0.1c0.2,0.3,0.1,0.6,-0.1,0.8L10.3,20.7z M11.3,28.3l0,-0.1   c-0.1,-0.3,0,-0.6,0.3,-0.7l1.9,-0.7c0.3,-0.1,0.6,0,0.7,0.3l0,0.1c0.1,0.3,0,0.6,-0.3,0.7L12,28.6C11.7,28.7,11.4,28.6,11.3,28.3z    M14.4,33c0,0.2,-0.2,0.4,-0.4,0.4h-1.5c-0.2,0,-0.4,-0.2,-0.4,-0.4v-0.1c0,-0.2,0.2,-0.4,0.4,-0.4H14c0.2,0,0.4,0.2,0.4,0.4V33z M17.9,35.2   l-1.6,1.1c-0.3,0.2,-0.6,0.1,-0.8,-0.1l-0.1,-0.1c-0.2,-0.3,-0.1,-0.6,0.1,-0.8l1.6,-1.1c0.3,-0.2,0.6,-0.1,0.8,0.1l0.1,0.1   C18.2,34.7,18.2,35.1,17.9,35.2z M20.7,33.8l-0.1,0.1c-0.1,0.3,-0.5,0.4,-0.8,0.2l-1.7,-1c-0.3,-0.1,-0.4,-0.5,-0.2,-0.8l0.1,-0.1   c0.1,-0.3,0.5,-0.4,0.8,-0.2l1.7,1C20.7,33.2,20.8,33.5,20.7,33.8z M17.5,23.5c0,-3.6,2.9,-6.5,6.5,-6.5s6.5,2.9,6.5,6.5   c0,3.6,-2.9,6.5,-6.5,6.5S17.5,27.1,17.5,23.5z M27.4,35.7l-1.9,0.7c-0.3,0.1,-0.6,0,-0.7,-0.3l0,-0.1c-0.1,-0.3,0,-0.6,0.3,-0.7l1.9,-0.7   c0.3,-0.1,0.6,0,0.7,0.3l0,0.1C27.9,35.3,27.7,35.6,27.4,35.7z M29.7,32.7l-1.4,0.5c-0.2,0.1,-0.5,0,-0.5,-0.3l0,-0.1   c-0.1,-0.2,0,-0.5,0.3,-0.5l1.4,-0.5c0.2,-0.1,0.5,0,0.5,0.3l0,0.1C30,32.3,29.9,32.6,29.7,32.7z M32.8,35.5l-0.1,0.1   c-0.1,0.3,-0.5,0.4,-0.8,0.2l-1.7,-1c-0.3,-0.1,-0.4,-0.5,-0.2,-0.8l0.1,-0.1c0.1,-0.3,0.5,-0.4,0.8,-0.2l1.7,1C32.8,34.9,32.9,35.2,32.8,35.5z    M33.7,30.9c0,0.2,-0.2,0.4,-0.5,0.4l-0.1,0c-0.2,0,-0.4,-0.2,-0.4,-0.5l0.1,-1.5c0,-0.2,0.2,-0.4,0.5,-0.4l0.1,0c0.2,0,0.4,0.2,0.4,0.5   L33.7,30.9z M34.5,26.5l-1.3,0.9c-0.2,0.1,-0.5,0.1,-0.6,-0.1l-0.1,-0.1c-0.1,-0.2,-0.1,-0.5,0.1,-0.6l1.3,-0.9c0.2,-0.1,0.5,-0.1,0.6,0.1   l0.1,0.1C34.8,26.1,34.7,26.3,34.5,26.5z M35.6,20.6l-1.7,-1c-0.3,-0.1,-0.4,-0.5,-0.2,-0.8l0.1,-0.1c0.1,-0.3,0.5,-0.4,0.8,-0.2l1.7,1   c0.3,0.1,0.4,0.5,0.2,0.8l-0.1,0.1C36.2,20.6,35.8,20.7,35.6,20.6z M38.6,27.1l-1.6,1.1c-0.3,0.2,-0.6,0.1,-0.8,-0.1L36.1,28   c-0.2,-0.3,-0.1,-0.6,0.1,-0.8l1.6,-1.1c0.3,-0.2,0.6,-0.1,0.8,0.1l0.1,0.1C38.9,26.6,38.8,27,38.6,27.1z M39,19.4l-1.5,0.2   c-0.2,0,-0.5,-0.1,-0.5,-0.4l0,-0.1c0,-0.2,0.1,-0.5,0.4,-0.5l1.5,-0.2c0.2,0,0.5,0.1,0.5,0.4l0,0.1C39.4,19.1,39.2,19.3,39,19.4z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/food_sysuituna.xml b/packages/EasterEgg/res/drawable/food_sysuituna.xml
deleted file mode 100644
index 28cf4a2c768..00000000000
--- a/packages/EasterEgg/res/drawable/food_sysuituna.xml
+++ /dev/null
@@ -1,24 +0,0 @@
-<!--
-Copyright (C) 2015 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M46,18.4l-5.8,4.6c-3.9,-3.2,-8.9,-5.6,-14.6,-6.3l1.2,-6l-7.3,5.9C12.5,17.2,6.4,20,2,24.3l7.2,1.4L2,27   c4.3,4.2,10.4,7.1,17.3,7.6l3.1,2.5L22,34.8c7.1,0,13.5,-2.5,18.2,-6.5l5.8,4.6l-1.4,-7.2L46,18.4z M14.3,24.8l-0.6,0.6l-1.1,-1.1   l-1.1,1.1l-0.6,-0.6l1.1,-1.1l-1.1,-1.1l0.6,-0.6l1.1,1.1l1.1,-1.1l0.6,0.6l-1.1,1.1L14.3,24.8z M18.8,29.1c0.7,-0.8,1.1,-2.2,1.1,-3.8   c0,-1.6,-0.4,-3,-1.1,-3.8c1.1,0.5,1.9,2,1.9,3.8S19.9,28.5,18.8,29.1z M20.7,29.1c0.7,-0.8,1.1,-2.2,1.1,-3.8c0,-1.6,-0.4,-3,-1.1,-3.8   c1.1,0.5,1.9,2,1.9,3.8S21.8,28.5,20.7,29.1z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/foot1.xml b/packages/EasterEgg/res/drawable/foot1.xml
deleted file mode 100644
index 0d9085998a1..00000000000
--- a/packages/EasterEgg/res/drawable/foot1.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="foot1" android:fillColor="#FF000000" android:pathData="M11.5,43m-2.5,0a2.5,2.5 0,1 1,5 0a2.5,2.5 0,1 1,-5 0"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/foot2.xml b/packages/EasterEgg/res/drawable/foot2.xml
deleted file mode 100644
index 364ba0cd861..00000000000
--- a/packages/EasterEgg/res/drawable/foot2.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="foot2" android:fillColor="#FF000000" android:pathData="M18.5,43m-2.5,0a2.5,2.5 0,1 1,5 0a2.5,2.5 0,1 1,-5 0"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/foot3.xml b/packages/EasterEgg/res/drawable/foot3.xml
deleted file mode 100644
index e3a512a2568..00000000000
--- a/packages/EasterEgg/res/drawable/foot3.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="foot3" android:fillColor="#FF000000" android:pathData="M29.5,43m-2.5,0a2.5,2.5 0,1 1,5 0a2.5,2.5 0,1 1,-5 0"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/foot4.xml b/packages/EasterEgg/res/drawable/foot4.xml
deleted file mode 100644
index 66b78fa2664..00000000000
--- a/packages/EasterEgg/res/drawable/foot4.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="foot4" android:fillColor="#FF000000" android:pathData="M36.5,43m-2.5,0a2.5,2.5 0,1 1,5 0a2.5,2.5 0,1 1,-5 0"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/head.xml b/packages/EasterEgg/res/drawable/head.xml
deleted file mode 100644
index df600a8613c..00000000000
--- a/packages/EasterEgg/res/drawable/head.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="head" android:fillColor="#FF000000" android:pathData="M9,18.5c0,-8.3 6.8,-15 15,-15s15,6.7 15,15H9z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/bowtie.xml b/packages/EasterEgg/res/drawable/ic_clear.xml
similarity index 58%
rename from packages/EasterEgg/res/drawable/bowtie.xml
rename to packages/EasterEgg/res/drawable/ic_clear.xml
index 33fa9216712..489dcd20759 100644
--- a/packages/EasterEgg/res/drawable/bowtie.xml
+++ b/packages/EasterEgg/res/drawable/ic_clear.xml
@@ -1,5 +1,5 @@
 <!--
-Copyright (C) 2016 The Android Open Source Project
+Copyright (C) 2018 The Android Open Source Project
 
    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
@@ -14,9 +14,14 @@ Copyright (C) 2016 The Android Open Source Project
     limitations under the License.
 -->
 <vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="bowtie" android:fillColor="#FF000000" android:pathData="M29,16.8l-10,5l0,-5l10,5z"/>
+    android:width="24dp"
+    android:height="24dp"
+    android:viewportWidth="24"
+    android:viewportHeight="24">
+  <path
+      android:pathData="M19,6.41l-1.41,-1.41l-5.59,5.59l-5.59,-5.59l-1.41,1.41l5.59,5.59l-5.59,5.59l1.41,1.41l5.59,-5.59l5.59,5.59l1.41,-1.41l-5.59,-5.59z"
+      android:strokeWidth="1"
+      android:fillColor="#000000"
+      android:fillType="nonZero"
+      android:strokeColor="#00000000"/>
 </vector>
diff --git a/packages/EasterEgg/res/drawable/ic_dropper.xml b/packages/EasterEgg/res/drawable/ic_dropper.xml
new file mode 100644
index 00000000000..230730921b9
--- /dev/null
+++ b/packages/EasterEgg/res/drawable/ic_dropper.xml
@@ -0,0 +1,39 @@
+<!--
+Copyright (C) 2018 The Android Open Source Project
+
+   Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<vector xmlns:android="http://schemas.android.com/apk/res/android"
+    android:width="24dp"
+    android:height="24dp"
+    android:viewportWidth="24"
+    android:viewportHeight="24">
+  <path
+      android:pathData="M13.6789,5.6997L3,16.3784L3,20L4,21L7.6216,21L18.3004,10.3212L13.6789,5.6997ZM7,19L5,19L5,17L13.788,8.344L15.6561,10.212L7,19Z"
+      android:strokeWidth="1"
+      android:fillColor="#000000"
+      android:fillType="nonZero"
+      android:strokeColor="#00000000"/>
+  <path
+      android:pathData="M20.9983,2.4982L21.5018,3.0017C22.0876,3.5875 22.0876,4.5373 21.5018,5.1231L18.1231,8.5018C17.5373,9.0876 16.5875,9.0876 16.0017,8.5018L15.4982,7.9983C14.9124,7.4125 14.9124,6.4627 15.4982,5.8769L18.8769,2.4982C19.4627,1.9124 20.4125,1.9124 20.9983,2.4982Z"
+      android:strokeWidth="1"
+      android:fillColor="#000000"
+      android:fillType="evenOdd"
+      android:strokeColor="#00000000"/>
+  <path
+      android:pathData="M13.8284,3l7.0711,7.0711l-2.8284,2.8284l-7.0711,-7.0711z"
+      android:strokeWidth="1"
+      android:fillColor="#000000"
+      android:fillType="evenOdd"
+      android:strokeColor="#00000000"/>
+</vector>
diff --git a/packages/EasterEgg/res/drawable/ic_hourglass.xml b/packages/EasterEgg/res/drawable/ic_hourglass.xml
new file mode 100644
index 00000000000..fe4b9c47e54
--- /dev/null
+++ b/packages/EasterEgg/res/drawable/ic_hourglass.xml
@@ -0,0 +1,27 @@
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<vector xmlns:android="http://schemas.android.com/apk/res/android"
+    android:width="24dp"
+    android:height="24dp"
+    android:viewportWidth="24"
+    android:viewportHeight="24">
+  <path
+      android:pathData="M12.5,11L16,7.5L16,4L8,4L8,7.5L11.5,11L11.5,13L8,16.5L8,20L16,20L16,16.5L12.5,13L12.5,11ZM6,2L18,2L18,8L17.99,8L18,8.01L14,12L18,16L17.99,16.01L18,16.01L18,22L6,22L6,16.01L6.01,16.01L6,16L10,12L6,8.01L6.01,8L6,8L6,2Z"
+      android:strokeWidth="1"
+      android:fillColor="#000000"
+      android:fillType="nonZero"
+      android:strokeColor="#00000000"/>
+</vector>
diff --git a/packages/EasterEgg/res/drawable/ic_share.xml b/packages/EasterEgg/res/drawable/ic_share.xml
deleted file mode 100644
index 8cebc7ed46d..00000000000
--- a/packages/EasterEgg/res/drawable/ic_share.xml
+++ /dev/null
@@ -1,24 +0,0 @@
-<!--
-    Copyright (C) 2016 The Android Open Source Project
-
-    Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="24.0dp"
-        android:height="24.0dp"
-        android:viewportWidth="24.0"
-        android:viewportHeight="24.0">
-    <path
-        android:fillColor="#FFFFFFFF"
-        android:pathData="M18.0,16.08c-0.76,0.0 -1.4,0.3 -1.9,0.77L8.91,12.7c0.05,-0.2 0.09,-0.4 0.09,-0.7s-0.04,-0.47 -0.09,-0.7l7.05,-4.11c0.5,0.5 1.2,0.81 2.0,0.81 1.66,0.0 3.0,-1.34 3.0,-3.0s-1.34,-3.0 -3.0,-3.0 -3.0,1.34 -3.0,3.0c0.0,0.2 0.0,0.4 0.0,0.7L8.04,9.81C7.5,9.31 6.79,9.0 6.0,9.0c-1.66,0.0 -3.0,1.34 -3.0,3.0s1.34,3.0 3.0,3.0c0.79,0.0 1.5,-0.31 2.04,-0.81l7.12,4.16c0.0,0.21 0.0,0.43 0.0,0.65 0.0,1.61 1.31,2.92 2.92,2.92 1.61,0.0 2.92,-1.31 2.92,-2.92s-1.31,-2.92 -2.92,-2.92z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/icon.xml b/packages/EasterEgg/res/drawable/icon.xml
index 5ce9e513384..2306b7b554c 100644
--- a/packages/EasterEgg/res/drawable/icon.xml
+++ b/packages/EasterEgg/res/drawable/icon.xml
@@ -1,7 +1,7 @@
 <!--
-Copyright (C) 2017 The Android Open Source Project
+    Copyright (C) 2018 The Android Open Source Project
 
-   Licensed under the Apache License, Version 2.0 (the "License");
+    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
 
@@ -13,28 +13,7 @@ Copyright (C) 2017 The Android Open Source Project
     See the License for the specific language governing permissions and
     limitations under the License.
 -->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path
-        android:pathData="M25.0,25.0m-20.5,0.0a20.5,20.5,0,1,1,41.0,0.0a20.5,20.5,0,1,1,-41.0,0.0"
-        android:fillAlpha="0.066"
-        android:fillColor="#000000"/>
-    <path
-        android:pathData="M24.0,24.0m-20.0,0.0a20.0,20.0,0,1,1,40.0,0.0a20.0,20.0,0,1,1,-40.0,0.0"
-        android:fillColor="#283593"/>
-    <path
-        android:pathData="M44,24.2010101 L33.9004889,14.101499 L14.101499,33.9004889 L24.2010101,44 C29.2525804,43.9497929 34.2887564,41.9975027 38.1431296,38.1431296 C41.9975027,34.2887564 43.9497929,29.2525804 44,24.2010101 Z"
-        android:fillColor="#1a237e"/>
-    <path
-        android:pathData="M24.0,24.0m-14.0,0.0a14.0,14.0,0,1,1,28.0,0.0a14.0,14.0,0,1,1,-28.0,0.0"
-        android:fillColor="#5c6bc0"/>
-    <path
-        android:pathData="M37.7829445,26.469236 L29.6578482,18.3441397 L18.3441397,29.6578482 L26.469236,37.7829445 C29.1911841,37.2979273 31.7972024,36.0037754 33.9004889,33.9004889 C36.0037754,31.7972024 37.2979273,29.1911841 37.7829445,26.469236 Z"
-        android:fillColor="#3f51b5"/>
-    <path
-        android:pathData="M24.0,24.0m-8.0,0.0a8.0,8.0,0,1,1,16.0,0.0a8.0,8.0,0,1,1,-16.0,0.0"
-        android:fillColor="#FFFFFF"/>
-</vector>
+<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
+    <background android:drawable="@drawable/icon_bg"/>
+    <foreground android:drawable="@drawable/p"/>
+</adaptive-icon>
diff --git a/packages/EasterEgg/res/xml/filepaths.xml b/packages/EasterEgg/res/drawable/icon_bg.xml
similarity index 71%
rename from packages/EasterEgg/res/xml/filepaths.xml
rename to packages/EasterEgg/res/drawable/icon_bg.xml
index 2130025e926..c1553ce5094 100644
--- a/packages/EasterEgg/res/xml/filepaths.xml
+++ b/packages/EasterEgg/res/drawable/icon_bg.xml
@@ -1,8 +1,8 @@
 <?xml version="1.0" encoding="utf-8"?>
 <!--
-Copyright (C) 2017 The Android Open Source Project
+    Copyright (C) 2018 The Android Open Source Project
 
-   Licensed under the Apache License, Version 2.0 (the "License");
+    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
 
@@ -14,6 +14,5 @@ Copyright (C) 2017 The Android Open Source Project
     See the License for the specific language governing permissions and
     limitations under the License.
 -->
-<paths>
-    <external-path name="cats" path="Pictures/Cats" />
-</paths>
\ No newline at end of file
+<color xmlns:android="http://schemas.android.com/apk/res/android"
+    android:color="#C5E1A5" />
\ No newline at end of file
diff --git a/packages/EasterEgg/res/drawable/left_ear.xml b/packages/EasterEgg/res/drawable/left_ear.xml
deleted file mode 100644
index 2b98736df03..00000000000
--- a/packages/EasterEgg/res/drawable/left_ear.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="left_ear" android:fillColor="#FF000000" android:pathData="M15.4,1l5.1000004,5.3l-6.3,2.8000002z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/left_ear_inside.xml b/packages/EasterEgg/res/drawable/left_ear_inside.xml
deleted file mode 100644
index 1d947edc31e..00000000000
--- a/packages/EasterEgg/res/drawable/left_ear_inside.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="left_ear_inside" android:fillColor="#FF000000" android:pathData="M15.4,1l3.5,6.2l-4.7,1.9z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/left_eye.xml b/packages/EasterEgg/res/drawable/left_eye.xml
deleted file mode 100644
index 4dde1b66139..00000000000
--- a/packages/EasterEgg/res/drawable/left_eye.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="left_eye" android:fillColor="#FF000000" android:pathData="M20.5,11c0,1.7 -3,1.7 -3,0C17.5,9.3 20.5,9.3 20.5,11z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/leg2.xml b/packages/EasterEgg/res/drawable/leg2.xml
deleted file mode 100644
index a772a870af7..00000000000
--- a/packages/EasterEgg/res/drawable/leg2.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="leg2" android:fillColor="#FF000000" android:pathData="M16,37h5v6h-5z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/leg2_shadow.xml b/packages/EasterEgg/res/drawable/leg2_shadow.xml
deleted file mode 100644
index b01bd6995c0..00000000000
--- a/packages/EasterEgg/res/drawable/leg2_shadow.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="leg2_shadow" android:fillColor="#FF000000" android:pathData="M16,37h5v3h-5z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/leg3.xml b/packages/EasterEgg/res/drawable/leg3.xml
deleted file mode 100644
index d471236687b..00000000000
--- a/packages/EasterEgg/res/drawable/leg3.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="leg3" android:fillColor="#FF000000" android:pathData="M27,37h5v6h-5z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/leg4.xml b/packages/EasterEgg/res/drawable/leg4.xml
deleted file mode 100644
index e5868eb80c5..00000000000
--- a/packages/EasterEgg/res/drawable/leg4.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="leg4" android:fillColor="#FF000000" android:pathData="M34,37h5v6h-5z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/mouth.xml b/packages/EasterEgg/res/drawable/mouth.xml
deleted file mode 100644
index ddcf2e82f97..00000000000
--- a/packages/EasterEgg/res/drawable/mouth.xml
+++ /dev/null
@@ -1,27 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="mouth"
-        android:strokeColor="#FF000000"
-        android:strokeWidth="1.2"
-        android:strokeLineCap="round"
-        android:pathData="M29,14.3c-0.4,0.8 -1.3,1.4 -2.3,1.4c-1.4,0 -2.7,-1.3 -2.7,-2.7
-                          M24,13c0,1.5 -1.2,2.7 -2.7,2.7c-1,0 -1.9,-0.5 -2.3,-1.4"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/nose.xml b/packages/EasterEgg/res/drawable/nose.xml
deleted file mode 100644
index d403cd1baad..00000000000
--- a/packages/EasterEgg/res/drawable/nose.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="nose" android:fillColor="#FF000000" android:pathData="M25.2,13c0,1.3 -2.3,1.3 -2.3,0S25.2,11.7 25.2,13z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/octo_bg.xml b/packages/EasterEgg/res/drawable/octo_bg.xml
deleted file mode 100644
index 1e46cf434a8..00000000000
--- a/packages/EasterEgg/res/drawable/octo_bg.xml
+++ /dev/null
@@ -1,8 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<shape xmlns:android="http://schemas.android.com/apk/res/android">
-    <gradient android:angle="-90"
-        android:startColor="#FF205090"
-        android:endColor="#FF001040"
-        android:type="linear"
-        />
-</shape>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/drawable/p.xml b/packages/EasterEgg/res/drawable/p.xml
new file mode 100644
index 00000000000..596b7824cdb
--- /dev/null
+++ b/packages/EasterEgg/res/drawable/p.xml
@@ -0,0 +1,33 @@
+<!--
+Copyright (C) 2018 The Android Open Source Project
+
+   Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<vector xmlns:android="http://schemas.android.com/apk/res/android"
+    android:width="108dp"
+    android:height="108dp"
+    android:viewportWidth="108"
+    android:viewportHeight="108">
+  <path
+      android:pathData="M49,65L54,65C60.075,65 65,60.075 65,54C65,47.925 60.075,43 54,43C47.925,43 43,47.925 43,54L43,108"
+      android:strokeWidth="16"
+      android:fillColor="#00000000"
+      android:strokeColor="#7CB342"
+      android:fillType="evenOdd"/>
+  <path
+      android:pathData="M51,65L54,65C60.075,65 65,60.075 65,54C65,47.925 60.075,43 54,43C47.925,43 43,47.925 43,54L43,108"
+      android:strokeWidth="8"
+      android:fillColor="#00000000"
+      android:strokeColor="#FFFFFF"
+      android:fillType="evenOdd"/>
+</vector>
diff --git a/packages/EasterEgg/res/drawable/right_ear.xml b/packages/EasterEgg/res/drawable/right_ear.xml
deleted file mode 100644
index b9fb4d1c747..00000000000
--- a/packages/EasterEgg/res/drawable/right_ear.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="right_ear" android:fillColor="#FF000000" android:pathData="M32.6,1l-5.0999985,5.3l6.299999,2.8000002z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/right_eye.xml b/packages/EasterEgg/res/drawable/right_eye.xml
deleted file mode 100644
index a1871a62c25..00000000000
--- a/packages/EasterEgg/res/drawable/right_eye.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="right_eye" android:fillColor="#FF000000" android:pathData="M30.5,11c0,1.7 -3,1.7 -3,0C27.5,9.3 30.5,9.3 30.5,11z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/stat_icon.xml b/packages/EasterEgg/res/drawable/stat_icon.xml
deleted file mode 100644
index 608cb2017c3..00000000000
--- a/packages/EasterEgg/res/drawable/stat_icon.xml
+++ /dev/null
@@ -1,30 +0,0 @@
-<!--
-Copyright (C) 2015 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="24dp"
-        android:height="24dp"
-        android:viewportWidth="24.0"
-        android:viewportHeight="24.0">
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M12,2C6.5,2 2,6.5 2,12c0,5.5 4.5,10 10,10s10,-4.5 10,-10C22,6.5 17.5,2 12,2zM5.5,11c0,-1.6 3,-1.6 3,0C8.5,12.7 5.5,12.7 5.5,11zM17.5,14.6c-0.6,1 -1.7,1.7 -2.9,1.7c-1.1,0 -2,-0.6 -2.6,-1.4c-0.6,0.9 -1.6,1.4 -2.7,1.4c-1.3,0 -2.3,-0.7 -2.9,-1.8c-0.2,-0.3 0,-0.7 0.3,-0.8c0.3,-0.2 0.7,0 0.8,0.3c0.3,0.7 1,1.1 1.8,1.1c0.9,0 1.6,-0.5 1.9,-1.3c-0.2,-0.2 -0.4,-0.4 -0.4,-0.7c0,-1.3 2.3,-1.3 2.3,0c0,0.3 -0.2,0.6 -0.4,0.7c0.3,0.8 1.1,1.3 1.9,1.3c0.8,0 1.5,-0.6 1.8,-1.1c0.2,-0.3 0.6,-0.4 0.9,-0.2C17.6,13.9 17.7,14.3 17.5,14.6zM15.5,11c0,-1.6 3,-1.6 3,0C18.5,12.7 15.5,12.7 15.5,11z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M5.2,1.0l4.1000004,4.2l-5.0,2.1000004z"/>
-    <path
-        android:fillColor="#FF000000"
-        android:pathData="M18.8,1.0l-4.0999994,4.2l5.000001,2.1000004z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/tail.xml b/packages/EasterEgg/res/drawable/tail.xml
deleted file mode 100644
index 0cca23c3e16..00000000000
--- a/packages/EasterEgg/res/drawable/tail.xml
+++ /dev/null
@@ -1,26 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="tail"
-        android:strokeColor="#FF000000"
-        android:strokeWidth="5"
-        android:strokeLineCap="round"
-        android:pathData="M35,35.5h5.9c2.1,0 3.8,-1.7 3.8,-3.8v-6.2"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/tail_cap.xml b/packages/EasterEgg/res/drawable/tail_cap.xml
deleted file mode 100644
index b82f6f9b478..00000000000
--- a/packages/EasterEgg/res/drawable/tail_cap.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="tail_cap" android:fillColor="#FF000000" android:pathData="M42.2,25.5c0,-1.4 1.1,-2.5 2.5,-2.5s2.5,1.1 2.5,2.5H42.2z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/tail_shadow.xml b/packages/EasterEgg/res/drawable/tail_shadow.xml
deleted file mode 100644
index bb1ff12b3af..00000000000
--- a/packages/EasterEgg/res/drawable/tail_shadow.xml
+++ /dev/null
@@ -1,22 +0,0 @@
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="tail_shadow" android:fillColor="#FF000000" android:pathData="M40,38l0,-5l-1,0l0,5z"/>
-</vector>
diff --git a/packages/EasterEgg/res/drawable/toolbar_bg.xml b/packages/EasterEgg/res/drawable/toolbar_bg.xml
new file mode 100644
index 00000000000..0f0e702fd7c
--- /dev/null
+++ b/packages/EasterEgg/res/drawable/toolbar_bg.xml
@@ -0,0 +1,19 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<shape xmlns:android="http://schemas.android.com/apk/res/android" android:shape="rectangle">
+    <solid android:color="@color/toolbar_bg_color" />
+</shape>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/drawable/ic_close.xml b/packages/EasterEgg/res/drawable/toolbar_button_bg.xml
similarity index 54%
rename from packages/EasterEgg/res/drawable/ic_close.xml
rename to packages/EasterEgg/res/drawable/toolbar_button_bg.xml
index 60ea36b11fc..1b6a53ec7cc 100644
--- a/packages/EasterEgg/res/drawable/ic_close.xml
+++ b/packages/EasterEgg/res/drawable/toolbar_button_bg.xml
@@ -1,5 +1,6 @@
+<?xml version="1.0" encoding="utf-8"?>
 <!--
-    Copyright (C) 2016 The Android Open Source Project
+    Copyright (C) 2018 The Android Open Source Project
 
     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
@@ -13,12 +14,12 @@
     See the License for the specific language governing permissions and
     limitations under the License.
 -->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="24.0dp"
-        android:height="24.0dp"
-        android:viewportWidth="24.0"
-        android:viewportHeight="24.0">
-    <path
-        android:fillColor="#FFFFFFFF"
-        android:pathData="M19.0,6.41L17.59,5.0 12.0,10.59 6.41,5.0 5.0,6.41 10.59,12.0 5.0,17.59 6.41,19.0 12.0,13.41 17.59,19.0 19.0,17.59 13.41,12.0z"/>
-</vector>
+<ripple xmlns:android="http://schemas.android.com/apk/res/android"
+    android:color="?android:attr/colorControlHighlight">
+    <item android:id="@android:id/mask">
+        <shape android:shape="rectangle">
+            <solid android:color="@android:color/black" />
+            <corners android:radius="4dp" />
+        </shape>
+    </item>
+</ripple>
diff --git a/packages/EasterEgg/res/layout/activity_paint.xml b/packages/EasterEgg/res/layout/activity_paint.xml
new file mode 100644
index 00000000000..a4c17afd153
--- /dev/null
+++ b/packages/EasterEgg/res/layout/activity_paint.xml
@@ -0,0 +1,48 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:tools="http://schemas.android.com/tools"
+    xmlns:app="http://schemas.android.com/apk/res/com.android.egg"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    android:background="#666"
+    tools:context=".paint.PaintActivity"
+    android:id="@+id/contentView" >
+
+    <include layout="@layout/toolbar"
+        android:id="@+id/toolbar"
+        android:layout_width="match_parent"
+        android:layout_height="50dp"
+        android:layout_gravity="top"
+        />
+    <include layout="@layout/colors"
+        android:id="@+id/colors"
+        android:layout_width="match_parent"
+        android:layout_height="48dp"
+        android:layout_gravity="top"
+        android:visibility="gone"
+        />
+    <include layout="@layout/brushes"
+        android:id="@+id/brushes"
+        android:layout_width="match_parent"
+        android:layout_height="48dp"
+        android:layout_gravity="top"
+        android:visibility="gone"
+        />
+
+
+</FrameLayout>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/drawable/body.xml b/packages/EasterEgg/res/layout/brushes.xml
similarity index 51%
rename from packages/EasterEgg/res/drawable/body.xml
rename to packages/EasterEgg/res/layout/brushes.xml
index 86087209eff..0c4b849b4eb 100644
--- a/packages/EasterEgg/res/drawable/body.xml
+++ b/packages/EasterEgg/res/layout/brushes.xml
@@ -1,7 +1,8 @@
+<?xml version="1.0" encoding="utf-8"?>
 <!--
-Copyright (C) 2016 The Android Open Source Project
+    Copyright (C) 2018 The Android Open Source Project
 
-   Licensed under the Apache License, Version 2.0 (the "License");
+    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
 
@@ -13,10 +14,12 @@ Copyright (C) 2016 The Android Open Source Project
     See the License for the specific language governing permissions and
     limitations under the License.
 -->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
-    <path android:name="body" android:fillColor="#FF000000" android:pathData="M9,20h30v18h-30z"/>
-</vector>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+    android:orientation="horizontal"
+    android:gravity="left"
+    android:background="@drawable/toolbar_bg"
+    android:elevation="10dp"
+    >
+</LinearLayout>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/layout/cat_view.xml b/packages/EasterEgg/res/layout/cat_view.xml
deleted file mode 100644
index 85b494d2e68..00000000000
--- a/packages/EasterEgg/res/layout/cat_view.xml
+++ /dev/null
@@ -1,82 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
-  Copyright (C) 2016 The Android Open Source Project
-
-  Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
-  except in compliance with the License. You may obtain a copy of the License at
-
-       http://www.apache.org/licenses/LICENSE-2.0
-
-  Unless required by applicable law or agreed to in writing, software distributed under the
-  License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
-  KIND, either express or implied. See the License for the specific language governing
-  permissions and limitations under the License.
-  -->
-<LinearLayout
-    xmlns:android="http://schemas.android.com/apk/res/android"
-    android:orientation="vertical"
-    android:layout_width="match_parent"
-    android:layout_height="wrap_content"
-    android:minHeight="?android:attr/listPreferredItemHeightSmall"
-    android:paddingStart="?android:attr/listPreferredItemPaddingStart"
-    android:paddingEnd="?android:attr/listPreferredItemPaddingEnd"
-    android:paddingTop="8dp"
-    android:paddingBottom="8dp"
-    android:background="?android:attr/selectableItemBackgroundBorderless"
-    android:gravity="center_horizontal"
-    android:clipToPadding="false">
-
-    <FrameLayout
-        android:layout_width="96dp"
-        android:layout_height="wrap_content">
-
-        <ImageView
-            android:id="@android:id/icon"
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:padding="10dp"
-            android:layout_gravity="center"
-            android:scaleType="fitCenter" />
-
-        <LinearLayout
-            android:id="@+id/contextGroup"
-            android:layout_width="match_parent"
-            android:layout_height="wrap_content"
-            android:visibility="invisible"
-            android:layout_gravity="bottom">
-
-            <ImageView
-                android:id="@android:id/shareText"
-                android:layout_width="40dp"
-                android:layout_height="40dp"
-                android:padding="8dp"
-                android:src="@drawable/ic_share"
-                android:scaleType="fitCenter"
-                android:background="#40000000"/>
-
-            <Space
-                android:layout_width="0dp"
-                android:layout_height="0dp"
-                android:layout_weight="1" />
-
-            <ImageView
-                android:id="@android:id/closeButton"
-                android:layout_width="40dp"
-                android:layout_height="40dp"
-                android:padding="4dp"
-                android:src="@drawable/ic_close"
-                android:scaleType="fitCenter"
-                android:background="#40000000"/>
-
-        </LinearLayout>
-
-    </FrameLayout>
-
-    <TextView
-        android:id="@android:id/title"
-        android:layout_width="wrap_content"
-        android:layout_height="wrap_content"
-        android:textAppearance="?android:attr/textAppearanceListItem"
-        android:gravity="center"/>
-</LinearLayout>
-
diff --git a/packages/EasterEgg/res/drawable/right_ear_inside.xml b/packages/EasterEgg/res/layout/colors.xml
similarity index 51%
rename from packages/EasterEgg/res/drawable/right_ear_inside.xml
rename to packages/EasterEgg/res/layout/colors.xml
index 86b6e3428d1..b90f4d71b1e 100644
--- a/packages/EasterEgg/res/drawable/right_ear_inside.xml
+++ b/packages/EasterEgg/res/layout/colors.xml
@@ -1,7 +1,8 @@
+<?xml version="1.0" encoding="utf-8"?>
 <!--
-Copyright (C) 2016 The Android Open Source Project
+    Copyright (C) 2018 The Android Open Source Project
 
-   Licensed under the Apache License, Version 2.0 (the "License");
+    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
 
@@ -13,11 +14,13 @@ Copyright (C) 2016 The Android Open Source Project
     See the License for the specific language governing permissions and
     limitations under the License.
 -->
-<vector xmlns:android="http://schemas.android.com/apk/res/android"
-        android:width="48dp"
-        android:height="48dp"
-        android:viewportWidth="48.0"
-        android:viewportHeight="48.0">
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+    android:orientation="horizontal"
+    android:gravity="left"
+    android:background="@drawable/toolbar_bg"
+    android:elevation="10dp"
+    >
 
-    <path android:name="right_ear_inside" android:fillColor="#FF000000" android:pathData="M33.8,9.1l-4.7,-1.9l3.5,-6.2z"/>
-</vector>
+</LinearLayout>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/layout/edit_text.xml b/packages/EasterEgg/res/layout/edit_text.xml
deleted file mode 100644
index 9f7ac802bad..00000000000
--- a/packages/EasterEgg/res/layout/edit_text.xml
+++ /dev/null
@@ -1,30 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
-  Copyright (C) 2016 The Android Open Source Project
-
-  Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
-  except in compliance with the License. You may obtain a copy of the License at
-
-       http://www.apache.org/licenses/LICENSE-2.0
-
-  Unless required by applicable law or agreed to in writing, software distributed under the
-  License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
-  KIND, either express or implied. See the License for the specific language governing
-  permissions and limitations under the License.
-  -->
-
-<FrameLayout
-    xmlns:android="http://schemas.android.com/apk/res/android"
-    android:orientation="vertical"
-    android:layout_width="match_parent"
-    android:layout_height="match_parent"
-    android:paddingStart="20dp"
-    android:paddingEnd="20dp">
-
-    <EditText
-        android:id="@android:id/edit"
-        android:maxLines="1"
-        android:layout_width="match_parent"
-        android:layout_height="wrap_content"/>
-
-</FrameLayout>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/layout/food_layout.xml b/packages/EasterEgg/res/layout/food_layout.xml
deleted file mode 100644
index d0ca0c8899a..00000000000
--- a/packages/EasterEgg/res/layout/food_layout.xml
+++ /dev/null
@@ -1,31 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
-  Copyright (C) 2016 The Android Open Source Project
-
-  Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
-  except in compliance with the License. You may obtain a copy of the License at
-
-       http://www.apache.org/licenses/LICENSE-2.0
-
-  Unless required by applicable law or agreed to in writing, software distributed under the
-  License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
-  KIND, either express or implied. See the License for the specific language governing
-  permissions and limitations under the License.
-  -->
-
-<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
-              android:orientation="vertical"
-              android:layout_width="wrap_content"
-              android:layout_height="wrap_content"
-              android:background="?android:attr/selectableItemBackgroundBorderless"
-              android:paddingLeft="4dp" android:paddingRight="4dp"
-              android:paddingBottom="6dp" android:paddingTop="6dp">
-    <ImageView
-        android:layout_width="64dp"
-        android:layout_height="64dp"
-        android:id="@+id/icon"
-        android:tint="?android:attr/colorControlNormal"/>
-    <TextView android:layout_width="64dp" android:layout_height="wrap_content"
-        android:gravity="top|center_horizontal"
-        android:id="@+id/text" />
-</LinearLayout>
diff --git a/packages/EasterEgg/res/layout/neko_activity.xml b/packages/EasterEgg/res/layout/neko_activity.xml
deleted file mode 100644
index 21a4600bae4..00000000000
--- a/packages/EasterEgg/res/layout/neko_activity.xml
+++ /dev/null
@@ -1,25 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
-Copyright (C) 2016 The Android Open Source Project
-
-   Licensed under the Apache License, Version 2.0 (the "License");
-    you may not use this file except in compliance with the License.
-    You may obtain a copy of the License at
-
-         http://www.apache.org/licenses/LICENSE-2.0
-
-    Unless required by applicable law or agreed to in writing, software
-    distributed under the License is distributed on an "AS IS" BASIS,
-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-    See the License for the specific language governing permissions and
-    limitations under the License.
--->
-<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
-             android:layout_width="match_parent"
-             android:layout_height="match_parent">
-    <android.support.v7.widget.RecyclerView
-        android:id="@+id/holder"
-        android:layout_width="match_parent"
-        android:layout_height="wrap_content"
-        android:layout_gravity="center_horizontal"/>
-</FrameLayout>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/layout/toolbar.xml b/packages/EasterEgg/res/layout/toolbar.xml
new file mode 100644
index 00000000000..9a5a9c541a4
--- /dev/null
+++ b/packages/EasterEgg/res/layout/toolbar.xml
@@ -0,0 +1,111 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<com.android.egg.paint.CutoutAvoidingToolbar
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:tools="http://schemas.android.com/tools"
+    android:layout_width="match_parent"
+    android:layout_height="50dp"
+    android:orientation="horizontal"
+    android:gravity="left"
+    android:background="@drawable/toolbar_bg"
+    android:elevation="20dp"
+    >
+
+    <Space
+        android:tag="cutoutLeft"
+        android:layout_width="0dp"
+        android:layout_height="match_parent"
+        />
+
+    <LinearLayout
+        android:layout_width="0dp"
+        android:tag="beforeCutout"
+        android:layout_height="match_parent"
+        android:orientation="horizontal"
+        android:layout_weight="1"
+        tools:ignore="UselessParent">
+
+        <ImageButton
+            android:id="@+id/btnBrush"
+            android:layout_width="48dp"
+            android:layout_height="match_parent"
+            android:layout_weight="1"
+            android:tint="@color/toolbar_icon_color"
+            android:background="@drawable/toolbar_button_bg"
+            />
+
+        <ImageButton
+            android:id="@+id/btnColor"
+            android:layout_width="48dp"
+            android:layout_height="match_parent"
+            android:layout_weight="1"
+            android:tint="@color/toolbar_icon_color"
+            android:background="@drawable/toolbar_button_bg"
+            />
+
+        <ImageButton
+            android:id="@+id/btnSample"
+            android:layout_width="48dp"
+            android:layout_height="match_parent"
+            android:layout_weight="1"
+            android:background="@drawable/toolbar_button_bg"
+            android:tint="@color/toolbar_icon_color"
+            android:src="@drawable/ic_dropper" />
+
+    </LinearLayout>
+
+    <Space
+        android:tag="cutoutCenter"
+        android:layout_width="0dp"
+        android:layout_height="match_parent"
+        />
+
+    <LinearLayout
+        android:layout_width="0dp"
+        android:tag="afterCutout"
+        android:layout_height="match_parent"
+        android:orientation="horizontal"
+        android:layout_weight="1"
+        tools:ignore="UselessParent">
+
+        <ImageButton
+            android:id="@+id/btnZen"
+            android:layout_width="48dp"
+            android:layout_height="match_parent"
+            android:layout_weight="1"
+            android:background="@drawable/toolbar_button_bg"
+            android:tint="@color/toolbar_icon_color"
+            android:src="@drawable/ic_hourglass" />
+
+        <ImageButton
+            android:id="@+id/btnClear"
+            android:layout_width="48dp"
+            android:layout_height="match_parent"
+            android:layout_weight="1"
+            android:background="@drawable/toolbar_button_bg"
+            android:tint="@color/toolbar_icon_color"
+            android:src="@drawable/ic_clear" />
+
+    </LinearLayout>
+
+    <Space
+        android:tag="cutoutRight"
+        android:layout_width="0dp"
+        android:layout_height="match_parent"
+        />
+
+</com.android.egg.paint.CutoutAvoidingToolbar>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/values-night/colors.xml b/packages/EasterEgg/res/values-night/colors.xml
new file mode 100644
index 00000000000..7c188f77f44
--- /dev/null
+++ b/packages/EasterEgg/res/values-night/colors.xml
@@ -0,0 +1,21 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<resources>
+    <color name="toolbar_bg_color">#FF333333</color>
+    <color name="paper_color">#FF000000</color>
+    <color name="paint_color">#FFFFFFFF</color>
+</resources>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/values-night/styles.xml b/packages/EasterEgg/res/values-night/styles.xml
new file mode 100644
index 00000000000..4edf6926da4
--- /dev/null
+++ b/packages/EasterEgg/res/values-night/styles.xml
@@ -0,0 +1,21 @@
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<resources>
+    <style name="AppTheme" parent="@android:style/Theme.DeviceDefault.NoActionBar.Fullscreen">
+        <item name="android:windowLayoutInDisplayCutoutMode">shortEdges</item>
+        <item name="android:windowLightNavigationBar">false</item>
+    </style>
+</resources>
diff --git a/packages/EasterEgg/res/values/attrs_toolbar_view.xml b/packages/EasterEgg/res/values/attrs_toolbar_view.xml
new file mode 100644
index 00000000000..ed1360f7d46
--- /dev/null
+++ b/packages/EasterEgg/res/values/attrs_toolbar_view.xml
@@ -0,0 +1,19 @@
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<resources>
+    <declare-styleable name="ToolbarView">
+    </declare-styleable>
+</resources>
diff --git a/packages/EasterEgg/res/values/colors.xml b/packages/EasterEgg/res/values/colors.xml
new file mode 100644
index 00000000000..1a5388b738d
--- /dev/null
+++ b/packages/EasterEgg/res/values/colors.xml
@@ -0,0 +1,21 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<resources>
+    <color name="toolbar_bg_color">#FFDDDDDD</color>
+    <color name="paper_color">#FFFFFFFF</color>
+    <color name="paint_color">#FF000000</color>
+</resources>
\ No newline at end of file
diff --git a/packages/EasterEgg/res/values/strings.xml b/packages/EasterEgg/res/values/strings.xml
index 61e38342872..32dbc97a00f 100644
--- a/packages/EasterEgg/res/values/strings.xml
+++ b/packages/EasterEgg/res/values/strings.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <!--
-Copyright (C) 2016 The Android Open Source Project
+Copyright (C) 2018 The Android Open Source Project
 
    Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
@@ -15,40 +15,5 @@ Copyright (C) 2016 The Android Open Source Project
     limitations under the License.
 -->
 <resources xmlns:android="http://schemas.android.com/apk/res/android">
-    <string name="app_name" translatable="false">Android Easter Egg</string>
-    <string name="notification_name" translatable="false">Android Neko</string>
-    <string name="notification_channel_name" translatable="false">New cats</string>
-    <string name="default_tile_name" translatable="false">\????</string>
-    <string name="notification_title" translatable="false">A cat is here.</string>
-    <string name="default_cat_name" translatable="false">Cat #%s</string>
-    <string name="directory_name" translatable="false">Cats</string>
-    <string name="confirm_delete" translatable="false">Forget %s?</string>
-    <string-array name="food_names" translatable="false">
-        <item>Empty dish</item>
-        <item>Bits</item>
-        <item>Fish</item>
-        <item>Chicken</item>
-        <item>Treat</item>
-    </string-array>
-    <array name="food_icons">
-        <item>@drawable/food_dish</item>
-        <item>@drawable/food_bits</item>
-        <item>@drawable/food_sysuituna</item>
-        <item>@drawable/food_chicken</item>
-        <item>@drawable/food_cookie</item>
-    </array>
-    <integer-array name="food_intervals">
-        <item>0</item>
-        <item>15</item>
-        <item>30</item>
-        <item>60</item>
-        <item>120</item>
-    </integer-array>
-    <integer-array name="food_new_cat_prob">
-        <item>0</item>
-        <item>5</item>
-        <item>35</item>
-        <item>65</item>
-        <item>90</item>
-    </integer-array>
+    <string name="app_name" translatable="false">PAINT.APK</string>
 </resources>
diff --git a/packages/EasterEgg/res/values/styles.xml b/packages/EasterEgg/res/values/styles.xml
new file mode 100644
index 00000000000..44e2ce52aab
--- /dev/null
+++ b/packages/EasterEgg/res/values/styles.xml
@@ -0,0 +1,23 @@
+<!--
+    Copyright (C) 2018 The Android Open Source Project
+
+    Licensed under the Apache License, Version 2.0 (the "License");
+    you may not use this file except in compliance with the License.
+    You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+    Unless required by applicable law or agreed to in writing, software
+    distributed under the License is distributed on an "AS IS" BASIS,
+    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+    See the License for the specific language governing permissions and
+    limitations under the License.
+-->
+<resources>
+
+    <style name="AppTheme" parent="@android:style/Theme.DeviceDefault.Light.NoActionBar.Fullscreen">
+        <item name="android:windowLayoutInDisplayCutoutMode">shortEdges</item>
+        <item name="android:windowLightNavigationBar">true</item>
+    </style>
+
+</resources>
diff --git a/packages/EasterEgg/src/com/android/egg/neko/Cat.java b/packages/EasterEgg/src/com/android/egg/neko/Cat.java
deleted file mode 100644
index dd1bd07f329..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/Cat.java
+++ /dev/null
@@ -1,434 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.app.Notification;
-import android.app.PendingIntent;
-import android.content.Context;
-import android.content.Intent;
-import android.content.res.Resources;
-import android.graphics.*;
-import android.graphics.drawable.Drawable;
-import android.graphics.drawable.Icon;
-import android.os.Bundle;
-
-import java.io.ByteArrayOutputStream;
-import java.util.Random;
-import java.util.concurrent.ThreadLocalRandom;
-
-import com.android.egg.R;
-import com.android.internal.logging.MetricsLogger;
-
-import static com.android.egg.neko.NekoLand.CHAN_ID;
-
-public class Cat extends Drawable {
-    public static final long[] PURR = {0, 40, 20, 40, 20, 40, 20, 40, 20, 40, 20, 40};
-
-    private Random mNotSoRandom;
-    private Bitmap mBitmap;
-    private long mSeed;
-    private String mName;
-    private int mBodyColor;
-    private int mFootType;
-    private boolean mBowTie;
-
-    private synchronized Random notSoRandom(long seed) {
-        if (mNotSoRandom == null) {
-            mNotSoRandom = new Random();
-            mNotSoRandom.setSeed(seed);
-        }
-        return mNotSoRandom;
-    }
-
-    public static final float frandrange(Random r, float a, float b) {
-        return (b-a)*r.nextFloat() + a;
-    }
-
-    public static final Object choose(Random r, Object...l) {
-        return l[r.nextInt(l.length)];
-    }
-
-    public static final int chooseP(Random r, int[] a) {
-        int pct = r.nextInt(1000);
-        final int stop = a.length-2;
-        int i=0;
-        while (i<stop) {
-            pct -= a[i];
-            if (pct < 0) break;
-            i+=2;
-        }
-        return a[i+1];
-    }
-
-    public static final int getColorIndex(int q, int[] a) {
-        for(int i = 1; i < a.length; i+=2) {
-            if (a[i] == q) {
-                return i/2;
-            }
-        }
-        return -1;
-    }
-
-    public static final int[] P_BODY_COLORS = {
-            180, 0xFF212121, // black
-            180, 0xFFFFFFFF, // white
-            140, 0xFF616161, // gray
-            140, 0xFF795548, // brown
-            100, 0xFF90A4AE, // steel
-            100, 0xFFFFF9C4, // buff
-            100, 0xFFFF8F00, // orange
-              5, 0xFF29B6F6, // blue..?
-              5, 0xFFFFCDD2, // pink!?
-              5, 0xFFCE93D8, // purple?!?!?
-              4, 0xFF43A047, // yeah, why not green
-              1, 0,          // ?!?!?!
-    };
-
-    public static final int[] P_COLLAR_COLORS = {
-            250, 0xFFFFFFFF,
-            250, 0xFF000000,
-            250, 0xFFF44336,
-             50, 0xFF1976D2,
-             50, 0xFFFDD835,
-             50, 0xFFFB8C00,
-             50, 0xFFF48FB1,
-             50, 0xFF4CAF50,
-    };
-
-    public static final int[] P_BELLY_COLORS = {
-            750, 0,
-            250, 0xFFFFFFFF,
-    };
-
-    public static final int[] P_DARK_SPOT_COLORS = {
-            700, 0,
-            250, 0xFF212121,
-             50, 0xFF6D4C41,
-    };
-
-    public static final int[] P_LIGHT_SPOT_COLORS = {
-            700, 0,
-            300, 0xFFFFFFFF,
-    };
-
-    private CatParts D;
-
-    public static void tint(int color, Drawable ... ds) {
-        for (Drawable d : ds) {
-            if (d != null) {
-                d.mutate().setTint(color);
-            }
-        }
-    }
-
-    public static boolean isDark(int color) {
-        final int r = (color & 0xFF0000) >> 16;
-        final int g = (color & 0x00FF00) >> 8;
-        final int b = color & 0x0000FF;
-        return (r + g + b) < 0x80;
-    }
-
-    public Cat(Context context, long seed) {
-        D = new CatParts(context);
-        mSeed = seed;
-
-        setName(context.getString(R.string.default_cat_name,
-                String.valueOf(mSeed % 1000)));
-
-        final Random nsr = notSoRandom(seed);
-
-        // body color
-        mBodyColor = chooseP(nsr, P_BODY_COLORS);
-        if (mBodyColor == 0) mBodyColor = Color.HSVToColor(new float[] {
-                nsr.nextFloat()*360f, frandrange(nsr,0.5f,1f), frandrange(nsr,0.5f, 1f)});
-
-        tint(mBodyColor, D.body, D.head, D.leg1, D.leg2, D.leg3, D.leg4, D.tail,
-                D.leftEar, D.rightEar, D.foot1, D.foot2, D.foot3, D.foot4, D.tailCap);
-        tint(0x20000000, D.leg2Shadow, D.tailShadow);
-        if (isDark(mBodyColor)) {
-            tint(0xFFFFFFFF, D.leftEye, D.rightEye, D.mouth, D.nose);
-        }
-        tint(isDark(mBodyColor) ? 0xFFEF9A9A : 0x20D50000, D.leftEarInside, D.rightEarInside);
-
-        tint(chooseP(nsr, P_BELLY_COLORS), D.belly);
-        tint(chooseP(nsr, P_BELLY_COLORS), D.back);
-        final int faceColor = chooseP(nsr, P_BELLY_COLORS);
-        tint(faceColor, D.faceSpot);
-        if (!isDark(faceColor)) {
-            tint(0xFF000000, D.mouth, D.nose);
-        }
-
-        mFootType = 0;
-        if (nsr.nextFloat() < 0.25f) {
-            mFootType = 4;
-            tint(0xFFFFFFFF, D.foot1, D.foot2, D.foot3, D.foot4);
-        } else {
-            if (nsr.nextFloat() < 0.25f) {
-                mFootType = 2;
-                tint(0xFFFFFFFF, D.foot1, D.foot3);
-            } else if (nsr.nextFloat() < 0.25f) {
-                mFootType = 3; // maybe -2 would be better? meh.
-                tint(0xFFFFFFFF, D.foot2, D.foot4);
-            } else if (nsr.nextFloat() < 0.1f) {
-                mFootType = 1;
-                tint(0xFFFFFFFF, (Drawable) choose(nsr, D.foot1, D.foot2, D.foot3, D.foot4));
-            }
-        }
-
-        tint(nsr.nextFloat() < 0.333f ? 0xFFFFFFFF : mBodyColor, D.tailCap);
-
-        final int capColor = chooseP(nsr, isDark(mBodyColor) ? P_LIGHT_SPOT_COLORS : P_DARK_SPOT_COLORS);
-        tint(capColor, D.cap);
-        //tint(chooseP(nsr, isDark(bodyColor) ? P_LIGHT_SPOT_COLORS : P_DARK_SPOT_COLORS), D.nose);
-
-        final int collarColor = chooseP(nsr, P_COLLAR_COLORS);
-        tint(collarColor, D.collar);
-        mBowTie = nsr.nextFloat() < 0.1f;
-        tint(mBowTie ? collarColor : 0, D.bowtie);
-    }
-
-    public static Cat create(Context context) {
-        return new Cat(context, Math.abs(ThreadLocalRandom.current().nextInt()));
-    }
-
-    public Notification.Builder buildNotification(Context context) {
-        final Bundle extras = new Bundle();
-        extras.putString("android.substName", context.getString(R.string.notification_name));
-        final Intent intent = new Intent(Intent.ACTION_MAIN)
-                .setClass(context, NekoLand.class)
-                .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
-        return new Notification.Builder(context)
-                .setSmallIcon(Icon.createWithResource(context, R.drawable.stat_icon))
-                .setLargeIcon(createNotificationLargeIcon(context))
-                .setColor(getBodyColor())
-                .setPriority(Notification.PRIORITY_LOW)
-                .setContentTitle(context.getString(R.string.notification_title))
-                .setShowWhen(true)
-                .setCategory(Notification.CATEGORY_STATUS)
-                .setContentText(getName())
-                .setContentIntent(PendingIntent.getActivity(context, 0, intent, 0))
-                .setAutoCancel(true)
-                .setChannel(CHAN_ID)
-                .setVibrate(PURR)
-                .addExtras(extras);
-    }
-
-    public long getSeed() {
-        return mSeed;
-    }
-
-    @Override
-    public void draw(Canvas canvas) {
-        final int w = Math.min(canvas.getWidth(), canvas.getHeight());
-        final int h = w;
-
-        if (mBitmap == null || mBitmap.getWidth() != w || mBitmap.getHeight() != h) {
-            mBitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);
-            final Canvas bitCanvas = new Canvas(mBitmap);
-            slowDraw(bitCanvas, 0, 0, w, h);
-        }
-        canvas.drawBitmap(mBitmap, 0, 0, null);
-    }
-
-    private void slowDraw(Canvas canvas, int x, int y, int w, int h) {
-        for (int i = 0; i < D.drawingOrder.length; i++) {
-            final Drawable d = D.drawingOrder[i];
-            if (d != null) {
-                d.setBounds(x, y, x+w, y+h);
-                d.draw(canvas);
-            }
-        }
-
-    }
-
-    public Bitmap createBitmap(int w, int h) {
-        if (mBitmap != null && mBitmap.getWidth() == w && mBitmap.getHeight() == h) {
-            return mBitmap.copy(mBitmap.getConfig(), true);
-        }
-        Bitmap result = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);
-        slowDraw(new Canvas(result), 0, 0, w, h);
-        return result;
-    }
-
-    public static Icon recompressIcon(Icon bitmapIcon) {
-        if (bitmapIcon.getType() != Icon.TYPE_BITMAP) return bitmapIcon;
-        final Bitmap bits = bitmapIcon.getBitmap();
-        final ByteArrayOutputStream ostream = new ByteArrayOutputStream(
-                bits.getWidth() * bits.getHeight() * 2); // guess 50% compression
-        final boolean ok = bits.compress(Bitmap.CompressFormat.PNG, 100, ostream);
-        if (!ok) return null;
-        return Icon.createWithData(ostream.toByteArray(), 0, ostream.size());
-    }
-
-    public Icon createNotificationLargeIcon(Context context) {
-        final Resources res = context.getResources();
-        final int w = 2*res.getDimensionPixelSize(android.R.dimen.notification_large_icon_width);
-        final int h = 2*res.getDimensionPixelSize(android.R.dimen.notification_large_icon_height);
-        return recompressIcon(createIcon(context, w, h));
-    }
-
-    public Icon createIcon(Context context, int w, int h) {
-        Bitmap result = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);
-        final Canvas canvas = new Canvas(result);
-        final Paint pt = new Paint();
-        float[] hsv = new float[3];
-        Color.colorToHSV(mBodyColor, hsv);
-        hsv[2] = (hsv[2]>0.5f)
-                ? (hsv[2] - 0.25f)
-                : (hsv[2] + 0.25f);
-        pt.setColor(Color.HSVToColor(hsv));
-        float r = w/2;
-        canvas.drawCircle(r, r, r, pt);
-        int m = w/10;
-
-        slowDraw(canvas, m, m, w-m-m, h-m-m);
-
-        return Icon.createWithBitmap(result);
-    }
-
-    @Override
-    public void setAlpha(int i) {
-
-    }
-
-    @Override
-    public void setColorFilter(ColorFilter colorFilter) {
-
-    }
-
-    @Override
-    public int getOpacity() {
-        return PixelFormat.TRANSLUCENT;
-    }
-
-    public String getName() {
-        return mName;
-    }
-
-    public void setName(String name) {
-        this.mName = name;
-    }
-
-    public int getBodyColor() {
-        return mBodyColor;
-    }
-
-    public void logAdd(Context context) {
-        logCatAction(context, "egg_neko_add");
-    }
-
-    public void logRename(Context context) {
-        logCatAction(context, "egg_neko_rename");
-    }
-
-    public void logRemove(Context context) {
-        logCatAction(context, "egg_neko_remove");
-    }
-
-    public void logShare(Context context) {
-        logCatAction(context, "egg_neko_share");
-    }
-
-    private void logCatAction(Context context, String prefix) {
-        MetricsLogger.count(context, prefix, 1);
-        MetricsLogger.histogram(context, prefix +"_color",
-                getColorIndex(mBodyColor, P_BODY_COLORS));
-        MetricsLogger.histogram(context, prefix + "_bowtie", mBowTie ? 1 : 0);
-        MetricsLogger.histogram(context, prefix + "_feet", mFootType);
-    }
-
-    public static class CatParts {
-        public Drawable leftEar;
-        public Drawable rightEar;
-        public Drawable rightEarInside;
-        public Drawable leftEarInside;
-        public Drawable head;
-        public Drawable faceSpot;
-        public Drawable cap;
-        public Drawable mouth;
-        public Drawable body;
-        public Drawable foot1;
-        public Drawable leg1;
-        public Drawable foot2;
-        public Drawable leg2;
-        public Drawable foot3;
-        public Drawable leg3;
-        public Drawable foot4;
-        public Drawable leg4;
-        public Drawable tail;
-        public Drawable leg2Shadow;
-        public Drawable tailShadow;
-        public Drawable tailCap;
-        public Drawable belly;
-        public Drawable back;
-        public Drawable rightEye;
-        public Drawable leftEye;
-        public Drawable nose;
-        public Drawable bowtie;
-        public Drawable collar;
-        public Drawable[] drawingOrder;
-
-        public CatParts(Context context) {
-            body = context.getDrawable(R.drawable.body);
-            head = context.getDrawable(R.drawable.head);
-            leg1 = context.getDrawable(R.drawable.leg1);
-            leg2 = context.getDrawable(R.drawable.leg2);
-            leg3 = context.getDrawable(R.drawable.leg3);
-            leg4 = context.getDrawable(R.drawable.leg4);
-            tail = context.getDrawable(R.drawable.tail);
-            leftEar = context.getDrawable(R.drawable.left_ear);
-            rightEar = context.getDrawable(R.drawable.right_ear);
-            rightEarInside = context.getDrawable(R.drawable.right_ear_inside);
-            leftEarInside = context.getDrawable(R.drawable.left_ear_inside);
-            faceSpot = context.getDrawable(R.drawable.face_spot);
-            cap = context.getDrawable(R.drawable.cap);
-            mouth = context.getDrawable(R.drawable.mouth);
-            foot4 = context.getDrawable(R.drawable.foot4);
-            foot3 = context.getDrawable(R.drawable.foot3);
-            foot1 = context.getDrawable(R.drawable.foot1);
-            foot2 = context.getDrawable(R.drawable.foot2);
-            leg2Shadow = context.getDrawable(R.drawable.leg2_shadow);
-            tailShadow = context.getDrawable(R.drawable.tail_shadow);
-            tailCap = context.getDrawable(R.drawable.tail_cap);
-            belly = context.getDrawable(R.drawable.belly);
-            back = context.getDrawable(R.drawable.back);
-            rightEye = context.getDrawable(R.drawable.right_eye);
-            leftEye = context.getDrawable(R.drawable.left_eye);
-            nose = context.getDrawable(R.drawable.nose);
-            collar = context.getDrawable(R.drawable.collar);
-            bowtie = context.getDrawable(R.drawable.bowtie);
-            drawingOrder = getDrawingOrder();
-        }
-        private Drawable[] getDrawingOrder() {
-            return new Drawable[] {
-                    collar,
-                    leftEar, leftEarInside, rightEar, rightEarInside,
-                    head,
-                    faceSpot,
-                    cap,
-                    leftEye, rightEye,
-                    nose, mouth,
-                    tail, tailCap, tailShadow,
-                    foot1, leg1,
-                    foot2, leg2,
-                    foot3, leg3,
-                    foot4, leg4,
-                    leg2Shadow,
-                    body, belly,
-                    bowtie
-            };
-        }
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/neko/Food.java b/packages/EasterEgg/src/com/android/egg/neko/Food.java
deleted file mode 100644
index 5c0f12e2639..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/Food.java
+++ /dev/null
@@ -1,60 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.content.Context;
-import android.content.res.TypedArray;
-import android.graphics.drawable.Drawable;
-import android.graphics.drawable.Icon;
-
-import com.android.egg.R;
-
-public class Food {
-    private final int mType;
-
-    private static int[] sIcons;
-    private static String[] sNames;
-
-    public Food(int type) {
-        mType = type;
-    }
-
-    public Icon getIcon(Context context) {
-        if (sIcons == null) {
-            TypedArray icons = context.getResources().obtainTypedArray(R.array.food_icons);
-            sIcons = new int[icons.length()];
-            for (int i = 0; i < sIcons.length; i++) {
-                sIcons[i] = icons.getResourceId(i, 0);
-            }
-            icons.recycle();
-        }
-        return Icon.createWithResource(context, sIcons[mType]);
-    }
-
-    public String getName(Context context) {
-        if (sNames == null) {
-            sNames = context.getResources().getStringArray(R.array.food_names);
-        }
-        return sNames[mType];
-    }
-
-    public long getInterval(Context context) {
-        return context.getResources().getIntArray(R.array.food_intervals)[mType];
-    }
-
-    public int getType() {
-        return mType;
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/neko/NekoActivationActivity.java b/packages/EasterEgg/src/com/android/egg/neko/NekoActivationActivity.java
deleted file mode 100644
index c0b725c0589..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/NekoActivationActivity.java
+++ /dev/null
@@ -1,57 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.app.Activity;
-import android.content.ComponentName;
-import android.content.pm.PackageManager;
-import android.util.Log;
-import android.widget.Toast;
-
-import com.android.internal.logging.MetricsLogger;
-
-public class NekoActivationActivity extends Activity {
-    private void toastUp(String s) {
-        Toast toast = Toast.makeText(this, s, Toast.LENGTH_SHORT);
-        toast.getView().setBackgroundDrawable(null);
-        toast.show();
-    }
-
-    @Override
-    public void onStart() {
-        super.onStart();
-
-        final PackageManager pm = getPackageManager();
-        final ComponentName cn = new ComponentName(this, NekoTile.class);
-        if (pm.getComponentEnabledSetting(cn) == PackageManager.COMPONENT_ENABLED_STATE_ENABLED) {
-            if (NekoLand.DEBUG) {
-                Log.v("Neko", "Disabling tile.");
-            }
-            pm.setComponentEnabledSetting(cn, PackageManager.COMPONENT_ENABLED_STATE_DISABLED,
-                    PackageManager.DONT_KILL_APP);
-            MetricsLogger.histogram(this, "egg_neko_enable", 0);
-            toastUp("\uD83D\uDEAB");
-        } else {
-            if (NekoLand.DEBUG) {
-                Log.v("Neko", "Enabling tile.");
-            }
-            pm.setComponentEnabledSetting(cn, PackageManager.COMPONENT_ENABLED_STATE_ENABLED,
-                    PackageManager.DONT_KILL_APP);
-            MetricsLogger.histogram(this, "egg_neko_enable", 1);
-            toastUp("\uD83D\uDC31");
-        }
-        finish();
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/neko/NekoDialog.java b/packages/EasterEgg/src/com/android/egg/neko/NekoDialog.java
deleted file mode 100644
index 2d2fbe8207a..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/NekoDialog.java
+++ /dev/null
@@ -1,107 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.support.annotation.NonNull;
-import android.app.Dialog;
-import android.content.Context;
-import android.support.v7.widget.GridLayoutManager;
-import android.support.v7.widget.RecyclerView;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.ViewGroup;
-import android.widget.ImageView;
-import android.widget.TextView;
-
-import com.android.egg.R;
-import com.android.internal.logging.MetricsLogger;
-
-import java.util.ArrayList;
-
-public class NekoDialog extends Dialog {
-
-    private final Adapter mAdapter;
-
-    public NekoDialog(@NonNull Context context) {
-        super(context, android.R.style.Theme_Material_Dialog_NoActionBar);
-        RecyclerView view = new RecyclerView(getContext());
-        mAdapter = new Adapter(getContext());
-        view.setLayoutManager(new GridLayoutManager(getContext(), 2));
-        view.setAdapter(mAdapter);
-        final float dp = context.getResources().getDisplayMetrics().density;
-        final int pad = (int)(16*dp);
-        view.setPadding(pad, pad, pad, pad);
-        setContentView(view);
-    }
-
-    private void onFoodSelected(Food food) {
-        PrefState prefs = new PrefState(getContext());
-        int currentState = prefs.getFoodState();
-        if (currentState == 0 && food.getType() != 0) {
-            NekoService.registerJob(getContext(), food.getInterval(getContext()));
-        }
-        MetricsLogger.histogram(getContext(), "egg_neko_offered_food", food.getType());
-        prefs.setFoodState(food.getType());
-        dismiss();
-    }
-
-    private class Adapter extends RecyclerView.Adapter<Holder> {
-
-        private final Context mContext;
-        private final ArrayList<Food> mFoods = new ArrayList<>();
-
-        public Adapter(Context context) {
-            mContext = context;
-            int[] foods = context.getResources().getIntArray(R.array.food_names);
-            // skip food 0, you can't choose it
-            for (int i=1; i<foods.length; i++) {
-                mFoods.add(new Food(i));
-            }
-        }
-
-        @Override
-        public Holder onCreateViewHolder(ViewGroup parent, int viewType) {
-            return new Holder(LayoutInflater.from(parent.getContext())
-                    .inflate(R.layout.food_layout, parent, false));
-        }
-
-        @Override
-        public void onBindViewHolder(final Holder holder, int position) {
-            final Food food = mFoods.get(position);
-            ((ImageView) holder.itemView.findViewById(R.id.icon))
-                    .setImageIcon(food.getIcon(mContext));
-            ((TextView) holder.itemView.findViewById(R.id.text))
-                    .setText(food.getName(mContext));
-            holder.itemView.setOnClickListener(new View.OnClickListener() {
-                @Override
-                public void onClick(View v) {
-                    onFoodSelected(mFoods.get(holder.getAdapterPosition()));
-                }
-            });
-        }
-
-        @Override
-        public int getItemCount() {
-            return mFoods.size();
-        }
-    }
-
-    public static class Holder extends RecyclerView.ViewHolder {
-
-        public Holder(View itemView) {
-            super(itemView);
-        }
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/neko/NekoLand.java b/packages/EasterEgg/src/com/android/egg/neko/NekoLand.java
deleted file mode 100644
index d2e37d8779d..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/NekoLand.java
+++ /dev/null
@@ -1,338 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.Manifest;
-import android.app.ActionBar;
-import android.app.Activity;
-import android.app.AlertDialog;
-import android.content.Context;
-import android.content.DialogInterface;
-import android.content.DialogInterface.OnClickListener;
-import android.content.Intent;
-import android.content.pm.PackageManager;
-import android.graphics.Bitmap;
-import android.graphics.Color;
-import android.graphics.drawable.Drawable;
-import android.media.MediaScannerConnection;
-import android.net.Uri;
-import android.os.Bundle;
-import android.os.Environment;
-import android.provider.MediaStore.Images;
-import android.support.v4.content.FileProvider;
-import android.support.v7.widget.GridLayoutManager;
-import android.support.v7.widget.RecyclerView;
-import android.util.Log;
-import android.view.ContextThemeWrapper;
-import android.view.LayoutInflater;
-import android.view.View;
-import android.view.View.OnLongClickListener;
-import android.view.ViewGroup;
-import android.widget.EditText;
-import android.widget.ImageView;
-import android.widget.TextView;
-
-import com.android.egg.R;
-import com.android.egg.neko.PrefState.PrefsListener;
-import com.android.internal.logging.MetricsLogger;
-
-import java.io.File;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.io.OutputStream;
-import java.util.Collections;
-import java.util.Comparator;
-import java.util.List;
-
-public class NekoLand extends Activity implements PrefsListener {
-    public static String CHAN_ID = "EGG";
-
-    public static boolean DEBUG = false;
-    public static boolean DEBUG_NOTIFICATIONS = false;
-
-    private static final int EXPORT_BITMAP_SIZE = 600;
-
-    private static final int STORAGE_PERM_REQUEST = 123;
-
-    private static boolean CAT_GEN = false;
-    private PrefState mPrefs;
-    private CatAdapter mAdapter;
-    private Cat mPendingShareCat;
-
-
-    @Override
-    public void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-        setContentView(R.layout.neko_activity);
-        final ActionBar actionBar = getActionBar();
-        if (actionBar != null) {
-            actionBar.setLogo(Cat.create(this));
-            actionBar.setDisplayUseLogoEnabled(false);
-            actionBar.setDisplayShowHomeEnabled(true);
-        }
-
-        mPrefs = new PrefState(this);
-        mPrefs.setListener(this);
-        final RecyclerView recyclerView = findViewById(R.id.holder);
-        mAdapter = new CatAdapter();
-        recyclerView.setAdapter(mAdapter);
-        recyclerView.setLayoutManager(new GridLayoutManager(this, 3));
-        int numCats = updateCats();
-        MetricsLogger.histogram(this, "egg_neko_visit_gallery", numCats);
-    }
-
-    @Override
-    protected void onDestroy() {
-        super.onDestroy();
-        mPrefs.setListener(null);
-    }
-
-    private int updateCats() {
-        Cat[] cats;
-        if (CAT_GEN) {
-            cats = new Cat[50];
-            for (int i = 0; i < cats.length; i++) {
-                cats[i] = Cat.create(this);
-            }
-        } else {
-            final float[] hsv = new float[3];
-            List<Cat> list = mPrefs.getCats();
-            Collections.sort(list, new Comparator<Cat>() {
-                @Override
-                public int compare(Cat cat, Cat cat2) {
-                    Color.colorToHSV(cat.getBodyColor(), hsv);
-                    float bodyH1 = hsv[0];
-                    Color.colorToHSV(cat2.getBodyColor(), hsv);
-                    float bodyH2 = hsv[0];
-                    return Float.compare(bodyH1, bodyH2);
-                }
-            });
-            cats = list.toArray(new Cat[0]);
-        }
-        mAdapter.setCats(cats);
-        return cats.length;
-    }
-
-    private void onCatClick(Cat cat) {
-        if (CAT_GEN) {
-            mPrefs.addCat(cat);
-            new AlertDialog.Builder(NekoLand.this)
-                    .setTitle("Cat added")
-                    .setPositiveButton(android.R.string.ok, null)
-                    .show();
-        } else {
-            showNameDialog(cat);
-        }
-//      noman.notify(1, cat.buildNotification(NekoLand.this).build());
-    }
-
-    private void onCatRemove(Cat cat) {
-        cat.logRemove(this);
-        mPrefs.removeCat(cat);
-    }
-
-    private void showNameDialog(final Cat cat) {
-        final Context context = new ContextThemeWrapper(this,
-                android.R.style.Theme_Material_Light_Dialog_NoActionBar);
-        // TODO: Move to XML, add correct margins.
-        View view = LayoutInflater.from(context).inflate(R.layout.edit_text, null);
-        final EditText text = (EditText) view.findViewById(android.R.id.edit);
-        text.setText(cat.getName());
-        text.setSelection(cat.getName().length());
-        final int size = context.getResources()
-                .getDimensionPixelSize(android.R.dimen.app_icon_size);
-        Drawable catIcon = cat.createIcon(this, size, size).loadDrawable(this);
-        new AlertDialog.Builder(context)
-                .setTitle(" ")
-                .setIcon(catIcon)
-                .setView(view)
-                .setPositiveButton(android.R.string.ok, new OnClickListener() {
-                    @Override
-                    public void onClick(DialogInterface dialog, int which) {
-                        cat.logRename(context);
-                        cat.setName(text.getText().toString().trim());
-                        mPrefs.addCat(cat);
-                    }
-                }).show();
-    }
-
-    @Override
-    public void onPrefsChanged() {
-        updateCats();
-    }
-
-    private class CatAdapter extends RecyclerView.Adapter<CatHolder> {
-
-        private Cat[] mCats;
-
-        public void setCats(Cat[] cats) {
-            mCats = cats;
-            notifyDataSetChanged();
-        }
-
-        @Override
-        public CatHolder onCreateViewHolder(ViewGroup parent, int viewType) {
-            return new CatHolder(LayoutInflater.from(parent.getContext())
-                    .inflate(R.layout.cat_view, parent, false));
-        }
-
-        private void setContextGroupVisible(final CatHolder holder, boolean vis) {
-            final View group = holder.contextGroup;
-            if (vis && group.getVisibility() != View.VISIBLE) {
-                group.setAlpha(0);
-                group.setVisibility(View.VISIBLE);
-                group.animate().alpha(1.0f).setDuration(333);
-                Runnable hideAction = new Runnable() {
-                    @Override
-                    public void run() {
-                        setContextGroupVisible(holder, false);
-                    }
-                };
-                group.setTag(hideAction);
-                group.postDelayed(hideAction, 5000);
-            } else if (!vis && group.getVisibility() == View.VISIBLE) {
-                group.removeCallbacks((Runnable) group.getTag());
-                group.animate().alpha(0f).setDuration(250).withEndAction(new Runnable() {
-                    @Override
-                    public void run() {
-                        group.setVisibility(View.INVISIBLE);
-                    }
-                });
-            }
-        }
-
-        @Override
-        public void onBindViewHolder(final CatHolder holder, int position) {
-            Context context = holder.itemView.getContext();
-            final int size = context.getResources().getDimensionPixelSize(R.dimen.neko_display_size);
-            holder.imageView.setImageIcon(mCats[position].createIcon(context, size, size));
-            holder.textView.setText(mCats[position].getName());
-            holder.itemView.setOnClickListener(new View.OnClickListener() {
-                @Override
-                public void onClick(View v) {
-                    onCatClick(mCats[holder.getAdapterPosition()]);
-                }
-            });
-            holder.itemView.setOnLongClickListener(new OnLongClickListener() {
-                @Override
-                public boolean onLongClick(View v) {
-                    setContextGroupVisible(holder, true);
-                    return true;
-                }
-            });
-            holder.delete.setOnClickListener(new View.OnClickListener() {
-                @Override
-                public void onClick(View v) {
-                    setContextGroupVisible(holder, false);
-                    new AlertDialog.Builder(NekoLand.this)
-                        .setTitle(getString(R.string.confirm_delete, mCats[position].getName()))
-                        .setNegativeButton(android.R.string.cancel, null)
-                        .setPositiveButton(android.R.string.ok, new DialogInterface.OnClickListener() {
-                            @Override
-                            public void onClick(DialogInterface dialog, int which) {
-                                onCatRemove(mCats[holder.getAdapterPosition()]);
-                            }
-                        })
-                        .show();
-                }
-            });
-            holder.share.setOnClickListener(new View.OnClickListener() {
-                @Override
-                public void onClick(View v) {
-                    setContextGroupVisible(holder, false);
-                    Cat cat = mCats[holder.getAdapterPosition()];
-                    if (checkSelfPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE)
-                            != PackageManager.PERMISSION_GRANTED) {
-                        mPendingShareCat = cat; 
-                        requestPermissions(
-                                new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE},
-                                STORAGE_PERM_REQUEST);
-                        return;
-                    }
-                    shareCat(cat);
-                }
-            });
-        }
-
-        @Override
-        public int getItemCount() {
-            return mCats.length;
-        }
-    }
-
-    private void shareCat(Cat cat) {
-        final File dir = new File(
-                Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES),
-                getString(R.string.directory_name));
-        if (!dir.exists() && !dir.mkdirs()) {
-            Log.e("NekoLand", "save: error: can't create Pictures directory");
-            return;
-        }
-        final File png = new File(dir, cat.getName().replaceAll("[/ #:]+", "_") + ".png");
-        Bitmap bitmap = cat.createBitmap(EXPORT_BITMAP_SIZE, EXPORT_BITMAP_SIZE);
-        if (bitmap != null) {
-            try {
-                OutputStream os = new FileOutputStream(png);
-                bitmap.compress(Bitmap.CompressFormat.PNG, 0, os);
-                os.close();
-                MediaScannerConnection.scanFile(
-                        this,
-                        new String[] {png.toString()},
-                        new String[] {"image/png"},
-                        null);
-                Log.v("Neko", "cat file: " + png);
-                Uri uri = FileProvider.getUriForFile(this, "com.android.egg.fileprovider", png);
-                Log.v("Neko", "cat uri: " + uri);
-                Intent intent = new Intent(Intent.ACTION_SEND);
-                intent.putExtra(Intent.EXTRA_STREAM, uri);
-                intent.putExtra(Intent.EXTRA_SUBJECT, cat.getName());
-                intent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
-                intent.setType("image/png");
-                startActivity(Intent.createChooser(intent, null));
-                cat.logShare(this);
-            } catch (IOException e) {
-                Log.e("NekoLand", "save: error: " + e);
-            }
-        }
-    }
-
-    @Override
-    public void onRequestPermissionsResult(int requestCode,
-                                           String permissions[], int[] grantResults) {
-        if (requestCode == STORAGE_PERM_REQUEST) {
-            if (mPendingShareCat != null) {
-                shareCat(mPendingShareCat);
-                mPendingShareCat = null;
-            }
-        }
-    }
-
-    private static class CatHolder extends RecyclerView.ViewHolder {
-        private final ImageView imageView;
-        private final TextView textView;
-        private final View contextGroup;
-        private final View delete;
-        private final View share;
-
-        public CatHolder(View itemView) {
-            super(itemView);
-            imageView = (ImageView) itemView.findViewById(android.R.id.icon);
-            textView = (TextView) itemView.findViewById(android.R.id.title);
-            contextGroup = itemView.findViewById(R.id.contextGroup);
-            delete = itemView.findViewById(android.R.id.closeButton);
-            share = itemView.findViewById(android.R.id.shareText);
-        }
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/neko/NekoLockedActivity.java b/packages/EasterEgg/src/com/android/egg/neko/NekoLockedActivity.java
deleted file mode 100644
index 5f01da879eb..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/NekoLockedActivity.java
+++ /dev/null
@@ -1,45 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.support.annotation.Nullable;
-import android.app.Activity;
-import android.content.DialogInterface;
-import android.content.DialogInterface.OnDismissListener;
-import android.os.Bundle;
-import android.view.WindowManager;
-
-public class NekoLockedActivity extends Activity implements OnDismissListener {
-
-    private NekoDialog mDialog;
-
-    @Override
-    public void onCreate(@Nullable Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-        getWindow().addFlags(WindowManager.LayoutParams.FLAG_SHOW_WHEN_LOCKED);
-        getWindow().addFlags(WindowManager.LayoutParams.FLAG_DISMISS_KEYGUARD);
-        getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);
-        getWindow().addFlags(WindowManager.LayoutParams.FLAG_TURN_SCREEN_ON);
-
-        mDialog = new NekoDialog(this);
-        mDialog.setOnDismissListener(this);
-        mDialog.show();
-    }
-
-    @Override
-    public void onDismiss(DialogInterface dialog) {
-        finish();
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/neko/NekoService.java b/packages/EasterEgg/src/com/android/egg/neko/NekoService.java
deleted file mode 100644
index 42506e61d2e..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/NekoService.java
+++ /dev/null
@@ -1,165 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.app.Notification;
-import android.app.NotificationChannel;
-import android.app.NotificationManager;
-import android.app.job.JobInfo;
-import android.app.job.JobParameters;
-import android.app.job.JobScheduler;
-import android.app.job.JobService;
-import android.content.ComponentName;
-import android.content.Context;
-import android.net.Uri;
-import android.os.Bundle;
-
-import java.util.List;
-import android.util.Log;
-
-import com.android.egg.R;
-
-import java.util.Random;
-
-import static com.android.egg.neko.Cat.PURR;
-import static com.android.egg.neko.NekoLand.CHAN_ID;
-
-public class NekoService extends JobService {
-
-    private static final String TAG = "NekoService";
-
-    public static int JOB_ID = 42;
-
-    public static int CAT_NOTIFICATION = 1;
-    public static int DEBUG_NOTIFICATION = 1234;
-
-    public static float CAT_CAPTURE_PROB = 1.0f; // generous
-
-    public static long SECONDS = 1000;
-    public static long MINUTES = 60 * SECONDS;
-
-    public static long INTERVAL_FLEX = 5 * MINUTES;
-
-    public static float INTERVAL_JITTER_FRAC = 0.25f;
-
-    private static void setupNotificationChannels(Context context) {
-        NotificationManager noman = context.getSystemService(NotificationManager.class);
-        NotificationChannel eggChan = new NotificationChannel(CHAN_ID,
-                context.getString(R.string.notification_channel_name),
-                NotificationManager.IMPORTANCE_DEFAULT);
-        eggChan.setSound(Uri.EMPTY, Notification.AUDIO_ATTRIBUTES_DEFAULT); // cats are quiet
-        eggChan.setVibrationPattern(PURR); // not totally quiet though
-        eggChan.setBlockableSystem(true); // unlike a real cat, you can push this one off your lap
-        eggChan.setLockscreenVisibility(Notification.VISIBILITY_PUBLIC); // cats sit in the window
-        noman.createNotificationChannel(eggChan);
-    }
-
-    @Override
-    public boolean onStartJob(JobParameters params) {
-        Log.v(TAG, "Starting job: " + String.valueOf(params));
-
-        NotificationManager noman = getSystemService(NotificationManager.class);
-        if (NekoLand.DEBUG_NOTIFICATIONS) {
-            final Bundle extras = new Bundle();
-            extras.putString("android.substName", getString(R.string.notification_name));
-            final int size = getResources()
-                    .getDimensionPixelSize(android.R.dimen.notification_large_icon_width);
-            final Cat cat = Cat.create(this);
-            final Notification.Builder builder
-                    = cat.buildNotification(this)
-                        .setContentTitle("DEBUG")
-                        .setChannel(NekoLand.CHAN_ID)
-                        .setContentText("Ran job: " + params);
-            noman.notify(DEBUG_NOTIFICATION, builder.build());
-        }
-
-        final PrefState prefs = new PrefState(this);
-        int food = prefs.getFoodState();
-        if (food != 0) {
-            prefs.setFoodState(0); // nom
-            final Random rng = new Random();
-            if (rng.nextFloat() <= CAT_CAPTURE_PROB) {
-                Cat cat;
-                List<Cat> cats = prefs.getCats();
-                final int[] probs = getResources().getIntArray(R.array.food_new_cat_prob);
-                final float new_cat_prob = (float)((food < probs.length) ? probs[food] : 50) / 100f;
-
-                if (cats.size() == 0 || rng.nextFloat() <= new_cat_prob) {
-                    cat = Cat.create(this);
-                    prefs.addCat(cat);
-                    cat.logAdd(this);
-                    Log.v(TAG, "A new cat is here: " + cat.getName());
-                } else {
-                    cat = cats.get(rng.nextInt(cats.size()));
-                    Log.v(TAG, "A cat has returned: " + cat.getName());
-                }
-
-                final Notification.Builder builder = cat.buildNotification(this);
-                noman.notify(CAT_NOTIFICATION, builder.build());
-            }
-        }
-        cancelJob(this);
-        return false;
-    }
-
-    @Override
-    public boolean onStopJob(JobParameters jobParameters) {
-        return false;
-    }
-
-    public static void registerJobIfNeeded(Context context, long intervalMinutes) {
-        JobScheduler jss = context.getSystemService(JobScheduler.class);
-        JobInfo info = jss.getPendingJob(JOB_ID);
-        if (info == null) {
-            registerJob(context, intervalMinutes);
-        }
-    }
-
-    public static void registerJob(Context context, long intervalMinutes) {
-        setupNotificationChannels(context);
-
-        JobScheduler jss = context.getSystemService(JobScheduler.class);
-        jss.cancel(JOB_ID);
-        long interval = intervalMinutes * MINUTES;
-        long jitter = (long)(INTERVAL_JITTER_FRAC * interval);
-        interval += (long)(Math.random() * (2 * jitter)) - jitter;
-        final JobInfo jobInfo = new JobInfo.Builder(JOB_ID,
-                new ComponentName(context, NekoService.class))
-                .setPeriodic(interval, INTERVAL_FLEX)
-                .build();
-
-        Log.v(TAG, "A cat will visit in " + interval + "ms: " + String.valueOf(jobInfo));
-        jss.schedule(jobInfo);
-
-        if (NekoLand.DEBUG_NOTIFICATIONS) {
-            NotificationManager noman = context.getSystemService(NotificationManager.class);
-            noman.notify(DEBUG_NOTIFICATION, new Notification.Builder(context)
-                    .setSmallIcon(R.drawable.stat_icon)
-                    .setContentTitle(String.format("Job scheduled in %d min", (interval / MINUTES)))
-                    .setContentText(String.valueOf(jobInfo))
-                    .setPriority(Notification.PRIORITY_MIN)
-                    .setCategory(Notification.CATEGORY_SERVICE)
-                    .setChannel(NekoLand.CHAN_ID)
-                    .setShowWhen(true)
-                    .build());
-        }
-    }
-
-    public static void cancelJob(Context context) {
-        JobScheduler jss = context.getSystemService(JobScheduler.class);
-        Log.v(TAG, "Canceling job");
-        jss.cancel(JOB_ID);
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/neko/NekoTile.java b/packages/EasterEgg/src/com/android/egg/neko/NekoTile.java
deleted file mode 100644
index 159b40a3e5a..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/NekoTile.java
+++ /dev/null
@@ -1,114 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.content.Intent;
-import android.service.quicksettings.Tile;
-import android.service.quicksettings.TileService;
-import android.util.Log;
-
-import com.android.egg.neko.PrefState.PrefsListener;
-import com.android.internal.logging.MetricsLogger;
-
-public class NekoTile extends TileService implements PrefsListener {
-
-    private static final String TAG = "NekoTile";
-
-    private PrefState mPrefs;
-
-    @Override
-    public void onCreate() {
-        super.onCreate();
-        mPrefs = new PrefState(this);
-    }
-
-    @Override
-    public void onStartListening() {
-        super.onStartListening();
-        mPrefs.setListener(this);
-        updateState();
-    }
-
-    @Override
-    public void onStopListening() {
-        super.onStopListening();
-        mPrefs.setListener(null);
-    }
-
-    @Override
-    public void onTileAdded() {
-        super.onTileAdded();
-        MetricsLogger.count(this, "egg_neko_tile_added", 1);
-    }
-
-    @Override
-    public void onTileRemoved() {
-        super.onTileRemoved();
-        MetricsLogger.count(this, "egg_neko_tile_removed", 1);
-    }
-
-    @Override
-    public void onPrefsChanged() {
-        updateState();
-    }
-
-    private void updateState() {
-        Tile tile = getQsTile();
-        int foodState = mPrefs.getFoodState();
-        Food food = new Food(foodState);
-        if (foodState != 0) {
-            NekoService.registerJobIfNeeded(this, food.getInterval(this));
-        }
-        tile.setIcon(food.getIcon(this));
-        tile.setLabel(food.getName(this));
-        tile.setState(foodState != 0 ? Tile.STATE_ACTIVE : Tile.STATE_INACTIVE);
-        tile.updateTile();
-    }
-
-    @Override
-    public void onClick() {
-        if (mPrefs.getFoodState() != 0) {
-            // there's already food loaded, let's empty it
-            MetricsLogger.count(this, "egg_neko_empty_food", 1);
-            mPrefs.setFoodState(0);
-            NekoService.cancelJob(this);
-        } else {
-            // time to feed the cats
-            if (isLocked()) {
-                if (isSecure()) {
-                    Log.d(TAG, "startActivityAndCollapse");
-                    Intent intent = new Intent(this, NekoLockedActivity.class);
-                    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
-                    startActivityAndCollapse(intent);
-                } else {
-                    unlockAndRun(new Runnable() {
-                        @Override
-                        public void run() {
-                            showNekoDialog();
-                        }
-                    });
-                }
-            } else {
-                showNekoDialog();
-            }
-        }
-    }
-
-    private void showNekoDialog() {
-        Log.d(TAG, "showNekoDialog");
-        MetricsLogger.count(this, "egg_neko_select_food", 1);
-        showDialog(new NekoDialog(this));
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/neko/PrefState.java b/packages/EasterEgg/src/com/android/egg/neko/PrefState.java
deleted file mode 100644
index bf71b197d3c..00000000000
--- a/packages/EasterEgg/src/com/android/egg/neko/PrefState.java
+++ /dev/null
@@ -1,92 +0,0 @@
-/*
- * Copyright (C) 2016 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.neko;
-
-import android.content.Context;
-import android.content.SharedPreferences;
-import android.content.SharedPreferences.OnSharedPreferenceChangeListener;
-
-import java.util.ArrayList;
-import java.util.List;
-import java.util.Map;
-
-public class PrefState implements OnSharedPreferenceChangeListener {
-
-    private static final String FILE_NAME = "mPrefs";
-
-    private static final String FOOD_STATE = "food";
-
-    private static final String CAT_KEY_PREFIX = "cat:";
-
-    private final Context mContext;
-    private final SharedPreferences mPrefs;
-    private PrefsListener mListener;
-
-    public PrefState(Context context) {
-        mContext = context;
-        mPrefs = mContext.getSharedPreferences(FILE_NAME, 0);
-    }
-
-    // Can also be used for renaming.
-    public void addCat(Cat cat) {
-        mPrefs.edit()
-              .putString(CAT_KEY_PREFIX + String.valueOf(cat.getSeed()), cat.getName())
-              .apply();
-    }
-
-    public void removeCat(Cat cat) {
-        mPrefs.edit().remove(CAT_KEY_PREFIX + String.valueOf(cat.getSeed())).apply();
-    }
-
-    public List<Cat> getCats() {
-        ArrayList<Cat> cats = new ArrayList<>();
-        Map<String, ?> map = mPrefs.getAll();
-        for (String key : map.keySet()) {
-            if (key.startsWith(CAT_KEY_PREFIX)) {
-                long seed = Long.parseLong(key.substring(CAT_KEY_PREFIX.length()));
-                Cat cat = new Cat(mContext, seed);
-                cat.setName(String.valueOf(map.get(key)));
-                cats.add(cat);
-            }
-        }
-        return cats;
-    }
-
-    public int getFoodState() {
-        return mPrefs.getInt(FOOD_STATE, 0);
-    }
-
-    public void setFoodState(int foodState) {
-        mPrefs.edit().putInt(FOOD_STATE, foodState).apply();
-    }
-
-    public void setListener(PrefsListener listener) {
-        mListener = listener;
-        if (mListener != null) {
-            mPrefs.registerOnSharedPreferenceChangeListener(this);
-        } else {
-            mPrefs.unregisterOnSharedPreferenceChangeListener(this);
-        }
-    }
-
-    @Override
-    public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) {
-        mListener.onPrefsChanged();
-    }
-
-    public interface PrefsListener {
-        void onPrefsChanged();
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/octo/Ocquarium.java b/packages/EasterEgg/src/com/android/egg/octo/Ocquarium.java
deleted file mode 100644
index 8a06cc604f1..00000000000
--- a/packages/EasterEgg/src/com/android/egg/octo/Ocquarium.java
+++ /dev/null
@@ -1,89 +0,0 @@
-/*
- * Copyright (C) 2017 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.octo;
-
-import android.app.Activity;
-import android.os.Bundle;
-import android.view.MotionEvent;
-import android.view.View;
-import android.view.ViewGroup;
-import android.widget.FrameLayout;
-import android.widget.ImageView;
-
-import com.android.egg.R;
-
-public class Ocquarium extends Activity {
-    ImageView mImageView;
-    private OctopusDrawable mOcto;
-
-    @Override
-    protected void onCreate(Bundle savedInstanceState) {
-        super.onCreate(savedInstanceState);
-        final float dp = getResources().getDisplayMetrics().density;
-
-        getWindow().setBackgroundDrawableResource(R.drawable.octo_bg);
-
-        FrameLayout bg = new FrameLayout(this);
-        setContentView(bg);
-        bg.setAlpha(0f);
-        bg.animate().setStartDelay(500).setDuration(5000).alpha(1f).start();
-
-        mImageView = new ImageView(this);
-        bg.addView(mImageView, new FrameLayout.LayoutParams(
-                ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT));
-
-        mOcto = new OctopusDrawable(getApplicationContext());
-        mOcto.setSizePx((int) (OctopusDrawable.randfrange(40f,180f) * dp));
-        mImageView.setImageDrawable(mOcto);
-
-        mImageView.setOnTouchListener(new View.OnTouchListener() {
-            boolean touching;
-            @Override
-            public boolean onTouch(View view, MotionEvent motionEvent) {
-                switch (motionEvent.getActionMasked()) {
-                    case MotionEvent.ACTION_DOWN:
-                        if (mOcto.hitTest(motionEvent.getX(), motionEvent.getY())) {
-                            touching = true;
-                            mOcto.stopDrift();
-                        }
-                        break;
-                    case MotionEvent.ACTION_MOVE:
-                        if (touching) {
-                            mOcto.moveTo(motionEvent.getX(), motionEvent.getY());
-                        }
-                        break;
-                    case MotionEvent.ACTION_UP:
-                    case MotionEvent.ACTION_CANCEL:
-                        touching = false;
-                        mOcto.startDrift();
-                        break;
-                }
-                return true;
-            }
-        });
-    }
-
-    @Override
-    protected void onPause() {
-        mOcto.stopDrift();
-        super.onPause();
-    }
-
-    @Override
-    protected void onResume() {
-        super.onResume();
-        mOcto.startDrift();
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/octo/OctopusDrawable.java b/packages/EasterEgg/src/com/android/egg/octo/OctopusDrawable.java
deleted file mode 100644
index 5dde6e11526..00000000000
--- a/packages/EasterEgg/src/com/android/egg/octo/OctopusDrawable.java
+++ /dev/null
@@ -1,436 +0,0 @@
-/*
- * Copyright (C) 2017 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.octo;
-
-import android.animation.TimeAnimator;
-import android.content.Context;
-import android.graphics.Canvas;
-import android.graphics.ColorFilter;
-import android.graphics.DashPathEffect;
-import android.graphics.Matrix;
-import android.graphics.Paint;
-import android.graphics.Path;
-import android.graphics.PixelFormat;
-import android.graphics.PointF;
-import android.graphics.Rect;
-import android.graphics.drawable.Drawable;
-import android.support.animation.DynamicAnimation;
-import android.support.animation.SpringForce;
-import android.support.annotation.NonNull;
-import android.support.annotation.Nullable;
-import android.support.animation.SpringAnimation;
-import android.support.animation.FloatValueHolder;
-
-public class OctopusDrawable extends Drawable {
-    private static float BASE_SCALE = 100f;
-    public static boolean PATH_DEBUG = false;
-
-    private static int BODY_COLOR   = 0xFF101010;
-    private static int ARM_COLOR    = 0xFF101010;
-    private static int ARM_COLOR_BACK = 0xFF000000;
-    private static int EYE_COLOR    = 0xFF808080;
-
-    private static int[] BACK_ARMS = {1, 3, 4, 6};
-    private static int[] FRONT_ARMS = {0, 2, 5, 7};
-
-    private Paint mPaint = new Paint();
-    private Arm[] mArms = new Arm[8];
-    final PointF point = new PointF();
-    private int mSizePx = 100;
-    final Matrix M = new Matrix();
-    final Matrix M_inv = new Matrix();
-    private TimeAnimator mDriftAnimation;
-    private boolean mBlinking;
-    private float[] ptmp = new float[2];
-    private float[] scaledBounds = new float[2];
-
-    public static float randfrange(float a, float b) {
-        return (float) (Math.random()*(b-a) + a);
-    }
-    public static float clamp(float v, float a, float b) {
-        return v<a?a:v>b?b:v;
-    }
-
-    public OctopusDrawable(Context context) {
-        float dp = context.getResources().getDisplayMetrics().density;
-        setSizePx((int) (100*dp));
-        mPaint.setAntiAlias(true);
-        for (int i=0; i<mArms.length; i++) {
-            final float bias = (float)i/(mArms.length-1) - 0.5f;
-            mArms[i] = new Arm(
-                    0,0, // arm will be repositioned on moveTo
-                    10f*bias + randfrange(0,20f), randfrange(20f,50f),
-                    40f*bias+randfrange(-60f,60f), randfrange(30f, 80f),
-                    randfrange(-40f,40f), randfrange(-80f,40f),
-                    14f, 2f);
-        }
-    }
-
-    public void setSizePx(int size) {
-        mSizePx = size;
-        M.setScale(mSizePx/BASE_SCALE, mSizePx/BASE_SCALE);
-        // TaperedPathStroke.setMinStep(20f*BASE_SCALE/mSizePx); // nice little floaty circles
-        TaperedPathStroke.setMinStep(8f*BASE_SCALE/mSizePx); // classic tentacles
-        M.invert(M_inv);
-    }
-
-    public void startDrift() {
-        if (mDriftAnimation == null) {
-            mDriftAnimation = new TimeAnimator();
-            mDriftAnimation.setTimeListener(new TimeAnimator.TimeListener() {
-                float MAX_VY = 35f;
-                float JUMP_VY = -100f;
-                float MAX_VX = 15f;
-                private float ax = 0f, ay = 30f;
-                private float vx, vy;
-                long nextjump = 0;
-                long unblink = 0;
-                @Override
-                public void onTimeUpdate(TimeAnimator timeAnimator, long t, long dt) {
-                    float t_sec = 0.001f * t;
-                    float dt_sec = 0.001f * dt;
-                    if (t > nextjump) {
-                        vy = JUMP_VY;
-                        nextjump = t + (long) randfrange(5000, 10000);
-                    }
-                    if (unblink > 0 && t > unblink) {
-                        setBlinking(false);
-                        unblink = 0;
-                    } else if (Math.random() < 0.001f) {
-                        setBlinking(true);
-                        unblink = t + 200;
-                    }
-
-                    ax = (float) (MAX_VX * Math.sin(t_sec*.25f));
-
-                    vx = clamp(vx + dt_sec * ax, -MAX_VX, MAX_VX);
-                    vy = clamp(vy + dt_sec * ay, -100*MAX_VY, MAX_VY);
-
-                    // oob check
-                    if (point.y - BASE_SCALE/2 > scaledBounds[1]) {
-                        vy = JUMP_VY;
-                    } else if (point.y + BASE_SCALE < 0) {
-                        vy = MAX_VY;
-                    }
-
-                    point.x = clamp(point.x + dt_sec * vx, 0, scaledBounds[0]);
-                    point.y = point.y + dt_sec * vy;
-
-                    repositionArms();
-               }
-            });
-        }
-        mDriftAnimation.start();
-    }
-
-    public void stopDrift() {
-        mDriftAnimation.cancel();
-    }
-
-    @Override
-    public void onBoundsChange(Rect bounds) {
-        final float w = bounds.width();
-        final float h = bounds.height();
-
-        lockArms(true);
-        moveTo(w/2, h/2);
-        lockArms(false);
-
-        scaledBounds[0] = w;
-        scaledBounds[1] = h;
-        M_inv.mapPoints(scaledBounds);
-    }
-
-    // real pixel coordinates
-    public void moveTo(float x, float y) {
-        point.x = x;
-        point.y = y;
-        mapPointF(M_inv, point);
-        repositionArms();
-    }
-
-    public boolean hitTest(float x, float y) {
-        ptmp[0] = x;
-        ptmp[1] = y;
-        M_inv.mapPoints(ptmp);
-        return Math.hypot(ptmp[0] - point.x, ptmp[1] - point.y) < BASE_SCALE/2;
-    }
-
-    private void lockArms(boolean l) {
-        for (Arm arm : mArms) {
-            arm.setLocked(l);
-        }
-    }
-    private void repositionArms() {
-        for (int i=0; i<mArms.length; i++) {
-            final float bias = (float)i/(mArms.length-1) - 0.5f;
-            mArms[i].setAnchor(
-                    point.x+bias*30f,point.y+26f);
-        }
-        invalidateSelf();
-    }
-
-    private void drawPupil(Canvas canvas, float x, float y, float size, boolean open,
-            Paint pt) {
-        final float r = open ? size*.33f : size * .1f;
-        canvas.drawRoundRect(x - size, y - r, x + size, y + r, r, r, pt);
-    }
-
-    @Override
-    public void draw(@NonNull Canvas canvas) {
-        canvas.save();
-        {
-            canvas.concat(M);
-
-            // arms behind
-            mPaint.setColor(ARM_COLOR_BACK);
-            for (int i : BACK_ARMS) {
-                mArms[i].draw(canvas, mPaint);
-            }
-
-            // head/body/thing
-            mPaint.setColor(EYE_COLOR);
-            canvas.drawCircle(point.x, point.y, 36f, mPaint);
-            mPaint.setColor(BODY_COLOR);
-            canvas.save();
-            {
-                canvas.clipOutRect(point.x - 61f, point.y + 8f,
-                        point.x + 61f, point.y + 12f);
-                canvas.drawOval(point.x-40f,point.y-60f,point.x+40f,point.y+40f, mPaint);
-            }
-            canvas.restore();
-
-            // eyes
-            mPaint.setColor(EYE_COLOR);
-            if (mBlinking) {
-                drawPupil(canvas, point.x - 16f, point.y - 12f, 6f, false, mPaint);
-                drawPupil(canvas, point.x + 16f, point.y - 12f, 6f, false, mPaint);
-            } else {
-                canvas.drawCircle(point.x - 16f, point.y - 12f, 6f, mPaint);
-                canvas.drawCircle(point.x + 16f, point.y - 12f, 6f, mPaint);
-            }
-
-            // too much?
-            if (false) {
-                mPaint.setColor(0xFF000000);
-                drawPupil(canvas, point.x - 16f, point.y - 12f, 5f, true, mPaint);
-                drawPupil(canvas, point.x + 16f, point.y - 12f, 5f, true, mPaint);
-            }
-
-            // arms in front
-            mPaint.setColor(ARM_COLOR);
-            for (int i : FRONT_ARMS) {
-                mArms[i].draw(canvas, mPaint);
-            }
-
-            if (PATH_DEBUG) for (Arm arm : mArms) {
-                arm.drawDebug(canvas);
-            }
-        }
-        canvas.restore();
-    }
-
-    public void setBlinking(boolean b) {
-        mBlinking = b;
-        invalidateSelf();
-    }
-
-    @Override
-    public void setAlpha(int i) {
-    }
-
-    @Override
-    public void setColorFilter(@Nullable ColorFilter colorFilter) {
-
-    }
-
-    @Override
-    public int getOpacity() {
-        return PixelFormat.TRANSLUCENT;
-    }
-
-    static Path pathMoveTo(Path p, PointF pt) {
-        p.moveTo(pt.x, pt.y);
-        return p;
-    }
-    static Path pathQuadTo(Path p, PointF p1, PointF p2) {
-        p.quadTo(p1.x, p1.y, p2.x, p2.y);
-        return p;
-    }
-
-    static void mapPointF(Matrix m, PointF point) {
-        float[] p = new float[2];
-        p[0] = point.x;
-        p[1] = point.y;
-        m.mapPoints(p);
-        point.x = p[0];
-        point.y = p[1];
-    }
-
-    private class Link  // he come to town
-            implements DynamicAnimation.OnAnimationUpdateListener {
-        final FloatValueHolder[] coords = new FloatValueHolder[2];
-        final SpringAnimation[] anims = new SpringAnimation[coords.length];
-        private float dx, dy;
-        private boolean locked = false;
-        Link next;
-
-        Link(int index, float x1, float y1, float dx, float dy) {
-            coords[0] = new FloatValueHolder(x1);
-            coords[1] = new FloatValueHolder(y1);
-            this.dx = dx;
-            this.dy = dy;
-            for (int i=0; i<coords.length; i++) {
-                anims[i] = new SpringAnimation(coords[i]);
-                anims[i].setSpring(new SpringForce()
-                        .setDampingRatio(SpringForce.DAMPING_RATIO_LOW_BOUNCY)
-                        .setStiffness(
-                                index == 0 ? SpringForce.STIFFNESS_LOW
-                                        : index == 1 ? SpringForce.STIFFNESS_VERY_LOW
-                                                : SpringForce.STIFFNESS_VERY_LOW/2)
-                        .setFinalPosition(0f));
-                anims[i].addUpdateListener(this);
-            }
-        }
-        public void setLocked(boolean locked) {
-            this.locked = locked;
-        }
-        public PointF start() {
-            return new PointF(coords[0].getValue(), coords[1].getValue());
-        }
-        public PointF end() {
-            return new PointF(coords[0].getValue()+dx,coords[1].getValue()+dy);
-        }
-        public PointF mid() {
-            return new PointF(
-                    0.5f*dx+(coords[0].getValue()),
-                    0.5f*dy+(coords[1].getValue()));
-        }
-        public void animateTo(PointF target) {
-            if (locked) {
-                setStart(target.x, target.y);
-            } else {
-                anims[0].animateToFinalPosition(target.x);
-                anims[1].animateToFinalPosition(target.y);
-            }
-        }
-        @Override
-        public void onAnimationUpdate(DynamicAnimation dynamicAnimation, float v, float v1) {
-            if (next != null) {
-                next.animateTo(end());
-            }
-            OctopusDrawable.this.invalidateSelf();
-        }
-
-        public void setStart(float x, float y) {
-            coords[0].setValue(x);
-            coords[1].setValue(y);
-            onAnimationUpdate(null, 0, 0);
-        }
-    }
-
-    private class Arm {
-        final Link link1, link2, link3;
-        float max, min;
-
-        public Arm(float x, float y, float dx1, float dy1, float dx2, float dy2, float dx3, float dy3,
-                float max, float min) {
-            link1 = new Link(0, x, y, dx1, dy1);
-            link2 = new Link(1, x+dx1, y+dy1, dx2, dy2);
-            link3 = new Link(2, x+dx1+dx2, y+dy1+dy2, dx3, dy3);
-            link1.next = link2;
-            link2.next = link3;
-
-            link1.setLocked(true);
-            link2.setLocked(false);
-            link3.setLocked(false);
-
-            this.max = max;
-            this.min = min;
-        }
-
-        // when the arm is locked, it moves rigidly, without physics
-        public void setLocked(boolean locked) {
-            link2.setLocked(locked);
-            link3.setLocked(locked);
-        }
-
-        private void setAnchor(float x, float y) {
-            link1.setStart(x,y);
-        }
-
-        public Path getPath() {
-            Path p = new Path();
-            pathMoveTo(p, link1.start());
-            pathQuadTo(p, link2.start(), link2.mid());
-            pathQuadTo(p, link2.end(), link3.end());
-            return p;
-        }
-
-        public void draw(@NonNull Canvas canvas, Paint pt) {
-            final Path p = getPath();
-            TaperedPathStroke.drawPath(canvas, p, max, min, pt);
-        }
-
-        private final Paint dpt = new Paint();
-        public void drawDebug(Canvas canvas) {
-            dpt.setStyle(Paint.Style.STROKE);
-            dpt.setStrokeWidth(0.75f);
-            dpt.setStrokeCap(Paint.Cap.ROUND);
-
-            dpt.setAntiAlias(true);
-            dpt.setColor(0xFF336699);
-
-            final Path path = getPath();
-            canvas.drawPath(path, dpt);
-
-            dpt.setColor(0xFFFFFF00);
-
-            dpt.setPathEffect(new DashPathEffect(new float[] {2f, 2f}, 0f));
-
-            canvas.drawLines(new float[] {
-                    link1.end().x,   link1.end().y,
-                    link2.start().x, link2.start().y,
-
-                    link2.end().x,   link2.end().y,
-                    link3.start().x, link3.start().y,
-            }, dpt);
-            dpt.setPathEffect(null);
-
-            dpt.setColor(0xFF00CCFF);
-
-            canvas.drawLines(new float[] {
-                    link1.start().x, link1.start().y,
-                    link1.end().x,   link1.end().y,
-
-                    link2.start().x, link2.start().y,
-                    link2.end().x,   link2.end().y,
-
-                    link3.start().x, link3.start().y,
-                    link3.end().x,   link3.end().y,
-            }, dpt);
-
-            dpt.setColor(0xFFCCEEFF);
-            canvas.drawCircle(link2.start().x, link2.start().y, 2f, dpt);
-            canvas.drawCircle(link3.start().x, link3.start().y, 2f, dpt);
-
-            dpt.setStyle(Paint.Style.FILL_AND_STROKE);
-            canvas.drawCircle(link1.start().x, link1.start().y, 2f, dpt);
-            canvas.drawCircle(link2.mid().x,   link2.mid().y,   2f, dpt);
-            canvas.drawCircle(link3.end().x,   link3.end().y,   2f, dpt);
-        }
-
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/octo/TaperedPathStroke.java b/packages/EasterEgg/src/com/android/egg/octo/TaperedPathStroke.java
deleted file mode 100644
index e014fbc2559..00000000000
--- a/packages/EasterEgg/src/com/android/egg/octo/TaperedPathStroke.java
+++ /dev/null
@@ -1,55 +0,0 @@
-/*
- * Copyright (C) 2017 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
- * except in compliance with the License. You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software distributed under the
- * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language governing
- * permissions and limitations under the License.
- */
-
-package com.android.egg.octo;
-
-import android.graphics.Canvas;
-import android.graphics.Paint;
-import android.graphics.Path;
-import android.graphics.PathMeasure;
-import android.os.Debug;
-
-import java.util.Arrays;
-
-public class TaperedPathStroke {
-    static float sMinStepPx = 4f;
-    static PathMeasure pm = new PathMeasure();
-    static float[] pos = {0,0};
-    static float[] tan = {0,0};
-    static float lerp(float t, float a, float b) {
-        return a + t*(b-a);
-    }
-    public static void setMinStep(float px) {
-        sMinStepPx = px;
-    }
-
-    // it's the variable-width brush algorithm from the Markers app, basically
-    public static void drawPath(Canvas c, Path p, float r1, float r2, Paint pt) {
-        pm.setPath(p,false);
-        final float len = pm.getLength();
-        float t=0;
-        boolean last=false;
-        while (true) {
-            if (t>=len) {
-                t=len;
-                last=true;
-            }
-            pm.getPosTan(t, pos, tan);
-            float r = len > 0 ? lerp(t/len, r1, r2) : r1;
-            c.drawCircle(pos[0], pos[1], r, pt);
-            t += Math.max(r*0.25f, sMinStepPx); // walk forward 1/4 radius, not too small though
-            if (last) break;
-        }
-    }
-}
diff --git a/packages/EasterEgg/src/com/android/egg/paint/BrushPropertyDrawable.kt b/packages/EasterEgg/src/com/android/egg/paint/BrushPropertyDrawable.kt
new file mode 100644
index 00000000000..4a02ee688cf
--- /dev/null
+++ b/packages/EasterEgg/src/com/android/egg/paint/BrushPropertyDrawable.kt
@@ -0,0 +1,93 @@
+/*
+ * Copyright (C) 2018 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.egg.paint
+
+import android.content.Context
+import android.graphics.*
+import android.graphics.PixelFormat.TRANSLUCENT
+import android.graphics.drawable.Drawable
+import android.util.DisplayMetrics
+
+class BrushPropertyDrawable : Drawable {
+    val framePaint = Paint(Paint.ANTI_ALIAS_FLAG).also {
+        it.color = Color.BLACK
+        it.style = Paint.Style.FILL
+    }
+    val wellPaint = Paint(Paint.ANTI_ALIAS_FLAG).also {
+        it.color = Color.RED
+        it.style = Paint.Style.FILL
+    }
+
+    constructor(context: Context) {
+        _size = (24 * context.resources.displayMetrics.density).toInt()
+    }
+
+    private var _size = 24
+    private var _scale = 1f
+
+    fun setFrameColor(color: Int) {
+        framePaint.color = color
+        invalidateSelf()
+    }
+
+    fun setWellColor(color: Int) {
+        wellPaint.color = color
+        invalidateSelf()
+    }
+
+    fun setWellScale(scale: Float) {
+        _scale = scale
+        invalidateSelf()
+    }
+
+    override fun getIntrinsicWidth(): Int {
+        return _size
+    }
+
+    override fun getIntrinsicHeight(): Int {
+        return _size
+    }
+
+    override fun draw(c: Canvas?) {
+        c?.let {
+            val w = bounds.width().toFloat()
+            val h = bounds.height().toFloat()
+            val inset = _size / 12 // 2dp in a 24x24 icon
+            val r = Math.min(w, h) / 2
+
+            c.drawCircle(w/2, h/2, (r - inset) * _scale + 1 , wellPaint)
+
+            val p = Path()
+            p.addCircle(w/2, h/2, r, Path.Direction.CCW)
+            p.addCircle(w/2, h/2, r - inset, Path.Direction.CW)
+            c.drawPath(p, framePaint)
+        }
+    }
+
+    override fun setAlpha(p0: Int) {
+        //
+    }
+
+    override fun getOpacity(): Int {
+        return TRANSLUCENT
+    }
+
+    override fun setColorFilter(p0: ColorFilter?) {
+        //
+    }
+
+}
\ No newline at end of file
diff --git a/packages/EasterEgg/src/com/android/egg/paint/CutoutAvoidingToolbar.kt b/packages/EasterEgg/src/com/android/egg/paint/CutoutAvoidingToolbar.kt
new file mode 100644
index 00000000000..164fc5a5af3
--- /dev/null
+++ b/packages/EasterEgg/src/com/android/egg/paint/CutoutAvoidingToolbar.kt
@@ -0,0 +1,88 @@
+/*
+ * Copyright (C) 2018 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.egg.paint
+
+import android.content.Context
+import android.util.AttributeSet
+import android.view.*
+import android.view.ViewGroup.LayoutParams.MATCH_PARENT
+import android.widget.LinearLayout
+
+class CutoutAvoidingToolbar : LinearLayout {
+    private var _insets: WindowInsets? = null
+
+    constructor(context: Context) : super(context) {
+        init(null, 0)
+    }
+
+    constructor(context: Context, attrs: AttributeSet) : super(context, attrs) {
+        init(attrs, 0)
+    }
+
+    constructor(context: Context, attrs: AttributeSet, defStyle: Int) : super(context, attrs, defStyle) {
+        init(attrs, defStyle)
+    }
+
+    override fun onSizeChanged(w: Int, h: Int, oldw: Int, oldh: Int) {
+        super.onSizeChanged(w, h, oldw, oldh)
+        adjustLayout()
+    }
+
+    override fun onApplyWindowInsets(insets: WindowInsets?): WindowInsets {
+        _insets = insets
+        adjustLayout()
+        return super.onApplyWindowInsets(insets)
+    }
+
+    fun adjustLayout() {
+        _insets?.displayCutout?.boundingRects?.let {
+            var cutoutCenter = 0
+            var cutoutLeft = 0
+            var cutoutRight = 0
+
+            // collect at most three cutouts
+            for (r in it) {
+                if (r.top > 0) continue
+
+                if (r.left == left) {
+                    cutoutLeft = r.width()
+                } else if (r.right == right) {
+                    cutoutRight = r.width()
+                } else {
+                    cutoutCenter = r.width()
+                }
+            }
+
+            // apply to layout
+            (findViewWithTag("cutoutLeft") as View?)?.let {
+                it.layoutParams = LayoutParams(cutoutLeft, MATCH_PARENT)
+            }
+            (findViewWithTag("cutoutCenter") as View?)?.let {
+                it.layoutParams = LayoutParams(cutoutCenter, MATCH_PARENT)
+            }
+            (findViewWithTag("cutoutRight") as View?)?.let {
+                it.layoutParams = LayoutParams(cutoutRight, MATCH_PARENT)
+            }
+
+            requestLayout()
+        }
+    }
+
+    private fun init(attrs: AttributeSet?, defStyle: Int) {
+    }
+
+}
diff --git a/packages/EasterEgg/src/com/android/egg/paint/PaintActivity.java b/packages/EasterEgg/src/com/android/egg/paint/PaintActivity.java
new file mode 100644
index 00000000000..ac47fbda09c
--- /dev/null
+++ b/packages/EasterEgg/src/com/android/egg/paint/PaintActivity.java
@@ -0,0 +1,351 @@
+/*
+ * Copyright (C) 2018 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.egg.paint;
+
+import static android.view.MotionEvent.ACTION_CANCEL;
+import static android.view.MotionEvent.ACTION_DOWN;
+import static android.view.MotionEvent.ACTION_MOVE;
+import static android.view.MotionEvent.ACTION_UP;
+
+import android.app.Activity;
+import android.content.res.Configuration;
+import android.graphics.Bitmap;
+import android.graphics.Color;
+import android.os.Bundle;
+import android.view.MotionEvent;
+import android.view.View;
+import android.view.ViewGroup;
+import android.view.WindowManager;
+import android.view.animation.OvershootInterpolator;
+import android.widget.FrameLayout;
+import android.widget.ImageButton;
+import android.widget.LinearLayout;
+import android.widget.Magnifier;
+
+import com.android.egg.R;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Collections;
+import java.util.stream.IntStream;
+
+public class PaintActivity extends Activity {
+    private static final float MAX_BRUSH_WIDTH_DP = 100f;
+    private static final float MIN_BRUSH_WIDTH_DP = 1f;
+
+    private static final int NUM_BRUSHES = 6;
+    private static final int NUM_COLORS = 6;
+
+    private Painting painting = null;
+    private CutoutAvoidingToolbar toolbar = null;
+    private LinearLayout brushes = null;
+    private LinearLayout colors = null;
+    private Magnifier magnifier = null;
+    private boolean sampling = false;
+
+    private View.OnClickListener buttonHandler = new View.OnClickListener() {
+        @Override
+        public void onClick(View view) {
+            switch (view.getId()) {
+                case R.id.btnBrush:
+                    view.setSelected(true);
+                    hideToolbar(colors);
+                    toggleToolbar(brushes);
+                    break;
+                case R.id.btnColor:
+                    view.setSelected(true);
+                    hideToolbar(brushes);
+                    toggleToolbar(colors);
+                    break;
+                case R.id.btnClear:
+                    painting.clear();
+                    break;
+                case R.id.btnSample:
+                    sampling = true;
+                    view.setSelected(true);
+                    break;
+                case R.id.btnZen:
+                    painting.setZenMode(!painting.getZenMode());
+                    view.animate()
+                            .setStartDelay(200)
+                            .setInterpolator(new OvershootInterpolator())
+                            .rotation(painting.getZenMode() ? 0f : 90f);
+                    break;
+            }
+        }
+    };
+
+    private void showToolbar(View bar) {
+        if (bar.getVisibility() != View.GONE) return;
+        bar.setVisibility(View.VISIBLE);
+        bar.setTranslationY(toolbar.getHeight()/2);
+        bar.animate()
+                .translationY(toolbar.getHeight())
+                .alpha(1f)
+                .setDuration(220)
+                .start();
+    }
+
+    private void hideToolbar(View bar) {
+        if (bar.getVisibility() != View.VISIBLE) return;
+        bar.animate()
+                .translationY(toolbar.getHeight()/2)
+                .alpha(0f)
+                .setDuration(150)
+                .withEndAction(new Runnable() {
+                    @Override
+                    public void run() {
+                        bar.setVisibility(View.GONE);
+                    }
+                })
+                .start();
+    }
+
+    private void toggleToolbar(View bar) {
+        if (bar.getVisibility() == View.VISIBLE) {
+            hideToolbar(bar);
+        } else {
+            showToolbar(bar);
+        }
+    }
+
+    private BrushPropertyDrawable widthButtonDrawable;
+    private BrushPropertyDrawable colorButtonDrawable;
+    private float maxBrushWidth, minBrushWidth;
+    private int nightMode = Configuration.UI_MODE_NIGHT_UNDEFINED;
+
+    static final float lerp(float f, float a, float b) {
+        return a + (b-a) * f;
+    }
+
+    void setupViews(Painting oldPainting) {
+        setContentView(R.layout.activity_paint);
+
+        painting = oldPainting != null ? oldPainting : new Painting(this);
+        ((FrameLayout) findViewById(R.id.contentView)).addView(painting,
+                new FrameLayout.LayoutParams(
+                        ViewGroup.LayoutParams.MATCH_PARENT,
+                        ViewGroup.LayoutParams.MATCH_PARENT));
+
+        painting.setPaperColor(getColor(R.color.paper_color));
+        painting.setPaintColor(getColor(R.color.paint_color));
+
+        toolbar = findViewById(R.id.toolbar);
+        brushes = findViewById(R.id.brushes);
+        colors = findViewById(R.id.colors);
+
+        magnifier = new Magnifier(painting);
+
+        painting.setOnTouchListener(
+                new View.OnTouchListener() {
+                    @Override
+                    public boolean onTouch(View view, MotionEvent event) {
+                        switch (event.getActionMasked()) {
+                            case ACTION_DOWN:
+                            case ACTION_MOVE:
+                                if (sampling) {
+                                    magnifier.show(event.getX(), event.getY());
+                                    colorButtonDrawable.setWellColor(
+                                            painting.sampleAt(event.getX(), event.getY()));
+                                    return true;
+                                }
+                                break;
+                            case ACTION_CANCEL:
+                                if (sampling) {
+                                    findViewById(R.id.btnSample).setSelected(false);
+                                    sampling = false;
+                                    magnifier.dismiss();
+                                }
+                                break;
+                            case ACTION_UP:
+                                if (sampling) {
+                                    findViewById(R.id.btnSample).setSelected(false);
+                                    sampling = false;
+                                    magnifier.dismiss();
+                                    painting.setPaintColor(
+                                            painting.sampleAt(event.getX(), event.getY()));
+                                    refreshBrushAndColor();
+                                }
+                                break;
+                        }
+                        return false; // allow view to continue handling
+                    }
+                });
+
+        findViewById(R.id.btnBrush).setOnClickListener(buttonHandler);
+        findViewById(R.id.btnColor).setOnClickListener(buttonHandler);
+        findViewById(R.id.btnClear).setOnClickListener(buttonHandler);
+        findViewById(R.id.btnSample).setOnClickListener(buttonHandler);
+        findViewById(R.id.btnZen).setOnClickListener(buttonHandler);
+
+        findViewById(R.id.btnColor).setOnLongClickListener(new View.OnLongClickListener() {
+            @Override
+            public boolean onLongClick(View view) {
+                colors.removeAllViews();
+                showToolbar(colors);
+                refreshBrushAndColor();
+                return true;
+            }
+        });
+
+        findViewById(R.id.btnClear).setOnLongClickListener(new View.OnLongClickListener() {
+            @Override
+            public boolean onLongClick(View view) {
+                painting.invertContents();
+                return true;
+            }
+        });
+
+        widthButtonDrawable = new BrushPropertyDrawable(this);
+        widthButtonDrawable.setFrameColor(getColor(R.color.toolbar_icon_color));
+        colorButtonDrawable = new BrushPropertyDrawable(this);
+        colorButtonDrawable.setFrameColor(getColor(R.color.toolbar_icon_color));
+
+        ((ImageButton) findViewById(R.id.btnBrush)).setImageDrawable(widthButtonDrawable);
+        ((ImageButton) findViewById(R.id.btnColor)).setImageDrawable(colorButtonDrawable);
+
+        refreshBrushAndColor();
+    }
+
+    private void refreshBrushAndColor() {
+        final LinearLayout.LayoutParams button_lp = new LinearLayout.LayoutParams(
+                0, ViewGroup.LayoutParams.WRAP_CONTENT);
+        button_lp.weight = 1f;
+        if (brushes.getChildCount() == 0) {
+            for (int i = 0; i < NUM_BRUSHES; i++) {
+                final BrushPropertyDrawable icon = new BrushPropertyDrawable(this);
+                icon.setFrameColor(getColor(R.color.toolbar_icon_color));
+                // exponentially increasing brush size
+                final float width = lerp(
+                        (float) Math.pow((float) i / NUM_BRUSHES, 2f), minBrushWidth,
+                        maxBrushWidth);
+                icon.setWellScale(width / maxBrushWidth);
+                icon.setWellColor(getColor(R.color.toolbar_icon_color));
+                final ImageButton button = new ImageButton(this);
+                button.setImageDrawable(icon);
+                button.setBackground(getDrawable(R.drawable.toolbar_button_bg));
+                button.setOnClickListener(
+                        new View.OnClickListener() {
+                            @Override
+                            public void onClick(View view) {
+                                brushes.setSelected(false);
+                                hideToolbar(brushes);
+                                painting.setBrushWidth(width);
+                                refreshBrushAndColor();
+                            }
+                        });
+                brushes.addView(button, button_lp);
+            }
+        }
+
+        if (colors.getChildCount() == 0) {
+            final Palette pal = new Palette(NUM_COLORS);
+            for (final int c : IntStream.concat(
+                    IntStream.of(Color.BLACK, Color.WHITE),
+                    Arrays.stream(pal.getColors())
+            ).toArray()) {
+                final BrushPropertyDrawable icon = new BrushPropertyDrawable(this);
+                icon.setFrameColor(getColor(R.color.toolbar_icon_color));
+                icon.setWellColor(c);
+                final ImageButton button = new ImageButton(this);
+                button.setImageDrawable(icon);
+                button.setBackground(getDrawable(R.drawable.toolbar_button_bg));
+                button.setOnClickListener(
+                    new View.OnClickListener() {
+                        @Override
+                        public void onClick(View view) {
+                            colors.setSelected(false);
+                            hideToolbar(colors);
+                            painting.setPaintColor(c);
+                            refreshBrushAndColor();
+                        }
+                    });
+                colors.addView(button, button_lp);
+            }
+        }
+
+        widthButtonDrawable.setWellScale(painting.getBrushWidth() / maxBrushWidth);
+        widthButtonDrawable.setWellColor(painting.getPaintColor());
+        colorButtonDrawable.setWellColor(painting.getPaintColor());
+    }
+
+    private void refreshNightMode(Configuration config) {
+        int newNightMode =
+                (config.uiMode & Configuration.UI_MODE_NIGHT_MASK);
+        if (nightMode != newNightMode) {
+            if (nightMode != Configuration.UI_MODE_NIGHT_UNDEFINED) {
+                painting.invertContents();
+
+                ((ViewGroup) painting.getParent()).removeView(painting);
+                setupViews(painting);
+
+                final View decorView = getWindow().getDecorView();
+                int decorSUIV = decorView.getSystemUiVisibility();
+
+                if (newNightMode == Configuration.UI_MODE_NIGHT_YES) {
+                    decorView.setSystemUiVisibility(
+                            decorSUIV & ~View.SYSTEM_UI_FLAG_LIGHT_NAVIGATION_BAR);
+                } else {
+                    decorView.setSystemUiVisibility(
+                            decorSUIV | View.SYSTEM_UI_FLAG_LIGHT_NAVIGATION_BAR);
+                }
+            }
+            nightMode = newNightMode;
+        }
+    }
+
+    public PaintActivity() {
+
+    }
+
+    @Override
+    public void onTrimMemory(int level) {
+        super.onTrimMemory(level);
+
+        painting.onTrimMemory();
+    }
+
+    @Override
+    public void onConfigurationChanged(Configuration newConfig) {
+        super.onConfigurationChanged(newConfig);
+
+        refreshNightMode(newConfig);
+    }
+
+    @Override
+    public void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+
+        WindowManager.LayoutParams lp = getWindow().getAttributes();
+        lp.flags = lp.flags
+                | WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN
+                | WindowManager.LayoutParams.FLAG_LAYOUT_NO_LIMITS;
+        getWindow().setAttributes(lp);
+
+        maxBrushWidth = MAX_BRUSH_WIDTH_DP * getResources().getDisplayMetrics().density;
+        minBrushWidth = MIN_BRUSH_WIDTH_DP * getResources().getDisplayMetrics().density;
+
+        setupViews(null);
+        refreshNightMode(getResources().getConfiguration());
+    }
+
+    @Override
+    public void onPostResume() {
+        super.onPostResume();
+    }
+
+}
diff --git a/packages/EasterEgg/src/com/android/egg/paint/Painting.kt b/packages/EasterEgg/src/com/android/egg/paint/Painting.kt
new file mode 100644
index 00000000000..a4a3d3d835e
--- /dev/null
+++ b/packages/EasterEgg/src/com/android/egg/paint/Painting.kt
@@ -0,0 +1,358 @@
+/*
+ * Copyright (C) 2018 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.egg.paint
+
+import android.content.Context
+import android.content.res.Resources
+import android.graphics.*
+import android.provider.Settings
+import android.util.AttributeSet
+import android.util.DisplayMetrics
+import android.view.MotionEvent
+import android.view.View
+import android.view.WindowInsets
+import java.util.concurrent.TimeUnit
+import android.util.Log
+import android.provider.Settings.System
+
+import org.json.JSONObject
+
+fun hypot(x: Float, y: Float): Float {
+    return Math.hypot(x.toDouble(), y.toDouble()).toFloat()
+}
+
+fun invlerp(x: Float, a: Float, b: Float): Float {
+    return if (b > a) {
+        (x - a) / (b - a)
+    } else 1.0f
+}
+
+public class Painting : View, SpotFilter.Plotter {
+    companion object {
+        val FADE_MINS = TimeUnit.MINUTES.toMillis(3) // about how long a drawing should last
+        val ZEN_RATE = TimeUnit.SECONDS.toMillis(2)  // how often to apply the fade
+        val ZEN_FADE = Math.max(1f, ZEN_RATE / FADE_MINS * 255f)
+
+        val FADE_TO_WHITE_CF = ColorMatrixColorFilter(ColorMatrix(floatArrayOf(
+                1f, 0f, 0f, 0f, ZEN_FADE,
+                0f, 1f, 0f, 0f, ZEN_FADE,
+                0f, 0f, 1f, 0f, ZEN_FADE,
+                0f, 0f, 0f, 1f, 0f
+        )))
+
+        val FADE_TO_BLACK_CF = ColorMatrixColorFilter(ColorMatrix(floatArrayOf(
+                1f, 0f, 0f, 0f, -ZEN_FADE,
+                0f, 1f, 0f, 0f, -ZEN_FADE,
+                0f, 0f, 1f, 0f, -ZEN_FADE,
+                0f, 0f, 0f, 1f, 0f
+        )))
+
+        val INVERT_CF = ColorMatrixColorFilter(ColorMatrix(floatArrayOf(
+                -1f, 0f, 0f, 0f, 255f,
+                0f, -1f, 0f, 0f, 255f,
+                0f, 0f, -1f, 0f, 255f,
+                0f, 0f, 0f, 1f, 0f
+        )))
+
+        val TOUCH_STATS = "touch.stats" // Settings.System key
+    }
+
+    var devicePressureMin = 0f; // ideal value
+    var devicePressureMax = 1f; // ideal value
+
+    var zenMode = true
+        set(value) {
+            if (field != value) {
+                field = value
+                removeCallbacks(fadeRunnable)
+                if (value && isAttachedToWindow) {
+                    handler.postDelayed(fadeRunnable, ZEN_RATE)
+                }
+            }
+        }
+
+    var bitmap: Bitmap? = null
+    var paperColor : Int = 0xFFFFFFFF.toInt()
+
+    private var _paintCanvas: Canvas? = null
+    private val _bitmapLock = Object()
+    
+    private var _drawPaint = Paint(Paint.ANTI_ALIAS_FLAG)
+    private var _lastX = 0f
+    private var _lastY = 0f
+    private var _lastR = 0f
+    private var _insets: WindowInsets? = null
+
+    private var _brushWidth = 100f
+
+    private var _filter = SpotFilter(10, 0.5f, 0.9f, this)
+
+    private val fadeRunnable = object : Runnable {
+        private val pt = Paint()
+        override fun run() {
+            val c = _paintCanvas
+            if (c != null) {
+                pt.colorFilter =
+                    if (paperColor.and(0xFF) > 0x80)
+                        FADE_TO_WHITE_CF
+                    else
+                        FADE_TO_BLACK_CF
+
+                synchronized(_bitmapLock) {
+                    c.drawBitmap(bitmap, 0f, 0f, pt)
+                }
+                invalidate()
+            }
+            postDelayed(this, ZEN_RATE)
+        }
+    }
+
+    constructor(context: Context) : super(context) {
+        init(null, 0)
+    }
+
+    constructor(context: Context, attrs: AttributeSet) : super(context, attrs) {
+        init(attrs, 0)
+    }
+
+    constructor(context: Context, attrs: AttributeSet, defStyle: Int) : super(context, attrs, defStyle) {
+        init(attrs, defStyle)
+    }
+
+    private fun init(attrs: AttributeSet?, defStyle: Int) {
+        loadDevicePressureData()
+    }
+
+    override fun onAttachedToWindow() {
+        super.onAttachedToWindow()
+
+        setupBitmaps()
+
+        if (zenMode) {
+            handler.postDelayed(fadeRunnable, ZEN_RATE)
+        }
+    }
+
+    override fun onSizeChanged(w: Int, h: Int, oldw: Int, oldh: Int) {
+        super.onSizeChanged(w, h, oldw, oldh)
+        setupBitmaps()
+    }
+
+    override fun onDetachedFromWindow() {
+        if (zenMode) {
+            removeCallbacks(fadeRunnable)
+        }
+        super.onDetachedFromWindow()
+    }
+
+    fun onTrimMemory() {
+    }
+
+    override fun onApplyWindowInsets(insets: WindowInsets?): WindowInsets {
+        _insets = insets
+        if (insets != null && _paintCanvas == null) {
+            setupBitmaps()
+        }
+        return super.onApplyWindowInsets(insets)
+    }
+
+    private fun powf(a: Float, b: Float): Float {
+        return Math.pow(a.toDouble(), b.toDouble()).toFloat()
+    }
+
+    override fun plot(s: MotionEvent.PointerCoords) {
+        val c = _paintCanvas
+        if (c == null) return
+        synchronized(_bitmapLock) {
+            var x = _lastX
+            var y = _lastY
+            var r = _lastR
+            val newR = Math.max(1f, powf(adjustPressure(s.pressure), 2f).toFloat() * _brushWidth)
+
+            if (r >= 0) {
+                val d = hypot(s.x - x, s.y - y)
+                if (d > 1f && (r + newR) > 1f) {
+                    val N = (2 * d / Math.min(4f, r + newR)).toInt()
+
+                    val stepX = (s.x - x) / N
+                    val stepY = (s.y - y) / N
+                    val stepR = (newR - r) / N
+                    for (i in 0 until N - 1) { // we will draw the last circle below
+                        x += stepX
+                        y += stepY
+                        r += stepR
+                        c.drawCircle(x, y, r, _drawPaint)
+                    }
+                }
+            }
+
+            c.drawCircle(s.x, s.y, newR, _drawPaint)
+            _lastX = s.x
+            _lastY = s.y
+            _lastR = newR
+        }
+    }
+
+    private fun loadDevicePressureData() {
+        try {
+            val touchDataJson = Settings.System.getString(context.contentResolver, TOUCH_STATS)
+            val touchData = JSONObject(
+                    if (touchDataJson != null) touchDataJson else "{}")
+            if (touchData.has("min")) devicePressureMin = touchData.getDouble("min").toFloat()
+            if (touchData.has("max")) devicePressureMax = touchData.getDouble("max").toFloat()
+            if (devicePressureMin < 0) devicePressureMin = 0f
+            if (devicePressureMax < devicePressureMin) devicePressureMax = devicePressureMin + 1f
+        } catch (e: Exception) {
+        }
+    }
+
+    private fun adjustPressure(pressure: Float): Float {
+        if (pressure > devicePressureMax) devicePressureMax = pressure
+        if (pressure < devicePressureMin) devicePressureMin = pressure
+        return invlerp(pressure, devicePressureMin, devicePressureMax)
+    }
+
+    override fun onTouchEvent(event: MotionEvent?): Boolean {
+        val c = _paintCanvas
+        if (event == null || c == null) return super.onTouchEvent(event)
+
+        /*
+        val pt = Paint(Paint.ANTI_ALIAS_FLAG)
+        pt.style = Paint.Style.STROKE
+        pt.color = 0x800000FF.toInt()
+        _paintCanvas?.drawCircle(event.x, event.y, 20f, pt)
+        */
+
+        when (event.actionMasked) {
+            MotionEvent.ACTION_UP, MotionEvent.ACTION_CANCEL -> {
+                _filter.add(event)
+                _filter.finish()
+                invalidate()
+            }
+
+            MotionEvent.ACTION_DOWN -> {
+                _lastR = -1f
+                _filter.add(event)
+                invalidate()
+            }
+
+            MotionEvent.ACTION_MOVE -> {
+                _filter.add(event)
+
+                invalidate()
+            }
+        }
+
+        return true
+    }
+
+    override fun onDraw(canvas: Canvas) {
+        super.onDraw(canvas)
+
+        bitmap?.let {
+            canvas.drawBitmap(bitmap, 0f, 0f, _drawPaint);
+        }
+    }
+
+    // public api
+    fun clear() {
+        bitmap = null
+        setupBitmaps()
+        invalidate()
+    }
+
+    fun sampleAt(x: Float, y: Float): Int {
+        val localX = (x - left).toInt()
+        val localY = (y - top).toInt()
+        return bitmap?.getPixel(localX, localY) ?: Color.BLACK
+    }
+
+    fun setPaintColor(color: Int) {
+        _drawPaint.color = color
+    }
+
+    fun getPaintColor(): Int {
+        return _drawPaint.color
+    }
+
+    fun setBrushWidth(w: Float) {
+        _brushWidth = w
+    }
+
+    fun getBrushWidth(): Float {
+        return _brushWidth
+    }
+
+    private fun setupBitmaps() {
+        val dm = DisplayMetrics()
+        display.getRealMetrics(dm)
+        val w = dm.widthPixels
+        val h = dm.heightPixels
+        val oldBits = bitmap
+        var bits = oldBits
+        if (bits == null || bits.width != w || bits.height != h) {
+            bits = Bitmap.createBitmap(
+                    w,
+                    h,
+                    Bitmap.Config.ARGB_8888
+            )
+        }
+        if (bits == null) return
+
+        val c = Canvas(bits)
+
+        if (oldBits != null) {
+            if (oldBits.width < oldBits.height != bits.width < bits.height) {
+                // orientation change. let's rotate things so they fit better
+                val matrix = Matrix()
+                if (bits.width > bits.height) {
+                    // now landscape
+                    matrix.postRotate(-90f)
+                    matrix.postTranslate(0f, bits.height.toFloat())
+                } else {
+                    // now portrait
+                    matrix.postRotate(90f)
+                    matrix.postTranslate(bits.width.toFloat(), 0f)
+                }
+                if (bits.width != oldBits.height || bits.height != oldBits.width) {
+                    matrix.postScale(
+                            bits.width.toFloat()/oldBits.height,
+                            bits.height.toFloat()/oldBits.width)
+                }
+                c.matrix = matrix
+            }
+            // paint the old artwork atop the new
+            c.drawBitmap(oldBits, 0f, 0f, _drawPaint)
+            c.matrix = Matrix()
+        } else {
+            c.drawColor(paperColor)
+        }
+
+        bitmap = bits
+        _paintCanvas = c
+    }
+
+    fun invertContents() {
+        val invertPaint = Paint()
+        invertPaint.colorFilter = INVERT_CF
+        synchronized(_bitmapLock) {
+            _paintCanvas?.drawBitmap(bitmap, 0f, 0f, invertPaint)
+        }
+        invalidate()
+    }
+}
+
diff --git a/packages/EasterEgg/src/com/android/egg/paint/Palette.kt b/packages/EasterEgg/src/com/android/egg/paint/Palette.kt
new file mode 100644
index 00000000000..7043efe1f4f
--- /dev/null
+++ b/packages/EasterEgg/src/com/android/egg/paint/Palette.kt
@@ -0,0 +1,83 @@
+/*
+ * Copyright (C) 2018 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.egg.paint
+
+import android.graphics.Color
+
+class Palette {
+    var colors : IntArray
+    var lightest = 0
+    var darkest = 0
+
+    /**
+     * rough luminance calculation
+     * https://www.w3.org/TR/AERT/#color-contrast
+     */
+    private fun lum(rgb: Int): Float {
+        return (Color.red(rgb) * 299f + Color.green(rgb) * 587f + Color.blue(rgb) * 114f) / 1000f
+    }
+
+    /**
+     * create a random evenly-spaced color palette
+     * guaranteed to contrast!
+     */
+    fun randomize(S: Float, V: Float) {
+        val hsv = floatArrayOf((Math.random() * 360f).toFloat(), S, V)
+        val count = colors.size
+        colors[0] = Color.HSVToColor(hsv)
+        lightest = 0
+        darkest = 0
+
+        for (i in 0 until count) {
+            hsv[0] = (hsv[0] + 360f / count).rem(360f)
+            val color = Color.HSVToColor(hsv)
+            colors[i] = color
+
+            val lum = lum(colors[i])
+            if (lum < lum(colors[darkest])) darkest = i
+            if (lum > lum(colors[lightest])) lightest = i
+        }
+    }
+
+    override fun toString() : String {
+        val str = StringBuilder("Palette{ ")
+        for (c in colors) {
+            str.append(String.format("#%08x ", c))
+        }
+        str.append("}")
+        return str.toString()
+    }
+
+    constructor(count: Int) {
+        colors = IntArray(count)
+        randomize(1f, 1f)
+    }
+
+    constructor(count: Int, S: Float, V: Float) {
+        colors = IntArray(count)
+        randomize(S, V)
+    }
+
+    constructor(_colors: IntArray) {
+        colors = _colors
+        for (i in 0 until colors.size) {
+            val lum = lum(colors[i])
+            if (lum < lum(colors[darkest])) darkest = i
+            if (lum > lum(colors[lightest])) lightest = i
+        }
+    }
+}
\ No newline at end of file
diff --git a/packages/EasterEgg/src/com/android/egg/paint/SpotFilter.kt b/packages/EasterEgg/src/com/android/egg/paint/SpotFilter.kt
new file mode 100644
index 00000000000..2c15c0dc486
--- /dev/null
+++ b/packages/EasterEgg/src/com/android/egg/paint/SpotFilter.kt
@@ -0,0 +1,124 @@
+/*
+ * Copyright (C) 2018 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.egg.paint
+
+import java.util.LinkedList
+
+import android.view.MotionEvent
+
+class SpotFilter(internal var mBufSize: Int, posDecay: Float, pressureDecay: Float, internal var mPlotter: Plotter) {
+    val spots = LinkedList<MotionEvent.PointerCoords>() // newest at front
+    val tmpSpot = MotionEvent.PointerCoords()
+    var lastTool = MotionEvent.TOOL_TYPE_UNKNOWN
+
+    val posDecay: Float
+    val pressureDecay: Float
+
+    interface Plotter {
+        fun plot(s: MotionEvent.PointerCoords)
+    }
+
+    init {
+        this.posDecay = if (posDecay in 0f..1f) posDecay else 1f
+        this.pressureDecay = if (pressureDecay in 0f..1f) pressureDecay else 1f
+    }
+
+    fun filterInto(out: MotionEvent.PointerCoords, tool: Int): MotionEvent.PointerCoords {
+        lastTool = tool
+
+        var wi = 1f // weight for ith component (position)
+        var w = 0f // total weight
+        var wi_press = 1f // weight for ith component (pressure)
+        var w_press = 0f // total weight (pressure)
+
+        var x = 0f
+        var y = 0f
+        var pressure = 0f
+        var size = 0f
+        for (pi in spots) {
+            x += pi.x * wi
+            y += pi.y * wi
+
+            pressure += pi.pressure * wi_press
+            size += pi.size * wi_press
+
+            w += wi
+            wi *= posDecay // exponential backoff
+
+            w_press += wi_press
+            wi_press *= pressureDecay
+
+            if (PRECISE_STYLUS_INPUT && tool == MotionEvent.TOOL_TYPE_STYLUS) {
+                // just take the newest one, no need to average
+                break
+            }
+        }
+
+        out.x = x / w
+        out.y = y / w
+        out.pressure = pressure / w_press
+        out.size = size / w_press
+        return out
+    }
+
+    protected fun addInternal(c: MotionEvent.PointerCoords, tool: Int) {
+        val coord =
+                if (spots.size == mBufSize) {
+                    spots.removeLast()
+                } else {
+                    MotionEvent.PointerCoords()
+                }
+        coord.copyFrom(c)
+
+        spots.add(0, coord)
+
+        filterInto(tmpSpot, tool)
+        mPlotter.plot(tmpSpot)
+    }
+
+    fun add(cv: List<MotionEvent.PointerCoords>, tool: Int) {
+        for (c in cv) {
+            addInternal(c, tool)
+        }
+    }
+
+    fun add(evt: MotionEvent) {
+        val tool = evt.getToolType(0)
+        for (i in 0 until evt.historySize) {
+            evt.getHistoricalPointerCoords(0, i, tmpSpot)
+            addInternal(tmpSpot, tool)
+        }
+        evt.getPointerCoords(0, tmpSpot)
+        addInternal(tmpSpot, tool)
+    }
+
+    fun finish() {
+        while (spots.size > 0) {
+            filterInto(tmpSpot, lastTool)
+            spots.removeLast()
+            mPlotter.plot(tmpSpot)
+        }
+
+        spots.clear()
+    }
+
+    companion object {
+        var PRECISE_STYLUS_INPUT = true
+    }
+}
+
+
diff --git a/packages/EasterEgg/src/com/android/egg/paint/ToolbarView.kt b/packages/EasterEgg/src/com/android/egg/paint/ToolbarView.kt
new file mode 100644
index 00000000000..86b11e7be81
--- /dev/null
+++ b/packages/EasterEgg/src/com/android/egg/paint/ToolbarView.kt
@@ -0,0 +1,77 @@
+/*
+ * Copyright (C) 2018 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.egg.paint
+
+import android.content.Context
+import android.graphics.Canvas
+import android.graphics.Color
+import android.graphics.Paint
+import android.graphics.Rect
+import android.graphics.drawable.Drawable
+import android.text.TextPaint
+import android.transition.ChangeBounds
+import android.transition.Transition
+import android.transition.TransitionListenerAdapter
+import android.transition.TransitionManager
+import android.util.AttributeSet
+import android.view.*
+import android.view.animation.OvershootInterpolator
+import android.widget.FrameLayout
+
+class ToolbarView : FrameLayout {
+    var inTransition = false
+    var transitionListener: Transition.TransitionListener = object : TransitionListenerAdapter() {
+        override fun onTransitionStart(transition: Transition?) {
+            inTransition = true
+        }
+        override fun onTransitionEnd(transition: Transition?) {
+            inTransition = false
+        }
+    }
+
+    constructor(context: Context) : super(context) {
+        init(null, 0)
+    }
+
+    constructor(context: Context, attrs: AttributeSet) : super(context, attrs) {
+        init(attrs, 0)
+    }
+
+    constructor(context: Context, attrs: AttributeSet, defStyle: Int) : super(context, attrs, defStyle) {
+        init(attrs, defStyle)
+    }
+
+    override fun onApplyWindowInsets(insets: WindowInsets?): WindowInsets {
+        var lp = layoutParams as FrameLayout.LayoutParams?
+        if (lp != null && insets != null) {
+            if (insets.hasStableInsets()) {
+                lp.topMargin = insets.stableInsetTop
+                lp.bottomMargin = insets.stableInsetBottom
+            } else {
+                lp.topMargin = insets.systemWindowInsetTop
+                lp.bottomMargin = insets.systemWindowInsetBottom
+            }
+            layoutParams = lp
+        }
+
+        return super.onApplyWindowInsets(insets)
+    }
+
+    private fun init(attrs: AttributeSet?, defStyle: Int) {
+    }
+
+}
diff --git a/packages/PrintSpooler/res/values-ar/strings.xml b/packages/PrintSpooler/res/values-ar/strings.xml
index 779d19babb6..807426b622a 100644
--- a/packages/PrintSpooler/res/values-ar/strings.xml
+++ b/packages/PrintSpooler/res/values-ar/strings.xml
@@ -111,7 +111,7 @@
     <item msgid="3199660090246166812">""</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">"   "</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"   .  ."</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">"  .   ."</string>
     <string name="print_error_retry" msgid="1426421728784259538">" "</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"     ."</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">"  ."</string>
diff --git a/packages/PrintSpooler/res/values-bg/strings.xml b/packages/PrintSpooler/res/values-bg/strings.xml
index d44b4ce47c0..d05d96f0a13 100644
--- a/packages/PrintSpooler/res/values-bg/strings.xml
+++ b/packages/PrintSpooler/res/values-bg/strings.xml
@@ -103,7 +103,7 @@
     <item msgid="3199660090246166812">""</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">"      "</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"    .  ."</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">" ,   .  ."</string>
     <string name="print_error_retry" msgid="1426421728784259538">" "</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"      ."</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">"     "</string>
diff --git a/packages/PrintSpooler/res/values-da/strings.xml b/packages/PrintSpooler/res/values-da/strings.xml
index f88a4533bb2..fa59d992d92 100644
--- a/packages/PrintSpooler/res/values-da/strings.xml
+++ b/packages/PrintSpooler/res/values-da/strings.xml
@@ -32,7 +32,7 @@
     <string name="template_page_range" msgid="428638530038286328">"Interval p <xliff:g id="PAGE_COUNT">%1$s</xliff:g>"</string>
     <string name="pages_range_example" msgid="8558694453556945172">"f.eks. 1-5,8,11-13"</string>
     <string name="print_preview" msgid="8010217796057763343">"Vis udskrift"</string>
-    <string name="install_for_print_preview" msgid="6366303997385509332">"Installer et PDF-visningsprog. for at se eksempel"</string>
+    <string name="install_for_print_preview" msgid="6366303997385509332">"Installer et PDF-visningsprog. for at se en forhndsvisning"</string>
     <string name="printing_app_crashed" msgid="854477616686566398">"Udskrivningsapp gik ned"</string>
     <string name="generating_print_job" msgid="3119608742651698916">"Udskriften generes"</string>
     <string name="save_as_pdf" msgid="5718454119847596853">"Gem som PDF"</string>
@@ -106,6 +106,6 @@
     <string name="print_error_default_message" msgid="8602678405502922346">"Det virkede desvrre ikke. Prv igen."</string>
     <string name="print_error_retry" msgid="1426421728784259538">"Prv igen"</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"Denne printer er i jeblikket ikke tilgngelig."</string>
-    <string name="print_cannot_load_page" msgid="6179560924492912009">"Eksempelvisning kan ikke vises"</string>
-    <string name="print_preparing_preview" msgid="3939930735671364712">"Eksempelvisning forberedes..."</string>
+    <string name="print_cannot_load_page" msgid="6179560924492912009">"Forhndsvisning kan ikke vises"</string>
+    <string name="print_preparing_preview" msgid="3939930735671364712">"Forhndsvisning klargres..."</string>
 </resources>
diff --git a/packages/PrintSpooler/res/values-hu/strings.xml b/packages/PrintSpooler/res/values-hu/strings.xml
index b9a0d9d78f6..c1caf91611c 100644
--- a/packages/PrintSpooler/res/values-hu/strings.xml
+++ b/packages/PrintSpooler/res/values-hu/strings.xml
@@ -103,7 +103,7 @@
     <item msgid="3199660090246166812">"Fekv"</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">"Nem sikerlt rni a fjlba"</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"Sajnljuk, de nem sikerlt. Prblja jra."</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">"Sajnljuk, de nem sikerlt. Prbld jra."</string>
     <string name="print_error_retry" msgid="1426421728784259538">"jra"</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"Ez a nyomtat jelenleg nem rhet el."</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">"Nem lehet megjelenteni az elnzetet"</string>
diff --git a/packages/PrintSpooler/res/values-km/strings.xml b/packages/PrintSpooler/res/values-km/strings.xml
index ed8219e788b..c878ebe537f 100644
--- a/packages/PrintSpooler/res/values-km/strings.xml
+++ b/packages/PrintSpooler/res/values-km/strings.xml
@@ -27,7 +27,7 @@
     <string name="label_duplex" msgid="5370037254347072243">""</string>
     <string name="label_orientation" msgid="2853142581990496477">""</string>
     <string name="label_pages" msgid="7768589729282182230">""</string>
-    <string name="destination_default_text" msgid="5422708056807065710">""</string>
+    <string name="destination_default_text" msgid="5422708056807065710">""</string>
     <string name="template_all_pages" msgid="3322235982020148762">"<xliff:g id="PAGE_COUNT">%1$s</xliff:g> "</string>
     <string name="template_page_range" msgid="428638530038286328">" <xliff:g id="PAGE_COUNT">%1$s</xliff:g>"</string>
     <string name="pages_range_example" msgid="8558694453556945172">". 15,8,1113"</string>
@@ -103,7 +103,7 @@
     <item msgid="3199660090246166812">""</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">""</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"  "</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">"  "</string>
     <string name="print_error_retry" msgid="1426421728784259538">""</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">" "</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">""</string>
diff --git a/packages/PrintSpooler/res/values-ml/strings.xml b/packages/PrintSpooler/res/values-ml/strings.xml
index 05be7a749e7..dbcd34b1360 100644
--- a/packages/PrintSpooler/res/values-ml/strings.xml
+++ b/packages/PrintSpooler/res/values-ml/strings.xml
@@ -35,7 +35,7 @@
     <string name="install_for_print_preview" msgid="6366303997385509332">"  PDF   "</string>
     <string name="printing_app_crashed" msgid="854477616686566398">"  "</string>
     <string name="generating_print_job" msgid="3119608742651698916">"  "</string>
-    <string name="save_as_pdf" msgid="5718454119847596853">"PDF  "</string>
+    <string name="save_as_pdf" msgid="5718454119847596853">"PDF- "</string>
     <string name="all_printers" msgid="5018829726861876202">" ..."</string>
     <string name="print_dialog" msgid="32628687461331979">" "</string>
     <string name="current_page_template" msgid="5145005201131935302">"<xliff:g id="CURRENT_PAGE">%1$d</xliff:g>/<xliff:g id="PAGE_COUNT">%2$d</xliff:g>"</string>
diff --git a/packages/PrintSpooler/res/values-my/strings.xml b/packages/PrintSpooler/res/values-my/strings.xml
index 8ce23e00960..96ed7540dfa 100644
--- a/packages/PrintSpooler/res/values-my/strings.xml
+++ b/packages/PrintSpooler/res/values-my/strings.xml
@@ -20,7 +20,7 @@
     <string name="more_options_button" msgid="2243228396432556771">" "</string>
     <string name="label_destination" msgid="9132510997381599275">""</string>
     <string name="label_copies" msgid="3634531042822968308">""</string>
-    <string name="label_copies_summary" msgid="3861966063536529540">":"</string>
+    <string name="label_copies_summary" msgid="3861966063536529540">"-"</string>
     <string name="label_paper_size" msgid="908654383827777759">"  "</string>
     <string name="label_paper_size_summary" msgid="5668204981332138168">"  :"</string>
     <string name="label_color" msgid="1108690305218188969">""</string>
@@ -35,7 +35,7 @@
     <string name="install_for_print_preview" msgid="6366303997385509332">"   "</string>
     <string name="printing_app_crashed" msgid="854477616686566398">"  "</string>
     <string name="generating_print_job" msgid="3119608742651698916">" "</string>
-    <string name="save_as_pdf" msgid="5718454119847596853">" "</string>
+    <string name="save_as_pdf" msgid="5718454119847596853">"PDF "</string>
     <string name="all_printers" msgid="5018829726861876202">" "</string>
     <string name="print_dialog" msgid="32628687461331979">" "</string>
     <string name="current_page_template" msgid="5145005201131935302">"<xliff:g id="CURRENT_PAGE">%1$d</xliff:g>/<xliff:g id="PAGE_COUNT">%2$d</xliff:g>"</string>
@@ -103,8 +103,8 @@
     <item msgid="3199660090246166812">""</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">" "</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"    "</string>
-    <string name="print_error_retry" msgid="1426421728784259538">""</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">" "</string>
+    <string name="print_error_retry" msgid="1426421728784259538">""</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"  "</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">" "</string>
     <string name="print_preparing_preview" msgid="3939930735671364712">" "</string>
diff --git a/packages/PrintSpooler/res/values-pt-rPT/strings.xml b/packages/PrintSpooler/res/values-pt-rPT/strings.xml
index 5da31bde591..1c128b4d89d 100644
--- a/packages/PrintSpooler/res/values-pt-rPT/strings.xml
+++ b/packages/PrintSpooler/res/values-pt-rPT/strings.xml
@@ -103,7 +103,7 @@
     <item msgid="3199660090246166812">"Horizontal"</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">"No foi possvel gravar no ficheiro"</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"Lamentamos, mas isso no funcionou. Tente novam."</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">"Lamentamos, mas isso no funcionou. Tente novamente."</string>
     <string name="print_error_retry" msgid="1426421728784259538">"Tentar novamente"</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"Esta impressora no est atualmente disponvel."</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">"No  possvel apresentar a pr-visualizao"</string>
diff --git a/packages/PrintSpooler/res/values-sk/strings.xml b/packages/PrintSpooler/res/values-sk/strings.xml
index 17a029a4629..184f4d83f05 100644
--- a/packages/PrintSpooler/res/values-sk/strings.xml
+++ b/packages/PrintSpooler/res/values-sk/strings.xml
@@ -107,7 +107,7 @@
     <item msgid="3199660090246166812">"Na rku"</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">"Do sboru nie je mon zapisova"</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"Je nm to to, nefungovalo to. Skste to znova."</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">"utujeme, nepodarilo sa. Skste to znova."</string>
     <string name="print_error_retry" msgid="1426421728784259538">"Opakova"</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"Tto tlaiare nie je momentlne k dispozcii."</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">"Ukka sa ned zobrazi"</string>
diff --git a/packages/PrintSpooler/res/values-sw/strings.xml b/packages/PrintSpooler/res/values-sw/strings.xml
index 8aaf6f49a83..12f5b600221 100644
--- a/packages/PrintSpooler/res/values-sw/strings.xml
+++ b/packages/PrintSpooler/res/values-sw/strings.xml
@@ -103,7 +103,7 @@
     <item msgid="3199660090246166812">"Mlalo"</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">"Haikuweza kuandika kwenye faili"</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"Samahani, hiyo haikufanya kazi. Jaribu tena."</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">"Samahani, imeshindwa kufanya kazi. Jaribu tena."</string>
     <string name="print_error_retry" msgid="1426421728784259538">"Jaribu tena"</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"Printa hii haipatikani kwa sasa."</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">"Haiwezi kupakia onyesho la kuchungulia"</string>
diff --git a/packages/PrintSpooler/res/values-uz/strings.xml b/packages/PrintSpooler/res/values-uz/strings.xml
index 8921f8e5d28..7552938980a 100644
--- a/packages/PrintSpooler/res/values-uz/strings.xml
+++ b/packages/PrintSpooler/res/values-uz/strings.xml
@@ -103,7 +103,7 @@
     <item msgid="3199660090246166812">"Eniga"</item>
   </string-array>
     <string name="print_write_error_message" msgid="5787642615179572543">"Faylga yozib bolmadi"</string>
-    <string name="print_error_default_message" msgid="8602678405502922346">"Kechirasiz, ishlamadi. Qayta urinib koring."</string>
+    <string name="print_error_default_message" msgid="8602678405502922346">"Xatolik yuz berdi. Qaytadan urining."</string>
     <string name="print_error_retry" msgid="1426421728784259538">"Qayta urinish"</string>
     <string name="print_error_printer_unavailable" msgid="8985614415253203381">"Ushbu printer hozirda mavjud emas."</string>
     <string name="print_cannot_load_page" msgid="6179560924492912009">"Oldindan korsatib bolmaydi"</string>
diff --git a/packages/SettingsLib/res/values-as/strings.xml b/packages/SettingsLib/res/values-as/strings.xml
index da76337fe9a..f8d2a57ddb1 100644
--- a/packages/SettingsLib/res/values-as/strings.xml
+++ b/packages/SettingsLib/res/values-as/strings.xml
@@ -224,8 +224,7 @@
     <string name="bluetooth_select_a2dp_codec_channel_mode" msgid="884855779449390540">" \'  \'"</string>
     <string name="bluetooth_select_a2dp_codec_channel_mode_dialog_title" msgid="7234956835280563341">" \' \' \n :  \'"</string>
     <string name="bluetooth_select_a2dp_codec_ldac_playback_quality" msgid="3619694372407843405">"  LDAC :  "</string>
-    <!-- no translation found for bluetooth_select_a2dp_codec_ldac_playback_quality_dialog_title (6893955536658137179) -->
-    <skip />
+    <string name="bluetooth_select_a2dp_codec_ldac_playback_quality_dialog_title" msgid="6893955536658137179">" \' LDAC\n\'   :   "</string>
     <string name="bluetooth_select_a2dp_codec_streaming_label" msgid="5347862512596240506">"   : <xliff:g id="STREAMING_PARAMETER">%1$s</xliff:g>"</string>
     <string name="select_private_dns_configuration_title" msgid="3700456559305263922">" DNS"</string>
     <string name="select_private_dns_configuration_dialog_title" msgid="9221994415765826811">" DNS \'  "</string>
@@ -368,18 +367,12 @@
     <string name="accessibility_display_daltonizer_preference_title" msgid="5800761362678707872">" "</string>
     <string name="accessibility_display_daltonizer_preference_subtitle" msgid="3484969015295282911">"  ,       "</string>
     <string name="daltonizer_type_overridden" msgid="3116947244410245916">"<xliff:g id="TITLE">%1$s</xliff:g>    "</string>
-    <!-- no translation found for power_remaining_settings_home_page (4845022416859002011) -->
-    <skip />
-    <!-- no translation found for power_remaining_duration_only (6123167166221295462) -->
-    <skip />
-    <!-- no translation found for power_discharging_duration (8848256785736335185) -->
-    <skip />
-    <!-- no translation found for power_remaining_duration_only_enhanced (4189311599812296592) -->
-    <skip />
-    <!-- no translation found for power_discharging_duration_enhanced (1992003260664804080) -->
-    <skip />
-    <!-- no translation found for power_remaining_duration_only_short (3463575350656389957) -->
-    <skip />
+    <string name="power_remaining_settings_home_page" msgid="4845022416859002011">"<xliff:g id="PERCENTAGE">%1$s</xliff:g> - <xliff:g id="TIME_STRING">%2$s</xliff:g>"</string>
+    <string name="power_remaining_duration_only" msgid="6123167166221295462">" <xliff:g id="TIME_REMAINING">%1$s</xliff:g>  "</string>
+    <string name="power_discharging_duration" msgid="8848256785736335185">" <xliff:g id="TIME_REMAINING">%1$s</xliff:g>   (<xliff:g id="LEVEL">%2$s</xliff:g>)"</string>
+    <string name="power_remaining_duration_only_enhanced" msgid="4189311599812296592">"      <xliff:g id="TIME_REMAINING">%1$s</xliff:g>  "</string>
+    <string name="power_discharging_duration_enhanced" msgid="1992003260664804080">"      <xliff:g id="TIME_REMAINING">%1$s</xliff:g>   (<xliff:g id="LEVEL">%2$s</xliff:g>)"</string>
+    <string name="power_remaining_duration_only_short" msgid="3463575350656389957">"<xliff:g id="TIME_REMAINING">%1$s</xliff:g>  "</string>
     <string name="power_discharge_by_enhanced" msgid="2095821536747992464">"       <xliff:g id="TIME">%1$s</xliff:g>   (<xliff:g id="LEVEL">%2$s</xliff:g>)"</string>
     <string name="power_discharge_by_only_enhanced" msgid="2175151772952365149">"       <xliff:g id="TIME">%1$s</xliff:g>  "</string>
     <string name="power_discharge_by" msgid="6453537733650125582">"  <xliff:g id="TIME">%1$s</xliff:g>   (<xliff:g id="LEVEL">%2$s</xliff:g>)"</string>
diff --git a/packages/SettingsLib/res/values-bn/strings.xml b/packages/SettingsLib/res/values-bn/strings.xml
index 46fb0afe32b..8ebaa770a6f 100644
--- a/packages/SettingsLib/res/values-bn/strings.xml
+++ b/packages/SettingsLib/res/values-bn/strings.xml
@@ -278,7 +278,7 @@
     <string name="media_category" msgid="4388305075496848353">""</string>
     <string name="debug_monitoring_category" msgid="7640508148375798343">" "</string>
     <string name="strict_mode" msgid="1938795874357830695">"  "</string>
-    <string name="strict_mode_summary" msgid="142834318897332338">"        "</string>
+    <string name="strict_mode_summary" msgid="142834318897332338">"        "</string>
     <string name="pointer_location" msgid="6084434787496938001">" "</string>
     <string name="pointer_location_summary" msgid="840819275172753713">"     "</string>
     <string name="show_touches" msgid="2642976305235070316">"  "</string>
@@ -304,7 +304,7 @@
     <string name="force_hw_ui_summary" msgid="5535991166074861515">"2D   GPU-   "</string>
     <string name="force_msaa" msgid="7920323238677284387">"4x MSAA   "</string>
     <string name="force_msaa_summary" msgid="9123553203895817537">"OpenGL ES 2.0   4x MSAA  "</string>
-    <string name="show_non_rect_clip" msgid="505954950474595172">"-    "</string>
+    <string name="show_non_rect_clip" msgid="505954950474595172">"-    "</string>
     <string name="track_frame_time" msgid="6146354853663863443">" GPU "</string>
     <string name="enable_gpu_debug_layers" msgid="3848838293793255097">"GPU    "</string>
     <string name="enable_gpu_debug_layers_summary" msgid="8009136940671194940">"   GPU     "</string>
@@ -313,8 +313,8 @@
     <string name="animator_duration_scale_title" msgid="3406722410819934083">"  "</string>
     <string name="overlay_display_devices_title" msgid="5364176287998398539">"   "</string>
     <string name="debug_applications_category" msgid="4206913653849771549">""</string>
-    <string name="immediately_destroy_activities" msgid="1579659389568133959">"  "</string>
-    <string name="immediately_destroy_activities_summary" msgid="3592221124808773368">"           "</string>
+    <string name="immediately_destroy_activities" msgid="1579659389568133959">"  "</string>
+    <string name="immediately_destroy_activities_summary" msgid="3592221124808773368">"           "</string>
     <string name="app_process_limit_title" msgid="4280600650253107163">"  "</string>
     <string name="show_all_anrs" msgid="4924885492787069007">" ANR "</string>
     <string name="show_all_anrs_summary" msgid="6636514318275139826">"   \'     \'  "</string>
diff --git a/packages/SettingsLib/res/values-bs/arrays.xml b/packages/SettingsLib/res/values-bs/arrays.xml
index 8577779d104..9b3c38c0ab0 100644
--- a/packages/SettingsLib/res/values-bs/arrays.xml
+++ b/packages/SettingsLib/res/values-bs/arrays.xml
@@ -27,7 +27,7 @@
     <item msgid="515055375277271756">"Autentifikacija"</item>
     <item msgid="1943354004029184381">"Dobivanje IP adrese"</item>
     <item msgid="4221763391123233270">"Povezano"</item>
-    <item msgid="624838831631122137">"Suspendiran"</item>
+    <item msgid="624838831631122137">"Suspendirano"</item>
     <item msgid="7979680559596111948">"Prekidanje veze"</item>
     <item msgid="1634960474403853625">"Iskljuen"</item>
     <item msgid="746097431216080650">"Neuspjeno"</item>
@@ -38,11 +38,11 @@
     <item msgid="7714855332363650812"></item>
     <item msgid="8878186979715711006">"Skeniranje"</item>
     <item msgid="355508996603873860">"Povezivanje na mreu <xliff:g id="NETWORK_NAME">%1$s</xliff:g>..."</item>
-    <item msgid="554971459996405634">"Autentifikacija sa mreom <xliff:g id="NETWORK_NAME">%1$s</xliff:g>"</item>
+    <item msgid="554971459996405634">"Autentifikacija s mreom <xliff:g id="NETWORK_NAME">%1$s</xliff:g>"</item>
     <item msgid="7928343808033020343">"Dobivanje IP adrese iz mree <xliff:g id="NETWORK_NAME">%1$s</xliff:g>"</item>
-    <item msgid="8937994881315223448">"Povezan na mreu <xliff:g id="NETWORK_NAME">%1$s</xliff:g>"</item>
-    <item msgid="1330262655415760617">"Suspendiran"</item>
-    <item msgid="7698638434317271902">"Prekidanje veze sa mreom <xliff:g id="NETWORK_NAME">%1$s</xliff:g>"</item>
+    <item msgid="8937994881315223448">"Povezano na mreu <xliff:g id="NETWORK_NAME">%1$s</xliff:g>"</item>
+    <item msgid="1330262655415760617">"Suspendirano"</item>
+    <item msgid="7698638434317271902">"Prekidanje veze s mreom <xliff:g id="NETWORK_NAME">%1$s</xliff:g>"</item>
     <item msgid="197508606402264311">"Iskljuen"</item>
     <item msgid="8578370891960825148">"Neuspjeno"</item>
     <item msgid="5660739516542454527">"Blokirano"</item>
@@ -59,7 +59,7 @@
     <item msgid="45075631231212732">"Uvijek koristi HDCP provjeru"</item>
   </string-array>
   <string-array name="bluetooth_avrcp_versions">
-    <item msgid="5347678900838034763">"AVRCP 1.4 (Zadano)"</item>
+    <item msgid="5347678900838034763">"AVRCP 1.4 (zadano)"</item>
     <item msgid="2809759619990248160">"AVRCP 1.3"</item>
     <item msgid="6199178154704729352">"AVRCP 1.5"</item>
     <item msgid="5172170854953034852">"AVRCP 1.6"</item>
@@ -71,58 +71,58 @@
     <item msgid="3422726142222090896">"avrcp16"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_titles">
-    <item msgid="7065842274271279580">"Koristi odabir sistema (Zadano)"</item>
+    <item msgid="7065842274271279580">"Koristi odabir sistema (zadano)"</item>
     <item msgid="7539690996561263909">"SBC"</item>
     <item msgid="686685526567131661">"AAC"</item>
     <item msgid="5254942598247222737">"<xliff:g id="QUALCOMM">Qualcomm</xliff:g> <xliff:g id="APTX">aptX</xliff:g> audio"</item>
     <item msgid="2091430979086738145">"<xliff:g id="QUALCOMM">Qualcomm</xliff:g> <xliff:g id="APTX_HD">aptX HD</xliff:g> audio"</item>
     <item msgid="6751080638867012696">"LDAC"</item>
-    <item msgid="723675059572222462">"Omoguite opcionalne kodeke"</item>
-    <item msgid="3304843301758635896">"Onemoguite opcionalne kodeke"</item>
+    <item msgid="723675059572222462">"Omogui opcionalne kodeke"</item>
+    <item msgid="3304843301758635896">"Onemogui opcionalne kodeke"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_summaries">
-    <item msgid="5062108632402595000">"Koristi odabir sistema (Zadano)"</item>
+    <item msgid="5062108632402595000">"Koristi odabir sistema (zadano)"</item>
     <item msgid="6898329690939802290">"SBC"</item>
     <item msgid="6839647709301342559">"AAC"</item>
     <item msgid="7848030269621918608">"<xliff:g id="QUALCOMM">Qualcomm</xliff:g> <xliff:g id="APTX">aptX</xliff:g> audio"</item>
     <item msgid="298198075927343893">"<xliff:g id="QUALCOMM">Qualcomm</xliff:g> <xliff:g id="APTX_HD">aptX HD</xliff:g> audio"</item>
     <item msgid="7950781694447359344">"LDAC"</item>
-    <item msgid="2209680154067241740">"Omoguite opcionalne kodeke"</item>
-    <item msgid="741805482892725657">"Onemoguite opcionalne kodeke"</item>
+    <item msgid="2209680154067241740">"Omogui opcionalne kodeke"</item>
+    <item msgid="741805482892725657">"Onemogui opcionalne kodeke"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_sample_rate_titles">
-    <item msgid="3093023430402746802">"Koristi odabir sistema (Zadano)"</item>
+    <item msgid="3093023430402746802">"Koristi odabir sistema (zadano)"</item>
     <item msgid="8895532488906185219">"44,1 kHz"</item>
     <item msgid="2909915718994807056">"48,0 kHz"</item>
     <item msgid="3347287377354164611">"88,2 kHz"</item>
     <item msgid="1234212100239985373">"96,0 kHz"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_sample_rate_summaries">
-    <item msgid="3214516120190965356">"Koristi odabir sistema (Zadano)"</item>
+    <item msgid="3214516120190965356">"Koristi odabir sistema (zadano)"</item>
     <item msgid="4482862757811638365">"44,1 kHz"</item>
     <item msgid="354495328188724404">"48,0 kHz"</item>
     <item msgid="7329816882213695083">"88,2 kHz"</item>
     <item msgid="6967397666254430476">"96,0 kHz"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_bits_per_sample_titles">
-    <item msgid="2684127272582591429">"Koristi odabir sistema (Zadano)"</item>
+    <item msgid="2684127272582591429">"Koristi odabir sistema (zadano)"</item>
     <item msgid="5618929009984956469">"16 bitova/uzorak"</item>
     <item msgid="3412640499234627248">"24 bitova/uzorak"</item>
     <item msgid="121583001492929387">"32 bitova/uzorak"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_bits_per_sample_summaries">
-    <item msgid="1081159789834584363">"Koristi odabir sistema (Zadano)"</item>
+    <item msgid="1081159789834584363">"Koristi odabir sistema (zadano)"</item>
     <item msgid="4726688794884191540">"16 bitova/uzorak"</item>
     <item msgid="305344756485516870">"24 bitova/uzorak"</item>
     <item msgid="244568657919675099">"32 bitova/uzorak"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_channel_mode_titles">
-    <item msgid="5226878858503393706">"Koristi odabir sistema (Zadano)"</item>
+    <item msgid="5226878858503393706">"Koristi odabir sistema (zadano)"</item>
     <item msgid="4106832974775067314">"Mono"</item>
     <item msgid="5571632958424639155">"Stereo"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_channel_mode_summaries">
-    <item msgid="4118561796005528173">"Koristi odabir sistema (Zadano)"</item>
+    <item msgid="4118561796005528173">"Koristi odabir sistema (zadano)"</item>
     <item msgid="8900559293912978337">"Mono"</item>
     <item msgid="8883739882299884241">"Stereo"</item>
   </string-array>
@@ -130,13 +130,13 @@
     <item msgid="7158319962230727476">"Optimizirano za kvalitet zvuka (990 kbps/909 kbps)"</item>
     <item msgid="2921767058740704969">"Uravnoteen kvalitet zvuka i veze (660kbps/606kbps)"</item>
     <item msgid="8860982705384396512">"Optimizirano za kvalitet veze (330 kbps/303 kbps)"</item>
-    <item msgid="4414060457677684127">"Maksimalan napor (Prilagodljiva brzina prijenosa)"</item>
+    <item msgid="4414060457677684127">"Maksimalan napor (prilagodljiva brzina prijenosa)"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_ldac_playback_quality_summaries">
     <item msgid="6398189564246596868">"Optimizirano za kvalitet zvuka"</item>
     <item msgid="4327143584633311908">"Uravnoteen kvalitet zvuka i veze"</item>
     <item msgid="4681409244565426925">"Optimizirano za kvalitet veze"</item>
-    <item msgid="364670732877872677">"Maksimalan napor (Prilagodljiva brzina prijenosa)"</item>
+    <item msgid="364670732877872677">"Maksimalan napor (prilagodljiva brzina prijenosa)"</item>
   </string-array>
   <string-array name="bluetooth_audio_active_device_summaries">
     <item msgid="4862957058729193940"></item>
@@ -169,7 +169,7 @@
   <string-array name="select_logpersist_titles">
     <item msgid="1744840221860799971">"Iskljueno"</item>
     <item msgid="3054662377365844197">"Sve"</item>
-    <item msgid="688870735111627832">"Svi osim radija"</item>
+    <item msgid="688870735111627832">"Sve osim radija"</item>
     <item msgid="2850427388488887328">"samo kernel"</item>
   </string-array>
   <string-array name="select_logpersist_summaries">
@@ -208,13 +208,13 @@
   <string-array name="overlay_display_devices_entries">
     <item msgid="1606809880904982133">"Nema"</item>
     <item msgid="9033194758688161545">"480p"</item>
-    <item msgid="1025306206556583600">"480p (osiguran)"</item>
+    <item msgid="1025306206556583600">"480p (sigurno)"</item>
     <item msgid="1853913333042744661">"720p"</item>
-    <item msgid="3414540279805870511">"720p (osiguran)"</item>
+    <item msgid="3414540279805870511">"720p (sigurno)"</item>
     <item msgid="9039818062847141551">"1080p"</item>
-    <item msgid="4939496949750174834">"1080p (osiguran)"</item>
+    <item msgid="4939496949750174834">"1080p (sigurno)"</item>
     <item msgid="1833612718524903568">"4K"</item>
-    <item msgid="238303513127879234">"4K (osiguran)"</item>
+    <item msgid="238303513127879234">"4K (sigurno)"</item>
     <item msgid="3547211260846843098">"4K (poveava rezoluciju)"</item>
     <item msgid="5411365648951414254">"4K (poveava rezoluciju, osiguran)"</item>
     <item msgid="1311305077526792901">"720p, 1080p (dupli ekran)"</item>
diff --git a/packages/SettingsLib/res/values-bs/strings.xml b/packages/SettingsLib/res/values-bs/strings.xml
index a35f4f2e27c..b54404f215f 100644
--- a/packages/SettingsLib/res/values-bs/strings.xml
+++ b/packages/SettingsLib/res/values-bs/strings.xml
@@ -43,7 +43,7 @@
     <string name="wifi_status_no_internet" msgid="5784710974669608361">"Nema internetske veze"</string>
     <string name="wifi_status_sign_in_required" msgid="123517180404752756">"Potrebna je prijava"</string>
     <string name="wifi_ap_unable_to_handle_new_sta" msgid="5348824313514404541">"Pristupna taka je privremeno puna"</string>
-    <string name="connected_via_carrier" msgid="7583780074526041912">"Povezana koristei %1$s"</string>
+    <string name="connected_via_carrier" msgid="7583780074526041912">"Povezano koristei %1$s"</string>
     <string name="available_via_carrier" msgid="1469036129740799053">"Dostupna koristei %1$s"</string>
     <string name="speed_label_very_slow" msgid="1867055264243608530">"Veoma sporo"</string>
     <string name="speed_label_slow" msgid="813109590815810235">"Sporo"</string>
@@ -84,11 +84,11 @@
     <string name="bluetooth_hearing_aid_profile_summary_connected" msgid="7188282786730266159">"Povezano na sluni aparat"</string>
     <string name="bluetooth_a2dp_profile_summary_connected" msgid="963376081347721598">"Povezano sa zvukom medija"</string>
     <string name="bluetooth_headset_profile_summary_connected" msgid="7661070206715520671">"Povezano na zvuk telefona"</string>
-    <string name="bluetooth_opp_profile_summary_connected" msgid="2611913495968309066">"Povezan na server za prijenos podataka"</string>
+    <string name="bluetooth_opp_profile_summary_connected" msgid="2611913495968309066">"Povezano sa serverom za prijenos podataka"</string>
     <string name="bluetooth_map_profile_summary_connected" msgid="8191407438851351713">"Povezano na mapu"</string>
     <string name="bluetooth_sap_profile_summary_connected" msgid="8561765057453083838">"Povezan na SAP"</string>
-    <string name="bluetooth_opp_profile_summary_not_connected" msgid="1267091356089086285">"Nije povezan na server za prijenos podataka"</string>
-    <string name="bluetooth_hid_profile_summary_connected" msgid="3381760054215168689">"Spojen na ulazni ureaj"</string>
+    <string name="bluetooth_opp_profile_summary_not_connected" msgid="1267091356089086285">"Nije povezano sa serverom za prijenos podataka"</string>
+    <string name="bluetooth_hid_profile_summary_connected" msgid="3381760054215168689">"Povezano s ulaznim ureajem"</string>
     <string name="bluetooth_pan_user_profile_summary_connected" msgid="6436258151814414028">"Povezano na ureaj za pristup internetu"</string>
     <string name="bluetooth_pan_nap_profile_summary_connected" msgid="1322694224800769308">"Dijeljenje lokalne internetske veze s ureajem"</string>
     <string name="bluetooth_pan_profile_summary_use_for" msgid="5736111170225304239">"Koristi za pristup internetu"</string>
@@ -102,10 +102,10 @@
     <string name="bluetooth_pairing_accept" msgid="6163520056536604875">"Upari"</string>
     <string name="bluetooth_pairing_accept_all_caps" msgid="6061699265220789149">"UPARI"</string>
     <string name="bluetooth_pairing_decline" msgid="4185420413578948140">"Otkai"</string>
-    <string name="bluetooth_pairing_will_share_phonebook" msgid="4982239145676394429">"Uparivanje odobrava pristup kontaktima i istoriji poziva kada je uspostavljeno."</string>
-    <string name="bluetooth_pairing_error_message" msgid="3748157733635947087">"Nije se mogue upariti s ureajem <xliff:g id="DEVICE_NAME">%1$s</xliff:g>."</string>
-    <string name="bluetooth_pairing_pin_error_message" msgid="8337234855188925274">"Nije se mogue upariti s ureajem <xliff:g id="DEVICE_NAME">%1$s</xliff:g> zbog pogrenog PIN-a ili pristupnog koda."</string>
-    <string name="bluetooth_pairing_device_down_error_message" msgid="7870998403045801381">"Ne moe komunicirati sa ureajem <xliff:g id="DEVICE_NAME">%1$s</xliff:g>."</string>
+    <string name="bluetooth_pairing_will_share_phonebook" msgid="4982239145676394429">"Uparivanje odobrava pristup kontaktima i historiji poziva kada je uspostavljeno."</string>
+    <string name="bluetooth_pairing_error_message" msgid="3748157733635947087">"Nije mogue upariti s ureajem <xliff:g id="DEVICE_NAME">%1$s</xliff:g>."</string>
+    <string name="bluetooth_pairing_pin_error_message" msgid="8337234855188925274">"Nije mogue upariti s ureajem <xliff:g id="DEVICE_NAME">%1$s</xliff:g> zbog pogrenog PIN-a ili pristupnog koda."</string>
+    <string name="bluetooth_pairing_device_down_error_message" msgid="7870998403045801381">"Nije mogue komunicirati s ureajem <xliff:g id="DEVICE_NAME">%1$s</xliff:g>."</string>
     <string name="bluetooth_pairing_rejected_error_message" msgid="1648157108520832454">"Ureaj <xliff:g id="DEVICE_NAME">%1$s</xliff:g> je odbio uparivanje."</string>
     <string name="bluetooth_talkback_computer" msgid="4875089335641234463">"Raunar"</string>
     <string name="bluetooth_talkback_headset" msgid="5140152177885220949">"Slualice s mikrofonom"</string>
@@ -118,12 +118,12 @@
     <string name="bluetooth_hearingaid_right_pairing_message" msgid="1550373802309160891">"Uparivanje desnog slunog aparata"</string>
     <string name="bluetooth_hearingaid_left_battery_level" msgid="8797811465352097562">"Lijevi - <xliff:g id="BATTERY_LEVEL_AS_PERCENTAGE">%1$s</xliff:g> baterije"</string>
     <string name="bluetooth_hearingaid_right_battery_level" msgid="7309476148173459677">"Desni - <xliff:g id="BATTERY_LEVEL_AS_PERCENTAGE">%1$s</xliff:g> baterije"</string>
-    <string name="accessibility_wifi_off" msgid="1166761729660614716">"WiFi iskljuen."</string>
+    <string name="accessibility_wifi_off" msgid="1166761729660614716">"WiFi je iskljuen."</string>
     <string name="accessibility_no_wifi" msgid="8834610636137374508">"WiFi nije povezan."</string>
-    <string name="accessibility_wifi_one_bar" msgid="4869376278894301820">"WiFi jedna crtica."</string>
-    <string name="accessibility_wifi_two_bars" msgid="3569851234710034416">"WiFi dvije crtice."</string>
-    <string name="accessibility_wifi_three_bars" msgid="8134185644861380311">"WiFi tri crtice."</string>
-    <string name="accessibility_wifi_signal_full" msgid="7061045677694702">"WiFi puni signal."</string>
+    <string name="accessibility_wifi_one_bar" msgid="4869376278894301820">"WiFi signal ima jednu crtu."</string>
+    <string name="accessibility_wifi_two_bars" msgid="3569851234710034416">"WiFi signal ima dvije crte."</string>
+    <string name="accessibility_wifi_three_bars" msgid="8134185644861380311">"WiFi signal ima tri crte."</string>
+    <string name="accessibility_wifi_signal_full" msgid="7061045677694702">"WiFi signal je pun."</string>
     <string name="accessibility_wifi_security_type_none" msgid="1223747559986205423">"Otvorena mrea"</string>
     <string name="accessibility_wifi_security_type_secured" msgid="862921720418885331">"Sigurna mrea"</string>
     <string name="process_kernel_label" msgid="3916858646836739323">"Android OS"</string>
@@ -132,7 +132,7 @@
     <string name="tether_settings_title_usb" msgid="6688416425801386511">"Povezivanje mobitela USB-om"</string>
     <string name="tether_settings_title_wifi" msgid="3277144155960302049">"Prijenosna pristupna taka"</string>
     <string name="tether_settings_title_bluetooth" msgid="355855408317564420">"Dijeljenje Bluetooth veze"</string>
-    <string name="tether_settings_title_usb_bluetooth" msgid="5355828977109785001">"Dijeljenje veze"</string>
+    <string name="tether_settings_title_usb_bluetooth" msgid="5355828977109785001">"Povezivanje putem mobitela"</string>
     <string name="tether_settings_title_all" msgid="8356136101061143841">"Povezivanje putem mobitela i prijenosna pristupna taka"</string>
     <string name="managed_user_title" msgid="8109605045406748842">"Sve radne aplikacije"</string>
     <string name="user_guest" msgid="8475274842845401871">"Gost"</string>
@@ -145,7 +145,7 @@
     <string name="tts_default_rate_title" msgid="6030550998379310088">"Brzina govora"</string>
     <string name="tts_default_rate_summary" msgid="4061815292287182801">"Brzina kojom se izgovara tekst"</string>
     <string name="tts_default_pitch_title" msgid="6135942113172488671">"Visina"</string>
-    <string name="tts_default_pitch_summary" msgid="1944885882882650009">"Utjee na ton sintetiziranog govora"</string>
+    <string name="tts_default_pitch_summary" msgid="1944885882882650009">"Utie na ton sintetiziranog govora"</string>
     <string name="tts_default_lang_title" msgid="8018087612299820556">"Jezik"</string>
     <string name="tts_lang_use_system" msgid="2679252467416513208">"Koritenje sistemskog jezika"</string>
     <string name="tts_lang_not_selected" msgid="7395787019276734765">"Jezik nije izabran"</string>
@@ -187,7 +187,7 @@
     <string name="development_settings_summary" msgid="1815795401632854041">"Postavi opcije za razvoj aplikacija"</string>
     <string name="development_settings_not_available" msgid="4308569041701535607">"Opcije za programere nisu dostupne za ovog korisnika"</string>
     <string name="vpn_settings_not_available" msgid="956841430176985598">"VPN postavke nisu dostupne za ovog korisnika"</string>
-    <string name="tethering_settings_not_available" msgid="6765770438438291012">"Postavke za privezivanje nisu dostupne za ovog korisnika"</string>
+    <string name="tethering_settings_not_available" msgid="6765770438438291012">"Postavke za povezivanje putem mobitela nisu dostupne za ovog korisnika"</string>
     <string name="apn_settings_not_available" msgid="7873729032165324000">"Postavke za ime pristupne take nisu dostupne za ovog korisnika"</string>
     <string name="enable_adb" msgid="7982306934419797485">"Otklanjanje greaka putem ureaja spojenog na USB"</string>
     <string name="enable_adb_summary" msgid="4881186971746056635">"Nain rada za uklanjanje greaka kada je povezan USB"</string>
@@ -201,7 +201,7 @@
     <string name="oem_unlock_enable" msgid="6040763321967327691">"OEM otkljuavanje"</string>
     <string name="oem_unlock_enable_summary" msgid="4720281828891618376">"Dozvoli otkljuavanje bootloadera"</string>
     <string name="confirm_enable_oem_unlock_title" msgid="4802157344812385674">"elite li dozvoliti OEM otkljuavanje?"</string>
-    <string name="confirm_enable_oem_unlock_text" msgid="5517144575601647022">"UPOZORENJE: Funkcije zatite ovog ureaja nee funkcionisati dok je ova postavka ukljuena."</string>
+    <string name="confirm_enable_oem_unlock_text" msgid="5517144575601647022">"UPOZORENJE: Funkcije zatite ovog ureaja nee funkcionirati dok je ova postavka ukljuena."</string>
     <string name="mock_location_app" msgid="7966220972812881854">"Odaberite aplikaciju za lane lokacije"</string>
     <string name="mock_location_app_not_set" msgid="809543285495344223">"Aplikacija za lanu lokaciju nije postavljena"</string>
     <string name="mock_location_app_set" msgid="8966420655295102685">"Aplikacija za lane lokacije: <xliff:g id="APP_NAME">%1$s</xliff:g>"</string>
@@ -210,7 +210,7 @@
     <string name="wifi_verbose_logging" msgid="4203729756047242344">"Omogui detaljniju evidenciju za WiFi"</string>
     <string name="wifi_connected_mac_randomization" msgid="3168165236877957767">"Nasumini odabir MAC adrese pri povezivanju"</string>
     <string name="mobile_data_always_on" msgid="8774857027458200434">"Mobilna mrea za prijenos podataka je uvijek aktivna"</string>
-    <string name="tethering_hardware_offload" msgid="7470077827090325814">"Hardversko ubrzavanje dijeljenja veze"</string>
+    <string name="tethering_hardware_offload" msgid="7470077827090325814">"Hardversko ubrzavanje za povezivanje putem mobitela"</string>
     <string name="bluetooth_show_devices_without_names" msgid="4708446092962060176">"Prikai Bluetooth ureaje bez naziva"</string>
     <string name="bluetooth_disable_absolute_volume" msgid="2660673801947898809">"Onemogui apsolutnu jainu zvuka"</string>
     <string name="bluetooth_select_avrcp_version_string" msgid="3750059931120293633">"Bluetooth AVRCP verzija"</string>
@@ -220,7 +220,7 @@
     <string name="bluetooth_select_a2dp_codec_sample_rate" msgid="4788245703824623062">"Brzina uzorkovanja za Bluetooth audio"</string>
     <string name="bluetooth_select_a2dp_codec_sample_rate_dialog_title" msgid="8010380028880963535">"Aktivirajte Bluetooth Audio Codec\nOdabir: Brzina uzorkovanja"</string>
     <string name="bluetooth_select_a2dp_codec_bits_per_sample" msgid="2099645202720164141">"Bluetooth audio bitovi po uzorku"</string>
-    <string name="bluetooth_select_a2dp_codec_bits_per_sample_dialog_title" msgid="8063859754619484760">"Aktivirajte Bluetooth Audio Codec\nOdabir: Bitovi po semplu"</string>
+    <string name="bluetooth_select_a2dp_codec_bits_per_sample_dialog_title" msgid="8063859754619484760">"Aktivirajte Bluetooth Audio Codec\nOdabir: Bitovi po uzorku"</string>
     <string name="bluetooth_select_a2dp_codec_channel_mode" msgid="884855779449390540">"Nain Bluetooth audio kanala"</string>
     <string name="bluetooth_select_a2dp_codec_channel_mode_dialog_title" msgid="7234956835280563341">"Aktivirajte Bluetooth Audio Codec\nOdabir: Nain rada po kanalima"</string>
     <string name="bluetooth_select_a2dp_codec_ldac_playback_quality" msgid="3619694372407843405">"Bluetooth Audio LDAC kodek: Kvalitet reprodukcije"</string>
@@ -249,7 +249,7 @@
     <string name="allow_mock_location" msgid="2787962564578664888">"Dozvoli lane lokacije"</string>
     <string name="allow_mock_location_summary" msgid="317615105156345626">"Dozvoli lane lokacije"</string>
     <string name="debug_view_attributes" msgid="6485448367803310384">"Omogui pregled atributa prikaza"</string>
-    <string name="mobile_data_always_on_summary" msgid="8149773901431697910">"Uvijek dri prijenos podataka na mobilnoj mrei aktivnim, ak i kada je WiFi je aktivan (za brzo prebacivanje izmeu mrea)."</string>
+    <string name="mobile_data_always_on_summary" msgid="8149773901431697910">"Uvijek dri prijenos podataka na mobilnoj mrei aktivnim, ak i kada je WiFi aktivan (za brzo prebacivanje izmeu mrea)."</string>
     <string name="tethering_hardware_offload_summary" msgid="7726082075333346982">"Koristi hardversko ubrzavanje dijeljenja veze, ako je dostupno"</string>
     <string name="adb_warning_title" msgid="6234463310896563253">"Omoguiti otklanjanje greaka putem ureaja spojenog na USB?"</string>
     <string name="adb_warning_message" msgid="7316799925425402244">"Otklanjanje greaka putem ureaja spojenog na USB je namijenjeno samo u svrhe razvoja aplikacija. Koristite ga za kopiranje podataka izmeu raunara i ureaja, instaliranje aplikacija na ureaj bez obavjetenja te itanje podataka iz zapisnika."</string>
@@ -277,7 +277,7 @@
     <string name="debug_hw_drawing_category" msgid="6220174216912308658">"Prikaz s hardverskom akceleracijom"</string>
     <string name="media_category" msgid="4388305075496848353">"Mediji"</string>
     <string name="debug_monitoring_category" msgid="7640508148375798343">"Praenje"</string>
-    <string name="strict_mode" msgid="1938795874357830695">"Omoguen strogi reim"</string>
+    <string name="strict_mode" msgid="1938795874357830695">"Omoguen strogi nain rada"</string>
     <string name="strict_mode_summary" msgid="142834318897332338">"Prikai ekran uz treptanje kada aplikacije vre duge operacije u glavnoj niti"</string>
     <string name="pointer_location" msgid="6084434787496938001">"Lokacija pokazivaa"</string>
     <string name="pointer_location_summary" msgid="840819275172753713">"Trenutni podaci o dodirivanju prikazuju se u nadsloju preko ekrana"</string>
@@ -298,8 +298,8 @@
     <string name="usb_audio_disable_routing_summary" msgid="980282760277312264">"Onemogui autom. usmjerav. na USB audio periferije"</string>
     <string name="debug_layout" msgid="5981361776594526155">"Prikai granice rasporeda"</string>
     <string name="debug_layout_summary" msgid="2001775315258637682">"Prikai granice isjeka, margine itd."</string>
-    <string name="force_rtl_layout_all_locales" msgid="2259906643093138978">"Prisilno postavi raspored s desna u lijevo"</string>
-    <string name="force_rtl_layout_all_locales_summary" msgid="9192797796616132534">"Prisilno postavi raspored ekrana s desna u lijevo za sve regije"</string>
+    <string name="force_rtl_layout_all_locales" msgid="2259906643093138978">"Prisilno postavi raspored s desna ulijevo"</string>
+    <string name="force_rtl_layout_all_locales_summary" msgid="9192797796616132534">"Prisilno postavi raspored ekrana s desna ulijevo za sve regije"</string>
     <string name="force_hw_ui" msgid="6426383462520888732">"Prisili GPU iscrtavanje"</string>
     <string name="force_hw_ui_summary" msgid="5535991166074861515">"Prisilno koristi GPU za 2d crtanje"</string>
     <string name="force_msaa" msgid="7920323238677284387">"Prinudno primijeni 4x MSAA"</string>
@@ -323,19 +323,19 @@
     <string name="force_allow_on_external" msgid="3215759785081916381">"Nametni aplikacije na vanjskoj pohrani"</string>
     <string name="force_allow_on_external_summary" msgid="3640752408258034689">"Omoguava upisivanje svih aplikacija u vanjsku pohranu, bez obzira na prikazane vrijednosti"</string>
     <string name="force_resizable_activities" msgid="8615764378147824985">"Nametni aktivnostima mijenjanje veliina"</string>
-    <string name="force_resizable_activities_summary" msgid="6667493494706124459">"Omogui mijenjanje veliine svih aktivnosti za prikaz sa vie prozora, bez obzira na prikazane vrijednosti."</string>
+    <string name="force_resizable_activities_summary" msgid="6667493494706124459">"Omogui mijenjanje veliine svih aktivnosti za prikaz s vie prozora, bez obzira na prikazane vrijednosti."</string>
     <string name="enable_freeform_support" msgid="1461893351278940416">"Omogui prozore nepravilnih oblika"</string>
     <string name="enable_freeform_support_summary" msgid="8247310463288834487">"Omogui podrku za eksperimentalne prozore nepravilnih oblika."</string>
     <string name="local_backup_password_title" msgid="3860471654439418822">"Lozinka za sigurnosnu kopiju radne povrine"</string>
     <string name="local_backup_password_summary_none" msgid="6951095485537767956">"Potpune sigurnosne kopije za raunare trenutno nisu zatiene"</string>
-    <string name="local_backup_password_summary_change" msgid="5376206246809190364">"Dodirnite da promijenite ili uklonite lozinku za potpune rezervne kopije sa radne povrine"</string>
-    <string name="local_backup_password_toast_success" msgid="582016086228434290">"Nova lozinka za sigurnosnu kopiju postavljena"</string>
+    <string name="local_backup_password_summary_change" msgid="5376206246809190364">"Dodirnite da promijenite ili uklonite lozinku za potpune rezervne kopije s radne povrine"</string>
+    <string name="local_backup_password_toast_success" msgid="582016086228434290">"Nova lozinka za sigurnosnu kopiju je postavljena"</string>
     <string name="local_backup_password_toast_confirmation_mismatch" msgid="7805892532752708288">"Nova lozinka i potvrda se ne podudaraju"</string>
     <string name="local_backup_password_toast_validation_failure" msgid="5646377234895626531">"Nije uspjelo postavljanje lozinke za sigurnosnu kopiju"</string>
   <string-array name="color_mode_names">
-    <item msgid="2425514299220523812">"ivopisan (zadano)"</item>
+    <item msgid="2425514299220523812">"ivopisno (zadano)"</item>
     <item msgid="8446070607501413455">"Prirodan"</item>
-    <item msgid="6553408765810699025">"Standardni"</item>
+    <item msgid="6553408765810699025">"Standardno"</item>
   </string-array>
   <string-array name="color_mode_descriptions">
     <item msgid="4979629397075120893">"Unaprijeene boje"</item>
@@ -355,9 +355,9 @@
     <string name="convert_to_file_encryption_enabled" msgid="2861258671151428346">"Pretvaranje"</string>
     <string name="convert_to_file_encryption_done" msgid="7859766358000523953">"Fajl je ve ifriran"</string>
     <string name="title_convert_fbe" msgid="1263622876196444453">"Pretvaranje u ifrirane fajlove"</string>
-    <string name="convert_to_fbe_warning" msgid="6139067817148865527">"Pretvorite particiju sa podacima u particiju ifriranu sistemom fajlova.\n !! Upozorenje!! Ovo e izbrisati sve vae podatke.\n Ova funkcija je u alfa fazi razvoja i moda nee ispravno raditi.\n Pritisnite \"Obrii i pretvori\" da nastavite."</string>
+    <string name="convert_to_fbe_warning" msgid="6139067817148865527">"Pretvorite particiju s podacima u particiju ifriranu sistemom fajlova.\n !! Upozorenje!! Ovo e izbrisati sve vae podatke.\n Ova funkcija je u alfa fazi razvoja i moda nee ispravno raditi.\n Pritisnite \"Obrii i pretvori\" da nastavite."</string>
     <string name="button_convert_fbe" msgid="5152671181309826405">"Obrii i pretvori"</string>
-    <string name="picture_color_mode" msgid="4560755008730283695">"Reim boja Slika"</string>
+    <string name="picture_color_mode" msgid="4560755008730283695">"Nain rada boja slika"</string>
     <string name="picture_color_mode_desc" msgid="1141891467675548590">"Koristi sRGB"</string>
     <string name="daltonizer_mode_disabled" msgid="7482661936053801862">"Onemogueno"</string>
     <string name="daltonizer_mode_monochromacy" msgid="8485709880666106721">"Crno-bijelo"</string>
@@ -424,8 +424,8 @@
     <string name="retail_demo_reset_title" msgid="696589204029930100">"Potrebna je lozinka"</string>
     <string name="active_input_method_subtypes" msgid="3596398805424733238">"Aktivne metode unosa"</string>
     <string name="use_system_language_to_select_input_method_subtypes" msgid="5747329075020379587">"Koristi jezik sistema"</string>
-    <string name="failed_to_open_app_settings_toast" msgid="1251067459298072462">"Nije uspjelo otvaranje postavki za <xliff:g id="SPELL_APPLICATION_NAME">%1$s</xliff:g>"</string>
-    <string name="ime_security_warning" msgid="4135828934735934248">"Ovaj nain unosa moe prikupiti sav tekst koji otkucate, ukljuujui line podatke kao to su lozinke i brojevi kreditnih kartica. Nain omoguava aplikacija <xliff:g id="IME_APPLICATION_NAME">%1$s</xliff:g>. Da li elite koristiti ovaj nain unosa?"</string>
+    <string name="failed_to_open_app_settings_toast" msgid="1251067459298072462">"Otvaranje postavki za <xliff:g id="SPELL_APPLICATION_NAME">%1$s</xliff:g> nije uspjelo"</string>
+    <string name="ime_security_warning" msgid="4135828934735934248">"Ovaj nain unosa moe prikupiti sav tekst koji upiete, ukljuujui line podatke kao to su lozinke i brojevi kreditnih kartica. Nain omoguava aplikacija <xliff:g id="IME_APPLICATION_NAME">%1$s</xliff:g>. Da li elite koristiti ovaj nain unosa?"</string>
     <string name="direct_boot_unaware_dialog_message" msgid="7870273558547549125">"Napomena: Nakon ponovnog pokretanja, ova aplikacija se nee moi pokrenuti dok ne otkljuate telefon"</string>
     <string name="ims_reg_title" msgid="7609782759207241443">"Stanje IMS registracije"</string>
     <string name="ims_reg_status_registered" msgid="933003316932739188">"Registrirano"</string>
diff --git a/packages/SettingsLib/res/values-ca/strings.xml b/packages/SettingsLib/res/values-ca/strings.xml
index 511ac70e448..745d6fcae27 100644
--- a/packages/SettingsLib/res/values-ca/strings.xml
+++ b/packages/SettingsLib/res/values-ca/strings.xml
@@ -400,8 +400,8 @@
     <string name="enabled_by_admin" msgid="5302986023578399263">"Activada per l\'administrador"</string>
     <string name="disabled_by_admin" msgid="8505398946020816620">"Desactivada per l\'administrador"</string>
     <string name="disabled" msgid="9206776641295849915">"Desactivat"</string>
-    <string name="external_source_trusted" msgid="2707996266575928037">"Permeses"</string>
-    <string name="external_source_untrusted" msgid="2677442511837596726">"No permeses"</string>
+    <string name="external_source_trusted" msgid="2707996266575928037">"Amb perms"</string>
+    <string name="external_source_untrusted" msgid="2677442511837596726">"Sense perms"</string>
     <string name="install_other_apps" msgid="6986686991775883017">"Installar aplicacions desconegudes"</string>
     <string name="home" msgid="3256884684164448244">"Pgina d\'inici de configuraci"</string>
   <string-array name="battery_labels">
diff --git a/packages/SettingsLib/res/values-es/strings.xml b/packages/SettingsLib/res/values-es/strings.xml
index 2496717e8c0..a9c164b8a00 100644
--- a/packages/SettingsLib/res/values-es/strings.xml
+++ b/packages/SettingsLib/res/values-es/strings.xml
@@ -217,8 +217,8 @@
     <string name="bluetooth_select_avrcp_version_dialog_title" msgid="7277329668298705702">"Selecciona la versin AVRCP del Bluetooth"</string>
     <string name="bluetooth_select_a2dp_codec_type" msgid="90597356942154882">"Cdec de audio de Bluetooth"</string>
     <string name="bluetooth_select_a2dp_codec_type_dialog_title" msgid="8436224899475822557">"Activar el cdec de audio por Bluetooth\nSeleccin"</string>
-    <string name="bluetooth_select_a2dp_codec_sample_rate" msgid="4788245703824623062">"Porcentaje de muestreo de audio por Bluetooth"</string>
-    <string name="bluetooth_select_a2dp_codec_sample_rate_dialog_title" msgid="8010380028880963535">"Activar el cdec de audio por Bluetooth\nSeleccin: porcentaje de muestreo"</string>
+    <string name="bluetooth_select_a2dp_codec_sample_rate" msgid="4788245703824623062">"Frecuencia de muestreo de audio por Bluetooth"</string>
+    <string name="bluetooth_select_a2dp_codec_sample_rate_dialog_title" msgid="8010380028880963535">"Activar el cdec de audio por Bluetooth\nSeleccin: frecuencia de muestreo"</string>
     <string name="bluetooth_select_a2dp_codec_bits_per_sample" msgid="2099645202720164141">"Bits por muestra del audio Bluetooth"</string>
     <string name="bluetooth_select_a2dp_codec_bits_per_sample_dialog_title" msgid="8063859754619484760">"Activar el cdec de audio por Bluetooth\nSeleccin: bits por muestra"</string>
     <string name="bluetooth_select_a2dp_codec_channel_mode" msgid="884855779449390540">"Modo de canal de audio por Bluetooth"</string>
@@ -238,7 +238,7 @@
     <string name="wifi_connected_mac_randomization_summary" msgid="1743059848752201485">"Ordenar las direccionesMAC de forma aleatoria al conectarse a redes WiFi"</string>
     <string name="wifi_metered_label" msgid="4514924227256839725">"Medida"</string>
     <string name="wifi_unmetered_label" msgid="6124098729457992931">"No medida"</string>
-    <string name="select_logd_size_title" msgid="7433137108348553508">"Tamaos de bfer de registrador"</string>
+    <string name="select_logd_size_title" msgid="7433137108348553508">"Tamaos del bfer para registrar"</string>
     <string name="select_logd_size_dialog_title" msgid="1206769310236476760">"Elige el tamao del Logger por bfer"</string>
     <string name="dev_logpersist_clear_warning_title" msgid="684806692440237967">"Borrar almacenamiento continuo del registrador?"</string>
     <string name="dev_logpersist_clear_warning_message" msgid="2256582531342994562">"Cuando ya no supervisamos la actividad con el registrador de forma continua, estamos obligados a borrar los datos del registrador almacenados en el dispositivo."</string>
diff --git a/packages/SettingsLib/res/values-fa/strings.xml b/packages/SettingsLib/res/values-fa/strings.xml
index c58b52efbdf..317f71eeed9 100644
--- a/packages/SettingsLib/res/values-fa/strings.xml
+++ b/packages/SettingsLib/res/values-fa/strings.xml
@@ -159,7 +159,7 @@
     <string name="tts_default_sample_string" msgid="4040835213373086322">"     "</string>
     <string name="tts_status_title" msgid="7268566550242584413">"  "</string>
     <string name="tts_status_ok" msgid="1309762510278029765">"<xliff:g id="LOCALE">%1$s</xliff:g>   "</string>
-    <string name="tts_status_requires_network" msgid="6042500821503226892">"<xliff:g id="LOCALE">%1$s</xliff:g>     "</string>
+    <string name="tts_status_requires_network" msgid="6042500821503226892">"<xliff:g id="LOCALE">%1$s</xliff:g>     "</string>
     <string name="tts_status_not_supported" msgid="4491154212762472495">"<xliff:g id="LOCALE">%1$s</xliff:g>  "</string>
     <string name="tts_status_checking" msgid="5339150797940483592">"  "</string>
     <string name="tts_engine_settings_title" msgid="3499112142425680334">"  <xliff:g id="TTS_ENGINE_NAME">%s</xliff:g>"</string>
diff --git a/packages/SettingsLib/res/values-gl/arrays.xml b/packages/SettingsLib/res/values-gl/arrays.xml
index a25d1360290..f8a69c210d8 100644
--- a/packages/SettingsLib/res/values-gl/arrays.xml
+++ b/packages/SettingsLib/res/values-gl/arrays.xml
@@ -207,17 +207,17 @@
   </string-array>
   <string-array name="overlay_display_devices_entries">
     <item msgid="1606809880904982133">"Ningunha"</item>
-    <item msgid="9033194758688161545">"480 p"</item>
-    <item msgid="1025306206556583600">"480 p (seguro)"</item>
-    <item msgid="1853913333042744661">"720 p"</item>
-    <item msgid="3414540279805870511">"720 p (seguro)"</item>
-    <item msgid="9039818062847141551">"1080 p"</item>
-    <item msgid="4939496949750174834">"1080 p (seguro)"</item>
+    <item msgid="9033194758688161545">"480p"</item>
+    <item msgid="1025306206556583600">"480p (seguro)"</item>
+    <item msgid="1853913333042744661">"720p"</item>
+    <item msgid="3414540279805870511">"720p (seguro)"</item>
+    <item msgid="9039818062847141551">"1080p"</item>
+    <item msgid="4939496949750174834">"1080p (seguro)"</item>
     <item msgid="1833612718524903568">"4K"</item>
     <item msgid="238303513127879234">"4K (seguro)"</item>
     <item msgid="3547211260846843098">"4K (mellorado)"</item>
     <item msgid="5411365648951414254">"4K (mellorado e seguro)"</item>
-    <item msgid="1311305077526792901">"720 p, 1080 p (pantalla dual)"</item>
+    <item msgid="1311305077526792901">"720p, 1080p (pantalla dual)"</item>
   </string-array>
   <string-array name="enable_opengl_traces_entries">
     <item msgid="3191973083884253830">"Ningn"</item>
diff --git a/packages/SettingsLib/res/values-gl/strings.xml b/packages/SettingsLib/res/values-gl/strings.xml
index 1705f3a321e..06cf14f7ad9 100644
--- a/packages/SettingsLib/res/values-gl/strings.xml
+++ b/packages/SettingsLib/res/values-gl/strings.xml
@@ -110,7 +110,7 @@
     <string name="bluetooth_talkback_computer" msgid="4875089335641234463">"Ordenador"</string>
     <string name="bluetooth_talkback_headset" msgid="5140152177885220949">"Auriculares con micrfono"</string>
     <string name="bluetooth_talkback_phone" msgid="4260255181240622896">"Telfono"</string>
-    <string name="bluetooth_talkback_imaging" msgid="551146170554589119">"Imaxes"</string>
+    <string name="bluetooth_talkback_imaging" msgid="551146170554589119">"Dispositivo de imaxe"</string>
     <string name="bluetooth_talkback_headphone" msgid="26580326066627664">"Auriculares"</string>
     <string name="bluetooth_talkback_input_peripheral" msgid="5165842622743212268">"Perifrico de entrada"</string>
     <string name="bluetooth_talkback_bluetooth" msgid="5615463912185280812">"Bluetooth"</string>
@@ -213,8 +213,8 @@
     <string name="tethering_hardware_offload" msgid="7470077827090325814">"Aceleracin de hardware para conexin compartida"</string>
     <string name="bluetooth_show_devices_without_names" msgid="4708446092962060176">"Mostrar dispositivos Bluetooth sen nomes"</string>
     <string name="bluetooth_disable_absolute_volume" msgid="2660673801947898809">"Desactivar volume absoluto"</string>
-    <string name="bluetooth_select_avrcp_version_string" msgid="3750059931120293633">"Versin AVRCP de Bluetooth"</string>
-    <string name="bluetooth_select_avrcp_version_dialog_title" msgid="7277329668298705702">"Selecciona a versin AVRCP de Bluetooth"</string>
+    <string name="bluetooth_select_avrcp_version_string" msgid="3750059931120293633">"Versin de Bluetooth AVRCP"</string>
+    <string name="bluetooth_select_avrcp_version_dialog_title" msgid="7277329668298705702">"Selecciona a versin de Bluetooth AVRCP"</string>
     <string name="bluetooth_select_a2dp_codec_type" msgid="90597356942154882">"Cdec de audio por Bluetooth"</string>
     <string name="bluetooth_select_a2dp_codec_type_dialog_title" msgid="8436224899475822557">"Activar cdec de audio por Bluetooth\nSeleccin"</string>
     <string name="bluetooth_select_a2dp_codec_sample_rate" msgid="4788245703824623062">"Taxa de mostraxe de audio por Bluetooth"</string>
@@ -355,8 +355,8 @@
     <string name="convert_to_file_encryption_enabled" msgid="2861258671151428346">"Converter..."</string>
     <string name="convert_to_file_encryption_done" msgid="7859766358000523953">"Xa se encriptou o ficheiro"</string>
     <string name="title_convert_fbe" msgid="1263622876196444453">"Convertendo no encriptado baseado en ficheiros"</string>
-    <string name="convert_to_fbe_warning" msgid="6139067817148865527">"Converte a particin de datos nunha encriptacin baseada en ficheiros.\n Advertencia: Esta accin borrar todos os datos.\n Esta funcin  alfa e quizais non funcione correctamente.\n Para continuar, toca Limpar e converter..."</string>
-    <string name="button_convert_fbe" msgid="5152671181309826405">"Limpar e converter..."</string>
+    <string name="convert_to_fbe_warning" msgid="6139067817148865527">"Converte a particin de datos nunha encriptacin baseada en ficheiros.\n Advertencia: Esta accin borrar todos os datos.\n Esta funcin  alfa e quizais non funcione correctamente.\n Para continuar, toca Borrar e converter..."</string>
+    <string name="button_convert_fbe" msgid="5152671181309826405">"Borrar e converter..."</string>
     <string name="picture_color_mode" msgid="4560755008730283695">"Modo de cor da imaxe"</string>
     <string name="picture_color_mode_desc" msgid="1141891467675548590">"Utiliza sRGB"</string>
     <string name="daltonizer_mode_disabled" msgid="7482661936053801862">"Desactivado"</string>
diff --git a/packages/SettingsLib/res/values-ja/strings.xml b/packages/SettingsLib/res/values-ja/strings.xml
index 8bf0335bbfe..0ecb8010128 100644
--- a/packages/SettingsLib/res/values-ja/strings.xml
+++ b/packages/SettingsLib/res/values-ja/strings.xml
@@ -141,7 +141,7 @@
     <string name="launch_defaults_some" msgid="313159469856372621">""</string>
     <string name="launch_defaults_none" msgid="4241129108140034876">""</string>
     <string name="tts_settings" msgid="8186971894801348327">""</string>
-    <string name="tts_settings_title" msgid="1237820681016639683">""</string>
+    <string name="tts_settings_title" msgid="1237820681016639683">""</string>
     <string name="tts_default_rate_title" msgid="6030550998379310088">""</string>
     <string name="tts_default_rate_summary" msgid="4061815292287182801">""</string>
     <string name="tts_default_pitch_title" msgid="6135942113172488671">""</string>
diff --git a/packages/SettingsLib/res/values-nb/strings.xml b/packages/SettingsLib/res/values-nb/strings.xml
index b5163e04468..2753891108c 100644
--- a/packages/SettingsLib/res/values-nb/strings.xml
+++ b/packages/SettingsLib/res/values-nb/strings.xml
@@ -309,7 +309,7 @@
     <string name="enable_gpu_debug_layers" msgid="3848838293793255097">"Sl p GPU-feilskingslag"</string>
     <string name="enable_gpu_debug_layers_summary" msgid="8009136940671194940">"Tillat GPU-feilskingslag for feilskingsapper"</string>
     <string name="window_animation_scale_title" msgid="6162587588166114700">"Animasjonsskala for vindu"</string>
-    <string name="transition_animation_scale_title" msgid="387527540523595875">"Overgangsanimasjonsskala"</string>
+    <string name="transition_animation_scale_title" msgid="387527540523595875">"Animasjonsskala for overgang"</string>
     <string name="animator_duration_scale_title" msgid="3406722410819934083">"Varighetsskala for animasjon"</string>
     <string name="overlay_display_devices_title" msgid="5364176287998398539">"Simulering av sekundrskjermer"</string>
     <string name="debug_applications_category" msgid="4206913653849771549">"Apper"</string>
diff --git a/packages/SettingsLib/res/values-ne/strings.xml b/packages/SettingsLib/res/values-ne/strings.xml
index 5ae52989613..3242291b94c 100644
--- a/packages/SettingsLib/res/values-ne/strings.xml
+++ b/packages/SettingsLib/res/values-ne/strings.xml
@@ -322,7 +322,7 @@
     <string name="show_notification_channel_warnings_summary" msgid="5536803251863694895">"          "</string>
     <string name="force_allow_on_external" msgid="3215759785081916381">"     "</string>
     <string name="force_allow_on_external_summary" msgid="3640752408258034689">"            "</string>
-    <string name="force_resizable_activities" msgid="8615764378147824985">"     "</string>
+    <string name="force_resizable_activities" msgid="8615764378147824985">"       "</string>
     <string name="force_resizable_activities_summary" msgid="6667493494706124459">"   , -       "</string>
     <string name="enable_freeform_support" msgid="1461893351278940416">"   "</string>
     <string name="enable_freeform_support_summary" msgid="8247310463288834487">"      "</string>
diff --git a/packages/SettingsLib/res/values-nl/strings.xml b/packages/SettingsLib/res/values-nl/strings.xml
index f557f44c820..6dec8df0a78 100644
--- a/packages/SettingsLib/res/values-nl/strings.xml
+++ b/packages/SettingsLib/res/values-nl/strings.xml
@@ -308,8 +308,8 @@
     <string name="track_frame_time" msgid="6146354853663863443">"GPU-rendering van profiel"</string>
     <string name="enable_gpu_debug_layers" msgid="3848838293793255097">"GPU-foutopsporingslagen inschakelen"</string>
     <string name="enable_gpu_debug_layers_summary" msgid="8009136940671194940">"Laden van GPU-foutopsporingslagen toestaan voor foutopsporingsapps"</string>
-    <string name="window_animation_scale_title" msgid="6162587588166114700">"Vensteranimatieschaal"</string>
-    <string name="transition_animation_scale_title" msgid="387527540523595875">"Overgangsanimatieschaal"</string>
+    <string name="window_animation_scale_title" msgid="6162587588166114700">"Vensteranimatieschaal"</string>
+    <string name="transition_animation_scale_title" msgid="387527540523595875">"Overgangsanimatieschaal"</string>
     <string name="animator_duration_scale_title" msgid="3406722410819934083">"Duur van animatieschaal"</string>
     <string name="overlay_display_devices_title" msgid="5364176287998398539">"Secundaire displays simuleren"</string>
     <string name="debug_applications_category" msgid="4206913653849771549">"Apps"</string>
diff --git a/packages/SettingsLib/res/values-or/strings.xml b/packages/SettingsLib/res/values-or/strings.xml
index 6f480bd02f3..24b80452dc7 100644
--- a/packages/SettingsLib/res/values-or/strings.xml
+++ b/packages/SettingsLib/res/values-or/strings.xml
@@ -224,8 +224,7 @@
     <string name="bluetooth_select_a2dp_codec_channel_mode" msgid="884855779449390540">"-   "</string>
     <string name="bluetooth_select_a2dp_codec_channel_mode_dialog_title" msgid="7234956835280563341">"-  \n  :  "</string>
     <string name="bluetooth_select_a2dp_codec_ldac_playback_quality" msgid="3619694372407843405">"-  LDAC :  "</string>
-    <!-- no translation found for bluetooth_select_a2dp_codec_ldac_playback_quality_dialog_title (6893955536658137179) -->
-    <skip />
+    <string name="bluetooth_select_a2dp_codec_ldac_playback_quality_dialog_title" msgid="6893955536658137179">"- LDAC\n   :  "</string>
     <string name="bluetooth_select_a2dp_codec_streaming_label" msgid="5347862512596240506">" : <xliff:g id="STREAMING_PARAMETER">%1$s</xliff:g>"</string>
     <string name="select_private_dns_configuration_title" msgid="3700456559305263922">" DNS"</string>
     <string name="select_private_dns_configuration_dialog_title" msgid="9221994415765826811">" DNS  "</string>
diff --git a/packages/SettingsLib/res/values-pl/strings.xml b/packages/SettingsLib/res/values-pl/strings.xml
index c78db273511..85b1aaf270d 100644
--- a/packages/SettingsLib/res/values-pl/strings.xml
+++ b/packages/SettingsLib/res/values-pl/strings.xml
@@ -194,7 +194,7 @@
     <string name="clear_adb_keys" msgid="4038889221503122743">"Odwoaj dostp do debugowania USB"</string>
     <string name="bugreport_in_power" msgid="7923901846375587241">"Skrt do zgoszenia bdu"</string>
     <string name="bugreport_in_power_summary" msgid="1778455732762984579">"Poka w menu zasilania przycisk zgaszania bdu"</string>
-    <string name="keep_screen_on" msgid="1146389631208760344">"Pozostaw ekran wczony"</string>
+    <string name="keep_screen_on" msgid="1146389631208760344">"Pozostaw wczony ekran"</string>
     <string name="keep_screen_on_summary" msgid="2173114350754293009">"Ekran nie bdzie gaszony podczas adowania telefonu"</string>
     <string name="bt_hci_snoop_log" msgid="3340699311158865670">"Wcz dziennik snoop Bluetooth HCI"</string>
     <string name="bt_hci_snoop_log_summary" msgid="366083475849911315">"Przechwy wszystkie pakiety Bluetooth HCI do pliku (przecz Bluetooth po zmianie tego ustawienia)"</string>
diff --git a/packages/SettingsLib/res/values-pt-rBR/arrays.xml b/packages/SettingsLib/res/values-pt-rBR/arrays.xml
index dfdc09c2cb1..563698a42da 100644
--- a/packages/SettingsLib/res/values-pt-rBR/arrays.xml
+++ b/packages/SettingsLib/res/values-pt-rBR/arrays.xml
@@ -160,11 +160,11 @@
   </string-array>
   <string-array name="select_logd_size_summaries">
     <item msgid="6921048829791179331">"Desativado"</item>
-    <item msgid="2969458029344750262">"64 K/buffer de log"</item>
-    <item msgid="1342285115665698168">"256 K/buffer de log"</item>
-    <item msgid="1314234299552254621">"1 M/buffer de log"</item>
-    <item msgid="3606047780792894151">"4 M/buffer de log"</item>
-    <item msgid="5431354956856655120">"16 M/buffer de log"</item>
+    <item msgid="2969458029344750262">"64 K/buffer de registro"</item>
+    <item msgid="1342285115665698168">"256 K/buffer de registro"</item>
+    <item msgid="1314234299552254621">"1 M/buffer de registro"</item>
+    <item msgid="3606047780792894151">"4 M/buffer de registro"</item>
+    <item msgid="5431354956856655120">"16 M/buffer de registro"</item>
   </string-array>
   <string-array name="select_logpersist_titles">
     <item msgid="1744840221860799971">"Desativado"</item>
diff --git a/packages/SettingsLib/res/values-pt-rBR/strings.xml b/packages/SettingsLib/res/values-pt-rBR/strings.xml
index 17bce0e4d46..8d5dbe13367 100644
--- a/packages/SettingsLib/res/values-pt-rBR/strings.xml
+++ b/packages/SettingsLib/res/values-pt-rBR/strings.xml
@@ -195,8 +195,8 @@
     <string name="bugreport_in_power" msgid="7923901846375587241">"Atalho para relatrio do bug"</string>
     <string name="bugreport_in_power_summary" msgid="1778455732762984579">"Mostrar um boto para gerar relatrios de bugs no menu do boto liga/desliga"</string>
     <string name="keep_screen_on" msgid="1146389631208760344">"Permanecer ativo"</string>
-    <string name="keep_screen_on_summary" msgid="2173114350754293009">"A tela nunca entrar em inatividade enquanto estiver carregando."</string>
-    <string name="bt_hci_snoop_log" msgid="3340699311158865670">"Ativar log de rastreamento Bluetooth HCI"</string>
+    <string name="keep_screen_on_summary" msgid="2173114350754293009">"A tela nunca entrar em suspenso enquanto estiver carregando."</string>
+    <string name="bt_hci_snoop_log" msgid="3340699311158865670">"Ativar registro de rastreamento Bluetooth HCI"</string>
     <string name="bt_hci_snoop_log_summary" msgid="366083475849911315">"Capturar todos os pacotes Bluetooth HCI em um arquivo (ative o Bluetooth depois de alterar esta configurao)"</string>
     <string name="oem_unlock_enable" msgid="6040763321967327691">"Desbloqueio de OEM"</string>
     <string name="oem_unlock_enable_summary" msgid="4720281828891618376">"Permitir que o bootloader seja desbloqueado"</string>
@@ -239,7 +239,7 @@
     <string name="wifi_metered_label" msgid="4514924227256839725">"Limitada"</string>
     <string name="wifi_unmetered_label" msgid="6124098729457992931">"Ilimitada"</string>
     <string name="select_logd_size_title" msgid="7433137108348553508">"Tamanhos de buffer de logger"</string>
-    <string name="select_logd_size_dialog_title" msgid="1206769310236476760">"Sel. tam. de logger/buffer de log"</string>
+    <string name="select_logd_size_dialog_title" msgid="1206769310236476760">"Sel. tam. de logger/buffer de registro"</string>
     <string name="dev_logpersist_clear_warning_title" msgid="684806692440237967">"Limpar armazenamento de logger constante?"</string>
     <string name="dev_logpersist_clear_warning_message" msgid="2256582531342994562">"Quando no estivermos mais monitorando com o logger constante, devemos limpar o residente de dados de logger do seu dispositivo."</string>
     <string name="select_logpersist_title" msgid="7530031344550073166">"Armazenar dados de logger constantemente no dispositivo"</string>
diff --git a/packages/SettingsLib/res/values-pt/arrays.xml b/packages/SettingsLib/res/values-pt/arrays.xml
index dfdc09c2cb1..563698a42da 100644
--- a/packages/SettingsLib/res/values-pt/arrays.xml
+++ b/packages/SettingsLib/res/values-pt/arrays.xml
@@ -160,11 +160,11 @@
   </string-array>
   <string-array name="select_logd_size_summaries">
     <item msgid="6921048829791179331">"Desativado"</item>
-    <item msgid="2969458029344750262">"64 K/buffer de log"</item>
-    <item msgid="1342285115665698168">"256 K/buffer de log"</item>
-    <item msgid="1314234299552254621">"1 M/buffer de log"</item>
-    <item msgid="3606047780792894151">"4 M/buffer de log"</item>
-    <item msgid="5431354956856655120">"16 M/buffer de log"</item>
+    <item msgid="2969458029344750262">"64 K/buffer de registro"</item>
+    <item msgid="1342285115665698168">"256 K/buffer de registro"</item>
+    <item msgid="1314234299552254621">"1 M/buffer de registro"</item>
+    <item msgid="3606047780792894151">"4 M/buffer de registro"</item>
+    <item msgid="5431354956856655120">"16 M/buffer de registro"</item>
   </string-array>
   <string-array name="select_logpersist_titles">
     <item msgid="1744840221860799971">"Desativado"</item>
diff --git a/packages/SettingsLib/res/values-pt/strings.xml b/packages/SettingsLib/res/values-pt/strings.xml
index 17bce0e4d46..8d5dbe13367 100644
--- a/packages/SettingsLib/res/values-pt/strings.xml
+++ b/packages/SettingsLib/res/values-pt/strings.xml
@@ -195,8 +195,8 @@
     <string name="bugreport_in_power" msgid="7923901846375587241">"Atalho para relatrio do bug"</string>
     <string name="bugreport_in_power_summary" msgid="1778455732762984579">"Mostrar um boto para gerar relatrios de bugs no menu do boto liga/desliga"</string>
     <string name="keep_screen_on" msgid="1146389631208760344">"Permanecer ativo"</string>
-    <string name="keep_screen_on_summary" msgid="2173114350754293009">"A tela nunca entrar em inatividade enquanto estiver carregando."</string>
-    <string name="bt_hci_snoop_log" msgid="3340699311158865670">"Ativar log de rastreamento Bluetooth HCI"</string>
+    <string name="keep_screen_on_summary" msgid="2173114350754293009">"A tela nunca entrar em suspenso enquanto estiver carregando."</string>
+    <string name="bt_hci_snoop_log" msgid="3340699311158865670">"Ativar registro de rastreamento Bluetooth HCI"</string>
     <string name="bt_hci_snoop_log_summary" msgid="366083475849911315">"Capturar todos os pacotes Bluetooth HCI em um arquivo (ative o Bluetooth depois de alterar esta configurao)"</string>
     <string name="oem_unlock_enable" msgid="6040763321967327691">"Desbloqueio de OEM"</string>
     <string name="oem_unlock_enable_summary" msgid="4720281828891618376">"Permitir que o bootloader seja desbloqueado"</string>
@@ -239,7 +239,7 @@
     <string name="wifi_metered_label" msgid="4514924227256839725">"Limitada"</string>
     <string name="wifi_unmetered_label" msgid="6124098729457992931">"Ilimitada"</string>
     <string name="select_logd_size_title" msgid="7433137108348553508">"Tamanhos de buffer de logger"</string>
-    <string name="select_logd_size_dialog_title" msgid="1206769310236476760">"Sel. tam. de logger/buffer de log"</string>
+    <string name="select_logd_size_dialog_title" msgid="1206769310236476760">"Sel. tam. de logger/buffer de registro"</string>
     <string name="dev_logpersist_clear_warning_title" msgid="684806692440237967">"Limpar armazenamento de logger constante?"</string>
     <string name="dev_logpersist_clear_warning_message" msgid="2256582531342994562">"Quando no estivermos mais monitorando com o logger constante, devemos limpar o residente de dados de logger do seu dispositivo."</string>
     <string name="select_logpersist_title" msgid="7530031344550073166">"Armazenar dados de logger constantemente no dispositivo"</string>
diff --git a/packages/SettingsLib/res/values-ru/strings.xml b/packages/SettingsLib/res/values-ru/strings.xml
index 3e15ff3a7cf..97a17cb3cbf 100644
--- a/packages/SettingsLib/res/values-ru/strings.xml
+++ b/packages/SettingsLib/res/values-ru/strings.xml
@@ -56,7 +56,7 @@
     <string name="bluetooth_disconnecting" msgid="8913264760027764974">"..."</string>
     <string name="bluetooth_connecting" msgid="8555009514614320497">"..."</string>
     <string name="bluetooth_connected" msgid="5427152882755735944">"<xliff:g id="ACTIVE_DEVICE">%1$s</xliff:g>"</string>
-    <string name="bluetooth_pairing" msgid="1426882272690346242">"..."</string>
+    <string name="bluetooth_pairing" msgid="1426882272690346242">" ..."</string>
     <string name="bluetooth_connected_no_headset" msgid="616068069034994802">" ( )<xliff:g id="ACTIVE_DEVICE">%1$s</xliff:g>"</string>
     <string name="bluetooth_connected_no_a2dp" msgid="3736431800395923868">" ( )<xliff:g id="ACTIVE_DEVICE">%1$s</xliff:g>"</string>
     <string name="bluetooth_connected_no_map" msgid="3200033913678466453">" ( )<xliff:g id="ACTIVE_DEVICE">%1$s</xliff:g>"</string>
@@ -102,11 +102,11 @@
     <string name="bluetooth_pairing_accept" msgid="6163520056536604875">""</string>
     <string name="bluetooth_pairing_accept_all_caps" msgid="6061699265220789149">""</string>
     <string name="bluetooth_pairing_decline" msgid="4185420413578948140">""</string>
-    <string name="bluetooth_pairing_will_share_phonebook" msgid="4982239145676394429">"          ."</string>
-    <string name="bluetooth_pairing_error_message" msgid="3748157733635947087">"      \"<xliff:g id="DEVICE_NAME">%1$s</xliff:g>\"."</string>
-    <string name="bluetooth_pairing_pin_error_message" msgid="8337234855188925274">"      \"<xliff:g id="DEVICE_NAME">%1$s</xliff:g>\",     PIN-  ."</string>
+    <string name="bluetooth_pairing_will_share_phonebook" msgid="4982239145676394429">"           ."</string>
+    <string name="bluetooth_pairing_error_message" msgid="3748157733635947087">"     \"<xliff:g id="DEVICE_NAME">%1$s</xliff:g>\"."</string>
+    <string name="bluetooth_pairing_pin_error_message" msgid="8337234855188925274">"     \"<xliff:g id="DEVICE_NAME">%1$s</xliff:g>\",     PIN-  ."</string>
     <string name="bluetooth_pairing_device_down_error_message" msgid="7870998403045801381">"      \"<xliff:g id="DEVICE_NAME">%1$s</xliff:g>\"."</string>
-    <string name="bluetooth_pairing_rejected_error_message" msgid="1648157108520832454">"<xliff:g id="DEVICE_NAME">%1$s</xliff:g>   ."</string>
+    <string name="bluetooth_pairing_rejected_error_message" msgid="1648157108520832454">"<xliff:g id="DEVICE_NAME">%1$s</xliff:g>   ."</string>
     <string name="bluetooth_talkback_computer" msgid="4875089335641234463">""</string>
     <string name="bluetooth_talkback_headset" msgid="5140152177885220949">""</string>
     <string name="bluetooth_talkback_phone" msgid="4260255181240622896">""</string>
diff --git a/packages/SettingsLib/res/values-sw/arrays.xml b/packages/SettingsLib/res/values-sw/arrays.xml
index f13c2ea5b23..fdf9fd1a424 100644
--- a/packages/SettingsLib/res/values-sw/arrays.xml
+++ b/packages/SettingsLib/res/values-sw/arrays.xml
@@ -59,7 +59,7 @@
     <item msgid="45075631231212732">"Kila wakati tumia ukakuaji wa HDCP"</item>
   </string-array>
   <string-array name="bluetooth_avrcp_versions">
-    <item msgid="5347678900838034763">"AVRCP 1.4 (Chaguo msingi)"</item>
+    <item msgid="5347678900838034763">"AVRCP 1.4 (Chaguomsingi)"</item>
     <item msgid="2809759619990248160">"AVRCP 1.3"</item>
     <item msgid="6199178154704729352">"AVRCP 1.5"</item>
     <item msgid="5172170854953034852">"AVRCP 1.6"</item>
@@ -71,7 +71,7 @@
     <item msgid="3422726142222090896">"avrcp16"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_titles">
-    <item msgid="7065842274271279580">"Tumia Uteuzi wa Mfumo (Chaguo msingi)"</item>
+    <item msgid="7065842274271279580">"Tumia Uteuzi wa Mfumo (Chaguomsingi)"</item>
     <item msgid="7539690996561263909">"SBC"</item>
     <item msgid="686685526567131661">"AAC"</item>
     <item msgid="5254942598247222737">"Sauti ya <xliff:g id="QUALCOMM">Qualcomm</xliff:g> <xliff:g id="APTX">aptX</xliff:g>"</item>
@@ -81,7 +81,7 @@
     <item msgid="3304843301758635896">"Zima Kodeki Zisizo za Lazima"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_summaries">
-    <item msgid="5062108632402595000">"Tumia Uteuzi wa Mfumo (Chaguo msingi)"</item>
+    <item msgid="5062108632402595000">"Tumia Uteuzi wa Mfumo (Chaguomsingi)"</item>
     <item msgid="6898329690939802290">"SBC"</item>
     <item msgid="6839647709301342559">"AAC"</item>
     <item msgid="7848030269621918608">"Sauti ya <xliff:g id="QUALCOMM">Qualcomm</xliff:g> <xliff:g id="APTX">aptX</xliff:g>"</item>
@@ -91,38 +91,38 @@
     <item msgid="741805482892725657">"Zima Kodeki Zisizo za Lazima"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_sample_rate_titles">
-    <item msgid="3093023430402746802">"Tumia Uteuzi wa Mfumo (Chaguo msingi)"</item>
+    <item msgid="3093023430402746802">"Tumia Uteuzi wa Mfumo (Chaguomsingi)"</item>
     <item msgid="8895532488906185219">"kHz 44.1"</item>
     <item msgid="2909915718994807056">"kHz 48.0"</item>
     <item msgid="3347287377354164611">"kHz 88.2"</item>
     <item msgid="1234212100239985373">"kHz 96.0"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_sample_rate_summaries">
-    <item msgid="3214516120190965356">"Tumia Uteuzi wa Mfumo (Chaguo msingi)"</item>
+    <item msgid="3214516120190965356">"Tumia Uteuzi wa Mfumo (Chaguomsingi)"</item>
     <item msgid="4482862757811638365">"kHz 44.1"</item>
     <item msgid="354495328188724404">"kHz 48.0"</item>
     <item msgid="7329816882213695083">"kHz 88.2"</item>
     <item msgid="6967397666254430476">"kHz 96.0"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_bits_per_sample_titles">
-    <item msgid="2684127272582591429">"Tumia Uteuzi wa Mfumo (Chaguo msingi)"</item>
+    <item msgid="2684127272582591429">"Tumia Uteuzi wa Mfumo (Chaguomsingi)"</item>
     <item msgid="5618929009984956469">"Biti 16 kwa kila sampuli"</item>
     <item msgid="3412640499234627248">"Biti 24 kwa kila sampuli"</item>
     <item msgid="121583001492929387">"Biti 32 kwa kila sampuli"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_bits_per_sample_summaries">
-    <item msgid="1081159789834584363">"Tumia Uteuzi wa Mfumo (Chaguo msingi)"</item>
+    <item msgid="1081159789834584363">"Tumia Uteuzi wa Mfumo (Chaguomsingi)"</item>
     <item msgid="4726688794884191540">"Biti 16 kwa kila sampuli"</item>
     <item msgid="305344756485516870">"Biti 24 kwa kila sampuli"</item>
     <item msgid="244568657919675099">"Biti 32 kwa kila sampuli"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_channel_mode_titles">
-    <item msgid="5226878858503393706">"Tumia Uteuzi wa Mfumo (Chaguo msingi)"</item>
+    <item msgid="5226878858503393706">"Tumia Uteuzi wa Mfumo (Chaguomsingi)"</item>
     <item msgid="4106832974775067314">"Mono"</item>
     <item msgid="5571632958424639155">"Stereo"</item>
   </string-array>
   <string-array name="bluetooth_a2dp_codec_channel_mode_summaries">
-    <item msgid="4118561796005528173">"Tumia Uteuzi wa Mfumo (Chaguo msingi)"</item>
+    <item msgid="4118561796005528173">"Tumia Uteuzi wa Mfumo (Chaguomsingi)"</item>
     <item msgid="8900559293912978337">"Mono"</item>
     <item msgid="8883739882299884241">"Stereo"</item>
   </string-array>
diff --git a/packages/SettingsLib/res/values-sw/strings.xml b/packages/SettingsLib/res/values-sw/strings.xml
index 6d5916b36fc..a6d7c6b3dd9 100644
--- a/packages/SettingsLib/res/values-sw/strings.xml
+++ b/packages/SettingsLib/res/values-sw/strings.xml
@@ -138,7 +138,7 @@
     <string name="user_guest" msgid="8475274842845401871">"Aliyealikwa"</string>
     <string name="unknown" msgid="1592123443519355854">"Haijulikani"</string>
     <string name="running_process_item_user_label" msgid="3129887865552025943">"Mtumiaji: <xliff:g id="USER_NAME">%1$s</xliff:g>"</string>
-    <string name="launch_defaults_some" msgid="313159469856372621">"Baadhi ya chaguo msingi zimewekwa"</string>
+    <string name="launch_defaults_some" msgid="313159469856372621">"Baadhi ya chaguomsingi zimewekwa"</string>
     <string name="launch_defaults_none" msgid="4241129108140034876">"Hakuna chaguo-misingi zilizowekwa"</string>
     <string name="tts_settings" msgid="8186971894801348327">"Mipangilio ya kusoma maandishi kwa sauti"</string>
     <string name="tts_settings_title" msgid="1237820681016639683">"Kusoma maandishi kwa sauti"</string>
@@ -157,7 +157,7 @@
     <string name="tts_engine_security_warning" msgid="8786238102020223650">"Hotuba hii inawezesha injini huenda ikaweza kukusanya maandishi ambayo yatazungumziwa, ikijumlisha data ya kibinafsi ya nenosiri na namba ya kaddi ya mkopo. Inatoka kwa injini ya <xliff:g id="TTS_PLUGIN_ENGINE_NAME">%s</xliff:g> Wezesha matumizi ya hotuba hii iliyowezeshwa ya injini?"</string>
     <string name="tts_engine_network_required" msgid="1190837151485314743">"Lugha hii inahitaji muunganisho wa mtandao unaofanya kazi ili kipengele cha kusoma maandishi kwa sauti kifanye kazi."</string>
     <string name="tts_default_sample_string" msgid="4040835213373086322">"Huu ni mfano wa usanisi usemaji"</string>
-    <string name="tts_status_title" msgid="7268566550242584413">"Hali ya lugha chaguo msingi"</string>
+    <string name="tts_status_title" msgid="7268566550242584413">"Hali ya lugha chaguomsingi"</string>
     <string name="tts_status_ok" msgid="1309762510278029765">"<xliff:g id="LOCALE">%1$s</xliff:g> inaweza kutumiwa kikamilifu"</string>
     <string name="tts_status_requires_network" msgid="6042500821503226892">"<xliff:g id="LOCALE">%1$s</xliff:g> inahitaji muunganisho wa mtandao"</string>
     <string name="tts_status_not_supported" msgid="4491154212762472495">"<xliff:g id="LOCALE">%1$s</xliff:g> haiwezi kutumiwa"</string>
@@ -167,7 +167,7 @@
     <string name="tts_engine_preference_section_title" msgid="448294500990971413">"Injini inayofaa"</string>
     <string name="tts_general_section_title" msgid="4402572014604490502">"Kwa ujumla"</string>
     <string name="tts_reset_speech_pitch_title" msgid="5789394019544785915">"Weka upya mipangilio ya ubora wa matamshi"</string>
-    <string name="tts_reset_speech_pitch_summary" msgid="8700539616245004418">"Rejesha mipangilio ya ubora wa matamshi kuwa ya chaguo msingi."</string>
+    <string name="tts_reset_speech_pitch_summary" msgid="8700539616245004418">"Rejesha mipangilio ya ubora wa matamshi kuwa ya chaguomsingi."</string>
   <string-array name="tts_rate_entries">
     <item msgid="6695494874362656215">"Polepole sana"</item>
     <item msgid="4795095314303559268">"Polepole"</item>
@@ -333,7 +333,7 @@
     <string name="local_backup_password_toast_confirmation_mismatch" msgid="7805892532752708288">"Nenosiri jipya na uthibitisho havioani"</string>
     <string name="local_backup_password_toast_validation_failure" msgid="5646377234895626531">"Imeshindwa kuweka nenosiri la hifadhi rudufu"</string>
   <string-array name="color_mode_names">
-    <item msgid="2425514299220523812">"Maridadi (chaguo msingi)"</item>
+    <item msgid="2425514299220523812">"Maridadi (chaguomsingi)"</item>
     <item msgid="8446070607501413455">"Asili"</item>
     <item msgid="6553408765810699025">"Muundo-msingi"</item>
   </string-array>
@@ -412,7 +412,7 @@
     <string name="charge_length_format" msgid="8978516217024434156">"<xliff:g id="ID_1">%1$s</xliff:g> zilizopita"</string>
     <string name="remaining_length_format" msgid="7886337596669190587">"Zimesalia <xliff:g id="ID_1">%1$s</xliff:g>"</string>
     <string name="screen_zoom_summary_small" msgid="5867245310241621570">"Ndogo"</string>
-    <string name="screen_zoom_summary_default" msgid="2247006805614056507">"Chaguo msingi"</string>
+    <string name="screen_zoom_summary_default" msgid="2247006805614056507">"Chaguomsingi"</string>
     <string name="screen_zoom_summary_large" msgid="4835294730065424084">"Kubwa"</string>
     <string name="screen_zoom_summary_very_large" msgid="7108563375663670067">"Kubwa kiasi"</string>
     <string name="screen_zoom_summary_extremely_large" msgid="7427320168263276227">"Kubwa zaidi"</string>
diff --git a/packages/SettingsLib/res/values-ta/arrays.xml b/packages/SettingsLib/res/values-ta/arrays.xml
index 7b69c785980..54adf826076 100644
--- a/packages/SettingsLib/res/values-ta/arrays.xml
+++ b/packages/SettingsLib/res/values-ta/arrays.xml
@@ -22,7 +22,7 @@
     xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string-array name="wifi_status">
     <item msgid="1922181315419294640"></item>
-    <item msgid="8934131797783724664">" "</item>
+    <item msgid="8934131797783724664">"..."</item>
     <item msgid="8513729475867537913">"..."</item>
     <item msgid="515055375277271756">"..."</item>
     <item msgid="1943354004029184381">"IP  "</item>
@@ -36,7 +36,7 @@
   </string-array>
   <string-array name="wifi_status_with_ssid">
     <item msgid="7714855332363650812"></item>
-    <item msgid="8878186979715711006">" "</item>
+    <item msgid="8878186979715711006">"..."</item>
     <item msgid="355508996603873860">"<xliff:g id="NETWORK_NAME">%1$s</xliff:g>  "</item>
     <item msgid="554971459996405634">"<xliff:g id="NETWORK_NAME">%1$s</xliff:g>  "</item>
     <item msgid="7928343808033020343">"<xliff:g id="NETWORK_NAME">%1$s</xliff:g>  IP  "</item>
@@ -180,30 +180,30 @@
   </string-array>
   <string-array name="window_animation_scale_entries">
     <item msgid="8134156599370824081">" "</item>
-    <item msgid="6624864048416710414">"  .5x"</item>
-    <item msgid="2219332261255416635">"  1x"</item>
-    <item msgid="3544428804137048509">"  1.5x"</item>
-    <item msgid="3110710404225974514">"  2x"</item>
-    <item msgid="4402738611528318731">"  5x"</item>
-    <item msgid="6189539267968330656">"  10x"</item>
+    <item msgid="6624864048416710414">"  .5x"</item>
+    <item msgid="2219332261255416635">"  1x"</item>
+    <item msgid="3544428804137048509">"  1.5x"</item>
+    <item msgid="3110710404225974514">"  2x"</item>
+    <item msgid="4402738611528318731">"  5x"</item>
+    <item msgid="6189539267968330656">"  10x"</item>
   </string-array>
   <string-array name="transition_animation_scale_entries">
     <item msgid="8464255836173039442">" "</item>
-    <item msgid="3375781541913316411">"  .5x"</item>
-    <item msgid="1991041427801869945">"  1x"</item>
-    <item msgid="4012689927622382874">"  1.5x"</item>
-    <item msgid="3289156759925947169">"  2x"</item>
-    <item msgid="7705857441213621835">"  5x"</item>
-    <item msgid="6660750935954853365">"  10x"</item>
+    <item msgid="3375781541913316411">"  .5x"</item>
+    <item msgid="1991041427801869945">"  1x"</item>
+    <item msgid="4012689927622382874">"  1.5x"</item>
+    <item msgid="3289156759925947169">"  2x"</item>
+    <item msgid="7705857441213621835">"  5x"</item>
+    <item msgid="6660750935954853365">"  10x"</item>
   </string-array>
   <string-array name="animator_duration_scale_entries">
     <item msgid="6039901060648228241">" "</item>
-    <item msgid="1138649021950863198">"  .5x"</item>
-    <item msgid="4394388961370833040">"  1x"</item>
-    <item msgid="8125427921655194973">"  1.5x"</item>
-    <item msgid="3334024790739189573">"  2x"</item>
-    <item msgid="3170120558236848008">"  5x"</item>
-    <item msgid="1069584980746680398">"  10x"</item>
+    <item msgid="1138649021950863198">"  .5x"</item>
+    <item msgid="4394388961370833040">"  1x"</item>
+    <item msgid="8125427921655194973">"  1.5x"</item>
+    <item msgid="3334024790739189573">"  2x"</item>
+    <item msgid="3170120558236848008">"  5x"</item>
+    <item msgid="1069584980746680398">"  10x"</item>
   </string-array>
   <string-array name="overlay_display_devices_entries">
     <item msgid="1606809880904982133">""</item>
diff --git a/packages/SettingsLib/res/values-ta/strings.xml b/packages/SettingsLib/res/values-ta/strings.xml
index 7879c479162..f65bf1795f3 100644
--- a/packages/SettingsLib/res/values-ta/strings.xml
+++ b/packages/SettingsLib/res/values-ta/strings.xml
@@ -308,8 +308,8 @@
     <string name="track_frame_time" msgid="6146354853663863443">" GPU "</string>
     <string name="enable_gpu_debug_layers" msgid="3848838293793255097">"GPU   "</string>
     <string name="enable_gpu_debug_layers_summary" msgid="8009136940671194940">" , GPU    "</string>
-    <string name="window_animation_scale_title" msgid="6162587588166114700">"  "</string>
-    <string name="transition_animation_scale_title" msgid="387527540523595875">"  "</string>
+    <string name="window_animation_scale_title" msgid="6162587588166114700">"  "</string>
+    <string name="transition_animation_scale_title" msgid="387527540523595875">"  "</string>
     <string name="animator_duration_scale_title" msgid="3406722410819934083">"  "</string>
     <string name="overlay_display_devices_title" msgid="5364176287998398539">"  "</string>
     <string name="debug_applications_category" msgid="4206913653849771549">""</string>
@@ -360,7 +360,7 @@
     <string name="picture_color_mode" msgid="4560755008730283695">"  "</string>
     <string name="picture_color_mode_desc" msgid="1141891467675548590">"sRGB "</string>
     <string name="daltonizer_mode_disabled" msgid="7482661936053801862">""</string>
-    <string name="daltonizer_mode_monochromacy" msgid="8485709880666106721">""</string>
+    <string name="daltonizer_mode_monochromacy" msgid="8485709880666106721">"  "</string>
     <string name="daltonizer_mode_deuteranomaly" msgid="5475532989673586329">"   (-)"</string>
     <string name="daltonizer_mode_protanomaly" msgid="8424148009038666065">"   (-)"</string>
     <string name="daltonizer_mode_tritanomaly" msgid="481725854987912389">"   (-)"</string>
diff --git a/packages/SettingsLib/src/com/android/settingslib/applications/ApplicationsState.java b/packages/SettingsLib/src/com/android/settingslib/applications/ApplicationsState.java
index 093b1bd2b8f..15cb9bd8fcd 100644
--- a/packages/SettingsLib/src/com/android/settingslib/applications/ApplicationsState.java
+++ b/packages/SettingsLib/src/com/android/settingslib/applications/ApplicationsState.java
@@ -25,6 +25,7 @@ import android.app.usage.StorageStatsManager;
 import android.arch.lifecycle.Lifecycle;
 import android.arch.lifecycle.LifecycleObserver;
 import android.arch.lifecycle.OnLifecycleEvent;
+
 import android.content.BroadcastReceiver;
 import android.content.Context;
 import android.content.Intent;
@@ -62,6 +63,7 @@ import java.io.File;
 import java.io.IOException;
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
+import java.lang.ref.WeakReference;
 import java.text.Collator;
 import java.text.Normalizer;
 import java.text.Normalizer.Form;
@@ -132,7 +134,7 @@ public class ApplicationsState {
     boolean mSessionsChanged;
 
     // Temporary for dispatching session callbacks.  Only touched by main thread.
-    final ArrayList<Session> mActiveSessions = new ArrayList<Session>();
+    final ArrayList<WeakReference<Session>> mActiveSessions = new ArrayList<>();
 
     final HandlerThread mThread;
     final BackgroundHandler mBackgroundHandler;
@@ -618,7 +620,7 @@ public class ApplicationsState {
             for (int i=0; i<mSessions.size(); i++) {
                 Session s = mSessions.get(i);
                 if (s.mResumed) {
-                    mActiveSessions.add(s);
+                    mActiveSessions.add(new WeakReference<>(s));
                 }
             }
         }
@@ -830,46 +832,70 @@ public class ApplicationsState {
             rebuildActiveSessions();
             switch (msg.what) {
                 case MSG_REBUILD_COMPLETE: {
-                    Session s = (Session)msg.obj;
-                    if (mActiveSessions.contains(s)) {
-                        s.mCallbacks.onRebuildComplete(s.mLastAppList);
+                    Session s = (Session) msg.obj;
+                    for (WeakReference<Session> sessionRef : mActiveSessions) {
+                        final Session session = sessionRef.get();
+                        if (session != null && session == s) {
+                            s.mCallbacks.onRebuildComplete(s.mLastAppList);
+                        }
                     }
                 } break;
                 case MSG_PACKAGE_LIST_CHANGED: {
-                    for (int i=0; i<mActiveSessions.size(); i++) {
-                        mActiveSessions.get(i).mCallbacks.onPackageListChanged();
+                    for (WeakReference<Session> sessionRef : mActiveSessions) {
+                        final Session session = sessionRef.get();
+                        if (session != null) {
+                            session.mCallbacks.onPackageListChanged();
+                        }
                     }
                 } break;
                 case MSG_PACKAGE_ICON_CHANGED: {
-                    for (int i=0; i<mActiveSessions.size(); i++) {
-                        mActiveSessions.get(i).mCallbacks.onPackageIconChanged();
+                    for (WeakReference<Session> sessionRef : mActiveSessions) {
+                        final Session session = sessionRef.get();
+                        if (session != null) {
+                            session.mCallbacks.onPackageIconChanged();
+                        }
                     }
                 } break;
                 case MSG_PACKAGE_SIZE_CHANGED: {
-                    for (int i=0; i<mActiveSessions.size(); i++) {
-                        mActiveSessions.get(i).mCallbacks.onPackageSizeChanged(
-                                (String)msg.obj);
+                    for (WeakReference<Session> sessionRef : mActiveSessions) {
+                        final Session session = sessionRef.get();
+                        if (session != null) {
+                            session.mCallbacks.onPackageSizeChanged(
+                                    (String) msg.obj);
+                        }
                     }
                 } break;
                 case MSG_ALL_SIZES_COMPUTED: {
-                    for (int i=0; i<mActiveSessions.size(); i++) {
-                        mActiveSessions.get(i).mCallbacks.onAllSizesComputed();
+                    for (WeakReference<Session> sessionRef : mActiveSessions) {
+                        final Session session = sessionRef.get();
+                        if (session != null) {
+                            session.mCallbacks.onAllSizesComputed();
+                        }
                     }
                 } break;
                 case MSG_RUNNING_STATE_CHANGED: {
-                    for (int i=0; i<mActiveSessions.size(); i++) {
-                        mActiveSessions.get(i).mCallbacks.onRunningStateChanged(
-                                msg.arg1 != 0);
+                    for (WeakReference<Session> sessionRef : mActiveSessions) {
+                        final Session session = sessionRef.get();
+                        if (session != null) {
+                            session.mCallbacks.onRunningStateChanged(
+                                    msg.arg1 != 0);
+                        }
                     }
                 } break;
                 case MSG_LAUNCHER_INFO_CHANGED: {
-                    for (int i=0; i<mActiveSessions.size(); i++) {
-                        mActiveSessions.get(i).mCallbacks.onLauncherInfoChanged();
+                    for (WeakReference<Session> sessionRef : mActiveSessions) {
+                        final Session session = sessionRef.get();
+                        if (session != null) {
+                            session.mCallbacks.onLauncherInfoChanged();
+                        }
                     }
                 } break;
                 case MSG_LOAD_ENTRIES_COMPLETE: {
-                    for (int i=0; i<mActiveSessions.size(); i++) {
-                        mActiveSessions.get(i).mCallbacks.onLoadEntriesCompleted();
+                    for (WeakReference<Session> sessionRef : mActiveSessions) {
+                        final Session session = sessionRef.get();
+                        if (session != null) {
+                            session.mCallbacks.onLoadEntriesCompleted();
+                        }
                     }
                 } break;
             }
diff --git a/packages/SettingsLib/src/com/android/settingslib/bluetooth/LocalBluetoothManager.java b/packages/SettingsLib/src/com/android/settingslib/bluetooth/LocalBluetoothManager.java
index 37324716256..1c50953bac1 100644
--- a/packages/SettingsLib/src/com/android/settingslib/bluetooth/LocalBluetoothManager.java
+++ b/packages/SettingsLib/src/com/android/settingslib/bluetooth/LocalBluetoothManager.java
@@ -19,6 +19,8 @@ package com.android.settingslib.bluetooth;
 import android.content.Context;
 import android.util.Log;
 
+import java.lang.ref.WeakReference;
+
 /**
  * LocalBluetoothManager provides a simplified interface on top of a subset of
  * the Bluetooth API. Note that {@link #getInstance} will return null
@@ -34,7 +36,7 @@ public class LocalBluetoothManager {
     private final Context mContext;
 
     /** If a BT-related activity is in the foreground, this will be it. */
-    private Context mForegroundActivity;
+    private WeakReference<Context> mForegroundActivity;
 
     private final LocalBluetoothAdapter mLocalAdapter;
 
@@ -85,17 +87,19 @@ public class LocalBluetoothManager {
     }
 
     public Context getForegroundActivity() {
-        return mForegroundActivity;
+        return mForegroundActivity == null
+                ? null
+                : mForegroundActivity.get();
     }
 
     public boolean isForegroundActivity() {
-        return mForegroundActivity != null;
+        return mForegroundActivity != null && mForegroundActivity.get() != null;
     }
 
     public synchronized void setForegroundActivity(Context context) {
         if (context != null) {
             Log.d(TAG, "setting foreground activity to non-null context");
-            mForegroundActivity = context;
+            mForegroundActivity = new WeakReference<>(context);
         } else {
             if (mForegroundActivity != null) {
                 Log.d(TAG, "setting foreground activity to null");
diff --git a/packages/SettingsLib/src/com/android/settingslib/dream/DreamBackend.java b/packages/SettingsLib/src/com/android/settingslib/dream/DreamBackend.java
index 988060eac64..e5d97c9b4a7 100644
--- a/packages/SettingsLib/src/com/android/settingslib/dream/DreamBackend.java
+++ b/packages/SettingsLib/src/com/android/settingslib/dream/DreamBackend.java
@@ -36,12 +36,12 @@ import android.util.AttributeSet;
 import android.util.Log;
 import android.util.Xml;
 
-import java.lang.annotation.Retention;
-import java.lang.annotation.RetentionPolicy;
 import org.xmlpull.v1.XmlPullParser;
 import org.xmlpull.v1.XmlPullParserException;
 
 import java.io.IOException;
+import java.lang.annotation.Retention;
+import java.lang.annotation.RetentionPolicy;
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.Comparator;
@@ -97,15 +97,15 @@ public class DreamBackend {
     }
 
     public DreamBackend(Context context) {
-        mContext = context;
+        mContext = context.getApplicationContext();
         mDreamManager = IDreamManager.Stub.asInterface(
                 ServiceManager.getService(DreamService.DREAM_SERVICE));
         mComparator = new DreamInfoComparator(getDefaultDream());
-        mDreamsEnabledByDefault = context.getResources()
+        mDreamsEnabledByDefault = mContext.getResources()
                 .getBoolean(com.android.internal.R.bool.config_dreamsEnabledByDefault);
-        mDreamsActivatedOnSleepByDefault = context.getResources()
+        mDreamsActivatedOnSleepByDefault = mContext.getResources()
                 .getBoolean(com.android.internal.R.bool.config_dreamsActivatedOnSleepByDefault);
-        mDreamsActivatedOnDockByDefault = context.getResources()
+        mDreamsActivatedOnDockByDefault = mContext.getResources()
                 .getBoolean(com.android.internal.R.bool.config_dreamsActivatedOnDockByDefault);
     }
 
diff --git a/packages/SettingsProvider/src/com/android/providers/settings/SettingsBackupAgent.java b/packages/SettingsProvider/src/com/android/providers/settings/SettingsBackupAgent.java
index f72868431d4..9d398b5b69a 100644
--- a/packages/SettingsProvider/src/com/android/providers/settings/SettingsBackupAgent.java
+++ b/packages/SettingsProvider/src/com/android/providers/settings/SettingsBackupAgent.java
@@ -841,7 +841,19 @@ public class SettingsBackupAgent extends BackupAgentHelper {
             WifiConfiguration config = WifiConfiguration
                     .getWifiConfigFromBackup(new DataInputStream(new ByteArrayInputStream(data)));
             if (DEBUG) Log.d(TAG, "Successfully unMarshaled WifiConfiguration ");
+            int originalApBand = config.apBand;
             mWifiManager.setWifiApConfiguration(config);
+
+            // Depending on device hardware, we may need to notify the user of a setting change for
+            // the apBand preference
+            boolean dualMode = mWifiManager.isDualModeSupported();
+            int storedApBand = mWifiManager.getWifiApConfiguration().apBand;
+            if (dualMode) {
+                if (storedApBand != originalApBand) {
+                    Log.d(TAG, "restored ap configuration requires a conversion, notify the user");
+                    mWifiManager.notifyUserOfApBandConversion();
+                }
+            }
         } catch (IOException | BackupUtils.BadVersionException e) {
             Log.e(TAG, "Failed to unMarshal SoftAPConfiguration " + e.getMessage());
         }
diff --git a/packages/Shell/res/values-hy/strings.xml b/packages/Shell/res/values-hy/strings.xml
index 95b6131c688..33f76f0da8f 100644
--- a/packages/Shell/res/values-hy/strings.xml
+++ b/packages/Shell/res/values-hy/strings.xml
@@ -25,9 +25,9 @@
     <string name="bugreport_finished_text" product="watch" msgid="1223616207145252689">"     "</string>
     <string name="bugreport_finished_text" product="tv" msgid="5758325479058638893">"    "</string>
     <string name="bugreport_finished_text" product="default" msgid="8353769438382138847">"    "</string>
-    <string name="bugreport_finished_pending_screenshot_text" product="tv" msgid="2343263822812016950">"            "</string>
-    <string name="bugreport_finished_pending_screenshot_text" product="watch" msgid="1474435374470177193">"            "</string>
-    <string name="bugreport_finished_pending_screenshot_text" product="default" msgid="1474435374470177193">"            "</string>
+    <string name="bugreport_finished_pending_screenshot_text" product="tv" msgid="2343263822812016950">"          "</string>
+    <string name="bugreport_finished_pending_screenshot_text" product="watch" msgid="1474435374470177193">"          "</string>
+    <string name="bugreport_finished_pending_screenshot_text" product="default" msgid="1474435374470177193">"          "</string>
     <string name="bugreport_confirm" msgid="5917407234515812495">"            ,      (     ):        :"</string>
     <string name="bugreport_confirm_dont_repeat" msgid="6179945398364357318">"  "</string>
     <string name="bugreport_storage_title" msgid="5332488144740527109">" "</string>
@@ -35,9 +35,9 @@
     <string name="bugreport_add_details_to_zip_failed" msgid="1302931926486712371">"     zip "</string>
     <string name="bugreport_unnamed" msgid="2800582406842092709">""</string>
     <string name="bugreport_info_action" msgid="2158204228510576227">""</string>
-    <string name="bugreport_screenshot_action" msgid="8677781721940614995">" "</string>
-    <string name="bugreport_screenshot_taken" msgid="5684211273096253120">"   :"</string>
-    <string name="bugreport_screenshot_failed" msgid="5853049140806834601">"   :"</string>
+    <string name="bugreport_screenshot_action" msgid="8677781721940614995">""</string>
+    <string name="bugreport_screenshot_taken" msgid="5684211273096253120">"  :"</string>
+    <string name="bugreport_screenshot_failed" msgid="5853049140806834601">"  :"</string>
     <string name="bugreport_info_dialog_title" msgid="1355948594292983332">"<xliff:g id="ID">#%d</xliff:g>   "</string>
     <string name="bugreport_info_name" msgid="4414036021935139527">" "</string>
     <string name="bugreport_info_title" msgid="2306030793918239804">"  "</string>
diff --git a/packages/SystemUI/plugin/src/com/android/systemui/plugins/qs/QSTile.java b/packages/SystemUI/plugin/src/com/android/systemui/plugins/qs/QSTile.java
index 6382de3ce5b..7d3691a8b59 100644
--- a/packages/SystemUI/plugin/src/com/android/systemui/plugins/qs/QSTile.java
+++ b/packages/SystemUI/plugin/src/com/android/systemui/plugins/qs/QSTile.java
@@ -43,7 +43,7 @@ public interface QSTile {
     boolean isAvailable();
     void setTileSpec(String tileSpec);
 
-    void clearState();
+    @Deprecated default void clearState() {}
     void refreshState();
 
     void addCallback(Callback callback);
diff --git a/packages/SystemUI/res-keyguard/values-bs/strings.xml b/packages/SystemUI/res-keyguard/values-bs/strings.xml
index 319014e666d..c8dbc3b8a71 100644
--- a/packages/SystemUI/res-keyguard/values-bs/strings.xml
+++ b/packages/SystemUI/res-keyguard/values-bs/strings.xml
@@ -146,7 +146,7 @@
       <item quantity="few">Ureaj nije otkljuavan <xliff:g id="NUMBER_1">%d</xliff:g> sata. Potvrdite lozinku.</item>
       <item quantity="other">Ureaj nije otkljuavan <xliff:g id="NUMBER_1">%d</xliff:g> sati. Potvrdite lozinku.</item>
     </plurals>
-    <string name="fingerprint_not_recognized" msgid="348813995267914625">"Nije prepoznat"</string>
+    <string name="fingerprint_not_recognized" msgid="348813995267914625">"Nije prepoznato"</string>
     <plurals name="kg_password_default_pin_message" formatted="false" msgid="3739658416797652781">
       <item quantity="one">Unesite PIN za SIM. Imate jo <xliff:g id="NUMBER_1">%d</xliff:g> pokuaj.</item>
       <item quantity="few">Unesite PIN za SIM. Imate jo <xliff:g id="NUMBER_1">%d</xliff:g> pokuaja.</item>
diff --git a/packages/SystemUI/res/drawable-hdpi/qs_scrubber_track.9.png b/packages/SystemUI/res/drawable-hdpi/qs_scrubber_track.9.png
deleted file mode 100644
index 0899d3515f1b9eaaf2eecc3e26e78d9945cc4226..0000000000000000000000000000000000000000
GIT binary patch
literal 0
HcmV?d00001

literal 365
zcmV-z0h0cSP)<h;3K|Lk000e1NJLTq000sI000pP1^@s6&|3WY0003rNkl<ZI8U9_
zJud`N6vpxYQ>~W-<t|@9qf-cK5+dHVP>5(K`7U%45}jmO8bU(irScI}Ix8e95nCO(
zn|n698SKnVHOYPQ%ek5JjOhGWjOf2;;?T@`fl*)um;;6)@B&-_N5G?`&lcF4kXhq>
z0@wm(fu27m_yVqgUEo$yn79oZ1NMNC&bMtOo`6kB_f5#m`hWvqIVIw;b6{Q4d*f<m
zHUpdhT^XS|uqvtIPz5MwL_A)VwB%3?DCUG}l1c$GGYcaYazb@U1)nJFNGT`uDyisD
z6<Ev(ok?17Xc{;Lx-(+m@v9v>)DIj2^BJK_U`^6nYemL^ePB2x_6%%Dx@oIOT+Gn5
z?UY^H0qzoA^C`@10GNz*nF0pmS=hDf*nkH~AHTKV|2Zjdm5AvFjtXW2tvjMf00000
LNkvXXu0mjfaX^-w

diff --git a/packages/SystemUI/res/drawable-mdpi/qs_scrubber_track.9.png b/packages/SystemUI/res/drawable-mdpi/qs_scrubber_track.9.png
deleted file mode 100644
index 22664496db762448707e0642a4f07a94c24d61ca..0000000000000000000000000000000000000000
GIT binary patch
literal 0
HcmV?d00001

literal 223
zcmeAS@N?(olHy`uVBq!ia0vp@K+MCz1|)ZGH@^v_mU+53hG+y&y|kO_kb^+$!~a(V
zYvgA~bZq-&)HQXwlYqRN_t9eyq*;UIBhRq4&Nw~A`1jj4=hm&@pPqSjYW<{b?gzL$
z8WkrnOBPJ}qGMjrnzO#~@ceU%d#7$;wmb2SXNOrsM3je>dkMRmY=D|3?}=^P3NIVD
zJUw0X6E3i~hM6baVzgE1eLR<mV}tIqNqYB{<C%`LZJoGfy_=l)x7s^Da&PsCzp7%M
XCvC^fIz#yd(8Ua%u6{1-oD!M<Of*$@

diff --git a/packages/SystemUI/res/drawable-xhdpi/qs_scrubber_track.9.png b/packages/SystemUI/res/drawable-xhdpi/qs_scrubber_track.9.png
deleted file mode 100644
index 3328add435fba2ee27fa526333f9d3113f147f75..0000000000000000000000000000000000000000
GIT binary patch
literal 0
HcmV?d00001

literal 386
zcmV-|0e$|7P)<h;3K|Lk000e1NJLTq000*N000&U1^@s6D|QD30003=Nkl<ZNK3Vq
zOG*Pl5Qe`WRB{MkC>}&~D~N)xEYyuzdlxrGP!}2{5L~zwy@+o-L`0#aa5}Wf1e!@(
zFq`SBul}y?>JsT@k*iX|hB}#94Oj=3if=jsz5(~Z9ng{VS(403;byi1904(KnAj)a
zP||Im!(X_WjRPmZZpya%e9nObNngeP0r(lPR{<PCnvxm=a5Jj|7bAc}=#Hc-;8(es
zO#oiI$qeuhVBQZoz`e#^vs_k}bQ$0`z-lfs(3Z3j;C^pYu3c*WXGwDoH#6%3-ZZ(a
zE2;MHaF_l9%;u5}^vdG!4zQLHel2M$9OyRC$_V#HYQ;_T2ux*2@D42WnyBc~T<SL^
zwR`O!)SB6`zicC@FMqfS^<zL2*sqY_6lh5LE`4&N9poPtvD#?NEdz_dOtk(AJfx1f
gc=%SRNNI?E0M31W13Ya}A^-pY07*qoM6N<$g6Y|#@Bjb+

diff --git a/packages/SystemUI/res/drawable-xxhdpi/qs_scrubber_track.9.png b/packages/SystemUI/res/drawable-xxhdpi/qs_scrubber_track.9.png
deleted file mode 100644
index ed651da88800ba9170b79cd78a7bbcb1ccade62f..0000000000000000000000000000000000000000
GIT binary patch
literal 0
HcmV?d00001

literal 685
zcmV;e0#f~nP)<h;3K|Lk000e1NJLTq001HY001Be1^@s6caN&c0007XNkl<ZSVzT}
zO^8lm6vuym!i<f4gaz5KQnI5^W>{HJ?0hX)k$hyuG#gALQ-o|R6pO*ahSV@KWh2(U
zQcArNLfFh;I6BjPUbj2<o%?q0d+*%cTlbvj_nh<G|MNeuDE3$)TzS(q6=-HtfLXw7
zU=^?#*a*x^Ec_LC0Neu}1OEG)q`w(}mI-2J3xOTLR$zGq)Xc_z055>sK%b=d69i2R
zVrFZBbHECqy_wZh-Wdj-0mmghY>*=z#LT<}M}e-Ki#H1E1<pwNoOoe8h?&g<&I3CO
zRG|^bPv9nSP}29<OQ|52fxW<t7FQ#rbC@fVj--N^jX`Y(Zj=O&OuO6HlH?NbzanO~
z47dfXtO(?_e~FTw*FhqkH~^e2u_ej<{RU0|rzMS!>4=%l1?~c?E2>6V<_WM((z^iS
zdNBY@uNcHNW{af$0Mg@vQ!zwX?xdvd05S-4OcKa|qzwV21}vH+keZ~$4q|5Jy~=x+
z6y+b5)E+=afVQF;bH<NIY74D-3oOZ*sAyQdHQt*cV13byIpc>Ub%ctz!gc3NR5Ywd
zQda<31M~xK0jhlbY;KY?7?=1vz`80afTxkf*8+%}<HLRdRVed*>A9kxs$Y81#kVvv
zx>ebLmyr#4mGmQC9e3;3D{9Xk;MzE26c#r#_pAGXX(a)T0#_yNOSOtI5Leg>z^)Qx
z-~DPIa46F}$BfdkXryRmVJ=38^HU;e=78mDdkJtqo7Xh`0^azhB;9YYtI|hK|1#W=
z7aKWa=VmIf0GJ;Q;XZ(O0&@~O`~p0R266YJAAt{&{$%vGUXkSA3#~jC&E(QQgXhu%
T^up|x00000NkvXXu0mjf8nrkb

diff --git a/packages/SystemUI/res/drawable-xxxhdpi/qs_scrubber_track.9.png b/packages/SystemUI/res/drawable-xxxhdpi/qs_scrubber_track.9.png
deleted file mode 100644
index 06e120239eb2990fb500fbfa13cb5504ffbe0291..0000000000000000000000000000000000000000
GIT binary patch
literal 0
HcmV?d00001

literal 747
zcmV<H0u=p;P)<h;3K|Lk000e1NJLTq001li001fo1^@s6$lbXd0008ANkl<ZSVz^F
zO^8lm6vu!6s6kPphOjVd*iFj96td9dV<9V9AS{ptvS8t>C{5&}6jQ#!#zr<ik|LY2
zP}oT!Uol0>f+p(d=)U8fJMW$M&b`mfJnvI)@8+I!e)rt-eEp9IKP=@^Aw!gMW@a;i
zWyx<TFe3x*6Yv0d<o}XB7JLaCGO(Go0K0(>ptWG&SHNB1#1P^01Dn|d;2^NKAY?7G
zUqB~tT++`Re)9pF*(%^1Fe``CB9D9kwoAHQ$9QmHGn)#W1lAX!C}49H*dys{hHW-*
z0_%0Qpg`a<CQpGC8PK(X&1@X-5Lj3yatYgRV2PwZDIb}@H-R-J0){ZXENOFHU^Cm6
zOt26^%lg<P=}MK8{uws2DZpD`V%bQ6?0*1rs_J<F@OfZspkSfgbV>5B?&CkOnN0)U
z0OLbN3gpK(7tiwNH1KI)XP_XV-E>OY*9UB7V}KsOYdFT?^Qu+S?|+9MGxL*{ue&ji
zc1hh8;KRV7m}&ilDCtxM_!h7_a^M@1)>eRD0&^n=ej%x?0{jJNjvTm0QnLe_ne_rq
zkpuTiYHCPePjN$)gabbZ+9EHBev_`@mNnm}k42v0ej7(4Y|Zl}J*%w4V*wX8W=ERk
z_dtu^@%oe>Gdlw8j}-W*qyy>m@O0pHqz8D<t}nd<u1IHr9g$`EjHF!yu1Lwb*p(j7
z@}x+hT>+XW>03?U1bQP-eYGA<_6?G*RRLrQDHnmXh%wUOmn3aT1<eHZW$rQ1KGKv)
zyeGio+)`Ci8k2$hqa+4)NcvtQS#{-B7qKq@>qaQk*ImdNMBL6TXs-mi0PkrG$MBwq
zgWjp*JRfjUB8}5BsDA5!O__U1Z(}GOrTiJL^{JA!*K%M{()!A3d%a6qUcuU4>1N<?
d)M*Hx`U`iZ0ulwWA&LM1002ovPDHLkV1lD~T08&%

diff --git a/packages/SystemUI/res/layout/navigation_layout.xml b/packages/SystemUI/res/layout/navigation_layout.xml
index a57f0d787d7..8cfb5716043 100644
--- a/packages/SystemUI/res/layout/navigation_layout.xml
+++ b/packages/SystemUI/res/layout/navigation_layout.xml
@@ -18,14 +18,16 @@
     xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:systemui="http://schemas.android.com/apk/res-auto"
     android:layout_width="match_parent"
-    android:layout_height="match_parent">
+    android:layout_height="match_parent"
+    android:layout_marginStart="@dimen/rounded_corner_content_padding"
+    android:layout_marginEnd="@dimen/rounded_corner_content_padding"
+    android:paddingStart="@dimen/nav_content_padding"
+    android:paddingEnd="@dimen/nav_content_padding">
 
     <com.android.systemui.statusbar.phone.NearestTouchFrame
         android:id="@+id/nav_buttons"
         android:layout_width="match_parent"
         android:layout_height="match_parent"
-        android:paddingStart="@dimen/rounded_corner_content_padding"
-        android:paddingEnd="@dimen/rounded_corner_content_padding"
         android:clipChildren="false"
         android:clipToPadding="false">
 
@@ -34,8 +36,6 @@
             android:layout_width="match_parent"
             android:layout_height="match_parent"
             android:orientation="horizontal"
-            android:paddingStart="@dimen/nav_content_padding"
-            android:paddingEnd="@dimen/nav_content_padding"
             android:clipToPadding="false"
             android:clipChildren="false" />
 
@@ -46,8 +46,6 @@
             android:layout_gravity="center"
             android:gravity="center"
             android:orientation="horizontal"
-            android:paddingStart="@dimen/nav_content_padding"
-            android:paddingEnd="@dimen/nav_content_padding"
             android:clipToPadding="false"
             android:clipChildren="false" />
 
diff --git a/packages/SystemUI/res/layout/navigation_layout_rot90.xml b/packages/SystemUI/res/layout/navigation_layout_rot90.xml
index bba2b6d048c..a5b527e7c02 100644
--- a/packages/SystemUI/res/layout/navigation_layout_rot90.xml
+++ b/packages/SystemUI/res/layout/navigation_layout_rot90.xml
@@ -18,14 +18,16 @@
     xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:systemui="http://schemas.android.com/apk/res-auto"
     android:layout_width="match_parent"
-    android:layout_height="match_parent">
+    android:layout_height="match_parent"
+    android:layout_marginTop="@dimen/rounded_corner_content_padding"
+    android:layout_marginBottom="@dimen/rounded_corner_content_padding"
+    android:paddingTop="@dimen/nav_content_padding"
+    android:paddingBottom="@dimen/nav_content_padding">
 
     <com.android.systemui.statusbar.phone.NearestTouchFrame
         android:id="@+id/nav_buttons"
         android:layout_width="match_parent"
         android:layout_height="match_parent"
-        android:paddingTop="@dimen/rounded_corner_content_padding"
-        android:paddingBottom="@dimen/rounded_corner_content_padding"
         android:clipChildren="false"
         android:clipToPadding="false">
 
@@ -34,10 +36,8 @@
             android:layout_width="match_parent"
             android:layout_height="match_parent"
             android:orientation="vertical"
-            android:paddingTop="@dimen/nav_content_padding"
-            android:paddingBottom="@dimen/nav_content_padding"
-            android:clipChildren="false"
-            android:clipToPadding="false" />
+            android:clipToPadding="false"
+            android:clipChildren="false" />
 
         <com.android.systemui.statusbar.phone.ReverseLinearLayout
             android:id="@+id/center_group"
@@ -45,10 +45,8 @@
             android:layout_height="match_parent"
             android:gravity="center"
             android:orientation="vertical"
-            android:paddingTop="@dimen/nav_content_padding"
-            android:paddingBottom="@dimen/nav_content_padding"
-            android:clipChildren="false"
-            android:clipToPadding="false" />
+            android:clipToPadding="false"
+            android:clipChildren="false" />
 
         <include layout="@layout/nav_buttons_dpad_group_rot90" />
 
diff --git a/packages/SystemUI/res/values-af/strings.xml b/packages/SystemUI/res/values-af/strings.xml
index 974c80e5135..b6430e75c66 100644
--- a/packages/SystemUI/res/values-af/strings.xml
+++ b/packages/SystemUI/res/values-af/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Versteek <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Dit sal verskyn die volgende keer wanneer jy dit in instellings aanskakel."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Versteek"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Jy gebruik tans jou werkprofiel"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Bel"</string>
     <string name="stream_system" msgid="7493299064422163147">"Stelsel"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Lui"</string>
diff --git a/packages/SystemUI/res/values-am/strings.xml b/packages/SystemUI/res/values-am/strings.xml
index 612db5558ab..4abe1aa56f8 100644
--- a/packages/SystemUI/res/values-am/strings.xml
+++ b/packages/SystemUI/res/values-am/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"         "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-ar/strings.xml b/packages/SystemUI/res/values-ar/strings.xml
index 6e7477dda49..82c439075a3 100644
--- a/packages/SystemUI/res/values-ar/strings.xml
+++ b/packages/SystemUI/res/values-ar/strings.xml
@@ -534,7 +534,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"   <xliff:g id="TILE_LABEL">%1$s</xliff:g>"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"        ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"    "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-as/strings.xml b/packages/SystemUI/res/values-as/strings.xml
index c8cb3552660..f73236686c7 100644
--- a/packages/SystemUI/res/values-as/strings.xml
+++ b/packages/SystemUI/res/values-as/strings.xml
@@ -95,8 +95,7 @@
     <string name="accessibility_unlock_button" msgid="128158454631118828">" "</string>
     <string name="accessibility_waiting_for_fingerprint" msgid="4808860050517462885">"    "</string>
     <string name="accessibility_unlock_without_fingerprint" msgid="7541705575183694446">"    "</string>
-    <!-- no translation found for accessibility_scanning_face (769545173211758586) -->
-    <skip />
+    <string name="accessibility_scanning_face" msgid="769545173211758586">"    "</string>
     <string name="accessibility_send_smart_reply" msgid="7766727839703044493">""</string>
     <string name="unlock_label" msgid="8779712358041029439">" "</string>
     <string name="phone_label" msgid="2320074140205331708">"\' "</string>
@@ -523,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"          \'"</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   \'   "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
@@ -854,6 +852,5 @@
     <string name="auto_saver_enabled_text" msgid="874711029884777579">"   <xliff:g id="PERCENTAGE">%d</xliff:g>%%         "</string>
     <string name="open_saver_setting_action" msgid="8314624730997322529">""</string>
     <string name="auto_saver_okay_action" msgid="2701221740227683650">" "</string>
-    <!-- no translation found for heap_dump_tile_name (9141031328971226374) -->
-    <skip />
+    <string name="heap_dump_tile_name" msgid="9141031328971226374">"SysUI   "</string>
 </resources>
diff --git a/packages/SystemUI/res/values-as/strings_car.xml b/packages/SystemUI/res/values-as/strings_car.xml
index e8cb6e35fb7..1c4d7944b45 100644
--- a/packages/SystemUI/res/values-as/strings_car.xml
+++ b/packages/SystemUI/res/values-as/strings_car.xml
@@ -22,8 +22,6 @@
     <string name="car_guest" msgid="3738772168718508650">""</string>
     <string name="car_add_user" msgid="5245196248349230898">"  "</string>
     <string name="car_new_user" msgid="8142927244990323906">" "</string>
-    <!-- no translation found for user_add_user_message_setup (1791011504259527329) -->
-    <skip />
-    <!-- no translation found for user_add_user_message_update (3383320289232716179) -->
-    <skip />
+    <string name="user_add_user_message_setup" msgid="1791011504259527329">"              "</string>
+    <string name="user_add_user_message_update" msgid="3383320289232716179">"        "</string>
 </resources>
diff --git a/packages/SystemUI/res/values-az/strings.xml b/packages/SystemUI/res/values-az/strings.xml
index c975de1cc2f..a4528d02b7f 100644
--- a/packages/SystemUI/res/values-az/strings.xml
+++ b/packages/SystemUI/res/values-az/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> gizldilsin?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Ayarlarda onu aktivldircyiniz vaxta qdr o, yenidn grnck."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Gizldin"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">" profilinizi istifad edirsiniz"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Zng"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Zng Edin"</string>
diff --git a/packages/SystemUI/res/values-b+sr+Latn/strings.xml b/packages/SystemUI/res/values-b+sr+Latn/strings.xml
index 5c34cd247bc..e6fe72c578f 100644
--- a/packages/SystemUI/res/values-b+sr+Latn/strings.xml
+++ b/packages/SystemUI/res/values-b+sr+Latn/strings.xml
@@ -525,7 +525,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"elite li da sakrijete <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Ovo e se ponovo pojaviti kada ga sledei put budete ukljuili u podeavanjima."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Sakrij"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Koristite profil za Work"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Poziv"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Zvono"</string>
diff --git a/packages/SystemUI/res/values-be/strings.xml b/packages/SystemUI/res/values-be/strings.xml
index 562925cb9a1..b6bc8f2e9a8 100644
--- a/packages/SystemUI/res/values-be/strings.xml
+++ b/packages/SystemUI/res/values-be/strings.xml
@@ -530,7 +530,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"  \'    ,      ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"    "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-bg/strings.xml b/packages/SystemUI/res/values-bg/strings.xml
index da70fb481e6..78eacedea28 100644
--- a/packages/SystemUI/res/values-bg/strings.xml
+++ b/packages/SystemUI/res/values-bg/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"    <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"       ,     ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"    "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-bn/strings.xml b/packages/SystemUI/res/values-bn/strings.xml
index d34193f67a6..15a629de380 100644
--- a/packages/SystemUI/res/values-bn/strings.xml
+++ b/packages/SystemUI/res/values-bn/strings.xml
@@ -472,8 +472,8 @@
     <string name="monitoring_description_managed_profile_ca_certificate" msgid="4683248196789897964">"                       "</string>
     <string name="monitoring_description_ca_certificate" msgid="7886985418413598352">"                     "</string>
     <string name="monitoring_description_management_network_logging" msgid="7184005419733060736">"     ,       "</string>
-    <string name="monitoring_description_named_vpn" msgid="7403457334088909254">" <xliff:g id="VPN_APP">%1$s</xliff:g>   ,   , ,          "</string>
-    <string name="monitoring_description_two_named_vpns" msgid="4198511413729213802">" <xliff:g id="VPN_APP_0">%1$s</xliff:g>  <xliff:g id="VPN_APP_1">%2$s</xliff:g>    ,   , ,          "</string>
+    <string name="monitoring_description_named_vpn" msgid="7403457334088909254">" <xliff:g id="VPN_APP">%1$s</xliff:g>   ,   , ,          "</string>
+    <string name="monitoring_description_two_named_vpns" msgid="4198511413729213802">" <xliff:g id="VPN_APP_0">%1$s</xliff:g>  <xliff:g id="VPN_APP_1">%2$s</xliff:g>    ,   , ,          "</string>
     <string name="monitoring_description_managed_profile_named_vpn" msgid="1427905889862420559">"   <xliff:g id="VPN_APP">%1$s</xliff:g>    ,  , ,         "</string>
     <string name="monitoring_description_personal_profile_named_vpn" msgid="3133980926929069283">"   <xliff:g id="VPN_APP">%1$s</xliff:g>    ,  , ,         "</string>
     <string name="monitoring_description_do_header_generic" msgid="96588491028288691">"  <xliff:g id="DEVICE_OWNER_APP">%1$s</xliff:g>   "</string>
@@ -481,20 +481,20 @@
     <string name="monitoring_description_do_body" msgid="3639594537660975895">"         ,  , ,      "</string>
     <string name="monitoring_description_do_learn_more_separator" msgid="3785251953067436862">" "</string>
     <string name="monitoring_description_do_learn_more" msgid="1849514470437907421">" "</string>
-    <string name="monitoring_description_do_body_vpn" msgid="8255218762488901796">" <xliff:g id="VPN_APP">%1$s</xliff:g>   ,  ,         "</string>
+    <string name="monitoring_description_do_body_vpn" msgid="8255218762488901796">" <xliff:g id="VPN_APP">%1$s</xliff:g>   ,  ,         "</string>
     <string name="monitoring_description_vpn_settings_separator" msgid="1933186756733474388">" "</string>
     <string name="monitoring_description_vpn_settings" msgid="6434859242636063861">"VPN  "</string>
     <string name="monitoring_description_ca_cert_settings_separator" msgid="4987350385906393626">" "</string>
     <string name="monitoring_description_ca_cert_settings" msgid="5489969458872997092">"  "</string>
     <string name="monitoring_description_network_logging" msgid="7223505523384076027">"     ,      \n\n       "</string>
-    <string name="monitoring_description_vpn" msgid="4445150119515393526">" VPN         \n\n  ,            "</string>
-    <string name="monitoring_description_vpn_profile_owned" msgid="2958019119161161530">"   <xliff:g id="ORGANIZATION">%1$s</xliff:g>   \n\n   ,          \n\n       \n\n   VPN          "</string>
+    <string name="monitoring_description_vpn" msgid="4445150119515393526">" VPN         \n\n  ,            "</string>
+    <string name="monitoring_description_vpn_profile_owned" msgid="2958019119161161530">"   <xliff:g id="ORGANIZATION">%1$s</xliff:g>   \n\n   ,          \n\n       \n\n   VPN          "</string>
     <string name="legacy_vpn_name" msgid="6604123105765737830">"VPN"</string>
     <string name="monitoring_description_app" msgid="1828472472674709532">" <xliff:g id="APPLICATION">%1$s</xliff:g>    ,  , ,         "</string>
-    <string name="monitoring_description_app_personal" msgid="484599052118316268">" <xliff:g id="APPLICATION">%1$s</xliff:g> -  ,  ,           "</string>
-    <string name="branded_monitoring_description_app_personal" msgid="2669518213949202599">" <xliff:g id="APPLICATION">%1$s</xliff:g>    ,  ,          "</string>
-    <string name="monitoring_description_app_work" msgid="4612997849787922906">"<xliff:g id="ORGANIZATION">%1$s</xliff:g>       <xliff:g id="APPLICATION">%2$s</xliff:g>   ,  , ,           \n\n      "</string>
-    <string name="monitoring_description_app_personal_work" msgid="5664165460056859391">"<xliff:g id="ORGANIZATION">%1$s</xliff:g>       <xliff:g id="APPLICATION_WORK">%2$s</xliff:g>   ,   ,           \n\n    <xliff:g id="APPLICATION_PERSONAL">%3$s</xliff:g>   ,      "</string>
+    <string name="monitoring_description_app_personal" msgid="484599052118316268">" <xliff:g id="APPLICATION">%1$s</xliff:g> -  ,  ,           "</string>
+    <string name="branded_monitoring_description_app_personal" msgid="2669518213949202599">" <xliff:g id="APPLICATION">%1$s</xliff:g>    ,  ,          "</string>
+    <string name="monitoring_description_app_work" msgid="4612997849787922906">"<xliff:g id="ORGANIZATION">%1$s</xliff:g>       <xliff:g id="APPLICATION">%2$s</xliff:g>   ,  , ,           \n\n      "</string>
+    <string name="monitoring_description_app_personal_work" msgid="5664165460056859391">"<xliff:g id="ORGANIZATION">%1$s</xliff:g>       <xliff:g id="APPLICATION_WORK">%2$s</xliff:g>   ,   ,           \n\n    <xliff:g id="APPLICATION_PERSONAL">%3$s</xliff:g>   ,      "</string>
     <string name="keyguard_indication_trust_granted" msgid="4985003749105182372">"<xliff:g id="USER_NAME">%1$s</xliff:g>     "</string>
     <string name="keyguard_indication_trust_managed" msgid="8319646760022357585">"<xliff:g id="TRUST_AGENT">%1$s</xliff:g>  "</string>
     <string name="keyguard_indication_trust_disabled" msgid="7412534203633528135">"         "</string>
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"   -      "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"     "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-bs/strings.xml b/packages/SystemUI/res/values-bs/strings.xml
index 73d9b39e052..774bf710ff4 100644
--- a/packages/SystemUI/res/values-bs/strings.xml
+++ b/packages/SystemUI/res/values-bs/strings.xml
@@ -310,7 +310,7 @@
     <string name="quick_settings_wifi_label" msgid="9135344704899546041">"WiFi"</string>
     <string name="quick_settings_wifi_not_connected" msgid="7171904845345573431">"Nije povezano"</string>
     <string name="quick_settings_wifi_no_network" msgid="2221993077220856376">"Nema mree"</string>
-    <string name="quick_settings_wifi_off_label" msgid="7558778100843885864">"WiFi iskljuen"</string>
+    <string name="quick_settings_wifi_off_label" msgid="7558778100843885864">"WiFi je iskljuen"</string>
     <string name="quick_settings_wifi_on_label" msgid="7607810331387031235">"WiFi ukljuen"</string>
     <string name="quick_settings_wifi_detail_empty_text" msgid="269990350383909226">"Nema dostupnih WiFi mrea"</string>
     <string name="quick_settings_wifi_secondary_label_transient" msgid="7748206246119760554">"Ukljuivanje"</string>
@@ -328,7 +328,7 @@
     <string name="quick_settings_connected" msgid="1722253542984847487">"Povezano"</string>
     <string name="quick_settings_connected_battery_level" msgid="4136051440381328892">"Povezano, baterija <xliff:g id="BATTERY_LEVEL_AS_PERCENTAGE">%1$s</xliff:g>"</string>
     <string name="quick_settings_connecting" msgid="47623027419264404">"Povezivanje..."</string>
-    <string name="quick_settings_tethering_label" msgid="7153452060448575549">"Dijeljenje veze"</string>
+    <string name="quick_settings_tethering_label" msgid="7153452060448575549">"Povezivanje putem mobitela"</string>
     <string name="quick_settings_hotspot_label" msgid="6046917934974004879">"Pristupna taka"</string>
     <string name="quick_settings_hotspot_secondary_label_transient" msgid="8010579363691405477">"Ukljuivanje"</string>
     <string name="quick_settings_hotspot_secondary_label_data_saver_enabled" msgid="5672131949987422420">"Uteda podataka uklj."</string>
@@ -525,7 +525,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"elite li sakriti <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Pojavit e se sljedei put kada opciju ukljuite u postavkama."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Sakrij"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Koristite svoj profil za posao"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Poziv"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Zvono"</string>
diff --git a/packages/SystemUI/res/values-ca/strings.xml b/packages/SystemUI/res/values-ca/strings.xml
index 4fb48133381..729fc5f3c09 100644
--- a/packages/SystemUI/res/values-ca/strings.xml
+++ b/packages/SystemUI/res/values-ca/strings.xml
@@ -66,7 +66,7 @@
     <string name="usb_debugging_message" msgid="2220143855912376496">"L\'empremta digital de la clau de l\'RSA de l\'equip s:\n<xliff:g id="FINGERPRINT">%1$s</xliff:g>"</string>
     <string name="usb_debugging_always" msgid="303335496705863070">"Dona sempre perms des d\'aquest equip"</string>
     <string name="usb_debugging_secondary_user_title" msgid="6353808721761220421">"No es permet la depuraci USB"</string>
-    <string name="usb_debugging_secondary_user_message" msgid="6067122453571699801">"L\'usuari que t iniciada la sessi al dispositiu en aquest moment no pot activar la depuraci per USB. Per utilitzar aquesta funci, cal canviar a l\'usuari principal."</string>
+    <string name="usb_debugging_secondary_user_message" msgid="6067122453571699801">"L\'usuari que t iniciada la sessi al dispositiu en aquest moment no pot activar la depuraci USB. Per utilitzar aquesta funci, cal canviar a l\'usuari principal."</string>
     <string name="compat_mode_on" msgid="6623839244840638213">"Zoom per omplir pantalla"</string>
     <string name="compat_mode_off" msgid="4434467572461327898">"Estira per omplir pant."</string>
     <string name="global_action_screenshot" msgid="8329831278085426283">"Captura de pantalla"</string>
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Vols amagar <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Tornar a mostrar-se la propera vegada que l\'activis a la configuraci."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Amaga"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Ests utilitzant el perfil professional"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Trucada"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"To de trucada"</string>
diff --git a/packages/SystemUI/res/values-cs/strings.xml b/packages/SystemUI/res/values-cs/strings.xml
index 90a6b5856b9..ba4d3b43d1c 100644
--- a/packages/SystemUI/res/values-cs/strings.xml
+++ b/packages/SystemUI/res/values-cs/strings.xml
@@ -530,7 +530,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Skrt <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Tato poloka se znovu zobraz, a ji v nastaven znovu zapnete."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Skrt"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Pouvte pracovn profil"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Hovor"</string>
     <string name="stream_system" msgid="7493299064422163147">"Systm"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Vyzvnn"</string>
diff --git a/packages/SystemUI/res/values-da/strings.xml b/packages/SystemUI/res/values-da/strings.xml
index 253f2c5c230..e194806ff34 100644
--- a/packages/SystemUI/res/values-da/strings.xml
+++ b/packages/SystemUI/res/values-da/strings.xml
@@ -43,7 +43,7 @@
     <string name="battery_low_why" msgid="4553600287639198111">"Indstillinger"</string>
     <string name="battery_saver_confirmation_title" msgid="2052100465684817154">"Vil du aktivere Batterisparefunktion?"</string>
     <string name="battery_saver_confirmation_ok" msgid="7507968430447930257">"Aktivr"</string>
-    <string name="battery_saver_start_action" msgid="8187820911065797519">"Aktivr Batterisparefunktion"</string>
+    <string name="battery_saver_start_action" msgid="8187820911065797519">"Aktivr batterisparefunktion"</string>
     <string name="status_bar_settings_settings_button" msgid="3023889916699270224">"Indstillinger"</string>
     <string name="status_bar_settings_wifi_button" msgid="1733928151698311923">"Wi-Fi"</string>
     <string name="status_bar_settings_auto_rotation" msgid="3790482541357798421">"Automatisk skrmrotation"</string>
@@ -431,7 +431,7 @@
     <string name="user_remove_user_remove" msgid="7479275741742178297">"Fjern"</string>
     <string name="battery_saver_notification_title" msgid="8614079794522291840">"Batterisparefunktion er aktiveret"</string>
     <string name="battery_saver_notification_text" msgid="820318788126672692">"Reducerer ydeevne og baggrundsdata"</string>
-    <string name="battery_saver_notification_action_text" msgid="132118784269455533">"Deaktiver Batterisparefunktion"</string>
+    <string name="battery_saver_notification_action_text" msgid="132118784269455533">"Deaktiver batterisparefunktion"</string>
     <string name="media_projection_dialog_text" msgid="3071431025448218928">"<xliff:g id="APP_SEEKING_PERMISSION">%s</xliff:g> vil begynde at optage alt, hvad der vises p din skrm."</string>
     <string name="media_projection_remember_text" msgid="3103510882172746752">"Vis ikke igen"</string>
     <string name="clear_all_notifications_text" msgid="814192889771462828">"Ryd alt"</string>
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Vil du skjule <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Den vises igen, nste gang du aktiverer den i indstillingerne."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Skjul"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Du bruger din arbejdsprofil"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Ring op"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ring"</string>
diff --git a/packages/SystemUI/res/values-de/strings.xml b/packages/SystemUI/res/values-de/strings.xml
index d5991609058..e0f7dffc5cd 100644
--- a/packages/SystemUI/res/values-de/strings.xml
+++ b/packages/SystemUI/res/values-de/strings.xml
@@ -526,7 +526,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ausblenden?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Sie wird wieder eingeblendet, wenn du sie in den Einstellungen erneut aktivierst."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ausblenden"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Du verwendest dein Arbeitsprofil."</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Anruf"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Klingelton"</string>
diff --git a/packages/SystemUI/res/values-el/strings.xml b/packages/SystemUI/res/values-el/strings.xml
index 6414c05787b..c30a1fb9ed6 100644
--- a/packages/SystemUI/res/values-el/strings.xml
+++ b/packages/SystemUI/res/values-el/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>;"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"           ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"    "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-en-rAU/strings.xml b/packages/SystemUI/res/values-en-rAU/strings.xml
index 766b241f72e..ff134d48ff4 100644
--- a/packages/SystemUI/res/values-en-rAU/strings.xml
+++ b/packages/SystemUI/res/values-en-rAU/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Hide <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"It will reappear the next time you turn it on in settings."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Hide"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"You\'re using your work profile"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Call"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ring"</string>
diff --git a/packages/SystemUI/res/values-en-rCA/strings.xml b/packages/SystemUI/res/values-en-rCA/strings.xml
index 306723ae11c..752a72f2022 100644
--- a/packages/SystemUI/res/values-en-rCA/strings.xml
+++ b/packages/SystemUI/res/values-en-rCA/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Hide <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"It will reappear the next time you turn it on in settings."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Hide"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"You\'re using your work profile"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Call"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ring"</string>
diff --git a/packages/SystemUI/res/values-en-rGB/strings.xml b/packages/SystemUI/res/values-en-rGB/strings.xml
index 766b241f72e..ff134d48ff4 100644
--- a/packages/SystemUI/res/values-en-rGB/strings.xml
+++ b/packages/SystemUI/res/values-en-rGB/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Hide <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"It will reappear the next time you turn it on in settings."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Hide"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"You\'re using your work profile"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Call"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ring"</string>
diff --git a/packages/SystemUI/res/values-en-rIN/strings.xml b/packages/SystemUI/res/values-en-rIN/strings.xml
index 766b241f72e..ff134d48ff4 100644
--- a/packages/SystemUI/res/values-en-rIN/strings.xml
+++ b/packages/SystemUI/res/values-en-rIN/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Hide <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"It will reappear the next time you turn it on in settings."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Hide"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"You\'re using your work profile"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Call"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ring"</string>
diff --git a/packages/SystemUI/res/values-en-rXC/strings.xml b/packages/SystemUI/res/values-en-rXC/strings.xml
index 11ca904c5fa..d646ef33eca 100644
--- a/packages/SystemUI/res/values-en-rXC/strings.xml
+++ b/packages/SystemUI/res/values-en-rXC/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Hide <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"It will reappear the next time you turn it on in settings."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Hide"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"You\'re using your work profile"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Call"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ring"</string>
diff --git a/packages/SystemUI/res/values-es-rUS/strings.xml b/packages/SystemUI/res/values-es-rUS/strings.xml
index c712070c4de..eafd2401609 100644
--- a/packages/SystemUI/res/values-es-rUS/strings.xml
+++ b/packages/SystemUI/res/values-es-rUS/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Ocultar <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Volver a aparecer la prxima vez que se active en la configuracin."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ocultar"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Ests usando tu perfil de trabajo"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Llamada"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Hacer sonar"</string>
diff --git a/packages/SystemUI/res/values-es/strings.xml b/packages/SystemUI/res/values-es/strings.xml
index 6797aea9034..296568274a8 100644
--- a/packages/SystemUI/res/values-es/strings.xml
+++ b/packages/SystemUI/res/values-es/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Ocultar <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Volver a aparecer la prxima vez que actives esta opcin en Ajustes."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ocultar"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Ests usando tu perfil de trabajo"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Llamada"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Tono"</string>
diff --git a/packages/SystemUI/res/values-et/strings.xml b/packages/SystemUI/res/values-et/strings.xml
index 29b45577a10..cff7cfe1d8c 100644
--- a/packages/SystemUI/res/values-et/strings.xml
+++ b/packages/SystemUI/res/values-et/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Kas peita <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"See kuvatakse uuesti jrgmisel korral, kui selle seadetes sisse llitate."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Peida"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Kasutate oma tprofiili"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Kne"</string>
     <string name="stream_system" msgid="7493299064422163147">"Ssteem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Helin"</string>
diff --git a/packages/SystemUI/res/values-eu/strings.xml b/packages/SystemUI/res/values-eu/strings.xml
index 190a27d093d..e01b957907f 100644
--- a/packages/SystemUI/res/values-eu/strings.xml
+++ b/packages/SystemUI/res/values-eu/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ezkutatu nahi duzu?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Ezarpenetan aktibatzen duzun hurrengoan agertuko da berriro."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ezkutatu"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Work profila erabiltzen ari zara"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Deia"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Jo tonua"</string>
@@ -564,8 +563,8 @@
     <string name="status_bar" msgid="4877645476959324760">"Egoera-barra"</string>
     <string name="overview" msgid="4018602013895926956">"Ikuspegi orokorra"</string>
     <string name="demo_mode" msgid="2532177350215638026">"Sistemaren erabiltzaile-interfazearen demo modua"</string>
-    <string name="enable_demo_mode" msgid="4844205668718636518">"Gaitu proba modua"</string>
-    <string name="show_demo_mode" msgid="2018336697782464029">"Erakutsi proba modua"</string>
+    <string name="enable_demo_mode" msgid="4844205668718636518">"Gaitu demo modua"</string>
+    <string name="show_demo_mode" msgid="2018336697782464029">"Erakutsi demo modua"</string>
     <string name="status_bar_ethernet" msgid="5044290963549500128">"Ethernet"</string>
     <string name="status_bar_alarm" msgid="8536256753575881818">"Alarma"</string>
     <string name="status_bar_work" msgid="6022553324802866373">"Work profila"</string>
diff --git a/packages/SystemUI/res/values-fa/strings.xml b/packages/SystemUI/res/values-fa/strings.xml
index e0d330a321f..a4447f90304 100644
--- a/packages/SystemUI/res/values-fa/strings.xml
+++ b/packages/SystemUI/res/values-fa/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>  "</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"           ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">" "</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"     "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">" "</string>
diff --git a/packages/SystemUI/res/values-fi/strings.xml b/packages/SystemUI/res/values-fi/strings.xml
index 428f8f896bb..d861ffa6701 100644
--- a/packages/SystemUI/res/values-fi/strings.xml
+++ b/packages/SystemUI/res/values-fi/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Piilotetaanko <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Se tulee takaisin nkyviin, kun seuraavan kerran otat sen kyttn asetuksissa."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Piilota"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Kytt typrofiilia."</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Puhelu"</string>
     <string name="stream_system" msgid="7493299064422163147">"Jrjestelm"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Soittoni"</string>
diff --git a/packages/SystemUI/res/values-fr-rCA/strings.xml b/packages/SystemUI/res/values-fr-rCA/strings.xml
index d1980b42fde..b360f2377be 100644
--- a/packages/SystemUI/res/values-fr-rCA/strings.xml
+++ b/packages/SystemUI/res/values-fr-rCA/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Masquer <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Cet lment rapparatra la prochaine fois que vous l\'activerez dans les paramtres."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Masquer"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Vous utilisez votre profil professionnel."</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Appeler"</string>
     <string name="stream_system" msgid="7493299064422163147">"Systme"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Sonnerie"</string>
diff --git a/packages/SystemUI/res/values-fr/strings.xml b/packages/SystemUI/res/values-fr/strings.xml
index f14bde50567..bf7a7c69c67 100644
--- a/packages/SystemUI/res/values-fr/strings.xml
+++ b/packages/SystemUI/res/values-fr/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Masquer <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Cet lment rapparatra la prochaine fois que vous l\'activerez dans les paramtres."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Masquer"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Vous utilisez votre profil professionnel."</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Appel"</string>
     <string name="stream_system" msgid="7493299064422163147">"Systme"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Sonnerie"</string>
diff --git a/packages/SystemUI/res/values-gl/strings.xml b/packages/SystemUI/res/values-gl/strings.xml
index bd2950784a1..ea48bf407ca 100644
--- a/packages/SystemUI/res/values-gl/strings.xml
+++ b/packages/SystemUI/res/values-gl/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Queres ocultar <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Volver aparecer a prxima vez que se active na configuracin."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ocultar"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Ests usando o perfil de traballo"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Chamada"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ton"</string>
diff --git a/packages/SystemUI/res/values-gu/strings.xml b/packages/SystemUI/res/values-gu/strings.xml
index fb707e76812..6f8d97ed2c2 100644
--- a/packages/SystemUI/res/values-gu/strings.xml
+++ b/packages/SystemUI/res/values-gu/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>  ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"          ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"       "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">" "</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">" "</string>
diff --git a/packages/SystemUI/res/values-hi/strings.xml b/packages/SystemUI/res/values-hi/strings.xml
index ef4cd82e4b4..df75e147afa 100644
--- a/packages/SystemUI/res/values-hi/strings.xml
+++ b/packages/SystemUI/res/values-hi/strings.xml
@@ -409,7 +409,7 @@
     <string name="user_add_user" msgid="5110251524486079492">" "</string>
     <string name="user_new_user_name" msgid="426540612051178753">" "</string>
     <string name="guest_nickname" msgid="8059989128963789678">""</string>
-    <string name="guest_new_guest" msgid="600537543078847803">" "</string>
+    <string name="guest_new_guest" msgid="600537543078847803">" "</string>
     <string name="guest_exit_guest" msgid="7187359342030096885">"  "</string>
     <string name="guest_exit_guest_dialog_title" msgid="8480693520521766688">"  ?"</string>
     <string name="guest_exit_guest_dialog_message" msgid="4155503224769676625">"          ."</string>
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>  ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"              ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"        "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">" "</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">" "</string>
diff --git a/packages/SystemUI/res/values-hr/strings.xml b/packages/SystemUI/res/values-hr/strings.xml
index 61d72a5bc79..76e6fb76c79 100644
--- a/packages/SystemUI/res/values-hr/strings.xml
+++ b/packages/SystemUI/res/values-hr/strings.xml
@@ -525,7 +525,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"elite li sakriti ploicu <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Ponovo e se pojaviti kada je sljedei put ukljuite u postavkama."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Sakrij"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Upotrebljavate radni profil"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Nazovi"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sustav"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Zvoni"</string>
diff --git a/packages/SystemUI/res/values-hu/strings.xml b/packages/SystemUI/res/values-hu/strings.xml
index 752bba9c3b3..a9cadd66321 100644
--- a/packages/SystemUI/res/values-hu/strings.xml
+++ b/packages/SystemUI/res/values-hu/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Elrejti ezt: <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"jbl megjelenik majd, amikor ismt engedlyezi a belltsok kztt."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Elrejts"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"A munkaprofilt hasznlja"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Telefonhvs"</string>
     <string name="stream_system" msgid="7493299064422163147">"Rendszer"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Csrgets"</string>
diff --git a/packages/SystemUI/res/values-hy/strings.xml b/packages/SystemUI/res/values-hy/strings.xml
index 6cb5d7c0b86..817f2a42d30 100644
--- a/packages/SystemUI/res/values-hy/strings.xml
+++ b/packages/SystemUI/res/values-hy/strings.xml
@@ -69,15 +69,15 @@
     <string name="usb_debugging_secondary_user_message" msgid="6067122453571699801">"      USB :         :"</string>
     <string name="compat_mode_on" msgid="6623839244840638213">"`   "</string>
     <string name="compat_mode_off" msgid="4434467572461327898">"`   "</string>
-    <string name="global_action_screenshot" msgid="8329831278085426283">" "</string>
-    <string name="screenshot_saving_ticker" msgid="7403652894056693515">"   "</string>
-    <string name="screenshot_saving_title" msgid="8242282144535555697">"   ..."</string>
-    <string name="screenshot_saved_title" msgid="5637073968117370753">"  "</string>
-    <string name="screenshot_saved_text" msgid="7574667448002050363">"    "</string>
-    <string name="screenshot_failed_title" msgid="7612509838919089748">"   "</string>
+    <string name="global_action_screenshot" msgid="8329831278085426283">""</string>
+    <string name="screenshot_saving_ticker" msgid="7403652894056693515">"  "</string>
+    <string name="screenshot_saving_title" msgid="8242282144535555697">"  ..."</string>
+    <string name="screenshot_saved_title" msgid="5637073968117370753">" "</string>
+    <string name="screenshot_saved_text" msgid="7574667448002050363">"   "</string>
+    <string name="screenshot_failed_title" msgid="7612509838919089748">"  "</string>
     <string name="screenshot_failed_to_save_unknown_text" msgid="3637758096565605541">" "</string>
-    <string name="screenshot_failed_to_save_text" msgid="3041612585107107310">"      "</string>
-    <string name="screenshot_failed_to_capture_text" msgid="173674476457581486">"        "</string>
+    <string name="screenshot_failed_to_save_text" msgid="3041612585107107310">"     "</string>
+    <string name="screenshot_failed_to_capture_text" msgid="173674476457581486">"       "</string>
     <string name="usb_preference_title" msgid="6551050377388882787">"USB   "</string>
     <string name="use_mtp_button_title" msgid="4333504413563023626">"    (MTP)"</string>
     <string name="use_ptp_button_title" msgid="7517127540301625751">"   (PTP)"</string>
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>-:"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"  ,    :"</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"     "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
@@ -815,7 +814,7 @@
     <string name="tuner_app" msgid="3507057938640108777">"<xliff:g id="APP">%1$s</xliff:g> "</string>
     <string name="notification_channel_alerts" msgid="4496839309318519037">""</string>
     <string name="notification_channel_battery" msgid="5786118169182888462">""</string>
-    <string name="notification_channel_screenshot" msgid="6314080179230000938">" "</string>
+    <string name="notification_channel_screenshot" msgid="6314080179230000938">""</string>
     <string name="notification_channel_general" msgid="4525309436693914482">" "</string>
     <string name="notification_channel_storage" msgid="3077205683020695313">""</string>
     <string name="notification_channel_hints" msgid="7323870212489152689">""</string>
diff --git a/packages/SystemUI/res/values-in/strings.xml b/packages/SystemUI/res/values-in/strings.xml
index eb0cf08ee58..7bbba8eb420 100644
--- a/packages/SystemUI/res/values-in/strings.xml
+++ b/packages/SystemUI/res/values-in/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Sembunyikan <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Ini akan muncul kembali saat Anda mengaktifkannya dalam setelan."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Sembunyikan"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Anda menggunakan profil kerja"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Telepon"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Dering"</string>
@@ -580,7 +579,7 @@
     <string name="tuner_warning_title" msgid="7094689930793031682">"Tidak semua orang menganggapnya baik"</string>
     <string name="tuner_warning" msgid="8730648121973575701">"Penyetel Antarmuka Pengguna Sistem memberikan cara tambahan untuk mengubah dan menyesuaikan antarmuka pengguna Android. Fitur eksperimental ini dapat berubah, rusak, atau menghilang dalam rilis di masa mendatang. Lanjutkan dengan hati-hati."</string>
     <string name="tuner_persistent_warning" msgid="8597333795565621795">"Fitur eksperimental ini dapat berubah, rusak, atau menghilang dalam rilis di masa mendatang. Lanjutkan dengan hati-hati."</string>
-    <string name="got_it" msgid="2239653834387972602">"Mengerti"</string>
+    <string name="got_it" msgid="2239653834387972602">"Oke"</string>
     <string name="tuner_toast" msgid="603429811084428439">"Selamat! Penyetel Antarmuka Pengguna Sistem telah ditambahkan ke Setelan"</string>
     <string name="remove_from_settings" msgid="8389591916603406378">"Hapus dari Setelan"</string>
     <string name="remove_from_settings_prompt" msgid="6069085993355887748">"Hapus Penyetel Antarmuka Pengguna Sistem dari Setelan dan berhenti menggunakan semua fiturnya?"</string>
diff --git a/packages/SystemUI/res/values-is/strings.xml b/packages/SystemUI/res/values-is/strings.xml
index a8357e76398..0d283fd4ee0 100644
--- a/packages/SystemUI/res/values-is/strings.xml
+++ b/packages/SystemUI/res/values-is/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Fela <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"etta birtist aftur nst egar  kveikir  v  stillingunum."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Fela"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">" ert a nota vinnusnii"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Smtal"</string>
     <string name="stream_system" msgid="7493299064422163147">"Kerfi"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Hringing"</string>
diff --git a/packages/SystemUI/res/values-it/strings.xml b/packages/SystemUI/res/values-it/strings.xml
index 26b607ed776..10736395bb6 100644
--- a/packages/SystemUI/res/values-it/strings.xml
+++ b/packages/SystemUI/res/values-it/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Nascondere <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Verranno visualizzate di nuovo quando le riattiverai nelle impostazioni."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Nascondi"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Stai utilizzando il profilo di lavoro"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Chiamata"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Suoneria"</string>
diff --git a/packages/SystemUI/res/values-iw/strings.xml b/packages/SystemUI/res/values-iw/strings.xml
index ed9df68b985..ece9656d21a 100644
--- a/packages/SystemUI/res/values-iw/strings.xml
+++ b/packages/SystemUI/res/values-iw/strings.xml
@@ -528,7 +528,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"       ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"    "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-ja/strings.xml b/packages/SystemUI/res/values-ja/strings.xml
index cc2613b696f..e6161f74c4e 100644
--- a/packages/SystemUI/res/values-ja/strings.xml
+++ b/packages/SystemUI/res/values-ja/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"ON"</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">""</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
@@ -538,7 +537,7 @@
     <string name="volume_ringer_status_normal" msgid="4273142424125855384">""</string>
     <string name="volume_ringer_status_vibrate" msgid="1825615171021346557">""</string>
     <string name="volume_ringer_status_silent" msgid="6896394161022916369">""</string>
-    <string name="qs_status_phone_vibrate" msgid="204362991135761679">""</string>
+    <string name="qs_status_phone_vibrate" msgid="204362991135761679">" ON "</string>
     <string name="qs_status_phone_muted" msgid="5437668875879171548">""</string>
     <string name="volume_stream_content_description_unmute" msgid="4436631538779230857">"%1$s"</string>
     <string name="volume_stream_content_description_vibrate" msgid="1187944970457807498">"%1$s"</string>
@@ -606,7 +605,7 @@
     <string name="notification_header_default_channel" msgid="7506845022070889909">""</string>
     <string name="notification_channel_disabled" msgid="344536703863700565">""</string>
     <string name="notification_channel_minimized" msgid="1664411570378910931">""</string>
-    <string name="inline_blocking_helper" msgid="3055064577771478591">"\n"</string>
+    <string name="inline_blocking_helper" msgid="3055064577771478591">"\n"</string>
     <string name="inline_keep_showing" msgid="8945102997083836858">""</string>
     <string name="inline_stop_button" msgid="4172980096860941033">""</string>
     <string name="inline_keep_button" msgid="6665940297019018232">""</string>
diff --git a/packages/SystemUI/res/values-ka/strings.xml b/packages/SystemUI/res/values-ka/strings.xml
index 1994e7205cc..698571065d7 100644
--- a/packages/SystemUI/res/values-ka/strings.xml
+++ b/packages/SystemUI/res/values-ka/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"  ,   "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-kk/strings.xml b/packages/SystemUI/res/values-kk/strings.xml
index 93791cb910b..0088f123451 100644
--- a/packages/SystemUI/res/values-kk/strings.xml
+++ b/packages/SystemUI/res/values-kk/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>   ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"        ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"    "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">" "</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-km/strings.xml b/packages/SystemUI/res/values-km/strings.xml
index 21ad0096f56..ec1fdb8292c 100644
--- a/packages/SystemUI/res/values-km/strings.xml
+++ b/packages/SystemUI/res/values-km/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">" "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">""</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-kn/strings.xml b/packages/SystemUI/res/values-kn/strings.xml
index e789bb27b77..0d5e0e4be0d 100644
--- a/packages/SystemUI/res/values-kn/strings.xml
+++ b/packages/SystemUI/res/values-kn/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"      ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"     "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-ko/strings.xml b/packages/SystemUI/res/values-ko/strings.xml
index 766f0d98013..e5c9d784a6e 100644
--- a/packages/SystemUI/res/values-ko/strings.xml
+++ b/packages/SystemUI/res/values-ko/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>() ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"     ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   ."</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-ky/strings.xml b/packages/SystemUI/res/values-ky/strings.xml
index 02cc59625f6..4d76f83903a 100644
--- a/packages/SystemUI/res/values-ky/strings.xml
+++ b/packages/SystemUI/res/values-ky/strings.xml
@@ -299,7 +299,7 @@
     <string name="quick_settings_location_off_label" msgid="7464544086507331459">" "</string>
     <string name="quick_settings_media_device_label" msgid="1302906836372603762">" "</string>
     <string name="quick_settings_rssi_label" msgid="7725671335550695589">"RSSI"</string>
-    <string name="quick_settings_rssi_emergency_only" msgid="2713774041672886750">"  "</string>
+    <string name="quick_settings_rssi_emergency_only" msgid="2713774041672886750">"    "</string>
     <string name="quick_settings_settings_label" msgid="5326556592578065401">""</string>
     <string name="quick_settings_time_label" msgid="4635969182239736408">""</string>
     <string name="quick_settings_user_label" msgid="5238995632130897840">""</string>
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"      ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-lo/strings.xml b/packages/SystemUI/res/values-lo/strings.xml
index 0a0da1cfb55..6268656dd37 100644
--- a/packages/SystemUI/res/values-lo/strings.xml
+++ b/packages/SystemUI/res/values-lo/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">""</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-lt/strings.xml b/packages/SystemUI/res/values-lt/strings.xml
index fc893f8ee2c..dc34974ef5b 100644
--- a/packages/SystemUI/res/values-lt/strings.xml
+++ b/packages/SystemUI/res/values-lt/strings.xml
@@ -528,7 +528,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Slpti <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Tai bus vl parodyta, kai kit kart jungsite tai nustatymuose."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Slpti"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Naudojate darbo profil"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Skambutis"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Skambutis"</string>
@@ -829,8 +828,8 @@
     <string name="notification_channel_general" msgid="4525309436693914482">"Bendrieji praneimai"</string>
     <string name="notification_channel_storage" msgid="3077205683020695313">"Saugykla"</string>
     <string name="notification_channel_hints" msgid="7323870212489152689">"Uuominos"</string>
-    <string name="instant_apps" msgid="6647570248119804907">"Akimirksniu keliamos programls"</string>
-    <string name="instant_apps_message" msgid="8116608994995104836">"Akimirksniu keliam programli nereikia diegti."</string>
+    <string name="instant_apps" msgid="6647570248119804907">"Akimirksniu keliamos programos"</string>
+    <string name="instant_apps_message" msgid="8116608994995104836">"Akimirksniu keliam program nereikia diegti."</string>
     <string name="app_info" msgid="6856026610594615344">"Programos informacija"</string>
     <string name="go_to_web" msgid="2650669128861626071">"Eiti  narykl"</string>
     <string name="mobile_data" msgid="7094582042819250762">"Mobilieji duomenys"</string>
diff --git a/packages/SystemUI/res/values-lv/strings.xml b/packages/SystemUI/res/values-lv/strings.xml
index 8eeea1618e3..82932e41916 100644
--- a/packages/SystemUI/res/values-lv/strings.xml
+++ b/packages/SystemUI/res/values-lv/strings.xml
@@ -525,7 +525,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Vai paslpt vienumu <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Tas tiks atkrtoti pardts, kad nkamreiz ieslgsiet to iestatjumos."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Paslpt"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Js izmantojat darba profilu."</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Zvans"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistma"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Zvans"</string>
diff --git a/packages/SystemUI/res/values-mk/strings.xml b/packages/SystemUI/res/values-mk/strings.xml
index 7e1a59d7583..bf96d702dad 100644
--- a/packages/SystemUI/res/values-mk/strings.xml
+++ b/packages/SystemUI/res/values-mk/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"           ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-ml/strings.xml b/packages/SystemUI/res/values-ml/strings.xml
index 15da3b07f09..e353e714a58 100644
--- a/packages/SystemUI/res/values-ml/strings.xml
+++ b/packages/SystemUI/res/values-ml/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>  ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"        ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-mn/strings.xml b/packages/SystemUI/res/values-mn/strings.xml
index 6ce9115cd82..33540c16875 100644
--- a/packages/SystemUI/res/values-mn/strings.xml
+++ b/packages/SystemUI/res/values-mn/strings.xml
@@ -520,7 +520,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>-  ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"      ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"     "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-mr/strings.xml b/packages/SystemUI/res/values-mr/strings.xml
index b7fcbd9e130..f23f304bc61 100644
--- a/packages/SystemUI/res/values-mr/strings.xml
+++ b/packages/SystemUI/res/values-mr/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"          ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"     "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">" "</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">" "</string>
diff --git a/packages/SystemUI/res/values-ms/strings.xml b/packages/SystemUI/res/values-ms/strings.xml
index 60231ec3db9..ac2687a9b57 100644
--- a/packages/SystemUI/res/values-ms/strings.xml
+++ b/packages/SystemUI/res/values-ms/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Sembunyikan <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Mesej itu akan terpapar semula pada kali seterusnya anda menghidupkan apl dalam tetapan."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Sembunyikan"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Anda sedang menggunakan profil kerja"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Panggil"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Dering"</string>
diff --git a/packages/SystemUI/res/values-my/strings.xml b/packages/SystemUI/res/values-my/strings.xml
index 72a897dd988..083bbf8307a 100644
--- a/packages/SystemUI/res/values-my/strings.xml
+++ b/packages/SystemUI/res/values-my/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"  "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"  "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-nb/strings.xml b/packages/SystemUI/res/values-nb/strings.xml
index b7121ddd163..efc3c3b5fe2 100644
--- a/packages/SystemUI/res/values-nb/strings.xml
+++ b/packages/SystemUI/res/values-nb/strings.xml
@@ -292,7 +292,7 @@
     <string name="accessibility_quick_settings_rotation" msgid="4231661040698488779">"Rotr skjermen automatisk"</string>
     <string name="accessibility_quick_settings_rotation_value" msgid="8187398200140760213">"<xliff:g id="ID_1">%s</xliff:g>-modus"</string>
     <string name="quick_settings_rotation_locked_label" msgid="6359205706154282377">"Rotasjonen er lst"</string>
-    <string name="quick_settings_rotation_locked_portrait_label" msgid="5102691921442135053">"Portrett"</string>
+    <string name="quick_settings_rotation_locked_portrait_label" msgid="5102691921442135053">"Stende"</string>
     <string name="quick_settings_rotation_locked_landscape_label" msgid="8553157770061178719">"Landskap"</string>
     <string name="quick_settings_ime_label" msgid="7073463064369468429">"Inndatametode"</string>
     <string name="quick_settings_location_label" msgid="5011327048748762257">"Sted"</string>
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Vil du skjule <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Den vises igjen neste gang du slr den p i innstillingene."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Skjul"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Du bruker jobbprofilen din"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Anrop"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ring"</string>
diff --git a/packages/SystemUI/res/values-ne/strings.xml b/packages/SystemUI/res/values-ne/strings.xml
index 59444b24abe..3ba271cc3ee 100644
--- a/packages/SystemUI/res/values-ne/strings.xml
+++ b/packages/SystemUI/res/values-ne/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"        "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"     "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-nl/strings.xml b/packages/SystemUI/res/values-nl/strings.xml
index a730586aade..9f82c732832 100644
--- a/packages/SystemUI/res/values-nl/strings.xml
+++ b/packages/SystemUI/res/values-nl/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> verbergen?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Deze wordt opnieuw weergegeven zodra u de instelling weer inschakelt."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Verbergen"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Je gebruikt je werkprofiel"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Bellen"</string>
     <string name="stream_system" msgid="7493299064422163147">"Systeem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Bellen"</string>
diff --git a/packages/SystemUI/res/values-or/strings.xml b/packages/SystemUI/res/values-or/strings.xml
index a223d44fe32..10469b6bb02 100644
--- a/packages/SystemUI/res/values-or/strings.xml
+++ b/packages/SystemUI/res/values-or/strings.xml
@@ -150,16 +150,13 @@
     <string name="data_connection_gprs" msgid="7652872568358508452">"GPRS"</string>
     <string name="data_connection_hspa" msgid="1499615426569473562">"HSPA"</string>
     <string name="data_connection_3g" msgid="503045449315378373">"3G"</string>
-    <!-- no translation found for data_connection_3_5g (3164370985817123144) -->
-    <skip />
-    <!-- no translation found for data_connection_3_5g_plus (4464630787664529264) -->
-    <skip />
+    <string name="data_connection_3_5g" msgid="3164370985817123144">"H"</string>
+    <string name="data_connection_3_5g_plus" msgid="4464630787664529264">"H+"</string>
     <string name="data_connection_4g" msgid="9139963475267449144">"4G"</string>
     <string name="data_connection_4g_plus" msgid="1148687201877800700">"4G+"</string>
     <string name="data_connection_lte" msgid="2694876797724028614">"LTE"</string>
     <string name="data_connection_lte_plus" msgid="3423013208570937424">"LTE+"</string>
-    <!-- no translation found for data_connection_cdma (8176597308239086780) -->
-    <skip />
+    <string name="data_connection_cdma" msgid="8176597308239086780">"1X"</string>
     <string name="data_connection_roaming" msgid="6037232010953697354">""</string>
     <string name="data_connection_edge" msgid="871835227939216682">"EDGE"</string>
     <string name="accessibility_data_connection_wifi" msgid="2324496756590645221">"-"</string>
@@ -525,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"      ,   "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"     "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">" "</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-pa/strings.xml b/packages/SystemUI/res/values-pa/strings.xml
index 7dac72bc17a..7226e0b6af7 100644
--- a/packages/SystemUI/res/values-pa/strings.xml
+++ b/packages/SystemUI/res/values-pa/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>   ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"             "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"      "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">" "</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">" "</string>
diff --git a/packages/SystemUI/res/values-pl/strings.xml b/packages/SystemUI/res/values-pl/strings.xml
index 44517f62850..7f2949727a3 100644
--- a/packages/SystemUI/res/values-pl/strings.xml
+++ b/packages/SystemUI/res/values-pl/strings.xml
@@ -528,7 +528,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Ukry <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Pojawi si ponownie, gdy nastpnym wczysz go w ustawieniach."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ukryj"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Uywasz profilu do pracy"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Poczenie"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Dzwonek"</string>
diff --git a/packages/SystemUI/res/values-pt-rBR/strings.xml b/packages/SystemUI/res/values-pt-rBR/strings.xml
index bcb4e1b8a40..407f27aba7a 100644
--- a/packages/SystemUI/res/values-pt-rBR/strings.xml
+++ b/packages/SystemUI/res/values-pt-rBR/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Esconder <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Ela reaparecer na prxima vez que voc ativ-la nas configuraes."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ocultar"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Voc est usando seu perfil de trabalho"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Ligar"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Tocar"</string>
diff --git a/packages/SystemUI/res/values-pt-rPT/strings.xml b/packages/SystemUI/res/values-pt-rPT/strings.xml
index d505ac62a3b..1c256b009c9 100644
--- a/packages/SystemUI/res/values-pt-rPT/strings.xml
+++ b/packages/SystemUI/res/values-pt-rPT/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Pretende ocultar <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Reaparecer da prxima vez que a funcionalidade for ativada nas definies."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ocultar"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Est a utilizar o seu perfil de trabalho"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Chamada"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Toque"</string>
diff --git a/packages/SystemUI/res/values-pt/strings.xml b/packages/SystemUI/res/values-pt/strings.xml
index bcb4e1b8a40..407f27aba7a 100644
--- a/packages/SystemUI/res/values-pt/strings.xml
+++ b/packages/SystemUI/res/values-pt/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Esconder <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Ela reaparecer na prxima vez que voc ativ-la nas configuraes."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ocultar"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Voc est usando seu perfil de trabalho"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Ligar"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistema"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Tocar"</string>
diff --git a/packages/SystemUI/res/values-ro/strings.xml b/packages/SystemUI/res/values-ro/strings.xml
index 6ed33cb6d37..02b4f3cb333 100644
--- a/packages/SystemUI/res/values-ro/strings.xml
+++ b/packages/SystemUI/res/values-ro/strings.xml
@@ -527,7 +527,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Ascundei <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Va reaprea la urmtoarea activare n setri."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ascundei"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Acum folosii profilul de serviciu"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Apel"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Sonerie"</string>
diff --git a/packages/SystemUI/res/values-ru/strings.xml b/packages/SystemUI/res/values-ru/strings.xml
index ef3d41fd093..1b42f78f76b 100644
--- a/packages/SystemUI/res/values-ru/strings.xml
+++ b/packages/SystemUI/res/values-ru/strings.xml
@@ -530,7 +530,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"  \"<xliff:g id="TILE_LABEL">%1$s</xliff:g>\"?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"     ,    ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"    "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-si/strings.xml b/packages/SystemUI/res/values-si/strings.xml
index ebfaba64387..854f9aecf6a 100644
--- a/packages/SystemUI/res/values-si/strings.xml
+++ b/packages/SystemUI/res/values-si/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"           ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"      "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">" "</string>
diff --git a/packages/SystemUI/res/values-sk/strings.xml b/packages/SystemUI/res/values-sk/strings.xml
index 38656addaf4..f60741aab56 100644
--- a/packages/SystemUI/res/values-sk/strings.xml
+++ b/packages/SystemUI/res/values-sk/strings.xml
@@ -530,7 +530,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Skry <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Tto poloka sa znova zobraz, ke ju v nastaveniach optovne zapnete."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Skry"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Pouvate svoj pracovn profil."</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Zavola"</string>
     <string name="stream_system" msgid="7493299064422163147">"Systm"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Zvonenie"</string>
diff --git a/packages/SystemUI/res/values-sl/strings.xml b/packages/SystemUI/res/values-sl/strings.xml
index 5ccfc3700d6..4141966ba9e 100644
--- a/packages/SystemUI/res/values-sl/strings.xml
+++ b/packages/SystemUI/res/values-sl/strings.xml
@@ -530,7 +530,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"elite skriti <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Znova se bo pojavila, ko jo naslednji vklopite v nastavitvah."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Skrij"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Uporabljate delovni profil"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Klic"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Sproitev zvonjenja"</string>
diff --git a/packages/SystemUI/res/values-sq/strings.xml b/packages/SystemUI/res/values-sq/strings.xml
index 7ea171d9b0b..86a4e4be5dc 100644
--- a/packages/SystemUI/res/values-sq/strings.xml
+++ b/packages/SystemUI/res/values-sq/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"T fshihet <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Do t rishfaqet hern tjetr kur ta aktivizoni te cilsimet."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Fshih"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Po prdor profilin tnd t puns"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Telefono"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistemi"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Bjeri ziles"</string>
diff --git a/packages/SystemUI/res/values-sr/strings.xml b/packages/SystemUI/res/values-sr/strings.xml
index f88d2ccb415..10af2c4882f 100644
--- a/packages/SystemUI/res/values-sr/strings.xml
+++ b/packages/SystemUI/res/values-sr/strings.xml
@@ -525,7 +525,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"    <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"            ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   Work"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-sv/strings.xml b/packages/SystemUI/res/values-sv/strings.xml
index 88946f7bdf6..56656d706f4 100644
--- a/packages/SystemUI/res/values-sv/strings.xml
+++ b/packages/SystemUI/res/values-sv/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Vill du dlja <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Den visas p nytt nsta gng du aktiverar den i instllningarna."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Dlj"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Du anvnder din jobbprofil"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Samtal"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ringsignal"</string>
diff --git a/packages/SystemUI/res/values-sw/strings.xml b/packages/SystemUI/res/values-sw/strings.xml
index d25279c7d69..e049dd5a81f 100644
--- a/packages/SystemUI/res/values-sw/strings.xml
+++ b/packages/SystemUI/res/values-sw/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Ungependa kuficha <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Itaonekana tena wakati mwingine utakapoiwasha katika mipangilio."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Ficha"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Unatumia wasifu wako wa kazini"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Piga simu"</string>
     <string name="stream_system" msgid="7493299064422163147">"Mfumo"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Piga"</string>
@@ -706,7 +705,7 @@
     <string name="nav_bar_layout" msgid="3664072994198772020">"Mpangilio"</string>
     <string name="left_nav_bar_button_type" msgid="8555981238887546528">"Aina ya kitufe cha kushoto cha ziada"</string>
     <string name="right_nav_bar_button_type" msgid="2481056627065649656">"Aina ya kitufe cha kulia cha ziada"</string>
-    <string name="nav_bar_default" msgid="8587114043070993007">"(chaguo msingi)"</string>
+    <string name="nav_bar_default" msgid="8587114043070993007">"(chaguomsingi)"</string>
   <string-array name="nav_bar_buttons">
     <item msgid="1545641631806817203">"Ubao wa kunakili"</item>
     <item msgid="5742013440802239414">"Msimbo wa ufunguo"</item>
@@ -736,12 +735,12 @@
     <string name="tuner_time" msgid="6572217313285536011">"Wakati"</string>
   <string-array name="clock_options">
     <item msgid="5965318737560463480">"Onyesha saa, dakika na sekunde"</item>
-    <item msgid="1427801730816895300">"Onyesha saa na dakika (chaguo msingi)"</item>
+    <item msgid="1427801730816895300">"Onyesha saa na dakika (chaguomsingi)"</item>
     <item msgid="3830170141562534721">"Usionyeshe aikoni hii"</item>
   </string-array>
   <string-array name="battery_options">
     <item msgid="3160236755818672034">"Onyesha asilimia kila wakati"</item>
-    <item msgid="2139628951880142927">"Onyesha asilimia wakati inachaji (chaguo msingi)"</item>
+    <item msgid="2139628951880142927">"Onyesha asilimia wakati inachaji (chaguomsingi)"</item>
     <item msgid="3327323682209964956">"Usionyeshe aikoni hii"</item>
   </string-array>
     <string name="other" msgid="4060683095962566764">"Nyingine"</string>
diff --git a/packages/SystemUI/res/values-ta/strings.xml b/packages/SystemUI/res/values-ta/strings.xml
index e0b5cf2dc2d..d737bcaaa6d 100644
--- a/packages/SystemUI/res/values-ta/strings.xml
+++ b/packages/SystemUI/res/values-ta/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"    ,   ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"  "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">" "</string>
diff --git a/packages/SystemUI/res/values-te/strings.xml b/packages/SystemUI/res/values-te/strings.xml
index 86ae324fa24..0298a0ec752 100644
--- a/packages/SystemUI/res/values-te/strings.xml
+++ b/packages/SystemUI/res/values-te/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> ?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"       ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"    "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-th/strings.xml b/packages/SystemUI/res/values-th/strings.xml
index ed91dbd9fde..7392942134a 100644
--- a/packages/SystemUI/res/values-th/strings.xml
+++ b/packages/SystemUI/res/values-th/strings.xml
@@ -57,7 +57,7 @@
     <string name="usb_accessory_permission_prompt" msgid="2465531696941369047">" <xliff:g id="APPLICATION">%1$s</xliff:g>  <xliff:g id="USB_ACCESSORY">%2$s</xliff:g> "</string>
     <string name="usb_device_confirm_prompt" msgid="7440562274256843905">" <xliff:g id="APPLICATION">%1$s</xliff:g>  <xliff:g id="USB_DEVICE">%2$s</xliff:g> "</string>
     <string name="usb_accessory_confirm_prompt" msgid="4333670517539993561">" <xliff:g id="APPLICATION">%1$s</xliff:g>  <xliff:g id="USB_ACCESSORY">%2$s</xliff:g> "</string>
-    <string name="usb_accessory_uri_prompt" msgid="513450621413733343">" USB   <xliff:g id="URL">%1$s</xliff:g>"</string>
+    <string name="usb_accessory_uri_prompt" msgid="513450621413733343">" USB   <xliff:g id="URL">%1$s</xliff:g>"</string>
     <string name="title_usb_accessory" msgid="4966265263465181372">" USB"</string>
     <string name="label_view" msgid="6304565553218192990">""</string>
     <string name="always_use_device" msgid="4015357883336738417">" <xliff:g id="APPLICATION">%1$s</xliff:g>  <xliff:g id="USB_DEVICE">%2$s</xliff:g>"</string>
@@ -480,7 +480,7 @@
     <string name="monitoring_description_do_header_with_name" msgid="5511133708978206460">"<xliff:g id="ORGANIZATION_NAME">%1$s</xliff:g>  <xliff:g id="DEVICE_OWNER_APP">%2$s</xliff:g> "</string>
     <string name="monitoring_description_do_body" msgid="3639594537660975895">"    "</string>
     <string name="monitoring_description_do_learn_more_separator" msgid="3785251953067436862">" "</string>
-    <string name="monitoring_description_do_learn_more" msgid="1849514470437907421">""</string>
+    <string name="monitoring_description_do_learn_more" msgid="1849514470437907421">""</string>
     <string name="monitoring_description_do_body_vpn" msgid="8255218762488901796">" <xliff:g id="VPN_APP">%1$s</xliff:g>    "</string>
     <string name="monitoring_description_vpn_settings_separator" msgid="1933186756733474388">" "</string>
     <string name="monitoring_description_vpn_settings" msgid="6434859242636063861">" VPN"</string>
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g> "</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">""</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">""</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-tl/strings.xml b/packages/SystemUI/res/values-tl/strings.xml
index 260f7dde4bd..fccb4baddf7 100644
--- a/packages/SystemUI/res/values-tl/strings.xml
+++ b/packages/SystemUI/res/values-tl/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Itago ang <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Lalabas itong muli sa susunod na pagkakataon na i-on mo ito sa mga setting."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Itago"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Ginagamit mo ang iyong profile sa trabaho"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Tumawag"</string>
     <string name="stream_system" msgid="7493299064422163147">"System"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Ipa-ring"</string>
diff --git a/packages/SystemUI/res/values-tr/strings.xml b/packages/SystemUI/res/values-tr/strings.xml
index 6fea0b733e1..eeb4f9b84bf 100644
--- a/packages/SystemUI/res/values-tr/strings.xml
+++ b/packages/SystemUI/res/values-tr/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> gizlensin mi?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Ayarlardan etkinletirdiiniz bir sonraki sefer tekrar grnr."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Gizle"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">" profilinizi kullanyorsunuz"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"ar"</string>
     <string name="stream_system" msgid="7493299064422163147">"Sistem"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Zili aldr"</string>
diff --git a/packages/SystemUI/res/values-uk/strings.xml b/packages/SystemUI/res/values-uk/strings.xml
index aa7b945fcd4..a4e9c80625e 100644
--- a/packages/SystemUI/res/values-uk/strings.xml
+++ b/packages/SystemUI/res/values-uk/strings.xml
@@ -530,7 +530,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">" ,      ."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"   "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-ur/strings.xml b/packages/SystemUI/res/values-ur/strings.xml
index 5af6d3e11e4..2ef372a8aed 100644
--- a/packages/SystemUI/res/values-ur/strings.xml
+++ b/packages/SystemUI/res/values-ur/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>  "</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"             "</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"       "</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-uz/strings.xml b/packages/SystemUI/res/values-uz/strings.xml
index fba027ba4db..e16c53d0579 100644
--- a/packages/SystemUI/res/values-uz/strings.xml
+++ b/packages/SystemUI/res/values-uz/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g> berkitilsinmi?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Keyingi safar sozlamalardan yoqilgan paydo boladi."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Berkitish"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Siz ishchi profildan foydalanmoqdasiz"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Chaqiruv"</string>
     <string name="stream_system" msgid="7493299064422163147">"Tizim"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Jiringlatish"</string>
diff --git a/packages/SystemUI/res/values-vi/strings.xml b/packages/SystemUI/res/values-vi/strings.xml
index 0d26f67219d..554d44883c9 100644
--- a/packages/SystemUI/res/values-vi/strings.xml
+++ b/packages/SystemUI/res/values-vi/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"n <xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Thng bo ny s xut hin li vo ln tip theo bn bt thng bo trong ci t."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"n"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Bn ang s dng h s cng vic ca mnh"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Gi"</string>
     <string name="stream_system" msgid="7493299064422163147">"H thng"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Chung"</string>
diff --git a/packages/SystemUI/res/values-zh-rCN/strings.xml b/packages/SystemUI/res/values-zh-rCN/strings.xml
index 3bf909b9229..6799239e710 100644
--- a/packages/SystemUI/res/values-zh-rCN/strings.xml
+++ b/packages/SystemUI/res/values-zh-rCN/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">""</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">""</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-zh-rHK/strings.xml b/packages/SystemUI/res/values-zh-rHK/strings.xml
index 965997fe9b7..fe2de082836 100644
--- a/packages/SystemUI/res/values-zh-rHK/strings.xml
+++ b/packages/SystemUI/res/values-zh-rHK/strings.xml
@@ -524,7 +524,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">" <xliff:g id="TILE_LABEL">%1$s</xliff:g>"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">""</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">""</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-zh-rTW/strings.xml b/packages/SystemUI/res/values-zh-rTW/strings.xml
index 113054bc244..77c34aec312 100644
--- a/packages/SystemUI/res/values-zh-rTW/strings.xml
+++ b/packages/SystemUI/res/values-zh-rTW/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"<xliff:g id="TILE_LABEL">%1$s</xliff:g>"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">""</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">""</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">""</string>
     <string name="stream_voice_call" msgid="4410002696470423714">""</string>
     <string name="stream_system" msgid="7493299064422163147">""</string>
     <string name="stream_ring" msgid="8213049469184048338">""</string>
diff --git a/packages/SystemUI/res/values-zu/strings.xml b/packages/SystemUI/res/values-zu/strings.xml
index 871a2501c3e..cd56b096d78 100644
--- a/packages/SystemUI/res/values-zu/strings.xml
+++ b/packages/SystemUI/res/values-zu/strings.xml
@@ -522,7 +522,6 @@
     <string name="quick_settings_reset_confirmation_title" msgid="748792586749897883">"Fihla i-<xliff:g id="TILE_LABEL">%1$s</xliff:g>?"</string>
     <string name="quick_settings_reset_confirmation_message" msgid="2235970126803317374">"Izovela ngesikhathi esilandelayo uma uvule lesi silungiselelo."</string>
     <string name="quick_settings_reset_confirmation_button" msgid="2660339101868367515">"Fihla"</string>
-    <string name="managed_profile_foreground_toast" msgid="5421487114739245972">"Usebenzisa iphrofayela yakho yomsebenzi"</string>
     <string name="stream_voice_call" msgid="4410002696470423714">"Shaya"</string>
     <string name="stream_system" msgid="7493299064422163147">"Isistimu"</string>
     <string name="stream_ring" msgid="8213049469184048338">"Khalisa"</string>
diff --git a/packages/SystemUI/res/values/colors.xml b/packages/SystemUI/res/values/colors.xml
index 975055ce72e..07f1ee08418 100644
--- a/packages/SystemUI/res/values/colors.xml
+++ b/packages/SystemUI/res/values/colors.xml
@@ -137,8 +137,10 @@
 
     <color name="remote_input_accent">#eeeeee</color>
 
-    <color name="quick_step_track_background_dark">#61000000</color>
-    <color name="quick_step_track_background_light">#33FFFFFF</color>
+    <color name="quick_step_track_background_background_dark">#1F000000</color>
+    <color name="quick_step_track_background_background_light">#33FFFFFF</color>
+    <color name="quick_step_track_background_foreground_dark">#38000000</color>
+    <color name="quick_step_track_background_foreground_light">#59FFFFFF</color>
 
     <!-- Keyboard shortcuts colors -->
     <color name="ksh_application_group_color">#fff44336</color>
diff --git a/packages/SystemUI/res/values/dimens.xml b/packages/SystemUI/res/values/dimens.xml
index 5ef19d0c4f4..23f8a53ffa2 100644
--- a/packages/SystemUI/res/values/dimens.xml
+++ b/packages/SystemUI/res/values/dimens.xml
@@ -252,6 +252,9 @@
          -->
     <dimen name="qs_header_system_icons_area_height">48dp</dimen>
 
+    <!-- How far the quick-quick settings panel extends below the status bar -->
+    <dimen name="qs_quick_header_panel_height">128dp</dimen>
+
     <!-- The height of the container that holds the system icons in the quick settings header in the
          car setting. -->
     <dimen name="car_qs_header_system_icons_area_height">54dp</dimen>
@@ -764,9 +767,6 @@
     <dimen name="volume_expander_margin_end">2dp</dimen>
     <dimen name="volume_expander_margin_top">6dp</dimen>
 
-    <!-- Padding between icon and text for managed profile toast -->
-    <dimen name="managed_profile_toast_padding">4dp</dimen>
-
     <!-- Thickness of the assist disclosure beams -->
     <dimen name="assist_disclosure_thickness">2.5dp</dimen>
 
@@ -922,22 +922,26 @@
 
     <dimen name="global_actions_top_padding">120dp</dimen>
 
-    <!-- the maximum offset in either direction that elements are moved horizontally to prevent
-            burn-in on AOD -->
+    <!-- The maximum offset in either direction that elements are moved horizontally to prevent
+         burn-in on AOD. -->
     <dimen name="burn_in_prevention_offset_x">8dp</dimen>
 
-    <!-- the maximum offset in either direction that elements are moved vertically to prevent
-            burn-in on AOD -->
+    <!-- The maximum offset in either direction that elements are moved vertically to prevent
+         burn-in on AOD. -->
     <dimen name="burn_in_prevention_offset_y">50dp</dimen>
 
+    <!-- The maximum offset in either direction that the charging indication moves vertically
+         to prevent burn-in on AOD. -->
+    <dimen name="charging_indication_burn_in_prevention_offset_y">5dp</dimen>
+
     <dimen name="corner_size">8dp</dimen>
     <dimen name="top_padding">0dp</dimen>
     <dimen name="bottom_padding">48dp</dimen>
     <dimen name="edge_margin">8dp</dimen>
 
-    <dimen name="rounded_corner_radius">0dp</dimen>
-    <dimen name="rounded_corner_radius_top">0dp</dimen>
-    <dimen name="rounded_corner_radius_bottom">0dp</dimen>
+    <dimen name="rounded_corner_radius">@*android:dimen/rounded_corner_radius</dimen>
+    <dimen name="rounded_corner_radius_top">@*android:dimen/rounded_corner_radius_top</dimen>
+    <dimen name="rounded_corner_radius_bottom">@*android:dimen/rounded_corner_radius_bottom</dimen>
     <dimen name="rounded_corner_content_padding">0dp</dimen>
     <dimen name="nav_content_padding">0dp</dimen>
     <dimen name="nav_quick_scrub_track_edge_padding">24dp</dimen>
@@ -1014,4 +1018,8 @@
 
     <dimen name="navbar_single_hand_mode_horizontal_threshhold">90dp</dimen>
     <dimen name="navbar_single_hand_mode_vertical_threshhold">48dp</dimen>
+
+    <!-- How much we expand the touchable region of the status bar below the notch to catch touches
+         that just start below the notch. -->
+    <dimen name="display_cutout_touchable_region_size">12dp</dimen>
 </resources>
diff --git a/packages/SystemUI/res/values/strings.xml b/packages/SystemUI/res/values/strings.xml
index edf56afad71..18f378e5919 100644
--- a/packages/SystemUI/res/values/strings.xml
+++ b/packages/SystemUI/res/values/strings.xml
@@ -1326,9 +1326,6 @@
     <!-- Hide quick settings tile confirmation button -->
     <string name="quick_settings_reset_confirmation_button">Hide</string>
 
-    <!-- Toast shown when user unlocks screen and managed profile activity is in the foreground -->
-    <string name="managed_profile_foreground_toast">You\'re using your work profile</string>
-
     <!-- volume stream names. All nouns. -->
     <string name="stream_voice_call">Call</string> <!-- STREAM_VOICE_CALL -->
     <string name="stream_system">System</string> <!-- STREAM_SYSTEM -->
diff --git a/packages/SystemUI/shared/src/com/android/systemui/shared/system/NavigationBarCompat.java b/packages/SystemUI/shared/src/com/android/systemui/shared/system/NavigationBarCompat.java
index cd831d1e31f..d38cc0f608c 100644
--- a/packages/SystemUI/shared/src/com/android/systemui/shared/system/NavigationBarCompat.java
+++ b/packages/SystemUI/shared/src/com/android/systemui/shared/system/NavigationBarCompat.java
@@ -54,6 +54,7 @@ public class NavigationBarCompat {
     public static final int HIT_TARGET_HOME = 2;
     public static final int HIT_TARGET_OVERVIEW = 3;
     public static final int HIT_TARGET_ROTATION = 4;
+    public static final int HIT_TARGET_DEAD_ZONE = 5;
 
     @Retention(RetentionPolicy.SOURCE)
     @IntDef({FLAG_DISABLE_SWIPE_UP,
diff --git a/packages/SystemUI/src/com/android/keyguard/KeyguardSecurityContainer.java b/packages/SystemUI/src/com/android/keyguard/KeyguardSecurityContainer.java
index cb5a0507815..ff383ddcec3 100644
--- a/packages/SystemUI/src/com/android/keyguard/KeyguardSecurityContainer.java
+++ b/packages/SystemUI/src/com/android/keyguard/KeyguardSecurityContainer.java
@@ -15,7 +15,6 @@
  */
 package com.android.keyguard;
 
-import android.R.style;
 import android.app.Activity;
 import android.app.AlertDialog;
 import android.app.admin.DevicePolicyManager;
@@ -26,7 +25,6 @@ import android.util.AttributeSet;
 import android.util.Log;
 import android.util.Slog;
 import android.util.StatsLog;
-import android.view.ContextThemeWrapper;
 import android.view.LayoutInflater;
 import android.view.View;
 import android.view.WindowManager;
@@ -142,6 +140,7 @@ public class KeyguardSecurityContainer extends FrameLayout implements KeyguardSe
             mSecurityViewFlipper.addView(v);
             updateSecurityView(v);
             view = (KeyguardSecurityView)v;
+            view.reset();
         }
 
         return view;
@@ -209,7 +208,7 @@ public class KeyguardSecurityContainer extends FrameLayout implements KeyguardSe
 
         if (messageId != 0) {
             final String message = mContext.getString(messageId,
-                    KeyguardUpdateMonitor.getInstance(mContext).getFailedUnlockAttempts(userId),
+                    mLockPatternUtils.getCurrentFailedPasswordAttempts(userId),
                     timeoutInSeconds);
             showDialog(null, message);
         }
@@ -254,8 +253,8 @@ public class KeyguardSecurityContainer extends FrameLayout implements KeyguardSe
     }
 
     private void reportFailedUnlockAttempt(int userId, int timeoutMs) {
-        final KeyguardUpdateMonitor monitor = KeyguardUpdateMonitor.getInstance(mContext);
-        final int failedAttempts = monitor.getFailedUnlockAttempts(userId) + 1; // +1 for this time
+        // +1 for this time
+        final int failedAttempts = mLockPatternUtils.getCurrentFailedPasswordAttempts(userId) + 1;
 
         if (DEBUG) Log.d(TAG, "reportFailedPatternAttempt: #" + failedAttempts);
 
@@ -289,7 +288,6 @@ public class KeyguardSecurityContainer extends FrameLayout implements KeyguardSe
                 showWipeDialog(failedAttempts, userType);
             }
         }
-        monitor.reportFailedStrongAuthUnlockAttempt(userId);
         mLockPatternUtils.reportFailedPasswordAttempt(userId);
         if (timeoutMs > 0) {
             mLockPatternUtils.reportPasswordLockout(timeoutMs, userId);
@@ -433,7 +431,6 @@ public class KeyguardSecurityContainer extends FrameLayout implements KeyguardSe
             if (success) {
                 StatsLog.write(StatsLog.KEYGUARD_BOUNCER_PASSWORD_ENTERED,
                     StatsLog.KEYGUARD_BOUNCER_PASSWORD_ENTERED__RESULT__SUCCESS);
-                monitor.clearFailedUnlockAttempts();
                 mLockPatternUtils.reportSuccessfulPasswordAttempt(userId);
             } else {
                 StatsLog.write(StatsLog.KEYGUARD_BOUNCER_PASSWORD_ENTERED,
diff --git a/packages/SystemUI/src/com/android/keyguard/KeyguardStatusView.java b/packages/SystemUI/src/com/android/keyguard/KeyguardStatusView.java
index 41df196c62b..40149464dff 100644
--- a/packages/SystemUI/src/com/android/keyguard/KeyguardStatusView.java
+++ b/packages/SystemUI/src/com/android/keyguard/KeyguardStatusView.java
@@ -73,6 +73,7 @@ public class KeyguardStatusView extends GridLayout implements
 
     private ArraySet<View> mVisibleInDoze;
     private boolean mPulsing;
+    private boolean mWasPulsing;
     private float mDarkAmount = 0;
     private int mTextColor;
     private float mWidgetPadding;
@@ -198,6 +199,9 @@ public class KeyguardStatusView extends GridLayout implements
         mClockView.setElegantTextHeight(false);
     }
 
+    /**
+     * Moves clock and separator, adjusting margins when slice content changes.
+     */
     private void onSliceContentChanged() {
         boolean smallClock = mKeyguardSlice.hasHeader() || mPulsing;
         float clockScale = smallClock ? mSmallClockScale : 1;
@@ -220,11 +224,12 @@ public class KeyguardStatusView extends GridLayout implements
     @Override
     public void onLayoutChange(View view, int left, int top, int right, int bottom,
             int oldLeft, int oldTop, int oldRight, int oldBottom) {
-        int heightOffset = mPulsing ? 0 : getHeight() - mLastLayoutHeight;
+        int heightOffset = mPulsing || mWasPulsing ? 0 : getHeight() - mLastLayoutHeight;
         boolean hasHeader = mKeyguardSlice.hasHeader();
         boolean smallClock = hasHeader || mPulsing;
         long duration = KeyguardSliceView.DEFAULT_ANIM_DURATION;
-        long delay = smallClock ? 0 : duration / 4;
+        long delay = smallClock || mWasPulsing ? 0 : duration / 4;
+        mWasPulsing = false;
 
         boolean shouldAnimate = mKeyguardSlice.getLayoutTransition() != null
                 && mKeyguardSlice.getLayoutTransition().isRunning();
@@ -448,7 +453,18 @@ public class KeyguardStatusView extends GridLayout implements
     }
 
     public void setPulsing(boolean pulsing, boolean animate) {
+        if (mPulsing == pulsing) {
+            return;
+        }
+        if (mPulsing) {
+            mWasPulsing = true;
+        }
         mPulsing = pulsing;
+        // Animation can look really weird when the slice has a header, let's hide the views
+        // immediately instead of fading them away.
+        if (mKeyguardSlice.hasHeader()) {
+            animate = false;
+        }
         mKeyguardSlice.setPulsing(pulsing, animate);
         updateDozeVisibleViews();
     }
diff --git a/packages/SystemUI/src/com/android/keyguard/KeyguardUpdateMonitor.java b/packages/SystemUI/src/com/android/keyguard/KeyguardUpdateMonitor.java
index dd5156a18dc..22397817735 100644
--- a/packages/SystemUI/src/com/android/keyguard/KeyguardUpdateMonitor.java
+++ b/packages/SystemUI/src/com/android/keyguard/KeyguardUpdateMonitor.java
@@ -214,9 +214,6 @@ public class KeyguardUpdateMonitor implements TrustManager.TrustListener,
     // Battery status
     private BatteryStatus mBatteryStatus;
 
-    // Password attempts
-    private SparseIntArray mFailedAttempts = new SparseIntArray();
-
     private final StrongAuthTracker mStrongAuthTracker;
 
     private final ArrayList<WeakReference<KeyguardUpdateMonitorCallback>>
@@ -1612,6 +1609,10 @@ public class KeyguardUpdateMonitor implements TrustManager.TrustListener,
         }
     }
 
+    public boolean isKeyguardVisible() {
+        return mKeyguardIsVisible;
+    }
+
     /**
      * Notifies that the visibility state of Keyguard has changed.
      *
@@ -1819,22 +1820,10 @@ public class KeyguardUpdateMonitor implements TrustManager.TrustListener,
         return mDeviceProvisioned;
     }
 
-    public void clearFailedUnlockAttempts() {
-        mFailedAttempts.delete(sCurrentUser);
-    }
-
     public ServiceState getServiceState(int subId) {
         return mServiceStates.get(subId);
     }
 
-    public int getFailedUnlockAttempts(int userId) {
-        return mFailedAttempts.get(userId, 0);
-    }
-
-    public void reportFailedStrongAuthUnlockAttempt(int userId) {
-        mFailedAttempts.put(userId, getFailedUnlockAttempts(userId) + 1);
-    }
-
     public void clearFingerprintRecognized() {
         mUserFingerprintAuthenticated.clear();
         mTrustManager.clearAllFingerprints();
diff --git a/packages/SystemUI/src/com/android/systemui/BatteryMeterView.java b/packages/SystemUI/src/com/android/systemui/BatteryMeterView.java
index 93f5919ac5d..c877b5982e5 100644
--- a/packages/SystemUI/src/com/android/systemui/BatteryMeterView.java
+++ b/packages/SystemUI/src/com/android/systemui/BatteryMeterView.java
@@ -54,6 +54,7 @@ import com.android.systemui.statusbar.policy.IconLogger;
 import com.android.systemui.tuner.TunerService;
 import com.android.systemui.tuner.TunerService.Tunable;
 import com.android.systemui.util.Utils.DisableStateTracker;
+import com.android.systemui.R;
 
 import static lineageos.providers.LineageSettings.System.STATUS_BAR_SHOW_BATTERY_PERCENT;
 
@@ -85,6 +86,7 @@ public class BatteryMeterView extends LinearLayout implements
     private int mTextColor;
     private int mLevel;
     private boolean mForceShowPercent;
+    private boolean mShowPercentAvailable;
 
     private int mDarkModeBackgroundColor;
     private int mDarkModeFillColor;
@@ -125,6 +127,9 @@ public class BatteryMeterView extends LinearLayout implements
         atts.recycle();
 
         mSettingObserver = new SettingObserver(new Handler(context.getMainLooper()));
+        mShowPercentAvailable = context.getResources().getBoolean(
+                com.android.internal.R.bool.config_battery_percentage_setting_available);
+
 
         addOnAttachStateChangeListener(
                 new DisableStateTracker(DISABLE_NONE, DISABLE2_SYSTEM_ICONS));
@@ -309,8 +314,8 @@ public class BatteryMeterView extends LinearLayout implements
                 LineageSettings.System.getIntForUser(getContext().getContentResolver(),
                         STATUS_BAR_SHOW_BATTERY_PERCENT, 0, mUser) == 1;
         if ((LineageSettings.System.getIntForUser(getContext().getContentResolver(),
-                STATUS_BAR_SHOW_BATTERY_PERCENT, 0, mUser) == 2 || mForceShowPercent) &&
-                        (!drawPercent || mCharging) || mShowPercent) {
+                STATUS_BAR_SHOW_BATTERY_PERCENT, 0, mUser) == 2 || mForceShowPercent)
+               &&  (!drawPercent || mCharging) || mShowPercent) {
             mDrawable.setShowPercent(false);
             if (!showing) {
                 mBatteryPercentView = loadPercentView();
diff --git a/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java b/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java
index b8a57bfe885..50d862dee29 100644
--- a/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java
+++ b/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java
@@ -290,7 +290,7 @@ public class ImageWallpaper extends WallpaperService {
                         || dh != mLastSurfaceHeight;
 
                 boolean redrawNeeded = surfaceDimensionsChanged || newRotation != mLastRotation
-                        || mSurfaceRedrawNeeded;
+                        || mSurfaceRedrawNeeded || mNeedsDrawAfterLoadingWallpaper;
                 if (!redrawNeeded && !mOffsetsChanged) {
                     if (DEBUG) {
                         Log.d(TAG, "Suppressed drawFrame since redraw is not needed "
diff --git a/packages/SystemUI/src/com/android/systemui/Interpolators.java b/packages/SystemUI/src/com/android/systemui/Interpolators.java
index aeef4968951..eb704c863eb 100644
--- a/packages/SystemUI/src/com/android/systemui/Interpolators.java
+++ b/packages/SystemUI/src/com/android/systemui/Interpolators.java
@@ -31,6 +31,13 @@ import com.android.systemui.statusbar.stack.HeadsUpAppearInterpolator;
  */
 public class Interpolators {
     public static final Interpolator FAST_OUT_SLOW_IN = new PathInterpolator(0.4f, 0f, 0.2f, 1f);
+
+    /**
+     * Like {@link #FAST_OUT_SLOW_IN}, but used in case the animation is played in reverse (i.e. t
+     * goes from 1 to 0 instead of 0 to 1).
+     */
+    public static final Interpolator FAST_OUT_SLOW_IN_REVERSE =
+            new PathInterpolator(0.8f, 0f, 0.6f, 1f);
     public static final Interpolator FAST_OUT_LINEAR_IN = new PathInterpolator(0.4f, 0f, 1f, 1f);
     public static final Interpolator LINEAR_OUT_SLOW_IN = new PathInterpolator(0f, 0f, 0.2f, 1f);
     public static final Interpolator ALPHA_IN = new PathInterpolator(0.4f, 0f, 1f, 1f);
@@ -51,4 +58,11 @@ public class Interpolators {
      */
     public static final Interpolator TOUCH_RESPONSE =
             new PathInterpolator(0.3f, 0f, 0.1f, 1f);
+
+    /**
+     * Like {@link #TOUCH_RESPONSE}, but used in case the animation is played in reverse (i.e. t
+     * goes from 1 to 0 instead of 0 to 1).
+     */
+    public static final Interpolator TOUCH_RESPONSE_REVERSE =
+            new PathInterpolator(0.9f, 0f, 0.7f, 1f);
 }
diff --git a/packages/SystemUI/src/com/android/systemui/ScreenDecorations.java b/packages/SystemUI/src/com/android/systemui/ScreenDecorations.java
index efaf557660d..9ced14d16ae 100644
--- a/packages/SystemUI/src/com/android/systemui/ScreenDecorations.java
+++ b/packages/SystemUI/src/com/android/systemui/ScreenDecorations.java
@@ -39,10 +39,13 @@ import android.graphics.PixelFormat;
 import android.graphics.Rect;
 import android.graphics.Region;
 import android.hardware.display.DisplayManager;
+import android.os.Handler;
+import android.os.HandlerThread;
 import android.os.SystemProperties;
 import android.provider.Settings.Secure;
 import android.support.annotation.VisibleForTesting;
 import android.util.DisplayMetrics;
+import android.util.Log;
 import android.view.DisplayCutout;
 import android.view.DisplayInfo;
 import android.view.Gravity;
@@ -52,10 +55,12 @@ import android.view.View;
 import android.view.View.OnLayoutChangeListener;
 import android.view.ViewGroup;
 import android.view.ViewGroup.LayoutParams;
+import android.view.ViewTreeObserver;
 import android.view.WindowManager;
 import android.widget.FrameLayout;
 import android.widget.ImageView;
 
+import com.android.internal.util.Preconditions;
 import com.android.systemui.RegionInterceptingFrameLayout.RegionInterceptableView;
 import com.android.systemui.fragments.FragmentHostManager;
 import com.android.systemui.fragments.FragmentHostManager.FragmentListener;
@@ -73,6 +78,9 @@ import com.android.systemui.util.leak.RotationUtils;
  * for antialiasing and emulation purposes.
  */
 public class ScreenDecorations extends SystemUI implements Tunable {
+    private static final boolean DEBUG = false;
+    private static final String TAG = "ScreenDecorations";
+
     public static final String SIZE = "sysui_rounded_size";
     public static final String PADDING = "sysui_rounded_content_padding";
     private static final boolean DEBUG_SCREENSHOT_ROUNDED_CORNERS =
@@ -81,34 +89,41 @@ public class ScreenDecorations extends SystemUI implements Tunable {
     private DisplayManager mDisplayManager;
     private DisplayManager.DisplayListener mDisplayListener;
 
-    private int mRoundedDefault;
-    private int mRoundedDefaultTop;
-    private int mRoundedDefaultBottom;
+    @VisibleForTesting protected int mRoundedDefault;
+    @VisibleForTesting protected int mRoundedDefaultTop;
+    @VisibleForTesting protected int mRoundedDefaultBottom;
     private View mOverlay;
     private View mBottomOverlay;
     private float mDensity;
     private WindowManager mWindowManager;
     private int mRotation;
+    private DisplayCutoutView mCutoutTop;
+    private DisplayCutoutView mCutoutBottom;
+    private boolean mPendingRotationChange;
+    private Handler mHandler;
 
     @Override
     public void start() {
+        mHandler = startHandlerThread();
+        mHandler.post(this::startOnScreenDecorationsThread);
+        setupStatusBarPaddingIfNeeded();
+    }
+
+    @VisibleForTesting
+    Handler startHandlerThread() {
+        HandlerThread thread = new HandlerThread("ScreenDecorations");
+        thread.start();
+        return thread.getThreadHandler();
+    }
+
+    private void startOnScreenDecorationsThread() {
+        mRotation = RotationUtils.getExactRotation(mContext);
         mWindowManager = mContext.getSystemService(WindowManager.class);
-        mRoundedDefault = mContext.getResources().getDimensionPixelSize(
-                R.dimen.rounded_corner_radius);
-        mRoundedDefaultTop = mContext.getResources().getDimensionPixelSize(
-                R.dimen.rounded_corner_radius_top);
-        mRoundedDefaultBottom = mContext.getResources().getDimensionPixelSize(
-                R.dimen.rounded_corner_radius_bottom);
+        updateRoundedCornerRadii();
         if (hasRoundedCorners() || shouldDrawCutout()) {
             setupDecorations();
         }
 
-        int padding = mContext.getResources().getDimensionPixelSize(
-                R.dimen.rounded_corner_content_padding);
-        if (padding != 0) {
-            setupPadding(padding);
-        }
-
         mDisplayListener = new DisplayManager.DisplayListener() {
             @Override
             public void onDisplayAdded(int displayId) {
@@ -122,27 +137,47 @@ public class ScreenDecorations extends SystemUI implements Tunable {
 
             @Override
             public void onDisplayChanged(int displayId) {
+                final int newRotation = RotationUtils.getExactRotation(mContext);
+                if (mOverlay != null && mBottomOverlay != null && mRotation != newRotation) {
+                    // We cannot immediately update the orientation. Otherwise
+                    // WindowManager is still deferring layout until it has finished dispatching
+                    // the config changes, which may cause divergence between what we draw
+                    // (new orientation), and where we are placed on the screen (old orientation).
+                    // Instead we wait until either:
+                    // - we are trying to redraw. This because WM resized our window and told us to.
+                    // - the config change has been dispatched, so WM is no longer deferring layout.
+                    mPendingRotationChange = true;
+                    if (DEBUG) {
+                        Log.i(TAG, "Rotation changed, deferring " + newRotation + ", staying at "
+                                + mRotation);
+                    }
+
+                    mOverlay.getViewTreeObserver().addOnPreDrawListener(
+                            new RestartingPreDrawListener(mOverlay, newRotation));
+                    mBottomOverlay.getViewTreeObserver().addOnPreDrawListener(
+                            new RestartingPreDrawListener(mBottomOverlay, newRotation));
+                }
                 updateOrientation();
             }
         };
 
-        mRotation = -1;
         mDisplayManager = (DisplayManager) mContext.getSystemService(
                 Context.DISPLAY_SERVICE);
-        mDisplayManager.registerDisplayListener(mDisplayListener, null);
+        mDisplayManager.registerDisplayListener(mDisplayListener, mHandler);
+        updateOrientation();
     }
 
     private void setupDecorations() {
         mOverlay = LayoutInflater.from(mContext)
                 .inflate(R.layout.rounded_corners, null);
-        DisplayCutoutView cutoutTop = new DisplayCutoutView(mContext, true,
-                this::updateWindowVisibilities);
-        ((ViewGroup)mOverlay).addView(cutoutTop);
+        mCutoutTop = new DisplayCutoutView(mContext, true,
+                this::updateWindowVisibilities, this);
+        ((ViewGroup)mOverlay).addView(mCutoutTop);
         mBottomOverlay = LayoutInflater.from(mContext)
                 .inflate(R.layout.rounded_corners, null);
-        DisplayCutoutView cutoutBottom = new DisplayCutoutView(mContext, false,
-                this::updateWindowVisibilities);
-        ((ViewGroup)mBottomOverlay).addView(cutoutBottom);
+        mCutoutBottom = new DisplayCutoutView(mContext, false,
+                this::updateWindowVisibilities, this);
+        ((ViewGroup)mBottomOverlay).addView(mCutoutBottom);
 
         mOverlay.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE);
         mOverlay.setAlpha(0);
@@ -159,10 +194,11 @@ public class ScreenDecorations extends SystemUI implements Tunable {
         mWindowManager.getDefaultDisplay().getMetrics(metrics);
         mDensity = metrics.density;
 
-        Dependency.get(TunerService.class).addTunable(this, SIZE);
+        Dependency.get(Dependency.MAIN_HANDLER).post(
+                () -> Dependency.get(TunerService.class).addTunable(this, SIZE));
 
         // Watch color inversion and invert the overlay as needed.
-        SecureSetting setting = new SecureSetting(mContext, Dependency.get(Dependency.MAIN_HANDLER),
+        SecureSetting setting = new SecureSetting(mContext, mHandler,
                 Secure.ACCESSIBILITY_DISPLAY_INVERSION_ENABLED) {
             @Override
             protected void handleValueChanged(int value, boolean observedChange) {
@@ -172,8 +208,8 @@ public class ScreenDecorations extends SystemUI implements Tunable {
                 ((ImageView) mOverlay.findViewById(R.id.right)).setImageTintList(tintList);
                 ((ImageView) mBottomOverlay.findViewById(R.id.left)).setImageTintList(tintList);
                 ((ImageView) mBottomOverlay.findViewById(R.id.right)).setImageTintList(tintList);
-                cutoutTop.setColor(tint);
-                cutoutBottom.setColor(tint);
+                mCutoutTop.setColor(tint);
+                mCutoutBottom.setColor(tint);
             }
         };
         setting.setListening(true);
@@ -195,17 +231,41 @@ public class ScreenDecorations extends SystemUI implements Tunable {
                         .start();
             }
         });
+
+        mOverlay.getViewTreeObserver().addOnPreDrawListener(
+                new ValidatingPreDrawListener(mOverlay));
+        mBottomOverlay.getViewTreeObserver().addOnPreDrawListener(
+                new ValidatingPreDrawListener(mBottomOverlay));
     }
 
     @Override
     protected void onConfigurationChanged(Configuration newConfig) {
-        updateOrientation();
-        if (shouldDrawCutout() && mOverlay == null) {
-            setupDecorations();
-        }
+        mHandler.post(() -> {
+            int oldRotation = mRotation;
+            mPendingRotationChange = false;
+            updateOrientation();
+            updateRoundedCornerRadii();
+            if (DEBUG) Log.i(TAG, "onConfigChanged from rot " + oldRotation + " to " + mRotation);
+            if (shouldDrawCutout() && mOverlay == null) {
+                setupDecorations();
+            }
+            if (mOverlay != null) {
+                // Updating the layout params ensures that ViewRootImpl will call relayoutWindow(),
+                // which ensures that the forced seamless rotation will end, even if we updated
+                // the rotation before window manager was ready (and was still waiting for sending
+                // the updated rotation).
+                updateLayoutParams();
+            }
+        });
     }
 
-    protected void updateOrientation() {
+    private void updateOrientation() {
+        Preconditions.checkState(mHandler.getLooper().getThread() == Thread.currentThread(),
+                "must call on " + mHandler.getLooper().getThread()
+                        + ", but was " + Thread.currentThread());
+        if (mPendingRotationChange) {
+            return;
+        }
         int newRotation = RotationUtils.getExactRotation(mContext);
         if (newRotation != mRotation) {
             mRotation = newRotation;
@@ -217,6 +277,26 @@ public class ScreenDecorations extends SystemUI implements Tunable {
         }
     }
 
+    private void updateRoundedCornerRadii() {
+        final int newRoundedDefault = mContext.getResources().getDimensionPixelSize(
+                R.dimen.rounded_corner_radius);
+        final int newRoundedDefaultTop = mContext.getResources().getDimensionPixelSize(
+                R.dimen.rounded_corner_radius_top);
+        final int newRoundedDefaultBottom = mContext.getResources().getDimensionPixelSize(
+                R.dimen.rounded_corner_radius_bottom);
+
+        final boolean roundedCornersChanged = mRoundedDefault != newRoundedDefault
+                || mRoundedDefaultBottom != newRoundedDefaultBottom
+                || mRoundedDefaultTop != newRoundedDefaultTop;
+
+        if (roundedCornersChanged) {
+            mRoundedDefault = newRoundedDefault;
+            mRoundedDefaultTop = newRoundedDefaultTop;
+            mRoundedDefaultBottom = newRoundedDefaultBottom;
+            onTuningChanged(SIZE, null);
+        }
+    }
+
     private void updateViews() {
         View topLeft = mOverlay.findViewById(R.id.left);
         View topRight = mOverlay.findViewById(R.id.right);
@@ -245,6 +325,9 @@ public class ScreenDecorations extends SystemUI implements Tunable {
             updateView(bottomRight, Gravity.TOP | Gravity.LEFT, 0);
         }
 
+        mCutoutTop.setRotation(mRotation);
+        mCutoutBottom.setRotation(mRotation);
+
         updateWindowVisibilities();
     }
 
@@ -279,7 +362,19 @@ public class ScreenDecorations extends SystemUI implements Tunable {
                 com.android.internal.R.bool.config_fillMainBuiltInDisplayCutout);
     }
 
-    private void setupPadding(int padding) {
+
+    private void setupStatusBarPaddingIfNeeded() {
+        // TODO: This should be moved to a more appropriate place, as it is not related to the
+        // screen decorations overlay.
+        int padding = mContext.getResources().getDimensionPixelSize(
+                R.dimen.rounded_corner_content_padding);
+        if (padding != 0) {
+            setupStatusBarPadding(padding);
+        }
+
+    }
+
+    private void setupStatusBarPadding(int padding) {
         // Add some padding to all the content near the edge of the screen.
         StatusBar sb = getComponent(StatusBar.class);
         View statusBar = (sb != null ? sb.getStatusBarWindow() : null);
@@ -348,30 +443,32 @@ public class ScreenDecorations extends SystemUI implements Tunable {
 
     @Override
     public void onTuningChanged(String key, String newValue) {
-        if (mOverlay == null) return;
-        if (SIZE.equals(key)) {
-            int size = mRoundedDefault;
-            int sizeTop = mRoundedDefaultTop;
-            int sizeBottom = mRoundedDefaultBottom;
-            if (newValue != null) {
-                try {
-                    size = (int) (Integer.parseInt(newValue) * mDensity);
-                } catch (Exception e) {
+        mHandler.post(() -> {
+            if (mOverlay == null) return;
+            if (SIZE.equals(key)) {
+                int size = mRoundedDefault;
+                int sizeTop = mRoundedDefaultTop;
+                int sizeBottom = mRoundedDefaultBottom;
+                if (newValue != null) {
+                    try {
+                        size = (int) (Integer.parseInt(newValue) * mDensity);
+                    } catch (Exception e) {
+                    }
                 }
-            }
 
-            if (sizeTop == 0) {
-                sizeTop = size;
-            }
-            if (sizeBottom == 0) {
-                sizeBottom = size;
-            }
+                if (sizeTop == 0) {
+                    sizeTop = size;
+                }
+                if (sizeBottom == 0) {
+                    sizeBottom = size;
+                }
 
-            setSize(mOverlay.findViewById(R.id.left), sizeTop);
-            setSize(mOverlay.findViewById(R.id.right), sizeTop);
-            setSize(mBottomOverlay.findViewById(R.id.left), sizeBottom);
-            setSize(mBottomOverlay.findViewById(R.id.right), sizeBottom);
-        }
+                setSize(mOverlay.findViewById(R.id.left), sizeTop);
+                setSize(mOverlay.findViewById(R.id.right), sizeTop);
+                setSize(mBottomOverlay.findViewById(R.id.left), sizeBottom);
+                setSize(mBottomOverlay.findViewById(R.id.right), sizeBottom);
+            }
+        });
     }
 
     private void setSize(View view, int pixelSize) {
@@ -416,16 +513,25 @@ public class ScreenDecorations extends SystemUI implements Tunable {
         private final Rect mBoundingRect = new Rect();
         private final Path mBoundingPath = new Path();
         private final int[] mLocation = new int[2];
-        private final boolean mStart;
+        private final boolean mInitialStart;
         private final Runnable mVisibilityChangedListener;
+        private final ScreenDecorations mDecorations;
         private int mColor = Color.BLACK;
+        private boolean mStart;
+        private int mRotation;
 
         public DisplayCutoutView(Context context, boolean start,
-                Runnable visibilityChangedListener) {
+                Runnable visibilityChangedListener, ScreenDecorations decorations) {
             super(context);
-            mStart = start;
+            mInitialStart = start;
             mVisibilityChangedListener = visibilityChangedListener;
+            mDecorations = decorations;
             setId(R.id.display_cutout);
+            if (DEBUG) {
+                getViewTreeObserver().addOnDrawListener(() -> Log.i(TAG,
+                        (mInitialStart ? "OverlayTop" : "OverlayBottom")
+                                + " drawn in rot " + mRotation));
+            }
         }
 
         public void setColor(int color) {
@@ -475,7 +581,22 @@ public class ScreenDecorations extends SystemUI implements Tunable {
             }
         }
 
+        public void setRotation(int rotation) {
+            mRotation = rotation;
+            update();
+        }
+
+        private boolean isStart() {
+            final boolean flipped = (mRotation == RotationUtils.ROTATION_SEASCAPE
+                    || mRotation == RotationUtils.ROTATION_UPSIDE_DOWN);
+            return flipped ? !mInitialStart : mInitialStart;
+        }
+
         private void update() {
+            if (!isAttachedToWindow() || mDecorations.mPendingRotationChange) {
+                return;
+            }
+            mStart = isStart();
             requestLayout();
             getDisplay().getDisplayInfo(mInfo);
             mBounds.setEmpty();
@@ -560,31 +681,34 @@ public class ScreenDecorations extends SystemUI implements Tunable {
                     resolveSizeAndState(mBoundingRect.height(), heightMeasureSpec, 0));
         }
 
-        public static void boundsFromDirection(DisplayCutout displayCutout, int gravity, Rect out) {
+        public static void boundsFromDirection(DisplayCutout displayCutout, int gravity,
+                Rect out) {
+            Region bounds = boundsFromDirection(displayCutout, gravity);
+            out.set(bounds.getBounds());
+            bounds.recycle();
+        }
+
+        public static Region boundsFromDirection(DisplayCutout displayCutout, int gravity) {
             Region bounds = displayCutout.getBounds();
             switch (gravity) {
                 case Gravity.TOP:
                     bounds.op(0, 0, Integer.MAX_VALUE, displayCutout.getSafeInsetTop(),
                             Region.Op.INTERSECT);
-                    out.set(bounds.getBounds());
                     break;
                 case Gravity.LEFT:
                     bounds.op(0, 0, displayCutout.getSafeInsetLeft(), Integer.MAX_VALUE,
                             Region.Op.INTERSECT);
-                    out.set(bounds.getBounds());
                     break;
                 case Gravity.BOTTOM:
                     bounds.op(0, displayCutout.getSafeInsetTop() + 1, Integer.MAX_VALUE,
                             Integer.MAX_VALUE, Region.Op.INTERSECT);
-                    out.set(bounds.getBounds());
                     break;
                 case Gravity.RIGHT:
                     bounds.op(displayCutout.getSafeInsetLeft() + 1, 0, Integer.MAX_VALUE,
                             Integer.MAX_VALUE, Region.Op.INTERSECT);
-                    out.set(bounds.getBounds());
                     break;
             }
-            bounds.recycle();
+            return bounds;
         }
 
         private void localBounds(Rect out) {
@@ -635,4 +759,74 @@ public class ScreenDecorations extends SystemUI implements Tunable {
         return rotation == RotationUtils.ROTATION_LANDSCAPE || rotation ==
                 RotationUtils.ROTATION_SEASCAPE;
     }
+
+    /**
+     * A pre-draw listener, that cancels the draw and restarts the traversal with the updated
+     * window attributes.
+     */
+    private class RestartingPreDrawListener implements ViewTreeObserver.OnPreDrawListener {
+
+        private final View mView;
+        private final int mTargetRotation;
+
+        private RestartingPreDrawListener(View view, int targetRotation) {
+            mView = view;
+            mTargetRotation = targetRotation;
+        }
+
+        @Override
+        public boolean onPreDraw() {
+            mView.getViewTreeObserver().removeOnPreDrawListener(this);
+
+            if (mTargetRotation == mRotation) {
+                if (DEBUG) {
+                    Log.i(TAG, (mView == mOverlay ? "OverlayTop" : "OverlayBottom")
+                            + " already in target rot "
+                            + mTargetRotation + ", allow draw without restarting it");
+                }
+                return true;
+            }
+
+            mPendingRotationChange = false;
+            // This changes the window attributes - we need to restart the traversal for them to
+            // take effect.
+            updateOrientation();
+            if (DEBUG) {
+                Log.i(TAG, (mView == mOverlay ? "OverlayTop" : "OverlayBottom")
+                        + " restarting listener fired, restarting draw for rot " + mRotation);
+            }
+            mView.invalidate();
+            return false;
+        }
+    }
+
+    /**
+     * A pre-draw listener, that validates that the rotation we draw in matches the displays
+     * rotation before continuing the draw.
+     *
+     * This is to prevent a race condition, where we have not received the display changed event
+     * yet, and would thus draw in an old orientation.
+     */
+    private class ValidatingPreDrawListener implements ViewTreeObserver.OnPreDrawListener {
+
+        private final View mView;
+
+        public ValidatingPreDrawListener(View view) {
+            mView = view;
+        }
+
+        @Override
+        public boolean onPreDraw() {
+            final int displayRotation = RotationUtils.getExactRotation(mContext);
+            if (displayRotation != mRotation && !mPendingRotationChange) {
+                if (DEBUG) {
+                    Log.i(TAG, "Drawing rot " + mRotation + ", but display is at rot "
+                            + displayRotation + ". Restarting draw");
+                }
+                mView.invalidate();
+                return false;
+            }
+            return true;
+        }
+    }
 }
diff --git a/packages/SystemUI/src/com/android/systemui/colorextraction/SysuiColorExtractor.java b/packages/SystemUI/src/com/android/systemui/colorextraction/SysuiColorExtractor.java
index 9a43d9e0761..3c8a461d3f7 100644
--- a/packages/SystemUI/src/com/android/systemui/colorextraction/SysuiColorExtractor.java
+++ b/packages/SystemUI/src/com/android/systemui/colorextraction/SysuiColorExtractor.java
@@ -21,7 +21,6 @@ import android.app.WallpaperManager;
 import android.content.Context;
 import android.os.Handler;
 import android.os.RemoteException;
-import android.os.Trace;
 import android.os.UserHandle;
 import android.util.Log;
 import android.view.Display;
@@ -46,7 +45,7 @@ import java.util.Arrays;
 public class SysuiColorExtractor extends ColorExtractor implements Dumpable {
     private static final String TAG = "SysuiColorExtractor";
     private boolean mWallpaperVisible;
-    private boolean mMediaBackdropVisible;
+    private boolean mHasBackdrop;
     // Colors to return when the wallpaper isn't visible
     private final GradientColors mWpHiddenColors;
 
@@ -165,7 +164,7 @@ public class SysuiColorExtractor extends ColorExtractor implements Dumpable {
                 return mWpHiddenColors;
             }
         } else {
-            if (mMediaBackdropVisible) {
+            if (mHasBackdrop) {
                 return mWpHiddenColors;
             } else {
                 return super.getColors(which, type);
@@ -181,9 +180,9 @@ public class SysuiColorExtractor extends ColorExtractor implements Dumpable {
         }
     }
 
-    public void setMediaBackdropVisible(boolean visible) {
-        if (mMediaBackdropVisible != visible) {
-            mMediaBackdropVisible = visible;
+    public void setHasBackdrop(boolean hasBackdrop) {
+        if (mHasBackdrop != hasBackdrop) {
+            mHasBackdrop = hasBackdrop;
             triggerColorsChanged(WallpaperManager.FLAG_LOCK);
         }
     }
diff --git a/packages/SystemUI/src/com/android/systemui/keyguard/KeyguardViewMediator.java b/packages/SystemUI/src/com/android/systemui/keyguard/KeyguardViewMediator.java
index 6b4274d4ff8..402d393b35d 100644
--- a/packages/SystemUI/src/com/android/systemui/keyguard/KeyguardViewMediator.java
+++ b/packages/SystemUI/src/com/android/systemui/keyguard/KeyguardViewMediator.java
@@ -348,6 +348,11 @@ public class KeyguardViewMediator extends SystemUI {
      */
     private WorkLockActivityController mWorkLockController;
 
+    /**
+     * @see #setPulsing(boolean)
+     */
+    private boolean mPulsing;
+
     private boolean mLockLater;
 
     private boolean mWakeAndUnlocking;
@@ -1670,7 +1675,6 @@ public class KeyguardViewMediator extends SystemUI {
             resetKeyguardDonePendingLocked();
         }
 
-        mUpdateMonitor.clearFailedUnlockAttempts();
         mUpdateMonitor.clearFingerprintRecognized();
 
         if (mGoingToSleep) {
@@ -1826,10 +1830,12 @@ public class KeyguardViewMediator extends SystemUI {
 
                 int flags = 0;
                 if (mStatusBarKeyguardViewManager.shouldDisableWindowAnimationsForUnlock()
-                        || mWakeAndUnlocking) {
-                    flags |= WindowManagerPolicyConstants.KEYGUARD_GOING_AWAY_FLAG_NO_WINDOW_ANIMATIONS;
+                        || (mWakeAndUnlocking && !mPulsing)) {
+                    flags |= WindowManagerPolicyConstants
+                            .KEYGUARD_GOING_AWAY_FLAG_NO_WINDOW_ANIMATIONS;
                 }
-                if (mStatusBarKeyguardViewManager.isGoingToNotificationShade()) {
+                if (mStatusBarKeyguardViewManager.isGoingToNotificationShade()
+                        || (mWakeAndUnlocking && mPulsing)) {
                     flags |= WindowManagerPolicyConstants.KEYGUARD_GOING_AWAY_FLAG_TO_SHADE;
                 }
                 if (mStatusBarKeyguardViewManager.isUnlockWithWallpaper()) {
@@ -2128,10 +2134,20 @@ public class KeyguardViewMediator extends SystemUI {
         pw.print("  mDrawnCallback: "); pw.println(mDrawnCallback);
     }
 
+    /**
+     * @param aodShowing true when AOD - or ambient mode - is showing.
+     */
     public void setAodShowing(boolean aodShowing) {
         setShowingLocked(mShowing, aodShowing);
     }
 
+    /**
+     * @param pulsing true when device temporarily wakes up to display an incoming notification.
+     */
+    public void setPulsing(boolean pulsing) {
+        mPulsing = pulsing;
+    }
+
     private static class StartKeyguardExitAnimParams {
 
         long startTime;
diff --git a/packages/SystemUI/src/com/android/systemui/power/PowerNotificationWarnings.java b/packages/SystemUI/src/com/android/systemui/power/PowerNotificationWarnings.java
index 065e9cc2d1d..288f058b529 100644
--- a/packages/SystemUI/src/com/android/systemui/power/PowerNotificationWarnings.java
+++ b/packages/SystemUI/src/com/android/systemui/power/PowerNotificationWarnings.java
@@ -266,9 +266,12 @@ public class PowerNotificationWarnings implements PowerUI.WarningsUI {
                 || mEstimate.estimateMillis < mSevereWarningThreshold) {
             nb.setColor(Utils.getColorAttr(mContext, android.R.attr.colorError));
         }
-        nb.addAction(0,
-                mContext.getString(R.string.battery_saver_start_action),
-                pendingBroadcast(ACTION_START_SAVER));
+
+        if (!mPowerMan.isPowerSaveMode()) {
+            nb.addAction(0,
+                    mContext.getString(R.string.battery_saver_start_action),
+                    pendingBroadcast(ACTION_START_SAVER));
+        }
         nb.setOnlyAlertOnce(!mPlaySound);
         mPlaySound = false;
         SystemUI.overrideNotificationAppName(mContext, nb, false);
diff --git a/packages/SystemUI/src/com/android/systemui/power/PowerUI.java b/packages/SystemUI/src/com/android/systemui/power/PowerUI.java
index 6801e6917d3..0b9067e5dc1 100644
--- a/packages/SystemUI/src/com/android/systemui/power/PowerUI.java
+++ b/packages/SystemUI/src/com/android/systemui/power/PowerUI.java
@@ -77,6 +77,7 @@ public class PowerUI extends SystemUI {
     private int mPlugType = 0;
     private int mInvalidCharger = 0;
     private EnhancedEstimates mEnhancedEstimates;
+    private Estimate mLastEstimate;
     private boolean mLowWarningShownThisChargeCycle;
     private boolean mSevereWarningShownThisChargeCycle;
 
@@ -247,7 +248,8 @@ public class PowerUI extends SystemUI {
 
                 // Show the correct version of low battery warning if needed
                 ThreadUtils.postOnBackgroundThread(() -> {
-                    maybeShowBatteryWarning(plugged, oldPlugged, oldBucket, bucket);
+                    maybeShowBatteryWarning(
+                            oldBatteryLevel, plugged, oldPlugged, oldBucket, bucket);
                 });
 
             } else if (Intent.ACTION_SCREEN_OFF.equals(action)) {
@@ -262,14 +264,18 @@ public class PowerUI extends SystemUI {
         }
     }
 
-    protected void maybeShowBatteryWarning(boolean plugged, boolean oldPlugged, int oldBucket,
-        int bucket) {
+    protected void maybeShowBatteryWarning(int oldBatteryLevel, boolean plugged, boolean oldPlugged,
+            int oldBucket, int bucket) {
         boolean isPowerSaver = mPowerManager.isPowerSaveMode();
         // only play SFX when the dialog comes up or the bucket changes
         final boolean playSound = bucket != oldBucket || oldPlugged;
         final boolean hybridEnabled = mEnhancedEstimates.isHybridNotificationEnabled();
         if (hybridEnabled) {
-            final Estimate estimate = mEnhancedEstimates.getEstimate();
+            Estimate estimate = mLastEstimate;
+            if (estimate == null || mBatteryLevel != oldBatteryLevel) {
+                estimate = mEnhancedEstimates.getEstimate();
+                mLastEstimate = estimate;
+            }
             // Turbo is not always booted once SysUI is running so we have ot make sure we actually
             // get data back
             if (estimate != null) {
@@ -327,10 +333,11 @@ public class PowerUI extends SystemUI {
     @VisibleForTesting
     boolean shouldDismissLowBatteryWarning(boolean plugged, int oldBucket, int bucket,
             long timeRemaining, boolean isPowerSaver) {
-        final boolean hybridWouldDismiss = mEnhancedEstimates.isHybridNotificationEnabled()
+        final boolean hybridEnabled = mEnhancedEstimates.isHybridNotificationEnabled();
+        final boolean hybridWouldDismiss = hybridEnabled
                 && timeRemaining > mEnhancedEstimates.getLowWarningThreshold();
         final boolean standardWouldDismiss = (bucket > oldBucket && bucket > 0);
-        return isPowerSaver
+        return (isPowerSaver && !hybridEnabled)
                 || plugged
                 || (standardWouldDismiss && (!mEnhancedEstimates.isHybridNotificationEnabled()
                         || hybridWouldDismiss));
@@ -338,14 +345,14 @@ public class PowerUI extends SystemUI {
 
     private boolean isEnhancedTrigger(boolean plugged, long timeRemaining, boolean isPowerSaver,
             int batteryStatus) {
-        if (plugged || isPowerSaver || batteryStatus == BatteryManager.BATTERY_STATUS_UNKNOWN) {
+        if (plugged || batteryStatus == BatteryManager.BATTERY_STATUS_UNKNOWN) {
             return false;
         }
         int warnLevel = mLowBatteryReminderLevels[0];
         int critLevel = mLowBatteryReminderLevels[1];
 
-        // Only show the low warning once per charge cycle
-        final boolean canShowWarning = !mLowWarningShownThisChargeCycle
+        // Only show the low warning once per charge cycle & no battery saver
+        final boolean canShowWarning = !mLowWarningShownThisChargeCycle && !isPowerSaver
                 && (timeRemaining < mEnhancedEstimates.getLowWarningThreshold()
                         || mBatteryLevel <= warnLevel);
 
diff --git a/packages/SystemUI/src/com/android/systemui/qs/QSPanel.java b/packages/SystemUI/src/com/android/systemui/qs/QSPanel.java
index 8037e15c9ef..d851299c7f8 100644
--- a/packages/SystemUI/src/com/android/systemui/qs/QSPanel.java
+++ b/packages/SystemUI/src/com/android/systemui/qs/QSPanel.java
@@ -301,9 +301,6 @@ public class QSPanel extends LinearLayout implements Tunable, Callback, Brightne
 
         updatePageIndicator();
 
-        for (TileRecord r : mRecords) {
-            r.tile.clearState();
-        }
         if (mListening) {
             refreshAllTiles();
         }
diff --git a/packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeader.java b/packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeader.java
index ccc249f9c0f..6e22e2ea616 100644
--- a/packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeader.java
+++ b/packages/SystemUI/src/com/android/systemui/qs/QuickStatusBarHeader.java
@@ -34,6 +34,7 @@ import android.os.Handler;
 import android.provider.AlarmClock;
 import android.service.notification.ZenModeConfig;
 import android.support.annotation.VisibleForTesting;
+import android.widget.FrameLayout;
 import android.text.format.DateUtils;
 import android.util.AttributeSet;
 import android.util.Log;
@@ -273,8 +274,22 @@ public class QuickStatusBarHeader extends RelativeLayout implements
         updateResources();
     }
 
+    /**
+     * The height of QQS should always be the status bar height + 128dp. This is normally easy, but
+     * when there is a notch involved the status bar can remain a fixed pixel size.
+     */
+    private void updateMinimumHeight() {
+        int sbHeight = mContext.getResources().getDimensionPixelSize(
+                com.android.internal.R.dimen.status_bar_height);
+        int qqsHeight = mContext.getResources().getDimensionPixelSize(
+                R.dimen.qs_quick_header_panel_height);
+
+        setMinimumHeight(sbHeight + qqsHeight);
+    }
+
     private void updateResources() {
         Resources resources = mContext.getResources();
+        updateMinimumHeight();
 
         // Update height for a few views, especially due to landscape mode restricting space.
         mHeaderTextContainerView.getLayoutParams().height =
@@ -285,10 +300,17 @@ public class QuickStatusBarHeader extends RelativeLayout implements
                 com.android.internal.R.dimen.quick_qs_offset_height);
         mSystemIconsView.setLayoutParams(mSystemIconsView.getLayoutParams());
 
-        getLayoutParams().height = resources.getDimensionPixelSize(mQsDisabled
-                ? com.android.internal.R.dimen.quick_qs_offset_height
-                : com.android.internal.R.dimen.quick_qs_total_height);
-        setLayoutParams(getLayoutParams());
+        FrameLayout.LayoutParams lp = (FrameLayout.LayoutParams) getLayoutParams();
+        if (mQsDisabled) {
+            lp.height = resources.getDimensionPixelSize(
+                    com.android.internal.R.dimen.quick_qs_offset_height);
+        } else {
+            lp.height = Math.max(getMinimumHeight(),
+                    resources.getDimensionPixelSize(
+                            com.android.internal.R.dimen.quick_qs_total_height));
+        }
+
+        setLayoutParams(lp);
 
         updateStatusIconAlphaAnimator();
         updateHeaderTextContainerAlphaAnimator();
diff --git a/packages/SystemUI/src/com/android/systemui/qs/customize/TileQueryHelper.java b/packages/SystemUI/src/com/android/systemui/qs/customize/TileQueryHelper.java
index 53a576d3519..591e9e01589 100644
--- a/packages/SystemUI/src/com/android/systemui/qs/customize/TileQueryHelper.java
+++ b/packages/SystemUI/src/com/android/systemui/qs/customize/TileQueryHelper.java
@@ -95,7 +95,6 @@ public class TileQueryHelper {
                 continue;
             }
             tile.setListening(this, true);
-            tile.clearState();
             tile.refreshState();
             tile.setListening(this, false);
             tile.setTileSpec(spec);
diff --git a/packages/SystemUI/src/com/android/systemui/qs/tileimpl/QSTileBaseView.java b/packages/SystemUI/src/com/android/systemui/qs/tileimpl/QSTileBaseView.java
index cc60f8744ca..42e5adced68 100644
--- a/packages/SystemUI/src/com/android/systemui/qs/tileimpl/QSTileBaseView.java
+++ b/packages/SystemUI/src/com/android/systemui/qs/tileimpl/QSTileBaseView.java
@@ -265,6 +265,8 @@ public class QSTileBaseView extends com.android.systemui.plugins.qs.QSTileView {
     @Override
     public void onInitializeAccessibilityNodeInfo(AccessibilityNodeInfo info) {
         super.onInitializeAccessibilityNodeInfo(info);
+        // Clear selected state so it is not announce by talkback.
+        info.setSelected(false);
         if (!TextUtils.isEmpty(mAccessibilityClass)) {
             info.setClassName(mAccessibilityClass);
             if (Switch.class.getName().equals(mAccessibilityClass)) {
diff --git a/packages/SystemUI/src/com/android/systemui/qs/tileimpl/QSTileImpl.java b/packages/SystemUI/src/com/android/systemui/qs/tileimpl/QSTileImpl.java
index 834feb7781e..022a2b4a5fb 100644
--- a/packages/SystemUI/src/com/android/systemui/qs/tileimpl/QSTileImpl.java
+++ b/packages/SystemUI/src/com/android/systemui/qs/tileimpl/QSTileImpl.java
@@ -211,10 +211,6 @@ public abstract class QSTileImpl<TState extends State> implements QSTile {
         mHandler.obtainMessage(H.REFRESH_STATE, arg).sendToTarget();
     }
 
-    public void clearState() {
-        mHandler.sendEmptyMessage(H.CLEAR_STATE);
-    }
-
     public void userSwitch(int newUserId) {
         mHandler.obtainMessage(H.USER_SWITCH, newUserId, 0).sendToTarget();
     }
@@ -266,11 +262,6 @@ public abstract class QSTileImpl<TState extends State> implements QSTile {
 
     public abstract Intent getLongClickIntent();
 
-    protected void handleClearState() {
-        mTmpState = newTileState();
-        mState = newTileState();
-    }
-
     protected void handleRefreshState(Object arg) {
         handleUpdateState(mTmpState, arg);
         final boolean changed = mTmpState.copyTo(mState);
@@ -409,11 +400,10 @@ public abstract class QSTileImpl<TState extends State> implements QSTile {
         private static final int TOGGLE_STATE_CHANGED = 8;
         private static final int SCAN_STATE_CHANGED = 9;
         private static final int DESTROY = 10;
-        private static final int CLEAR_STATE = 11;
-        private static final int REMOVE_CALLBACKS = 12;
-        private static final int REMOVE_CALLBACK = 13;
-        private static final int SET_LISTENING = 14;
-        private static final int STALE = 15;
+        private static final int REMOVE_CALLBACKS = 11;
+        private static final int REMOVE_CALLBACK = 12;
+        private static final int SET_LISTENING = 13;
+        private static final int STALE = 14;
 
         @VisibleForTesting
         protected H(Looper looper) {
@@ -467,9 +457,6 @@ public abstract class QSTileImpl<TState extends State> implements QSTile {
                 } else if (msg.what == DESTROY) {
                     name = "handleDestroy";
                     handleDestroy();
-                } else if (msg.what == CLEAR_STATE) {
-                    name = "handleClearState";
-                    handleClearState();
                 } else if (msg.what == SET_LISTENING) {
                     name = "handleSetListeningInternal";
                     handleSetListeningInternal(msg.obj, msg.arg1 != 0);
diff --git a/packages/SystemUI/src/com/android/systemui/recents/RecentsOnboarding.java b/packages/SystemUI/src/com/android/systemui/recents/RecentsOnboarding.java
index 8d8e20669a1..db2b69f1d06 100644
--- a/packages/SystemUI/src/com/android/systemui/recents/RecentsOnboarding.java
+++ b/packages/SystemUI/src/com/android/systemui/recents/RecentsOnboarding.java
@@ -88,16 +88,16 @@ public class RecentsOnboarding {
     // Show quick scrub tips after opening overview this number of times.
     private static final int QUICK_SCRUB_SHOW_ON_OVERVIEW_OPENED_COUNT = 10;
     // Maximum number of dismissals while still showing swipe-up tips.
-    private static final int MAX_DISMISSAL_ON_SWIPE_UP_SHOW = 4;
+    private static final int MAX_DISMISSAL_ON_SWIPE_UP_SHOW = 2;
     // Number of dismissals for swipe-up tips when exponential backoff starts.
-    private static final int BACKOFF_DISMISSAL_COUNT_ON_SWIPE_UP_SHOW = 2;
+    private static final int BACKOFF_DISMISSAL_COUNT_ON_SWIPE_UP_SHOW = 1;
     // After explicitly dismissing for <= BACKOFF_DISMISSAL_COUNT_ON_SWIPE_UP_SHOW times, show again
     // after launching this number of apps for swipe-up tips.
     private static final int SWIPE_UP_SHOW_ON_APP_LAUNCH_AFTER_DISMISS = 5;
     // After explicitly dismissing for > BACKOFF_DISMISSAL_COUNT_ON_SWIPE_UP_SHOW but
     // <= MAX_DISMISSAL_ON_SWIPE_UP_SHOW times, show again after launching this number of apps for
     // swipe-up tips.
-    private static final int SWIPE_UP_SHOW_ON_APP_LAUNCH_AFTER_DISMISS_BACK_OFF = 10;
+    private static final int SWIPE_UP_SHOW_ON_APP_LAUNCH_AFTER_DISMISS_BACK_OFF = 40;
 
     private final Context mContext;
     private final WindowManager mWindowManager;
@@ -479,7 +479,7 @@ public class RecentsOnboarding {
                 ViewGroup.LayoutParams.WRAP_CONTENT,
                 ViewGroup.LayoutParams.WRAP_CONTENT,
                 x, -mNavBarHeight / 2,
-                WindowManager.LayoutParams.TYPE_NAVIGATION_BAR_PANEL,
+                WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,
                 flags,
                 PixelFormat.TRANSLUCENT);
         lp.privateFlags |= WindowManager.LayoutParams.PRIVATE_FLAG_SHOW_FOR_ALL_USERS;
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/HeadsUpStatusBarView.java b/packages/SystemUI/src/com/android/systemui/statusbar/HeadsUpStatusBarView.java
index 39485c3c880..29e0edaf25c 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/HeadsUpStatusBarView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/HeadsUpStatusBarView.java
@@ -178,11 +178,7 @@ public class HeadsUpStatusBarView extends AlphaOptimizedLinearLayout {
      * @param translationX how to translate the horizontal position
      */
     public void setPanelTranslation(float translationX) {
-        if (isLayoutRtl()) {
-            setTranslationX(translationX + mCutOutInset);
-        } else {
-            setTranslationX(translationX - mCutOutInset);
-        }
+        setTranslationX(translationX);
         updateDrawingRect();
     }
 
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/NotificationEntryManager.java b/packages/SystemUI/src/com/android/systemui/statusbar/NotificationEntryManager.java
index 06f26c9cbc7..469c3c2c60b 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/NotificationEntryManager.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/NotificationEntryManager.java
@@ -667,9 +667,15 @@ public class NotificationEntryManager implements Dumpable, NotificationInflater.
                     entry.row.getNotificationChildren();
             for (int i = 0; i < notificationChildren.size(); i++) {
                 ExpandableNotificationRow row = notificationChildren.get(i);
-                if ((row.getStatusBarNotification().getNotification().flags
-                        & Notification.FLAG_FOREGROUND_SERVICE) != 0) {
-                    // the child is a foreground service notification which we can't remove!
+                NotificationData.Entry childEntry = row.getEntry();
+                boolean isForeground = (row.getStatusBarNotification().getNotification().flags
+                        & Notification.FLAG_FOREGROUND_SERVICE) != 0;
+                boolean keepForReply = FORCE_REMOTE_INPUT_HISTORY
+                        && (shouldKeepForRemoteInput(childEntry)
+                                || shouldKeepForSmartReply(childEntry));
+                if (isForeground || keepForReply) {
+                    // the child is a foreground service notification which we can't remove or it's
+                    // a child we're keeping around for reply!
                     continue;
                 }
                 row.setKeepInParent(true);
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/NotificationLockscreenUserManager.java b/packages/SystemUI/src/com/android/systemui/statusbar/NotificationLockscreenUserManager.java
index 1287ced8594..25684ff651f 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/NotificationLockscreenUserManager.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/NotificationLockscreenUserManager.java
@@ -108,16 +108,6 @@ public class NotificationLockscreenUserManager implements Dumpable {
             } else if (Intent.ACTION_USER_UNLOCKED.equals(action)) {
                 // Start the overview connection to the launcher service
                 Dependency.get(OverviewProxyService.class).startConnectionToCurrentUser();
-            } else if (Intent.ACTION_USER_PRESENT.equals(action)) {
-                try {
-                    final int lastResumedActivityUserId =
-                            ActivityManager.getService().getLastResumedActivityUserId();
-                    if (mUserManager.isManagedProfile(lastResumedActivityUserId)) {
-                        showForegroundManagedProfileActivityToast();
-                    }
-                } catch (RemoteException e) {
-                    // Abandon hope activity manager not running.
-                }
             } else if (NOTIFICATION_UNLOCKED_BY_WORK_CHALLENGE_ACTION.equals(action)) {
                 final IntentSender intentSender = intent.getParcelableExtra(Intent.EXTRA_INTENT);
                 final String notificationKey = intent.getStringExtra(Intent.EXTRA_INDEX);
@@ -224,7 +214,6 @@ public class NotificationLockscreenUserManager implements Dumpable {
         IntentFilter filter = new IntentFilter();
         filter.addAction(Intent.ACTION_USER_SWITCHED);
         filter.addAction(Intent.ACTION_USER_ADDED);
-        filter.addAction(Intent.ACTION_USER_PRESENT);
         filter.addAction(Intent.ACTION_USER_UNLOCKED);
         mContext.registerReceiver(mBaseBroadcastReceiver, filter);
 
@@ -237,19 +226,6 @@ public class NotificationLockscreenUserManager implements Dumpable {
         mSettingsObserver.onChange(false);  // set up
     }
 
-    private void showForegroundManagedProfileActivityToast() {
-        Toast toast = Toast.makeText(mContext,
-                R.string.managed_profile_foreground_toast,
-                Toast.LENGTH_SHORT);
-        TextView text = toast.getView().findViewById(android.R.id.message);
-        text.setCompoundDrawablesRelativeWithIntrinsicBounds(
-                R.drawable.stat_sys_managed_profile_status, 0, 0, 0);
-        int paddingPx = mContext.getResources().getDimensionPixelSize(
-                R.dimen.managed_profile_toast_padding);
-        text.setCompoundDrawablePadding(paddingPx);
-        toast.show();
-    }
-
     public boolean shouldShowLockscreenNotifications() {
         return mShowLockscreenNotifications;
     }
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/NotificationShelf.java b/packages/SystemUI/src/com/android/systemui/statusbar/NotificationShelf.java
index 306319903ec..a215ec6ecaf 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/NotificationShelf.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/NotificationShelf.java
@@ -151,12 +151,11 @@ public class NotificationShelf extends ActivatableNotificationView implements
     }
 
     public void fadeInTranslating() {
-        float translation = mShelfIcons.getTranslationY();
-        mShelfIcons.setTranslationY(translation - mShelfAppearTranslation);
+        mShelfIcons.setTranslationY(-mShelfAppearTranslation);
         mShelfIcons.setAlpha(0);
         mShelfIcons.animate()
                 .setInterpolator(Interpolators.DECELERATE_QUINT)
-                .translationY(translation)
+                .translationY(0)
                 .setDuration(SHELF_IN_TRANSLATION_DURATION)
                 .start();
         mShelfIcons.animate()
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/FingerprintUnlockController.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/FingerprintUnlockController.java
index f0b1a82cfc2..7cb6a192c64 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/FingerprintUnlockController.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/FingerprintUnlockController.java
@@ -210,15 +210,28 @@ public class FingerprintUnlockController extends KeyguardUpdateMonitorCallback {
             // until the clock and the notifications are faded out.
             mStatusBarWindowManager.setForceDozeBrightness(true);
         }
-        if (!wasDeviceInteractive) {
-            if (DEBUG_FP_WAKELOCK) {
-                Log.i(TAG, "fp wakelock: Authenticated, waking up...");
+        // During wake and unlock, we need to draw black before waking up to avoid abrupt
+        // brightness changes due to display state transitions.
+        boolean alwaysOnEnabled = DozeParameters.getInstance(mContext).getAlwaysOn();
+        boolean delayWakeUp = mode == MODE_WAKE_AND_UNLOCK && alwaysOnEnabled;
+        Runnable wakeUp = ()-> {
+            if (!wasDeviceInteractive) {
+                if (DEBUG_FP_WAKELOCK) {
+                    Log.i(TAG, "fp wakelock: Authenticated, waking up...");
+                }
+                mPowerManager.wakeUp(SystemClock.uptimeMillis(), "android.policy:FINGERPRINT");
+            }
+            if (delayWakeUp) {
+                mKeyguardViewMediator.onWakeAndUnlocking();
             }
-            mPowerManager.wakeUp(SystemClock.uptimeMillis(), "android.policy:FINGERPRINT");
+            Trace.beginSection("release wake-and-unlock");
+            releaseFingerprintWakeLock();
+            Trace.endSection();
+        };
+
+        if (!delayWakeUp) {
+            wakeUp.run();
         }
-        Trace.beginSection("release wake-and-unlock");
-        releaseFingerprintWakeLock();
-        Trace.endSection();
         switch (mMode) {
             case MODE_DISMISS_BOUNCER:
                 Trace.beginSection("MODE_DISMISS");
@@ -251,7 +264,11 @@ public class FingerprintUnlockController extends KeyguardUpdateMonitorCallback {
                     mUpdateMonitor.awakenFromDream();
                 }
                 mStatusBarWindowManager.setStatusBarFocusable(false);
-                mKeyguardViewMediator.onWakeAndUnlocking();
+                if (delayWakeUp) {
+                    mHandler.postDelayed(wakeUp, 50);
+                } else {
+                    mKeyguardViewMediator.onWakeAndUnlocking();
+                }
                 if (mStatusBar.getNavigationBarView() != null) {
                     mStatusBar.getNavigationBarView().setWakeAndUnlocking(true);
                 }
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/HeadsUpAppearanceController.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/HeadsUpAppearanceController.java
index 6d521ea2a7a..1ee537041f0 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/HeadsUpAppearanceController.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/HeadsUpAppearanceController.java
@@ -18,6 +18,7 @@ package com.android.systemui.statusbar.phone;
 
 import android.graphics.Point;
 import android.graphics.Rect;
+import android.view.DisplayCutout;
 import android.view.View;
 import android.view.WindowInsets;
 
@@ -159,8 +160,15 @@ public class HeadsUpAppearanceController implements OnHeadsUpChangedListener,
         }
 
         WindowInsets windowInset = mStackScroller.getRootWindowInsets();
-        return windowInset.getSystemWindowInsetLeft() + mStackScroller.getRight()
-                + windowInset.getSystemWindowInsetRight() - realDisplaySize;
+        DisplayCutout cutout = (windowInset != null) ? windowInset.getDisplayCutout() : null;
+        int sysWinLeft = (windowInset != null) ? windowInset.getStableInsetLeft() : 0;
+        int sysWinRight = (windowInset != null) ? windowInset.getStableInsetRight() : 0;
+        int cutoutLeft = (cutout != null) ? cutout.getSafeInsetLeft() : 0;
+        int cutoutRight = (cutout != null) ? cutout.getSafeInsetRight() : 0;
+        int leftInset = Math.max(sysWinLeft, cutoutLeft);
+        int rightInset = Math.max(sysWinRight, cutoutRight);
+
+        return leftInset + mStackScroller.getRight() + rightInset - realDisplaySize;
     }
 
     public void updatePanelTranslation() {
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/HeadsUpManagerPhone.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/HeadsUpManagerPhone.java
index fa0a774c249..0aad4389cee 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/HeadsUpManagerPhone.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/HeadsUpManagerPhone.java
@@ -21,15 +21,22 @@ import android.annotation.Nullable;
 import android.content.Context;
 import android.content.res.Configuration;
 import android.content.res.Resources;
+import android.graphics.Rect;
+import android.graphics.Region;
+import android.graphics.Region.Op;
 import android.support.v4.util.ArraySet;
 import android.util.Log;
 import android.util.Pools;
+import android.view.DisplayCutout;
+import android.view.Gravity;
 import android.view.View;
 import android.view.ViewTreeObserver;
+import android.view.ViewTreeObserver.InternalInsetsInfo;
 
 import com.android.internal.annotations.VisibleForTesting;
 import com.android.systemui.Dumpable;
 import com.android.systemui.R;
+import com.android.systemui.ScreenDecorations;
 import com.android.systemui.statusbar.ExpandableNotificationRow;
 import com.android.systemui.statusbar.NotificationData;
 import com.android.systemui.statusbar.StatusBarState;
@@ -41,6 +48,7 @@ import com.android.systemui.statusbar.policy.OnHeadsUpChangedListener;
 import java.io.FileDescriptor;
 import java.io.PrintWriter;
 import java.util.HashSet;
+import java.util.List;
 import java.util.Stack;
 
 /**
@@ -60,6 +68,7 @@ public class HeadsUpManagerPhone extends HeadsUpManager implements Dumpable,
 
     private int mStatusBarHeight;
     private int mHeadsUpInset;
+    private int mDisplayCutoutTouchableRegionSize;
     private boolean mTrackingHeadsUp;
     private HashSet<String> mSwipedOutKeys = new HashSet<>();
     private HashSet<NotificationData.Entry> mEntriesToRemoveAfterExpand = new HashSet<>();
@@ -120,6 +129,8 @@ public class HeadsUpManagerPhone extends HeadsUpManager implements Dumpable,
                 com.android.internal.R.dimen.status_bar_height);
         mHeadsUpInset = mStatusBarHeight + resources.getDimensionPixelSize(
                 R.dimen.heads_up_status_bar_padding);
+        mDisplayCutoutTouchableRegionSize = resources.getDimensionPixelSize(
+                R.dimen.display_cutout_touchable_region_size);
     }
 
     @Override
@@ -128,6 +139,11 @@ public class HeadsUpManagerPhone extends HeadsUpManager implements Dumpable,
         initResources();
     }
 
+    @Override
+    public void onOverlayChanged() {
+        initResources();
+    }
+
     ///////////////////////////////////////////////////////////////////////////////////////////////
     //  Public methods:
 
@@ -301,12 +317,32 @@ public class HeadsUpManagerPhone extends HeadsUpManager implements Dumpable,
 
             info.setTouchableInsets(ViewTreeObserver.InternalInsetsInfo.TOUCHABLE_INSETS_REGION);
             info.touchableRegion.set(minX, 0, maxX, mHeadsUpInset + height);
-        } else if (mHeadsUpGoingAway || mWaitingOnCollapseWhenGoingAway) {
-            info.setTouchableInsets(ViewTreeObserver.InternalInsetsInfo.TOUCHABLE_INSETS_REGION);
-            info.touchableRegion.set(0, 0, mStatusBarWindowView.getWidth(), mStatusBarHeight);
+        } else {
+            setCollapsedTouchableInsets(info);
         }
     }
 
+    private void setCollapsedTouchableInsets(ViewTreeObserver.InternalInsetsInfo info) {
+        info.setTouchableInsets(ViewTreeObserver.InternalInsetsInfo.TOUCHABLE_INSETS_REGION);
+        info.touchableRegion.set(0, 0, mStatusBarWindowView.getWidth(), mStatusBarHeight);
+        updateRegionForNotch(info.touchableRegion);
+    }
+
+    private void updateRegionForNotch(Region region) {
+        DisplayCutout cutout = mStatusBarWindowView.getRootWindowInsets().getDisplayCutout();
+        if (cutout == null) {
+            return;
+        }
+
+        // Expand touchable region such that we also catch touches that just start below the notch
+        // area.
+        Region bounds = ScreenDecorations.DisplayCutoutView.boundsFromDirection(
+                cutout, Gravity.TOP);
+        bounds.translate(0, mDisplayCutoutTouchableRegionSize);
+        region.op(bounds, Op.UNION);
+        bounds.recycle();
+    }
+
     @Override
     public void onConfigChanged(Configuration newConfig) {
         Resources resources = mContext.getResources();
@@ -403,7 +439,8 @@ public class HeadsUpManagerPhone extends HeadsUpManager implements Dumpable,
 
     private void updateTouchableRegionListener() {
         boolean shouldObserve = hasPinnedHeadsUp() || mHeadsUpGoingAway
-                || mWaitingOnCollapseWhenGoingAway;
+                || mWaitingOnCollapseWhenGoingAway
+                || mStatusBarWindowView.getRootWindowInsets().getDisplayCutout() != null;
         if (shouldObserve == mIsObserving) {
             return;
         }
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardBottomAreaView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardBottomAreaView.java
index 0716b37ff8d..60d62d52995 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardBottomAreaView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardBottomAreaView.java
@@ -172,6 +172,7 @@ public class KeyguardBottomAreaView extends FrameLayout implements View.OnClickL
     private int mIndicationBottomMarginAmbient;
     private float mDarkAmount;
     private int mBurnInXOffset;
+    private int mBurnInYOffset;
 
     public KeyguardBottomAreaView(Context context) {
         this(context, null);
@@ -245,6 +246,8 @@ public class KeyguardBottomAreaView extends FrameLayout implements View.OnClickL
                 R.dimen.keyguard_indication_margin_bottom);
         mIndicationBottomMarginAmbient = getResources().getDimensionPixelSize(
                 R.dimen.keyguard_indication_margin_bottom_ambient);
+        mBurnInYOffset = getResources().getDimensionPixelSize(
+                R.dimen.charging_indication_burn_in_prevention_offset_y);
         updateCameraVisibility();
         mUnlockMethodCache = UnlockMethodCache.getInstance(getContext());
         mUnlockMethodCache.addListener(this);
@@ -317,6 +320,8 @@ public class KeyguardBottomAreaView extends FrameLayout implements View.OnClickL
                 R.dimen.keyguard_indication_margin_bottom);
         mIndicationBottomMarginAmbient = getResources().getDimensionPixelSize(
                 R.dimen.keyguard_indication_margin_bottom_ambient);
+        mBurnInYOffset = getResources().getDimensionPixelSize(
+                R.dimen.charging_indication_burn_in_prevention_offset_y);
         MarginLayoutParams mlp = (MarginLayoutParams) mIndicationArea.getLayoutParams();
         if (mlp.bottomMargin != mIndicationBottomMargin) {
             mlp.bottomMargin = mIndicationBottomMargin;
@@ -560,12 +565,6 @@ public class KeyguardBottomAreaView extends FrameLayout implements View.OnClickL
             return;
         }
         mDarkAmount = darkAmount;
-        // Let's randomize the bottom margin every time we wake up to avoid burn-in.
-        if (darkAmount == 0) {
-            mIndicationBottomMarginAmbient = getResources().getDimensionPixelSize(
-                    R.dimen.keyguard_indication_margin_bottom_ambient)
-                    + (int) (Math.random() * mIndicationText.getTextSize());
-        }
         mIndicationArea.setAlpha(MathUtils.lerp(1f, 0.7f, darkAmount));
         mIndicationArea.setTranslationY(MathUtils.lerp(0,
                 mIndicationBottomMargin - mIndicationBottomMarginAmbient, darkAmount));
@@ -841,8 +840,9 @@ public class KeyguardBottomAreaView extends FrameLayout implements View.OnClickL
     public void dozeTimeTick() {
         if (mDarkAmount == 1) {
             // Move indication every minute to avoid burn-in
-            final int dozeTranslation = mIndicationBottomMargin - mIndicationBottomMarginAmbient;
-            mIndicationArea.setTranslationY(dozeTranslation + (float) Math.random() * 5);
+            int dozeTranslation = mIndicationBottomMargin - mIndicationBottomMarginAmbient;
+            int burnInYOffset = (int) (-mBurnInYOffset + Math.random() * mBurnInYOffset * 2);
+            mIndicationArea.setTranslationY(dozeTranslation + burnInYOffset);
         }
     }
 
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardStatusBarView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardStatusBarView.java
index 0bd3cc795bc..db84222ec5a 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardStatusBarView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/KeyguardStatusBarView.java
@@ -67,6 +67,7 @@ public class KeyguardStatusBarView extends RelativeLayout
     private static final int LAYOUT_CUTOUT = 1;
     private static final int LAYOUT_NO_CUTOUT = 2;
 
+    private boolean mShowPercentAvailable;
     private boolean mBatteryCharging;
     private boolean mKeyguardUserSwitcherShowing;
     private boolean mBatteryListening;
@@ -165,6 +166,8 @@ public class KeyguardStatusBarView extends RelativeLayout
                 R.dimen.system_icons_super_container_avatarless_margin_end);
         mCutoutSideNudge = getResources().getDimensionPixelSize(
                 R.dimen.display_cutout_margin_consumption);
+        mShowPercentAvailable = getContext().getResources().getBoolean(
+                com.android.internal.R.bool.config_battery_percentage_setting_available);
     }
 
     private void updateVisibilities() {
@@ -186,7 +189,7 @@ public class KeyguardStatusBarView extends RelativeLayout
                 mMultiUserSwitch.setVisibility(View.GONE);
             }
         }
-        mBatteryView.setForceShowPercent(mBatteryCharging);
+        mBatteryView.setForceShowPercent(mBatteryCharging && mShowPercentAvailable);
     }
 
     private void updateSystemIconsLayoutParams() {
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
index eb5e3d1d3ab..b6cfa222bc1 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
@@ -18,6 +18,7 @@ package com.android.systemui.statusbar.phone;
 
 import static android.view.MotionEvent.ACTION_DOWN;
 import static com.android.systemui.shared.system.NavigationBarCompat.HIT_TARGET_BACK;
+import static com.android.systemui.shared.system.NavigationBarCompat.HIT_TARGET_DEAD_ZONE;
 import static com.android.systemui.shared.system.NavigationBarCompat.HIT_TARGET_HOME;
 import static com.android.systemui.shared.system.NavigationBarCompat.HIT_TARGET_NONE;
 
@@ -342,15 +343,15 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
     @Override
     public boolean onInterceptTouchEvent(MotionEvent event) {
         mSlideTouchEvent.handleTouchEvent(event);
-        if (shouldDeadZoneConsumeTouchEvents(event)) {
-            return true;
-        }
+        final boolean deadZoneConsumed = shouldDeadZoneConsumeTouchEvents(event);
         switch (event.getActionMasked()) {
             case ACTION_DOWN:
                 int x = (int) event.getX();
                 int y = (int) event.getY();
                 mDownHitTarget = HIT_TARGET_NONE;
-                if (getBackButton().isVisible() && mBackButtonBounds.contains(x, y)) {
+                if (deadZoneConsumed) {
+                    mDownHitTarget = HIT_TARGET_DEAD_ZONE;
+                } else if (getBackButton().isVisible() && mBackButtonBounds.contains(x, y)) {
                     mDownHitTarget = HIT_TARGET_BACK;
                 } else if (getHomeButton().isVisible() && mHomeButtonBounds.contains(x, y)) {
                     mDownHitTarget = HIT_TARGET_HOME;
@@ -368,9 +369,7 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
     @Override
     public boolean onTouchEvent(MotionEvent event) {
         mSlideTouchEvent.handleTouchEvent(event);
-        if (shouldDeadZoneConsumeTouchEvents(event)) {
-            return true;
-        }
+        shouldDeadZoneConsumeTouchEvents(event);
         if (mGestureHelper.onTouchEvent(event)) {
             return true;
         }
@@ -785,7 +784,7 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
                 showSwipeUpUI ? mQuickStepAccessibilityDelegate : null);
     }
 
-    private void updateSlippery() {
+    public void updateSlippery() {
         setSlippery(!isQuickStepSwipeUpEnabled() || mPanelView.isFullyExpanded());
     }
 
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationIconAreaController.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationIconAreaController.java
index eaff8542e23..36caf5c6a00 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationIconAreaController.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationIconAreaController.java
@@ -47,6 +47,8 @@ public class NotificationIconAreaController implements DarkReceiver {
     private final Rect mTintArea = new Rect();
     private NotificationStackScrollLayout mNotificationScrollLayout;
     private Context mContext;
+    private boolean mFullyDark;
+    private boolean mHasShelfIconsWhenFullyDark;
 
     public NotificationIconAreaController(Context context, StatusBar statusBar) {
         mStatusBar = statusBar;
@@ -167,13 +169,40 @@ public class NotificationIconAreaController implements DarkReceiver {
     public void updateNotificationIcons() {
 
         updateStatusBarIcons();
-        updateIconsForLayout(entry -> entry.expandedIcon, mShelfIcons,
-                NotificationShelf.SHOW_AMBIENT_ICONS, false /* hideDismissed */,
-                false /* hideRepliedMessages */);
+        updateShelfIcons();
+        updateHasShelfIconsWhenFullyDark();
 
         applyNotificationIconsTint();
     }
 
+    private void updateHasShelfIconsWhenFullyDark() {
+        boolean hasIconsWhenFullyDark = false;
+        for (int i = 0; i < mNotificationScrollLayout.getChildCount(); i++) {
+            View view = mNotificationScrollLayout.getChildAt(i);
+            if (view instanceof ExpandableNotificationRow) {
+                NotificationData.Entry ent = ((ExpandableNotificationRow) view).getEntry();
+                if (shouldShowNotificationIcon(ent,
+                        NotificationShelf.SHOW_AMBIENT_ICONS /* showAmbient */,
+                        false /* hideDismissed */,
+                        true /* hideReplied */)) {
+                    hasIconsWhenFullyDark = true;
+                    break;
+                }
+            }
+        }
+        mHasShelfIconsWhenFullyDark = hasIconsWhenFullyDark;
+    }
+
+    public boolean hasShelfIconsWhenFullyDark() {
+        return mHasShelfIconsWhenFullyDark;
+    }
+
+    private void updateShelfIcons() {
+        updateIconsForLayout(entry -> entry.expandedIcon, mShelfIcons,
+                NotificationShelf.SHOW_AMBIENT_ICONS, false /* hideDismissed */,
+                mFullyDark /* hideRepliedMessages */);
+    }
+
     public void updateStatusBarIcons() {
         updateIconsForLayout(entry -> entry.icon, mNotificationIcons,
                 false /* showAmbient */, true /* hideDismissed */, true /* hideRepliedMessages */);
@@ -314,6 +343,11 @@ public class NotificationIconAreaController implements DarkReceiver {
         v.setDecorColor(color);
     }
 
+    public void setFullyDark(boolean fullyDark) {
+        mFullyDark = fullyDark;
+        updateShelfIcons();
+    }
+
     public void setDark(boolean dark) {
         mNotificationIcons.setDark(dark, false, 0);
         mShelfIcons.setDark(dark, false, 0);
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationPanelView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationPanelView.java
index a06b6a8a6ad..4ba8f26550d 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationPanelView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NotificationPanelView.java
@@ -48,6 +48,7 @@ import android.view.View;
 import android.view.ViewGroup;
 import android.view.WindowInsets;
 import android.view.accessibility.AccessibilityManager;
+import android.view.animation.Interpolator;
 import android.widget.FrameLayout;
 
 import com.android.internal.logging.MetricsLogger;
@@ -117,17 +118,20 @@ public class NotificationPanelView extends PanelView implements
     private static final AnimationProperties CLOCK_ANIMATION_PROPERTIES = new AnimationProperties()
             .setDuration(StackStateAnimator.ANIMATION_DURATION_STANDARD);
     private static final FloatProperty<NotificationPanelView> SET_DARK_AMOUNT_PROPERTY =
-            new FloatProperty<NotificationPanelView>("mDarkAmount") {
+            new FloatProperty<NotificationPanelView>("mInterpolatedDarkAmount") {
+
                 @Override
                 public void setValue(NotificationPanelView object, float value) {
-                    object.setDarkAmount(value);
+                    object.setDarkAmount(value, object.mDarkInterpolator.getInterpolation(value));
                 }
 
                 @Override
                 public Float get(NotificationPanelView object) {
-                    return object.mDarkAmount;
+                    return object.mLinearDarkAmount;
                 }
             };
+
+    private Interpolator mDarkInterpolator;
     private final PowerManager mPowerManager;
     private final AccessibilityManager mAccessibilityManager;
 
@@ -231,6 +235,7 @@ public class NotificationPanelView extends PanelView implements
     private boolean mClosingWithAlphaFadeOut;
     private boolean mHeadsUpAnimatingAway;
     private boolean mLaunchingAffordance;
+    private boolean mAffordanceHasPreview;
     private FalsingManager mFalsingManager;
     private String mLastCameraLaunchSource = KeyguardBottomAreaView.CAMERA_LAUNCH_SOURCE_AFFORDANCE;
 
@@ -246,7 +251,18 @@ public class NotificationPanelView extends PanelView implements
     private int mIndicationBottomPadding;
     private int mAmbientIndicationBottomPadding;
     private boolean mIsFullWidth;
-    private float mDarkAmount;
+
+    /**
+     * Current dark amount that follows regular interpolation curve of animation.
+     */
+    private float mInterpolatedDarkAmount;
+
+    /**
+     * Dark amount that animates from 0 to 1 or vice-versa in linear manner, even if the
+     * interpolation curve is different.
+     */
+    private float mLinearDarkAmount;
+
     private float mDarkAmountTarget;
     private boolean mPulsing;
     private LockscreenGestureLogger mLockscreenGestureLogger = new LockscreenGestureLogger();
@@ -428,7 +444,7 @@ public class NotificationPanelView extends PanelView implements
                 false);
         addView(mKeyguardBottomArea, index);
         initBottomArea();
-        setDarkAmount(mDarkAmount);
+        setDarkAmount(mLinearDarkAmount, mInterpolatedDarkAmount);
 
         setKeyguardStatusViewVisibility(mStatusBarState, false, false);
         setKeyguardBottomAreaVisibility(mStatusBarState, false);
@@ -542,7 +558,7 @@ public class NotificationPanelView extends PanelView implements
                     getExpandedFraction(),
                     totalHeight,
                     mKeyguardStatusView.getHeight(),
-                    mDarkAmount,
+                    mInterpolatedDarkAmount,
                     mStatusBar.isKeyguardCurrentlySecure(),
                     mPulsing,
                     mBouncerTop);
@@ -1398,9 +1414,7 @@ public class NotificationPanelView extends PanelView implements
         mQsExpansionHeight = height;
         updateQsExpansion();
         requestScrollerTopPaddingUpdate(false /* animate */);
-        if (mKeyguardShowing) {
-            updateHeaderKeyguardAlpha();
-        }
+        updateHeaderKeyguardAlpha();
         if (mStatusBarState == StatusBarState.SHADE_LOCKED
                 || mStatusBarState == StatusBarState.KEYGUARD) {
             updateKeyguardBottomAreaAlpha();
@@ -1803,6 +1817,9 @@ public class NotificationPanelView extends PanelView implements
     }
 
     private void updateHeaderKeyguardAlpha() {
+        if (!mKeyguardShowing) {
+            return;
+        }
         float alphaQsExpansion = 1 - Math.min(1, getQsExpansionFraction() * 2);
         mKeyguardStatusBar.setAlpha(Math.min(getKeyguardContentsAlpha(), alphaQsExpansion)
                 * mKeyguardStatusBarAnimateAlpha);
@@ -1972,7 +1989,7 @@ public class NotificationPanelView extends PanelView implements
         if (view == null && mQsExpanded) {
             return;
         }
-        if (needsAnimation && mDarkAmount == 0) {
+        if (needsAnimation && mInterpolatedDarkAmount == 0) {
             mAnimateNextPositionUpdate = true;
         }
         ExpandableView firstChildNotGone = mNotificationStackScroller.getFirstChildNotGone();
@@ -2546,7 +2563,7 @@ public class NotificationPanelView extends PanelView implements
     }
 
     protected void setVerticalPanelTranslation(float translation) {
-        mNotificationStackScroller.setTranslationX(translation);
+        mNotificationStackScroller.setVerticalPanelTranslation(translation);
         mQsFrame.setTranslationX(translation);
         int size = mVerticalTranslationListener.size();
         for (int i = 0; i < size; i++) {
@@ -2626,6 +2643,7 @@ public class NotificationPanelView extends PanelView implements
         } else {
             animate = false;
         }
+        mAffordanceHasPreview = mKeyguardBottomArea.getRightPreview() != null;
         mAffordanceHelper.launchAffordance(animate, getLayoutDirection() == LAYOUT_DIRECTION_RTL);
     }
 
@@ -2670,6 +2688,13 @@ public class NotificationPanelView extends PanelView implements
         getCenterIcon().setLaunchingAffordance(launchingAffordance);
     }
 
+    /**
+     * Return true when a bottom affordance is launching an occluded activity with a splash screen.
+     */
+    public boolean isLaunchingAffordanceWithPreview() {
+        return mLaunchingAffordance && mAffordanceHasPreview;
+    }
+
     /**
      * Whether the camera application can be launched for the camera launch gesture.
      *
@@ -2775,31 +2800,40 @@ public class NotificationPanelView extends PanelView implements
         }
         mDarkAmountTarget = darkAmount;
         if (animate) {
+            if (mInterpolatedDarkAmount == 0f || mInterpolatedDarkAmount == 1f) {
+                mDarkInterpolator = dozing
+                        ? Interpolators.FAST_OUT_SLOW_IN
+                        : Interpolators.TOUCH_RESPONSE_REVERSE;
+            }
+            mNotificationStackScroller.notifyDarkAnimationStart(dozing);
             mDarkAnimator = ObjectAnimator.ofFloat(this, SET_DARK_AMOUNT_PROPERTY, darkAmount);
-            mDarkAnimator.setInterpolator(Interpolators.LINEAR_OUT_SLOW_IN);
-            mDarkAnimator.setDuration(StackStateAnimator.ANIMATION_DURATION_WAKEUP);
+            mDarkAnimator.setInterpolator(Interpolators.LINEAR);
+            mDarkAnimator.setDuration(mNotificationStackScroller.getDarkAnimationDuration(dozing));
             mDarkAnimator.start();
         } else {
-            setDarkAmount(darkAmount);
+            setDarkAmount(darkAmount, darkAmount);
         }
     }
 
-    private void setDarkAmount(float amount) {
-        mDarkAmount = amount;
-        mKeyguardStatusView.setDarkAmount(mDarkAmount);
-        mKeyguardBottomArea.setDarkAmount(mDarkAmount);
+    private void setDarkAmount(float linearAmount, float amount) {
+        mInterpolatedDarkAmount = amount;
+        mLinearDarkAmount = linearAmount;
+        mKeyguardStatusView.setDarkAmount(mInterpolatedDarkAmount);
+        mKeyguardBottomArea.setDarkAmount(mInterpolatedDarkAmount);
         positionClockAndNotifications();
+        mNotificationStackScroller.setDarkAmount(linearAmount, mInterpolatedDarkAmount);
     }
 
     public void setPulsing(boolean pulsing) {
         mPulsing = pulsing;
-        final boolean canAnimatePulse =
-                !DozeParameters.getInstance(mContext).getDisplayNeedsBlanking();
-        if (canAnimatePulse) {
+        DozeParameters dozeParameters = DozeParameters.getInstance(mContext);
+        final boolean animatePulse = !dozeParameters.getDisplayNeedsBlanking()
+                && dozeParameters.getAlwaysOn();
+        if (animatePulse) {
             mAnimateNextPositionUpdate = true;
         }
-        mNotificationStackScroller.setPulsing(pulsing, canAnimatePulse);
-        mKeyguardStatusView.setPulsing(pulsing, canAnimatePulse);
+        mNotificationStackScroller.setPulsing(pulsing, animatePulse);
+        mKeyguardStatusView.setPulsing(pulsing, animatePulse);
     }
 
     public void setAmbientIndicationBottomPadding(int ambientIndicationBottomPadding) {
@@ -2812,7 +2846,7 @@ public class NotificationPanelView extends PanelView implements
     public void dozeTimeTick() {
         mKeyguardStatusView.dozeTimeTick();
         mKeyguardBottomArea.dozeTimeTick();
-        if (mDarkAmount > 0) {
+        if (mInterpolatedDarkAmount > 0) {
             positionClockAndNotifications();
         }
     }
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/PanelBar.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/PanelBar.java
index c4d7e72c0d8..6f4a3cd8214 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/PanelBar.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/PanelBar.java
@@ -29,6 +29,7 @@ public abstract class PanelBar extends FrameLayout {
     private static final boolean SPEW = false;
     private boolean mBouncerShowing;
     private boolean mExpanded;
+    protected float mPanelFraction;
 
     public static final void LOG(String fmt, Object... args) {
         if (!DEBUG) return;
@@ -77,6 +78,14 @@ public abstract class PanelBar extends FrameLayout {
         if (mPanel != null) mPanel.setImportantForAccessibility(important);
     }
 
+    public float getExpansionFraction() {
+        return mPanelFraction;
+    }
+
+    public boolean isExpanded() {
+        return mExpanded;
+    }
+
     private void updateVisibility() {
         mPanel.setVisibility(mExpanded || mBouncerShowing ? VISIBLE : INVISIBLE);
     }
@@ -131,6 +140,7 @@ public abstract class PanelBar extends FrameLayout {
         if (SPEW) LOG("panelExpansionChanged: start state=%d", mState);
         PanelView pv = mPanel;
         mExpanded = expanded;
+        mPanelFraction = frac;
         updateVisibility();
         // adjust any other panels that may be partially visible
         if (expanded) {
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBarView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBarView.java
index 5477f882e5f..59863ecb119 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBarView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBarView.java
@@ -59,7 +59,6 @@ public class PhoneStatusBarView extends PanelBar {
     private final PhoneStatusBarTransitions mBarTransitions;
     private ScrimController mScrimController;
     private float mMinFraction;
-    private float mPanelFraction;
     private Runnable mHideExpandedRunnable = new Runnable() {
         @Override
         public void run() {
@@ -269,7 +268,6 @@ public class PhoneStatusBarView extends PanelBar {
     @Override
     public void panelExpansionChanged(float frac, boolean expanded) {
         super.panelExpansionChanged(frac, expanded);
-        mPanelFraction = frac;
         updateScrimFraction();
         if ((frac == 0 || frac == 1) && mBar.getNavigationBarView() != null) {
             mBar.getNavigationBarView().onPanelExpandedChange(expanded);
@@ -331,30 +329,25 @@ public class PhoneStatusBarView extends PanelBar {
         // or letterboxing from the right or left sides.
 
         FrameLayout.LayoutParams lp = (FrameLayout.LayoutParams) getLayoutParams();
-        if (mDisplayCutout == null) {
+        if (mDisplayCutout == null || mDisplayCutout.isEmpty()
+                || mLastOrientation != ORIENTATION_PORTRAIT || cornerCutoutMargins == null) {
             lp.leftMargin = 0;
             lp.rightMargin = 0;
             return;
         }
 
-        lp.leftMargin = mDisplayCutout.getSafeInsetLeft();
-        lp.rightMargin = mDisplayCutout.getSafeInsetRight();
-
-        if (cornerCutoutMargins != null) {
-            lp.leftMargin = Math.max(lp.leftMargin, cornerCutoutMargins.first);
-            lp.rightMargin = Math.max(lp.rightMargin, cornerCutoutMargins.second);
-
-            // If we're already inset enough (e.g. on the status bar side), we can have 0 margin
-            WindowInsets insets = getRootWindowInsets();
-            int leftInset = insets.getSystemWindowInsetLeft();
-            int rightInset = insets.getSystemWindowInsetRight();
-            if (lp.leftMargin <= leftInset) {
-                lp.leftMargin = 0;
-            }
-            if (lp.rightMargin <= rightInset) {
-                lp.rightMargin = 0;
-            }
+        lp.leftMargin = Math.max(lp.leftMargin, cornerCutoutMargins.first);
+        lp.rightMargin = Math.max(lp.rightMargin, cornerCutoutMargins.second);
 
+        // If we're already inset enough (e.g. on the status bar side), we can have 0 margin
+        WindowInsets insets = getRootWindowInsets();
+        int leftInset = insets.getSystemWindowInsetLeft();
+        int rightInset = insets.getSystemWindowInsetRight();
+        if (lp.leftMargin <= leftInset) {
+            lp.leftMargin = 0;
+        }
+        if (lp.rightMargin <= rightInset) {
+            lp.rightMargin = 0;
         }
     }
 
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/QuickStepController.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/QuickStepController.java
index 860b77e1b25..48ffe81fdd0 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/QuickStepController.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/QuickStepController.java
@@ -22,20 +22,21 @@ import static com.android.systemui.Interpolators.ALPHA_IN;
 import static com.android.systemui.Interpolators.ALPHA_OUT;
 import static com.android.systemui.OverviewProxyService.DEBUG_OVERVIEW_PROXY;
 import static com.android.systemui.OverviewProxyService.TAG_OPS;
+import static com.android.systemui.shared.system.NavigationBarCompat.HIT_TARGET_DEAD_ZONE;
 
 import android.animation.Animator;
 import android.animation.AnimatorListenerAdapter;
 import android.animation.AnimatorSet;
-import android.animation.ArgbEvaluator;
 import android.animation.ObjectAnimator;
 import android.animation.PropertyValuesHolder;
 import android.content.Context;
 import android.content.res.Resources;
 import android.graphics.Canvas;
-import android.graphics.Color;
 import android.graphics.Matrix;
+import android.graphics.Paint;
+import android.graphics.RadialGradient;
 import android.graphics.Rect;
-import android.graphics.drawable.Drawable;
+import android.graphics.Shader;
 import android.os.Handler;
 import android.os.RemoteException;
 import android.util.FloatProperty;
@@ -54,7 +55,6 @@ import com.android.systemui.plugins.statusbar.phone.NavGesture.GestureHelper;
 import com.android.systemui.shared.recents.IOverviewProxy;
 import com.android.systemui.shared.recents.utilities.Utilities;
 import com.android.systemui.shared.system.NavigationBarCompat;
-import com.android.internal.graphics.ColorUtils;
 
 /**
  * Class to detect gestures on the navigation bar and implement quick scrub.
@@ -65,6 +65,7 @@ public class QuickStepController implements GestureHelper {
     private static final int ANIM_IN_DURATION_MS = 150;
     private static final int ANIM_OUT_DURATION_MS = 134;
     private static final float TRACK_SCALE = 0.95f;
+    private static final float GRADIENT_WIDTH = .75f;
 
     private NavigationBarView mNavigationBarView;
 
@@ -78,23 +79,22 @@ public class QuickStepController implements GestureHelper {
     private boolean mIsRTL;
     private float mTrackAlpha;
     private float mTrackScale = TRACK_SCALE;
-    private int mLightTrackColor;
-    private int mDarkTrackColor;
     private float mDarkIntensity;
+    private RadialGradient mHighlight;
+    private float mHighlightCenter;
     private AnimatorSet mTrackAnimator;
     private ButtonDispatcher mHitTarget;
     private View mCurrentNavigationBarView;
 
     private final Handler mHandler = new Handler();
     private final Rect mTrackRect = new Rect();
-    private final Drawable mTrackDrawable;
     private final OverviewProxyService mOverviewEventSender;
     private final int mTrackThickness;
     private final int mTrackEndPadding;
     private final Context mContext;
     private final Matrix mTransformGlobalMatrix = new Matrix();
     private final Matrix mTransformLocalMatrix = new Matrix();
-    private final ArgbEvaluator mTrackColorEvaluator = new ArgbEvaluator();
+    private final Paint mTrackPaint = new Paint();
 
     private final FloatProperty<QuickStepController> mTrackAlphaProperty =
             new FloatProperty<QuickStepController>("TrackAlpha") {
@@ -155,7 +155,8 @@ public class QuickStepController implements GestureHelper {
         mOverviewEventSender = Dependency.get(OverviewProxyService.class);
         mTrackThickness = res.getDimensionPixelSize(R.dimen.nav_quick_scrub_track_thickness);
         mTrackEndPadding = res.getDimensionPixelSize(R.dimen.nav_quick_scrub_track_edge_padding);
-        mTrackDrawable = context.getDrawable(R.drawable.qs_scrubber_track).mutate();
+        mTrackPaint.setAntiAlias(true);
+        mTrackPaint.setDither(true);
     }
 
     public void setComponents(NavigationBarView navigationBarView) {
@@ -184,9 +185,11 @@ public class QuickStepController implements GestureHelper {
     }
 
     private boolean handleTouchEvent(MotionEvent event) {
+        final boolean deadZoneConsumed =
+                mNavigationBarView.getDownHitTarget() == HIT_TARGET_DEAD_ZONE;
         if (mOverviewEventSender.getProxy() == null || (!mNavigationBarView.isQuickScrubEnabled()
                 && !mNavigationBarView.isQuickStepSwipeUpEnabled())) {
-            return false;
+            return deadZoneConsumed;
         }
         mNavigationBarView.requestUnbufferedDispatch(event);
 
@@ -287,6 +290,8 @@ public class QuickStepController implements GestureHelper {
                     } catch (RemoteException e) {
                         Log.e(TAG, "Failed to send progress of quick scrub.", e);
                     }
+                    mHighlightCenter = x;
+                    mNavigationBarView.invalidate();
                 }
                 break;
             }
@@ -302,7 +307,7 @@ public class QuickStepController implements GestureHelper {
                 || action == MotionEvent.ACTION_UP)) {
             proxyMotionEvents(event);
         }
-        return mQuickScrubActive || mQuickStepStarted;
+        return mQuickScrubActive || mQuickStepStarted || deadZoneConsumed;
     }
 
     @Override
@@ -310,18 +315,18 @@ public class QuickStepController implements GestureHelper {
         if (!mNavigationBarView.isQuickScrubEnabled()) {
             return;
         }
-        int color = (int) mTrackColorEvaluator.evaluate(mDarkIntensity, mLightTrackColor,
-                mDarkTrackColor);
-        int colorAlpha = ColorUtils.setAlphaComponent(color,
-                (int) (Color.alpha(color) * mTrackAlpha));
-        mTrackDrawable.setTint(colorAlpha);
+        mTrackPaint.setAlpha(Math.round(255f * mTrackAlpha));
 
         // Scale the track, but apply the inverse scale from the nav bar
+        final float radius = mTrackRect.height() / 2;
         canvas.save();
+        float translate = Utilities.clamp(mHighlightCenter, mTrackRect.left, mTrackRect.right);
+        canvas.translate(translate, 0);
         canvas.scale(mTrackScale / mNavigationBarView.getScaleX(),
                 1f / mNavigationBarView.getScaleY(),
                 mTrackRect.centerX(), mTrackRect.centerY());
-        mTrackDrawable.draw(canvas);
+        canvas.drawRoundRect(mTrackRect.left - translate, mTrackRect.top,
+                mTrackRect.right - translate, mTrackRect.bottom, radius, radius, mTrackPaint);
         canvas.restore();
     }
 
@@ -346,12 +351,20 @@ public class QuickStepController implements GestureHelper {
             x2 = x1 + width - 2 * mTrackEndPadding;
         }
         mTrackRect.set(x1, y1, x2, y2);
-        mTrackDrawable.setBounds(mTrackRect);
+        updateHighlight();
     }
 
     @Override
     public void onDarkIntensityChange(float intensity) {
+        final float oldIntensity = mDarkIntensity;
         mDarkIntensity = intensity;
+
+        // When in quick scrub, invalidate gradient if changing intensity from black to white and
+        // vice-versa
+        if (mNavigationBarView.isQuickScrubEnabled()
+                && Math.round(intensity) != Math.round(oldIntensity)) {
+            updateHighlight();
+        }
         mNavigationBarView.invalidate();
     }
 
@@ -408,10 +421,8 @@ public class QuickStepController implements GestureHelper {
 
     private void startQuickScrub() {
         if (!mQuickScrubActive) {
+            updateHighlight();
             mQuickScrubActive = true;
-            mLightTrackColor = mContext.getColor(R.color.quick_step_track_background_light);
-            mDarkTrackColor = mContext.getColor(R.color.quick_step_track_background_dark);
-
             ObjectAnimator trackAnimator = ObjectAnimator.ofPropertyValuesHolder(this,
                     PropertyValuesHolder.ofFloat(mTrackAlphaProperty, 1f),
                     PropertyValuesHolder.ofFloat(mTrackScaleProperty, 1f));
@@ -424,6 +435,9 @@ public class QuickStepController implements GestureHelper {
             mTrackAnimator.playTogether(trackAnimator, navBarAnimator);
             mTrackAnimator.start();
 
+            // Disable slippery for quick scrub to not cancel outside the nav bar
+            mNavigationBarView.updateSlippery();
+
             try {
                 mOverviewEventSender.getProxy().onQuickScrubStart();
                 if (DEBUG_OVERVIEW_PROXY) {
@@ -483,6 +497,25 @@ public class QuickStepController implements GestureHelper {
         mQuickScrubActive = false;
         mAllowGestureDetection = false;
         mCurrentNavigationBarView = null;
+        updateHighlight();
+    }
+
+    private void updateHighlight() {
+        if (mTrackRect.isEmpty()) {
+            return;
+        }
+        int colorBase, colorGrad;
+        if (mDarkIntensity > 0.5f) {
+            colorBase = mContext.getColor(R.color.quick_step_track_background_background_dark);
+            colorGrad = mContext.getColor(R.color.quick_step_track_background_foreground_dark);
+        } else {
+            colorBase = mContext.getColor(R.color.quick_step_track_background_background_light);
+            colorGrad = mContext.getColor(R.color.quick_step_track_background_foreground_light);
+        }
+        mHighlight = new RadialGradient(0, mTrackRect.height() / 2,
+                mTrackRect.width() * GRADIENT_WIDTH, colorGrad, colorBase,
+                Shader.TileMode.CLAMP);
+        mTrackPaint.setShader(mHighlight);
     }
 
     private boolean proxyMotionEvents(MotionEvent event) {
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/ScrimController.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/ScrimController.java
index 279ede914fa..61f0e1cb29c 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/ScrimController.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/ScrimController.java
@@ -29,9 +29,7 @@ import android.os.Handler;
 import android.os.Trace;
 import android.util.Log;
 import android.util.MathUtils;
-import android.view.Choreographer;
 import android.view.View;
-import android.view.ViewGroup;
 import android.view.ViewTreeObserver;
 import android.view.animation.DecelerateInterpolator;
 import android.view.animation.Interpolator;
@@ -43,12 +41,11 @@ import com.android.internal.colorextraction.ColorExtractor.OnColorsChangedListen
 import com.android.internal.graphics.ColorUtils;
 import com.android.internal.util.function.TriConsumer;
 import com.android.keyguard.KeyguardUpdateMonitor;
+import com.android.keyguard.KeyguardUpdateMonitorCallback;
 import com.android.systemui.Dependency;
 import com.android.systemui.Dumpable;
 import com.android.systemui.R;
 import com.android.systemui.colorextraction.SysuiColorExtractor;
-import com.android.systemui.statusbar.ExpandableNotificationRow;
-import com.android.systemui.statusbar.NotificationData;
 import com.android.systemui.statusbar.ScrimView;
 import com.android.systemui.statusbar.stack.ViewState;
 import com.android.systemui.util.AlarmTimeout;
@@ -482,21 +479,13 @@ public class ScrimController implements ViewTreeObserver.OnPreDrawListener, OnCo
         // Make sure we have the right gradients and their opacities will satisfy GAR.
         if (mNeedsDrawableColorUpdate) {
             mNeedsDrawableColorUpdate = false;
-            final GradientColors currentScrimColors;
-            if (mState == ScrimState.KEYGUARD || mState == ScrimState.BOUNCER_SCRIMMED
-                    || mState == ScrimState.BOUNCER) {
-                // Always animate color changes if we're seeing the keyguard
-                mScrimInFront.setColors(mLockColors, true /* animated */);
-                mScrimBehind.setColors(mLockColors, true /* animated */);
-                currentScrimColors = mLockColors;
-            } else {
-                // Only animate scrim color if the scrim view is actually visible
-                boolean animateScrimInFront = mScrimInFront.getViewAlpha() != 0;
-                boolean animateScrimBehind = mScrimBehind.getViewAlpha() != 0;
-                mScrimInFront.setColors(mSystemColors, animateScrimInFront);
-                mScrimBehind.setColors(mSystemColors, animateScrimBehind);
-                currentScrimColors = mSystemColors;
-            }
+            boolean isKeyguard = mKeyguardUpdateMonitor.isKeyguardVisible() && !mKeyguardOccluded;
+            GradientColors currentScrimColors = isKeyguard ? mLockColors : mSystemColors;
+            // Only animate scrim color if the scrim view is actually visible
+            boolean animateScrimInFront = mScrimInFront.getViewAlpha() != 0 && !mBlankScreen;
+            boolean animateScrimBehind = mScrimBehind.getViewAlpha() != 0 && !mBlankScreen;
+            mScrimInFront.setColors(currentScrimColors, animateScrimInFront);
+            mScrimBehind.setColors(currentScrimColors, animateScrimBehind);
 
             // Calculate minimum scrim opacity for white or black text.
             int textColor = currentScrimColors.supportsDarkText() ? Color.BLACK : Color.WHITE;
@@ -899,6 +888,18 @@ public class ScrimController implements ViewTreeObserver.OnPreDrawListener, OnCo
         updateScrims();
     }
 
+    public void setHasBackdrop(boolean hasBackdrop) {
+        for (ScrimState state : ScrimState.values()) {
+            state.setHasBackdrop(hasBackdrop);
+        }
+    }
+
+    public void setLaunchingAffordanceWithPreview(boolean launchingAffordanceWithPreview) {
+        for (ScrimState state : ScrimState.values()) {
+            state.setLaunchingAffordanceWithPreview(launchingAffordanceWithPreview);
+        }
+    }
+
     public interface Callback {
         default void onStart() {
         }
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/ScrimState.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/ScrimState.java
index 713356bc238..19015fcdacf 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/ScrimState.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/ScrimState.java
@@ -20,7 +20,6 @@ import android.graphics.Color;
 import android.os.Trace;
 import android.util.MathUtils;
 
-import com.android.keyguard.KeyguardUpdateMonitor;
 import com.android.systemui.statusbar.ScrimView;
 import com.android.systemui.statusbar.stack.StackStateAnimator;
 
@@ -106,8 +105,7 @@ public enum ScrimState {
         public void prepare(ScrimState previousState) {
             final boolean alwaysOnEnabled = mDozeParameters.getAlwaysOn();
             mBlankScreen = mDisplayRequiresBlanking;
-            mCurrentBehindAlpha = mWallpaperSupportsAmbientMode
-                    && !mKeyguardUpdateMonitor.hasLockscreenWallpaper() ? 0f : 1f;
+            mCurrentBehindAlpha = mWallpaperSupportsAmbientMode && !mHasBackdrop ? 0f : 1f;
             mCurrentInFrontAlpha = alwaysOnEnabled ? mAodFrontScrimAlpha : 1f;
             mCurrentInFrontTint = Color.BLACK;
             mCurrentBehindTint = Color.BLACK;
@@ -131,8 +129,7 @@ public enum ScrimState {
         public void prepare(ScrimState previousState) {
             mCurrentInFrontAlpha = 0;
             mCurrentInFrontTint = Color.BLACK;
-            mCurrentBehindAlpha = mWallpaperSupportsAmbientMode
-                    && !mKeyguardUpdateMonitor.hasLockscreenWallpaper() ? 0f : 1f;
+            mCurrentBehindAlpha = mWallpaperSupportsAmbientMode && !mHasBackdrop ? 0f : 1f;
             mCurrentBehindTint = Color.BLACK;
             mBlankScreen = mDisplayRequiresBlanking;
         }
@@ -147,8 +144,9 @@ public enum ScrimState {
             mCurrentBehindAlpha = 0;
             mCurrentInFrontAlpha = 0;
             mAnimationDuration = StatusBar.FADE_KEYGUARD_DURATION;
+            mAnimateChange = !mLaunchingAffordanceWithPreview;
 
-            if (previousState == ScrimState.AOD || previousState == ScrimState.PULSING) {
+            if (previousState == ScrimState.AOD) {
                 // Fade from black to transparent when coming directly from AOD
                 updateScrimColor(mScrimInFront, 1, Color.BLACK);
                 updateScrimColor(mScrimBehind, 1, Color.BLACK);
@@ -178,8 +176,9 @@ public enum ScrimState {
     DozeParameters mDozeParameters;
     boolean mDisplayRequiresBlanking;
     boolean mWallpaperSupportsAmbientMode;
-    KeyguardUpdateMonitor mKeyguardUpdateMonitor;
     int mIndex;
+    boolean mHasBackdrop;
+    boolean mLaunchingAffordanceWithPreview;
 
     ScrimState(int index) {
         mIndex = index;
@@ -190,7 +189,6 @@ public enum ScrimState {
         mScrimBehind = scrimBehind;
         mDozeParameters = dozeParameters;
         mDisplayRequiresBlanking = dozeParameters.getDisplayNeedsBlanking();
-        mKeyguardUpdateMonitor = KeyguardUpdateMonitor.getInstance(scrimInFront.getContext());
     }
 
     public void prepare(ScrimState previousState) {
@@ -253,7 +251,15 @@ public enum ScrimState {
         mWallpaperSupportsAmbientMode = wallpaperSupportsAmbientMode;
     }
 
+    public void setLaunchingAffordanceWithPreview(boolean launchingAffordanceWithPreview) {
+        mLaunchingAffordanceWithPreview = launchingAffordanceWithPreview;
+    }
+
     public boolean isLowPowerState() {
         return false;
     }
+
+    public void setHasBackdrop(boolean hasBackdrop) {
+        mHasBackdrop = hasBackdrop;
+    }
 }
\ No newline at end of file
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
index 4e7ff74855a..0f4349e05a4 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
@@ -352,6 +352,12 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
     /** If true, the lockscreen will show a distinct wallpaper */
     private static final boolean ENABLE_LOCKSCREEN_WALLPAPER = true;
 
+    /** Whether to force dark theme if Configuration.UI_MODE_NIGHT_YES. */
+    private static final boolean DARK_THEME_IN_NIGHT_MODE = true;
+
+    /** Whether to switch the device into night mode in battery saver. */
+    private static final boolean NIGHT_MODE_IN_BATTERY_SAVER = true;
+
     /**
      * Never let the alpha become zero for surfaces that draw with SRC - otherwise the RenderNode
      * won't draw anything and uninitialized memory will show through
@@ -897,23 +903,31 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
                 .createNotificationIconAreaController(context, this);
         inflateShelf();
         mNotificationIconAreaController.setupShelf(mNotificationShelf);
+        mStackScroller.setIconAreaController(mNotificationIconAreaController);
         Dependency.get(DarkIconDispatcher.class).addDarkReceiver(mNotificationIconAreaController);
         FragmentHostManager.get(mStatusBarWindow)
                 .addTagListener(CollapsedStatusBarFragment.TAG, (tag, fragment) -> {
                     CollapsedStatusBarFragment statusBarFragment =
                             (CollapsedStatusBarFragment) fragment;
                     statusBarFragment.initNotificationIconArea(mNotificationIconAreaController);
+                    PhoneStatusBarView oldStatusBarView = mStatusBarView;
                     mStatusBarView = (PhoneStatusBarView) fragment.getView();
                     mStatusBarView.setBar(this);
                     mStatusBarView.setPanel(mNotificationPanel);
                     mStatusBarView.setScrimController(mScrimController);
                     mStatusBarView.setBouncerShowing(mBouncerShowing);
+                    if (oldStatusBarView != null) {
+                        float fraction = oldStatusBarView.getExpansionFraction();
+                        boolean expanded = oldStatusBarView.isExpanded();
+                        mStatusBarView.panelExpansionChanged(fraction, expanded);
+                    }
                     if (mHeadsUpAppearanceController != null) {
                         // This view is being recreated, let's destroy the old one
                         mHeadsUpAppearanceController.destroy();
                     }
                     mHeadsUpAppearanceController = new HeadsUpAppearanceController(
                             mNotificationIconAreaController, mHeadsUpManager, mStatusBarWindow);
+                    mStatusBarWindow.setStatusBarView(mStatusBarView);
                     setAreThereNotifications();
                     checkBarModes();
                 }).getFragmentManager()
@@ -991,6 +1005,10 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
                 if (mDozeServiceHost != null) {
                     mDozeServiceHost.firePowerSaveChanged(isPowerSave);
                 }
+                if (NIGHT_MODE_IN_BATTERY_SAVER) {
+                    mContext.getSystemService(UiModeManager.class).setNightMode(
+                        isPowerSave ? UiModeManager.MODE_NIGHT_YES : UiModeManager.MODE_NIGHT_NO);
+                }
             }
 
             @Override
@@ -1725,6 +1743,10 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
 
         final boolean keyguardVisible = (mState != StatusBarState.SHADE);
         final boolean hasArtwork = artworkDrawable != null;
+        mColorExtractor.setHasBackdrop(hasArtwork);
+        if (mScrimController != null) {
+            mScrimController.setHasBackdrop(hasArtwork);
+        }
 
         if (!mKeyguardFadingAway && keyguardVisible && hasArtwork && mScreenOn) {
             // if there's album art, ensure visualizer is visible
@@ -1740,7 +1762,7 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
             mVisualizerView.setBitmap(((BitmapDrawable)artworkDrawable).getBitmap());
         }
 
-        if ((hasArtwork || DEBUG_MEDIA_FAKE_ARTWORK) && !mDozing
+        if ((hasArtwork || DEBUG_MEDIA_FAKE_ARTWORK)
                 && (mState != StatusBarState.SHADE || allowWhenShade)
                 && mFingerprintUnlockController.getMode()
                         != FingerprintUnlockController.MODE_WAKE_AND_UNLOCK_PULSING
@@ -1756,7 +1778,6 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
                     mBackdrop.setAlpha(1f);
                 }
                 mStatusBarWindowManager.setBackdropShowing(true);
-                mColorExtractor.setMediaBackdropVisible(true);
                 metaDataChanged = true;
                 if (DEBUG_MEDIA) {
                     Log.v(TAG, "DEBUG_MEDIA: Fading in album artwork");
@@ -1808,7 +1829,6 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
                 if (DEBUG_MEDIA) {
                     Log.v(TAG, "DEBUG_MEDIA: Fading out album artwork");
                 }
-                mColorExtractor.setMediaBackdropVisible(false);
                 boolean cannotAnimateDoze = mDozing && !ScrimState.AOD.getAnimateChange();
                 if (mFingerprintUnlockController.getMode()
                         == FingerprintUnlockController.MODE_WAKE_AND_UNLOCK_PULSING
@@ -3336,6 +3356,7 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
     public void onConfigChanged(Configuration newConfig) {
         updateResources();
         updateDisplaySize(); // populates mDisplayMetrics
+        updateTheme();
 
         if (DEBUG) {
             Log.v(TAG, "configuration changed: " + mContext.getResources().getConfiguration());
@@ -4073,31 +4094,20 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
      * Switches theme from light to dark and vice-versa.
      */
     protected void updateTheme() {
-        final boolean inflated = mStackScroller != null;
+        final boolean inflated = mStackScroller != null && mStatusBarWindowManager != null;
 
         // 0 = auto, 1 = time-based, 2 = light, 3 = dark
         final int globalStyleSetting = LineageSettings.System.getInt(mContext.getContentResolver(),
                 LineageSettings.System.BERRY_GLOBAL_STYLE, 0);
         WallpaperColors systemColors = mColorExtractor
                 .getWallpaperColors(WallpaperManager.FLAG_SYSTEM);
-        final boolean useDarkTheme;
-
-        switch (globalStyleSetting) {
-            case 1:
-                useDarkTheme = isLiveDisplayNightModeOn();
-                break;
-            case 2:
-                useDarkTheme = false;
-                break;
-            case 3:
-                useDarkTheme = true;
-                break;
-            default:
-                useDarkTheme = systemColors != null && (systemColors.getColorHints() &
-                        WallpaperColors.HINT_SUPPORTS_DARK_THEME) != 0;
-                break;
-        }
-
+        final boolean wallpaperWantsDarkTheme = systemColors != null
+                && (systemColors.getColorHints() & WallpaperColors.HINT_SUPPORTS_DARK_THEME) != 0;
+        final Configuration config = mContext.getResources().getConfiguration();
+        final boolean nightModeWantsDarkTheme = DARK_THEME_IN_NIGHT_MODE
+                && (config.uiMode & Configuration.UI_MODE_NIGHT_MASK)
+                    == Configuration.UI_MODE_NIGHT_YES;
+        final boolean useDarkTheme = wallpaperWantsDarkTheme || nightModeWantsDarkTheme;
         if (isUsingDarkTheme() != useDarkTheme) {
             mUiOffloadThread.submit(() -> {
                 try {
@@ -4942,7 +4952,6 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
         boolean dozing = mDozingRequested && mState == StatusBarState.KEYGUARD
                 || mFingerprintUnlockController.getMode()
                         == FingerprintUnlockController.MODE_WAKE_AND_UNLOCK_PULSING;
-        final boolean alwaysOn = DozeParameters.getInstance(mContext).getAlwaysOn();
         // When in wake-and-unlock we may not have received a change to mState
         // but we still should not be dozing, manually set to false.
         if (mFingerprintUnlockController.getMode() ==
@@ -4951,7 +4960,7 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
         }
         if (mDozing != dozing) {
             mDozing = dozing;
-            mKeyguardViewMediator.setAodShowing(mDozing && alwaysOn);
+            mKeyguardViewMediator.setAodShowing(mDozing);
             mStatusBarWindowManager.setDozing(mDozing);
             mStatusBarKeyguardViewManager.setDozing(mDozing);
             if (mAmbientIndicationContainer instanceof DozeReceiver) {
@@ -4976,6 +4985,10 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
         mScrimController.setExpansionAffectsAlpha(
                 !mFingerprintUnlockController.isFingerprintUnlock());
 
+        boolean launchingAffordanceWithPreview =
+                mNotificationPanel.isLaunchingAffordanceWithPreview();
+        mScrimController.setLaunchingAffordanceWithPreview(launchingAffordanceWithPreview);
+
         if (mBouncerShowing) {
             // Bouncer needs the front scrim when it's on top of an activity,
             // tapping on a notification, editing QS or being dismissed by
@@ -4985,7 +4998,8 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
                     || mStatusBarKeyguardViewManager.isFullscreenBouncer() ?
                     ScrimState.BOUNCER_SCRIMMED : ScrimState.BOUNCER;
             mScrimController.transitionTo(state);
-        } else if (mLaunchCameraOnScreenTurningOn || isInLaunchTransition()) {
+        } else if (isInLaunchTransition() || mLaunchCameraOnScreenTurningOn
+                || launchingAffordanceWithPreview) {
             mScrimController.transitionTo(ScrimState.UNLOCKED, mUnlockScrimCallback);
         } else if (mBrightnessMirrorVisible) {
             mScrimController.transitionTo(ScrimState.BRIGHTNESS_MIRROR);
@@ -5082,6 +5096,7 @@ public class StatusBar extends SystemUI implements DemoMode, TunerService.Tunabl
                 }
 
                 private void setPulsing(boolean pulsing) {
+                    mKeyguardViewMediator.setPulsing(pulsing);
                     mNotificationPanel.setPulsing(pulsing);
                     mVisualStabilityManager.setPulsing(pulsing);
                     mIgnoreTouchWhilePulsing = false;
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManager.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManager.java
index 00895aa78cd..d99b4eb0115 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManager.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManager.java
@@ -173,7 +173,7 @@ public class StatusBarKeyguardViewManager implements RemoteInputController.Callb
                 || mStatusBar.isFullScreenUserSwitcherState()) {
             mBouncer.setExpansion(KeyguardBouncer.EXPANSION_VISIBLE);
         } else if (mShowing && !mDozing) {
-            if (!isWakeAndUnlocking()) {
+            if (!isWakeAndUnlocking() && !mStatusBar.isInLaunchTransition()) {
                 mBouncer.setExpansion(expansion);
             }
             if (expansion != KeyguardBouncer.EXPANSION_HIDDEN && tracking
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarWindowManager.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarWindowManager.java
index 767bdfc9568..6ff58a288c1 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarWindowManager.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarWindowManager.java
@@ -195,6 +195,15 @@ public class StatusBarWindowManager implements RemoteInputController.Callback, D
         mLpChanged.softInputMode = WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE;
     }
 
+    private void applyExpandedFlag(State state) {
+        if (state.panelExpanded || state.isKeyguardShowingAndNotOccluded() || state.bouncerShowing
+                || ENABLE_REMOTE_INPUT && state.remoteInputActive) {
+            mLpChanged.privateFlags |= LayoutParams.PRIVATE_FLAG_STATUS_BAR_EXPANDED;
+        } else {
+            mLpChanged.privateFlags &= ~LayoutParams.PRIVATE_FLAG_STATUS_BAR_EXPANDED;
+        }
+    }
+
     private void applyHeight(State state) {
         boolean expanded = isExpanded(state);
         if (state.forcePluginOpen) {
@@ -249,6 +258,7 @@ public class StatusBarWindowManager implements RemoteInputController.Callback, D
         applyKeyguardFlags(state);
         applyForceStatusBarVisibleFlag(state);
         applyFocusableFlag(state);
+        applyExpandedFlag(state);
         adjustScreenOrientation(state);
         applyHeight(state);
         applyUserActivityTimeout(state);
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarWindowView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarWindowView.java
index f4c6a7b1d7d..e78420df061 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarWindowView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBarWindowView.java
@@ -38,6 +38,7 @@ import android.os.PowerManager;
 import android.os.SystemClock;
 import android.util.AttributeSet;
 import android.view.ActionMode;
+import android.view.DisplayCutout;
 import android.view.GestureDetector;
 import android.view.InputDevice;
 import android.view.InputQueue;
@@ -83,6 +84,7 @@ public class StatusBarWindowView extends FrameLayout implements TunerService.Tun
     private NotificationStackScrollLayout mStackScrollLayout;
     private NotificationPanelView mNotificationPanel;
     private View mBrightnessMirror;
+    private PhoneStatusBarView mStatusBarView;
 
     private int mRightInset = 0;
     private int mLeftInset = 0;
@@ -106,6 +108,12 @@ public class StatusBarWindowView extends FrameLayout implements TunerService.Tun
     private boolean mExpandAnimationRunning;
     private boolean mExpandAnimationPending;
 
+    /**
+     * If set to true, the current gesture started below the notch and we need to dispatch touch
+     * events manually as it's outside of the regular view bounds.
+     */
+    private boolean mExpandingBelowNotch;
+
     public StatusBarWindowView(Context context, AttributeSet attrs) {
         super(context, attrs);
         setMotionEventSplittingEnabled(false);
@@ -126,10 +134,21 @@ public class StatusBarWindowView extends FrameLayout implements TunerService.Tun
             boolean paddingChanged = insets.top != getPaddingTop()
                     || insets.bottom != getPaddingBottom();
 
+            int rightCutout = 0;
+            int leftCutout = 0;
+            DisplayCutout displayCutout = getRootWindowInsets().getDisplayCutout();
+            if (displayCutout != null) {
+                leftCutout = displayCutout.getSafeInsetLeft();
+                rightCutout = displayCutout.getSafeInsetRight();
+            }
+
+            int targetLeft = Math.max(insets.left, leftCutout);
+            int targetRight = Math.max(insets.right, rightCutout);
+
             // Super-special right inset handling, because scrims and backdrop need to ignore it.
-            if (insets.right != mRightInset || insets.left != mLeftInset) {
-                mRightInset = insets.right;
-                mLeftInset = insets.left;
+            if (targetRight != mRightInset || targetLeft != mLeftInset) {
+                mRightInset = targetRight;
+                mLeftInset = targetLeft;
                 applyMargins();
             }
             // Drop top inset, and pass through bottom inset.
@@ -200,6 +219,10 @@ public class StatusBarWindowView extends FrameLayout implements TunerService.Tun
         }
     }
 
+    public void setStatusBarView(PhoneStatusBarView statusBarView) {
+        mStatusBarView = statusBarView;
+    }
+
     public void setService(StatusBar service) {
         mService = service;
         setDragDownHelper(new DragDownHelper(getContext(), this, mStackScrollLayout, mService));
@@ -299,7 +322,16 @@ public class StatusBarWindowView extends FrameLayout implements TunerService.Tun
     @Override
     public boolean dispatchTouchEvent(MotionEvent ev) {
         boolean isDown = ev.getActionMasked() == MotionEvent.ACTION_DOWN;
+        boolean isUp = ev.getActionMasked() == MotionEvent.ACTION_UP;
         boolean isCancel = ev.getActionMasked() == MotionEvent.ACTION_CANCEL;
+
+        // Reset manual touch dispatch state here but make sure the UP/CANCEL event still gets
+        // delivered.
+        boolean expandingBelowNotch = mExpandingBelowNotch;
+        if (isUp || isCancel) {
+            mExpandingBelowNotch = false;
+        }
+
         if (!isCancel && mService.shouldIgnoreTouch()) {
             return false;
         }
@@ -332,6 +364,17 @@ public class StatusBarWindowView extends FrameLayout implements TunerService.Tun
             mService.mDozeScrimController.extendPulse();
         }
 
+        // In case we start outside of the view bounds (below the status bar), we need to dispatch
+        // the touch manually as the view system can't accomodate for touches outside of the
+        // regular view bounds.
+        if (isDown && ev.getY() >= mBottom) {
+            mExpandingBelowNotch = true;
+            expandingBelowNotch = true;
+        }
+        if (expandingBelowNotch) {
+            return mStatusBarView.dispatchTouchEvent(ev);
+        }
+
         return super.dispatchTouchEvent(ev);
     }
 
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/policy/HotspotControllerImpl.java b/packages/SystemUI/src/com/android/systemui/statusbar/policy/HotspotControllerImpl.java
index d6d0673e2c0..3c16329e6f1 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/policy/HotspotControllerImpl.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/policy/HotspotControllerImpl.java
@@ -134,6 +134,10 @@ public class HotspotControllerImpl implements HotspotController, WifiManager.Sof
 
     @Override
     public void setHotspotEnabled(boolean enabled) {
+        if (mWaitingForCallback) {
+            if (DEBUG) Log.d(TAG, "Ignoring setHotspotEnabled; waiting for callback.");
+            return;
+        }
         if (enabled) {
             OnStartTetheringCallback callback = new OnStartTetheringCallback();
             mWaitingForCallback = true;
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/policy/ZenModeControllerImpl.java b/packages/SystemUI/src/com/android/systemui/statusbar/policy/ZenModeControllerImpl.java
index 2031b27c93f..59b376f311f 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/policy/ZenModeControllerImpl.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/policy/ZenModeControllerImpl.java
@@ -113,10 +113,6 @@ public class ZenModeControllerImpl extends CurrentUserTracker implements ZenMode
 
     @Override
     public void addCallback(Callback callback) {
-        if (callback == null) {
-            Slog.e(TAG, "Attempted to add a null callback.");
-            return;
-        }
         mCallbacks.add(callback);
     }
 
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/stack/AnimationFilter.java b/packages/SystemUI/src/com/android/systemui/statusbar/stack/AnimationFilter.java
index c26568ea00b..e80f48309bb 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/stack/AnimationFilter.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/stack/AnimationFilter.java
@@ -137,6 +137,10 @@ public class AnimationFilter {
                 // to look nice
                 customDelay = StackStateAnimator.ANIMATION_DELAY_HEADS_UP_CLICKED
                         + StackStateAnimator.ANIMATION_DELAY_HEADS_UP;
+            } else if (ev.animationType == NotificationStackScrollLayout.AnimationEvent
+                    .ANIMATION_TYPE_PULSE_APPEAR || ev.animationType ==
+                    NotificationStackScrollLayout.AnimationEvent.ANIMATION_TYPE_PULSE_DISAPPEAR) {
+                customDelay = StackStateAnimator.ANIMATION_DURATION_PULSE_APPEAR / 2;
             }
         }
     }
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/stack/NotificationStackScrollLayout.java b/packages/SystemUI/src/com/android/systemui/statusbar/stack/NotificationStackScrollLayout.java
index 2f9ac4e0337..ff4f215b482 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/stack/NotificationStackScrollLayout.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/stack/NotificationStackScrollLayout.java
@@ -34,7 +34,6 @@ import android.content.res.Resources;
 import android.graphics.Canvas;
 import android.graphics.Color;
 import android.graphics.Paint;
-import android.graphics.Path;
 import android.graphics.PointF;
 import android.graphics.PorterDuff;
 import android.graphics.PorterDuffXfermode;
@@ -46,11 +45,9 @@ import android.support.annotation.NonNull;
 import android.support.annotation.VisibleForTesting;
 import android.support.v4.graphics.ColorUtils;
 import android.util.AttributeSet;
-import android.util.FloatProperty;
 import android.util.Log;
 import android.util.MathUtils;
 import android.util.Pair;
-import android.util.Property;
 import android.view.ContextThemeWrapper;
 import android.view.InputDevice;
 import android.view.MotionEvent;
@@ -101,6 +98,7 @@ import com.android.systemui.statusbar.phone.DozeParameters;
 import com.android.systemui.statusbar.phone.HeadsUpAppearanceController;
 import com.android.systemui.statusbar.phone.HeadsUpManagerPhone;
 import com.android.systemui.statusbar.phone.NotificationGroupManager;
+import com.android.systemui.statusbar.phone.NotificationIconAreaController;
 import com.android.systemui.statusbar.phone.ScrimController;
 import com.android.systemui.statusbar.phone.StatusBar;
 import com.android.systemui.statusbar.policy.HeadsUpUtil;
@@ -140,7 +138,6 @@ public class NotificationStackScrollLayout extends ViewGroup
     private boolean mSwipingInProgress;
     private int mCurrentStackHeight = Integer.MAX_VALUE;
     private final Paint mBackgroundPaint = new Paint();
-    private final Path mBackgroundPath = new Path();
     private final boolean mShouldDrawNotificationBackground;
 
     private float mExpandedHeight;
@@ -375,20 +372,22 @@ public class NotificationStackScrollLayout extends ViewGroup
     private boolean mScrollable;
     private View mForcedScroll;
     private View mNeedingPulseAnimation;
-    private float mDarkAmount = 0f;
-    private static final Property<NotificationStackScrollLayout, Float> DARK_AMOUNT =
-            new FloatProperty<NotificationStackScrollLayout>("darkAmount") {
-                @Override
-                public void setValue(NotificationStackScrollLayout object, float value) {
-                    object.setDarkAmount(value);
-                }
 
-                @Override
-                public Float get(NotificationStackScrollLayout object) {
-                    return object.getDarkAmount();
-                }
-            };
-    private ObjectAnimator mDarkAmountAnimator;
+    /**
+     * @see #setDarkAmount(float, float)
+     */
+    private float mInterpolatedDarkAmount = 0f;
+
+    /**
+     * @see #setDarkAmount(float, float)
+     */
+    private float mLinearDarkAmount = 0f;
+
+    /**
+     * How fast the background scales in the X direction as a factor of the Y expansion.
+     */
+    private float mBackgroundXFactor = 1f;
+
     private boolean mUsingLightTheme;
     private boolean mQsExpanded;
     private boolean mForwardScrollable;
@@ -416,6 +415,10 @@ public class NotificationStackScrollLayout extends ViewGroup
     private ArrayList<BiConsumer<Float, Float>> mExpandedHeightListeners = new ArrayList<>();
     private int mHeadsUpInset;
     private HeadsUpAppearanceController mHeadsUpAppearanceController;
+    private NotificationIconAreaController mIconAreaController;
+    private float mVerticalPanelTranslation;
+
+    private Interpolator mDarkXInterpolator = Interpolators.FAST_OUT_SLOW_IN;
 
     public NotificationStackScrollLayout(Context context) {
         this(context, null);
@@ -532,10 +535,16 @@ public class NotificationStackScrollLayout extends ViewGroup
         final int lockScreenRight = getWidth() - mSidePaddings;
         final int lockScreenTop = mCurrentBounds.top;
         final int lockScreenBottom = mCurrentBounds.bottom;
-        final int darkLeft = getWidth() / 2 - mSeparatorWidth / 2;
-        final int darkRight = darkLeft + mSeparatorWidth;
-        final int darkTop = (int) (mRegularTopPadding + mSeparatorThickness / 2f);
-        final int darkBottom = darkTop + mSeparatorThickness;
+        int separatorWidth = 0;
+        int separatorThickness = 0;
+        if (mIconAreaController.hasShelfIconsWhenFullyDark()) {
+            separatorThickness = mSeparatorThickness;
+            separatorWidth = mSeparatorWidth;
+        }
+        final int darkLeft = getWidth() / 2 - separatorWidth / 2;
+        final int darkRight = darkLeft + separatorWidth;
+        final int darkTop = (int) (mRegularTopPadding + separatorThickness / 2f);
+        final int darkBottom = darkTop + separatorThickness;
 
         if (mAmbientState.hasPulsingNotifications()) {
             // No divider, we have a notification icon instead
@@ -545,16 +554,16 @@ public class NotificationStackScrollLayout extends ViewGroup
                 canvas.drawRect(darkLeft, darkTop, darkRight, darkBottom, mBackgroundPaint);
             }
         } else {
-            float inverseDark = 1 - mDarkAmount;
-            float yProgress = Interpolators.FAST_OUT_SLOW_IN.getInterpolation(inverseDark);
-            float xProgress = Interpolators.FAST_OUT_SLOW_IN
-                    .getInterpolation(inverseDark * 2f);
+            float yProgress = 1 - mInterpolatedDarkAmount;
+            float xProgress = mDarkXInterpolator.getInterpolation(
+                    (1 - mLinearDarkAmount) * mBackgroundXFactor);
 
             mBackgroundAnimationRect.set(
                     (int) MathUtils.lerp(darkLeft, lockScreenLeft, xProgress),
                     (int) MathUtils.lerp(darkTop, lockScreenTop, yProgress),
                     (int) MathUtils.lerp(darkRight, lockScreenRight, xProgress),
                     (int) MathUtils.lerp(darkBottom, lockScreenBottom, yProgress));
+
             if (!mAmbientState.isDark() || mFirstVisibleBackgroundChild != null) {
                 canvas.drawRoundRect(mBackgroundAnimationRect.left, mBackgroundAnimationRect.top,
                         mBackgroundAnimationRect.right, mBackgroundAnimationRect.bottom,
@@ -572,14 +581,15 @@ public class NotificationStackScrollLayout extends ViewGroup
 
         float alpha =
                 BACKGROUND_ALPHA_DIMMED + (1 - BACKGROUND_ALPHA_DIMMED) * (1.0f - mDimAmount);
-        alpha *= 1f - mDarkAmount;
+        alpha *= 1f - mInterpolatedDarkAmount;
         // We need to manually blend in the background color.
         int scrimColor = mScrimController.getBackgroundColor();
         int awakeColor = ColorUtils.blendARGB(scrimColor, mBgColor, alpha);
 
         // Interpolate between semi-transparent notification panel background color
         // and white AOD separator.
-        float colorInterpolation = Interpolators.DECELERATE_QUINT.getInterpolation(mDarkAmount);
+        float colorInterpolation = Interpolators.DECELERATE_QUINT.getInterpolation(
+                mInterpolatedDarkAmount);
         int color = ColorUtils.blendARGB(awakeColor, Color.WHITE, colorInterpolation);
 
         if (mCachedBackgroundColor != color) {
@@ -723,7 +733,8 @@ public class NotificationStackScrollLayout extends ViewGroup
     }
 
     private void updateAlgorithmHeightAndPadding() {
-        mTopPadding = (int) MathUtils.lerp(mRegularTopPadding, mDarkTopPadding, mDarkAmount);
+        mTopPadding = (int) MathUtils.lerp(mRegularTopPadding, mDarkTopPadding,
+                mInterpolatedDarkAmount);
         mAmbientState.setLayoutHeight(getLayoutHeight());
         updateAlgorithmLayoutMinHeight();
         mAmbientState.setTopPadding(mTopPadding);
@@ -948,7 +959,7 @@ public class NotificationStackScrollLayout extends ViewGroup
     }
 
     public void updateClipping() {
-        boolean animatingClipping = mDarkAmount > 0 && mDarkAmount < 1;
+        boolean animatingClipping = mInterpolatedDarkAmount > 0 && mInterpolatedDarkAmount < 1;
         boolean clipped = mRequestedClipBounds != null && !mInHeadsUpPinnedMode
                 && !mHeadsUpAnimatingAway;
         if (mIsClipped != clipped) {
@@ -2041,11 +2052,9 @@ public class NotificationStackScrollLayout extends ViewGroup
     }
 
     private int getScrollRange() {
-        int contentHeight = getContentHeight();
-        int scrollRange = Math.max(0, contentHeight - mMaxLayoutHeight);
+        int scrollRange = Math.max(0, mContentHeight - mMaxLayoutHeight);
         int imeInset = getImeInset();
-        scrollRange += Math.min(imeInset, Math.max(0,
-                getContentHeight() - (getHeight() - imeInset)));
+        scrollRange += Math.min(imeInset, Math.max(0, mContentHeight - (getHeight() - imeInset)));
         return scrollRange;
     }
 
@@ -2146,10 +2155,6 @@ public class NotificationStackScrollLayout extends ViewGroup
         return count;
     }
 
-    public int getContentHeight() {
-        return mContentHeight;
-    }
-
     private void updateContentHeight() {
         int height = 0;
         float previousPaddingRequest = mPaddingBetweenElements;
@@ -2213,7 +2218,11 @@ public class NotificationStackScrollLayout extends ViewGroup
             }
         }
         mIntrinsicContentHeight = height;
-        mContentHeight = height + mTopPadding + mBottomMargin;
+
+        // We don't want to use the toppadding since that might be interpolated and we want
+        // to take the final value of the animation.
+        int topPadding = mAmbientState.isFullyDark() ? mDarkTopPadding : mRegularTopPadding;
+        mContentHeight = height + topPadding + mBottomMargin;
         updateScrollability();
         clampScrollPosition();
         mAmbientState.setLayoutMaxHeight(mContentHeight);
@@ -2410,7 +2419,7 @@ public class NotificationStackScrollLayout extends ViewGroup
             return;
         }
 
-        final boolean awake = mDarkAmount != 0 || mAmbientState.isDark();
+        final boolean awake = mInterpolatedDarkAmount != 0 || mAmbientState.isDark();
         mScrimController.setExcludedBackgroundArea(
                 mFadingOut || mParentNotFullyVisible || awake || mIsClipped ? null
                         : mCurrentBounds);
@@ -3403,7 +3412,6 @@ public class NotificationStackScrollLayout extends ViewGroup
                             .animateY(mShelf));
             ev.darkAnimationOriginIndex = mDarkAnimationOriginIndex;
             mAnimationEvents.add(ev);
-            startDarkAmountAnimation();
         }
         mDarkNeedsAnimation = false;
     }
@@ -3979,11 +3987,8 @@ public class NotificationStackScrollLayout extends ViewGroup
         if (animate && mAnimationsEnabled) {
             mDarkNeedsAnimation = true;
             mDarkAnimationOriginIndex = findDarkAnimationOriginIndex(touchWakeUpScreenLocation);
-            mNeedsAnimation =  true;
+            mNeedsAnimation = true;
         } else {
-            if (mDarkAmountAnimator != null) {
-                mDarkAmountAnimator.cancel();
-            }
             setDarkAmount(dark ? 1f : 0f);
             updateBackground();
         }
@@ -3993,12 +3998,13 @@ public class NotificationStackScrollLayout extends ViewGroup
         notifyHeightChangeListener(mShelf);
     }
 
-    private void updateAntiBurnInTranslation() {
-        float x = mAntiBurnInOffsetX * mDarkAmount;
-        if (!onKeyguard()) {
-            x += getTranslationX();
-        }
-        setTranslationX(x);
+    private void updatePanelTranslation() {
+        setTranslationX(mVerticalPanelTranslation + mAntiBurnInOffsetX * mInterpolatedDarkAmount);
+    }
+
+    public void setVerticalPanelTranslation(float verticalPanelTranslation) {
+        mVerticalPanelTranslation = verticalPanelTranslation;
+        updatePanelTranslation();
     }
 
     /**
@@ -4012,42 +4018,57 @@ public class NotificationStackScrollLayout extends ViewGroup
     }
 
     private void setDarkAmount(float darkAmount) {
-        mDarkAmount = darkAmount;
+        setDarkAmount(darkAmount, darkAmount);
+    }
+
+    /**
+     * Sets the current dark amount.
+     *
+     * @param linearDarkAmount The dark amount that follows linear interpoloation in the animation,
+     *                         i.e. animates from 0 to 1 or vice-versa in a linear manner.
+     * @param interpolatedDarkAmount The dark amount that follows the actual interpolation of the
+     *                                animation curve.
+     */
+    public void setDarkAmount(float linearDarkAmount, float interpolatedDarkAmount) {
+        mLinearDarkAmount = linearDarkAmount;
+        mInterpolatedDarkAmount = interpolatedDarkAmount;
         boolean wasFullyDark = mAmbientState.isFullyDark();
-        mAmbientState.setDarkAmount(darkAmount);
-        if (mAmbientState.isFullyDark() != wasFullyDark) {
+        mAmbientState.setDarkAmount(interpolatedDarkAmount);
+        boolean nowFullyDark = mAmbientState.isFullyDark();
+        if (nowFullyDark != wasFullyDark) {
             updateContentHeight();
             DozeParameters dozeParameters = DozeParameters.getInstance(mContext);
-            if (mAmbientState.isFullyDark() && dozeParameters.shouldControlScreenOff()) {
+            if (nowFullyDark && dozeParameters.shouldControlScreenOff()) {
                 mShelf.fadeInTranslating();
             }
+            if (mIconAreaController != null) {
+                mIconAreaController.setFullyDark(nowFullyDark);
+            }
         }
         updateAlgorithmHeightAndPadding();
         updateBackgroundDimming();
-        updateAntiBurnInTranslation();
+        updatePanelTranslation();
         requestChildrenUpdate();
     }
 
-    public float getDarkAmount() {
-        return mDarkAmount;
+    public void notifyDarkAnimationStart(boolean dark) {
+        // We only swap the scaling factor if we're fully dark or fully awake to avoid
+        // interpolation issues when playing with the power button.
+        if (mInterpolatedDarkAmount == 0 || mInterpolatedDarkAmount == 1) {
+            mBackgroundXFactor = dark ? 1.8f : 1.5f;
+            mDarkXInterpolator = dark
+                    ? Interpolators.FAST_OUT_SLOW_IN_REVERSE
+                    : Interpolators.FAST_OUT_SLOW_IN;
+        }
     }
 
-    private void startDarkAmountAnimation() {
-        ObjectAnimator darkAnimator = ObjectAnimator.ofFloat(this, DARK_AMOUNT, mDarkAmount,
-                mAmbientState.isDark() ? 1f : 0);
-        darkAnimator.setDuration(StackStateAnimator.ANIMATION_DURATION_WAKEUP);
-        darkAnimator.setInterpolator(Interpolators.ALPHA_IN);
-        darkAnimator.addListener(new AnimatorListenerAdapter() {
-            @Override
-            public void onAnimationEnd(Animator animation) {
-                mDarkAmountAnimator = null;
-            }
-        });
-        if (mDarkAmountAnimator != null) {
-            mDarkAmountAnimator.cancel();
+    public long getDarkAnimationDuration(boolean dark) {
+        long duration = StackStateAnimator.ANIMATION_DURATION_WAKEUP;
+        // Longer animation when sleeping with more than 1 notification
+        if (dark && getNotGoneChildCount() > 2) {
+            duration *= 1.2f;
         }
-        mDarkAmountAnimator = darkAnimator;
-        mDarkAmountAnimator.start();
+        return duration;
     }
 
     private int findDarkAnimationOriginIndex(@Nullable PointF screenLocation) {
@@ -4576,7 +4597,7 @@ public class NotificationStackScrollLayout extends ViewGroup
 
     public void setAntiBurnInOffsetX(int antiBurnInOffsetX) {
         mAntiBurnInOffsetX = antiBurnInOffsetX;
-        updateAntiBurnInTranslation();
+        updatePanelTranslation();
     }
 
     public void dump(FileDescriptor fd, PrintWriter pw, String[] args) {
@@ -4622,6 +4643,10 @@ public class NotificationStackScrollLayout extends ViewGroup
         mHeadsUpAppearanceController = headsUpAppearanceController;
     }
 
+    public void setIconAreaController(NotificationIconAreaController controller) {
+        mIconAreaController = controller;
+    }
+
     /**
      * A listener that is notified when the empty space below the notifications is clicked on
      */
@@ -5035,11 +5060,13 @@ public class NotificationStackScrollLayout extends ViewGroup
                 // ANIMATION_TYPE_PULSE_APPEAR
                 new AnimationFilter()
                         .animateAlpha()
+                        .hasDelays()
                         .animateY(),
 
                 // ANIMATION_TYPE_PULSE_DISAPPEAR
                 new AnimationFilter()
                         .animateAlpha()
+                        .hasDelays()
                         .animateY(),
         };
 
@@ -5103,10 +5130,10 @@ public class NotificationStackScrollLayout extends ViewGroup
                 StackStateAnimator.ANIMATION_DURATION_STANDARD,
 
                 // ANIMATION_TYPE_PULSE_APPEAR
-                KeyguardSliceView.DEFAULT_ANIM_DURATION,
+                StackStateAnimator.ANIMATION_DURATION_PULSE_APPEAR,
 
                 // ANIMATION_TYPE_PULSE_DISAPPEAR
-                KeyguardSliceView.DEFAULT_ANIM_DURATION / 2,
+                StackStateAnimator.ANIMATION_DURATION_PULSE_APPEAR / 2,
         };
 
         static final int ANIMATION_TYPE_ADD = 0;
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/stack/StackStateAnimator.java b/packages/SystemUI/src/com/android/systemui/statusbar/stack/StackStateAnimator.java
index a75d40f9201..b83a09dd02a 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/stack/StackStateAnimator.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/stack/StackStateAnimator.java
@@ -24,6 +24,7 @@ import android.view.View;
 import android.view.ViewGroup;
 import android.view.animation.Interpolator;
 
+import com.android.keyguard.KeyguardSliceView;
 import com.android.systemui.Interpolators;
 import com.android.systemui.R;
 import com.android.systemui.statusbar.ExpandableNotificationRow;
@@ -51,6 +52,8 @@ public class StackStateAnimator {
             = (int) (ANIMATION_DURATION_HEADS_UP_APPEAR
                     * HeadsUpAppearInterpolator.getFractionUntilOvershoot());
     public static final int ANIMATION_DURATION_HEADS_UP_DISAPPEAR = 300;
+    public static final int ANIMATION_DURATION_PULSE_APPEAR =
+            KeyguardSliceView.DEFAULT_ANIM_DURATION;
     public static final int ANIMATION_DURATION_BLOCKING_HELPER_FADE = 240;
     public static final int ANIMATION_DELAY_PER_ELEMENT_INTERRUPTING = 80;
     public static final int ANIMATION_DELAY_PER_ELEMENT_MANUAL = 32;
@@ -430,15 +433,26 @@ public class StackStateAnimator {
             } else if (event.animationType == NotificationStackScrollLayout
                     .AnimationEvent.ANIMATION_TYPE_PULSE_APPEAR) {
                 ExpandableViewState viewState = finalState.getViewStateForView(changingView);
-                mTmpState.copyFrom(viewState);
-                mTmpState.yTranslation += mPulsingAppearingTranslation;
-                mTmpState.alpha = 0;
-                mTmpState.applyToView(changingView);
+                if (viewState != null) {
+                    mTmpState.copyFrom(viewState);
+                    mTmpState.yTranslation += mPulsingAppearingTranslation;
+                    mTmpState.alpha = 0;
+                    mTmpState.applyToView(changingView);
+                }
             } else if (event.animationType == NotificationStackScrollLayout
                     .AnimationEvent.ANIMATION_TYPE_PULSE_DISAPPEAR) {
                 ExpandableViewState viewState = finalState.getViewStateForView(changingView);
-                viewState.yTranslation += mPulsingAppearingTranslation;
-                viewState.alpha = 0;
+                if (viewState != null) {
+                    viewState.alpha = 0;
+                    // We want to animate the alpha away before the view starts translating,
+                    // otherwise everything will overlap and look xtra ugly.
+                    float originalYTranslation = viewState.yTranslation;
+                    viewState.yTranslation = changingView.getTranslationY();
+                    mAnimationFilter.animateAlpha = true;
+                    mAnimationProperties.duration = ANIMATION_DURATION_PULSE_APPEAR / 2;
+                    viewState.animateTo(changingView, mAnimationProperties);
+                    viewState.yTranslation = originalYTranslation;
+                }
             } else if (event.animationType == NotificationStackScrollLayout
                     .AnimationEvent.ANIMATION_TYPE_HEADS_UP_APPEAR) {
                 // This item is added, initialize it's properties.
diff --git a/packages/SystemUI/src/com/android/systemui/util/Utils.java b/packages/SystemUI/src/com/android/systemui/util/Utils.java
index eca612776f2..6812410c851 100644
--- a/packages/SystemUI/src/com/android/systemui/util/Utils.java
+++ b/packages/SystemUI/src/com/android/systemui/util/Utils.java
@@ -26,11 +26,14 @@ public class Utils {
 
     /**
      * Allows lambda iteration over a list. It is done in reverse order so it is safe
-     * to add or remove items during the iteration.
+     * to add or remove items during the iteration.  Skips over null items.
      */
     public static <T> void safeForeach(List<T> list, Consumer<T> c) {
         for (int i = list.size() - 1; i >= 0; i--) {
-            c.accept(list.get(i));
+            T item = list.get(i);
+            if (item != null) {
+                c.accept(item);
+            }
         }
     }
 
diff --git a/packages/SystemUI/src/com/android/systemui/volume/SafetyWarningDialog.java b/packages/SystemUI/src/com/android/systemui/volume/SafetyWarningDialog.java
index d7c4bbf3ea1..c97095e1860 100644
--- a/packages/SystemUI/src/com/android/systemui/volume/SafetyWarningDialog.java
+++ b/packages/SystemUI/src/com/android/systemui/volume/SafetyWarningDialog.java
@@ -21,11 +21,13 @@ import android.content.Context;
 import android.content.DialogInterface;
 import android.content.Intent;
 import android.content.IntentFilter;
+import android.content.res.Resources.NotFoundException;
 import android.media.AudioManager;
 import android.util.Log;
 import android.view.KeyEvent;
 import android.view.WindowManager;
 
+
 import com.android.systemui.statusbar.phone.SystemUIDialog;
 
 abstract public class SafetyWarningDialog extends SystemUIDialog
@@ -40,12 +42,18 @@ abstract public class SafetyWarningDialog extends SystemUIDialog
 
     private long mShowTime;
     private boolean mNewVolumeUp;
+    private boolean mDisableOnVolumeUp;
 
     public SafetyWarningDialog(Context context, AudioManager audioManager) {
         super(context);
         mContext = context;
         mAudioManager = audioManager;
-
+        try {
+            mDisableOnVolumeUp = mContext.getResources().getBoolean(
+                  com.android.internal.R.bool.config_safe_media_disable_on_volume_up);
+        } catch (NotFoundException e) {
+            mDisableOnVolumeUp = true;
+        }
         getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ERROR);
         setShowForAllUsers(true);
         setMessage(mContext.getString(com.android.internal.R.string.safe_media_volume_warning));
@@ -63,7 +71,8 @@ abstract public class SafetyWarningDialog extends SystemUIDialog
 
     @Override
     public boolean onKeyDown(int keyCode, KeyEvent event) {
-        if (keyCode == KeyEvent.KEYCODE_VOLUME_UP && event.getRepeatCount() == 0) {
+        if (mDisableOnVolumeUp && keyCode == KeyEvent.KEYCODE_VOLUME_UP
+            && event.getRepeatCount() == 0) {
             mNewVolumeUp = true;
         }
         return super.onKeyDown(keyCode, event);
diff --git a/packages/SystemUI/tests/src/com/android/systemui/ScreenDecorationsTest.java b/packages/SystemUI/tests/src/com/android/systemui/ScreenDecorationsTest.java
index f1bf31d7a58..cc969177ab2 100644
--- a/packages/SystemUI/tests/src/com/android/systemui/ScreenDecorationsTest.java
+++ b/packages/SystemUI/tests/src/com/android/systemui/ScreenDecorationsTest.java
@@ -21,6 +21,7 @@ import static com.android.systemui.tuner.TunablePadding.FLAG_START;
 
 import static org.hamcrest.Matchers.is;
 import static org.junit.Assert.assertThat;
+import static org.junit.Assert.assertEquals;
 import static org.mockito.ArgumentMatchers.any;
 import static org.mockito.ArgumentMatchers.anyInt;
 import static org.mockito.ArgumentMatchers.anyString;
@@ -34,8 +35,10 @@ import static org.mockito.Mockito.when;
 
 import android.app.Fragment;
 import android.content.res.Configuration;
+import android.os.Handler;
 import android.support.test.filters.SmallTest;
 import android.testing.AndroidTestingRunner;
+import android.testing.TestableLooper;
 import android.testing.TestableLooper.RunWithLooper;
 import android.view.Display;
 import android.view.View;
@@ -60,6 +63,7 @@ import org.junit.runner.RunWith;
 @SmallTest
 public class ScreenDecorationsTest extends SysuiTestCase {
 
+    private TestableLooper mTestableLooper;
     private ScreenDecorations mScreenDecorations;
     private StatusBar mStatusBar;
     private WindowManager mWindowManager;
@@ -71,6 +75,10 @@ public class ScreenDecorationsTest extends SysuiTestCase {
 
     @Before
     public void setup() {
+        mTestableLooper = TestableLooper.get(this);
+        mDependency.injectTestDependency(Dependency.MAIN_HANDLER,
+                new Handler(mTestableLooper.getLooper()));
+
         mStatusBar = mock(StatusBar.class);
         mWindowManager = mock(WindowManager.class);
         mView = spy(new StatusBarWindowView(mContext, null));
@@ -88,7 +96,31 @@ public class ScreenDecorationsTest extends SysuiTestCase {
 
         mTunerService = mDependency.injectMockDependency(TunerService.class);
 
-        mScreenDecorations = new ScreenDecorations();
+
+        mScreenDecorations = new ScreenDecorations() {
+            @Override
+            public void start() {
+                super.start();
+                mTestableLooper.processAllMessages();
+            }
+
+            @Override
+            Handler startHandlerThread() {
+                return new Handler(mTestableLooper.getLooper());
+            }
+
+            @Override
+            protected void onConfigurationChanged(Configuration newConfig) {
+                super.onConfigurationChanged(newConfig);
+                mTestableLooper.processAllMessages();
+            }
+
+            @Override
+            public void onTuningChanged(String key, String newValue) {
+                super.onTuningChanged(key, newValue);
+                mTestableLooper.processAllMessages();
+            }
+        };
         mScreenDecorations.mContext = mContext;
         mScreenDecorations.mComponents = mContext.getComponents();
 
@@ -195,4 +227,17 @@ public class ScreenDecorationsTest extends SysuiTestCase {
         verify(padding).destroy();
     }
 
+    @Test
+    public void testUpdateRoundedCorners() {
+        mContext.getOrCreateTestableResources().addOverride(
+                com.android.internal.R.bool.config_fillMainBuiltInDisplayCutout, false);
+        mContext.getOrCreateTestableResources().addOverride(dimen.rounded_corner_radius, 20);
+
+        mScreenDecorations.start();
+        assertEquals(mScreenDecorations.mRoundedDefault, 20);
+
+        mContext.getOrCreateTestableResources().addOverride(dimen.rounded_corner_radius, 5);
+        mScreenDecorations.onConfigurationChanged(null);
+        assertEquals(mScreenDecorations.mRoundedDefault, 5);
+    }
 }
diff --git a/packages/SystemUI/tests/src/com/android/systemui/colorextraction/SysuiColorExtractorTests.java b/packages/SystemUI/tests/src/com/android/systemui/colorextraction/SysuiColorExtractorTests.java
index 8153953a0c3..13dc36da269 100644
--- a/packages/SystemUI/tests/src/com/android/systemui/colorextraction/SysuiColorExtractorTests.java
+++ b/packages/SystemUI/tests/src/com/android/systemui/colorextraction/SysuiColorExtractorTests.java
@@ -93,7 +93,7 @@ public class SysuiColorExtractorTests extends SysuiTestCase {
         SysuiColorExtractor extractor = getTestableExtractor(colors);
         simulateEvent(extractor);
         extractor.setWallpaperVisible(true);
-        extractor.setMediaBackdropVisible(true);
+        extractor.setHasBackdrop(true);
 
         ColorExtractor.GradientColors fallbackColors = extractor.getFallbackColors();
 
diff --git a/packages/SystemUI/tests/src/com/android/systemui/doze/DozeConfigurationTest.java b/packages/SystemUI/tests/src/com/android/systemui/doze/DozeConfigurationTest.java
index 64507be764d..bb67d6e03a9 100644
--- a/packages/SystemUI/tests/src/com/android/systemui/doze/DozeConfigurationTest.java
+++ b/packages/SystemUI/tests/src/com/android/systemui/doze/DozeConfigurationTest.java
@@ -16,7 +16,7 @@
 
 package com.android.systemui.doze;
 
-import static org.junit.Assert.assertTrue;
+import static junit.framework.TestCase.assertEquals;
 
 import android.os.UserHandle;
 import android.provider.Settings;
@@ -42,14 +42,15 @@ public class DozeConfigurationTest extends SysuiTestCase {
     }
 
     @Test
-    public void alwaysOn_onByDefault() throws Exception {
+    public void alwaysOn_followsConfigByDefault() throws Exception {
         if (!mDozeConfig.alwaysOnAvailable()) {
             return;
         }
 
         Settings.Secure.putString(mContext.getContentResolver(), Settings.Secure.DOZE_ALWAYS_ON,
                 null);
-
-        assertTrue(mDozeConfig.alwaysOnEnabled(UserHandle.USER_CURRENT));
+        boolean defaultValue = mContext.getResources()
+                .getBoolean(com.android.internal.R.bool.config_dozeAlwaysOnEnabled);
+        assertEquals(mDozeConfig.alwaysOnEnabled(UserHandle.USER_CURRENT), defaultValue);
     }
 }
diff --git a/packages/SystemUI/tests/src/com/android/systemui/power/PowerUITest.java b/packages/SystemUI/tests/src/com/android/systemui/power/PowerUITest.java
index d19715d5c5c..a9d49f91e44 100644
--- a/packages/SystemUI/tests/src/com/android/systemui/power/PowerUITest.java
+++ b/packages/SystemUI/tests/src/com/android/systemui/power/PowerUITest.java
@@ -24,6 +24,7 @@ import static junit.framework.Assert.assertTrue;
 
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.times;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
 
@@ -66,6 +67,8 @@ public class PowerUITest extends SysuiTestCase {
     public static final long BELOW_HYBRID_THRESHOLD = TimeUnit.HOURS.toMillis(2);
     public static final long ABOVE_HYBRID_THRESHOLD = TimeUnit.HOURS.toMillis(4);
     private static final long ABOVE_CHARGE_CYCLE_THRESHOLD = Duration.ofHours(8).toMillis();
+    private static final int OLD_BATTERY_LEVEL_NINE = 9;
+    private static final int OLD_BATTERY_LEVEL_10 = 10;
     private HardwarePropertiesManager mHardProps;
     private WarningsUI mMockWarnings;
     private PowerUI mPowerUI;
@@ -307,8 +310,8 @@ public class PowerUITest extends SysuiTestCase {
                 .thenReturn(new Estimate(BELOW_HYBRID_THRESHOLD, true));
         mPowerUI.mBatteryStatus = BatteryManager.BATTERY_HEALTH_GOOD;
 
-        mPowerUI.maybeShowBatteryWarning(UNPLUGGED, UNPLUGGED, ABOVE_WARNING_BUCKET,
-                ABOVE_WARNING_BUCKET);
+        mPowerUI.maybeShowBatteryWarning(OLD_BATTERY_LEVEL_NINE, UNPLUGGED, UNPLUGGED,
+                ABOVE_WARNING_BUCKET, ABOVE_WARNING_BUCKET);
 
         // reduce battery level to handle time based trigger -> level trigger interactions
         mPowerUI.mBatteryLevel = 10;
@@ -320,9 +323,9 @@ public class PowerUITest extends SysuiTestCase {
     }
 
     @Test
-    public void testShouldDismissLowBatteryWarning_dismissWhenPowerSaverEnabled() {
+    public void testShouldDismissLowBatteryWarning_dismissWhenPowerSaverEnabledLegacy() {
         mPowerUI.start();
-        when(mEnhancedEstimates.isHybridNotificationEnabled()).thenReturn(true);
+        when(mEnhancedEstimates.isHybridNotificationEnabled()).thenReturn(false);
         when(mEnhancedEstimates.getLowWarningThreshold()).thenReturn(PowerUI.THREE_HOURS_IN_MILLIS);
         when(mEnhancedEstimates.getSevereWarningThreshold()).thenReturn(ONE_HOUR_MILLIS);
 
@@ -333,6 +336,20 @@ public class PowerUITest extends SysuiTestCase {
         assertTrue(shouldDismiss);
     }
 
+    @Test
+    public void testShouldNotDismissLowBatteryWarning_dismissWhenPowerSaverEnabledHybrid() {
+        mPowerUI.start();
+        when(mEnhancedEstimates.isHybridNotificationEnabled()).thenReturn(true);
+        when(mEnhancedEstimates.getLowWarningThreshold()).thenReturn(PowerUI.THREE_HOURS_IN_MILLIS);
+        when(mEnhancedEstimates.getSevereWarningThreshold()).thenReturn(ONE_HOUR_MILLIS);
+
+        // device that gets power saver turned on should dismiss
+        boolean shouldDismiss =
+            mPowerUI.shouldDismissLowBatteryWarning(UNPLUGGED, BELOW_WARNING_BUCKET,
+                BELOW_WARNING_BUCKET, ABOVE_HYBRID_THRESHOLD, !POWER_SAVER_OFF);
+        assertFalse(shouldDismiss);
+    }
+
     @Test
     public void testShouldDismissLowBatteryWarning_dismissWhenPlugged() {
         mPowerUI.start();
@@ -449,6 +466,33 @@ public class PowerUITest extends SysuiTestCase {
         verify(mMockWarnings, never()).dismissLowBatteryWarning();
     }
 
+    @Test
+    public void testMaybeShowBatteryWarning_onlyQueriesEstimateOnBatteryLevelChangeOrNull() {
+        mPowerUI.start();
+        Estimate estimate = new Estimate(BELOW_HYBRID_THRESHOLD, true);
+        when(mEnhancedEstimates.isHybridNotificationEnabled()).thenReturn(true);
+        when(mEnhancedEstimates.getLowWarningThreshold()).thenReturn(PowerUI.THREE_HOURS_IN_MILLIS);
+        when(mEnhancedEstimates.getSevereWarningThreshold()).thenReturn(ONE_HOUR_MILLIS);
+        when(mEnhancedEstimates.getEstimate()).thenReturn(estimate);
+        mPowerUI.mBatteryStatus = BatteryManager.BATTERY_HEALTH_GOOD;
+
+        // we expect that the first time it will query even if the level is the same
+        mPowerUI.mBatteryLevel = 9;
+        mPowerUI.maybeShowBatteryWarning(OLD_BATTERY_LEVEL_NINE, UNPLUGGED, UNPLUGGED,
+                ABOVE_WARNING_BUCKET, ABOVE_WARNING_BUCKET);
+        verify(mEnhancedEstimates, times(1)).getEstimate();
+
+        // We should NOT query again if the battery level hasn't changed
+        mPowerUI.maybeShowBatteryWarning(OLD_BATTERY_LEVEL_NINE, UNPLUGGED, UNPLUGGED,
+                ABOVE_WARNING_BUCKET, ABOVE_WARNING_BUCKET);
+        verify(mEnhancedEstimates, times(1)).getEstimate();
+
+        // Battery level has changed, so we should query again
+        mPowerUI.maybeShowBatteryWarning(OLD_BATTERY_LEVEL_10, UNPLUGGED, UNPLUGGED,
+                ABOVE_WARNING_BUCKET, ABOVE_WARNING_BUCKET);
+        verify(mEnhancedEstimates, times(2)).getEstimate();
+    }
+
     private void setCurrentTemp(float temp) {
         when(mHardProps.getDeviceTemperatures(DEVICE_TEMPERATURE_SKIN, TEMPERATURE_CURRENT))
                 .thenReturn(new float[] { temp });
diff --git a/packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/ScrimControllerTest.java b/packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/ScrimControllerTest.java
index e95702c5ab9..89d562a2099 100644
--- a/packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/ScrimControllerTest.java
+++ b/packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/ScrimControllerTest.java
@@ -44,7 +44,6 @@ import android.view.View;
 
 import com.android.internal.colorextraction.ColorExtractor.GradientColors;
 import com.android.internal.util.function.TriConsumer;
-import com.android.keyguard.KeyguardUpdateMonitor;
 import com.android.systemui.SysuiTestCase;
 import com.android.systemui.statusbar.ScrimView;
 import com.android.systemui.util.wakelock.WakeLock;
@@ -94,6 +93,7 @@ public class ScrimControllerTest extends SysuiTestCase {
                     mScrimInFrontColor = scrimInFrontColor;
                 },
                 visible -> mScrimVisibility = visible, mDozeParamenters, mAlarmManager);
+        mScrimController.setHasBackdrop(false);
     }
 
     @Test
@@ -140,12 +140,7 @@ public class ScrimControllerTest extends SysuiTestCase {
 
     @Test
     public void transitionToAod_withAodWallpaperAndLockScreenWallpaper() {
-        ScrimState.AOD.mKeyguardUpdateMonitor = new KeyguardUpdateMonitor(getContext()) {
-            @Override
-            public boolean hasLockscreenWallpaper() {
-                return true;
-            }
-        };
+        mScrimController.setHasBackdrop(true);
         mScrimController.setWallpaperSupportsAmbientMode(true);
         mScrimController.transitionTo(ScrimState.AOD);
         mScrimController.finishAnimationsImmediately();
diff --git a/packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManagerTest.java b/packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManagerTest.java
index 85135ac77b3..94ab9d2a7d0 100644
--- a/packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManagerTest.java
+++ b/packages/SystemUI/tests/src/com/android/systemui/statusbar/phone/StatusBarKeyguardViewManagerTest.java
@@ -177,6 +177,14 @@ public class StatusBarKeyguardViewManagerTest extends SysuiTestCase {
         verify(mBouncer, never()).setExpansion(anyFloat());
     }
 
+    @Test
+    public void onPanelExpansionChanged_neverTranslatesBouncerWhenLaunchingApp() {
+        when(mStatusBar.isInLaunchTransition()).thenReturn(true);
+        mStatusBarKeyguardViewManager.onPanelExpansionChanged(KeyguardBouncer.EXPANSION_VISIBLE,
+                false /* tracking */);
+        verify(mBouncer, never()).setExpansion(anyFloat());
+    }
+
     private class TestableStatusBarKeyguardViewManager extends StatusBarKeyguardViewManager {
 
         public TestableStatusBarKeyguardViewManager(Context context,
diff --git a/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values-pl/strings.xml b/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values-pl/strings.xml
index 67684078228..dd68d59b56c 100644
--- a/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values-pl/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values-pl/strings.xml
@@ -17,5 +17,5 @@
 
 <resources xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <string name="display_cutout_emulation_overlay" msgid="4967302169856689448">"Wycicie wywietlacza znaronikami"</string>
+    <string name="display_cutout_emulation_overlay" msgid="4967302169856689448">"Wycicie w ekranie znaronikami"</string>
 </resources>
diff --git a/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values/config.xml b/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values/config.xml
index 80d8066959a..9254b4d65b5 100644
--- a/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values/config.xml
+++ b/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values/config.xml
@@ -37,6 +37,8 @@
         @right
     </string>
 
+    <string translatable="false" name="config_mainBuiltInDisplayCutoutRectApproximation">@*android:string/config_mainBuiltInDisplayCutout</string>
+
     <!-- Whether the display cutout region of the main built-in display should be forced to
          black in software (to avoid aliasing or emulate a cutout that is not physically existent).
      -->
diff --git a/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values/strings.xml b/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values/strings.xml
index 754ba722d08..b08924b8adb 100644
--- a/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationCornerOverlay/res/values/strings.xml
@@ -16,7 +16,7 @@
   -->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
 
-    <string name="display_cutout_emulation_overlay">Corner display cutout</string>
+    <string name="display_cutout_emulation_overlay">Corner cutout</string>
 
 </resources>
 
diff --git a/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values-pl/strings.xml b/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values-pl/strings.xml
index fdc9a208d21..95344126ec9 100644
--- a/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values-pl/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values-pl/strings.xml
@@ -17,5 +17,5 @@
 
 <resources xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <string name="display_cutout_emulation_overlay" msgid="5659433562878674546">"Podwjne wycicie wywietlacza"</string>
+    <string name="display_cutout_emulation_overlay" msgid="5659433562878674546">"Podwjne wycicie w ekranie"</string>
 </resources>
diff --git a/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values/config.xml b/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values/config.xml
index ca261f98cfa..80c997a4626 100644
--- a/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values/config.xml
+++ b/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values/config.xml
@@ -49,6 +49,8 @@
         @dp
     </string>
 
+    <string translatable="false" name="config_mainBuiltInDisplayCutoutRectApproximation">@*android:string/config_mainBuiltInDisplayCutout</string>
+
     <!-- Whether the display cutout region of the main built-in display should be forced to
          black in software (to avoid aliasing or emulate a cutout that is not physically existent).
      -->
diff --git a/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values/strings.xml b/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values/strings.xml
index 68c2dcbbe3f..0a106fa0c08 100644
--- a/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationDoubleOverlay/res/values/strings.xml
@@ -16,7 +16,7 @@
   -->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
 
-    <string name="display_cutout_emulation_overlay">Double display cutout</string>
+    <string name="display_cutout_emulation_overlay">Double cutout</string>
 
 </resources>
 
diff --git a/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values-pl/strings.xml b/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values-pl/strings.xml
index f3261de2212..1e0b3ff5d9c 100644
--- a/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values-pl/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values-pl/strings.xml
@@ -19,5 +19,5 @@
 
 <resources xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <string name="display_cutout_emulation_overlay" msgid="6129374114103110395">"Wskie wycicie wywietlacza"</string>
+    <string name="display_cutout_emulation_overlay" msgid="6129374114103110395">"Wskie wycicie w ekranie"</string>
 </resources>
diff --git a/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values/config.xml b/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values/config.xml
index c22b2e778ff..6fb3c7f51e2 100644
--- a/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values/config.xml
+++ b/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values/config.xml
@@ -40,6 +40,8 @@
         @dp
     </string>
 
+    <string translatable="false" name="config_mainBuiltInDisplayCutoutRectApproximation">@*android:string/config_mainBuiltInDisplayCutout</string>
+
     <!-- Whether the display cutout region of the main built-in display should be forced to
          black in software (to avoid aliasing or emulate a cutout that is not physically existent).
      -->
diff --git a/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values/strings.xml b/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values/strings.xml
index 49896773ac5..0bf83306f87 100644
--- a/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationNarrowOverlay/res/values/strings.xml
@@ -18,7 +18,7 @@
 -->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
 
-    <string name="display_cutout_emulation_overlay">Narrow display cutout</string>
+    <string name="display_cutout_emulation_overlay">Narrow cutout</string>
 
 </resources>
 
diff --git a/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values-pl/strings.xml b/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values-pl/strings.xml
index 561947ede8d..4bd3c4816c5 100644
--- a/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values-pl/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values-pl/strings.xml
@@ -17,5 +17,5 @@
 
 <resources xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <string name="display_cutout_emulation_overlay" msgid="4955013674374634273">"Wysokie wycicie wywietlacza"</string>
+    <string name="display_cutout_emulation_overlay" msgid="4955013674374634273">"Wysokie wycicie w ekranie"</string>
 </resources>
diff --git a/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values/config.xml b/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values/config.xml
index 401e09211ae..7c29ffb92f4 100644
--- a/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values/config.xml
+++ b/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values/config.xml
@@ -40,6 +40,8 @@
         @dp
     </string>
 
+    <string translatable="false" name="config_mainBuiltInDisplayCutoutRectApproximation">@*android:string/config_mainBuiltInDisplayCutout</string>
+
     <!-- Whether the display cutout region of the main built-in display should be forced to
          black in software (to avoid aliasing or emulate a cutout that is not physically existent).
      -->
diff --git a/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values/strings.xml b/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values/strings.xml
index 6dcbbd92360..bcc7c9756a6 100644
--- a/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationTallOverlay/res/values/strings.xml
@@ -16,7 +16,7 @@
   -->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
 
-    <string name="display_cutout_emulation_overlay">Tall display cutout</string>
+    <string name="display_cutout_emulation_overlay">Tall cutout</string>
 
 </resources>
 
diff --git a/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values-pl/strings.xml b/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values-pl/strings.xml
index 082946fdad5..f406c72d28e 100644
--- a/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values-pl/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values-pl/strings.xml
@@ -17,5 +17,5 @@
 
 <resources xmlns:android="http://schemas.android.com/apk/res/android"
     xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-    <string name="display_cutout_emulation_overlay" msgid="3249818092477753587">"Szerokie wycicie wywietlacza"</string>
+    <string name="display_cutout_emulation_overlay" msgid="3249818092477753587">"Szerokie wycicie w ekranie"</string>
 </resources>
diff --git a/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values/config.xml b/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values/config.xml
index f328b83c1cb..5fb8b9e241b 100644
--- a/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values/config.xml
+++ b/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values/config.xml
@@ -40,6 +40,8 @@
         @dp
     </string>
 
+    <string translatable="false" name="config_mainBuiltInDisplayCutoutRectApproximation">@*android:string/config_mainBuiltInDisplayCutout</string>
+
     <!-- Whether the display cutout region of the main built-in display should be forced to
          black in software (to avoid aliasing or emulate a cutout that is not physically existent).
      -->
diff --git a/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values/strings.xml b/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values/strings.xml
index f4b9f7ea7c3..0fcbdebbd34 100644
--- a/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values/strings.xml
+++ b/packages/overlays/DisplayCutoutEmulationWideOverlay/res/values/strings.xml
@@ -16,7 +16,7 @@
   -->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
 
-    <string name="display_cutout_emulation_overlay">Wide display cutout</string>
+    <string name="display_cutout_emulation_overlay">Wide cutout</string>
 
 </resources>
 
diff --git a/proto/src/gnss.proto b/proto/src/gnss.proto
index 01683923225..1509fc00fb1 100644
--- a/proto/src/gnss.proto
+++ b/proto/src/gnss.proto
@@ -45,6 +45,9 @@ message GnssLog {
 
   // Power metrics
   optional PowerMetrics power_metrics = 12;
+
+  // Hardware revision (EVT, DVT, PVT etc.)
+  optional string hardware_revision = 13;
 }
 
 // Power metrics
diff --git a/proto/src/metrics_constants.proto b/proto/src/metrics_constants.proto
index 4328d94275e..0833e34ff8b 100644
--- a/proto/src/metrics_constants.proto
+++ b/proto/src/metrics_constants.proto
@@ -941,9 +941,10 @@ message MetricsEvent {
     // OS: 6.0
     NOTIFICATION_ZEN_MODE_EVENT_RULE = 146;
 
-    // ACTION: App notification settings > Block Notifications
+    // ACTION: App notification settings > Block Notifications or long press on
+    // notification blocks.
     // CATEGORY: SETTINGS
-    // OS: 6.0
+    // OS: 9.0
     ACTION_BAN_APP_NOTES = 147;
 
     // ACTION: Notification shade > Dismiss all button
@@ -6116,7 +6117,320 @@ message MetricsEvent {
     // OS: P
     FIELD_AUTOFILL_SESSION_ID = 1456;
 
+    // NOTIFICATION_SINCE_INTERRUPTION_MILLIS added to P
+    // NOTIFICATION_INTERRUPTION added to P
+
     // ---- End P Constants, all P constants go above this line ----
+
+    // Time since this notification last interrupted (visibly or audible) the user
+    NOTIFICATION_SINCE_INTERRUPTION_MILLIS = 1500;
+
+    // OPEN: Notification interrupted the user, either audibly or visually.
+    //   Tagged data: NOTIFICATION_SINCE_INTERRUPTION_MILLIS
+    // CATEGORY: NOTIFICATION
+    NOTIFICATION_INTERRUPTION = 1501;
+
+    // OPEN: Settings
+    // CATEGORY: SETTINGS
+    // OS: Q
+    SETTINGS_HOMEPAGE = 1502;
+
+    // OPEN: Settings > Create shortcut(widget)
+    // CATEGORY: SETTINGS
+    // OS: Q
+    SETTINGS_CREATE_SHORTCUT = 1503;
+
+    // ACTION: Authenticate using fingerprint
+    // CATEGORY: SETTINGS
+    // OS: Q
+    ACTION_FACE_AUTH = 1504;
+
+    // ACTION: Add fingerprint > Enroll fingerprint
+    // CATEGORY: SETTINGS
+    // OS: Q
+    ACTION_FACE_ENROLL = 1505;
+
+    // OPEN: Face Enroll introduction
+    // CATEGORY: SETTINGS
+    // OS: Q
+    FACE_ENROLL_INTRO = 1506;
+
+    // OPEN: Face Enroll introduction
+    // CATEGORY: SETTINGS
+    // OS: Q
+    FACE_ENROLL_ENROLLING = 1507;
+
+    // OPEN: Face Enroll introduction
+    // CATEGORY: SETTINGS
+    // OS: Q
+    FACE_ENROLL_FINISHED = 1508;
+
+    // OPEN: Face Enroll sidecar
+    // CATEGORY: SETTINGS
+    // OS: Q
+    FACE_ENROLL_SIDECAR = 1509;
+
+    // OPEN: Settings > Add face > Error dialog
+    // OS: Q
+    DIALOG_FACE_ERROR = 1510;
+
+    // OPEN: Settings > Security > Face
+    // CATEGORY: SETTINGS
+    // OS: Q
+    FACE = 1511;
+
+    // OPEN: Settings > Acessibility > HearingAid pairing instructions dialog
+    // CATEGORY: SETTINGS
+    // OS: Q
+    DIALOG_ACCESSIBILITY_HEARINGAID = 1512;
+
+    // ACTION: Activity start
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    ACTION_ACTIVITY_START = 1513;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Calling UID
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_CALLING_UID = 1514;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Calling package name
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_CALLING_PACKAGE_NAME = 1515;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Calling UID proc state
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_CALLING_UID_PROC_STATE = 1516;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Calling UID has any visible window
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_CALLING_UID_HAS_ANY_VISIBLE_WINDOW = 1517;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Real calling UID
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_REAL_CALLING_UID = 1518;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Real calling UID proc state
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_REAL_CALLING_UID_PROC_STATE = 1519;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Real calling UID has any visible window
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_REAL_CALLING_UID_HAS_ANY_VISIBLE_WINDOW = 1520;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Target UID
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_TARGET_UID = 1521;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Target UID package name
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_TARGET_PACKAGE_NAME = 1522;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Target UID proc state
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_TARGET_UID_PROC_STATE = 1523;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Target UID has any visible window
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_TARGET_UID_HAS_ANY_VISIBLE_WINDOW = 1524;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Target doze whitelist tag
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_TARGET_WHITELIST_TAG = 1525;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Target short component name
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_TARGET_SHORT_COMPONENT_NAME = 1526;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Coming from pending intent
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_COMING_FROM_PENDING_INTENT = 1527;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Intent action
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_INTENT_ACTION = 1528;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Caller app process record process name
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_PROCESS_NAME = 1529;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Caller app process record current proc state
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_CUR_PROC_STATE = 1530;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Caller app process record has client activities
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_HAS_CLIENT_ACTIVITIES = 1531;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Caller app process record has foreground services
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_HAS_FOREGROUND_SERVICES = 1532;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Caller app process record has foreground activities
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_HAS_FOREGROUND_ACTIVITIES = 1533;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Caller app process record has top UI
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_HAS_TOP_UI = 1534;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Caller app process record has overlay UI
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_HAS_OVERLAY_UI = 1535;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Caller app process record pending UI clean
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_PENDING_UI_CLEAN = 1536;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Millis since caller app's process record last interaction event
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_MILLIS_SINCE_LAST_INTERACTION_EVENT = 1537;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Millis since caller app's process record fg interaction
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_MILLIS_SINCE_FG_INTERACTION = 1538;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Millis since caller app's process record last became unimportant
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_PROCESS_RECORD_MILLIS_SINCE_UNIMPORTANT = 1539;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record launch mode
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_LAUNCH_MODE = 1540;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record target activity
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_TARGET_ACTIVITY = 1541;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record flags
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_FLAGS = 1542;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record real activity
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_REAL_ACTIVITY = 1543;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record short component name
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_SHORT_COMPONENT_NAME = 1544;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record process name
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_PROCESS_NAME = 1545;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record is fullscreen
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_IS_FULLSCREEN = 1546;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record is no display
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_IS_NO_DISPLAY = 1547;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Millis since activity was last visible
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_MILLIS_SINCE_LAST_VISIBLE = 1548;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record's resultTo packageName
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_RESULT_TO_PKG_NAME = 1549;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record's resultTo shortComponentName
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_RESULT_TO_SHORT_COMPONENT_NAME = 1550;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record is visible
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_IS_VISIBLE = 1551;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Activity record is visible ignoring keyguard
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_IS_VISIBLE_IGNORING_KEYGUARD = 1552;
+
+    // Tagged data for ACTION_ACTIVITY_START.
+    // FIELD: Millis since activity's last launch
+    // CATEGORY: OTHER
+    // OS: Q (will also ship in PQ1A)
+    FIELD_ACTIVITY_RECORD_MILLIS_SINCE_LAST_LAUNCH = 1553;
+
+    // ---- End Q Constants, all Q constants go above this line ----
+
     // Add new aosp constants above this line.
     // END OF AOSP CONSTANTS
   }
diff --git a/proto/src/system_messages.proto b/proto/src/system_messages.proto
index a9a14cad7f7..fba639c3fc4 100644
--- a/proto/src/system_messages.proto
+++ b/proto/src/system_messages.proto
@@ -212,6 +212,10 @@ message SystemMessage {
     // Package: android
     NOTE_AUTO_SAVER_SUGGESTION = 49;
 
+    // Notify the user that their softap config preference has changed.
+    // Package: android
+    NOTE_SOFTAP_CONFIG_CHANGED = 50;
+
     // ADD_NEW_IDS_ABOVE_THIS_LINE
     // Legacy IDs with arbitrary values appear below
     // Legacy IDs existed as stable non-conflicting constants prior to the O release
diff --git a/proto/src/wifi.proto b/proto/src/wifi.proto
index 72f11e0a63c..b29c992120d 100644
--- a/proto/src/wifi.proto
+++ b/proto/src/wifi.proto
@@ -457,6 +457,11 @@ message WifiLog {
   // Identifier for experimental scoring parameter settings.
   optional string score_experiment_id = 117;
 
+  // Histogram of the EAP method type of all installed Passpoint profiles
+  repeated PasspointProfileTypeCount installed_passpoint_profile_type = 123;
+
+  // Hardware revision (EVT, DVT, PVT etc.)
+  optional string hardware_revision = 124;
 }
 
 // Information that gets logged for every WiFi connection.
@@ -1503,3 +1508,31 @@ message WifiRttLog {
     optional int32 count = 2;
   }
 }
+
+message PasspointProfileTypeCount {
+  enum EapMethod {
+    // Unknown Type
+    TYPE_UNKNOWN = 0;
+
+    // EAP_TLS (13)
+    TYPE_EAP_TLS = 1;
+
+    // EAP_TTLS (21)
+    TYPE_EAP_TTLS = 2;
+
+    // EAP_SIM (18)
+    TYPE_EAP_SIM = 3;
+
+    // EAP_AKA (23)
+    TYPE_EAP_AKA = 4;
+
+    // EAP_AKA_PRIME (50)
+    TYPE_EAP_AKA_PRIME = 5;
+  }
+
+  // Eap method type set in Passpoint profile
+  optional EapMethod eap_method_type = 1;
+
+  // Num of installed Passpoint profile with same eap method
+  optional int32 count = 2;
+}
diff --git a/services/appwidget/java/com/android/server/appwidget/AppWidgetService.java b/services/appwidget/java/com/android/server/appwidget/AppWidgetService.java
index c9c7adc4569..f69b6387a60 100644
--- a/services/appwidget/java/com/android/server/appwidget/AppWidgetService.java
+++ b/services/appwidget/java/com/android/server/appwidget/AppWidgetService.java
@@ -47,11 +47,6 @@ public class AppWidgetService extends SystemService {
         }
     }
 
-    @Override
-    public void onUnlockUser(int userHandle) {
-        FgThread.getHandler().post(() -> mImpl.onUserUnlocked(userHandle));
-    }
-
     @Override
     public void onStopUser(int userHandle) {
         mImpl.onUserStopped(userHandle);
diff --git a/services/appwidget/java/com/android/server/appwidget/AppWidgetServiceImpl.java b/services/appwidget/java/com/android/server/appwidget/AppWidgetServiceImpl.java
index db8ad12cfdf..b71d7a726b2 100644
--- a/services/appwidget/java/com/android/server/appwidget/AppWidgetServiceImpl.java
+++ b/services/appwidget/java/com/android/server/appwidget/AppWidgetServiceImpl.java
@@ -19,7 +19,6 @@ package com.android.server.appwidget;
 import static android.content.Context.KEYGUARD_SERVICE;
 import static android.content.Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS;
 import static android.content.Intent.FLAG_ACTIVITY_NEW_TASK;
-
 import static com.android.server.pm.PackageManagerService.PLATFORM_PACKAGE_NAME;
 
 import android.annotation.UserIdInt;
@@ -2697,7 +2696,12 @@ class AppWidgetServiceImpl extends IAppWidgetService.Stub implements WidgetBacku
         }
     }
 
-    void onUserUnlocked(int userId) {
+    /**
+     * This does not use the usual onUserUnlocked() listener mechanism because it is
+     * invoked at a choreographed point in the middle of the user unlock sequence,
+     * before the boot-completed broadcast is issued and the listeners notified.
+     */
+    void handleUserUnlocked(int userId) {
         if (isProfileWithLockedParent(userId)) {
             return;
         }
@@ -2734,7 +2738,7 @@ class AppWidgetServiceImpl extends IAppWidgetService.Stub implements WidgetBacku
                 }
             }
         }
-        Slog.i(TAG, "Async processing of onUserUnlocked u" + userId + " took "
+        Slog.i(TAG, "Processing of handleUserUnlocked u" + userId + " took "
                 + (SystemClock.elapsedRealtime() - time) + " ms");
     }
 
@@ -4801,5 +4805,11 @@ class AppWidgetServiceImpl extends IAppWidgetService.Stub implements WidgetBacku
                 return widgetPackages;
             }
         }
+
+        @Override
+        public void unlockUser(int userId) {
+            handleUserUnlocked(userId);
+        }
+
     }
 }
diff --git a/services/autofill/java/com/android/server/autofill/ui/SaveUi.java b/services/autofill/java/com/android/server/autofill/ui/SaveUi.java
index dc84498353e..58823036212 100644
--- a/services/autofill/java/com/android/server/autofill/ui/SaveUi.java
+++ b/services/autofill/java/com/android/server/autofill/ui/SaveUi.java
@@ -81,6 +81,13 @@ final class SaveUi {
         void onDestroy();
     }
 
+    /**
+     * Wrapper that guarantees that only one callback is triggered by ignoring further calls after
+     * it's destroyed.
+     *
+     * <p>It's needed becase {@link #onCancel(IntentSender)} is always called when the Save UI
+     * dialog is dismissed.
+     */
     private class OneTimeListener implements OnSaveListener {
 
         private final OnSaveListener mRealListener;
@@ -96,7 +103,6 @@ final class SaveUi {
             if (mDone) {
                 return;
             }
-            mDone = true;
             mRealListener.onSave();
         }
 
@@ -106,7 +112,6 @@ final class SaveUi {
             if (mDone) {
                 return;
             }
-            mDone = true;
             mRealListener.onCancel(listener);
         }
 
diff --git a/services/core/java/com/android/server/BatteryService.java b/services/core/java/com/android/server/BatteryService.java
index c4824de2d46..95fbee99f8b 100644
--- a/services/core/java/com/android/server/BatteryService.java
+++ b/services/core/java/com/android/server/BatteryService.java
@@ -640,7 +640,7 @@ public final class BatteryService extends SystemService {
             // them will get the new sequence number at that point.  (See for example how testing
             // of JobScheduler's BatteryController works.)
             sendBatteryChangedIntentLocked();
-            if (mLastBatteryLevel != mHealthInfo.batteryLevel) {
+            if (mLastBatteryLevel != mHealthInfo.batteryLevel || mLastPlugType != mPlugType) {
                 sendBatteryLevelChangedIntentLocked();
             }
 
diff --git a/services/core/java/com/android/server/ConnectivityService.java b/services/core/java/com/android/server/ConnectivityService.java
index c995c1e90fd..6ef1c1421b4 100644
--- a/services/core/java/com/android/server/ConnectivityService.java
+++ b/services/core/java/com/android/server/ConnectivityService.java
@@ -925,6 +925,10 @@ public class ConnectivityService extends IConnectivityManager.Stub
             public boolean isTetheringSupported() {
                 return ConnectivityService.this.isTetheringSupported();
             }
+            @Override
+            public NetworkRequest getDefaultNetworkRequest() {
+                return mDefaultRequest;
+            }
         };
         return new Tethering(mContext, mNetd, mStatsService, mPolicyManager,
                 IoThread.get().getLooper(), new MockableSystemProperties(),
@@ -942,7 +946,7 @@ public class ConnectivityService extends IConnectivityManager.Stub
 
     private NetworkRequest createDefaultInternetRequestForTransport(
             int transportType, NetworkRequest.Type type) {
-        NetworkCapabilities netCap = new NetworkCapabilities();
+        final NetworkCapabilities netCap = new NetworkCapabilities();
         netCap.addCapability(NET_CAPABILITY_INTERNET);
         netCap.addCapability(NET_CAPABILITY_NOT_RESTRICTED);
         if (transportType > -1) {
@@ -2250,6 +2254,7 @@ public class ConnectivityService extends IConnectivityManager.Stub
                         updateCapabilities(oldScore, nai, nai.networkCapabilities);
                         // If score has changed, rebroadcast to NetworkFactories. b/17726566
                         if (oldScore != nai.getCurrentScore()) sendUpdatedScoreToFactories(nai);
+                        if (valid) handleFreshlyValidatedNetwork(nai);
                     }
                     updateInetCondition(nai);
                     // Let the NetworkAgent know the state of its network
@@ -2344,6 +2349,16 @@ public class ConnectivityService extends IConnectivityManager.Stub
                 mDefaultRequest.networkCapabilities, nai.networkCapabilities);
     }
 
+    private void handleFreshlyValidatedNetwork(NetworkAgentInfo nai) {
+        if (nai == null) return;
+        // If the Private DNS mode is opportunistic, reprogram the DNS servers
+        // in order to restart a validation pass from within netd.
+        final PrivateDnsConfig cfg = mDnsManager.getPrivateDnsConfig();
+        if (cfg.useTls && TextUtils.isEmpty(cfg.hostname)) {
+            updateDnses(nai.linkProperties, null, nai.network.netId);
+        }
+    }
+
     private void handlePrivateDnsSettingsChanged() {
         final PrivateDnsConfig cfg = mDnsManager.getPrivateDnsConfig();
 
diff --git a/services/core/java/com/android/server/PinnerService.java b/services/core/java/com/android/server/PinnerService.java
index 5a25f48c38e..0deaee7f787 100644
--- a/services/core/java/com/android/server/PinnerService.java
+++ b/services/core/java/com/android/server/PinnerService.java
@@ -16,8 +16,16 @@
 
 package com.android.server;
 
+import static android.app.ActivityManager.UID_OBSERVER_ACTIVE;
+import static android.app.ActivityManager.UID_OBSERVER_GONE;
+
+import android.annotation.IntDef;
 import android.annotation.Nullable;
 
+import android.app.ActivityManager;
+import android.app.ActivityManagerInternal;
+import android.app.IActivityManager;
+import android.app.IUidObserver;
 import android.content.BroadcastReceiver;
 import android.content.Context;
 import android.content.Intent;
@@ -26,24 +34,30 @@ import android.content.pm.ActivityInfo;
 import android.content.pm.ApplicationInfo;
 import android.content.pm.PackageManager;
 import android.content.pm.ResolveInfo;
+import android.database.ContentObserver;
 import android.net.Uri;
 import android.os.Binder;
 import android.os.Build;
 import android.os.Handler;
 import android.os.Looper;
 import android.os.Message;
+import android.os.RemoteException;
 import android.os.UserHandle;
+import android.os.UserManager;
 import android.provider.MediaStore;
+import android.provider.Settings;
 import android.system.ErrnoException;
 import android.system.Os;
 import android.system.OsConstants;
-import android.system.StructStat;
+import android.util.ArrayMap;
 import android.util.ArraySet;
 import android.util.Slog;
 
+import com.android.internal.annotations.GuardedBy;
 import com.android.internal.app.ResolverActivity;
 import com.android.internal.os.BackgroundThread;
 import com.android.internal.util.DumpUtils;
+import com.android.internal.util.function.pooled.PooledLambda;
 
 import dalvik.system.DexFile;
 import dalvik.system.VMRuntime;
@@ -53,12 +67,13 @@ import java.io.Closeable;
 import java.io.InputStream;
 import java.io.DataInputStream;
 import java.io.IOException;
-import java.io.EOFException;
 import java.io.PrintWriter;
+import java.lang.annotation.Retention;
+import java.lang.annotation.RetentionPolicy;
+import java.util.List;
 import java.util.ArrayList;
 
 import java.util.zip.ZipFile;
-import java.util.zip.ZipException;
 import java.util.zip.ZipEntry;
 
 /**
@@ -70,16 +85,51 @@ import java.util.zip.ZipEntry;
 public final class PinnerService extends SystemService {
     private static final boolean DEBUG = false;
     private static final String TAG = "PinnerService";
-    private static final int MAX_CAMERA_PIN_SIZE = 80 * (1 << 20); //80MB max
+
     private static final String PIN_META_FILENAME = "pinlist.meta";
     private static final int PAGE_SIZE = (int) Os.sysconf(OsConstants._SC_PAGESIZE);
+    private static final int MATCH_FLAGS = PackageManager.MATCH_DEFAULT_ONLY
+            | PackageManager.MATCH_DIRECT_BOOT_AWARE
+            | PackageManager.MATCH_DIRECT_BOOT_UNAWARE;
+
+    private static final int KEY_CAMERA = 0;
+    private static final int KEY_HOME = 1;
+
+    private static final int MAX_CAMERA_PIN_SIZE = 80 * (1 << 20); // 80MB max for camera app.
+    private static final int MAX_HOME_PIN_SIZE = 6 * (1 << 20); // 6MB max for home app.
+
+    @IntDef({KEY_CAMERA, KEY_HOME})
+    @Retention(RetentionPolicy.SOURCE)
+    public @interface AppKey {}
 
     private final Context mContext;
-    private final boolean mShouldPinCamera;
+    private final ActivityManagerInternal mAmInternal;
+    private final IActivityManager mAm;
+    private final UserManager mUserManager;
 
-    /* These lists protected by PinnerService monitor lock */
-    private final ArrayList<PinnedFile> mPinnedFiles = new ArrayList<PinnedFile>();
-    private final ArrayList<PinnedFile> mPinnedCameraFiles = new ArrayList<PinnedFile>();
+    /** The list of the statically pinned files. */
+    @GuardedBy("this")
+    private final ArrayList<PinnedFile> mPinnedFiles = new ArrayList<>();
+
+    /** The list of the pinned apps. This is a map from {@link AppKey} to a pinned app. */
+    @GuardedBy("this")
+    private final ArrayMap<Integer, PinnedApp> mPinnedApps = new ArrayMap<>();
+
+    /**
+     * The list of the pinned apps that need to be repinned as soon as the all processes of a given
+     * uid are no longer active. Note that with background dex opt, the new dex/vdex files are only
+     * loaded into the processes once it restarts. So in case background dex opt recompiled these
+     * files, we still need to keep the old ones pinned until the processes restart.
+     * <p>
+     * This is a map from uid to {@link AppKey}
+     */
+    @GuardedBy("this")
+    private final ArrayMap<Integer, Integer> mPendingRepin = new ArrayMap<>();
+
+    /**
+     * A set of {@link AppKey} that are configured to be pinned.
+     */
+    private final ArraySet<Integer> mPinKeys = new ArraySet<>();
 
     private BinderService mBinderService;
     private PinnerHandler mPinnerHandler = null;
@@ -87,13 +137,13 @@ public final class PinnerService extends SystemService {
     private final BroadcastReceiver mBroadcastReceiver = new BroadcastReceiver() {
         @Override
         public void onReceive(Context context, Intent intent) {
-          // If this user's camera app has been updated, update pinned files accordingly.
-          if (intent.getAction() == Intent.ACTION_PACKAGE_REPLACED) {
+          // If an app has updated, update pinned files accordingly.
+          if (Intent.ACTION_PACKAGE_REPLACED.equals(intent.getAction())) {
                 Uri packageUri = intent.getData();
                 String packageName = packageUri.getSchemeSpecificPart();
                 ArraySet<String> updatedPackages = new ArraySet<>();
                 updatedPackages.add(packageName);
-                update(updatedPackages);
+                update(updatedPackages, true /* force */);
             }
         }
     };
@@ -102,14 +152,30 @@ public final class PinnerService extends SystemService {
         super(context);
 
         mContext = context;
-        mShouldPinCamera = context.getResources().getBoolean(
+        boolean shouldPinCamera = context.getResources().getBoolean(
                 com.android.internal.R.bool.config_pinnerCameraApp);
+        boolean shouldPinHome = context.getResources().getBoolean(
+                com.android.internal.R.bool.config_pinnerHomeApp);
+        if (shouldPinCamera) {
+            mPinKeys.add(KEY_CAMERA);
+        }
+        if (shouldPinHome) {
+            mPinKeys.add(KEY_HOME);
+        }
         mPinnerHandler = new PinnerHandler(BackgroundThread.get().getLooper());
 
+        mAmInternal = LocalServices.getService(ActivityManagerInternal.class);
+        mAm = ActivityManager.getService();
+
+        mUserManager = mContext.getSystemService(UserManager.class);
+
         IntentFilter filter = new IntentFilter();
         filter.addAction(Intent.ACTION_PACKAGE_REPLACED);
         filter.addDataScheme("package");
         mContext.registerReceiver(mBroadcastReceiver, filter);
+
+        registerUidListener();
+        registerUserSetupCompleteListener();
     }
 
     @Override
@@ -122,32 +188,43 @@ public final class PinnerService extends SystemService {
         publishLocalService(PinnerService.class, this);
 
         mPinnerHandler.obtainMessage(PinnerHandler.PIN_ONSTART_MSG).sendToTarget();
-        mPinnerHandler.obtainMessage(PinnerHandler.PIN_CAMERA_MSG, UserHandle.USER_SYSTEM, 0)
-                .sendToTarget();
+        sendPinAppsMessage(UserHandle.USER_SYSTEM);
     }
 
     /**
-     * Pin camera on user switch.
-     * If more than one user is using the device
-     * each user may set a different preference for the camera app.
-     * Make sure that user's preference is pinned into memory.
+     * Repin apps on user switch.
+     * <p>
+     * If more than one user is using the device each user may set a different preference for the
+     * individual apps. Make sure that user's preference is pinned into memory.
      */
     @Override
     public void onSwitchUser(int userHandle) {
-        mPinnerHandler.obtainMessage(PinnerHandler.PIN_CAMERA_MSG, userHandle, 0).sendToTarget();
+        if (!mUserManager.isManagedProfile(userHandle)) {
+            sendPinAppsMessage(userHandle);
+        }
+    }
+
+    @Override
+    public void onUnlockUser(int userHandle) {
+        if (!mUserManager.isManagedProfile(userHandle)) {
+            sendPinAppsMessage(userHandle);
+        }
     }
 
     /**
      * Update the currently pinned files.
-     * Specifically, this only updates camera pinning.
+     * Specifically, this only updates pinning for the apps that need to be pinned.
      * The other files pinned in onStart will not need to be updated.
      */
-    public void update(ArraySet<String> updatedPackages) {
-        ApplicationInfo cameraInfo = getCameraInfo(UserHandle.USER_SYSTEM);
-        if (cameraInfo != null && updatedPackages.contains(cameraInfo.packageName)) {
-            Slog.i(TAG, "Updating pinned files.");
-            mPinnerHandler.obtainMessage(PinnerHandler.PIN_CAMERA_MSG, UserHandle.USER_SYSTEM, 0)
-                    .sendToTarget();
+    public void update(ArraySet<String> updatedPackages, boolean force) {
+        int currentUser = ActivityManager.getCurrentUser();
+        for (int i = mPinKeys.size() - 1; i >= 0; i--) {
+            int key = mPinKeys.valueAt(i);
+            ApplicationInfo info = getInfoForKey(key, currentUser);
+            if (info != null && updatedPackages.contains(info.packageName)) {
+                Slog.i(TAG, "Updating pinned files for " + info.packageName + " force=" + force);
+                sendPinAppMessage(key, currentUser, force);
+            }
         }
     }
 
@@ -175,24 +252,99 @@ public final class PinnerService extends SystemService {
     }
 
     /**
-     * Handler for camera pinning message
+     * Registers a listener to repin the home app when user setup is complete, as the home intent
+     * initially resolves to setup wizard, but once setup is complete, it will resolve to the
+     * regular home app.
      */
-    private void handlePinCamera(int userHandle) {
-        if (!mShouldPinCamera) return;
-        if (!pinCamera(userHandle)) {
-            if (DEBUG) {
-                Slog.v(TAG, "Failed to pin camera.");
+    private void registerUserSetupCompleteListener() {
+        Uri userSetupCompleteUri = Settings.Secure.getUriFor(
+                Settings.Secure.USER_SETUP_COMPLETE);
+        mContext.getContentResolver().registerContentObserver(userSetupCompleteUri,
+                false, new ContentObserver(null) {
+                    @Override
+                    public void onChange(boolean selfChange, Uri uri) {
+                        if (userSetupCompleteUri.equals(uri)) {
+                            sendPinAppMessage(KEY_HOME, ActivityManager.getCurrentUser(),
+                                    true /* force */);
+                        }
+                    }
+                }, UserHandle.USER_ALL);
+    }
+
+    private void registerUidListener() {
+        try {
+            mAm.registerUidObserver(new IUidObserver.Stub() {
+                @Override
+                public void onUidGone(int uid, boolean disabled) throws RemoteException {
+                    mPinnerHandler.sendMessage(PooledLambda.obtainMessage(
+                            PinnerService::handleUidGone, PinnerService.this, uid));
+                }
+
+                @Override
+                public void onUidActive(int uid) throws RemoteException {
+                    mPinnerHandler.sendMessage(PooledLambda.obtainMessage(
+                            PinnerService::handleUidActive, PinnerService.this, uid));
+                }
+
+                @Override
+                public void onUidIdle(int uid, boolean disabled) throws RemoteException {
+                }
+
+                @Override
+                public void onUidStateChanged(int uid, int procState, long procStateSeq)
+                        throws RemoteException {
+                }
+
+                @Override
+                public void onUidCachedChanged(int uid, boolean cached) throws RemoteException {
+                }
+            }, UID_OBSERVER_GONE | UID_OBSERVER_ACTIVE, 0, "system");
+        } catch (RemoteException e) {
+            Slog.e(TAG, "Failed to register uid observer", e);
+        }
+    }
+
+    private void handleUidGone(int uid) {
+        updateActiveState(uid, false /* active */);
+        int key;
+        synchronized (this) {
+
+            // In case we have a pending repin, repin now. See mPendingRepin for more information.
+            key = mPendingRepin.getOrDefault(uid, -1);
+            if (key == -1) {
+                return;
             }
+            mPendingRepin.remove(uid);
         }
+        pinApp(key, ActivityManager.getCurrentUser(), false /* force */);
+    }
+
+    private void handleUidActive(int uid) {
+        updateActiveState(uid, true /* active */);
     }
 
-    private void unpinCameraApp() {
-        ArrayList<PinnedFile> pinnedCameraFiles;
+    private void updateActiveState(int uid, boolean active) {
         synchronized (this) {
-            pinnedCameraFiles = new ArrayList<>(mPinnedCameraFiles);
-            mPinnedCameraFiles.clear();
+            for (int i = mPinnedApps.size() - 1; i >= 0; i--) {
+                PinnedApp app = mPinnedApps.valueAt(i);
+                if (app.uid == uid) {
+                    app.active = active;
+                }
+            }
+        }
+    }
+
+    private void unpinApp(@AppKey int key) {
+        ArrayList<PinnedFile> pinnedAppFiles;
+        synchronized (this) {
+            PinnedApp app = mPinnedApps.get(key);
+            if (app == null) {
+                return;
+            }
+            mPinnedApps.remove(key);
+            pinnedAppFiles = new ArrayList<>(app.mFiles);
         }
-        for (PinnedFile pinnedFile : pinnedCameraFiles) {
+        for (PinnedFile pinnedFile : pinnedAppFiles) {
             pinnedFile.close();
         }
     }
@@ -202,68 +354,216 @@ public final class PinnerService extends SystemService {
     }
 
     private ApplicationInfo getCameraInfo(int userHandle) {
-        //  find the camera via an intent
-        //  use INTENT_ACTION_STILL_IMAGE_CAMERA instead of _SECURE.  On a
-        //  device without a fbe enabled, the _SECURE intent will never get set.
         Intent cameraIntent = new Intent(MediaStore.INTENT_ACTION_STILL_IMAGE_CAMERA);
-        PackageManager pm = mContext.getPackageManager();
-        ResolveInfo cameraResolveInfo = pm.resolveActivityAsUser(cameraIntent,
-                PackageManager.MATCH_DEFAULT_ONLY | PackageManager.MATCH_DIRECT_BOOT_AWARE
-                        | PackageManager.MATCH_DIRECT_BOOT_UNAWARE,
-                userHandle);
-        if (cameraResolveInfo == null ) {
-            //this is not necessarily an error
-            if (DEBUG) {
-              Slog.v(TAG, "Unable to resolve camera intent");
-            }
+        ApplicationInfo info = getApplicationInfoForIntent(cameraIntent, userHandle,
+            false /* defaultToSystemApp */);
+
+        // If the STILL_IMAGE_CAMERA intent doesn't resolve, try the _SECURE intent.
+        // We don't use _SECURE first because it will never get set on a device
+        // without File-based Encryption. But if the user has only set the intent
+        // before unlocking their device, we may still be able to identify their
+        // preference using this intent.
+        if (info == null) {
+            cameraIntent = new Intent(MediaStore.INTENT_ACTION_STILL_IMAGE_CAMERA_SECURE);
+            info = getApplicationInfoForIntent(cameraIntent, userHandle,
+                false /* defaultToSystemApp */);
+        }
+
+        // If the _SECURE intent doesn't resolve, try the original intent but request
+        // the system app for camera if there was more than one result.
+        if (info == null) {
+            cameraIntent = new Intent(MediaStore.INTENT_ACTION_STILL_IMAGE_CAMERA);
+            info = getApplicationInfoForIntent(cameraIntent, userHandle,
+                true /* defaultToSystemApp */);
+        }
+        return info;
+    }
+
+    private ApplicationInfo getHomeInfo(int userHandle) {
+        Intent intent = mAmInternal.getHomeIntent();
+        return getApplicationInfoForIntent(intent, userHandle, false);
+    }
+
+    private ApplicationInfo getApplicationInfoForIntent(Intent intent, int userHandle,
+            boolean defaultToSystemApp) {
+        if (intent == null) {
             return null;
         }
 
-        if (isResolverActivity(cameraResolveInfo.activityInfo))
-        {
-            if (DEBUG) {
-              Slog.v(TAG, "cameraIntent returned resolverActivity");
-            }
+        ResolveInfo resolveInfo = mContext.getPackageManager().resolveActivityAsUser(intent,
+                MATCH_FLAGS, userHandle);
+
+        // If this intent can resolve to only one app, choose that one.
+        // Otherwise, if we've requested to default to the system app, return it;
+        // if we have not requested that default, return null if there's more than one option.
+        // If there's more than one system app, return null since we don't know which to pick.
+        if (resolveInfo == null) {
             return null;
         }
 
-        return cameraResolveInfo.activityInfo.applicationInfo;
+        if (!isResolverActivity(resolveInfo.activityInfo)) {
+            return resolveInfo.activityInfo.applicationInfo;
+        }
+
+        if (defaultToSystemApp) {
+            List<ResolveInfo> infoList = mContext.getPackageManager()
+                .queryIntentActivitiesAsUser(intent, MATCH_FLAGS, userHandle);
+            ApplicationInfo systemAppInfo = null;
+            for (ResolveInfo info : infoList) {
+                if ((info.activityInfo.applicationInfo.flags
+                      & ApplicationInfo.FLAG_SYSTEM) != 0) {
+                    if (systemAppInfo == null) {
+                        systemAppInfo = info.activityInfo.applicationInfo;
+                    } else {
+                        // If there's more than one system app, return null due to ambiguity.
+                        return null;
+                    }
+                }
+            }
+            return systemAppInfo;
+        }
+
+        return null;
+    }
+
+    private void sendPinAppsMessage(int userHandle) {
+        mPinnerHandler.sendMessage(PooledLambda.obtainMessage(PinnerService::pinApps, this,
+                userHandle));
+    }
+
+    private void pinApps(int userHandle) {
+        for (int i = mPinKeys.size() - 1; i >= 0; i--) {
+            int key = mPinKeys.valueAt(i);
+            pinApp(key, userHandle, true /* force */);
+        }
+    }
+
+    /**
+     * @see #pinApp(int, int, boolean)
+     */
+    private void sendPinAppMessage(int key, int userHandle, boolean force) {
+        mPinnerHandler.sendMessage(PooledLambda.obtainMessage(PinnerService::pinApp, this,
+                key, userHandle, force));
+    }
+
+    /**
+     * Pins an app of a specific type {@code key}.
+     *
+     * @param force If false, this will not repin the app if it's currently active. See
+     *              {@link #mPendingRepin}.
+     */
+    private void pinApp(int key, int userHandle, boolean force) {
+        int uid = getUidForKey(key);
+
+        // In case the app is currently active, don't repin until next process restart. See
+        // mPendingRepin for more information.
+        if (!force && uid != -1) {
+            synchronized (this) {
+                mPendingRepin.put(uid, key);
+            }
+            return;
+        }
+        unpinApp(key);
+        ApplicationInfo info = getInfoForKey(key, userHandle);
+        if (info != null) {
+            pinApp(key, info);
+        }
+    }
+
+    /**
+     * Checks whether the pinned package with {@code key} is active or not.
+
+     * @return The uid of the pinned app, or {@code -1} otherwise.
+     */
+    private int getUidForKey(@AppKey int key) {
+        synchronized (this) {
+            PinnedApp existing = mPinnedApps.get(key);
+            return existing != null && existing.active
+                    ? existing.uid
+                    : -1;
+        }
+    }
+
+    /**
+     * Retrieves the current application info for the given app type.
+     *
+     * @param key The app type to retrieve the info for.
+     * @param userHandle The user id of the current user.
+     */
+    private @Nullable ApplicationInfo getInfoForKey(@AppKey int key, int userHandle) {
+        switch (key) {
+            case KEY_CAMERA:
+                return getCameraInfo(userHandle);
+            case KEY_HOME:
+                return getHomeInfo(userHandle);
+            default:
+                return null;
+        }
+    }
+
+    /**
+     * @return The app type name for {@code key}.
+     */
+    private String getNameForKey(@AppKey int key) {
+        switch (key) {
+            case KEY_CAMERA:
+                return "Camera";
+            case KEY_HOME:
+                return "Home";
+            default:
+                return null;
+        }
+    }
+
+    /**
+     * @return The maximum amount of bytes to be pinned for an app of type {@code key}.
+     */
+    private int getSizeLimitForKey(@AppKey int key) {
+        switch (key) {
+            case KEY_CAMERA:
+                return MAX_CAMERA_PIN_SIZE;
+            case KEY_HOME:
+                return MAX_HOME_PIN_SIZE;
+            default:
+                return 0;
+        }
     }
 
     /**
-     * If the camera app is already pinned, unpin and repin it.
+     * Pins an application.
+     *
+     * @param key The key of the app to pin.
+     * @param appInfo The corresponding app info.
      */
-    private boolean pinCamera(int userHandle){
-        ApplicationInfo cameraInfo = getCameraInfo(userHandle);
-        if (cameraInfo == null) {
-            return false;
-        }
-
-        //unpin after checking that the camera intent has resolved
-        //this prevents us from thrashing when switching users with
-        //FBE enabled, because the intent won't resolve until the unlock
-        unpinCameraApp();
-
-        //pin APK
-        String camAPK = cameraInfo.sourceDir;
-        PinnedFile pf = pinFile(camAPK,
-                                MAX_CAMERA_PIN_SIZE,
-                                /*attemptPinIntrospection=*/true);
+    private void pinApp(@AppKey int key, @Nullable ApplicationInfo appInfo) {
+        if (appInfo == null) {
+            return;
+        }
+
+        PinnedApp pinnedApp = new PinnedApp(appInfo);
+        synchronized (this) {
+            mPinnedApps.put(key, pinnedApp);
+        }
+
+        // pin APK
+        int pinSizeLimit = getSizeLimitForKey(key);
+        String apk = appInfo.sourceDir;
+        PinnedFile pf = pinFile(apk, pinSizeLimit, /*attemptPinIntrospection=*/true);
         if (pf == null) {
-            Slog.e(TAG, "Failed to pin " + camAPK);
-            return false;
+            Slog.e(TAG, "Failed to pin " + apk);
+            return;
         }
         if (DEBUG) {
             Slog.i(TAG, "Pinned " + pf.fileName);
         }
         synchronized (this) {
-            mPinnedCameraFiles.add(pf);
+            pinnedApp.mFiles.add(pf);
         }
 
         // determine the ABI from either ApplicationInfo or Build
         String arch = "arm";
-        if (cameraInfo.primaryCpuAbi != null) {
-            if (VMRuntime.is64BitAbi(cameraInfo.primaryCpuAbi)) {
+        if (appInfo.primaryCpuAbi != null) {
+            if (VMRuntime.is64BitAbi(appInfo.primaryCpuAbi)) {
                 arch = arch + "64";
             }
         } else {
@@ -273,32 +573,29 @@ public final class PinnerService extends SystemService {
         }
 
         // get the path to the odex or oat file
-        String baseCodePath = cameraInfo.getBaseCodePath();
+        String baseCodePath = appInfo.getBaseCodePath();
         String[] files = null;
         try {
             files = DexFile.getDexFileOutputPaths(baseCodePath, arch);
         } catch (IOException ioe) {}
         if (files == null) {
-            return true;
+            return;
         }
 
         //not pinning the oat/odex is not a fatal error
         for (String file : files) {
-            pf = pinFile(file, MAX_CAMERA_PIN_SIZE, /*attemptPinIntrospection=*/false);
+            pf = pinFile(file, pinSizeLimit, /*attemptPinIntrospection=*/false);
             if (pf != null) {
                 synchronized (this) {
-                    mPinnedCameraFiles.add(pf);
+                    pinnedApp.mFiles.add(pf);
                 }
                 if (DEBUG) {
                     Slog.i(TAG, "Pinned " + pf.fileName);
                 }
             }
         }
-
-        return true;
     }
 
-
     /** mlock length bytes of fileToPin in memory
      *
      * If attemptPinIntrospection is true, then treat the file to pin as a zip file and
@@ -581,24 +878,38 @@ public final class PinnerService extends SystemService {
         }
     }
 
-    private synchronized ArrayList<PinnedFile> snapshotPinnedFiles() {
-        int nrPinnedFiles = mPinnedFiles.size() + mPinnedCameraFiles.size();
-        ArrayList<PinnedFile> pinnedFiles = new ArrayList<>(nrPinnedFiles);
-        pinnedFiles.addAll(mPinnedFiles);
-        pinnedFiles.addAll(mPinnedCameraFiles);
-        return pinnedFiles;
-    }
-
     private final class BinderService extends Binder {
         @Override
         protected void dump(FileDescriptor fd, PrintWriter pw, String[] args) {
             if (!DumpUtils.checkDumpPermission(mContext, TAG, pw)) return;
-            long totalSize = 0;
-            for (PinnedFile pinnedFile : snapshotPinnedFiles()) {
-                pw.format("%s %s\n", pinnedFile.fileName, pinnedFile.bytesPinned);
-                totalSize += pinnedFile.bytesPinned;
+            synchronized (PinnerService.this) {
+                long totalSize = 0;
+                for (PinnedFile pinnedFile : mPinnedFiles) {
+                    pw.format("%s %s\n", pinnedFile.fileName, pinnedFile.bytesPinned);
+                    totalSize += pinnedFile.bytesPinned;
+                }
+                pw.println();
+                for (int key : mPinnedApps.keySet()) {
+                    PinnedApp app = mPinnedApps.get(key);
+                    pw.print(getNameForKey(key));
+                    pw.print(" uid="); pw.print(app.uid);
+                    pw.print(" active="); pw.print(app.active);
+                    pw.println();
+                    for (PinnedFile pf : mPinnedApps.get(key).mFiles) {
+                        pw.print("  "); pw.format("%s %s\n", pf.fileName, pf.bytesPinned);
+                        totalSize += pf.bytesPinned;
+                    }
+                }
+                pw.format("Total size: %s\n", totalSize);
+                pw.println();
+                if (!mPendingRepin.isEmpty()) {
+                    pw.print("Pending repin: ");
+                    for (int key : mPendingRepin.values()) {
+                        pw.print(getNameForKey(key)); pw.print(' ');
+                    }
+                    pw.println();
+                }
             }
-            pw.format("Total size: %s\n", totalSize);
         }
     }
 
@@ -634,8 +945,30 @@ public final class PinnerService extends SystemService {
         int length;
     }
 
+    /**
+     * Represents an app that was pinned.
+     */
+    private final class PinnedApp {
+
+        /**
+         * The uid of the package being pinned. This stays constant while the package stays
+         * installed.
+         */
+        final int uid;
+
+        /** Whether it is currently active, i.e. there is a running process from that package. */
+        boolean active;
+
+        /** List of pinned files. */
+        final ArrayList<PinnedFile> mFiles = new ArrayList<>();
+
+        private PinnedApp(ApplicationInfo appInfo) {
+            uid = appInfo.uid;
+            active = mAmInternal.isUidActive(uid);
+        }
+    }
+
     final class PinnerHandler extends Handler {
-        static final int PIN_CAMERA_MSG  = 4000;
         static final int PIN_ONSTART_MSG = 4001;
 
         public PinnerHandler(Looper looper) {
@@ -645,13 +978,6 @@ public final class PinnerService extends SystemService {
         @Override
         public void handleMessage(Message msg) {
             switch (msg.what) {
-
-                case PIN_CAMERA_MSG:
-                {
-                    handlePinCamera(msg.arg1);
-                }
-                break;
-
                 case PIN_ONSTART_MSG:
                 {
                     handlePinOnStart();
diff --git a/services/core/java/com/android/server/TelephonyRegistry.java b/services/core/java/com/android/server/TelephonyRegistry.java
index 607db4efb63..ad9fa40e0ab 100644
--- a/services/core/java/com/android/server/TelephonyRegistry.java
+++ b/services/core/java/com/android/server/TelephonyRegistry.java
@@ -1588,10 +1588,10 @@ class TelephonyRegistry extends ITelephonyRegistry.Stub {
         // Wakeup apps for the (SUBSCRIPTION_)PHONE_STATE broadcast.
         intent.addFlags(Intent.FLAG_RECEIVER_INCLUDE_BACKGROUND);
 
+        // Create a version of the intent with the number always populated.
         Intent intentWithPhoneNumber = new Intent(intent);
-        if (!TextUtils.isEmpty(incomingNumber)) {
-            intentWithPhoneNumber.putExtra(TelephonyManager.EXTRA_INCOMING_NUMBER, incomingNumber);
-        }
+        intentWithPhoneNumber.putExtra(TelephonyManager.EXTRA_INCOMING_NUMBER, incomingNumber);
+
         // Send broadcast twice, once for apps that have PRIVILEGED permission and once for those
         // that have the runtime one
         mContext.sendBroadcastAsUser(intentWithPhoneNumber, UserHandle.ALL,
diff --git a/services/core/java/com/android/server/am/ActivityManagerConstants.java b/services/core/java/com/android/server/am/ActivityManagerConstants.java
index 91dad66a297..f891ed2b606 100644
--- a/services/core/java/com/android/server/am/ActivityManagerConstants.java
+++ b/services/core/java/com/android/server/am/ActivityManagerConstants.java
@@ -69,6 +69,7 @@ final class ActivityManagerConstants extends ContentObserver {
     static final String KEY_BOUND_SERVICE_CRASH_RESTART_DURATION = "service_crash_restart_duration";
     static final String KEY_BOUND_SERVICE_CRASH_MAX_RETRY = "service_crash_max_retry";
     static final String KEY_PROCESS_START_ASYNC = "process_start_async";
+    static final String KEY_TOP_TO_FGS_GRACE_DURATION = "top_to_fgs_grace_duration";
 
     private static final int DEFAULT_MAX_CACHED_PROCESSES =
             SystemProperties.getInt("ro.vendor.qti.sys.fw.bg_apps_limit", 32);
@@ -98,7 +99,7 @@ final class ActivityManagerConstants extends ContentObserver {
     private static final long DEFAULT_BOUND_SERVICE_CRASH_RESTART_DURATION = 30*60_000;
     private static final int DEFAULT_BOUND_SERVICE_CRASH_MAX_RETRY = 16;
     private static final boolean DEFAULT_PROCESS_START_ASYNC = true;
-
+    private static final long DEFAULT_TOP_TO_FGS_GRACE_DURATION = 15 * 1000;
 
     // Maximum number of cached processes we will allow.
     public int MAX_CACHED_PROCESSES = DEFAULT_MAX_CACHED_PROCESSES;
@@ -210,6 +211,14 @@ final class ActivityManagerConstants extends ContentObserver {
     // Indicates if the processes need to be started asynchronously.
     public boolean FLAG_PROCESS_START_ASYNC = DEFAULT_PROCESS_START_ASYNC;
 
+    // Allow app just moving from TOP to FOREGROUND_SERVICE to stay in a higher adj value for
+    // this long.
+    public long TOP_TO_FGS_GRACE_DURATION = DEFAULT_TOP_TO_FGS_GRACE_DURATION;
+
+    // Indicates whether the activity starts logging is enabled.
+    // Controlled by Settings.Global.ACTIVITY_STARTS_LOGGING_ENABLED
+    boolean mFlagActivityStartsLoggingEnabled;
+
     private final ActivityManagerService mService;
     private ContentResolver mResolver;
     private final KeyValueListParser mParser = new KeyValueListParser(',');
@@ -249,6 +258,12 @@ final class ActivityManagerConstants extends ContentObserver {
     // memory trimming.
     public int CUR_TRIM_CACHED_PROCESSES;
 
+    private static final Uri ACTIVITY_MANAGER_CONSTANTS_URI = Settings.Global.getUriFor(
+                Settings.Global.ACTIVITY_MANAGER_CONSTANTS);
+
+    private static final Uri ACTIVITY_STARTS_LOGGING_ENABLED_URI = Settings.Global.getUriFor(
+                Settings.Global.ACTIVITY_STARTS_LOGGING_ENABLED);
+
     public ActivityManagerConstants(ActivityManagerService service, Handler handler) {
         super(handler);
         mService = service;
@@ -257,9 +272,10 @@ final class ActivityManagerConstants extends ContentObserver {
 
     public void start(ContentResolver resolver) {
         mResolver = resolver;
-        mResolver.registerContentObserver(Settings.Global.getUriFor(
-                Settings.Global.ACTIVITY_MANAGER_CONSTANTS), false, this);
+        mResolver.registerContentObserver(ACTIVITY_MANAGER_CONSTANTS_URI, false, this);
+        mResolver.registerContentObserver(ACTIVITY_STARTS_LOGGING_ENABLED_URI, false, this);
         updateConstants();
+        updateActivityStartsLoggingEnabled();
     }
 
     public void setOverrideMaxCachedProcesses(int value) {
@@ -281,7 +297,12 @@ final class ActivityManagerConstants extends ContentObserver {
 
     @Override
     public void onChange(boolean selfChange, Uri uri) {
-        updateConstants();
+        if (uri == null) return;
+        if (ACTIVITY_MANAGER_CONSTANTS_URI.equals(uri)) {
+            updateConstants();
+        } else if (ACTIVITY_STARTS_LOGGING_ENABLED_URI.equals(uri)) {
+            updateActivityStartsLoggingEnabled();
+        }
     }
 
     private void updateConstants() {
@@ -350,11 +371,18 @@ final class ActivityManagerConstants extends ContentObserver {
                 DEFAULT_BOUND_SERVICE_CRASH_MAX_RETRY);
             FLAG_PROCESS_START_ASYNC = mParser.getBoolean(KEY_PROCESS_START_ASYNC,
                     DEFAULT_PROCESS_START_ASYNC);
+            TOP_TO_FGS_GRACE_DURATION = mParser.getDurationMillis(KEY_TOP_TO_FGS_GRACE_DURATION,
+                    DEFAULT_TOP_TO_FGS_GRACE_DURATION);
 
             updateMaxCachedProcesses();
         }
     }
 
+    private void updateActivityStartsLoggingEnabled() {
+        mFlagActivityStartsLoggingEnabled = Settings.Global.getInt(mResolver,
+                Settings.Global.ACTIVITY_STARTS_LOGGING_ENABLED, 0) == 1;
+    }
+
     private void updateMaxCachedProcesses() {
         CUR_MAX_CACHED_PROCESSES = mOverrideMaxCachedProcesses < 0
                 ? MAX_CACHED_PROCESSES : mOverrideMaxCachedProcesses;
@@ -421,6 +449,8 @@ final class ActivityManagerConstants extends ContentObserver {
         pw.println(MAX_SERVICE_INACTIVITY);
         pw.print("  "); pw.print(KEY_BG_START_TIMEOUT); pw.print("=");
         pw.println(BG_START_TIMEOUT);
+        pw.print("  "); pw.print(KEY_TOP_TO_FGS_GRACE_DURATION); pw.print("=");
+        pw.println(TOP_TO_FGS_GRACE_DURATION);
 
         pw.println();
         if (mOverrideMaxCachedProcesses >= 0) {
diff --git a/services/core/java/com/android/server/am/ActivityManagerService.java b/services/core/java/com/android/server/am/ActivityManagerService.java
index 3b18c8f8056..f31e614af1d 100644
--- a/services/core/java/com/android/server/am/ActivityManagerService.java
+++ b/services/core/java/com/android/server/am/ActivityManagerService.java
@@ -2225,6 +2225,9 @@ public class ActivityManagerService extends IActivityManager.Stub
                     }
                 }
                 callbacks.finishBroadcast();
+                // We have to clean up the RemoteCallbackList here, because otherwise it will
+                // needlessly hold the enclosed callbacks until the remote process dies.
+                callbacks.kill();
             } break;
             case UPDATE_TIME_ZONE: {
                 synchronized (ActivityManagerService.this) {
@@ -5667,7 +5670,7 @@ public class ActivityManagerService extends IActivityManager.Stub
         // TODO: Switch to user app stacks here.
         int ret = mActivityStartController.startActivities(caller, -1, callingPackage,
                 intents, resolvedTypes, resultTo, SafeActivityOptions.fromBundle(bOptions), userId,
-                reason);
+                reason, null /* originatingPendingIntent */);
         return ret;
     }
 
@@ -11141,6 +11144,20 @@ public class ActivityManagerService extends IActivityManager.Stub
         }
     }
 
+    /**
+     * @return whitelist tag for a uid from mPendingTempWhitelist, null if not currently on
+     * the whitelist
+     */
+    String getPendingTempWhitelistTagForUidLocked(int uid) {
+        final PendingTempWhitelist ptw = mPendingTempWhitelist.get(uid);
+        return ptw != null ? ptw.tag : null;
+    }
+
+    @VisibleForTesting
+    boolean isActivityStartsLoggingEnabled() {
+        return mConstants.mFlagActivityStartsLoggingEnabled;
+    }
+
     @Override
     public void moveStackToDisplay(int stackId, int displayId) {
         enforceCallingPermission(INTERNAL_SYSTEM_WINDOW, "moveStackToDisplay()");
@@ -23442,6 +23459,19 @@ public class ActivityManagerService extends IActivityManager.Stub
             }
         }
 
+        // If the app was recently in the foreground and moved to a foreground service status,
+        // allow it to get a higher rank in memory for some time, compared to other foreground
+        // services so that it can finish performing any persistence/processing of in-memory state.
+        if (app.foregroundServices && adj > ProcessList.PERCEPTIBLE_RECENT_FOREGROUND_APP_ADJ
+                && (app.lastTopTime + mConstants.TOP_TO_FGS_GRACE_DURATION > now
+                    || app.setProcState <= ActivityManager.PROCESS_STATE_TOP)) {
+            adj = ProcessList.PERCEPTIBLE_RECENT_FOREGROUND_APP_ADJ;
+            app.adjType = "fg-service-act";
+            if (DEBUG_OOM_ADJ_REASON || logUid == appUid) {
+                reportOomAdjMessageLocked(TAG_OOM_ADJ, "Raise to recent fg: " + app);
+            }
+        }
+
         if (adj > ProcessList.PERCEPTIBLE_APP_ADJ
                 || procState > ActivityManager.PROCESS_STATE_TRANSIENT_BACKGROUND) {
             if (app.forcingToImportant != null) {
@@ -23706,6 +23736,10 @@ public class ActivityManagerService extends IActivityManager.Stub
                                         schedGroup = ProcessList.SCHED_GROUP_DEFAULT;
                                         procState = ActivityManager.PROCESS_STATE_PERSISTENT;
                                     }
+                                } else if ((cr.flags & Context.BIND_ADJUST_BELOW_PERCEPTIBLE) != 0
+                                        && clientAdj < ProcessList.PERCEPTIBLE_APP_ADJ
+                                        && adj > ProcessList.PERCEPTIBLE_APP_ADJ + 1) {
+                                    newAdj = ProcessList.PERCEPTIBLE_APP_ADJ + 1;
                                 } else if ((cr.flags&Context.BIND_NOT_VISIBLE) != 0
                                         && clientAdj < ProcessList.PERCEPTIBLE_APP_ADJ
                                         && adj > ProcessList.PERCEPTIBLE_APP_ADJ) {
@@ -24676,6 +24710,8 @@ public class ActivityManagerService extends IActivityManager.Stub
             // Must be called before updating setProcState
             maybeUpdateUsageStatsLocked(app, nowElapsed);
 
+            maybeUpdateLastTopTime(app, now);
+
             app.setProcState = app.curProcState;
             if (app.setProcState >= ActivityManager.PROCESS_STATE_HOME) {
                 app.notCachedSinceIdle = false;
@@ -24900,6 +24936,13 @@ public class ActivityManagerService extends IActivityManager.Stub
         }
     }
 
+    private void maybeUpdateLastTopTime(ProcessRecord app, long nowUptime) {
+        if (app.setProcState <= ActivityManager.PROCESS_STATE_TOP
+                && app.curProcState > ActivityManager.PROCESS_STATE_TOP) {
+            app.lastTopTime = nowUptime;
+        }
+    }
+
     private final void setProcessTrackerStateLocked(ProcessRecord proc, int memFactor, long now) {
         if (proc.thread != null) {
             if (proc.baseProcessTracker != null) {
@@ -26636,7 +26679,7 @@ public class ActivityManagerService extends IActivityManager.Stub
                         packageUid, packageName,
                         intents, resolvedTypes, null /* resultTo */,
                         SafeActivityOptions.fromBundle(bOptions), userId,
-                        false /* validateIncomingUser */);
+                        false /* validateIncomingUser */, null /* originatingPendingIntent */);
             }
         }
 
@@ -26968,6 +27011,25 @@ public class ActivityManagerService extends IActivityManager.Stub
         public void enforceCallerIsRecentsOrHasPermission(String permission, String func) {
             ActivityManagerService.this.enforceCallerIsRecentsOrHasPermission(permission, func);
         }
+
+        @Override
+        public Intent getHomeIntent() {
+            synchronized (ActivityManagerService.this) {
+                return ActivityManagerService.this.getHomeIntent();
+            }
+        }
+
+        @Override
+        public void notifyDefaultDisplaySizeChanged() {
+            synchronized (ActivityManagerService.this) {
+                if (mSystemServiceManager.isBootCompleted() && mHomeProcess != null) {
+
+                    // TODO: Ugly hack to unblock the release
+                    Slog.i(TAG, "Killing home process because of display size change");
+                    removeProcessLocked(mHomeProcess, false, true, "kill home screen size");
+                }
+            }
+        }
     }
 
     /**
diff --git a/services/core/java/com/android/server/am/ActivityManagerShellCommand.java b/services/core/java/com/android/server/am/ActivityManagerShellCommand.java
index dc9a5adb5a0..093bd87813d 100644
--- a/services/core/java/com/android/server/am/ActivityManagerShellCommand.java
+++ b/services/core/java/com/android/server/am/ActivityManagerShellCommand.java
@@ -2844,6 +2844,7 @@ final class ActivityManagerShellCommand extends ShellCommand {
             pw.println("  --checkin: output checkin format, resetting data.");
             pw.println("  --C: output checkin format, not resetting data.");
             pw.println("  --proto: output dump in protocol buffer format.");
+            pw.println("  --autofill: dump just the autofill-related state of an activity");
         } else {
             pw.println("Activity manager (activity) commands:");
             pw.println("  help");
diff --git a/services/core/java/com/android/server/am/ActivityMetricsLogger.java b/services/core/java/com/android/server/am/ActivityMetricsLogger.java
index 47d0423550c..9ffa6627836 100644
--- a/services/core/java/com/android/server/am/ActivityMetricsLogger.java
+++ b/services/core/java/com/android/server/am/ActivityMetricsLogger.java
@@ -2,6 +2,7 @@ package com.android.server.am;
 
 import static android.app.ActivityManager.START_SUCCESS;
 import static android.app.ActivityManager.START_TASK_TO_FRONT;
+import static android.app.ActivityManager.processStateAmToProto;
 import static android.app.ActivityManagerInternal.APP_TRANSITION_TIMEOUT;
 import static android.app.WindowConfiguration.WINDOWING_MODE_SPLIT_SCREEN_PRIMARY;
 import static android.app.WindowConfiguration.WINDOWING_MODE_FREEFORM;
@@ -9,6 +10,7 @@ import static android.app.WindowConfiguration.WINDOWING_MODE_FULLSCREEN;
 import static android.app.WindowConfiguration.WINDOWING_MODE_PINNED;
 import static android.app.WindowConfiguration.WINDOWING_MODE_SPLIT_SCREEN_SECONDARY;
 import static android.app.WindowConfiguration.WINDOWING_MODE_UNDEFINED;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.ACTION_ACTIVITY_START;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.APP_TRANSITION;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.APP_TRANSITION_BIND_APPLICATION_DELAY_MS;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.APP_TRANSITION_CALLING_PACKAGE_NAME;
@@ -21,8 +23,48 @@ import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.APP_TR
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.APP_TRANSITION_REPORTED_DRAWN_MS;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.APP_TRANSITION_STARTING_WINDOW_DELAY_MS;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.APP_TRANSITION_WINDOWS_DRAWN_DELAY_MS;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_FLAGS;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_IS_FULLSCREEN;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_IS_NO_DISPLAY;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_IS_VISIBLE;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_IS_VISIBLE_IGNORING_KEYGUARD;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_MILLIS_SINCE_LAST_LAUNCH;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_MILLIS_SINCE_LAST_VISIBLE;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_LAUNCH_MODE;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_PROCESS_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_REAL_ACTIVITY;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_RESULT_TO_PKG_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_RESULT_TO_SHORT_COMPONENT_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_SHORT_COMPONENT_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_ACTIVITY_RECORD_TARGET_ACTIVITY;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_CALLING_PACKAGE_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_CALLING_UID;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_CALLING_UID_HAS_ANY_VISIBLE_WINDOW;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_CALLING_UID_PROC_STATE;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_CLASS_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_COMING_FROM_PENDING_INTENT;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_INSTANT_APP_LAUNCH_TOKEN;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_INTENT_ACTION;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_CUR_PROC_STATE;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_HAS_CLIENT_ACTIVITIES;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_HAS_FOREGROUND_ACTIVITIES;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_HAS_FOREGROUND_SERVICES;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_HAS_OVERLAY_UI;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_HAS_TOP_UI;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_MILLIS_SINCE_FG_INTERACTION;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_MILLIS_SINCE_LAST_INTERACTION_EVENT;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_MILLIS_SINCE_UNIMPORTANT;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_PENDING_UI_CLEAN;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_PROCESS_RECORD_PROCESS_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_REAL_CALLING_UID;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_REAL_CALLING_UID_PROC_STATE;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_REAL_CALLING_UID_HAS_ANY_VISIBLE_WINDOW;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_TARGET_PACKAGE_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_TARGET_SHORT_COMPONENT_NAME;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_TARGET_UID;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_TARGET_UID_HAS_ANY_VISIBLE_WINDOW;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_TARGET_UID_PROC_STATE;
+import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.FIELD_TARGET_WHITELIST_TAG;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.PACKAGE_OPTIMIZATION_COMPILATION_REASON;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.PACKAGE_OPTIMIZATION_COMPILATION_FILTER;
 import static com.android.internal.logging.nano.MetricsProto.MetricsEvent.TYPE_TRANSITION_COLD_LAUNCH;
@@ -37,6 +79,7 @@ import static com.android.server.am.MemoryStatUtil.MemoryStat;
 import static com.android.server.am.MemoryStatUtil.readMemoryStatFromFilesystem;
 
 import android.content.Context;
+import android.content.Intent;
 import android.content.pm.ApplicationInfo;
 import android.content.pm.dex.ArtManagerInternal;
 import android.content.pm.dex.PackageOptimizationInfo;
@@ -622,6 +665,95 @@ class ActivityMetricsLogger {
                 startupTimeMs);
     }
 
+    void logActivityStart(Intent intent, ProcessRecord callerApp, ActivityRecord r,
+            int callingUid, String callingPackage, int callingUidProcState,
+            boolean callingUidHasAnyVisibleWindow,
+            int realCallingUid, int realCallingUidProcState,
+            boolean realCallingUidHasAnyVisibleWindow,
+            int targetUid, String targetPackage, int targetUidProcState,
+            boolean targetUidHasAnyVisibleWindow, String targetWhitelistTag,
+            boolean comingFromPendingIntent) {
+
+        final long nowElapsed = SystemClock.elapsedRealtime();
+        final long nowUptime = SystemClock.uptimeMillis();
+        final LogMaker builder = new LogMaker(ACTION_ACTIVITY_START);
+        builder.setTimestamp(System.currentTimeMillis());
+        builder.addTaggedData(FIELD_CALLING_UID, callingUid);
+        builder.addTaggedData(FIELD_CALLING_PACKAGE_NAME, callingPackage);
+        builder.addTaggedData(FIELD_CALLING_UID_PROC_STATE,
+                processStateAmToProto(callingUidProcState));
+        builder.addTaggedData(FIELD_CALLING_UID_HAS_ANY_VISIBLE_WINDOW,
+                callingUidHasAnyVisibleWindow ? 1 : 0);
+        builder.addTaggedData(FIELD_REAL_CALLING_UID, realCallingUid);
+        builder.addTaggedData(FIELD_REAL_CALLING_UID_PROC_STATE,
+                processStateAmToProto(realCallingUidProcState));
+        builder.addTaggedData(FIELD_REAL_CALLING_UID_HAS_ANY_VISIBLE_WINDOW,
+                realCallingUidHasAnyVisibleWindow ? 1 : 0);
+        builder.addTaggedData(FIELD_TARGET_UID, targetUid);
+        builder.addTaggedData(FIELD_TARGET_PACKAGE_NAME, targetPackage);
+        builder.addTaggedData(FIELD_TARGET_UID_PROC_STATE,
+                processStateAmToProto(targetUidProcState));
+        builder.addTaggedData(FIELD_TARGET_UID_HAS_ANY_VISIBLE_WINDOW,
+                targetUidHasAnyVisibleWindow ? 1 : 0);
+        builder.addTaggedData(FIELD_TARGET_WHITELIST_TAG, targetWhitelistTag);
+        builder.addTaggedData(FIELD_TARGET_SHORT_COMPONENT_NAME, r.shortComponentName);
+        builder.addTaggedData(FIELD_COMING_FROM_PENDING_INTENT, comingFromPendingIntent ? 1 : 0);
+        builder.addTaggedData(FIELD_INTENT_ACTION, intent.getAction());
+        if (callerApp != null) {
+            builder.addTaggedData(FIELD_PROCESS_RECORD_PROCESS_NAME, callerApp.processName);
+            builder.addTaggedData(FIELD_PROCESS_RECORD_CUR_PROC_STATE,
+                    processStateAmToProto(callerApp.curProcState));
+            builder.addTaggedData(FIELD_PROCESS_RECORD_HAS_CLIENT_ACTIVITIES,
+                    callerApp.hasClientActivities ? 1 : 0);
+            builder.addTaggedData(FIELD_PROCESS_RECORD_HAS_FOREGROUND_SERVICES,
+                    callerApp.hasForegroundServices() ? 1 : 0);
+            builder.addTaggedData(FIELD_PROCESS_RECORD_HAS_FOREGROUND_ACTIVITIES,
+                    callerApp.foregroundActivities ? 1 : 0);
+            builder.addTaggedData(FIELD_PROCESS_RECORD_HAS_TOP_UI, callerApp.hasTopUi ? 1 : 0);
+            builder.addTaggedData(FIELD_PROCESS_RECORD_HAS_OVERLAY_UI,
+                    callerApp.hasOverlayUi ? 1 : 0);
+            builder.addTaggedData(FIELD_PROCESS_RECORD_PENDING_UI_CLEAN,
+                    callerApp.pendingUiClean ? 1 : 0);
+            if (callerApp.interactionEventTime != 0) {
+                builder.addTaggedData(FIELD_PROCESS_RECORD_MILLIS_SINCE_LAST_INTERACTION_EVENT,
+                        (nowElapsed - callerApp.interactionEventTime));
+            }
+            if (callerApp.fgInteractionTime != 0) {
+                builder.addTaggedData(FIELD_PROCESS_RECORD_MILLIS_SINCE_FG_INTERACTION,
+                        (nowElapsed - callerApp.fgInteractionTime));
+            }
+            if (callerApp.whenUnimportant != 0) {
+                builder.addTaggedData(FIELD_PROCESS_RECORD_MILLIS_SINCE_UNIMPORTANT,
+                        (nowUptime - callerApp.whenUnimportant));
+            }
+        }
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_LAUNCH_MODE, r.info.launchMode);
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_TARGET_ACTIVITY, r.info.targetActivity);
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_FLAGS, r.info.flags);
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_REAL_ACTIVITY, r.realActivity.toShortString());
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_SHORT_COMPONENT_NAME, r.shortComponentName);
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_PROCESS_NAME, r.processName);
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_IS_FULLSCREEN, r.fullscreen ? 1 : 0);
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_IS_NO_DISPLAY, r.noDisplay ? 1 : 0);
+        if (r.lastVisibleTime != 0) {
+            builder.addTaggedData(FIELD_ACTIVITY_RECORD_MILLIS_SINCE_LAST_VISIBLE,
+                    (nowUptime - r.lastVisibleTime));
+        }
+        if (r.resultTo != null) {
+            builder.addTaggedData(FIELD_ACTIVITY_RECORD_RESULT_TO_PKG_NAME, r.resultTo.packageName);
+            builder.addTaggedData(FIELD_ACTIVITY_RECORD_RESULT_TO_SHORT_COMPONENT_NAME,
+                    r.resultTo.shortComponentName);
+        }
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_IS_VISIBLE, r.visible ? 1 : 0);
+        builder.addTaggedData(FIELD_ACTIVITY_RECORD_IS_VISIBLE_IGNORING_KEYGUARD,
+                r.visibleIgnoringKeyguard ? 1 : 0);
+        if (r.lastLaunchTime != 0) {
+            builder.addTaggedData(FIELD_ACTIVITY_RECORD_MILLIS_SINCE_LAST_LAUNCH,
+                    (nowUptime - r.lastLaunchTime));
+        }
+        mMetricsLogger.write(builder);
+    }
+
     private int getTransitionType(WindowingModeTransitionInfo info) {
         if (info.currentTransitionProcessRunning) {
             if (info.startResult == START_SUCCESS) {
diff --git a/services/core/java/com/android/server/am/ActivityRecord.java b/services/core/java/com/android/server/am/ActivityRecord.java
index 0c156ae1a42..33bbea8bb63 100644
--- a/services/core/java/com/android/server/am/ActivityRecord.java
+++ b/services/core/java/com/android/server/am/ActivityRecord.java
@@ -698,9 +698,13 @@ final class ActivityRecord extends ConfigurationContainer implements AppWindowCo
         final boolean inPictureInPictureMode = inPinnedWindowingMode() && targetStackBounds != null;
         if (inPictureInPictureMode != mLastReportedPictureInPictureMode || forceUpdate) {
             // Picture-in-picture mode changes also trigger a multi-window mode change as well, so
-            // update that here in order
+            // update that here in order. Set the last reported MW state to the same as the PiP
+            // state since we haven't yet actually resized the task (these callbacks need to
+            // preceed the configuration change from the resiez.
+            // TODO(110009072): Once we move these callbacks to the client, remove all logic related
+            // to forcing the update of the picture-in-picture mode as a part of the PiP animation.
             mLastReportedPictureInPictureMode = inPictureInPictureMode;
-            mLastReportedMultiWindowMode = inMultiWindowMode();
+            mLastReportedMultiWindowMode = inPictureInPictureMode;
             final Configuration newConfig = task.computeNewOverrideConfigurationForBounds(
                     targetStackBounds, null);
             schedulePictureInPictureModeChanged(newConfig);
diff --git a/services/core/java/com/android/server/am/ActivityStack.java b/services/core/java/com/android/server/am/ActivityStack.java
index 8d6aab98fb0..807927599ed 100644
--- a/services/core/java/com/android/server/am/ActivityStack.java
+++ b/services/core/java/com/android/server/am/ActivityStack.java
@@ -1654,6 +1654,16 @@ class ActivityStack<T extends StackWindowController> extends ConfigurationContai
     void addToStopping(ActivityRecord r, boolean scheduleIdle, boolean idleDelayed) {
         if (!mStackSupervisor.mStoppingActivities.contains(r)) {
             mStackSupervisor.mStoppingActivities.add(r);
+
+            // Some activity is waiting for another activity to become visible before it's being
+            // stopped, which means that we also want to wait with stopping this one to avoid
+            // flickers.
+            if (!mStackSupervisor.mActivitiesWaitingForVisibleActivity.isEmpty()
+                    && !mStackSupervisor.mActivitiesWaitingForVisibleActivity.contains(r)) {
+                if (DEBUG_SWITCH) Slog.i(TAG_SWITCH, "adding to waiting visible activity=" + r
+                        + " existing=" + mStackSupervisor.mActivitiesWaitingForVisibleActivity);
+                mStackSupervisor.mActivitiesWaitingForVisibleActivity.add(r);
+            }
         }
 
         // If we already have a few activities waiting to stop, then give up
diff --git a/services/core/java/com/android/server/am/ActivityStackSupervisor.java b/services/core/java/com/android/server/am/ActivityStackSupervisor.java
index c4666cc16b1..a00b1131fe3 100644
--- a/services/core/java/com/android/server/am/ActivityStackSupervisor.java
+++ b/services/core/java/com/android/server/am/ActivityStackSupervisor.java
@@ -1639,6 +1639,8 @@ public class ActivityStackSupervisor extends ConfigurationContainer implements D
      * @param markFrozenIfConfigChanged Whether to set {@link ActivityRecord#frozenBeforeDestroy} to
      *                                  {@code true} if config changed.
      * @param deferResume Whether to defer resume while updating config.
+     * @return 'true' if starting activity was kept or wasn't provided, 'false' if it was relaunched
+     *         because of configuration update.
      */
     boolean ensureVisibilityAndConfig(ActivityRecord starting, int displayId,
             boolean markFrozenIfConfigChanged, boolean deferResume) {
@@ -1649,6 +1651,11 @@ public class ActivityStackSupervisor extends ConfigurationContainer implements D
         ensureActivitiesVisibleLocked(null /* starting */, 0 /* configChanges */,
                 false /* preserveWindows */, false /* notifyClients */);
 
+        if (displayId == INVALID_DISPLAY) {
+            // The caller didn't provide a valid display id, skip updating config.
+            return true;
+        }
+
         // Force-update the orientation from the WindowManager, since we need the true configuration
         // to send to the client now.
         final Configuration config = mWindowManager.updateOrientationFromAppTokens(
@@ -3935,6 +3942,10 @@ public class ActivityStackSupervisor extends ConfigurationContainer implements D
                         stops = new ArrayList<>();
                     }
                     stops.add(s);
+
+                    // Make sure to remove it in all cases in case we entered this block with
+                    // shouldSleepOrShutDown
+                    mActivitiesWaitingForVisibleActivity.remove(s);
                     mStoppingActivities.remove(activityNdx);
                 }
             }
@@ -4847,7 +4858,7 @@ public class ActivityStackSupervisor extends ConfigurationContainer implements D
             return mService.getActivityStartController().startActivityInPackage(
                     task.mCallingUid, callingPid, callingUid, callingPackage, intent, null, null,
                     null, 0, 0, options, userId, task, "startActivityFromRecents",
-                    false /* validateIncomingUser */);
+                    false /* validateIncomingUser */, null /* originatingPendingIntent */);
         } finally {
             if (windowingMode == WINDOWING_MODE_SPLIT_SCREEN_PRIMARY && task != null) {
                 // If we are launching the task in the docked stack, put it into resizing mode so
diff --git a/services/core/java/com/android/server/am/ActivityStartController.java b/services/core/java/com/android/server/am/ActivityStartController.java
index a7c32009a4c..edcf6e7bd51 100644
--- a/services/core/java/com/android/server/am/ActivityStartController.java
+++ b/services/core/java/com/android/server/am/ActivityStartController.java
@@ -248,7 +248,8 @@ public class ActivityStartController {
     final int startActivityInPackage(int uid, int realCallingPid, int realCallingUid,
             String callingPackage, Intent intent, String resolvedType, IBinder resultTo,
             String resultWho, int requestCode, int startFlags, SafeActivityOptions options,
-            int userId, TaskRecord inTask, String reason, boolean validateIncomingUser) {
+            int userId, TaskRecord inTask, String reason, boolean validateIncomingUser,
+            PendingIntentRecord originatingPendingIntent) {
 
         userId = checkTargetUser(userId, validateIncomingUser, realCallingPid, realCallingUid,
                 reason);
@@ -267,6 +268,7 @@ public class ActivityStartController {
                 .setActivityOptions(options)
                 .setMayWait(userId)
                 .setInTask(inTask)
+                .setOriginatingPendingIntent(originatingPendingIntent)
                 .execute();
     }
 
@@ -278,10 +280,12 @@ public class ActivityStartController {
      * @param intents Intents to start.
      * @param userId Start the intents on this user.
      * @param validateIncomingUser Set true to skip checking {@code userId} with the calling UID.
+     * @param originatingPendingIntent PendingIntentRecord that originated this activity start or
+     *        null if not originated by PendingIntent
      */
     final int startActivitiesInPackage(int uid, String callingPackage, Intent[] intents,
             String[] resolvedTypes, IBinder resultTo, SafeActivityOptions options, int userId,
-            boolean validateIncomingUser) {
+            boolean validateIncomingUser, PendingIntentRecord originatingPendingIntent) {
 
         final String reason = "startActivityInPackage";
 
@@ -290,12 +294,12 @@ public class ActivityStartController {
 
         // TODO: Switch to user app stacks here.
         return startActivities(null, uid, callingPackage, intents, resolvedTypes, resultTo, options,
-                userId, reason);
+                userId, reason, originatingPendingIntent);
     }
 
     int startActivities(IApplicationThread caller, int callingUid, String callingPackage,
             Intent[] intents, String[] resolvedTypes, IBinder resultTo, SafeActivityOptions options,
-            int userId, String reason) {
+            int userId, String reason, PendingIntentRecord originatingPendingIntent) {
         if (intents == null) {
             throw new NullPointerException("intents is null");
         }
@@ -374,6 +378,7 @@ public class ActivityStartController {
                             // Top activity decides on animation being run, so we allow only for the
                             // top one as otherwise an activity below might consume it.
                             .setAllowPendingRemoteAnimationRegistryLookup(top /* allowLookup*/)
+                            .setOriginatingPendingIntent(originatingPendingIntent)
                             .execute();
 
                     if (res < 0) {
diff --git a/services/core/java/com/android/server/am/ActivityStarter.java b/services/core/java/com/android/server/am/ActivityStarter.java
index 73e3d33073f..00ba3a61d1d 100644
--- a/services/core/java/com/android/server/am/ActivityStarter.java
+++ b/services/core/java/com/android/server/am/ActivityStarter.java
@@ -99,6 +99,7 @@ import android.os.Bundle;
 import android.os.IBinder;
 import android.os.RemoteException;
 import android.os.SystemClock;
+import android.os.Trace;
 import android.os.UserHandle;
 import android.os.UserManager;
 import android.service.voice.IVoiceInteractionSession;
@@ -313,6 +314,7 @@ class ActivityStarter {
         int userId;
         WaitResult waitResult;
         int filterCallingUid;
+        PendingIntentRecord originatingPendingIntent;
 
         /**
          * If set to {@code true}, allows this activity start to look into
@@ -369,6 +371,7 @@ class ActivityStarter {
             avoidMoveToFront = false;
             allowPendingRemoteAnimationRegistryLookup = true;
             filterCallingUid = UserHandle.USER_NULL;
+            originatingPendingIntent = null;
         }
 
         /**
@@ -407,6 +410,7 @@ class ActivityStarter {
             allowPendingRemoteAnimationRegistryLookup
                     = request.allowPendingRemoteAnimationRegistryLookup;
             filterCallingUid = request.filterCallingUid;
+            originatingPendingIntent = request.originatingPendingIntent;
         }
     }
 
@@ -490,7 +494,8 @@ class ActivityStarter {
                         mRequest.profilerInfo, mRequest.waitResult, mRequest.globalConfig,
                         mRequest.activityOptions, mRequest.ignoreTargetSecurity, mRequest.userId,
                         mRequest.inTask, mRequest.reason,
-                        mRequest.allowPendingRemoteAnimationRegistryLookup);
+                        mRequest.allowPendingRemoteAnimationRegistryLookup,
+                        mRequest.originatingPendingIntent);
             } else {
                 return startActivity(mRequest.caller, mRequest.intent, mRequest.ephemeralIntent,
                         mRequest.resolvedType, mRequest.activityInfo, mRequest.resolveInfo,
@@ -500,7 +505,8 @@ class ActivityStarter {
                         mRequest.realCallingUid, mRequest.startFlags, mRequest.activityOptions,
                         mRequest.ignoreTargetSecurity, mRequest.componentSpecified,
                         mRequest.outActivity, mRequest.inTask, mRequest.reason,
-                        mRequest.allowPendingRemoteAnimationRegistryLookup);
+                        mRequest.allowPendingRemoteAnimationRegistryLookup,
+                        mRequest.originatingPendingIntent);
             }
         } finally {
             onExecutionComplete();
@@ -532,7 +538,8 @@ class ActivityStarter {
             String callingPackage, int realCallingPid, int realCallingUid, int startFlags,
             SafeActivityOptions options, boolean ignoreTargetSecurity, boolean componentSpecified,
             ActivityRecord[] outActivity, TaskRecord inTask, String reason,
-            boolean allowPendingRemoteAnimationRegistryLookup) {
+            boolean allowPendingRemoteAnimationRegistryLookup,
+            PendingIntentRecord originatingPendingIntent) {
 
         if (TextUtils.isEmpty(reason)) {
             throw new IllegalArgumentException("Need to specify a reason.");
@@ -545,7 +552,7 @@ class ActivityStarter {
                 aInfo, rInfo, voiceSession, voiceInteractor, resultTo, resultWho, requestCode,
                 callingPid, callingUid, callingPackage, realCallingPid, realCallingUid, startFlags,
                 options, ignoreTargetSecurity, componentSpecified, mLastStartActivityRecord,
-                inTask, allowPendingRemoteAnimationRegistryLookup);
+                inTask, allowPendingRemoteAnimationRegistryLookup, originatingPendingIntent);
 
         if (outActivity != null) {
             // mLastStartActivityRecord[0] is set in the call to startActivity above.
@@ -575,7 +582,8 @@ class ActivityStarter {
             String callingPackage, int realCallingPid, int realCallingUid, int startFlags,
             SafeActivityOptions options,
             boolean ignoreTargetSecurity, boolean componentSpecified, ActivityRecord[] outActivity,
-            TaskRecord inTask, boolean allowPendingRemoteAnimationRegistryLookup) {
+            TaskRecord inTask, boolean allowPendingRemoteAnimationRegistryLookup,
+            PendingIntentRecord originatingPendingIntent) {
         int err = ActivityManager.START_SUCCESS;
         // Pull the optional Ephemeral Installer-only bundle out of the options early.
         final Bundle verificationBundle
@@ -865,10 +873,58 @@ class ActivityStarter {
 
         mController.doPendingActivityLaunches(false);
 
+        maybeLogActivityStart(callingUid, callingPackage, realCallingUid, intent, callerApp, r,
+                originatingPendingIntent);
+
         return startActivity(r, sourceRecord, voiceSession, voiceInteractor, startFlags,
                 true /* doResume */, checkedOptions, inTask, outActivity);
     }
 
+    private void maybeLogActivityStart(int callingUid, String callingPackage, int realCallingUid,
+            Intent intent, ProcessRecord callerApp, ActivityRecord r,
+            PendingIntentRecord originatingPendingIntent) {
+        boolean callerAppHasForegroundActivity = (callerApp != null)
+                ? callerApp.foregroundActivities
+                : false;
+        if (!mService.isActivityStartsLoggingEnabled() || callerAppHasForegroundActivity
+                || r == null) {
+            // skip logging in this case
+            return;
+        }
+
+        try {
+            Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, "logActivityStart");
+            final int callingUidProcState = mService.getUidStateLocked(callingUid);
+            final boolean callingUidHasAnyVisibleWindow =
+                    mService.mWindowManager.isAnyWindowVisibleForUid(callingUid);
+            final int realCallingUidProcState = (callingUid == realCallingUid)
+                    ? callingUidProcState
+                    : mService.getUidStateLocked(realCallingUid);
+            final boolean realCallingUidHasAnyVisibleWindow = (callingUid == realCallingUid)
+                    ? callingUidHasAnyVisibleWindow
+                    : mService.mWindowManager.isAnyWindowVisibleForUid(realCallingUid);
+            final String targetPackage = r.packageName;
+            final int targetUid = (r.appInfo != null) ? r.appInfo.uid : -1;
+            final int targetUidProcState = mService.getUidStateLocked(targetUid);
+            final boolean targetUidHasAnyVisibleWindow = (targetUid != -1)
+                    ? mService.mWindowManager.isAnyWindowVisibleForUid(targetUid)
+                    : false;
+            final String targetWhitelistTag = (targetUid != -1)
+                    ? mService.getPendingTempWhitelistTagForUidLocked(targetUid)
+                    : null;
+
+            mSupervisor.getActivityMetricsLogger().logActivityStart(intent, callerApp, r,
+                    callingUid, callingPackage, callingUidProcState,
+                    callingUidHasAnyVisibleWindow,
+                    realCallingUid, realCallingUidProcState,
+                    realCallingUidHasAnyVisibleWindow,
+                    targetUid, targetPackage, targetUidProcState,
+                    targetUidHasAnyVisibleWindow, targetWhitelistTag,
+                    (originatingPendingIntent != null));
+        } finally {
+            Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
+        }
+    }
 
     /**
      * Creates a launch intent for the given auxiliary resolution data.
@@ -949,7 +1005,8 @@ class ActivityStarter {
             ProfilerInfo profilerInfo, WaitResult outResult,
             Configuration globalConfig, SafeActivityOptions options, boolean ignoreTargetSecurity,
             int userId, TaskRecord inTask, String reason,
-            boolean allowPendingRemoteAnimationRegistryLookup) {
+            boolean allowPendingRemoteAnimationRegistryLookup,
+            PendingIntentRecord originatingPendingIntent) {
         // Refuse possible leaked file descriptors
         if (intent != null && intent.hasFileDescriptors()) {
             throw new IllegalArgumentException("File descriptors passed in Intent");
@@ -1100,7 +1157,7 @@ class ActivityStarter {
                     voiceSession, voiceInteractor, resultTo, resultWho, requestCode, callingPid,
                     callingUid, callingPackage, realCallingPid, realCallingUid, startFlags, options,
                     ignoreTargetSecurity, componentSpecified, outRecord, inTask, reason,
-                    allowPendingRemoteAnimationRegistryLookup);
+                    allowPendingRemoteAnimationRegistryLookup, originatingPendingIntent);
 
             Binder.restoreCallingIdentity(origId);
 
@@ -2625,6 +2682,11 @@ class ActivityStarter {
         return this;
     }
 
+    ActivityStarter setOriginatingPendingIntent(PendingIntentRecord originatingPendingIntent) {
+        mRequest.originatingPendingIntent = originatingPendingIntent;
+        return this;
+    }
+
     void dump(PrintWriter pw, String prefix) {
         prefix = prefix + "  ";
         pw.print(prefix);
diff --git a/services/core/java/com/android/server/am/AppErrors.java b/services/core/java/com/android/server/am/AppErrors.java
index a6dafbb1db3..f0e2876b476 100644
--- a/services/core/java/com/android/server/am/AppErrors.java
+++ b/services/core/java/com/android/server/am/AppErrors.java
@@ -484,7 +484,8 @@ class AppErrors {
                                     task.intent, null, null, null, 0, 0,
                                     new SafeActivityOptions(ActivityOptions.makeBasic()),
                                     task.userId, null,
-                                    "AppErrors", false /*validateIncomingUser*/);
+                                    "AppErrors", false /*validateIncomingUser*/,
+                                    null /* originatingPendingIntent */);
                         }
                     }
                 }
diff --git a/services/core/java/com/android/server/am/BatteryExternalStatsWorker.java b/services/core/java/com/android/server/am/BatteryExternalStatsWorker.java
index 49fa902d161..9eb22d71785 100644
--- a/services/core/java/com/android/server/am/BatteryExternalStatsWorker.java
+++ b/services/core/java/com/android/server/am/BatteryExternalStatsWorker.java
@@ -543,14 +543,25 @@ class BatteryExternalStatsWorker implements BatteryStatsImpl.ExternalStatsSync {
         final long idleTimeMs = latest.mControllerIdleTimeMs - lastIdleMs;
         final long scanTimeMs = latest.mControllerScanTimeMs - lastScanMs;
 
-        if (txTimeMs < 0 || rxTimeMs < 0 || scanTimeMs < 0) {
+        if (txTimeMs < 0 || rxTimeMs < 0 || scanTimeMs < 0 || idleTimeMs < 0) {
             // The stats were reset by the WiFi system (which is why our delta is negative).
-            // Returns the unaltered stats.
-            delta.mControllerEnergyUsed = latest.mControllerEnergyUsed;
-            delta.mControllerRxTimeMs = latest.mControllerRxTimeMs;
-            delta.mControllerTxTimeMs = latest.mControllerTxTimeMs;
-            delta.mControllerIdleTimeMs = latest.mControllerIdleTimeMs;
-            delta.mControllerScanTimeMs = latest.mControllerScanTimeMs;
+            // Returns the unaltered stats. The total on time should not exceed the time
+            // duartion between reports.
+            final long totalOnTimeMs = latest.mControllerTxTimeMs + latest.mControllerRxTimeMs
+                        + latest.mControllerIdleTimeMs;
+            if (totalOnTimeMs <= timePeriodMs + MAX_WIFI_STATS_SAMPLE_ERROR_MILLIS) {
+                delta.mControllerEnergyUsed = latest.mControllerEnergyUsed;
+                delta.mControllerRxTimeMs = latest.mControllerRxTimeMs;
+                delta.mControllerTxTimeMs = latest.mControllerTxTimeMs;
+                delta.mControllerIdleTimeMs = latest.mControllerIdleTimeMs;
+                delta.mControllerScanTimeMs = latest.mControllerScanTimeMs;
+            } else {
+                delta.mControllerEnergyUsed = 0;
+                delta.mControllerRxTimeMs = 0;
+                delta.mControllerTxTimeMs = 0;
+                delta.mControllerIdleTimeMs = 0;
+                delta.mControllerScanTimeMs = 0;
+            }
             Slog.v(TAG, "WiFi energy data was reset, new WiFi energy data is " + delta);
         } else {
             final long totalActiveTimeMs = txTimeMs + rxTimeMs;
diff --git a/services/core/java/com/android/server/am/ContentProviderRecord.java b/services/core/java/com/android/server/am/ContentProviderRecord.java
index cd39bcd03d3..69ef570c63a 100644
--- a/services/core/java/com/android/server/am/ContentProviderRecord.java
+++ b/services/core/java/com/android/server/am/ContentProviderRecord.java
@@ -62,7 +62,8 @@ final class ContentProviderRecord implements ComponentName.WithComponentName {
         appInfo = ai;
         name = _name;
         singleton = _singleton;
-        noReleaseNeeded = uid == 0 || uid == Process.SYSTEM_UID;
+        noReleaseNeeded = (uid == 0 || uid == Process.SYSTEM_UID)
+                && (_name == null || !"com.android.settings".equals(_name.getPackageName()));
     }
 
     public ContentProviderRecord(ContentProviderRecord cpr) {
diff --git a/services/core/java/com/android/server/am/PendingIntentRecord.java b/services/core/java/com/android/server/am/PendingIntentRecord.java
index e0aa2a261b3..4e00304a9da 100644
--- a/services/core/java/com/android/server/am/PendingIntentRecord.java
+++ b/services/core/java/com/android/server/am/PendingIntentRecord.java
@@ -307,7 +307,7 @@ final class PendingIntentRecord extends IIntentSender.Stub {
                             } else if (finalIntent.getComponent() != null) {
                                 finalIntent.getComponent().appendShortString(tag);
                             } else if (finalIntent.getData() != null) {
-                                tag.append(finalIntent.getData());
+                                tag.append(finalIntent.getData().toSafeString());
                             }
                             owner.tempWhitelistForPendingIntentLocked(callingPid,
                                     callingUid, uid, duration, tag.toString());
@@ -346,13 +346,15 @@ final class PendingIntentRecord extends IIntentSender.Stub {
                                 res = owner.getActivityStartController().startActivitiesInPackage(
                                         uid, key.packageName, allIntents, allResolvedTypes,
                                         resultTo, mergedOptions, userId,
-                                        false /* validateIncomingUser */);
+                                        false /* validateIncomingUser */,
+                                        this /* originatingPendingIntent */);
                             } else {
                                 res = owner.getActivityStartController().startActivityInPackage(uid,
                                         callingPid, callingUid, key.packageName, finalIntent,
                                         resolvedType, resultTo, resultWho, requestCode, 0,
                                         mergedOptions, userId, null, "PendingIntentRecord",
-                                        false /* validateIncomingUser */);
+                                        false /* validateIncomingUser */,
+                                        this /* originatingPendingIntent */);
                             }
                         } catch (RuntimeException e) {
                             Slog.w(TAG, "Unable to send startActivity intent", e);
diff --git a/services/core/java/com/android/server/am/ProcessList.java b/services/core/java/com/android/server/am/ProcessList.java
index 784d62e5196..3ac7885eba3 100644
--- a/services/core/java/com/android/server/am/ProcessList.java
+++ b/services/core/java/com/android/server/am/ProcessList.java
@@ -104,6 +104,11 @@ public final class ProcessList {
     static final int VISIBLE_APP_ADJ = 100;
     static final int VISIBLE_APP_LAYER_MAX = PERCEPTIBLE_APP_ADJ - VISIBLE_APP_ADJ - 1;
 
+    // This is a process that was recently TOP and moved to FGS. Continue to treat it almost
+    // like a foreground app for a while.
+    // @see TOP_TO_FGS_GRACE_PERIOD
+    static final int PERCEPTIBLE_RECENT_FOREGROUND_APP_ADJ = 50;
+
     // This is the process running the current foreground app.  We'd really
     // rather not kill it!
     static final int FOREGROUND_APP_ADJ = 0;
diff --git a/services/core/java/com/android/server/am/ProcessRecord.java b/services/core/java/com/android/server/am/ProcessRecord.java
index caf52e35954..e3e839f6317 100644
--- a/services/core/java/com/android/server/am/ProcessRecord.java
+++ b/services/core/java/com/android/server/am/ProcessRecord.java
@@ -163,6 +163,7 @@ final class ProcessRecord {
     long lastRequestedGc;       // When we last asked the app to do a gc
     long lastLowMemory;         // When we last told the app that memory is low
     long lastProviderTime;      // The last time someone else was using a provider in this process.
+    long lastTopTime;           // The last time the process was in the TOP state or greater.
     boolean reportLowMemory;    // Set to true when waiting to report low mem
     boolean empty;              // Is this an empty background process?
     boolean cached;             // Is this a cached process?
@@ -380,6 +381,11 @@ final class ProcessRecord {
             TimeUtils.formatDuration(lastProviderTime, nowUptime, pw);
             pw.println();
         }
+        if (lastTopTime > 0) {
+            pw.print(prefix); pw.print("lastTopTime=");
+            TimeUtils.formatDuration(lastTopTime, nowUptime, pw);
+            pw.println();
+        }
         if (hasStartedServices) {
             pw.print(prefix); pw.print("hasStartedServices="); pw.println(hasStartedServices);
         }
@@ -856,4 +862,8 @@ final class ProcessRecord {
         }
         return list;
     }
+
+    boolean hasForegroundServices() {
+        return foregroundServices;
+    }
 }
diff --git a/services/core/java/com/android/server/am/UserController.java b/services/core/java/com/android/server/am/UserController.java
index a0830b90c8e..d9fe3fdedbb 100644
--- a/services/core/java/com/android/server/am/UserController.java
+++ b/services/core/java/com/android/server/am/UserController.java
@@ -24,7 +24,6 @@ import static android.app.ActivityManager.USER_OP_IS_CURRENT;
 import static android.app.ActivityManager.USER_OP_SUCCESS;
 import static android.os.Process.SHELL_UID;
 import static android.os.Process.SYSTEM_UID;
-
 import static com.android.server.am.ActivityManagerDebugConfig.DEBUG_MU;
 import static com.android.server.am.ActivityManagerDebugConfig.TAG_AM;
 import static com.android.server.am.ActivityManagerDebugConfig.TAG_WITH_CLASS_NAME;
@@ -48,6 +47,7 @@ import android.app.IStopUserCallback;
 import android.app.IUserSwitchObserver;
 import android.app.KeyguardManager;
 import android.app.usage.UsageEvents;
+import android.appwidget.AppWidgetManagerInternal;
 import android.content.Context;
 import android.content.IIntentReceiver;
 import android.content.Intent;
@@ -87,8 +87,8 @@ import android.util.SparseArray;
 import android.util.SparseIntArray;
 import android.util.TimingsTraceLog;
 import android.util.proto.ProtoOutputStream;
-
 import android.view.Window;
+
 import com.android.internal.R;
 import com.android.internal.annotations.GuardedBy;
 import com.android.internal.annotations.VisibleForTesting;
@@ -548,6 +548,9 @@ class UserController implements Handler.Callback {
                     AppOpsManager.OP_BOOT_COMPLETED, null, true, false, MY_PID, SYSTEM_UID, userId);
         }
 
+        // Spin up app widgets prior to boot-complete, so they can be ready promptly
+        mInjector.startUserWidgets(userId);
+
         Slog.i(TAG, "Sending BOOT_COMPLETE user #" + userId);
         // Do not report secondary users, runtime restarts or first boot/upgrade
         if (userId == UserHandle.USER_SYSTEM
@@ -2188,6 +2191,13 @@ class UserController implements Handler.Callback {
             }
         }
 
+        void startUserWidgets(int userId) {
+            AppWidgetManagerInternal awm = LocalServices.getService(AppWidgetManagerInternal.class);
+            if (awm != null) {
+                awm.unlockUser(userId);
+            }
+        }
+
         void updateUserConfiguration() {
             synchronized (mService) {
                 mService.updateUserConfigurationLocked();
diff --git a/services/core/java/com/android/server/audio/AudioService.java b/services/core/java/com/android/server/audio/AudioService.java
index 13de652350d..b16fc5473ff 100644
--- a/services/core/java/com/android/server/audio/AudioService.java
+++ b/services/core/java/com/android/server/audio/AudioService.java
@@ -3802,6 +3802,10 @@ public class AudioService extends IAudioService.Stub
                             int delay = checkSendBecomingNoisyIntent(
                                     AudioSystem.DEVICE_OUT_BLUETOOTH_A2DP, intState,
                                     AudioSystem.DEVICE_NONE);
+                            final String addr = btDevice == null ? "null" : btDevice.getAddress();
+                            mDeviceLogger.log(new AudioEventLogger.StringEvent(
+                                    "A2DP service connected: device addr=" + addr
+                                    + " state=" + state));
                             queueMsgUnderWakeLock(mAudioHandler,
                                     MSG_SET_A2DP_SINK_CONNECTION_STATE,
                                     state,
@@ -4665,7 +4669,14 @@ public class AudioService extends IAudioService.Stub
     public int setBluetoothA2dpDeviceConnectionStateSuppressNoisyIntent(BluetoothDevice device,
                 int state, int profile, boolean suppressNoisyIntent, int a2dpVolume)
     {
+        mDeviceLogger.log(new AudioEventLogger.StringEvent(
+                "setBluetoothA2dpDeviceConnectionStateSuppressNoisyIntent state=" + state
+                // only querying address as this is the only readily available field on the device
+                + " addr=" + device.getAddress()
+                + " prof=" + profile + " supprNoisy=" + suppressNoisyIntent
+                + " vol=" + a2dpVolume));
         if (mAudioHandler.hasMessages(MSG_SET_A2DP_SINK_CONNECTION_STATE, device)) {
+            mDeviceLogger.log(new AudioEventLogger.StringEvent("A2DP connection state ignored"));
             return 0;
         }
         return setBluetoothA2dpDeviceConnectionStateInt(
@@ -5618,7 +5629,7 @@ public class AudioService extends IAudioService.Stub
                 case MSG_SET_WIRED_DEVICE_CONNECTION_STATE:
                     {   WiredDeviceConnectionState connectState =
                             (WiredDeviceConnectionState)msg.obj;
-                        mWiredDevLogger.log(new WiredDevConnectEvent(connectState));
+                        mDeviceLogger.log(new WiredDevConnectEvent(connectState));
                         onSetWiredDeviceConnectionState(connectState.mType, connectState.mState,
                                 connectState.mAddress, connectState.mName, connectState.mCaller);
                         mAudioEventWakeLock.release();
@@ -6073,10 +6084,14 @@ public class AudioService extends IAudioService.Stub
         if (!BluetoothAdapter.checkBluetoothAddress(address)) {
             address = "";
         }
+        mDeviceLogger.log(new AudioEventLogger.StringEvent(
+                "onBluetoothA2dpDeviceConfigChange addr=" + address));
 
         int device = AudioSystem.DEVICE_OUT_BLUETOOTH_A2DP;
         synchronized (mConnectedDevices) {
             if (mAudioHandler.hasMessages(MSG_SET_A2DP_SINK_CONNECTION_STATE, btDevice)) {
+                mDeviceLogger.log(new AudioEventLogger.StringEvent(
+                        "A2dp config change ignored"));
                 return;
             }
             final String key = makeDeviceListKey(device, address);
@@ -7172,19 +7187,20 @@ public class AudioService extends IAudioService.Stub
     //==========================================================================================
     // AudioService logging and dumpsys
     //==========================================================================================
-    final int LOG_NB_EVENTS_PHONE_STATE = 20;
-    final int LOG_NB_EVENTS_WIRED_DEV_CONNECTION = 30;
-    final int LOG_NB_EVENTS_FORCE_USE = 20;
-    final int LOG_NB_EVENTS_VOLUME = 40;
-    final int LOG_NB_EVENTS_DYN_POLICY = 10;
+    static final int LOG_NB_EVENTS_PHONE_STATE = 20;
+    static final int LOG_NB_EVENTS_DEVICE_CONNECTION = 30;
+    static final int LOG_NB_EVENTS_FORCE_USE = 20;
+    static final int LOG_NB_EVENTS_VOLUME = 40;
+    static final int LOG_NB_EVENTS_DYN_POLICY = 10;
 
     final private AudioEventLogger mModeLogger = new AudioEventLogger(LOG_NB_EVENTS_PHONE_STATE,
             "phone state (logged after successfull call to AudioSystem.setPhoneState(int))");
 
-    final private AudioEventLogger mWiredDevLogger = new AudioEventLogger(
-            LOG_NB_EVENTS_WIRED_DEV_CONNECTION,
-            "wired device connection (logged before onSetWiredDeviceConnectionState() is executed)"
-            );
+    // logs for wired + A2DP device connections:
+    // - wired: logged before onSetWiredDeviceConnectionState() is executed
+    // - A2DP: logged at reception of method call
+    final private AudioEventLogger mDeviceLogger = new AudioEventLogger(
+            LOG_NB_EVENTS_DEVICE_CONNECTION, "wired/A2DP device connection");
 
     final private AudioEventLogger mForceUseLogger = new AudioEventLogger(
             LOG_NB_EVENTS_FORCE_USE,
@@ -7273,7 +7289,7 @@ public class AudioService extends IAudioService.Stub
         pw.println("\nEvent logs:");
         mModeLogger.dump(pw);
         pw.println("\n");
-        mWiredDevLogger.dump(pw);
+        mDeviceLogger.dump(pw);
         pw.println("\n");
         mForceUseLogger.dump(pw);
         pw.println("\n");
diff --git a/services/core/java/com/android/server/connectivity/Tethering.java b/services/core/java/com/android/server/connectivity/Tethering.java
index df6a6f8bdcc..51059415a26 100644
--- a/services/core/java/com/android/server/connectivity/Tethering.java
+++ b/services/core/java/com/android/server/connectivity/Tethering.java
@@ -1350,8 +1350,11 @@ public class Tethering extends BaseNetworkObserver {
             // do not currently know how to watch for changes in DUN settings.
             maybeUpdateConfiguration();
 
-            final NetworkState ns = mUpstreamNetworkMonitor.selectPreferredUpstreamType(
-                    mConfig.preferredUpstreamIfaceTypes);
+            final TetheringConfiguration config = mConfig;
+            final NetworkState ns = (config.chooseUpstreamAutomatically)
+                    ? mUpstreamNetworkMonitor.getCurrentPreferredUpstream()
+                    : mUpstreamNetworkMonitor.selectPreferredUpstreamType(
+                            config.preferredUpstreamIfaceTypes);
             if (ns == null) {
                 if (tryCell) {
                     mUpstreamNetworkMonitor.registerMobileNetworkRequest();
@@ -1380,9 +1383,7 @@ public class Tethering extends BaseNetworkObserver {
             }
             notifyDownstreamsOfNewUpstreamIface(ifaces);
             if (ns != null && pertainsToCurrentUpstream(ns)) {
-                // If we already have NetworkState for this network examine
-                // it immediately, because there likely will be no second
-                // EVENT_ON_AVAILABLE (it was already received).
+                // If we already have NetworkState for this network update it immediately.
                 handleNewUpstreamNetworkState(ns);
             } else if (mCurrentUpstreamIfaceSet == null) {
                 // There are no available upstream networks.
@@ -1498,15 +1499,6 @@ public class Tethering extends BaseNetworkObserver {
             }
 
             switch (arg1) {
-                case UpstreamNetworkMonitor.EVENT_ON_AVAILABLE:
-                    // The default network changed, or DUN connected
-                    // before this callback was processed. Updates
-                    // for the current NetworkCapabilities and
-                    // LinkProperties have been requested (default
-                    // request) or are being sent shortly (DUN). Do
-                    // nothing until they arrive; if no updates
-                    // arrive there's nothing to do.
-                    break;
                 case UpstreamNetworkMonitor.EVENT_ON_CAPABILITIES:
                     handleNewUpstreamNetworkState(ns);
                     break;
@@ -1539,7 +1531,7 @@ public class Tethering extends BaseNetworkObserver {
                 }
 
                 mSimChange.startListening();
-                mUpstreamNetworkMonitor.start();
+                mUpstreamNetworkMonitor.start(mDeps.getDefaultNetworkRequest());
 
                 // TODO: De-duplicate with updateUpstreamWanted() below.
                 if (upstreamWanted()) {
diff --git a/services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java b/services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java
index 454c579ed0a..dd9fe05b50f 100644
--- a/services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java
+++ b/services/core/java/com/android/server/connectivity/tethering/TetheringConfiguration.java
@@ -27,6 +27,7 @@ import static com.android.internal.R.array.config_tether_dhcp_range;
 import static com.android.internal.R.array.config_tether_usb_regexs;
 import static com.android.internal.R.array.config_tether_upstream_types;
 import static com.android.internal.R.array.config_tether_wifi_regexs;
+import static com.android.internal.R.bool.config_tether_upstream_automatic;
 import static com.android.internal.R.string.config_mobile_hotspot_provision_app_no_ui;
 
 import android.content.Context;
@@ -86,6 +87,7 @@ public class TetheringConfiguration {
     public final String[] tetherableBluetoothRegexs;
     public final int dunCheck;
     public final boolean isDunRequired;
+    public final boolean chooseUpstreamAutomatically;
     public final Collection<Integer> preferredUpstreamIfaceTypes;
     public final String[] dhcpRanges;
     public final String[] defaultIPv4DNS;
@@ -106,6 +108,7 @@ public class TetheringConfiguration {
         dunCheck = checkDunRequired(ctx);
         configLog.log("DUN check returned: " + dunCheckString(dunCheck));
 
+        chooseUpstreamAutomatically = getResourceBoolean(ctx, config_tether_upstream_automatic);
         preferredUpstreamIfaceTypes = getUpstreamIfaceTypes(ctx, dunCheck);
         isDunRequired = preferredUpstreamIfaceTypes.contains(TYPE_MOBILE_DUN);
 
@@ -142,6 +145,8 @@ public class TetheringConfiguration {
         pw.print("isDunRequired: ");
         pw.println(isDunRequired);
 
+        pw.print("chooseUpstreamAutomatically: ");
+        pw.println(chooseUpstreamAutomatically);
         dumpStringArray(pw, "preferredUpstreamIfaceTypes",
                 preferredUpstreamNames(preferredUpstreamIfaceTypes));
 
@@ -160,6 +165,7 @@ public class TetheringConfiguration {
         sj.add(String.format("tetherableBluetoothRegexs:%s",
                 makeString(tetherableBluetoothRegexs)));
         sj.add(String.format("isDunRequired:%s", isDunRequired));
+        sj.add(String.format("chooseUpstreamAutomatically:%s", chooseUpstreamAutomatically));
         sj.add(String.format("preferredUpstreamIfaceTypes:%s",
                 makeString(preferredUpstreamNames(preferredUpstreamIfaceTypes))));
         sj.add(String.format("provisioningApp:%s", makeString(provisioningApp)));
@@ -286,6 +292,14 @@ public class TetheringConfiguration {
         }
     }
 
+    private static boolean getResourceBoolean(Context ctx, int resId) {
+        try {
+            return ctx.getResources().getBoolean(resId);
+        } catch (Resources.NotFoundException e404) {
+            return false;
+        }
+    }
+
     private static String[] getResourceStringArray(Context ctx, int resId) {
         try {
             final String[] strArray = ctx.getResources().getStringArray(resId);
diff --git a/services/core/java/com/android/server/connectivity/tethering/TetheringDependencies.java b/services/core/java/com/android/server/connectivity/tethering/TetheringDependencies.java
index 0ac7a36e3ff..605ee9c8ee2 100644
--- a/services/core/java/com/android/server/connectivity/tethering/TetheringDependencies.java
+++ b/services/core/java/com/android/server/connectivity/tethering/TetheringDependencies.java
@@ -18,6 +18,7 @@ package com.android.server.connectivity.tethering;
 
 import android.content.Context;
 import android.net.INetd;
+import android.net.NetworkRequest;
 import android.net.ip.RouterAdvertisementDaemon;
 import android.net.util.InterfaceParams;
 import android.net.util.NetdService;
@@ -64,4 +65,8 @@ public class TetheringDependencies {
     public boolean isTetheringSupported() {
         return true;
     }
+
+    public NetworkRequest getDefaultNetworkRequest() {
+        return null;
+    }
 }
diff --git a/services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java b/services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java
index 34132910ca8..f488be70af4 100644
--- a/services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java
+++ b/services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java
@@ -20,6 +20,9 @@ import static android.net.ConnectivityManager.getNetworkTypeName;
 import static android.net.ConnectivityManager.TYPE_NONE;
 import static android.net.ConnectivityManager.TYPE_MOBILE_DUN;
 import static android.net.ConnectivityManager.TYPE_MOBILE_HIPRI;
+import static android.net.NetworkCapabilities.NET_CAPABILITY_DUN;
+import static android.net.NetworkCapabilities.NET_CAPABILITY_NOT_VPN;
+import static android.net.NetworkCapabilities.TRANSPORT_CELLULAR;
 
 import android.content.Context;
 import android.os.Handler;
@@ -74,14 +77,13 @@ public class UpstreamNetworkMonitor {
     private static final boolean DBG = false;
     private static final boolean VDBG = false;
 
-    public static final int EVENT_ON_AVAILABLE      = 1;
-    public static final int EVENT_ON_CAPABILITIES   = 2;
-    public static final int EVENT_ON_LINKPROPERTIES = 3;
-    public static final int EVENT_ON_LOST           = 4;
+    public static final int EVENT_ON_CAPABILITIES   = 1;
+    public static final int EVENT_ON_LINKPROPERTIES = 2;
+    public static final int EVENT_ON_LOST           = 3;
     public static final int NOTIFY_LOCAL_PREFIXES   = 10;
 
     private static final int CALLBACK_LISTEN_ALL = 1;
-    private static final int CALLBACK_TRACK_DEFAULT = 2;
+    private static final int CALLBACK_DEFAULT_INTERNET = 2;
     private static final int CALLBACK_MOBILE_REQUEST = 3;
 
     private final Context mContext;
@@ -117,7 +119,7 @@ public class UpstreamNetworkMonitor {
         mCM = cm;
     }
 
-    public void start() {
+    public void start(NetworkRequest defaultNetworkRequest) {
         stop();
 
         final NetworkRequest listenAllRequest = new NetworkRequest.Builder()
@@ -125,8 +127,16 @@ public class UpstreamNetworkMonitor {
         mListenAllCallback = new UpstreamNetworkCallback(CALLBACK_LISTEN_ALL);
         cm().registerNetworkCallback(listenAllRequest, mListenAllCallback, mHandler);
 
-        mDefaultNetworkCallback = new UpstreamNetworkCallback(CALLBACK_TRACK_DEFAULT);
-        cm().registerDefaultNetworkCallback(mDefaultNetworkCallback, mHandler);
+        if (defaultNetworkRequest != null) {
+            // This is not really a "request", just a way of tracking the system default network.
+            // It's guaranteed not to actually bring up any networks because it's the same request
+            // as the ConnectivityService default request, and thus shares fate with it. We can't
+            // use registerDefaultNetworkCallback because it will not track the system default
+            // network if there is a VPN that applies to our UID.
+            final NetworkRequest trackDefaultRequest = new NetworkRequest(defaultNetworkRequest);
+            mDefaultNetworkCallback = new UpstreamNetworkCallback(CALLBACK_DEFAULT_INTERNET);
+            cm().requestNetwork(trackDefaultRequest, mDefaultNetworkCallback, mHandler);
+        }
     }
 
     public void stop() {
@@ -225,6 +235,20 @@ public class UpstreamNetworkMonitor {
         return typeStatePair.ns;
     }
 
+    // Returns null if no current upstream available.
+    public NetworkState getCurrentPreferredUpstream() {
+        final NetworkState dfltState = (mDefaultInternetNetwork != null)
+                ? mNetworkMap.get(mDefaultInternetNetwork)
+                : null;
+        if (!mDunRequired) return dfltState;
+
+        if (isNetworkUsableAndNotCellular(dfltState)) return dfltState;
+
+        // Find a DUN network. Note that code in Tethering causes a DUN request
+        // to be filed, but this might be moved into this class in future.
+        return findFirstDunNetwork(mNetworkMap.values());
+    }
+
     public void setCurrentUpstream(Network upstream) {
         mTetheringUpstreamNetwork = upstream;
     }
@@ -233,72 +257,16 @@ public class UpstreamNetworkMonitor {
         return (Set<IpPrefix>) mLocalPrefixes.clone();
     }
 
-    private void handleAvailable(int callbackType, Network network) {
-        if (VDBG) Log.d(TAG, "EVENT_ON_AVAILABLE for " + network);
-
-        if (!mNetworkMap.containsKey(network)) {
-            mNetworkMap.put(network,
-                    new NetworkState(null, null, null, network, null, null));
-        }
-
-        // Always request whatever extra information we can, in case this
-        // was already up when start() was called, in which case we would
-        // not have been notified of any information that had not changed.
-        switch (callbackType) {
-            case CALLBACK_LISTEN_ALL:
-                break;
-
-            case CALLBACK_TRACK_DEFAULT:
-                if (mDefaultNetworkCallback == null) {
-                    // The callback was unregistered in the interval between
-                    // ConnectivityService enqueueing onAvailable() and our
-                    // handling of it here on the mHandler thread.
-                    //
-                    // Clean-up of this network entry is deferred to the
-                    // handling of onLost() by other callbacks.
-                    //
-                    // These request*() calls can be deleted post oag/339444.
-                    return;
-                }
-                mDefaultInternetNetwork = network;
-                break;
-
-            case CALLBACK_MOBILE_REQUEST:
-                if (mMobileNetworkCallback == null) {
-                    // The callback was unregistered in the interval between
-                    // ConnectivityService enqueueing onAvailable() and our
-                    // handling of it here on the mHandler thread.
-                    //
-                    // Clean-up of this network entry is deferred to the
-                    // handling of onLost() by other callbacks.
-                    return;
-                }
-                break;
-        }
-
-        // Requesting updates for mListenAllCallback is not currently possible
-        // because it's a "listen". Two possible solutions to getting updates
-        // about networks without waiting for a change (which might never come)
-        // are:
-        //
-        //     [1] extend request{NetworkCapabilities,LinkProperties}() to
-        //         take a Network argument and have ConnectivityService do
-        //         what's required (if the network satisfies the request)
-        //
-        //     [2] explicitly file a NetworkRequest for each connectivity type
-        //         listed as a preferred upstream and wait for these callbacks
-        //         to be notified (requires tracking many more callbacks).
-        //
-        // Until this is addressed, networks that exist prior to the "listen"
-        // registration and which do not subsequently change will not cause
-        // us to learn their NetworkCapabilities nor their LinkProperties.
+    private void handleAvailable(Network network) {
+        if (mNetworkMap.containsKey(network)) return;
 
-        // TODO: If sufficient information is available to select a more
-        // preferable upstream, do so now and notify the target.
-        notifyTarget(EVENT_ON_AVAILABLE, network);
+        if (VDBG) Log.d(TAG, "onAvailable for " + network);
+        mNetworkMap.put(network, new NetworkState(null, null, null, network, null, null));
     }
 
-    private void handleNetCap(Network network, NetworkCapabilities newNc) {
+    private void handleNetCap(int callbackType, Network network, NetworkCapabilities newNc) {
+        if (callbackType == CALLBACK_DEFAULT_INTERNET) mDefaultInternetNetwork = network;
+
         final NetworkState prev = mNetworkMap.get(network);
         if (prev == null || newNc.equals(prev.networkCapabilities)) {
             // Ignore notifications about networks for which we have not yet
@@ -360,13 +328,17 @@ public class UpstreamNetworkMonitor {
     }
 
     private void handleLost(int callbackType, Network network) {
-        if (callbackType == CALLBACK_TRACK_DEFAULT) {
+        if (network.equals(mDefaultInternetNetwork)) {
             mDefaultInternetNetwork = null;
-            // Receiving onLost() for a default network does not necessarily
-            // mean the network is gone.  We wait for a separate notification
-            // on either the LISTEN_ALL or MOBILE_REQUEST callbacks before
-            // clearing all state.
-            return;
+            // There are few TODOs within ConnectivityService's rematching code
+            // pertaining to spurious onLost() notifications.
+            //
+            // TODO: simplify this, probably if favor of code that:
+            //     - selects a new upstream if mTetheringUpstreamNetwork has
+            //       been lost (by any callback)
+            //     - deletes the entry from the map only when the LISTEN_ALL
+            //       callback gets  notified.
+            if (callbackType == CALLBACK_DEFAULT_INTERNET) return;
         }
 
         if (!mNetworkMap.containsKey(network)) {
@@ -416,17 +388,19 @@ public class UpstreamNetworkMonitor {
 
         @Override
         public void onAvailable(Network network) {
-            handleAvailable(mCallbackType, network);
+            handleAvailable(network);
         }
 
         @Override
         public void onCapabilitiesChanged(Network network, NetworkCapabilities newNc) {
-            handleNetCap(network, newNc);
+            handleNetCap(mCallbackType, network, newNc);
         }
 
         @Override
         public void onLinkPropertiesChanged(Network network, LinkProperties newLp) {
             handleLinkProp(network, newLp);
+            // TODO(b/110335330): reduce the number of times this is called by
+            // only recomputing on the LISTEN_ALL callback.
             recomputeLocalPrefixes();
         }
 
@@ -443,6 +417,8 @@ public class UpstreamNetworkMonitor {
         @Override
         public void onLost(Network network) {
             handleLost(mCallbackType, network);
+            // TODO(b/110335330): reduce the number of times this is called by
+            // only recomputing on the LISTEN_ALL callback.
             recomputeLocalPrefixes();
         }
     }
@@ -509,4 +485,31 @@ public class UpstreamNetworkMonitor {
         if (nc == null || !nc.hasSignalStrength()) return "unknown";
         return Integer.toString(nc.getSignalStrength());
     }
+
+    private static boolean isCellular(NetworkState ns) {
+        return (ns != null) && isCellular(ns.networkCapabilities);
+    }
+
+    private static boolean isCellular(NetworkCapabilities nc) {
+        return (nc != null) && nc.hasTransport(TRANSPORT_CELLULAR) &&
+               nc.hasCapability(NET_CAPABILITY_NOT_VPN);
+    }
+
+    private static boolean hasCapability(NetworkState ns, int netCap) {
+        return (ns != null) && (ns.networkCapabilities != null) &&
+               ns.networkCapabilities.hasCapability(netCap);
+    }
+
+    private static boolean isNetworkUsableAndNotCellular(NetworkState ns) {
+        return (ns != null) && (ns.networkCapabilities != null) && (ns.linkProperties != null) &&
+               !isCellular(ns.networkCapabilities);
+    }
+
+    private static NetworkState findFirstDunNetwork(Iterable<NetworkState> netStates) {
+        for (NetworkState ns : netStates) {
+            if (isCellular(ns) && hasCapability(ns, NET_CAPABILITY_DUN)) return ns;
+        }
+
+        return null;
+    }
 }
diff --git a/services/core/java/com/android/server/display/ColorFade.java b/services/core/java/com/android/server/display/ColorFade.java
index 4f53ed49002..33525fdc52d 100644
--- a/services/core/java/com/android/server/display/ColorFade.java
+++ b/services/core/java/com/android/server/display/ColorFade.java
@@ -46,6 +46,7 @@ import android.view.SurfaceSession;
 import libcore.io.Streams;
 
 import com.android.server.LocalServices;
+import com.android.server.policy.WindowManagerPolicy;
 
 /**
  * <p>
@@ -63,7 +64,7 @@ final class ColorFade {
 
     // The layer for the electron beam surface.
     // This is currently hardcoded to be one layer above the boot animation.
-    private static final int COLOR_FADE_LAYER = 0x40000001;
+    private static final int COLOR_FADE_LAYER = WindowManagerPolicy.COLOR_FADE_LAYER;
 
     // The number of frames to draw when preparing the animation so that it will
     // be ready to run smoothly.  We use 3 frames because we are triple-buffered.
diff --git a/services/core/java/com/android/server/display/DisplayDeviceInfo.java b/services/core/java/com/android/server/display/DisplayDeviceInfo.java
index 349e1c8b713..512e85192d3 100644
--- a/services/core/java/com/android/server/display/DisplayDeviceInfo.java
+++ b/services/core/java/com/android/server/display/DisplayDeviceInfo.java
@@ -103,6 +103,12 @@ final class DisplayDeviceInfo {
      */
     public static final int FLAG_DESTROY_CONTENT_ON_REMOVAL = 1 << 10;
 
+    /**
+     * Flag: The display cutout of this display is masked.
+     * @hide
+     */
+    public static final int FLAG_MASK_DISPLAY_CUTOUT = 1 << 11;
+
     /**
      * Touch attachment: Display does not receive touch.
      */
@@ -453,6 +459,9 @@ final class DisplayDeviceInfo {
         if ((flags & FLAG_CAN_SHOW_WITH_INSECURE_KEYGUARD) != 0) {
             msg.append(", FLAG_CAN_SHOW_WITH_INSECURE_KEYGUARD");
         }
+        if ((flags & FLAG_MASK_DISPLAY_CUTOUT) != 0) {
+            msg.append(", FLAG_MASK_DISPLAY_CUTOUT");
+        }
         return msg.toString();
     }
 }
diff --git a/services/core/java/com/android/server/display/DisplayManagerService.java b/services/core/java/com/android/server/display/DisplayManagerService.java
index ddd8855f319..cc5a8271eb5 100644
--- a/services/core/java/com/android/server/display/DisplayManagerService.java
+++ b/services/core/java/com/android/server/display/DisplayManagerService.java
@@ -151,6 +151,8 @@ public final class DisplayManagerService extends SystemService {
     // Otherwise WFD is enabled according to the value of config_enableWifiDisplay.
     private static final String FORCE_WIFI_DISPLAY_ENABLE = "persist.debug.wfd.enable";
 
+    private static final String PROP_DEFAULT_DISPLAY_TOP_INSET = "persist.sys.displayinset.top";
+
     private static final long WAIT_FOR_DEFAULT_DISPLAY_TIMEOUT = 10000;
 
     private static final int MSG_REGISTER_DEFAULT_DISPLAY_ADAPTERS = 1;
@@ -243,6 +245,15 @@ public final class DisplayManagerService extends SystemService {
     // device).
     private Point mStableDisplaySize = new Point();
 
+    // Whether the system has finished booting or not.
+    private boolean mSystemReady;
+
+    // The top inset of the default display.
+    // This gets persisted so that the boot animation knows how to transition from the display's
+    // full size to the size configured by the user. Right now we only persist and animate the top
+    // inset, but theoretically we could do it for all of them.
+    private int mDefaultDisplayTopInset;
+
     // Viewports of the default display and the display that should receive touch
     // input from an external source.  Used by the input system.
     private final DisplayViewport mDefaultViewport = new DisplayViewport();
@@ -301,6 +312,7 @@ public final class DisplayManagerService extends SystemService {
         Resources resources = mContext.getResources();
         mDefaultDisplayDefaultColorMode = mContext.getResources().getInteger(
                 com.android.internal.R.integer.config_defaultDisplayDefaultColorMode);
+        mDefaultDisplayTopInset = SystemProperties.getInt(PROP_DEFAULT_DISPLAY_TOP_INSET, -1);
         float[] lux = getFloatArray(resources.obtainTypedArray(
                 com.android.internal.R.array.config_minimumBrightnessCurveLux));
         float[] nits = getFloatArray(resources.obtainTypedArray(
@@ -311,6 +323,8 @@ public final class DisplayManagerService extends SystemService {
         PowerManager pm = (PowerManager) mContext.getSystemService(Context.POWER_SERVICE);
         mGlobalDisplayBrightness = pm.getDefaultScreenBrightnessSetting();
         mCurrentUserId = UserHandle.USER_SYSTEM;
+
+        mSystemReady = false;
     }
 
     public void setupSchedulerPolicies() {
@@ -400,6 +414,10 @@ public final class DisplayManagerService extends SystemService {
         synchronized (mSyncRoot) {
             mSafeMode = safeMode;
             mOnlyCore = onlyCore;
+            mSystemReady = true;
+            // Just in case the top inset changed before the system was ready. At this point, any
+            // relevant configuration should be in place.
+            recordTopInsetLocked(mLogicalDisplays.get(Display.DEFAULT_DISPLAY));
         }
 
         mHandler.sendEmptyMessage(MSG_REGISTER_ADDITIONAL_DISPLAY_ADAPTERS);
@@ -457,7 +475,7 @@ public final class DisplayManagerService extends SystemService {
             LogicalDisplay display = mLogicalDisplays.get(displayId);
             if (display != null) {
                 if (display.setDisplayInfoOverrideFromWindowManagerLocked(info)) {
-                    sendDisplayEventLocked(displayId, DisplayManagerGlobal.EVENT_DISPLAY_CHANGED);
+                    handleLogicalDisplayChanged(displayId, display);
                     scheduleTraversalLocked(false);
                 }
             }
@@ -938,6 +956,13 @@ public final class DisplayManagerService extends SystemService {
         scheduleTraversalLocked(false);
     }
 
+    private void handleLogicalDisplayChanged(int displayId, @NonNull LogicalDisplay display) {
+        if (displayId == Display.DEFAULT_DISPLAY) {
+            recordTopInsetLocked(display);
+        }
+        sendDisplayEventLocked(displayId, DisplayManagerGlobal.EVENT_DISPLAY_CHANGED);
+    }
+
     private void applyGlobalDisplayStateLocked(List<Runnable> workQueue) {
         final int count = mDisplayDevices.size();
         for (int i = 0; i < count; i++) {
@@ -991,6 +1016,7 @@ public final class DisplayManagerService extends SystemService {
         configureColorModeLocked(display, device);
         if (isDefault) {
             recordStableDisplayStatsIfNeededLocked(display);
+            recordTopInsetLocked(display);
         }
 
         mLogicalDisplays.put(displayId, display);
@@ -1039,6 +1065,21 @@ public final class DisplayManagerService extends SystemService {
         }
     }
 
+    private void recordTopInsetLocked(@Nullable LogicalDisplay d) {
+        // We must only persist the inset after boot has completed, otherwise we will end up
+        // overwriting the persisted value before the masking flag has been loaded from the
+        // resource overlay.
+        if (!mSystemReady || d == null) {
+            return;
+        }
+        int topInset = d.getInsets().top;
+        if (topInset == mDefaultDisplayTopInset) {
+            return;
+        }
+        mDefaultDisplayTopInset = topInset;
+        SystemProperties.set(PROP_DEFAULT_DISPLAY_TOP_INSET, Integer.toString(topInset));
+    }
+
     private void setStableDisplaySizeLocked(int width, int height) {
         mStableDisplaySize = new Point(width, height);
         try {
@@ -1118,7 +1159,7 @@ public final class DisplayManagerService extends SystemService {
                 sendDisplayEventLocked(displayId, DisplayManagerGlobal.EVENT_DISPLAY_REMOVED);
                 changed = true;
             } else if (!mTempDisplayInfo.equals(display.getDisplayInfoLocked())) {
-                sendDisplayEventLocked(displayId, DisplayManagerGlobal.EVENT_DISPLAY_CHANGED);
+                handleLogicalDisplayChanged(displayId, display);
                 changed = true;
             }
         }
diff --git a/services/core/java/com/android/server/display/LocalDisplayAdapter.java b/services/core/java/com/android/server/display/LocalDisplayAdapter.java
index b9a279ad13e..16d82df4dd5 100644
--- a/services/core/java/com/android/server/display/LocalDisplayAdapter.java
+++ b/services/core/java/com/android/server/display/LocalDisplayAdapter.java
@@ -31,8 +31,6 @@ import android.os.Looper;
 import android.os.PowerManager;
 import android.os.SystemProperties;
 import android.os.Trace;
-import android.text.TextUtils;
-import android.util.PathParser;
 import android.util.Slog;
 import android.util.SparseArray;
 import android.view.Display;
@@ -404,8 +402,12 @@ final class LocalDisplayAdapter extends DisplayAdapter {
                             && SystemProperties.getBoolean(PROPERTY_EMULATOR_CIRCULAR, false))) {
                         mInfo.flags |= DisplayDeviceInfo.FLAG_ROUND;
                     }
-                    mInfo.displayCutout = DisplayCutout.fromResources(res, mInfo.width,
-                            mInfo.height);
+                    if (res.getBoolean(
+                            com.android.internal.R.bool.config_maskMainBuiltInDisplayCutout)) {
+                        mInfo.flags |= DisplayDeviceInfo.FLAG_MASK_DISPLAY_CUTOUT;
+                    }
+                    mInfo.displayCutout = DisplayCutout.fromResourcesRectApproximation(res,
+                            mInfo.width, mInfo.height);
                     mInfo.type = Display.TYPE_BUILT_IN;
                     mInfo.densityDpi = (int)(phys.density * 160 + 0.5f);
                     mInfo.xDpi = phys.xDpi;
diff --git a/services/core/java/com/android/server/display/LogicalDisplay.java b/services/core/java/com/android/server/display/LogicalDisplay.java
index 23ee56b24b1..5b7c5205ce3 100644
--- a/services/core/java/com/android/server/display/LogicalDisplay.java
+++ b/services/core/java/com/android/server/display/LogicalDisplay.java
@@ -18,11 +18,14 @@ package com.android.server.display;
 
 import android.graphics.Rect;
 import android.hardware.display.DisplayManagerInternal;
+import android.os.SystemProperties;
 import android.view.Display;
 import android.view.DisplayInfo;
 import android.view.Surface;
 import android.view.SurfaceControl;
 
+import com.android.server.wm.utils.InsetUtils;
+
 import java.io.PrintWriter;
 import java.util.Arrays;
 import java.util.List;
@@ -55,6 +58,8 @@ import java.util.Objects;
  * </p>
  */
 final class LogicalDisplay {
+    private static final String PROP_MASKING_INSET_TOP = "persist.sys.displayinset.top";
+
     private final DisplayInfo mBaseDisplayInfo = new DisplayInfo();
 
     // The layer stack we use when the display has been blanked to prevent any
@@ -251,14 +256,18 @@ final class LogicalDisplay {
             if ((deviceInfo.flags & DisplayDeviceInfo.FLAG_CAN_SHOW_WITH_INSECURE_KEYGUARD) != 0) {
                 mBaseDisplayInfo.flags |= Display.FLAG_CAN_SHOW_WITH_INSECURE_KEYGUARD;
             }
+            Rect maskingInsets = getMaskingInsets(deviceInfo);
+            int maskedWidth = deviceInfo.width - maskingInsets.left - maskingInsets.right;
+            int maskedHeight = deviceInfo.height - maskingInsets.top - maskingInsets.bottom;
+
             mBaseDisplayInfo.type = deviceInfo.type;
             mBaseDisplayInfo.address = deviceInfo.address;
             mBaseDisplayInfo.name = deviceInfo.name;
             mBaseDisplayInfo.uniqueId = deviceInfo.uniqueId;
-            mBaseDisplayInfo.appWidth = deviceInfo.width;
-            mBaseDisplayInfo.appHeight = deviceInfo.height;
-            mBaseDisplayInfo.logicalWidth = deviceInfo.width;
-            mBaseDisplayInfo.logicalHeight = deviceInfo.height;
+            mBaseDisplayInfo.appWidth = maskedWidth;
+            mBaseDisplayInfo.appHeight = maskedHeight;
+            mBaseDisplayInfo.logicalWidth = maskedWidth;
+            mBaseDisplayInfo.logicalHeight = maskedHeight;
             mBaseDisplayInfo.rotation = Surface.ROTATION_0;
             mBaseDisplayInfo.modeId = deviceInfo.modeId;
             mBaseDisplayInfo.defaultModeId = deviceInfo.defaultModeId;
@@ -275,19 +284,44 @@ final class LogicalDisplay {
             mBaseDisplayInfo.appVsyncOffsetNanos = deviceInfo.appVsyncOffsetNanos;
             mBaseDisplayInfo.presentationDeadlineNanos = deviceInfo.presentationDeadlineNanos;
             mBaseDisplayInfo.state = deviceInfo.state;
-            mBaseDisplayInfo.smallestNominalAppWidth = deviceInfo.width;
-            mBaseDisplayInfo.smallestNominalAppHeight = deviceInfo.height;
-            mBaseDisplayInfo.largestNominalAppWidth = deviceInfo.width;
-            mBaseDisplayInfo.largestNominalAppHeight = deviceInfo.height;
+            mBaseDisplayInfo.smallestNominalAppWidth = maskedWidth;
+            mBaseDisplayInfo.smallestNominalAppHeight = maskedHeight;
+            mBaseDisplayInfo.largestNominalAppWidth = maskedWidth;
+            mBaseDisplayInfo.largestNominalAppHeight = maskedHeight;
             mBaseDisplayInfo.ownerUid = deviceInfo.ownerUid;
             mBaseDisplayInfo.ownerPackageName = deviceInfo.ownerPackageName;
-            mBaseDisplayInfo.displayCutout = deviceInfo.displayCutout;
+            boolean maskCutout =
+                    (deviceInfo.flags & DisplayDeviceInfo.FLAG_MASK_DISPLAY_CUTOUT) != 0;
+            mBaseDisplayInfo.displayCutout = maskCutout ? null : deviceInfo.displayCutout;
 
             mPrimaryDisplayDeviceInfo = deviceInfo;
             mInfo = null;
         }
     }
 
+    /**
+     * Return the insets currently applied to the display.
+     *
+     * Note that the base DisplayInfo already takes these insets into account, so if you want to
+     * find out the <b>true</b> size of the display, you need to add them back to the logical
+     * dimensions.
+     */
+    public Rect getInsets() {
+        return getMaskingInsets(mPrimaryDisplayDeviceInfo);
+    }
+
+    /**
+     * Returns insets in ROTATION_0 for areas that are masked.
+     */
+    private static Rect getMaskingInsets(DisplayDeviceInfo deviceInfo) {
+        boolean maskCutout = (deviceInfo.flags & DisplayDeviceInfo.FLAG_MASK_DISPLAY_CUTOUT) != 0;
+        if (maskCutout && deviceInfo.displayCutout != null) {
+            return deviceInfo.displayCutout.getSafeInsets();
+        } else {
+            return new Rect();
+        }
+    }
+
     /**
      * Applies the layer stack and transformation to the given display device
      * so that it shows the contents of this logical display.
@@ -349,6 +383,12 @@ final class LogicalDisplay {
         int physWidth = rotated ? displayDeviceInfo.height : displayDeviceInfo.width;
         int physHeight = rotated ? displayDeviceInfo.width : displayDeviceInfo.height;
 
+        Rect maskingInsets = getMaskingInsets(displayDeviceInfo);
+        InsetUtils.rotateInsets(maskingInsets, orientation);
+        // Don't consider the masked area as available when calculating the scaling below.
+        physWidth -= maskingInsets.left + maskingInsets.right;
+        physHeight -= maskingInsets.top + maskingInsets.bottom;
+
         // Determine whether the width or height is more constrained to be scaled.
         //    physWidth / displayInfo.logicalWidth    => letter box
         // or physHeight / displayInfo.logicalHeight  => pillar box
@@ -375,6 +415,9 @@ final class LogicalDisplay {
         mTempDisplayRect.set(displayRectLeft, displayRectTop,
                 displayRectLeft + displayRectWidth, displayRectTop + displayRectHeight);
 
+        // Now add back the offset for the masked area.
+        mTempDisplayRect.offset(maskingInsets.left, maskingInsets.top);
+
         mTempDisplayRect.left += mDisplayOffsetX;
         mTempDisplayRect.right += mDisplayOffsetX;
         mTempDisplayRect.top += mDisplayOffsetY;
diff --git a/services/core/java/com/android/server/location/GnssLocationProvider.java b/services/core/java/com/android/server/location/GnssLocationProvider.java
index 8d730b4f7fc..0ec1f9ccd37 100644
--- a/services/core/java/com/android/server/location/GnssLocationProvider.java
+++ b/services/core/java/com/android/server/location/GnssLocationProvider.java
@@ -254,7 +254,7 @@ public class GnssLocationProvider implements LocationProviderInterface, InjectNt
     // 1 second, or 1 Hz frequency.
     private static final long LOCATION_UPDATE_MIN_TIME_INTERVAL_MILLIS = 1000;
     // Default update duration in milliseconds for REQUEST_LOCATION.
-    private static final long LOCATION_UPDATE_DURATION_MILLIS = 0;
+    private static final long LOCATION_UPDATE_DURATION_MILLIS = 10 * 1000;
 
     /** simpler wrapper for ProviderRequest + Worksource */
     private static class GpsRequest {
diff --git a/services/core/java/com/android/server/locksettings/LockSettingsService.java b/services/core/java/com/android/server/locksettings/LockSettingsService.java
index 0d8afb7107d..d35247501d3 100644
--- a/services/core/java/com/android/server/locksettings/LockSettingsService.java
+++ b/services/core/java/com/android/server/locksettings/LockSettingsService.java
@@ -959,12 +959,18 @@ public class LockSettingsService extends ILockSettings.Stub {
     @GuardedBy("mSeparateChallengeLock")
     private void setSeparateProfileChallengeEnabledLocked(@UserIdInt int userId, boolean enabled,
             String managedUserPassword) {
+        final boolean old = getBoolean(SEPARATE_PROFILE_CHALLENGE_KEY, false, userId);
         setBoolean(SEPARATE_PROFILE_CHALLENGE_KEY, enabled, userId);
-        if (enabled) {
-            mStorage.removeChildProfileLock(userId);
-            removeKeystoreProfileKey(userId);
-        } else {
-            tieManagedProfileLockIfNecessary(userId, managedUserPassword);
+        try {
+            if (enabled) {
+                mStorage.removeChildProfileLock(userId);
+                removeKeystoreProfileKey(userId);
+            } else {
+                tieManagedProfileLockIfNecessary(userId, managedUserPassword);
+            }
+        } catch (IllegalStateException e) {
+            setBoolean(SEPARATE_PROFILE_CHALLENGE_KEY, old, userId);
+            throw e;
         }
     }
 
diff --git a/services/core/java/com/android/server/net/NetworkStatsService.java b/services/core/java/com/android/server/net/NetworkStatsService.java
index addc479404e..fec510f28a9 100644
--- a/services/core/java/com/android/server/net/NetworkStatsService.java
+++ b/services/core/java/com/android/server/net/NetworkStatsService.java
@@ -941,7 +941,13 @@ public class NetworkStatsService extends INetworkStatsService.Stub {
 
     @Override
     public long getIfaceStats(String iface, int type) {
-        return nativeGetIfaceStat(iface, type, checkBpfStatsEnable());
+        // eBPF code doesn't provide per-interface TCP counters. Use xt_qtaguid for now.
+        // TODO: delete getMobileTcp(Rx|Tx)Packets entirely. See b/110443385 .
+        if (type == TYPE_TCP_TX_PACKETS || type == TYPE_TCP_RX_PACKETS) {
+            return nativeGetIfaceStat(iface, type, false);
+        } else {
+            return nativeGetIfaceStat(iface, type, checkBpfStatsEnable());
+        }
     }
 
     @Override
diff --git a/services/core/java/com/android/server/notification/ConditionProviders.java b/services/core/java/com/android/server/notification/ConditionProviders.java
index c0fbfbb20b9..18f4bc76863 100644
--- a/services/core/java/com/android/server/notification/ConditionProviders.java
+++ b/services/core/java/com/android/server/notification/ConditionProviders.java
@@ -150,6 +150,7 @@ public class ConditionProviders extends ManagedServices {
         try {
             provider.onConnected();
         } catch (RemoteException e) {
+            Slog.e(TAG, "can't connect to service " + info, e);
             // we tried
         }
         if (mCallback != null) {
diff --git a/services/core/java/com/android/server/notification/ManagedServices.java b/services/core/java/com/android/server/notification/ManagedServices.java
index f7becd51886..30fa7fe4ce8 100644
--- a/services/core/java/com/android/server/notification/ManagedServices.java
+++ b/services/core/java/com/android/server/notification/ManagedServices.java
@@ -175,6 +175,10 @@ abstract public class ManagedServices {
         }
     }
 
+    protected int getBindFlags() {
+        return BIND_AUTO_CREATE | BIND_FOREGROUND_SERVICE | BIND_ALLOW_WHITELIST_MANAGEMENT;
+    }
+
     protected void onServiceRemovedLocked(ManagedServiceInfo removed) { }
 
     private ManagedServiceInfo newServiceInfo(IInterface service,
@@ -1022,9 +1026,9 @@ abstract public class ManagedServices {
                 }
             };
             if (!mContext.bindServiceAsUser(intent,
-                serviceConnection,
-                BIND_AUTO_CREATE | BIND_FOREGROUND_SERVICE | BIND_ALLOW_WHITELIST_MANAGEMENT,
-                new UserHandle(userid))) {
+                    serviceConnection,
+                    getBindFlags(),
+                    new UserHandle(userid))) {
                 mServicesBinding.remove(servicesBindingTag);
                 Slog.w(TAG, "Unable to bind " + getCaption() + " service: " + intent);
                 return;
diff --git a/services/core/java/com/android/server/notification/NotificationManagerService.java b/services/core/java/com/android/server/notification/NotificationManagerService.java
index 048ec054fd6..9801f16b8fe 100644
--- a/services/core/java/com/android/server/notification/NotificationManagerService.java
+++ b/services/core/java/com/android/server/notification/NotificationManagerService.java
@@ -35,6 +35,10 @@ import static android.app.NotificationManager.Policy.SUPPRESSED_EFFECT_PEEK;
 import static android.app.NotificationManager.Policy.SUPPRESSED_EFFECT_SCREEN_OFF;
 import static android.app.NotificationManager.Policy.SUPPRESSED_EFFECT_SCREEN_ON;
 import static android.app.NotificationManager.Policy.SUPPRESSED_EFFECT_STATUS_BAR;
+import static android.content.Context.BIND_ADJUST_BELOW_PERCEPTIBLE;
+import static android.content.Context.BIND_ALLOW_WHITELIST_MANAGEMENT;
+import static android.content.Context.BIND_AUTO_CREATE;
+import static android.content.Context.BIND_FOREGROUND_SERVICE;
 import static android.content.pm.PackageManager.FEATURE_LEANBACK;
 import static android.content.pm.PackageManager.FEATURE_TELEVISION;
 import static android.content.pm.PackageManager.PERMISSION_GRANTED;
@@ -334,6 +338,8 @@ public class NotificationManagerService extends SystemService {
 
     private long[] mFallbackVibrationPattern;
     private boolean mUseAttentionLight;
+    boolean mHasLight = true;
+    boolean mLightEnabled;
     boolean mSystemReady;
 
     private boolean mDisableNotificationEffects;
@@ -348,9 +354,9 @@ public class NotificationManagerService extends SystemService {
     private int mInterruptionFilter = NotificationListenerService.INTERRUPTION_FILTER_UNKNOWN;
 
     // for enabling and disabling notification pulse behavior
-    private boolean mScreenOn = true;
+    boolean mScreenOn = true;
     protected boolean mInCall = false;
-    private boolean mNotificationPulseEnabled;
+    boolean mNotificationPulseEnabled;
 
     private Uri mInCallNotificationUri;
     private AudioAttributes mInCallNotificationAudioAttributes;
@@ -1211,7 +1217,8 @@ public class NotificationManagerService extends SystemService {
             ContentResolver resolver = getContext().getContentResolver();
             if (uri == null || NOTIFICATION_LIGHT_PULSE_URI.equals(uri)) {
                 boolean pulseEnabled = Settings.System.getIntForUser(resolver,
-                            Settings.System.NOTIFICATION_LIGHT_PULSE, 0, UserHandle.USER_CURRENT) != 0;
+                            Settings.System.NOTIFICATION_LIGHT_PULSE, 0, UserHandle.USER_CURRENT)
+                        != 0;
                 if (mNotificationPulseEnabled != pulseEnabled) {
                     mNotificationPulseEnabled = pulseEnabled;
                     updateNotificationPulse();
@@ -1474,6 +1481,8 @@ public class NotificationManagerService extends SystemService {
         mInCallNotificationVolume = resources.getFloat(R.dimen.config_inCallNotificationVolume);
 
         mUseAttentionLight = resources.getBoolean(R.bool.config_useAttentionLight);
+        mHasLight =
+                resources.getBoolean(com.android.internal.R.bool.config_intrusiveNotificationLed);
 
         // Don't start allowing notifications until the setup wizard has run once.
         // After that, including subsequent boots, init with notifications turned on.
@@ -2136,6 +2145,10 @@ public class NotificationManagerService extends SystemService {
             enforceSystemOrSystemUI("setNotificationsEnabledForPackage");
 
             mRankingHelper.setEnabled(pkg, uid, enabled);
+            mMetricsLogger.write(new LogMaker(MetricsEvent.ACTION_BAN_APP_NOTES)
+                    .setType(MetricsEvent.TYPE_ACTION)
+                    .setPackageName(pkg)
+                    .setSubtype(enabled ? 1 : 0));
             // Now, cancel any outstanding notifications that are part of a just-disabled app
             if (!enabled) {
                 cancelAllNotificationsInt(MY_UID, MY_PID, pkg, null, 0, 0, true,
@@ -3847,6 +3860,7 @@ public class NotificationManagerService extends SystemService {
                         pw.println("  ");
                     }
                     pw.println("  mUseAttentionLight=" + mUseAttentionLight);
+                    pw.println("  mHasLight=" + mHasLight);
                     pw.println("  mNotificationPulseEnabled=" + mNotificationPulseEnabled);
                     pw.println("  mSoundNotificationKey=" + mSoundNotificationKey);
                     pw.println("  mVibrateNotificationKey=" + mVibrateNotificationKey);
@@ -4544,6 +4558,15 @@ public class NotificationManagerService extends SystemService {
     @GuardedBy("mNotificationLock")
     @VisibleForTesting
     protected boolean isVisuallyInterruptive(NotificationRecord old, NotificationRecord r) {
+        // Ignore summary updates because we don't display most of the information.
+        if (r.sbn.isGroup() && r.sbn.getNotification().isGroupSummary()) {
+            if (DEBUG_INTERRUPTIVENESS) {
+                Log.v(TAG, "INTERRUPTIVENESS: "
+                        +  r.getKey() + " is not interruptive: summary");
+            }
+            return false;
+        }
+
         if (old == null) {
             if (DEBUG_INTERRUPTIVENESS) {
                 Log.v(TAG, "INTERRUPTIVENESS: "
@@ -4581,15 +4604,6 @@ public class NotificationManagerService extends SystemService {
             return false;
         }
 
-        // Ignore summary updates because we don't display most of the information.
-        if (r.sbn.isGroup() && r.sbn.getNotification().isGroupSummary()) {
-            if (DEBUG_INTERRUPTIVENESS) {
-                Log.v(TAG, "INTERRUPTIVENESS: "
-                        +  r.getKey() + " is not interruptive: summary");
-            }
-            return false;
-        }
-
         final String oldTitle = String.valueOf(oldN.extras.get(Notification.EXTRA_TITLE));
         final String newTitle = String.valueOf(newN.extras.get(Notification.EXTRA_TITLE));
         if (!Objects.equals(oldTitle, newTitle)) {
@@ -4844,8 +4858,7 @@ public class NotificationManagerService extends SystemService {
         // light
         // release the light
         boolean wasShowLights = mLights.remove(key);
-        if (record.getLight() != null
-                && (aboveThreshold || isLedForcedOn(record))) {
+        if (canShowLightsLocked(record, aboveThreshold)) {
             mLights.add(key);
             updateLightsLocked();
             if (mUseAttentionLight) {
@@ -4856,7 +4869,19 @@ public class NotificationManagerService extends SystemService {
             updateLightsLocked();
         }
         if (buzz || beep || blink) {
-            record.setInterruptive(true);
+            // Ignore summary updates because we don't display most of the information.
+            if (record.sbn.isGroup() && record.sbn.getNotification().isGroupSummary()) {
+                if (DEBUG_INTERRUPTIVENESS) {
+                    Log.v(TAG, "INTERRUPTIVENESS: "
+                            + record.getKey() + " is not interruptive: summary");
+                }
+            } else {
+                if (DEBUG_INTERRUPTIVENESS) {
+                    Log.v(TAG, "INTERRUPTIVENESS: "
+                            + record.getKey() + " is interruptive: alerted");
+                }
+                record.setInterruptive(true);
+            }
             MetricsLogger.action(record.getLogMaker()
                     .setCategory(MetricsEvent.NOTIFICATION_ALERT)
                     .setType(MetricsEvent.TYPE_OPEN)
@@ -4865,12 +4890,52 @@ public class NotificationManagerService extends SystemService {
         }
     }
 
+    @GuardedBy("mNotificationLock")
+    boolean canShowLightsLocked(final NotificationRecord record, boolean aboveThreshold) {
+        // device lacks light
+        if (!mHasLight) {
+            return false;
+        }
+        // Forced on
+        // Used by LineageParts light picker
+        // eg to allow selecting battery light color when notification led is turned off.
+        if (isLedForcedOn(record)) {
+            return true;
+        }
+        // user turned lights off globally
+        if (!mNotificationPulseEnabled) {
+            return false;
+        }
+        // the notification/channel has no light
+        if (record.getLight() == null) {
+            return false;
+        }
+        // unimportant notification
+        if (!aboveThreshold) {
+            return false;
+        }
+        // Suppressed because it's a silent update
+        final Notification notification = record.getNotification();
+        if (record.isUpdate && (notification.flags & Notification.FLAG_ONLY_ALERT_ONCE) != 0) {
+            return false;
+        }
+        // Suppressed because another notification in its group handles alerting
+        if (record.sbn.isGroup() && record.getNotification().suppressAlertingDueToGrouping()) {
+            return false;
+        }
+        // not if in call or the screen's on
+        if (mInCall || mScreenOn) {
+            return false;
+        }
+
+        return true;
+    }
+
     @GuardedBy("mNotificationLock")
     boolean shouldMuteNotificationLocked(final NotificationRecord record) {
         // Suppressed because it's a silent update
         final Notification notification = record.getNotification();
-        if(record.isUpdate
-                && (notification.flags & Notification.FLAG_ONLY_ALERT_ONCE) != 0) {
+        if (record.isUpdate && (notification.flags & Notification.FLAG_ONLY_ALERT_ONCE) != 0) {
             return true;
         }
 
@@ -6496,6 +6561,16 @@ public class NotificationManagerService extends SystemService {
 
         }
 
+        @Override
+        protected int getBindFlags() {
+            // Most of the same flags as the base, but also add BIND_ADJUST_BELOW_PERCEPTIBLE
+            // because too many 3P apps could be kept in memory as notification listeners and
+            // cause extreme memory pressure.
+            // TODO: Change the binding lifecycle of NotificationListeners to avoid this situation.
+            return BIND_AUTO_CREATE | BIND_FOREGROUND_SERVICE
+                    | BIND_ADJUST_BELOW_PERCEPTIBLE | BIND_ALLOW_WHITELIST_MANAGEMENT;
+        }
+
         @Override
         protected Config getConfig() {
             Config c = new Config();
diff --git a/services/core/java/com/android/server/notification/NotificationRecord.java b/services/core/java/com/android/server/notification/NotificationRecord.java
index c41a263ceb3..45b058f6657 100644
--- a/services/core/java/com/android/server/notification/NotificationRecord.java
+++ b/services/core/java/com/android/server/notification/NotificationRecord.java
@@ -128,6 +128,11 @@ public final class NotificationRecord {
     // The most recent update time, or the creation time if no updates.
     private long mUpdateTimeMs;
 
+    // The most recent interruption time, or the creation time if no updates. Differs from the
+    // above value because updates are filtered based on whether they actually interrupted the
+    // user
+    private long mInterruptionTimeMs;
+
     // Is this record an update of an old record?
     public boolean isUpdate;
     private int mPackagePriority;
@@ -180,6 +185,7 @@ public final class NotificationRecord {
         mRankingTimeMs = calculateRankingTimeMs(0L);
         mCreationTimeMs = sbn.getPostTime();
         mUpdateTimeMs = mCreationTimeMs;
+        mInterruptionTimeMs = mCreationTimeMs;
         mContext = context;
         stats = new NotificationUsageStats.SingleNotificationStats();
         mChannel = channel;
@@ -530,6 +536,7 @@ public final class NotificationRecord {
         pw.println(prefix + "mCreationTimeMs=" + mCreationTimeMs);
         pw.println(prefix + "mVisibleSinceMs=" + mVisibleSinceMs);
         pw.println(prefix + "mUpdateTimeMs=" + mUpdateTimeMs);
+        pw.println(prefix + "mInterruptionTimeMs=" + mInterruptionTimeMs);
         pw.println(prefix + "mSuppressedVisualEffects= " + mSuppressedVisualEffects);
         if (mPreChannelsNotification) {
             pw.println(prefix + String.format("defaults=0x%08x flags=0x%08x",
@@ -791,6 +798,10 @@ public final class NotificationRecord {
         return mVisibleSinceMs == 0 ? 0 : (int) (now - mVisibleSinceMs);
     }
 
+    public int getInterruptionMs(long now) {
+        return (int) (now - mInterruptionTimeMs);
+    }
+
     /**
      * Set the visibility of the notification.
      */
@@ -849,7 +860,7 @@ public final class NotificationRecord {
     public void setSeen() {
         mStats.setSeen();
         if (mTextChanged) {
-            mIsInterruptive = true;
+            setInterruptive(true);
         }
     }
 
@@ -945,6 +956,17 @@ public final class NotificationRecord {
 
     public void setInterruptive(boolean interruptive) {
         mIsInterruptive = interruptive;
+        final long now = System.currentTimeMillis();
+        mInterruptionTimeMs = interruptive ? now : mInterruptionTimeMs;
+
+        if (interruptive) {
+            MetricsLogger.action(getLogMaker()
+                    .setCategory(MetricsEvent.NOTIFICATION_INTERRUPTION)
+                    .setType(MetricsEvent.TYPE_OPEN)
+                    .addTaggedData(MetricsEvent.NOTIFICATION_SINCE_INTERRUPTION_MILLIS,
+                            getInterruptionMs(now)));
+            MetricsLogger.histogram(mContext, "note_interruptive", getInterruptionMs(now));
+        }
     }
 
     public void setTextChanged(boolean textChanged) {
@@ -1121,7 +1143,9 @@ public final class NotificationRecord {
                         sbn.getNotification().isGroupSummary() ? 1 : 0)
                 .addTaggedData(MetricsEvent.NOTIFICATION_SINCE_CREATE_MILLIS, getLifespanMs(now))
                 .addTaggedData(MetricsEvent.NOTIFICATION_SINCE_UPDATE_MILLIS, getFreshnessMs(now))
-                .addTaggedData(MetricsEvent.NOTIFICATION_SINCE_VISIBLE_MILLIS, getExposureMs(now));
+                .addTaggedData(MetricsEvent.NOTIFICATION_SINCE_VISIBLE_MILLIS, getExposureMs(now))
+                .addTaggedData(MetricsEvent.NOTIFICATION_SINCE_INTERRUPTION_MILLIS,
+                        getInterruptionMs(now));
     }
 
     public LogMaker getLogMaker() {
diff --git a/services/core/java/com/android/server/notification/ZenLog.java b/services/core/java/com/android/server/notification/ZenLog.java
index 67608753a2c..b016fafa3d2 100644
--- a/services/core/java/com/android/server/notification/ZenLog.java
+++ b/services/core/java/com/android/server/notification/ZenLog.java
@@ -36,7 +36,8 @@ import java.util.List;
 
 public class ZenLog {
     private static final String TAG = "ZenLog";
-    private static final boolean DEBUG = Build.IS_DEBUGGABLE;
+    // the ZenLog is *very* verbose, so be careful about setting this to true
+    private static final boolean DEBUG = false;
 
     private static final int SIZE = Build.IS_DEBUGGABLE ? 100 : 20;
 
diff --git a/services/core/java/com/android/server/notification/ZenModeConditions.java b/services/core/java/com/android/server/notification/ZenModeConditions.java
index 63c0bafe389..b080a73c1e4 100644
--- a/services/core/java/com/android/server/notification/ZenModeConditions.java
+++ b/services/core/java/com/android/server/notification/ZenModeConditions.java
@@ -19,7 +19,6 @@ package com.android.server.notification;
 import android.content.ComponentName;
 import android.net.Uri;
 import android.service.notification.Condition;
-import android.service.notification.IConditionListener;
 import android.service.notification.IConditionProvider;
 import android.service.notification.ZenModeConfig;
 import android.service.notification.ZenModeConfig.ZenRule;
@@ -27,6 +26,8 @@ import android.util.ArrayMap;
 import android.util.ArraySet;
 import android.util.Log;
 
+import com.android.internal.annotations.VisibleForTesting;
+
 import java.io.PrintWriter;
 import java.util.Objects;
 
@@ -36,7 +37,9 @@ public class ZenModeConditions implements ConditionProviders.Callback {
 
     private final ZenModeHelper mHelper;
     private final ConditionProviders mConditionProviders;
-    private final ArrayMap<Uri, ComponentName> mSubscriptions = new ArrayMap<>();
+
+    @VisibleForTesting
+    protected final ArrayMap<Uri, ComponentName> mSubscriptions = new ArrayMap<>();
 
     private boolean mFirstEvaluation = true;
 
@@ -59,7 +62,8 @@ public class ZenModeConditions implements ConditionProviders.Callback {
         pw.print(prefix); pw.print("mSubscriptions="); pw.println(mSubscriptions);
     }
 
-    public void evaluateConfig(ZenModeConfig config, boolean processSubscriptions) {
+    public void evaluateConfig(ZenModeConfig config, ComponentName trigger,
+            boolean processSubscriptions) {
         if (config == null) return;
         if (config.manualRule != null && config.manualRule.condition != null
                 && !config.manualRule.isTrueOrUnknown()) {
@@ -67,9 +71,9 @@ public class ZenModeConditions implements ConditionProviders.Callback {
             config.manualRule = null;
         }
         final ArraySet<Uri> current = new ArraySet<>();
-        evaluateRule(config.manualRule, current, processSubscriptions);
+        evaluateRule(config.manualRule, current, null, processSubscriptions);
         for (ZenRule automaticRule : config.automaticRules.values()) {
-            evaluateRule(automaticRule, current, processSubscriptions);
+            evaluateRule(automaticRule, current, trigger, processSubscriptions);
             updateSnoozing(automaticRule);
         }
 
@@ -102,7 +106,7 @@ public class ZenModeConditions implements ConditionProviders.Callback {
     @Override
     public void onServiceAdded(ComponentName component) {
         if (DEBUG) Log.d(TAG, "onServiceAdded " + component);
-        mHelper.setConfig(mHelper.getConfig(), "zmc.onServiceAdded");
+        mHelper.setConfig(mHelper.getConfig(), component, "zmc.onServiceAdded");
     }
 
     @Override
@@ -110,17 +114,22 @@ public class ZenModeConditions implements ConditionProviders.Callback {
         if (DEBUG) Log.d(TAG, "onConditionChanged " + id + " " + condition);
         ZenModeConfig config = mHelper.getConfig();
         if (config == null) return;
+        ComponentName trigger = null;
         boolean updated = updateCondition(id, condition, config.manualRule);
         for (ZenRule automaticRule : config.automaticRules.values()) {
             updated |= updateCondition(id, condition, automaticRule);
             updated |= updateSnoozing(automaticRule);
+            if (updated) {
+                trigger = automaticRule.component;
+            }
         }
         if (updated) {
-            mHelper.setConfig(config, "conditionChanged");
+            mHelper.setConfig(config, trigger, "conditionChanged");
         }
     }
 
-    private void evaluateRule(ZenRule rule, ArraySet<Uri> current, boolean processSubscriptions) {
+    private void evaluateRule(ZenRule rule, ArraySet<Uri> current, ComponentName trigger,
+            boolean processSubscriptions) {
         if (rule == null || rule.conditionId == null) return;
         final Uri id = rule.conditionId;
         boolean isSystemCondition = false;
@@ -146,7 +155,9 @@ public class ZenModeConditions implements ConditionProviders.Callback {
         if (current != null) {
             current.add(id);
         }
-        if (processSubscriptions) {
+        if (processSubscriptions && ((trigger != null && trigger.equals(rule.component))
+                || isSystemCondition)) {
+            if (DEBUG) Log.d(TAG, "Subscribing to " + rule.component);
             if (mConditionProviders.subscribeIfNecessary(rule.component, rule.conditionId)) {
                 synchronized (mSubscriptions) {
                     mSubscriptions.put(rule.conditionId, rule.component);
diff --git a/services/core/java/com/android/server/notification/ZenModeHelper.java b/services/core/java/com/android/server/notification/ZenModeHelper.java
index 669d5565534..0c42f8ab834 100644
--- a/services/core/java/com/android/server/notification/ZenModeHelper.java
+++ b/services/core/java/com/android/server/notification/ZenModeHelper.java
@@ -102,7 +102,7 @@ public class ZenModeHelper {
     private final ZenModeFiltering mFiltering;
     protected final RingerModeDelegate mRingerModeDelegate = new
             RingerModeDelegate();
-    private final ZenModeConditions mConditions;
+    @VisibleForTesting protected final ZenModeConditions mConditions;
     private final SparseArray<ZenModeConfig> mConfigs = new SparseArray<>();
     private final Metrics mMetrics = new Metrics();
     private final ConditionProviders.Config mServiceConfig;
@@ -225,7 +225,7 @@ public class ZenModeHelper {
             config.user = user;
         }
         synchronized (mConfig) {
-            setConfigLocked(config, reason);
+            setConfigLocked(config, null, reason);
         }
         cleanUpZenRules();
     }
@@ -312,7 +312,7 @@ public class ZenModeHelper {
             ZenRule rule = new ZenRule();
             populateZenRule(automaticZenRule, rule, true);
             newConfig.automaticRules.put(rule.id, rule);
-            if (setConfigLocked(newConfig, reason, true)) {
+            if (setConfigLocked(newConfig, reason, rule.component, true)) {
                 return rule.id;
             } else {
                 throw new AndroidRuntimeException("Could not create rule");
@@ -342,7 +342,7 @@ public class ZenModeHelper {
             }
             populateZenRule(automaticZenRule, rule, false);
             newConfig.automaticRules.put(ruleId, rule);
-            return setConfigLocked(newConfig, reason, true);
+            return setConfigLocked(newConfig, reason, rule.component, true);
         }
     }
 
@@ -360,7 +360,7 @@ public class ZenModeHelper {
                 throw new SecurityException(
                         "Cannot delete rules not owned by your condition provider");
             }
-            return setConfigLocked(newConfig, reason, true);
+            return setConfigLocked(newConfig, reason, null, true);
         }
     }
 
@@ -376,7 +376,7 @@ public class ZenModeHelper {
                     newConfig.automaticRules.removeAt(i);
                 }
             }
-            return setConfigLocked(newConfig, reason, true);
+            return setConfigLocked(newConfig, reason, null, true);
         }
     }
 
@@ -537,7 +537,7 @@ public class ZenModeHelper {
                 newRule.enabler = caller;
                 newConfig.manualRule = newRule;
             }
-            setConfigLocked(newConfig, reason, setRingerMode);
+            setConfigLocked(newConfig, reason, null, setRingerMode);
         }
     }
 
@@ -644,7 +644,7 @@ public class ZenModeHelper {
             }
             if (DEBUG) Log.d(TAG, reason);
             synchronized (mConfig) {
-                setConfigLocked(config, reason);
+                setConfigLocked(config, null, reason);
             }
         }
     }
@@ -673,7 +673,7 @@ public class ZenModeHelper {
         synchronized (mConfig) {
             final ZenModeConfig newConfig = mConfig.copy();
             newConfig.applyNotificationPolicy(policy);
-            setConfigLocked(newConfig, "setNotificationPolicy");
+            setConfigLocked(newConfig, null, "setNotificationPolicy");
         }
     }
 
@@ -697,7 +697,7 @@ public class ZenModeHelper {
                     }
                 }
             }
-            setConfigLocked(newConfig, "cleanUpZenRules");
+            setConfigLocked(newConfig, null, "cleanUpZenRules");
         }
     }
 
@@ -710,17 +710,19 @@ public class ZenModeHelper {
         }
     }
 
-    public boolean setConfigLocked(ZenModeConfig config, String reason) {
-        return setConfigLocked(config, reason, true /*setRingerMode*/);
+    public boolean setConfigLocked(ZenModeConfig config, ComponentName triggeringComponent,
+            String reason) {
+        return setConfigLocked(config, reason, triggeringComponent, true /*setRingerMode*/);
     }
 
-    public void setConfig(ZenModeConfig config, String reason) {
+    public void setConfig(ZenModeConfig config, ComponentName triggeringComponent, String reason) {
         synchronized (mConfig) {
-            setConfigLocked(config, reason);
+            setConfigLocked(config, triggeringComponent, reason);
         }
     }
 
-    private boolean setConfigLocked(ZenModeConfig config, String reason, boolean setRingerMode) {
+    private boolean setConfigLocked(ZenModeConfig config, String reason,
+            ComponentName triggeringComponent, boolean setRingerMode) {
         final long identity = Binder.clearCallingIdentity();
         try {
             if (config == null || !config.isValid()) {
@@ -733,7 +735,8 @@ public class ZenModeHelper {
                 if (DEBUG) Log.d(TAG, "setConfigLocked: store config for user " + config.user);
                 return true;
             }
-            mConditions.evaluateConfig(config, false /*processSubscriptions*/);  // may modify config
+            // may modify config
+            mConditions.evaluateConfig(config, null, false /*processSubscriptions*/);
             mConfigs.put(config.user, config);
             if (DEBUG) Log.d(TAG, "setConfigLocked reason=" + reason, new Throwable());
             ZenLog.traceConfig(reason, mConfig, config);
@@ -746,7 +749,7 @@ public class ZenModeHelper {
                 dispatchOnPolicyChanged();
             }
             mConfig = config;
-            mHandler.postApplyConfig(config, reason, setRingerMode);
+            mHandler.postApplyConfig(config, reason, triggeringComponent, setRingerMode);
             return true;
         } catch (SecurityException e) {
             Log.wtf(TAG, "Invalid rule in config", e);
@@ -756,13 +759,14 @@ public class ZenModeHelper {
         }
     }
 
-    private void applyConfig(ZenModeConfig config, String reason, boolean setRingerMode) {
+    private void applyConfig(ZenModeConfig config, String reason,
+            ComponentName triggeringComponent, boolean setRingerMode) {
         final String val = Integer.toString(config.hashCode());
         Global.putString(mContext.getContentResolver(), Global.ZEN_MODE_CONFIG_ETAG, val);
         if (!evaluateZenMode(reason, setRingerMode)) {
             applyRestrictions();  // evaluateZenMode will also apply restrictions if changed
         }
-        mConditions.evaluateConfig(config, true /*processSubscriptions*/);
+        mConditions.evaluateConfig(config, triggeringComponent, true /*processSubscriptions*/);
     }
 
     private int getZenModeSetting() {
@@ -1260,13 +1264,16 @@ public class ZenModeHelper {
 
         private final class ConfigMessageData {
             public final ZenModeConfig config;
+            public ComponentName triggeringComponent;
             public final String reason;
             public final boolean setRingerMode;
 
-            ConfigMessageData(ZenModeConfig config, String reason, boolean setRingerMode) {
+            ConfigMessageData(ZenModeConfig config, String reason,
+                    ComponentName triggeringComponent, boolean setRingerMode) {
                 this.config = config;
                 this.reason = reason;
                 this.setRingerMode = setRingerMode;
+                this.triggeringComponent = triggeringComponent;
             }
         }
 
@@ -1286,9 +1293,10 @@ public class ZenModeHelper {
             sendEmptyMessageDelayed(MSG_METRICS, METRICS_PERIOD_MS);
         }
 
-        private void postApplyConfig(ZenModeConfig config, String reason, boolean setRingerMode) {
+        private void postApplyConfig(ZenModeConfig config, String reason,
+                ComponentName triggeringComponent, boolean setRingerMode) {
             sendMessage(obtainMessage(MSG_APPLY_CONFIG,
-                    new ConfigMessageData(config, reason, setRingerMode)));
+                    new ConfigMessageData(config, reason, triggeringComponent, setRingerMode)));
         }
 
         @Override
@@ -1303,7 +1311,7 @@ public class ZenModeHelper {
                 case MSG_APPLY_CONFIG:
                     ConfigMessageData applyConfigData = (ConfigMessageData) msg.obj;
                     applyConfig(applyConfigData.config, applyConfigData.reason,
-                            applyConfigData.setRingerMode);
+                            applyConfigData.triggeringComponent, applyConfigData.setRingerMode);
             }
         }
     }
diff --git a/services/core/java/com/android/server/om/OverlayManagerService.java b/services/core/java/com/android/server/om/OverlayManagerService.java
index a0da1526ac0..4c39a517461 100644
--- a/services/core/java/com/android/server/om/OverlayManagerService.java
+++ b/services/core/java/com/android/server/om/OverlayManagerService.java
@@ -22,11 +22,14 @@ import static android.content.Intent.ACTION_PACKAGE_CHANGED;
 import static android.content.Intent.ACTION_PACKAGE_REMOVED;
 import static android.content.Intent.ACTION_USER_ADDED;
 import static android.content.Intent.ACTION_USER_REMOVED;
+import static android.content.pm.PackageManager.GET_SHARED_LIBRARY_FILES;
+import static android.content.pm.PackageManager.MATCH_SYSTEM_ONLY;
 import static android.content.pm.PackageManager.SIGNATURE_MATCH;
 
 import android.annotation.NonNull;
 import android.annotation.Nullable;
 import android.app.ActivityManager;
+import android.app.ActivityThread;
 import android.app.IActivityManager;
 import android.content.BroadcastReceiver;
 import android.content.Context;
@@ -34,6 +37,7 @@ import android.content.Intent;
 import android.content.IntentFilter;
 import android.content.om.IOverlayManager;
 import android.content.om.OverlayInfo;
+import android.content.pm.ApplicationInfo;
 import android.content.pm.IPackageManager;
 import android.content.pm.PackageInfo;
 import android.content.pm.PackageManagerInternal;
@@ -269,13 +273,30 @@ public final class OverlayManagerService extends SystemService {
 
     @Override
     public void onBootPhase(int phase) {
-        if (phase == PHASE_SYSTEM_SERVICES_READY) {
+        if (phase == PHASE_SYSTEM_SERVICES_READY && mInitCompleteSignal != null) {
             ConcurrentUtils.waitForFutureNoInterrupt(mInitCompleteSignal,
                     "Wait for OverlayManagerService init");
             mInitCompleteSignal = null;
         }
     }
 
+    public void updateSystemUiContext() {
+        if (mInitCompleteSignal != null) {
+            ConcurrentUtils.waitForFutureNoInterrupt(mInitCompleteSignal,
+                    "Wait for OverlayManagerService init");
+            mInitCompleteSignal = null;
+        }
+
+        final ApplicationInfo ai;
+        try {
+            ai = mPackageManager.mPackageManager.getApplicationInfo("android",
+                    GET_SHARED_LIBRARY_FILES, UserHandle.USER_SYSTEM);
+        } catch (RemoteException e) {
+            throw e.rethrowAsRuntimeException();
+        }
+        ActivityThread.currentActivityThread().handleSystemApplicationInfoChanged(ai);
+    }
+
     private void initIfNeeded() {
         final UserManager um = getContext().getSystemService(UserManager.class);
         final List<UserInfo> users = um.getUsers(true /*excludeDying*/);
diff --git a/services/core/java/com/android/server/pm/BackgroundDexOptService.java b/services/core/java/com/android/server/pm/BackgroundDexOptService.java
index 0774672b2fd..d6ab5f71756 100644
--- a/services/core/java/com/android/server/pm/BackgroundDexOptService.java
+++ b/services/core/java/com/android/server/pm/BackgroundDexOptService.java
@@ -489,7 +489,7 @@ public class BackgroundDexOptService extends JobService {
         PinnerService pinnerService = LocalServices.getService(PinnerService.class);
         if (pinnerService != null) {
             Log.i(TAG, "Pinning optimized code " + updatedPackages);
-            pinnerService.update(updatedPackages);
+            pinnerService.update(updatedPackages, false /* force */);
         }
     }
 
diff --git a/services/core/java/com/android/server/pm/PackageDexOptimizer.java b/services/core/java/com/android/server/pm/PackageDexOptimizer.java
index b0be4a9799b..55b194078a6 100644
--- a/services/core/java/com/android/server/pm/PackageDexOptimizer.java
+++ b/services/core/java/com/android/server/pm/PackageDexOptimizer.java
@@ -34,6 +34,7 @@ import android.util.Slog;
 import com.android.internal.annotations.GuardedBy;
 import com.android.internal.util.IndentingPrintWriter;
 import com.android.server.pm.Installer.InstallerException;
+import com.android.server.pm.dex.ArtManagerService;
 import com.android.server.pm.dex.DexManager;
 import com.android.server.pm.dex.DexoptOptions;
 import com.android.server.pm.dex.DexoptUtils;
@@ -289,7 +290,8 @@ public class PackageDexOptimizer {
             mInstaller.dexopt(path, uid, pkg.packageName, isa, dexoptNeeded, oatDir, dexoptFlags,
                     compilerFilter, pkg.volumeUuid, classLoaderContext, pkg.applicationInfo.seInfo,
                     false /* downgrade*/, pkg.applicationInfo.targetSdkVersion,
-                    profileName, dexMetadataPath, getReasonName(compilationReason));
+                    profileName, dexMetadataPath,
+                    getAugmentedReasonName(compilationReason, dexMetadataPath != null));
 
             if (packageStats != null) {
                 long endTime = System.currentTimeMillis();
@@ -302,6 +304,12 @@ public class PackageDexOptimizer {
         }
     }
 
+    private String getAugmentedReasonName(int compilationReason, boolean useDexMetadata) {
+        String annotation = useDexMetadata
+                ? ArtManagerService.DEXOPT_REASON_WITH_DEX_METADATA_ANNOTATION : "";
+        return getReasonName(compilationReason) + annotation;
+    }
+
     /**
      * Performs dexopt on the secondary dex {@code path} belonging to the app {@code info}.
      *
diff --git a/services/core/java/com/android/server/pm/PackageManagerService.java b/services/core/java/com/android/server/pm/PackageManagerService.java
index d7655cc005e..f306b3f2ab4 100644
--- a/services/core/java/com/android/server/pm/PackageManagerService.java
+++ b/services/core/java/com/android/server/pm/PackageManagerService.java
@@ -14046,6 +14046,68 @@ public class PackageManagerService extends IPackageManager.Stub
         return false;
     }
 
+    @Override
+    public void setSystemAppHiddenUntilInstalled(String packageName, boolean hidden) {
+        enforceSystemOrPhoneCaller("setSystemAppHiddenUntilInstalled");
+        synchronized (mPackages) {
+            final PackageSetting pkgSetting = mSettings.mPackages.get(packageName);
+            if (pkgSetting == null || !pkgSetting.isSystem()) {
+                return;
+            }
+            PackageParser.Package pkg = pkgSetting.pkg;
+            if (pkg != null && pkg.applicationInfo != null) {
+                pkg.applicationInfo.hiddenUntilInstalled = hidden;
+            }
+            final PackageSetting disabledPs = mSettings.getDisabledSystemPkgLPr(packageName);
+            if (disabledPs == null) {
+                return;
+            }
+            pkg = disabledPs.pkg;
+            if (pkg != null && pkg.applicationInfo != null) {
+                pkg.applicationInfo.hiddenUntilInstalled = hidden;
+            }
+        }
+    }
+
+    @Override
+    public boolean setSystemAppInstallState(String packageName, boolean installed, int userId) {
+        enforceSystemOrPhoneCaller("setSystemAppInstallState");
+        synchronized (mPackages) {
+            final PackageSetting pkgSetting = mSettings.mPackages.get(packageName);
+            // The target app should always be in system
+            if (pkgSetting == null || !pkgSetting.isSystem()) {
+                return false;
+            }
+            // Check if the install state is the same
+            if (pkgSetting.getInstalled(userId) == installed) {
+                return false;
+            }
+        }
+
+        final long callingId = Binder.clearCallingIdentity();
+        try {
+            if (installed) {
+                // install the app from uninstalled state
+                installExistingPackageAsUser(
+                        packageName,
+                        userId,
+                        0 /*installFlags*/,
+                        PackageManager.INSTALL_REASON_DEVICE_SETUP);
+                return true;
+            }
+
+            // uninstall the app from installed state
+            deletePackageVersioned(
+                    new VersionedPackage(packageName, PackageManager.VERSION_CODE_HIGHEST),
+                    new LegacyPackageDeleteObserver(null).getBinder(),
+                    userId,
+                    PackageManager.DELETE_SYSTEM_APP);
+            return true;
+        } finally {
+            Binder.restoreCallingIdentity(callingId);
+        }
+    }
+
     private void sendApplicationHiddenForUser(String packageName, PackageSetting pkgSetting,
             int userId) {
         final PackageRemovedInfo info = new PackageRemovedInfo(this);
@@ -14110,10 +14172,16 @@ public class PackageManagerService extends IPackageManager.Stub
     @Override
     public int installExistingPackageAsUser(String packageName, int userId, int installFlags,
             int installReason) {
-        mContext.enforceCallingOrSelfPermission(android.Manifest.permission.INSTALL_PACKAGES,
-                null);
-        PackageSetting pkgSetting;
         final int callingUid = Binder.getCallingUid();
+        if (mContext.checkCallingOrSelfPermission(android.Manifest.permission.INSTALL_PACKAGES)
+                != PackageManager.PERMISSION_GRANTED
+                && mContext.checkCallingOrSelfPermission(
+                        android.Manifest.permission.INSTALL_EXISTING_PACKAGES)
+                != PackageManager.PERMISSION_GRANTED) {
+            throw new SecurityException("Neither user " + callingUid + " nor current process has "
+                    + android.Manifest.permission.INSTALL_PACKAGES + ".");
+        }
+        PackageSetting pkgSetting;
         mPermissionManager.enforceCrossUserPermission(callingUid, userId,
                 true /* requireFullPermission */, true /* checkShell */,
                 "installExistingPackage for user " + userId);
@@ -21178,6 +21246,8 @@ Slog.v(TAG, ":: stepped forward, applying functor at tag " + parser.getName());
         CarrierAppUtils.disableCarrierAppsUntilPrivileged(mContext.getOpPackageName(), this,
                 mContext.getContentResolver(), UserHandle.USER_SYSTEM);
 
+        disableSkuSpecificApps();
+
         // Read the compatibilty setting when the system is ready.
         boolean compatibilityModeEnabled = android.provider.Settings.Global.getInt(
                 mContext.getContentResolver(),
@@ -21965,6 +22035,27 @@ Slog.v(TAG, ":: stepped forward, applying functor at tag " + parser.getName());
         }
     }
 
+    //TODO: b/111402650
+    private void disableSkuSpecificApps() {
+        String apkList[] = mContext.getResources().getStringArray(
+                R.array.config_disableApksUnlessMatchedSku_apk_list);
+        String skuArray[] = mContext.getResources().getStringArray(
+                R.array.config_disableApkUnlessMatchedSku_skus_list);
+        if (ArrayUtils.isEmpty(apkList)) {
+           return;
+        }
+        String sku = SystemProperties.get("ro.boot.hardware.sku");
+        if (!TextUtils.isEmpty(sku) && ArrayUtils.contains(skuArray, sku)) {
+            return;
+        }
+        for (String packageName : apkList) {
+            setSystemAppHiddenUntilInstalled(packageName, true);
+            for (UserInfo user : sUserManager.getUsers(false)) {
+                setSystemAppInstallState(packageName, false, user.id);
+            }
+        }
+    }
+
     private void dumpProto(FileDescriptor fd) {
         final ProtoOutputStream proto = new ProtoOutputStream(fd);
 
diff --git a/services/core/java/com/android/server/pm/Settings.java b/services/core/java/com/android/server/pm/Settings.java
index a1031f1ce8a..cb2d0b7a986 100644
--- a/services/core/java/com/android/server/pm/Settings.java
+++ b/services/core/java/com/android/server/pm/Settings.java
@@ -4120,7 +4120,8 @@ public final class Settings {
                     continue;
                 }
                 final boolean shouldInstall = ps.isSystem() &&
-                        !ArrayUtils.contains(disallowedPackages, ps.name);
+                        !ArrayUtils.contains(disallowedPackages, ps.name) &&
+                        !ps.pkg.applicationInfo.hiddenUntilInstalled;
                 // Only system apps are initially installed.
                 ps.setInstalled(shouldInstall, userHandle);
                 if (!shouldInstall) {
diff --git a/services/core/java/com/android/server/pm/dex/ArtManagerService.java b/services/core/java/com/android/server/pm/dex/ArtManagerService.java
index 0ba78226a38..21daa39e05e 100644
--- a/services/core/java/com/android/server/pm/dex/ArtManagerService.java
+++ b/services/core/java/com/android/server/pm/dex/ArtManagerService.java
@@ -519,6 +519,11 @@ public class ArtManagerService extends android.content.pm.dex.IArtManager.Stub {
     private static final int TRON_COMPILATION_REASON_AB_OTA = 6;
     private static final int TRON_COMPILATION_REASON_INACTIVE = 7;
     private static final int TRON_COMPILATION_REASON_SHARED = 8;
+    private static final int TRON_COMPILATION_REASON_INSTALL_WITH_DEX_METADATA = 9;
+
+    // The annotation to add as a suffix to the compilation reason when dexopt was
+    // performed with dex metadata.
+    public static final String DEXOPT_REASON_WITH_DEX_METADATA_ANNOTATION = "-dm";
 
     /**
      * Convert the compilation reason to an int suitable to be logged to TRON.
@@ -534,6 +539,10 @@ public class ArtManagerService extends android.content.pm.dex.IArtManager.Stub {
             case "ab-ota" : return TRON_COMPILATION_REASON_AB_OTA;
             case "inactive" : return TRON_COMPILATION_REASON_INACTIVE;
             case "shared" : return TRON_COMPILATION_REASON_SHARED;
+            // This is a special marker for dex metadata installation that does not
+            // have an equivalent as a system property.
+            case "install" + DEXOPT_REASON_WITH_DEX_METADATA_ANNOTATION :
+                return TRON_COMPILATION_REASON_INSTALL_WITH_DEX_METADATA;
             default: return TRON_COMPILATION_REASON_UNKNOWN;
         }
     }
diff --git a/services/core/java/com/android/server/policy/BarController.java b/services/core/java/com/android/server/policy/BarController.java
index f2466bdd668..ca70816f75d 100644
--- a/services/core/java/com/android/server/policy/BarController.java
+++ b/services/core/java/com/android/server/policy/BarController.java
@@ -198,7 +198,7 @@ public class BarController {
     }
 
     protected boolean skipAnimation() {
-        return false;
+        return !mWin.isDrawnLw();
     }
 
     private int computeStateLw(boolean wasVis, boolean wasAnim, WindowState win, boolean change) {
diff --git a/services/core/java/com/android/server/policy/PhoneWindowManager.java b/services/core/java/com/android/server/policy/PhoneWindowManager.java
index 179f4e0e16f..9c1bd91a515 100644
--- a/services/core/java/com/android/server/policy/PhoneWindowManager.java
+++ b/services/core/java/com/android/server/policy/PhoneWindowManager.java
@@ -79,6 +79,7 @@ import static android.view.WindowManager.LayoutParams.PRIVATE_FLAG_KEYGUARD;
 import static android.view.WindowManager.LayoutParams.PRIVATE_FLAG_NAV_HIDE_FORCED;
 import static android.view.WindowManager.LayoutParams.PRIVATE_FLAG_SHOW_FOR_ALL_USERS;
 import static android.view.WindowManager.LayoutParams.PRIVATE_FLAG_STATUS_HIDE_FORCED;
+import static android.view.WindowManager.LayoutParams.PRIVATE_FLAG_STATUS_BAR_EXPANDED;
 import static android.view.WindowManager.LayoutParams.PRIVATE_FLAG_SYSTEM_ERROR;
 import static android.view.WindowManager.LayoutParams.PRIVATE_FLAG_WAS_NOT_FULLSCREEN;
 import static android.view.WindowManager.LayoutParams.ROTATION_ANIMATION_CROSSFADE;
@@ -4951,17 +4952,9 @@ public class PhoneWindowManager implements WindowManagerPolicy {
             if (isKeyguardShowingAndNotOccluded()) {
                 // don't launch home if keyguard showing
                 return;
-            } else if (mKeyguardOccluded && mKeyguardDelegate.isShowing()) {
-                mKeyguardDelegate.dismiss(new KeyguardDismissCallback() {
-                    @Override
-                    public void onDismissSucceeded() throws RemoteException {
-                        mHandler.post(() -> {
-                            startDockOrHome(true /*fromHomeKey*/, awakenFromDreams);
-                        });
-                    }
-                }, null /* message */);
-                return;
-            } else if (!mKeyguardOccluded && mKeyguardDelegate.isInputRestricted()) {
+            }
+
+            if (!mKeyguardOccluded && mKeyguardDelegate.isInputRestricted()) {
                 // when in keyguard restricted mode, must first verify unlock
                 // before launching home
                 mKeyguardDelegate.verifyUnlock(new OnKeyguardExitResult() {
@@ -5246,8 +5239,7 @@ public class PhoneWindowManager implements WindowManagerPolicy {
                 navTranslucent &= areTranslucentBarsAllowed();
             }
             boolean statusBarExpandedNotKeyguard = !isKeyguardShowing && mStatusBar != null
-                    && mStatusBar.getAttrs().height == MATCH_PARENT
-                    && mStatusBar.getAttrs().width == MATCH_PARENT;
+                    && (mStatusBar.getAttrs().privateFlags & PRIVATE_FLAG_STATUS_BAR_EXPANDED) != 0;
 
             // When the navigation bar isn't visible, we put up a fake input window to catch all
             // touch events. This way we can detect when the user presses anywhere to bring back the
@@ -6273,7 +6265,7 @@ public class PhoneWindowManager implements WindowManagerPolicy {
         }
 
         // Take note if a window wants to acquire a sleep token.
-        if (win.isVisibleLw() && (attrs.privateFlags & PRIVATE_FLAG_ACQUIRES_SLEEP_TOKEN) != 0
+        if ((attrs.privateFlags & PRIVATE_FLAG_ACQUIRES_SLEEP_TOKEN) != 0
                 && win.canAcquireSleepToken()) {
             mWindowSleepTokenNeeded = true;
         }
@@ -6329,9 +6321,8 @@ public class PhoneWindowManager implements WindowManagerPolicy {
                 mStatusBarController.setShowTransparent(true /* transparent */);
             }
 
-            WindowManager.LayoutParams statusBarAttrs = mStatusBar.getAttrs();
-            boolean statusBarExpanded = statusBarAttrs.height == MATCH_PARENT
-                    && statusBarAttrs.width == MATCH_PARENT;
+            boolean statusBarExpanded =
+                    (mStatusBar.getAttrs().privateFlags & PRIVATE_FLAG_STATUS_BAR_EXPANDED) != 0;
             boolean topAppHidesStatusBar = topAppHidesStatusBar();
             if (mForceStatusBar || mForceStatusBarFromKeyguard || mForceStatusBarTransparent
                     || statusBarExpanded) {
diff --git a/services/core/java/com/android/server/policy/WindowManagerPolicy.java b/services/core/java/com/android/server/policy/WindowManagerPolicy.java
index 48d991c51cf..1d52bc80c6a 100644
--- a/services/core/java/com/android/server/policy/WindowManagerPolicy.java
+++ b/services/core/java/com/android/server/policy/WindowManagerPolicy.java
@@ -158,6 +158,8 @@ public interface WindowManagerPolicy extends WindowManagerPolicyConstants {
     int FINISH_LAYOUT_REDO_WALLPAPER = 0x0004;
     /** Need to recompute animations */
     int FINISH_LAYOUT_REDO_ANIM = 0x0008;
+    /** Layer for the screen off animation */
+    int COLOR_FADE_LAYER = 0x40000001;
 
     /**
      * Register shortcuts for window manager to dispatch.
diff --git a/services/core/java/com/android/server/slice/PinnedSliceState.java b/services/core/java/com/android/server/slice/PinnedSliceState.java
index 4e7fb969f39..e139ab86775 100644
--- a/services/core/java/com/android/server/slice/PinnedSliceState.java
+++ b/services/core/java/com/android/server/slice/PinnedSliceState.java
@@ -154,8 +154,8 @@ public class PinnedSliceState {
     }
 
     ContentProviderClient getClient() {
-        ContentProviderClient client =
-                mService.getContext().getContentResolver().acquireContentProviderClient(mUri);
+        ContentProviderClient client = mService.getContext().getContentResolver()
+                .acquireUnstableContentProviderClient(mUri);
         if (client == null) return null;
         client.setDetectNotResponding(SLICE_TIMEOUT);
         return client;
diff --git a/services/core/java/com/android/server/trust/TrustManagerService.java b/services/core/java/com/android/server/trust/TrustManagerService.java
index 44136661bee..f9f4bbfc8eb 100644
--- a/services/core/java/com/android/server/trust/TrustManagerService.java
+++ b/services/core/java/com/android/server/trust/TrustManagerService.java
@@ -46,7 +46,6 @@ import android.os.RemoteException;
 import android.os.SystemClock;
 import android.os.UserHandle;
 import android.os.UserManager;
-import android.os.storage.StorageManager;
 import android.provider.Settings;
 import android.service.trust.TrustAgentService;
 import android.text.TextUtils;
@@ -60,7 +59,6 @@ import android.view.IWindowManager;
 import android.view.WindowManagerGlobal;
 import com.android.internal.annotations.GuardedBy;
 import com.android.internal.content.PackageMonitor;
-import com.android.internal.policy.IKeyguardDismissCallback;
 import com.android.internal.util.DumpUtils;
 import com.android.internal.widget.LockPatternUtils;
 import com.android.server.SystemService;
@@ -431,13 +429,20 @@ public class TrustManagerService extends SystemService {
         for (int i = 0; i < userInfos.size(); i++) {
             UserInfo info = userInfos.get(i);
 
-            if (info == null || info.partial || !info.isEnabled() || info.guestToRemove
-                    || !info.supportsSwitchToByUser()) {
+            if (info == null || info.partial || !info.isEnabled() || info.guestToRemove) {
                 continue;
             }
 
             int id = info.id;
             boolean secure = mLockPatternUtils.isSecure(id);
+
+            if (!info.supportsSwitchToByUser()) {
+                if (info.isManagedProfile() && !secure) {
+                    setDeviceLockedForUser(id, false);
+                }
+                continue;
+            }
+
             boolean trusted = aggregateIsTrusted(id);
             boolean showingKeyguard = true;
             boolean fingerprintAuthenticated = false;
@@ -992,7 +997,8 @@ public class TrustManagerService extends SystemService {
             enforceReportPermission();
             final long identity = Binder.clearCallingIdentity();
             try {
-                if (mLockPatternUtils.isSeparateProfileChallengeEnabled(userId)) {
+                if (mLockPatternUtils.isSeparateProfileChallengeEnabled(userId)
+                        && mLockPatternUtils.isSecure(userId)) {
                     synchronized (mDeviceLockedForUser) {
                         mDeviceLockedForUser.put(userId, locked);
                     }
diff --git a/services/core/java/com/android/server/wm/AppWindowToken.java b/services/core/java/com/android/server/wm/AppWindowToken.java
index 08d0ae9dcdd..fa6079c5190 100644
--- a/services/core/java/com/android/server/wm/AppWindowToken.java
+++ b/services/core/java/com/android/server/wm/AppWindowToken.java
@@ -19,6 +19,7 @@ package com.android.server.wm;
 import static android.app.WindowConfiguration.WINDOWING_MODE_PINNED;
 import static android.app.WindowConfiguration.WINDOWING_MODE_SPLIT_SCREEN_PRIMARY;
 import static android.app.WindowConfiguration.WINDOWING_MODE_UNDEFINED;
+import static android.content.pm.ActivityInfo.COLOR_MODE_DEFAULT;
 import static android.content.pm.ActivityInfo.CONFIG_ORIENTATION;
 import static android.content.pm.ActivityInfo.CONFIG_SCREEN_SIZE;
 import static android.content.pm.ActivityInfo.SCREEN_ORIENTATION_BEHIND;
@@ -1377,7 +1378,7 @@ class AppWindowToken extends WindowToken implements WindowManagerService.AppFree
             setAppLayoutChanges(FINISH_LAYOUT_REDO_ANIM, "checkAppWindowsReadyToShow");
 
             // We can now show all of the drawn windows!
-            if (!mService.mOpeningApps.contains(this)) {
+            if (!mService.mOpeningApps.contains(this) && canShowWindows()) {
                 showAllWindowsLocked();
             }
         }
@@ -2270,4 +2271,21 @@ class AppWindowToken extends WindowToken implements WindowManagerService.AppFree
     boolean isClosingOrEnteringPip() {
         return (isAnimating() && hiddenRequested) || mWillCloseOrEnterPip;
     }
+
+    /**
+     * @return Whether we are allowed to show non-starting windows at the moment. We disallow
+     *         showing windows during transitions in case we have windows that have wide-color-gamut
+     *         color mode set to avoid jank in the middle of the transition.
+     */
+    boolean canShowWindows() {
+        return allDrawn && !(isReallyAnimating() && hasNonDefaultColorWindow());
+    }
+
+    /**
+     * @return true if we have a window that has a non-default color mode set; false otherwise.
+     */
+    private boolean hasNonDefaultColorWindow() {
+        return forAllWindows(ws -> ws.mAttrs.getColorMode() != COLOR_MODE_DEFAULT,
+                true /* topToBottom */);
+    }
 }
diff --git a/services/core/java/com/android/server/wm/BoundsAnimationController.java b/services/core/java/com/android/server/wm/BoundsAnimationController.java
index b2a12bef528..86f328d248d 100644
--- a/services/core/java/com/android/server/wm/BoundsAnimationController.java
+++ b/services/core/java/com/android/server/wm/BoundsAnimationController.java
@@ -31,11 +31,13 @@ import android.os.IBinder;
 import android.os.Debug;
 import android.util.ArrayMap;
 import android.util.Slog;
+import android.view.Choreographer;
 import android.view.animation.AnimationUtils;
 import android.view.animation.Interpolator;
 
 import com.android.internal.annotations.VisibleForTesting;
 
+import com.android.internal.graphics.SfVsyncFrameCallbackProvider;
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
 
@@ -112,6 +114,7 @@ public class BoundsAnimationController {
     private final Interpolator mFastOutSlowInInterpolator;
     private boolean mFinishAnimationAfterTransition = false;
     private final AnimationHandler mAnimationHandler;
+    private Choreographer mChoreographer;
 
     private static final int WAIT_FOR_DRAW_TIMEOUT_MS = 3000;
 
@@ -123,6 +126,12 @@ public class BoundsAnimationController {
         mFastOutSlowInInterpolator = AnimationUtils.loadInterpolator(context,
                 com.android.internal.R.interpolator.fast_out_slow_in);
         mAnimationHandler = animationHandler;
+        if (animationHandler != null) {
+            // If an animation handler is provided, then ensure that it runs on the sf vsync tick
+            handler.runWithScissors(() -> mChoreographer = Choreographer.getSfInstance(),
+                    0 /* timeout */);
+            animationHandler.setProvider(new SfVsyncFrameCallbackProvider(mChoreographer));
+        }
     }
 
     @VisibleForTesting
diff --git a/services/core/java/com/android/server/wm/DisplayContent.java b/services/core/java/com/android/server/wm/DisplayContent.java
index 9fbbfdab8f8..7c4d8119a85 100644
--- a/services/core/java/com/android/server/wm/DisplayContent.java
+++ b/services/core/java/com/android/server/wm/DisplayContent.java
@@ -413,7 +413,7 @@ class DisplayContent extends WindowContainer<DisplayContent.DisplayChildWindowCo
         WindowStateAnimator winAnimator = w.mWinAnimator;
         final AppWindowToken atoken = w.mAppToken;
         if (winAnimator.mDrawState == READY_TO_SHOW) {
-            if (atoken == null || atoken.allDrawn) {
+            if (atoken == null || atoken.canShowWindows()) {
                 if (w.performShowLocked()) {
                     pendingLayoutChanges |= FINISH_LAYOUT_REDO_ANIM;
                     if (DEBUG_LAYOUT_REPEATS) {
@@ -1124,11 +1124,12 @@ class DisplayContent extends WindowContainer<DisplayContent.DisplayChildWindowCo
             }
         }
 
+        forAllWindows(w -> {
+            w.forceSeamlesslyRotateIfAllowed(oldRotation, rotation);
+        }, true /* traverseTopToBottom */);
+
         if (rotateSeamlessly) {
-            forAllWindows(w -> {
-                    w.mWinAnimator.seamlesslyRotateWindow(getPendingTransaction(),
-                            oldRotation, rotation);
-            }, true /* traverseTopToBottom */);
+            seamlesslyRotate(getPendingTransaction(), oldRotation, rotation);
         }
 
         mService.mDisplayManagerInternal.performTraversal(getPendingTransaction());
@@ -1270,11 +1271,21 @@ class DisplayContent extends WindowContainer<DisplayContent.DisplayChildWindowCo
                     cutout, mInitialDisplayWidth, mInitialDisplayHeight);
         }
         final boolean rotated = (rotation == ROTATION_90 || rotation == ROTATION_270);
-        final Path bounds = cutout.getBounds().getBoundaryPath();
+        final List<Rect> bounds = WmDisplayCutout.computeSafeInsets(
+                        cutout, mInitialDisplayWidth, mInitialDisplayHeight)
+                .getDisplayCutout().getBoundingRects();
         transformPhysicalToLogicalCoordinates(rotation, mInitialDisplayWidth, mInitialDisplayHeight,
                 mTmpMatrix);
-        bounds.transform(mTmpMatrix);
-        return WmDisplayCutout.computeSafeInsets(DisplayCutout.fromBounds(bounds),
+        final Region region = Region.obtain();
+        for (int i = 0; i < bounds.size(); i++) {
+            final Rect rect = bounds.get(i);
+            final RectF rectF = new RectF(bounds.get(i));
+            mTmpMatrix.mapRect(rectF);
+            rectF.round(rect);
+            region.op(rect, Op.UNION);
+        }
+
+        return WmDisplayCutout.computeSafeInsets(DisplayCutout.fromBounds(region),
                 rotated ? mInitialDisplayHeight : mInitialDisplayWidth,
                 rotated ? mInitialDisplayWidth : mInitialDisplayHeight);
     }
@@ -1782,8 +1793,9 @@ class DisplayContent extends WindowContainer<DisplayContent.DisplayChildWindowCo
         final int newDensity = mDisplayInfo.logicalDensityDpi;
         final DisplayCutout newCutout = mDisplayInfo.displayCutout;
 
-        final boolean displayMetricsChanged = mInitialDisplayWidth != newWidth
-                || mInitialDisplayHeight != newHeight
+        final boolean sizeChanged = mInitialDisplayWidth != newWidth
+                || mInitialDisplayHeight != newHeight;
+        final boolean displayMetricsChanged = sizeChanged
                 || mInitialDisplayDensity != mDisplayInfo.logicalDensityDpi
                 || !Objects.equals(mInitialDisplayCutout, newCutout);
 
@@ -1805,6 +1817,10 @@ class DisplayContent extends WindowContainer<DisplayContent.DisplayChildWindowCo
             mInitialDisplayCutout = newCutout;
             mService.reconfigureDisplayLocked(this);
         }
+
+        if (isDefaultDisplay && sizeChanged) {
+            mService.mH.post(mService.mAmInternal::notifyDefaultDisplaySizeChanged);
+        }
     }
 
     /** Sets the maximum width the screen resolution can be */
@@ -3723,6 +3739,19 @@ class DisplayContent extends WindowContainer<DisplayContent.DisplayChildWindowCo
             super(name, service);
         }
 
+        @Override
+        SurfaceControl.Builder makeChildSurface(WindowContainer child) {
+            final SurfaceControl.Builder builder = super.makeChildSurface(child);
+            if (child instanceof WindowToken && ((WindowToken) child).mRoundedCornerOverlay) {
+                // To draw above the ColorFade layer during the screen off transition, the
+                // rounded corner overlays need to be at the root of the surface hierarchy.
+                // TODO: move the ColorLayer into the display overlay layer such that this is not
+                // necessary anymore.
+                builder.setParent(null);
+            }
+            return builder;
+        }
+
         @Override
         void assignChildLayers(SurfaceControl.Transaction t) {
             assignChildLayers(t, null /* imeContainer */);
@@ -3739,6 +3768,10 @@ class DisplayContent extends WindowContainer<DisplayContent.DisplayChildWindowCo
                     wt.assignRelativeLayer(t, mTaskStackContainers.getSplitScreenDividerAnchor(), 1);
                     continue;
                 }
+                if (wt.mRoundedCornerOverlay) {
+                    wt.assignLayer(t, WindowManagerPolicy.COLOR_FADE_LAYER + 1);
+                    continue;
+                }
                 wt.assignLayer(t, j);
                 wt.assignChildLayers(t);
 
diff --git a/services/core/java/com/android/server/wm/ForcedSeamlessRotator.java b/services/core/java/com/android/server/wm/ForcedSeamlessRotator.java
new file mode 100644
index 00000000000..efb43a6b90c
--- /dev/null
+++ b/services/core/java/com/android/server/wm/ForcedSeamlessRotator.java
@@ -0,0 +1,110 @@
+/*
+ * Copyright (C) 2018 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.server.wm;
+
+import static android.view.Surface.ROTATION_270;
+import static android.view.Surface.ROTATION_90;
+
+import android.graphics.Matrix;
+import android.view.DisplayInfo;
+import android.view.Surface.Rotation;
+
+import com.android.server.wm.utils.CoordinateTransforms;
+
+import java.io.PrintWriter;
+import java.io.StringWriter;
+
+/**
+ * Helper class for forced seamless rotation.
+ *
+ * Works by transforming the window token back into the old display rotation.
+ *
+ * Uses deferTransactionUntil instead of latching on the buffer size to allow for seamless 180
+ * degree rotations.
+ */
+public class ForcedSeamlessRotator {
+
+    private final Matrix mTransform = new Matrix();
+    private final float[] mFloat9 = new float[9];
+    private final int mOldRotation;
+    private final int mNewRotation;
+
+    public ForcedSeamlessRotator(int oldRotation, int newRotation, DisplayInfo info) {
+        mOldRotation = oldRotation;
+        mNewRotation = newRotation;
+
+        final boolean flipped = info.rotation == ROTATION_90 || info.rotation == ROTATION_270;
+        final int h = flipped ? info.logicalWidth : info.logicalHeight;
+        final int w = flipped ? info.logicalHeight : info.logicalWidth;
+
+        final Matrix tmp = new Matrix();
+        CoordinateTransforms.transformLogicalToPhysicalCoordinates(oldRotation, w, h, mTransform);
+        CoordinateTransforms.transformPhysicalToLogicalCoordinates(newRotation, w, h, tmp);
+        mTransform.postConcat(tmp);
+    }
+
+    /**
+     * Applies a transform to the window token's surface that undoes the effect of the global
+     * display rotation.
+     */
+    public void unrotate(WindowToken token) {
+        token.getPendingTransaction().setMatrix(token.getSurfaceControl(), mTransform, mFloat9);
+    }
+
+    /**
+     * Returns the rotation of the display before it started rotating.
+     *
+     * @return the old rotation of the display
+     */
+    @Rotation
+    public int getOldRotation() {
+        return mOldRotation;
+    }
+
+    /**
+     * Removes the transform to the window token's surface that undoes the effect of the global
+     * display rotation.
+     *
+     * Removing the transform and the result of the WindowState's layout are both tied to the
+     * WindowState's next frame, such that they apply at the same time the client draws the
+     * window in the new orientation.
+     */
+    public void finish(WindowToken token, WindowState win) {
+        mTransform.reset();
+        token.getPendingTransaction().setMatrix(token.mSurfaceControl, mTransform, mFloat9);
+        if (win.mWinAnimator.mSurfaceController != null) {
+            token.getPendingTransaction().deferTransactionUntil(token.mSurfaceControl,
+                    win.mWinAnimator.mSurfaceController.mSurfaceControl.getHandle(),
+                    win.getFrameNumber());
+            win.getPendingTransaction().deferTransactionUntil(win.mSurfaceControl,
+                    win.mWinAnimator.mSurfaceController.mSurfaceControl.getHandle(),
+                    win.getFrameNumber());
+        }
+    }
+
+    public void dump(PrintWriter pw) {
+        pw.print("{old="); pw.print(mOldRotation); pw.print(", new="); pw.print(mNewRotation);
+        pw.print("}");
+    }
+
+    @Override
+    public String toString() {
+        StringWriter sw = new StringWriter();
+        dump(new PrintWriter(sw));
+        return "ForcedSeamlessRotator" + sw.toString();
+    }
+}
diff --git a/services/core/java/com/android/server/wm/InputMonitor.java b/services/core/java/com/android/server/wm/InputMonitor.java
index 281e0a8441e..a626663c2e6 100644
--- a/services/core/java/com/android/server/wm/InputMonitor.java
+++ b/services/core/java/com/android/server/wm/InputMonitor.java
@@ -40,6 +40,7 @@ import android.os.IBinder;
 import android.os.Looper;
 import android.os.Process;
 import android.os.RemoteException;
+import android.os.Trace;
 import android.os.UserHandle;
 import android.util.ArrayMap;
 import android.util.Log;
@@ -620,6 +621,8 @@ final class InputMonitor implements InputManagerService.WindowManagerCallbacks {
 
         private void updateInputWindows(boolean inDrag) {
 
+            Trace.traceBegin(Trace.TRACE_TAG_WINDOW_MANAGER, "updateInputWindows");
+
             // TODO: multi-display
             navInputConsumer = getInputConsumer(INPUT_CONSUMER_NAVIGATION, DEFAULT_DISPLAY);
             pipInputConsumer = getInputConsumer(INPUT_CONSUMER_PIP, DEFAULT_DISPLAY);
@@ -645,6 +648,8 @@ final class InputMonitor implements InputManagerService.WindowManagerCallbacks {
             mService.mInputManager.setInputWindows(mInputWindowHandles, mFocusedInputWindowHandle);
 
             clearInputWindowHandlesLw();
+
+            Trace.traceEnd(Trace.TRACE_TAG_WINDOW_MANAGER);
         }
 
         @Override
diff --git a/services/core/java/com/android/server/wm/ScreenRotationAnimation.java b/services/core/java/com/android/server/wm/ScreenRotationAnimation.java
index 0eec0b614fa..95acfc17074 100644
--- a/services/core/java/com/android/server/wm/ScreenRotationAnimation.java
+++ b/services/core/java/com/android/server/wm/ScreenRotationAnimation.java
@@ -37,6 +37,7 @@ import android.view.DisplayInfo;
 import android.view.Surface;
 import android.view.Surface.OutOfResourcesException;
 import android.view.SurfaceControl;
+import android.view.SurfaceControl.Transaction;
 import android.view.SurfaceSession;
 import android.view.animation.Animation;
 import android.view.animation.AnimationUtils;
@@ -268,6 +269,12 @@ class ScreenRotationAnimation {
                     .setSecure(isSecure)
                     .build();
 
+            // In case display bounds change, screenshot buffer and surface may mismatch so set a
+            // scaling mode.
+            Transaction t2 = new Transaction();
+            t2.setOverrideScalingMode(mSurfaceControl, Surface.SCALING_MODE_SCALE_TO_WINDOW);
+            t2.apply(true /* sync */);
+
             // capture a screenshot into the surface we just created
             // TODO(multidisplay): we should use the proper display
             final int displayId = SurfaceControl.BUILT_IN_DISPLAY_ID_MAIN;
diff --git a/services/core/java/com/android/server/wm/SurfaceAnimationRunner.java b/services/core/java/com/android/server/wm/SurfaceAnimationRunner.java
index 2bfff269e45..cb504607420 100644
--- a/services/core/java/com/android/server/wm/SurfaceAnimationRunner.java
+++ b/services/core/java/com/android/server/wm/SurfaceAnimationRunner.java
@@ -26,6 +26,8 @@ import android.animation.Animator;
 import android.animation.AnimatorListenerAdapter;
 import android.animation.ValueAnimator;
 import android.annotation.Nullable;
+import android.hardware.power.V1_0.PowerHint;
+import android.os.PowerManagerInternal;
 import android.util.ArrayMap;
 import android.view.Choreographer;
 import android.view.SurfaceControl;
@@ -57,6 +59,7 @@ class SurfaceAnimationRunner {
     private final AnimationHandler mAnimationHandler;
     private final Transaction mFrameTransaction;
     private final AnimatorFactory mAnimatorFactory;
+    private final PowerManagerInternal mPowerManagerInternal;
     private boolean mApplyScheduled;
 
     @GuardedBy("mLock")
@@ -70,13 +73,15 @@ class SurfaceAnimationRunner {
     @GuardedBy("mLock")
     private boolean mAnimationStartDeferred;
 
-    SurfaceAnimationRunner() {
-        this(null /* callbackProvider */, null /* animatorFactory */, new Transaction());
+    SurfaceAnimationRunner(PowerManagerInternal powerManagerInternal) {
+        this(null /* callbackProvider */, null /* animatorFactory */, new Transaction(),
+                powerManagerInternal);
     }
 
     @VisibleForTesting
     SurfaceAnimationRunner(@Nullable AnimationFrameCallbackProvider callbackProvider,
-            AnimatorFactory animatorFactory, Transaction frameTransaction) {
+            AnimatorFactory animatorFactory, Transaction frameTransaction,
+            PowerManagerInternal powerManagerInternal) {
         SurfaceAnimationThread.getHandler().runWithScissors(() -> mChoreographer = getSfInstance(),
                 0 /* timeout */);
         mFrameTransaction = frameTransaction;
@@ -87,6 +92,7 @@ class SurfaceAnimationRunner {
         mAnimatorFactory = animatorFactory != null
                 ? animatorFactory
                 : SfValueAnimator::new;
+        mPowerManagerInternal = powerManagerInternal;
     }
 
     /**
@@ -231,6 +237,7 @@ class SurfaceAnimationRunner {
         synchronized (mLock) {
             startPendingAnimationsLocked();
         }
+        mPowerManagerInternal.powerHint(PowerHint.INTERACTION, 0);
     }
 
     private void scheduleApplyTransaction() {
diff --git a/services/core/java/com/android/server/wm/WindowContainer.java b/services/core/java/com/android/server/wm/WindowContainer.java
index 19c5a3d6452..8fe7063c815 100644
--- a/services/core/java/com/android/server/wm/WindowContainer.java
+++ b/services/core/java/com/android/server/wm/WindowContainer.java
@@ -735,6 +735,20 @@ class WindowContainer<E extends WindowContainer> extends ConfigurationContainer<
         return candidate;
     }
 
+    /**
+     * Seamlessly rotates the container, by recomputing the location in the new
+     * rotation, and rotating buffers until they are updated for the new rotation.
+     *
+     * @param t the transaction to perform the seamless rotation in
+     * @param oldRotation the rotation we are rotating from
+     * @param newRotation the rotation we are rotating to
+     */
+    void seamlesslyRotate(Transaction t, int oldRotation, int newRotation) {
+        for (int i = mChildren.size() - 1; i >= 0; --i) {
+            mChildren.get(i).seamlesslyRotate(t, oldRotation, newRotation);
+        }
+    }
+
     /**
      * Returns true if this container is opaque and fills all the space made available by its parent
      * container.
diff --git a/services/core/java/com/android/server/wm/WindowManagerService.java b/services/core/java/com/android/server/wm/WindowManagerService.java
index 7c0cb315523..d0f79b66d5a 100644
--- a/services/core/java/com/android/server/wm/WindowManagerService.java
+++ b/services/core/java/com/android/server/wm/WindowManagerService.java
@@ -1007,7 +1007,6 @@ public class WindowManagerService extends IWindowManager.Stub
         mAppTransition.registerListenerLocked(mActivityManagerAppTransitionNotifier);
 
         final AnimationHandler animationHandler = new AnimationHandler();
-        animationHandler.setProvider(new SfVsyncFrameCallbackProvider());
         mBoundsAnimationController = new BoundsAnimationController(context, mAppTransition,
                 AnimationThread.getHandler(), animationHandler);
 
@@ -1063,7 +1062,7 @@ public class WindowManagerService extends IWindowManager.Stub
                 PowerManager.SCREEN_BRIGHT_WAKE_LOCK | PowerManager.ON_AFTER_RELEASE, TAG_WM);
         mHoldingScreenWakeLock.setReferenceCounted(false);
 
-        mSurfaceAnimationRunner = new SurfaceAnimationRunner();
+        mSurfaceAnimationRunner = new SurfaceAnimationRunner(mPowerManagerInternal);
 
         mAllowTheaterModeWakeFromLayout = context.getResources().getBoolean(
                 com.android.internal.R.bool.config_allowTheaterModeWakeFromWindowLayout);
@@ -1885,6 +1884,13 @@ public class WindowManagerService extends IWindowManager.Stub
             }
 
             win.setFrameNumber(frameNumber);
+
+            if (win.mPendingForcedSeamlessRotate != null && !mWaitingForConfig) {
+                win.mPendingForcedSeamlessRotate.finish(win.mToken, win);
+                win.mFinishForcedSeamlessRotateFrameNumber = win.getFrameNumber();
+                win.mPendingForcedSeamlessRotate = null;
+            }
+
             int attrChanges = 0;
             int flagChanges = 0;
             if (attrs != null) {
@@ -6264,6 +6270,17 @@ public class WindowManagerService extends IWindowManager.Stub
         }
     }
 
+    /**
+     * Returns true if the callingUid has any window currently visible to the user.
+     */
+    public boolean isAnyWindowVisibleForUid(int callingUid) {
+        synchronized (mWindowMap) {
+            return mRoot.forAllWindows(w -> {
+                return w.getOwningUid() == callingUid && w.isVisible();
+            }, true /* traverseTopToBottom */);
+        }
+    }
+
     /**
      * Called when a task has been removed from the recent tasks list.
      * <p>
diff --git a/services/core/java/com/android/server/wm/WindowState.java b/services/core/java/com/android/server/wm/WindowState.java
index f130b498cb4..3dec7d24a53 100644
--- a/services/core/java/com/android/server/wm/WindowState.java
+++ b/services/core/java/com/android/server/wm/WindowState.java
@@ -126,6 +126,7 @@ import static com.android.server.wm.WindowStateProto.DECOR_FRAME;
 import static com.android.server.wm.WindowStateProto.DESTROYING;
 import static com.android.server.wm.WindowStateProto.DISPLAY_FRAME;
 import static com.android.server.wm.WindowStateProto.DISPLAY_ID;
+import static com.android.server.wm.WindowStateProto.FINISHED_FORCED_SEAMLESS_ROTATION_FRAME;
 import static com.android.server.wm.WindowStateProto.FRAME;
 import static com.android.server.wm.WindowStateProto.GIVEN_CONTENT_INSETS;
 import static com.android.server.wm.WindowStateProto.HAS_SURFACE;
@@ -138,6 +139,7 @@ import static com.android.server.wm.WindowStateProto.OUTSET_FRAME;
 import static com.android.server.wm.WindowStateProto.OVERSCAN_FRAME;
 import static com.android.server.wm.WindowStateProto.OVERSCAN_INSETS;
 import static com.android.server.wm.WindowStateProto.PARENT_FRAME;
+import static com.android.server.wm.WindowStateProto.PENDING_FORCED_SEAMLESS_ROTATION;
 import static com.android.server.wm.WindowStateProto.REMOVED;
 import static com.android.server.wm.WindowStateProto.REMOVE_ON_EXIT;
 import static com.android.server.wm.WindowStateProto.REQUESTED_HEIGHT;
@@ -151,6 +153,8 @@ import static com.android.server.wm.WindowStateProto.VIEW_VISIBILITY;
 import static com.android.server.wm.WindowStateProto.VISIBLE_FRAME;
 import static com.android.server.wm.WindowStateProto.VISIBLE_INSETS;
 import static com.android.server.wm.WindowStateProto.WINDOW_CONTAINER;
+import static com.android.server.wm.utils.CoordinateTransforms.transformRect;
+import static com.android.server.wm.utils.CoordinateTransforms.transformToRotation;
 
 import android.annotation.CallSuper;
 import android.app.AppOpsManager;
@@ -280,6 +284,14 @@ class WindowState extends WindowContainer<WindowState> implements WindowManagerP
     private boolean mDragResizing;
     private boolean mDragResizingChangeReported = true;
     private int mResizeMode;
+    /**
+     * Special mode that is intended only for the rounded corner overlay: during rotation
+     * transition, we un-rotate the window token such that the window appears as it did before the
+     * rotation.
+     */
+    final boolean mForceSeamlesslyRotate;
+    ForcedSeamlessRotator mPendingForcedSeamlessRotate;
+    long mFinishForcedSeamlessRotateFrameNumber;
 
     private RemoteCallbackList<IWindowFocusObserver> mFocusCallbacks;
 
@@ -669,6 +681,18 @@ class WindowState extends WindowContainer<WindowState> implements WindowManagerP
 
     private static final float DEFAULT_DIM_AMOUNT_DEAD_WINDOW = 0.5f;
 
+    void forceSeamlesslyRotateIfAllowed(int oldRotation, int rotation) {
+        if (mForceSeamlesslyRotate) {
+            if (mPendingForcedSeamlessRotate != null) {
+                oldRotation = mPendingForcedSeamlessRotate.getOldRotation();
+            }
+
+            mPendingForcedSeamlessRotate = new ForcedSeamlessRotator(
+                    oldRotation, rotation, getDisplayInfo());
+            mPendingForcedSeamlessRotate.unrotate(this.mToken);
+        }
+    }
+
     interface PowerManagerWrapper {
         void wakeUp(long time, String reason);
 
@@ -715,6 +739,7 @@ class WindowState extends WindowContainer<WindowState> implements WindowManagerP
         mSeq = seq;
         mEnforceSizeCompat = (mAttrs.privateFlags & PRIVATE_FLAG_COMPATIBLE_WINDOW) != 0;
         mPowerManagerWrapper = powerManagerWrapper;
+        mForceSeamlesslyRotate = token.mRoundedCornerOverlay;
         if (localLOGV) Slog.v(
             TAG, "Window " + this + " client=" + c.asBinder()
             + " token=" + token + " (" + mAttrs.token + ")" + " params=" + a);
@@ -1822,7 +1847,8 @@ class WindowState extends WindowContainer<WindowState> implements WindowManagerP
                 && (mAttrs.privateFlags & PRIVATE_FLAG_NO_MOVE_ANIMATION) == 0
                 && !isDragResizing() && !adjustedForMinimizedDockOrIme
                 && getWindowConfiguration().hasMovementAnimations()
-                && !mWinAnimator.mLastHidden) {
+                && !mWinAnimator.mLastHidden
+                && !mSeamlesslyRotated) {
             startMoveAnimation(left, top);
         }
 
@@ -3297,6 +3323,11 @@ class WindowState extends WindowContainer<WindowState> implements WindowManagerP
         proto.write(REMOVED, mRemoved);
         proto.write(IS_ON_SCREEN, isOnScreen());
         proto.write(IS_VISIBLE, isVisible());
+        if (mForceSeamlesslyRotate) {
+            proto.write(PENDING_FORCED_SEAMLESS_ROTATION, mPendingForcedSeamlessRotate != null);
+            proto.write(FINISHED_FORCED_SEAMLESS_ROTATION_FRAME,
+                    mFinishForcedSeamlessRotateFrameNumber);
+        }
         proto.end(token);
     }
 
@@ -3473,6 +3504,16 @@ class WindowState extends WindowContainer<WindowState> implements WindowManagerP
             pw.print(prefix); pw.print("mLastFreezeDuration=");
                     TimeUtils.formatDuration(mLastFreezeDuration, pw); pw.println();
         }
+        if (mForceSeamlesslyRotate) {
+            pw.print(prefix); pw.print("forceSeamlesslyRotate: pending=");
+            if (mPendingForcedSeamlessRotate != null) {
+                mPendingForcedSeamlessRotate.dump(pw);
+            } else {
+                pw.print("null");
+            }
+            pw.print(" finishedFrameNumber="); pw.print(mFinishForcedSeamlessRotateFrameNumber);
+            pw.println();
+        }
         if (mHScale != 1 || mVScale != 1) {
             pw.print(prefix); pw.print("mHScale="); pw.print(mHScale);
                     pw.print(" mVScale="); pw.println(mVScale);
@@ -4711,7 +4752,10 @@ class WindowState extends WindowContainer<WindowState> implements WindowManagerP
 
         transformFrameToSurfacePosition(mFrame.left, mFrame.top, mSurfacePosition);
 
-        if (!mSurfaceAnimator.hasLeash() && !mLastSurfacePosition.equals(mSurfacePosition)) {
+        // Freeze position while we're unrotated, so the surface remains at the position it was
+        // prior to the rotation.
+        if (!mSurfaceAnimator.hasLeash() && mPendingForcedSeamlessRotate == null &&
+                !mLastSurfacePosition.equals(mSurfacePosition)) {
             t.setPosition(mSurfaceControl, mSurfacePosition.x, mSurfacePosition.y);
             mLastSurfacePosition.set(mSurfacePosition.x, mSurfacePosition.y);
             if (surfaceInsetsChanging() && mWinAnimator.hasSurface()) {
@@ -4886,6 +4930,31 @@ class WindowState extends WindowContainer<WindowState> implements WindowManagerP
         mFrameNumber = frameNumber;
     }
 
+    @Override
+    void seamlesslyRotate(Transaction t, int oldRotation, int newRotation) {
+        // Invisible windows, the wallpaper, and force seamlessly rotated windows do not participate
+        // in the regular seamless rotation animation.
+        if (!isVisibleNow() || mIsWallpaper || mForceSeamlesslyRotate) {
+            return;
+        }
+        final Matrix transform = mTmpMatrix;
+
+        mService.markForSeamlessRotation(this, true);
+
+        // We rotated the screen, but have not performed a new layout pass yet. In the mean time,
+        // we recompute the coordinates of mFrame in the new orientation, so the surface can be
+        // properly placed.
+        transformToRotation(oldRotation, newRotation, getDisplayInfo(), transform);
+        transformRect(transform, mFrame, null /* tmpRectF */);
+
+        updateSurfacePosition(t);
+        mWinAnimator.seamlesslyRotate(t, oldRotation, newRotation);
+
+        // Dispatch to children only after mFrame has been updated, as it's needed in the
+        // child's updateSurfacePosition.
+        super.seamlesslyRotate(t, oldRotation, newRotation);
+    }
+
     private final class MoveAnimationSpec implements AnimationSpec {
 
         private final long mDuration;
diff --git a/services/core/java/com/android/server/wm/WindowStateAnimator.java b/services/core/java/com/android/server/wm/WindowStateAnimator.java
index 3eef12540e7..a05e04dd6c7 100644
--- a/services/core/java/com/android/server/wm/WindowStateAnimator.java
+++ b/services/core/java/com/android/server/wm/WindowStateAnimator.java
@@ -41,18 +41,18 @@ import static com.android.server.wm.WindowManagerDebugConfig.TAG_WITH_CLASS_NAME
 import static com.android.server.wm.WindowManagerDebugConfig.TAG_WM;
 import static com.android.server.wm.WindowManagerService.TYPE_LAYER_MULTIPLIER;
 import static com.android.server.wm.WindowManagerService.logWithStack;
-import static com.android.server.wm.WindowSurfacePlacer.SET_ORIENTATION_CHANGE_COMPLETE;
 import static com.android.server.wm.WindowStateAnimatorProto.DRAW_STATE;
 import static com.android.server.wm.WindowStateAnimatorProto.LAST_CLIP_RECT;
 import static com.android.server.wm.WindowStateAnimatorProto.SURFACE;
 import static com.android.server.wm.WindowStateAnimatorProto.SYSTEM_DECOR_RECT;
+import static com.android.server.wm.WindowSurfacePlacer.SET_ORIENTATION_CHANGE_COMPLETE;
+import static com.android.server.wm.utils.CoordinateTransforms.transformToRotation;
 
 import android.content.Context;
 import android.graphics.Matrix;
 import android.graphics.PixelFormat;
 import android.graphics.Point;
 import android.graphics.Rect;
-import android.graphics.RectF;
 import android.graphics.Region;
 import android.os.Debug;
 import android.os.Trace;
@@ -366,7 +366,8 @@ class WindowStateAnimator {
         mDrawState = READY_TO_SHOW;
         boolean result = false;
         final AppWindowToken atoken = mWin.mAppToken;
-        if (atoken == null || atoken.allDrawn || mWin.mAttrs.type == TYPE_APPLICATION_STARTING) {
+        if (atoken == null || atoken.canShowWindows()
+                || mWin.mAttrs.type == TYPE_APPLICATION_STARTING) {
             result = mWin.performShowLocked();
         }
         return result;
@@ -685,8 +686,11 @@ class WindowStateAnimator {
         final int displayId = mWin.getDisplayId();
         final ScreenRotationAnimation screenRotationAnimation =
                 mAnimator.getScreenRotationAnimationLocked(displayId);
-        final boolean screenAnimation =
-                screenRotationAnimation != null && screenRotationAnimation.isAnimating();
+        final boolean windowParticipatesInScreenRotationAnimation =
+                !mWin.mForceSeamlesslyRotate;
+        final boolean screenAnimation = screenRotationAnimation != null
+                && screenRotationAnimation.isAnimating()
+                && windowParticipatesInScreenRotationAnimation;
 
         if (screenAnimation) {
             // cache often used attributes locally
@@ -798,6 +802,13 @@ class WindowStateAnimator {
             return false;
         }
 
+        // During forced seamless rotation, the surface bounds get updated with the crop in the
+        // new rotation, which is not compatible with showing the surface in the old rotation.
+        // To work around that we disable cropping for such windows, as it is not necessary anyways.
+        if (w.mForceSeamlesslyRotate) {
+            return false;
+        }
+
         // If we're animating, the wallpaper should only
         // be updated at the end of the animation.
         if (w.mAttrs.type == TYPE_WALLPAPER) {
@@ -1492,40 +1503,14 @@ class WindowStateAnimator {
         }
     }
 
-    void seamlesslyRotateWindow(SurfaceControl.Transaction t,
-            int oldRotation, int newRotation) {
+    void seamlesslyRotate(SurfaceControl.Transaction t, int oldRotation, int newRotation) {
         final WindowState w = mWin;
-        if (!w.isVisibleNow() || w.mIsWallpaper) {
-            return;
-        }
 
-        final Rect cropRect = mService.mTmpRect;
-        final Rect displayRect = mService.mTmpRect2;
-        final RectF frameRect = mService.mTmpRectF;
+        // We rotated the screen, but have not received a new buffer with the correct size yet. In
+        // the mean time, we rotate the buffer we have to the new orientation.
         final Matrix transform = mService.mTmpTransform;
-
-        final float x = w.mFrame.left;
-        final float y = w.mFrame.top;
-        final float width = w.mFrame.width();
-        final float height = w.mFrame.height();
-
-        mService.getDefaultDisplayContentLocked().getBounds(displayRect);
-        final float displayWidth = displayRect.width();
-        final float displayHeight = displayRect.height();
-
-        // Compute a transform matrix to undo the coordinate space transformation,
-        // and present the window at the same physical position it previously occupied.
-        final int deltaRotation = DisplayContent.deltaRotation(newRotation, oldRotation);
-        DisplayContent.createRotationMatrix(deltaRotation, x, y, displayWidth, displayHeight,
+        transformToRotation(oldRotation, newRotation, w.mFrame.width(), w.mFrame.height(),
                 transform);
-
-        // We just need to apply a rotation matrix to the window. For example
-        // if we have a portrait window and rotate to landscape, the window is still portrait
-        // and now extends off the bottom of the screen (and only halfway across). Essentially we
-        // apply a transform to display the current buffer at it's old position
-        // (in the new coordinate space). We then freeze layer updates until the resize
-        // occurs, at which point we undo, them.
-        mService.markForSeamlessRotation(w, true);
         transform.getValues(mService.mTmpFloats);
 
         float DsDx = mService.mTmpFloats[Matrix.MSCALE_X];
diff --git a/services/core/java/com/android/server/wm/WindowToken.java b/services/core/java/com/android/server/wm/WindowToken.java
index b97460ae9eb..e411c0adc75 100644
--- a/services/core/java/com/android/server/wm/WindowToken.java
+++ b/services/core/java/com/android/server/wm/WindowToken.java
@@ -270,12 +270,6 @@ class WindowToken extends WindowContainer<WindowState> {
         dc.reParentWindowToken(this);
         mDisplayContent = dc;
 
-        // The rounded corner overlay should not be rotated. We ensure that by moving it outside
-        // the windowing layer.
-        if (mRoundedCornerOverlay) {
-            mDisplayContent.reparentToOverlay(mPendingTransaction, mSurfaceControl);
-        }
-
         // TODO(b/36740756): One day this should perhaps be hooked
         // up with goodToGo, so we don't move a window
         // to another display before the window behind
diff --git a/services/core/java/com/android/server/wm/utils/CoordinateTransforms.java b/services/core/java/com/android/server/wm/utils/CoordinateTransforms.java
index 09d7b5de1ca..a2f37a56598 100644
--- a/services/core/java/com/android/server/wm/utils/CoordinateTransforms.java
+++ b/services/core/java/com/android/server/wm/utils/CoordinateTransforms.java
@@ -22,7 +22,11 @@ import static android.view.Surface.ROTATION_270;
 import static android.view.Surface.ROTATION_90;
 
 import android.annotation.Dimension;
+import android.annotation.Nullable;
 import android.graphics.Matrix;
+import android.graphics.Rect;
+import android.graphics.RectF;
+import android.view.DisplayInfo;
 import android.view.Surface.Rotation;
 
 public class CoordinateTransforms {
@@ -59,4 +63,93 @@ public class CoordinateTransforms {
                 throw new IllegalArgumentException("Unknown rotation: " + rotation);
         }
     }
+
+    /**
+     * Sets a matrix such that given a rotation, it transforms that rotation's logical coordinates
+     * to physical coordinates.
+     *
+     * @param rotation the rotation to which the matrix should transform
+     * @param out      the matrix to be set
+     */
+    public static void transformLogicalToPhysicalCoordinates(@Rotation int rotation,
+            @Dimension int physicalWidth, @Dimension int physicalHeight, Matrix out) {
+        switch (rotation) {
+            case ROTATION_0:
+                out.reset();
+                break;
+            case ROTATION_90:
+                out.setRotate(90);
+                out.preTranslate(0, -physicalWidth);
+                break;
+            case ROTATION_180:
+                out.setRotate(180);
+                out.preTranslate(-physicalWidth, -physicalHeight);
+                break;
+            case ROTATION_270:
+                out.setRotate(270);
+                out.preTranslate(-physicalHeight, 0);
+                break;
+            default:
+                throw new IllegalArgumentException("Unknown rotation: " + rotation);
+        }
+    }
+
+    /**
+     * Sets a matrix such that given a two rotations, that it transforms coordinates given in the
+     * old rotation to coordinates that refer to the same physical location in the new rotation.
+     *
+     * @param oldRotation the rotation to transform from
+     * @param newRotation the rotation to transform to
+     * @param info the display info
+     * @param out a matrix that will be set to the transform
+     */
+    public static void transformToRotation(@Rotation int oldRotation,
+            @Rotation int newRotation, DisplayInfo info, Matrix out) {
+        final boolean flipped = info.rotation == ROTATION_90 || info.rotation == ROTATION_270;
+        final int h = flipped ? info.logicalWidth : info.logicalHeight;
+        final int w = flipped ? info.logicalHeight : info.logicalWidth;
+
+        final Matrix tmp = new Matrix();
+        transformLogicalToPhysicalCoordinates(oldRotation, w, h, out);
+        transformPhysicalToLogicalCoordinates(newRotation, w, h, tmp);
+        out.postConcat(tmp);
+    }
+
+    /**
+     * Sets a matrix such that given a two rotations, that it transforms coordinates given in the
+     * old rotation to coordinates that refer to the same physical location in the new rotation.
+     *
+     * @param oldRotation the rotation to transform from
+     * @param newRotation the rotation to transform to
+     * @param newWidth the width of the area to transform, in the new rotation
+     * @param newHeight the height of the area to transform, in the new rotation
+     * @param out a matrix that will be set to the transform
+     */
+    public static void transformToRotation(@Rotation int oldRotation,
+            @Rotation int newRotation, int newWidth, int newHeight, Matrix out) {
+        final boolean flipped = newRotation == ROTATION_90 || newRotation == ROTATION_270;
+        final int h = flipped ? newWidth : newHeight;
+        final int w = flipped ? newHeight : newWidth;
+
+        final Matrix tmp = new Matrix();
+        transformLogicalToPhysicalCoordinates(oldRotation, w, h, out);
+        transformPhysicalToLogicalCoordinates(newRotation, w, h, tmp);
+        out.postConcat(tmp);
+    }
+
+    /**
+     * Transforms a rect using a transformation matrix
+     *
+     * @param transform the transformation to apply to the rect
+     * @param inOutRect the rect to transform
+     * @param tmp a temporary value, if null the function will allocate its own.
+     */
+    public static void transformRect(Matrix transform, Rect inOutRect, @Nullable RectF tmp) {
+        if (tmp == null) {
+            tmp = new RectF();
+        }
+        tmp.set(inOutRect);
+        transform.mapRect(tmp);
+        inOutRect.set((int) tmp.left, (int) tmp.top, (int) tmp.right, (int) tmp.bottom);
+    }
 }
diff --git a/services/core/java/com/android/server/wm/utils/InsetUtils.java b/services/core/java/com/android/server/wm/utils/InsetUtils.java
index b4a998add37..c8600dd151d 100644
--- a/services/core/java/com/android/server/wm/utils/InsetUtils.java
+++ b/services/core/java/com/android/server/wm/utils/InsetUtils.java
@@ -17,6 +17,7 @@
 package com.android.server.wm.utils;
 
 import android.graphics.Rect;
+import android.view.Surface;
 
 /**
  * Utility methods to handle insets represented as rects.
@@ -26,6 +27,32 @@ public class InsetUtils {
     private InsetUtils() {
     }
 
+    /**
+     * Transforms insets given in one rotation into insets in a different rotation.
+     *
+     * @param inOutInsets the insets to transform, is set to the transformed insets
+     * @param rotationDelta the delta between the new and old rotation.
+     *                      Must be one of Surface.ROTATION_0/90/180/270.
+     */
+    public static void rotateInsets(Rect inOutInsets, int rotationDelta) {
+        final Rect r = inOutInsets;
+        switch (rotationDelta) {
+            case Surface.ROTATION_0:
+                return;
+            case Surface.ROTATION_90:
+                r.set(r.top, r.right, r.bottom, r.left);
+                break;
+            case Surface.ROTATION_180:
+                r.set(r.right, r.bottom, r.left, r.top);
+                break;
+            case Surface.ROTATION_270:
+                r.set(r.bottom, r.left, r.top, r.right);
+                break;
+            default:
+                throw new IllegalArgumentException("Unknown rotation: " + rotationDelta);
+        }
+    }
+
     /**
      * Adds {@code insetsToAdd} to {@code inOutInsets}.
      */
diff --git a/services/devicepolicy/java/com/android/server/devicepolicy/DevicePolicyManagerService.java b/services/devicepolicy/java/com/android/server/devicepolicy/DevicePolicyManagerService.java
index 2853e4f5078..d3a4db6469c 100644
--- a/services/devicepolicy/java/com/android/server/devicepolicy/DevicePolicyManagerService.java
+++ b/services/devicepolicy/java/com/android/server/devicepolicy/DevicePolicyManagerService.java
@@ -4572,10 +4572,12 @@ public class DevicePolicyManagerService extends BaseIDevicePolicyManager {
         enforceFullCrossUsersPermission(userHandle);
         synchronized (getLockObject()) {
             if (!isCallerWithSystemUid()) {
-                // This API can only be called by an active device admin,
-                // so try to retrieve it to check that the caller is one.
-                getActiveAdminForCallerLocked(
-                        null, DeviceAdminInfo.USES_POLICY_WATCH_LOGIN, parent);
+                // This API can be called by an active device admin or by keyguard code.
+                if (mContext.checkCallingPermission(permission.ACCESS_KEYGUARD_SECURE_STORAGE)
+                        != PackageManager.PERMISSION_GRANTED) {
+                    getActiveAdminForCallerLocked(
+                            null, DeviceAdminInfo.USES_POLICY_WATCH_LOGIN, parent);
+                }
             }
 
             DevicePolicyData policy = getUserDataUnchecked(getCredentialOwner(userHandle, parent));
diff --git a/services/java/com/android/server/SystemServer.java b/services/java/com/android/server/SystemServer.java
index 5e7baa198bb..b1189b23250 100644
--- a/services/java/com/android/server/SystemServer.java
+++ b/services/java/com/android/server/SystemServer.java
@@ -29,6 +29,8 @@ import android.content.res.Configuration;
 import android.content.res.Resources.Theme;
 import android.database.ContentObserver;
 import android.database.sqlite.SQLiteCompatibilityWalFlags;
+import android.database.sqlite.SQLiteGlobal;
+import android.hardware.display.DisplayManagerInternal;
 import android.os.BaseBundle;
 import android.os.Binder;
 import android.os.Build;
@@ -366,6 +368,10 @@ public final class SystemServer {
             Binder.setWarnOnBlocking(true);
             // The system server should always load safe labels
             PackageItemInfo.setForceSafeLabels(true);
+
+            // Default to FULL within the system server.
+            SQLiteGlobal.sDefaultSyncMode = SQLiteGlobal.SYNC_MODE_FULL;
+
             // Deactivate SQLiteCompatibilityWalFlags until settings provider is initialized
             SQLiteCompatibilityWalFlags.init(null);
 
@@ -692,9 +698,17 @@ public final class SystemServer {
 
         // Manages Overlay packages
         traceBeginAndSlog("StartOverlayManagerService");
-        mSystemServiceManager.startService(new OverlayManagerService(mSystemContext, installer));
+        OverlayManagerService overlayManagerService = new OverlayManagerService(
+                mSystemContext, installer);
+        mSystemServiceManager.startService(overlayManagerService);
         traceEnd();
 
+        if (SystemProperties.getInt("persist.sys.displayinset.top", 0) > 0) {
+            // DisplayManager needs the overlay immediately.
+            overlayManagerService.updateSystemUiContext();
+            LocalServices.getService(DisplayManagerInternal.class).onOverlayChanged();
+        }
+
         // The sensor service needs access to package manager service, app ops
         // service, and permissions service, therefore we start it after them.
         // Start sensor service in a separate thread. Completion should be checked
diff --git a/services/net/java/android/net/netlink/NetlinkSocket.java b/services/net/java/android/net/netlink/NetlinkSocket.java
index 5af3c299bfc..cfcba3a84f5 100644
--- a/services/net/java/android/net/netlink/NetlinkSocket.java
+++ b/services/net/java/android/net/netlink/NetlinkSocket.java
@@ -59,10 +59,9 @@ public class NetlinkSocket {
         final String errPrefix = "Error in NetlinkSocket.sendOneShotKernelMessage";
         final long IO_TIMEOUT = 300L;
 
-        FileDescriptor fd;
+        final FileDescriptor fd = forProto(nlProto);
 
         try {
-            fd = forProto(nlProto);
             connectToKernel(fd);
             sendMessage(fd, msg, 0, msg.length, IO_TIMEOUT);
             final ByteBuffer bytes = recvMessage(fd, DEFAULT_RECV_BUFSIZE, IO_TIMEOUT);
@@ -96,9 +95,9 @@ public class NetlinkSocket {
         } catch (SocketException e) {
             Log.e(TAG, errPrefix, e);
             throw new ErrnoException(errPrefix, EIO, e);
+        } finally {
+            IoUtils.closeQuietly(fd);
         }
-
-        IoUtils.closeQuietly(fd);
     }
 
     public static FileDescriptor forProto(int nlProto) throws ErrnoException {
diff --git a/services/tests/servicestests/src/com/android/server/am/ActivityStarterTests.java b/services/tests/servicestests/src/com/android/server/am/ActivityStarterTests.java
index 1520859d4aa..8d056fc4a8c 100644
--- a/services/tests/servicestests/src/com/android/server/am/ActivityStarterTests.java
+++ b/services/tests/servicestests/src/com/android/server/am/ActivityStarterTests.java
@@ -53,6 +53,7 @@ import android.view.Gravity;
 import org.junit.runner.RunWith;
 import org.junit.Test;
 
+import static android.content.Intent.FLAG_ACTIVITY_NEW_TASK;
 import static android.content.Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED;
 import static com.android.server.am.ActivityManagerService.ANIMATE;
 
@@ -62,11 +63,13 @@ import static org.mockito.Mockito.any;
 import static org.mockito.Mockito.anyBoolean;
 import static org.mockito.Mockito.anyInt;
 import static org.mockito.Mockito.anyObject;
+import static org.mockito.Mockito.clearInvocations;
 import static org.mockito.Mockito.doAnswer;
 import static org.mockito.Mockito.doNothing;
 import static org.mockito.Mockito.doReturn;
 import static org.mockito.Mockito.eq;
 import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.spy;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.times;
@@ -91,6 +94,7 @@ public class ActivityStarterTests extends ActivityTestsBase {
     private ActivityManagerService mService;
     private ActivityStarter mStarter;
     private ActivityStartController mController;
+    private ActivityMetricsLogger mActivityMetricsLogger;
 
     private static final int PRECONDITION_NO_CALLER_APP = 1;
     private static final int PRECONDITION_NO_INTENT_COMPONENT = 1 << 1;
@@ -104,11 +108,17 @@ public class ActivityStarterTests extends ActivityTestsBase {
     private static final int PRECONDITION_CANNOT_START_ANY_ACTIVITY = 1 << 9;
     private static final int PRECONDITION_DISALLOW_APP_SWITCHING = 1 << 10;
 
+    private static final int FAKE_CALLING_UID = 666;
+    private static final int FAKE_REAL_CALLING_UID = 667;
+    private static final String FAKE_CALLING_PACKAGE = "com.whatever.dude";
+
     @Override
     public void setUp() throws Exception {
         super.setUp();
         mService = createActivityManagerService();
         mController = mock(ActivityStartController.class);
+        mActivityMetricsLogger = mock(ActivityMetricsLogger.class);
+        clearInvocations(mActivityMetricsLogger);
         mStarter = new ActivityStarter(mController, mService, mService.mStackSupervisor,
                 mock(ActivityStartInterceptor.class));
     }
@@ -471,4 +481,46 @@ public class ActivityStarterTests extends ActivityTestsBase {
             assertTrue(stack.getAllTasks().isEmpty());
         }
     }
+
+    /**
+     * This test ensures that activity starts are not being logged when the logging is disabled.
+     */
+    @Test
+    public void testActivityStartsLogging_noLoggingWhenDisabled() {
+        doReturn(false).when(mService).isActivityStartsLoggingEnabled();
+        doReturn(mActivityMetricsLogger).when(mService.mStackSupervisor).getActivityMetricsLogger();
+
+        ActivityStarter starter = prepareStarter(FLAG_ACTIVITY_NEW_TASK);
+        starter.setReason("testActivityStartsLogging_noLoggingWhenDisabled").execute();
+
+        // verify logging wasn't done
+        verify(mActivityMetricsLogger, never()).logActivityStart(any(), any(), any(), anyInt(),
+                any(), anyInt(), anyBoolean(), anyInt(), anyInt(), anyBoolean(), anyInt(), any(),
+                anyInt(), anyBoolean(), any(), anyBoolean());
+    }
+
+    /**
+     * This test ensures that activity starts are being logged when the logging is enabled.
+     */
+    @Test
+    public void testActivityStartsLogging_logsWhenEnabled() {
+        // note: conveniently this package doesn't have any activity visible
+        doReturn(true).when(mService).isActivityStartsLoggingEnabled();
+        doReturn(mActivityMetricsLogger).when(mService.mStackSupervisor).getActivityMetricsLogger();
+
+        ActivityStarter starter = prepareStarter(FLAG_ACTIVITY_NEW_TASK)
+                .setCallingUid(FAKE_CALLING_UID)
+                .setRealCallingUid(FAKE_REAL_CALLING_UID)
+                .setCallingPackage(FAKE_CALLING_PACKAGE)
+                .setOriginatingPendingIntent(null);
+
+        starter.setReason("testActivityStartsLogging_logsWhenEnabled").execute();
+
+        // verify the above activity start was logged
+        verify(mActivityMetricsLogger, times(1)).logActivityStart(any(), any(), any(),
+                eq(FAKE_CALLING_UID), eq(FAKE_CALLING_PACKAGE), anyInt(), anyBoolean(),
+                eq(FAKE_REAL_CALLING_UID), anyInt(), anyBoolean(), anyInt(),
+                eq(ActivityBuilder.getDefaultComponent().getPackageName()), anyInt(), anyBoolean(),
+                any(), eq(false));
+    }
 }
diff --git a/services/tests/servicestests/src/com/android/server/policy/PhoneWindowManagerTestBase.java b/services/tests/servicestests/src/com/android/server/policy/PhoneWindowManagerTestBase.java
index 2c47a9432ef..1d378020fa4 100644
--- a/services/tests/servicestests/src/com/android/server/policy/PhoneWindowManagerTestBase.java
+++ b/services/tests/servicestests/src/com/android/server/policy/PhoneWindowManagerTestBase.java
@@ -37,6 +37,7 @@ import android.graphics.Matrix;
 import android.graphics.Path;
 import android.graphics.PixelFormat;
 import android.graphics.Rect;
+import android.graphics.RectF;
 import android.os.IBinder;
 import android.os.UserHandle;
 import android.support.test.InstrumentationRegistry;
@@ -172,15 +173,14 @@ public class PhoneWindowManagerTestBase {
     }
 
     private static DisplayCutout displayCutoutForRotation(int rotation) {
-        Path p = new Path();
-        p.addRect(DISPLAY_WIDTH / 4, 0, DISPLAY_WIDTH * 3 / 4, DISPLAY_CUTOUT_HEIGHT,
-                Path.Direction.CCW);
+        RectF rectF = new RectF(DISPLAY_WIDTH / 4, 0, DISPLAY_WIDTH * 3 / 4, DISPLAY_CUTOUT_HEIGHT);
 
         Matrix m = new Matrix();
         transformPhysicalToLogicalCoordinates(rotation, DISPLAY_WIDTH, DISPLAY_HEIGHT, m);
-        p.transform(m);
+        m.mapRect(rectF);
 
-        return DisplayCutout.fromBounds(p);
+        return DisplayCutout.fromBoundingRect((int) rectF.left, (int) rectF.top,
+                (int) rectF.right, (int) rectF.bottom);
     }
 
     static class TestContextWrapper extends ContextWrapper {
diff --git a/services/tests/servicestests/src/com/android/server/wm/SurfaceAnimationRunnerTest.java b/services/tests/servicestests/src/com/android/server/wm/SurfaceAnimationRunnerTest.java
index edac8a5202d..79e9bb4c769 100644
--- a/services/tests/servicestests/src/com/android/server/wm/SurfaceAnimationRunnerTest.java
+++ b/services/tests/servicestests/src/com/android/server/wm/SurfaceAnimationRunnerTest.java
@@ -20,24 +20,23 @@ import static java.util.concurrent.TimeUnit.SECONDS;
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertTrue;
+import static org.mockito.ArgumentMatchers.anyInt;
 import static org.mockito.Mockito.any;
 import static org.mockito.Mockito.atLeast;
 import static org.mockito.Mockito.atLeastOnce;
 import static org.mockito.Mockito.eq;
-import static org.mockito.Mockito.times;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
 
-import android.animation.AnimationHandler;
 import android.animation.AnimationHandler.AnimationFrameCallbackProvider;
 import android.animation.ValueAnimator;
 import android.graphics.Matrix;
 import android.graphics.Point;
+import android.os.PowerManagerInternal;
 import android.platform.test.annotations.Presubmit;
 import android.support.test.filters.FlakyTest;
 import android.support.test.filters.SmallTest;
 import android.support.test.runner.AndroidJUnit4;
-import android.util.Log;
 import android.view.Choreographer;
 import android.view.Choreographer.FrameCallback;
 import android.view.SurfaceControl;
@@ -46,7 +45,6 @@ import android.view.animation.Animation;
 import android.view.animation.TranslateAnimation;
 
 import com.android.server.wm.LocalAnimationAdapter.AnimationSpec;
-import com.android.server.wm.SurfaceAnimationRunner.AnimatorFactory;
 
 import org.junit.Before;
 import org.junit.Rule;
@@ -71,6 +69,7 @@ public class SurfaceAnimationRunnerTest extends WindowTestsBase {
     @Mock SurfaceControl mMockSurface;
     @Mock Transaction mMockTransaction;
     @Mock AnimationSpec mMockAnimationSpec;
+    @Mock PowerManagerInternal mMockPowerManager;
     @Rule public MockitoRule mMockitoRule = MockitoJUnit.rule();
 
     private SurfaceAnimationRunner mSurfaceAnimationRunner;
@@ -81,7 +80,7 @@ public class SurfaceAnimationRunnerTest extends WindowTestsBase {
         super.setUp();
         mFinishCallbackLatch = new CountDownLatch(1);
         mSurfaceAnimationRunner = new SurfaceAnimationRunner(null /* callbackProvider */, null,
-                mMockTransaction);
+                mMockTransaction, mMockPowerManager);
     }
 
     private void finishedCallback() {
@@ -113,7 +112,7 @@ public class SurfaceAnimationRunnerTest extends WindowTestsBase {
     @Test
     public void testCancel_notStarted() throws Exception {
         mSurfaceAnimationRunner = new SurfaceAnimationRunner(new NoOpFrameCallbackProvider(), null,
-                mMockTransaction);
+                mMockTransaction, mMockPowerManager);
         mSurfaceAnimationRunner
                 .startAnimation(createTranslateAnimation(), mMockSurface, mMockTransaction,
                 this::finishedCallback);
@@ -126,7 +125,7 @@ public class SurfaceAnimationRunnerTest extends WindowTestsBase {
     @Test
     public void testCancel_running() throws Exception {
         mSurfaceAnimationRunner = new SurfaceAnimationRunner(new NoOpFrameCallbackProvider(), null,
-                mMockTransaction);
+                mMockTransaction, mMockPowerManager);
         mSurfaceAnimationRunner.startAnimation(createTranslateAnimation(), mMockSurface,
                 mMockTransaction, this::finishedCallback);
         waitUntilNextFrame();
@@ -156,7 +155,7 @@ public class SurfaceAnimationRunnerTest extends WindowTestsBase {
                     listener.onAnimationUpdate(animation);
                 });
             }
-        }, mMockTransaction);
+        }, mMockTransaction, mMockPowerManager);
         when(mMockAnimationSpec.getDuration()).thenReturn(200L);
         mSurfaceAnimationRunner.startAnimation(mMockAnimationSpec, mMockSurface, mMockTransaction,
                 this::finishedCallback);
@@ -184,6 +183,19 @@ public class SurfaceAnimationRunnerTest extends WindowTestsBase {
         assertFinishCallbackCalled();
     }
 
+    @Test
+    public void testPowerHint() throws Exception {
+        mSurfaceAnimationRunner = new SurfaceAnimationRunner(new NoOpFrameCallbackProvider(), null,
+                mMockTransaction, mMockPowerManager);
+        mSurfaceAnimationRunner.startAnimation(createTranslateAnimation(), mMockSurface,
+                mMockTransaction, this::finishedCallback);
+        waitUntilNextFrame();
+
+        // TODO: For some reason we don't have access to PowerHint definition from the tests. For
+        // now let's just verify that we got some kind of hint.
+        verify(mMockPowerManager).powerHint(anyInt(), anyInt());
+    }
+
     private void waitUntilNextFrame() throws Exception {
         final CountDownLatch latch = new CountDownLatch(1);
         mSurfaceAnimationRunner.mChoreographer.postCallback(Choreographer.CALLBACK_COMMIT,
diff --git a/services/tests/servicestests/src/com/android/server/wm/WindowStateTests.java b/services/tests/servicestests/src/com/android/server/wm/WindowStateTests.java
index 85e846db60b..9f113ad3137 100644
--- a/services/tests/servicestests/src/com/android/server/wm/WindowStateTests.java
+++ b/services/tests/servicestests/src/com/android/server/wm/WindowStateTests.java
@@ -16,6 +16,8 @@
 
 package com.android.server.wm;
 
+import android.graphics.Rect;
+import android.view.SurfaceControl;
 import android.view.WindowManager;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -29,6 +31,8 @@ import java.util.LinkedList;
 
 import static android.app.WindowConfiguration.ACTIVITY_TYPE_STANDARD;
 import static android.app.WindowConfiguration.WINDOWING_MODE_FULLSCREEN;
+import static android.hardware.camera2.params.OutputConfiguration.ROTATION_90;
+import static android.view.Surface.ROTATION_0;
 import static android.view.WindowManager.LayoutParams.FIRST_SUB_WINDOW;
 import static android.view.WindowManager.LayoutParams.FLAG_ALT_FOCUSABLE_IM;
 import static android.view.WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;
@@ -48,8 +52,10 @@ import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertNull;
 import static org.junit.Assert.assertThat;
 import static org.junit.Assert.assertTrue;
+import static org.mockito.ArgumentMatchers.any;
 import static org.mockito.ArgumentMatchers.anyLong;
 import static org.mockito.ArgumentMatchers.anyString;
+import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.reset;
 import static org.mockito.Mockito.spy;
@@ -349,6 +355,32 @@ public class WindowStateTests extends WindowTestsBase {
         assertThat(app.getDisplayId(), is(mDisplayContent.getDisplayId()));
     }
 
+    @Test
+    public void testSeamlesslyRotateWindow() {
+        final WindowState app = createWindow(null, TYPE_APPLICATION, "app");
+        final SurfaceControl.Transaction t = mock(SurfaceControl.Transaction.class);
+
+        app.mHasSurface = true;
+        app.mSurfaceControl = mock(SurfaceControl.class);
+        app.mWinAnimator.mSurfaceController = mock(WindowSurfaceController.class);
+        try {
+            app.mFrame.set(10, 20, 60, 80);
+
+            app.seamlesslyRotate(t, ROTATION_0, ROTATION_90);
+
+            assertTrue(app.mSeamlesslyRotated);
+            assertEquals(new Rect(20, mDisplayInfo.logicalWidth - 60,
+                    80, mDisplayInfo.logicalWidth - 10), app.mFrame);
+
+            verify(t).setPosition(app.mSurfaceControl, app.mFrame.left, app.mFrame.top);
+            verify(app.mWinAnimator.mSurfaceController).setPosition(t, 0, 50, false);
+            verify(app.mWinAnimator.mSurfaceController).setMatrix(t, 0, -1, 1, 0, false);
+        } finally {
+            app.mSurfaceControl = null;
+            app.mHasSurface = false;
+        }
+    }
+
     private void testPrepareWindowToDisplayDuringRelayout(boolean wasVisible) {
         reset(mPowerManagerWrapper);
         final WindowState root = createWindow(null, TYPE_APPLICATION, "root");
diff --git a/services/tests/servicestests/src/com/android/server/wm/utils/CoordinateTransformsTest.java b/services/tests/servicestests/src/com/android/server/wm/utils/CoordinateTransformsTest.java
index 40a10e04c89..f82b01224f9 100644
--- a/services/tests/servicestests/src/com/android/server/wm/utils/CoordinateTransformsTest.java
+++ b/services/tests/servicestests/src/com/android/server/wm/utils/CoordinateTransformsTest.java
@@ -21,14 +21,19 @@ import static android.view.Surface.ROTATION_180;
 import static android.view.Surface.ROTATION_270;
 import static android.view.Surface.ROTATION_90;
 
+import static com.android.server.wm.utils.CoordinateTransforms.transformLogicalToPhysicalCoordinates;
 import static com.android.server.wm.utils.CoordinateTransforms.transformPhysicalToLogicalCoordinates;
 
+
+import static com.android.server.wm.utils.CoordinateTransforms.transformToRotation;
+
 import static org.hamcrest.Matchers.is;
 import static org.junit.Assert.*;
 
 import android.graphics.Matrix;
 import android.graphics.Point;
 import android.graphics.PointF;
+import android.view.DisplayInfo;
 
 import org.junit.Before;
 import org.junit.Rule;
@@ -41,6 +46,7 @@ public class CoordinateTransformsTest {
     private static final int H = 400;
 
     private final Matrix mMatrix = new Matrix();
+    private final Matrix mMatrix2 = new Matrix();
 
     @Rule
     public final ErrorCollector mErrorCollector = new ErrorCollector();
@@ -48,39 +54,140 @@ public class CoordinateTransformsTest {
     @Before
     public void setUp() throws Exception {
         mMatrix.setTranslate(0xdeadbeef, 0xdeadbeef);
+        mMatrix2.setTranslate(0xbeefdead, 0xbeefdead);
     }
 
     @Test
-    public void transformPhysicalToLogicalCoordinates_rot0() throws Exception {
+    public void transformPhysicalToLogicalCoordinates_rot0() {
         transformPhysicalToLogicalCoordinates(ROTATION_0, W, H, mMatrix);
         assertThat(mMatrix, is(Matrix.IDENTITY_MATRIX));
     }
 
     @Test
-    public void transformPhysicalToLogicalCoordinates_rot90() throws Exception {
+    public void transformPhysicalToLogicalCoordinates_rot90() {
         transformPhysicalToLogicalCoordinates(ROTATION_90, W, H, mMatrix);
 
-        checkDevicePoint(0, 0).mapsToLogicalPoint(0, W);
-        checkDevicePoint(W, H).mapsToLogicalPoint(H, 0);
+        checkPoint(0, 0).transformsTo(0, W);
+        checkPoint(W, H).transformsTo(H, 0);
     }
 
     @Test
-    public void transformPhysicalToLogicalCoordinates_rot180() throws Exception {
+    public void transformPhysicalToLogicalCoordinates_rot180() {
         transformPhysicalToLogicalCoordinates(ROTATION_180, W, H, mMatrix);
 
-        checkDevicePoint(0, 0).mapsToLogicalPoint(W, H);
-        checkDevicePoint(W, H).mapsToLogicalPoint(0, 0);
+        checkPoint(0, 0).transformsTo(W, H);
+        checkPoint(W, H).transformsTo(0, 0);
     }
 
     @Test
-    public void transformPhysicalToLogicalCoordinates_rot270() throws Exception {
+    public void transformPhysicalToLogicalCoordinates_rot270() {
         transformPhysicalToLogicalCoordinates(ROTATION_270, W, H, mMatrix);
 
-        checkDevicePoint(0, 0).mapsToLogicalPoint(H, 0);
-        checkDevicePoint(W, H).mapsToLogicalPoint(0, W);
+        checkPoint(0, 0).transformsTo(H, 0);
+        checkPoint(W, H).transformsTo(0, W);
+    }
+
+    @Test
+    public void transformLogicalToPhysicalCoordinates_rot0() {
+        transformLogicalToPhysicalCoordinates(ROTATION_0, W, H, mMatrix);
+        assertThat(mMatrix, is(Matrix.IDENTITY_MATRIX));
+    }
+
+    @Test
+    public void transformLogicalToPhysicalCoordinates_rot90() {
+        transformLogicalToPhysicalCoordinates(ROTATION_90, W, H, mMatrix);
+
+        checkPoint(0, W).transformsTo(0, 0);
+        checkPoint(H, 0).transformsTo(W, H);
+    }
+
+    @Test
+    public void transformLogicalToPhysicalCoordinates_rot180() {
+        transformLogicalToPhysicalCoordinates(ROTATION_180, W, H, mMatrix);
+
+        checkPoint(W, H).transformsTo(0, 0);
+        checkPoint(0, 0).transformsTo(W, H);
+    }
+
+    @Test
+    public void transformLogicalToPhysicalCoordinates_rot270() {
+        transformLogicalToPhysicalCoordinates(ROTATION_270, W, H, mMatrix);
+
+        checkPoint(H, 0).transformsTo(0, 0);
+        checkPoint(0, W).transformsTo(W, H);
+    }
+
+    @Test
+    public void transformLogicalToPhysicalCoordinatesIsInverse_rot0() {
+        transformLogicalToPhysicalCoordinates(ROTATION_0, W, H, mMatrix);
+        transformPhysicalToLogicalCoordinates(ROTATION_0, W, H, mMatrix2);
+
+        assertMatricesAreInverses(mMatrix, mMatrix2);
+    }
+
+    @Test
+    public void transformLogicalToPhysicalCoordinatesIsInverse_rot90() {
+        transformLogicalToPhysicalCoordinates(ROTATION_90, W, H, mMatrix);
+        transformPhysicalToLogicalCoordinates(ROTATION_90, W, H, mMatrix2);
+
+        assertMatricesAreInverses(mMatrix, mMatrix2);
+    }
+
+    @Test
+    public void transformLogicalToPhysicalCoordinatesIsInverse_rot180() {
+        transformLogicalToPhysicalCoordinates(ROTATION_180, W, H, mMatrix);
+        transformPhysicalToLogicalCoordinates(ROTATION_180, W, H, mMatrix2);
+
+        assertMatricesAreInverses(mMatrix, mMatrix2);
+    }
+
+    @Test
+    public void transformLogicalToPhysicalCoordinatesIsInverse_rot270() {
+        transformLogicalToPhysicalCoordinates(ROTATION_270, W, H, mMatrix);
+        transformPhysicalToLogicalCoordinates(ROTATION_270, W, H, mMatrix2);
+
+        assertMatricesAreInverses(mMatrix, mMatrix2);
+    }
+
+    @Test
+    public void transformBetweenRotations_rot180_rot270() {
+        // W,H are flipped, because they need to be given in the new orientation, i.e. ROT_270.
+        transformToRotation(ROTATION_180, ROTATION_270, H, W, mMatrix);
+
+        checkPoint(0, 0).transformsTo(0, W);
+        checkPoint(W, H).transformsTo(H, 0);
+    }
+
+    @Test
+    public void transformBetweenRotations_rot90_rot0() {
+        transformToRotation(ROTATION_180, ROTATION_270, W, H, mMatrix);
+
+        checkPoint(0, 0).transformsTo(0, H);
+        // H,W is bottom right in ROT_90
+        checkPoint(H, W).transformsTo(W, 0);
+    }
+
+    @Test
+    public void transformBetweenRotations_displayInfo() {
+        final DisplayInfo di = new DisplayInfo();
+        di.rotation = ROTATION_90;
+        di.logicalWidth = H;  // dimensions are flipped in ROT_90
+        di.logicalHeight = W;
+        transformToRotation(ROTATION_180, ROTATION_270, di, mMatrix);
+
+        // W,H are flipped, because they need to be given in the new orientation, i.e. ROT_270.
+        transformToRotation(ROTATION_180, ROTATION_270, H, W, mMatrix2);
+
+        assertEquals(mMatrix2, mMatrix);
+    }
+
+    private void assertMatricesAreInverses(Matrix matrix, Matrix matrix2) {
+        final Matrix concat = new Matrix();
+        concat.setConcat(matrix, matrix2);
+        assertTrue("expected identity, but was: " + concat, concat.isIdentity());
     }
 
-    private DevicePointAssertable checkDevicePoint(int x, int y) {
+    private TransformPointAssertable checkPoint(int x, int y) {
         final Point devicePoint = new Point(x, y);
         final float[] fs = new float[] {x, y};
         mMatrix.mapPoints(fs);
@@ -92,7 +199,7 @@ public class CoordinateTransformsTest {
         };
     }
 
-    public interface DevicePointAssertable {
-        void mapsToLogicalPoint(int x, int y);
+    public interface TransformPointAssertable {
+        void transformsTo(int x, int y);
     }
 }
\ No newline at end of file
diff --git a/services/tests/servicestests/src/com/android/server/wm/utils/InsetUtilsTest.java b/services/tests/servicestests/src/com/android/server/wm/utils/InsetUtilsTest.java
index d0f0fe315bc..08bcc3d751f 100644
--- a/services/tests/servicestests/src/com/android/server/wm/utils/InsetUtilsTest.java
+++ b/services/tests/servicestests/src/com/android/server/wm/utils/InsetUtilsTest.java
@@ -16,6 +16,11 @@
 
 package com.android.server.wm.utils;
 
+import static android.hardware.camera2.params.OutputConfiguration.ROTATION_90;
+import static android.view.Surface.ROTATION_0;
+import static android.view.Surface.ROTATION_180;
+import static android.view.Surface.ROTATION_270;
+
 import static junit.framework.Assert.assertEquals;
 
 import android.graphics.Rect;
@@ -39,5 +44,29 @@ public class InsetUtilsTest {
         InsetUtils.addInsets(rect1, rect2);
         assertEquals(new Rect(60, 80, 100, 120), rect1);
     }
+
+    @Test
+    public void rotate() {
+        final Rect original = new Rect(1, 2, 3, 4);
+
+        assertEquals("rot0", original, rotateCopy(original, ROTATION_0));
+
+        final Rect rot90 = rotateCopy(original, ROTATION_90);
+        assertEquals("rot90", new Rect(2, 3, 4, 1), rot90);
+
+        final Rect rot180 = rotateCopy(original, ROTATION_180);
+        assertEquals("rot180", new Rect(3, 4, 1, 2), rot180);
+        assertEquals("rot90(rot90)=rot180", rotateCopy(rot90, ROTATION_90), rot180);
+
+        final Rect rot270 = rotateCopy(original, ROTATION_270);
+        assertEquals("rot270", new Rect(4, 1, 2, 3), rot270);
+        assertEquals("rot90(rot180)=rot270", rotateCopy(rot180, ROTATION_90), rot270);
+    }
+
+    private static Rect rotateCopy(Rect insets, int rotationDelta) {
+        final Rect copy = new Rect(insets);
+        InsetUtils.rotateInsets(copy, rotationDelta);
+        return copy;
+    }
 }
 
diff --git a/services/tests/uiservicestests/src/com/android/server/notification/BuzzBeepBlinkTest.java b/services/tests/uiservicestests/src/com/android/server/notification/BuzzBeepBlinkTest.java
index 78099996a1a..bdba3d5cd67 100644
--- a/services/tests/uiservicestests/src/com/android/server/notification/BuzzBeepBlinkTest.java
+++ b/services/tests/uiservicestests/src/com/android/server/notification/BuzzBeepBlinkTest.java
@@ -19,7 +19,9 @@ import static android.app.Notification.GROUP_ALERT_ALL;
 import static android.app.Notification.GROUP_ALERT_CHILDREN;
 import static android.app.Notification.GROUP_ALERT_SUMMARY;
 import static android.app.NotificationManager.IMPORTANCE_HIGH;
+import static android.app.NotificationManager.IMPORTANCE_LOW;
 import static android.app.NotificationManager.IMPORTANCE_MIN;
+import static android.app.NotificationManager.Policy.SUPPRESSED_EFFECT_LIGHTS;
 
 import static junit.framework.Assert.assertFalse;
 import static junit.framework.Assert.assertNull;
@@ -149,6 +151,9 @@ public class BuzzBeepBlinkTest extends UiServiceTestCase {
         mService.setFallbackVibrationPattern(FALLBACK_VIBRATION_PATTERN);
         mService.setUsageStats(mUsageStats);
         mService.setAccessibilityManager(accessibilityManager);
+        mService.mScreenOn = false;
+        mService.mInCall = false;
+        mService.mNotificationPulseEnabled = true;
     }
 
     //
@@ -216,8 +221,13 @@ public class BuzzBeepBlinkTest extends UiServiceTestCase {
     }
 
     private NotificationRecord getLightsNotification() {
+        return getNotificationRecord(mId, false /* insistent */, false /* once */,
+                false /* noisy */, false /* buzzy*/, true /* lights */);
+    }
+
+    private NotificationRecord getLightsOnceNotification() {
         return getNotificationRecord(mId, false /* insistent */, true /* once */,
-                false /* noisy */, true /* buzzy*/, true /* lights */);
+                false /* noisy */, false /* buzzy*/, true /* lights */);
     }
 
     private NotificationRecord getCustomLightsNotification() {
@@ -244,6 +254,12 @@ public class BuzzBeepBlinkTest extends UiServiceTestCase {
                 groupKey, groupAlertBehavior, false);
     }
 
+    private NotificationRecord getLightsNotificationRecord(String groupKey,
+            int groupAlertBehavior) {
+        return getNotificationRecord(mId, false, false, false, false, true /*lights*/, true, true,
+                true, groupKey, groupAlertBehavior, false);
+    }
+
     private NotificationRecord getNotificationRecord(int id, boolean insistent, boolean once,
             boolean noisy, boolean buzzy, boolean lights, boolean defaultVibration,
             boolean defaultSound, boolean defaultLights, String groupKey, int groupAlertBehavior,
@@ -369,6 +385,10 @@ public class BuzzBeepBlinkTest extends UiServiceTestCase {
         verify(mVibrator, never()).cancel();
     }
 
+    private void verifyNeverLights() {
+        verify(mLight, never()).setFlashing(anyInt(), anyInt(), anyInt(), anyInt());
+    }
+
     private void verifyLights() {
         verify(mLight, times(1)).setFlashing(anyInt(), anyInt(), anyInt(), anyInt());
     }
@@ -712,7 +732,8 @@ public class BuzzBeepBlinkTest extends UiServiceTestCase {
         mService.buzzBeepBlinkLocked(summary);
 
         verifyBeepLooped();
-        assertTrue(summary.isInterruptive());
+        // summaries are never interruptive for notification counts
+        assertFalse(summary.isInterruptive());
     }
 
     @Test
@@ -990,6 +1011,156 @@ public class BuzzBeepBlinkTest extends UiServiceTestCase {
         verify(mAccessibilityService, times(1)).sendAccessibilityEvent(any(), anyInt());
     }
 
+    @Test
+    public void testLightsScreenOn() {
+        mService.mScreenOn = true;
+        NotificationRecord r = getLightsNotification();
+        mService.buzzBeepBlinkLocked(r);
+        verifyNeverLights();
+        assertFalse(r.isInterruptive());
+    }
+
+    @Test
+    public void testLightsInCall() {
+        mService.mInCall = true;
+        NotificationRecord r = getLightsNotification();
+        mService.buzzBeepBlinkLocked(r);
+        verifyNeverLights();
+        assertFalse(r.isInterruptive());
+    }
+
+    @Test
+    public void testLightsSilentUpdate() {
+        NotificationRecord r = getLightsOnceNotification();
+        mService.buzzBeepBlinkLocked(r);
+        verifyLights();
+        assertTrue(r.isInterruptive());
+
+        r = getLightsOnceNotification();
+        r.isUpdate = true;
+        mService.buzzBeepBlinkLocked(r);
+        // checks that lights happened once, i.e. this new call didn't trigger them again
+        verifyLights();
+        assertFalse(r.isInterruptive());
+    }
+
+    @Test
+    public void testLightsUnimportant() {
+        NotificationRecord r = getLightsNotification();
+        r.setImportance(IMPORTANCE_LOW, "testing");
+        mService.buzzBeepBlinkLocked(r);
+        verifyNeverLights();
+        assertFalse(r.isInterruptive());
+    }
+
+    @Test
+    public void testLightsNoLights() {
+        NotificationRecord r = getQuietNotification();
+        mService.buzzBeepBlinkLocked(r);
+        verifyNeverLights();
+        assertFalse(r.isInterruptive());
+    }
+
+    @Test
+    public void testLightsNoLightOnDevice() {
+        mService.mHasLight = false;
+        NotificationRecord r = getLightsNotification();
+        mService.buzzBeepBlinkLocked(r);
+        verifyNeverLights();
+        assertFalse(r.isInterruptive());
+    }
+
+    @Test
+    public void testLightsLightsOffGlobally() {
+        mService.mNotificationPulseEnabled = false;
+        NotificationRecord r = getLightsNotification();
+        mService.buzzBeepBlinkLocked(r);
+        verifyNeverLights();
+        assertFalse(r.isInterruptive());
+    }
+
+    @Test
+    public void testLightsDndIntercepted() {
+        NotificationRecord r = getLightsNotification();
+        r.setSuppressedVisualEffects(SUPPRESSED_EFFECT_LIGHTS);
+        mService.buzzBeepBlinkLocked(r);
+        verifyNeverLights();
+        assertFalse(r.isInterruptive());
+    }
+
+    @Test
+    public void testGroupAlertSummaryNoLightsChild() {
+        NotificationRecord child = getLightsNotificationRecord("a", GROUP_ALERT_SUMMARY);
+
+        mService.buzzBeepBlinkLocked(child);
+
+        verifyNeverLights();
+        assertFalse(child.isInterruptive());
+    }
+
+    @Test
+    public void testGroupAlertSummaryLightsSummary() {
+        NotificationRecord summary = getLightsNotificationRecord("a", GROUP_ALERT_SUMMARY);
+        summary.getNotification().flags |= Notification.FLAG_GROUP_SUMMARY;
+
+        mService.buzzBeepBlinkLocked(summary);
+
+        verifyLights();
+        // summaries should never count for interruptiveness counts
+        assertFalse(summary.isInterruptive());
+    }
+
+    @Test
+    public void testGroupAlertSummaryLightsNonGroupChild() {
+        NotificationRecord nonGroup = getLightsNotificationRecord(null, GROUP_ALERT_SUMMARY);
+
+        mService.buzzBeepBlinkLocked(nonGroup);
+
+        verifyLights();
+        assertTrue(nonGroup.isInterruptive());
+    }
+
+    @Test
+    public void testGroupAlertChildNoLightsSummary() {
+        NotificationRecord summary = getLightsNotificationRecord("a", GROUP_ALERT_CHILDREN);
+        summary.getNotification().flags |= Notification.FLAG_GROUP_SUMMARY;
+
+        mService.buzzBeepBlinkLocked(summary);
+
+        verifyNeverLights();
+        assertFalse(summary.isInterruptive());
+    }
+
+    @Test
+    public void testGroupAlertChildLightsChild() {
+        NotificationRecord child = getLightsNotificationRecord("a", GROUP_ALERT_CHILDREN);
+
+        mService.buzzBeepBlinkLocked(child);
+
+        verifyLights();
+        assertTrue(child.isInterruptive());
+    }
+
+    @Test
+    public void testGroupAlertChildLightsNonGroupSummary() {
+        NotificationRecord nonGroup = getLightsNotificationRecord(null, GROUP_ALERT_CHILDREN);
+
+        mService.buzzBeepBlinkLocked(nonGroup);
+
+        verifyLights();
+        assertTrue(nonGroup.isInterruptive());
+    }
+
+    @Test
+    public void testGroupAlertAllLightsGroup() {
+        NotificationRecord group = getLightsNotificationRecord("a", GROUP_ALERT_ALL);
+
+        mService.buzzBeepBlinkLocked(group);
+
+        verifyLights();
+        assertTrue(group.isInterruptive());
+    }
+
     static class VibrateRepeatMatcher implements ArgumentMatcher<VibrationEffect> {
         private final int mRepeatIndex;
 
diff --git a/services/tests/uiservicestests/src/com/android/server/notification/NotificationManagerServiceTest.java b/services/tests/uiservicestests/src/com/android/server/notification/NotificationManagerServiceTest.java
index a408438b763..cdbf3c66767 100644
--- a/services/tests/uiservicestests/src/com/android/server/notification/NotificationManagerServiceTest.java
+++ b/services/tests/uiservicestests/src/com/android/server/notification/NotificationManagerServiceTest.java
@@ -2941,6 +2941,20 @@ public class NotificationManagerServiceTest extends UiServiceTestCase {
         assertFalse(mService.isVisuallyInterruptive(r1, r2));
     }
 
+    @Test
+    public void testVisualDifference_summaryNewNotification() {
+        Notification.Builder nb2 = new Notification.Builder(mContext, "")
+                .setGroup("bananas")
+                .setFlag(Notification.FLAG_GROUP_SUMMARY, true)
+                .setContentText("bar");
+        StatusBarNotification sbn2 = new StatusBarNotification(PKG, PKG, 0, "tag", mUid, 0,
+                nb2.build(), new UserHandle(mUid), null, 0);
+        NotificationRecord r2 =
+                new NotificationRecord(mContext, sbn2, mock(NotificationChannel.class));
+
+        assertFalse(mService.isVisuallyInterruptive(null, r2));
+    }
+
     @Test
     public void testHideAndUnhideNotificationsOnSuspendedPackageBroadcast() {
         // post 2 notification from this package
diff --git a/services/tests/uiservicestests/src/com/android/server/notification/ZenModeHelperTest.java b/services/tests/uiservicestests/src/com/android/server/notification/ZenModeHelperTest.java
index afc12636007..8222c386c0d 100644
--- a/services/tests/uiservicestests/src/com/android/server/notification/ZenModeHelperTest.java
+++ b/services/tests/uiservicestests/src/com/android/server/notification/ZenModeHelperTest.java
@@ -38,6 +38,7 @@ import static org.mockito.Mockito.times;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
 
+import android.app.AppGlobals;
 import android.app.AppOpsManager;
 import android.app.NotificationManager;
 import android.content.ComponentName;
@@ -49,8 +50,10 @@ import android.media.AudioManager;
 import android.media.AudioManagerInternal;
 import android.media.VolumePolicy;
 import android.media.AudioSystem;
+import android.net.Uri;
 import android.provider.Settings;
 import android.provider.Settings.Global;
+import android.service.notification.Condition;
 import android.service.notification.ZenModeConfig;
 import android.service.notification.ZenModeConfig.ScheduleInfo;
 import android.test.suitebuilder.annotation.SmallTest;
@@ -61,6 +64,7 @@ import android.util.Xml;
 
 import com.android.internal.R;
 import com.android.internal.messages.nano.SystemMessageProto.SystemMessage;
+import com.android.server.notification.ManagedServices.UserProfiles;
 import com.android.internal.util.FastXmlSerializer;
 import com.android.server.UiServiceTestCase;
 import android.util.Slog;
@@ -83,7 +87,7 @@ import java.io.ByteArrayOutputStream;
 @TestableLooper.RunWithLooper
 public class ZenModeHelperTest extends UiServiceTestCase {
 
-    @Mock ConditionProviders mConditionProviders;
+    ConditionProviders mConditionProviders;
     @Mock NotificationManager mNotificationManager;
     @Mock private Resources mResources;
     private TestableLooper mTestableLooper;
@@ -103,6 +107,9 @@ public class ZenModeHelperTest extends UiServiceTestCase {
         when(mResources.getString(R.string.zen_mode_default_events_name)).thenReturn("events");
         when(mContext.getSystemService(NotificationManager.class)).thenReturn(mNotificationManager);
 
+        mConditionProviders = new ConditionProviders(mContext, new UserProfiles(),
+                AppGlobals.getPackageManager());
+        mConditionProviders.addSystemProvider(new CountdownConditionProvider());
         mZenModeHelperSpy = spy(new ZenModeHelper(mContext, mTestableLooper.getLooper(),
                 mConditionProviders));
     }
@@ -116,7 +123,7 @@ public class ZenModeHelperTest extends UiServiceTestCase {
         mZenModeHelperSpy.writeXml(serializer, forBackup, version);
         serializer.endDocument();
         serializer.flush();
-        mZenModeHelperSpy.setConfig(new ZenModeConfig(), "writing xml");
+        mZenModeHelperSpy.setConfig(new ZenModeConfig(), null, "writing xml");
         return baos;
     }
 
@@ -813,6 +820,30 @@ public class ZenModeHelperTest extends UiServiceTestCase {
         setupZenConfigMaintained();
     }
 
+    @Test
+    public void testCountdownConditionSubscription() throws Exception {
+        ZenModeConfig config = new ZenModeConfig();
+        mZenModeHelperSpy.mConfig = config;
+        mZenModeHelperSpy.mConditions.evaluateConfig(mZenModeHelperSpy.mConfig, null, true);
+        assertEquals(0, mZenModeHelperSpy.mConditions.mSubscriptions.size());
+
+        mZenModeHelperSpy.mConfig.manualRule = new ZenModeConfig.ZenRule();
+        Uri conditionId = ZenModeConfig.toCountdownConditionId(9000000, false);
+        mZenModeHelperSpy.mConfig.manualRule.conditionId = conditionId;
+        mZenModeHelperSpy.mConfig.manualRule.component = new ComponentName("android",
+                CountdownConditionProvider.class.getName());
+        mZenModeHelperSpy.mConfig.manualRule.condition = new Condition(conditionId, "", "", "", 0,
+                Condition.STATE_TRUE, Condition.FLAG_RELEVANT_NOW);
+        mZenModeHelperSpy.mConfig.manualRule.enabled = true;
+        ZenModeConfig originalConfig = mZenModeHelperSpy.mConfig.copy();
+
+        mZenModeHelperSpy.mConditions.evaluateConfig(mZenModeHelperSpy.mConfig, null, true);
+
+        assertEquals(true, ZenModeConfig.isValidCountdownConditionId(conditionId));
+        assertEquals(originalConfig, mZenModeHelperSpy.mConfig);
+        assertEquals(1, mZenModeHelperSpy.mConditions.mSubscriptions.size());
+    }
+
     private void setupZenConfig() {
         mZenModeHelperSpy.mZenMode = Settings.Global.ZEN_MODE_IMPORTANT_INTERRUPTIONS;
         mZenModeHelperSpy.mConfig.allowAlarms = false;
diff --git a/services/tests/uiservicestests/src/com/android/server/slice/PinnedSliceStateTest.java b/services/tests/uiservicestests/src/com/android/server/slice/PinnedSliceStateTest.java
index 3c4e333b6be..82e0fbe0e40 100644
--- a/services/tests/uiservicestests/src/com/android/server/slice/PinnedSliceStateTest.java
+++ b/services/tests/uiservicestests/src/com/android/server/slice/PinnedSliceStateTest.java
@@ -1,16 +1,16 @@
 package com.android.server.slice;
 
+import static android.testing.TestableContentResolver.UNSTABLE;
+
 import static org.junit.Assert.assertArrayEquals;
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertNull;
 import static org.junit.Assert.assertTrue;
-import static org.mockito.ArgumentMatchers.any;
 import static org.mockito.ArgumentMatchers.anyInt;
 import static org.mockito.ArgumentMatchers.anyString;
 import static org.mockito.ArgumentMatchers.argThat;
 import static org.mockito.ArgumentMatchers.eq;
-import static org.mockito.Mockito.doReturn;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
@@ -71,11 +71,12 @@ public class PinnedSliceStateTest extends UiServiceTestCase {
         mSliceService = mock(SliceManagerService.class);
         when(mSliceService.getContext()).thenReturn(mContext);
         when(mSliceService.getLock()).thenReturn(new Object());
-        when(mSliceService.getHandler()).thenReturn(new Handler(TestableLooper.get(this).getLooper()));
+        when(mSliceService.getHandler()).thenReturn(
+                new Handler(TestableLooper.get(this).getLooper()));
         mContentProvider = mock(ContentProvider.class);
         mIContentProvider = mock(IContentProvider.class);
         when(mContentProvider.getIContentProvider()).thenReturn(mIContentProvider);
-        mContext.getContentResolver().addProvider(AUTH, mContentProvider);
+        mContext.getContentResolver().addProvider(AUTH, mContentProvider, UNSTABLE);
         mPinnedSliceManager = new PinnedSliceState(mSliceService, TEST_URI, "pkg");
     }
 
diff --git a/telecomm/java/android/telecom/Connection.java b/telecomm/java/android/telecom/Connection.java
index 3bf951d4d8c..468c8fa9e30 100644
--- a/telecomm/java/android/telecom/Connection.java
+++ b/telecomm/java/android/telecom/Connection.java
@@ -45,6 +45,7 @@ import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.InputStreamReader;
 import java.io.OutputStreamWriter;
+import java.nio.channels.Channels;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collections;
@@ -853,6 +854,8 @@ public abstract class Connection extends Conferenceable {
         private final OutputStreamWriter mPipeToInCall;
         private final ParcelFileDescriptor mFdFromInCall;
         private final ParcelFileDescriptor mFdToInCall;
+
+        private final FileInputStream mFromInCallFileInputStream;
         private char[] mReadBuffer = new char[READ_BUFFER_SIZE];
 
         /**
@@ -861,8 +864,11 @@ public abstract class Connection extends Conferenceable {
         public RttTextStream(ParcelFileDescriptor toInCall, ParcelFileDescriptor fromInCall) {
             mFdFromInCall = fromInCall;
             mFdToInCall = toInCall;
+            mFromInCallFileInputStream = new FileInputStream(fromInCall.getFileDescriptor());
+
+            // Wrap the FileInputStream in a Channel so that it's interruptible.
             mPipeFromInCall = new InputStreamReader(
-                    new FileInputStream(fromInCall.getFileDescriptor()));
+                    Channels.newInputStream(Channels.newChannel(mFromInCallFileInputStream)));
             mPipeToInCall = new OutputStreamWriter(
                     new FileOutputStream(toInCall.getFileDescriptor()));
         }
@@ -910,7 +916,7 @@ public abstract class Connection extends Conferenceable {
          * not entered any new text yet.
          */
         public String readImmediately() throws IOException {
-            if (mPipeFromInCall.ready()) {
+            if (mFromInCallFileInputStream.available() > 0) {
                 return read();
             } else {
                 return null;
diff --git a/telecomm/java/android/telecom/PhoneAccount.java b/telecomm/java/android/telecom/PhoneAccount.java
index b3a3bf21cd8..8e22221d787 100644
--- a/telecomm/java/android/telecom/PhoneAccount.java
+++ b/telecomm/java/android/telecom/PhoneAccount.java
@@ -28,6 +28,7 @@ import java.lang.String;
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.List;
+import java.util.Objects;
 
 /**
  * Represents a distinct method to place or receive a phone call. Apps which can place calls and
@@ -348,6 +349,33 @@ public final class PhoneAccount implements Parcelable {
     private boolean mIsEnabled;
     private String mGroupId;
 
+    @Override
+    public boolean equals(Object o) {
+        if (this == o) return true;
+        if (o == null || getClass() != o.getClass()) return false;
+        PhoneAccount that = (PhoneAccount) o;
+        return mCapabilities == that.mCapabilities &&
+                mHighlightColor == that.mHighlightColor &&
+                mSupportedAudioRoutes == that.mSupportedAudioRoutes &&
+                mIsEnabled == that.mIsEnabled &&
+                Objects.equals(mAccountHandle, that.mAccountHandle) &&
+                Objects.equals(mAddress, that.mAddress) &&
+                Objects.equals(mSubscriptionAddress, that.mSubscriptionAddress) &&
+                Objects.equals(mLabel, that.mLabel) &&
+                Objects.equals(mShortDescription, that.mShortDescription) &&
+                Objects.equals(mSupportedUriSchemes, that.mSupportedUriSchemes) &&
+                areBundlesEqual(mExtras, that.mExtras) &&
+                Objects.equals(mGroupId, that.mGroupId);
+    }
+
+    @Override
+    public int hashCode() {
+        return Objects.hash(mAccountHandle, mAddress, mSubscriptionAddress, mCapabilities,
+                mHighlightColor, mLabel, mShortDescription, mSupportedUriSchemes,
+                mSupportedAudioRoutes,
+                mExtras, mIsEnabled, mGroupId);
+    }
+
     /**
      * Helper class for creating a {@link PhoneAccount}.
      */
@@ -1010,4 +1038,31 @@ public final class PhoneAccount implements Parcelable {
 
         return sb.toString();
     }
+
+    /**
+     * Determines if two {@link Bundle}s are equal.
+     * @param extras First {@link Bundle} to check.
+     * @param newExtras {@link Bundle} to compare against.
+     * @return {@code true} if the {@link Bundle}s are equal, {@code false} otherwise.
+     */
+    private static boolean areBundlesEqual(Bundle extras, Bundle newExtras) {
+        if (extras == null || newExtras == null) {
+            return extras == newExtras;
+        }
+
+        if (extras.size() != newExtras.size()) {
+            return false;
+        }
+
+        for(String key : extras.keySet()) {
+            if (key != null) {
+                final Object value = extras.get(key);
+                final Object newValue = newExtras.get(key);
+                if (!Objects.equals(value, newValue)) {
+                    return false;
+                }
+            }
+        }
+        return true;
+    }
 }
diff --git a/telephony/java/android/telephony/CarrierConfigManager.java b/telephony/java/android/telephony/CarrierConfigManager.java
index f66164c302c..a8b39e3b06b 100644
--- a/telephony/java/android/telephony/CarrierConfigManager.java
+++ b/telephony/java/android/telephony/CarrierConfigManager.java
@@ -77,6 +77,30 @@ public class CarrierConfigManager {
     public static final String
             KEY_CARRIER_VOLTE_PROVISIONED_BOOL = "carrier_volte_provisioned_bool";
 
+    /**
+     * Boolean indicating if the "Call forwarding" item is visible in the Call Settings menu.
+     * true means visible. false means gone.
+     * @hide
+     */
+    public static final String KEY_CALL_FORWARDING_VISIBILITY_BOOL =
+            "call_forwarding_visibility_bool";
+
+    /**
+     * Boolean indicating if the "Caller ID" item is visible in the Additional Settings menu.
+     * true means visible. false means gone.
+     * @hide
+     */
+    public static final String KEY_ADDITIONAL_SETTINGS_CALLER_ID_VISIBILITY_BOOL =
+            "additional_settings_caller_id_visibility_bool";
+
+    /**
+     * Boolean indicating if the "Call Waiting" item is visible in the Additional Settings menu.
+     * true means visible. false means gone.
+     * @hide
+     */
+    public static final String KEY_ADDITIONAL_SETTINGS_CALL_WAITING_VISIBILITY_BOOL =
+            "additional_settings_call_waiting_visibility_bool";
+
    /**
     * Boolean indicating if the "Call barring" item is visible in the Call Settings menu.
     * true means visible. false means gone.
@@ -189,6 +213,13 @@ public class CarrierConfigManager {
     public static final String
             KEY_ALLOW_EMERGENCY_NUMBERS_IN_CALL_LOG_BOOL = "allow_emergency_numbers_in_call_log_bool";
 
+    /**
+     * A string array containing numbers that shouldn't be included in the call log.
+     * @hide
+     */
+    public static final String KEY_UNLOGGABLE_NUMBERS_STRING_ARRAY =
+            "unloggable_numbers_string_array";
+
     /** If true, removes the Voice Privacy option from Call Settings */
     public static final String KEY_VOICE_PRIVACY_DISABLE_UI_BOOL = "voice_privacy_disable_ui_bool";
 
@@ -1030,6 +1061,26 @@ public class CarrierConfigManager {
      */
     public static final String KEY_CARRIER_NAME_STRING = "carrier_name_string";
 
+    /**
+     * Override the registered PLMN name using #KEY_CDMA_HOME_REGISTERED_PLMN_NAME_STRING.
+     *
+     * If true, then the registered PLMN name (only for CDMA/CDMA-LTE and only when not roaming)
+     * will be #KEY_CDMA_HOME_REGISTERED_PLMN_NAME_STRING. If false, or if phone type is not
+     * CDMA/CDMA-LTE or if roaming, then #KEY_CDMA_HOME_REGISTERED_PLMN_NAME_STRING will be ignored.
+     * @hide
+     */
+    public static final String KEY_CDMA_HOME_REGISTERED_PLMN_NAME_OVERRIDE_BOOL =
+            "cdma_home_registered_plmn_name_override_bool";
+
+    /**
+     * String to identify registered PLMN name in CarrierConfig app. This string overrides
+     * registered PLMN name if #KEY_CDMA_HOME_REGISTERED_PLMN_NAME_OVERRIDE_BOOL is true, phone type
+     * is CDMA/CDMA-LTE and device is not in roaming state; otherwise, it will be ignored.
+     * @hide
+     */
+    public static final String KEY_CDMA_HOME_REGISTERED_PLMN_NAME_STRING =
+            "cdma_home_registered_plmn_name_string";
+
     /**
      * If this is true, the SIM card (through Customer Service Profile EF file) will be able to
      * prevent manual operator selection. If false, this SIM setting will be ignored and manual
@@ -1437,6 +1488,15 @@ public class CarrierConfigManager {
     public static final String KEY_ALWAYS_PLAY_REMOTE_HOLD_TONE_BOOL =
             "always_play_remote_hold_tone_bool";
 
+    /**
+     * When true, the Telephony stack will automatically turn off airplane mode and retry a wifi
+     * emergency call over the cell network if the initial attempt at dialing was met with a SIP 308
+     * error.
+     * @hide
+     */
+    public static final String KEY_AUTO_RETRY_FAILED_WIFI_EMERGENCY_CALL =
+            "auto_retry_failed_wifi_emergency_call";
+
     /**
      * When true, indicates that adding a call is disabled when there is an ongoing video call
      * or when there is an ongoing call on wifi which was downgraded from video and VoWifi is
@@ -1545,7 +1605,7 @@ public class CarrierConfigManager {
     public static final String KEY_EDITABLE_WFC_ROAMING_MODE_BOOL =
             "editable_wfc_roaming_mode_bool";
 
-   /**
+    /**
      * Determine whether current lpp_mode used for E-911 needs to be kept persistently.
      * {@code false} - not keeping the lpp_mode means using default configuration of gps.conf
      *                 when sim is not presented.
@@ -1965,8 +2025,10 @@ public class CarrierConfigManager {
         sDefaults.putBoolean(KEY_ALLOW_HOLD_IN_IMS_CALL_BOOL, true);
         sDefaults.putBoolean(KEY_CARRIER_ALLOW_DEFLECT_IMS_CALL_BOOL, false);
         sDefaults.putBoolean(KEY_ALWAYS_PLAY_REMOTE_HOLD_TONE_BOOL, false);
+        sDefaults.putBoolean(KEY_AUTO_RETRY_FAILED_WIFI_EMERGENCY_CALL, false);
         sDefaults.putBoolean(KEY_ADDITIONAL_CALL_SETTING_BOOL, true);
         sDefaults.putBoolean(KEY_ALLOW_EMERGENCY_NUMBERS_IN_CALL_LOG_BOOL, false);
+        sDefaults.putStringArray(KEY_UNLOGGABLE_NUMBERS_STRING_ARRAY, null);
         sDefaults.putBoolean(KEY_ALLOW_LOCAL_DTMF_TONES_BOOL, true);
         sDefaults.putBoolean(KEY_PLAY_CALL_RECORDING_TONE_BOOL, false);
         sDefaults.putBoolean(KEY_APN_EXPAND_BOOL, true);
@@ -2015,6 +2077,9 @@ public class CarrierConfigManager {
 
         sDefaults.putBoolean(KEY_CARRIER_VOLTE_PROVISIONED_BOOL, false);
         sDefaults.putBoolean(KEY_CALL_BARRING_VISIBILITY_BOOL, false);
+        sDefaults.putBoolean(KEY_CALL_FORWARDING_VISIBILITY_BOOL, true);
+        sDefaults.putBoolean(KEY_ADDITIONAL_SETTINGS_CALLER_ID_VISIBILITY_BOOL, true);
+        sDefaults.putBoolean(KEY_ADDITIONAL_SETTINGS_CALL_WAITING_VISIBILITY_BOOL, true);
         sDefaults.putBoolean(KEY_IGNORE_SIM_NETWORK_LOCKED_EVENTS_BOOL, false);
         sDefaults.putBoolean(KEY_MDN_IS_ADDITIONAL_VOICEMAIL_NUMBER_BOOL, false);
         sDefaults.putBoolean(KEY_OPERATOR_SELECTION_EXPAND_BOOL, true);
@@ -2129,6 +2194,8 @@ public class CarrierConfigManager {
         sDefaults.putBoolean(KEY_CONFIG_WIFI_DISABLE_IN_ECBM, false);
         sDefaults.putBoolean(KEY_CARRIER_NAME_OVERRIDE_BOOL, false);
         sDefaults.putString(KEY_CARRIER_NAME_STRING, "");
+        sDefaults.putBoolean(KEY_CDMA_HOME_REGISTERED_PLMN_NAME_OVERRIDE_BOOL, false);
+        sDefaults.putString(KEY_CDMA_HOME_REGISTERED_PLMN_NAME_STRING, "");
         sDefaults.putBoolean(KEY_SUPPORT_DIRECT_FDN_DIALING_BOOL, false);
         sDefaults.putBoolean(KEY_CARRIER_DEFAULT_DATA_ROAMING_ENABLED_BOOL, false);
         sDefaults.putBoolean(KEY_SKIP_CF_FAIL_TO_DISABLE_DIALOG_BOOL, false);
diff --git a/telephony/java/android/telephony/TelephonyManager.java b/telephony/java/android/telephony/TelephonyManager.java
index 63a1430c35e..911e539e53f 100644
--- a/telephony/java/android/telephony/TelephonyManager.java
+++ b/telephony/java/android/telephony/TelephonyManager.java
@@ -340,11 +340,18 @@ public class TelephonyManager {
      * <p>
      * The {@link #EXTRA_STATE} extra indicates the new call state.
      * If a receiving app has {@link android.Manifest.permission#READ_CALL_LOG} permission, a second
-     * extra {@link #EXTRA_INCOMING_NUMBER} provides the phone number for incoming and outoing calls
-     * as a String.  Note: If the receiving app has
+     * extra {@link #EXTRA_INCOMING_NUMBER} provides the phone number for incoming and outgoing
+     * calls as a String.
+     * <p>
+     * If the receiving app has
      * {@link android.Manifest.permission#READ_CALL_LOG} and
      * {@link android.Manifest.permission#READ_PHONE_STATE} permission, it will receive the
-     * broadcast twice; one with the phone number and another without it.
+     * broadcast twice; one with the {@link #EXTRA_INCOMING_NUMBER} populated with the phone number,
+     * and another with it blank.  Due to the nature of broadcasts, you cannot assume the order
+     * in which these broadcasts will arrive, however you are guaranteed to receive two in this
+     * case.  Apps which are interested in the {@link #EXTRA_INCOMING_NUMBER} can ignore the
+     * broadcasts where {@link #EXTRA_INCOMING_NUMBER} is not present in the extras (e.g. where
+     * {@link Intent#hasExtra(String)} returns {@code false}).
      * <p class="note">
      * This was a {@link android.content.Context#sendStickyBroadcast sticky}
      * broadcast in version 1.0, but it is no longer sticky.
@@ -493,10 +500,19 @@ public class TelephonyManager {
     public static final String EXTRA_STATE_OFFHOOK = PhoneConstants.State.OFFHOOK.toString();
 
     /**
-     * The lookup key used with the {@link #ACTION_PHONE_STATE_CHANGED} broadcast
-     * for a String containing the incoming phone number.
-     * Only valid when the new call state is RINGING.
-     *
+     * Extra key used with the {@link #ACTION_PHONE_STATE_CHANGED} broadcast
+     * for a String containing the incoming or outgoing phone number.
+     * <p>
+     * This extra is only populated for receivers of the {@link #ACTION_PHONE_STATE_CHANGED}
+     * broadcast which have been granted the {@link android.Manifest.permission#READ_CALL_LOG} and
+     * {@link android.Manifest.permission#READ_PHONE_STATE} permissions.
+     * <p>
+     * For incoming calls, the phone number is only guaranteed to be populated when the
+     * {@link #EXTRA_STATE} changes from {@link #EXTRA_STATE_IDLE} to {@link #EXTRA_STATE_RINGING}.
+     * If the incoming caller is from an unknown number, the extra will be populated with an empty
+     * string.
+     * For outgoing calls, the phone number is only guaranteed to be populated when the
+     * {@link #EXTRA_STATE} changes from {@link #EXTRA_STATE_IDLE} to {@link #EXTRA_STATE_OFFHOOK}.
      * <p class="note">
      * Retrieve with
      * {@link android.content.Intent#getStringExtra(String)}.
@@ -5440,23 +5456,6 @@ public class TelephonyManager {
         return null;
     }
 
-    /**
-     * @return true if the IMS resolver is busy resolving a binding and should not be considered
-     * available, false if the IMS resolver is idle.
-     * @hide
-     */
-    public boolean isResolvingImsBinding() {
-        try {
-            ITelephony telephony = getITelephony();
-            if (telephony != null) {
-                return telephony.isResolvingImsBinding();
-            }
-        } catch (RemoteException e) {
-            Rlog.e(TAG, "isResolvingImsBinding, RemoteException: " + e.getMessage());
-        }
-        return false;
-    }
-
     /**
      * Set IMS registration state
      *
diff --git a/telephony/java/com/android/internal/telephony/CarrierAppUtils.java b/telephony/java/com/android/internal/telephony/CarrierAppUtils.java
index bcad554b579..a1bea4d417f 100644
--- a/telephony/java/com/android/internal/telephony/CarrierAppUtils.java
+++ b/telephony/java/com/android/internal/telephony/CarrierAppUtils.java
@@ -21,7 +21,6 @@ import android.content.ContentResolver;
 import android.content.pm.ApplicationInfo;
 import android.content.pm.IPackageManager;
 import android.content.pm.PackageManager;
-import android.content.res.Resources;
 import android.os.RemoteException;
 import android.provider.Settings;
 import android.telephony.TelephonyManager;
@@ -145,6 +144,18 @@ public final class CarrierAppUtils {
                         telephonyManager.checkCarrierPrivilegesForPackageAnyPhone(packageName) ==
                                 TelephonyManager.CARRIER_PRIVILEGE_STATUS_HAS_ACCESS;
 
+                // add hiddenUntilInstalled flag for carrier apps and associated apps
+                packageManager.setSystemAppHiddenUntilInstalled(packageName, true);
+                List<ApplicationInfo> associatedAppList = associatedApps.get(packageName);
+                if (associatedAppList != null) {
+                    for (ApplicationInfo associatedApp : associatedAppList) {
+                        packageManager.setSystemAppHiddenUntilInstalled(
+                                associatedApp.packageName,
+                                true
+                        );
+                    }
+                }
+
                 if (hasPrivileges) {
                     // Only update enabled state for the app on /system. Once it has been
                     // updated we shouldn't touch it.
@@ -152,9 +163,14 @@ public final class CarrierAppUtils {
                             && (ai.enabledSetting ==
                             PackageManager.COMPONENT_ENABLED_STATE_DEFAULT
                             || ai.enabledSetting ==
-                            PackageManager.COMPONENT_ENABLED_STATE_DISABLED_UNTIL_USED)) {
+                            PackageManager.COMPONENT_ENABLED_STATE_DISABLED_UNTIL_USED
+                            || (ai.flags & ApplicationInfo.FLAG_INSTALLED) == 0)) {
                         Slog.i(TAG, "Update state(" + packageName + "): ENABLED for user "
                                 + userId);
+                        packageManager.setSystemAppInstallState(
+                                packageName,
+                                true /*installed*/,
+                                userId);
                         packageManager.setApplicationEnabledSetting(
                                 packageName,
                                 PackageManager.COMPONENT_ENABLED_STATE_ENABLED,
@@ -164,15 +180,20 @@ public final class CarrierAppUtils {
                     }
 
                     // Also enable any associated apps for this carrier app.
-                    List<ApplicationInfo> associatedAppList = associatedApps.get(packageName);
                     if (associatedAppList != null) {
                         for (ApplicationInfo associatedApp : associatedAppList) {
                             if (associatedApp.enabledSetting ==
                                     PackageManager.COMPONENT_ENABLED_STATE_DEFAULT
                                     || associatedApp.enabledSetting ==
-                                    PackageManager.COMPONENT_ENABLED_STATE_DISABLED_UNTIL_USED) {
+                                    PackageManager.COMPONENT_ENABLED_STATE_DISABLED_UNTIL_USED
+                                    || (associatedApp.flags
+                                    & ApplicationInfo.FLAG_INSTALLED) == 0) {
                                 Slog.i(TAG, "Update associated state(" + associatedApp.packageName
                                         + "): ENABLED for user " + userId);
+                                packageManager.setSystemAppInstallState(
+                                        associatedApp.packageName,
+                                        true /*installed*/,
+                                        userId);
                                 packageManager.setApplicationEnabledSetting(
                                         associatedApp.packageName,
                                         PackageManager.COMPONENT_ENABLED_STATE_ENABLED,
@@ -190,36 +211,33 @@ public final class CarrierAppUtils {
                     // updated we shouldn't touch it.
                     if (!ai.isUpdatedSystemApp()
                             && ai.enabledSetting ==
-                            PackageManager.COMPONENT_ENABLED_STATE_DEFAULT) {
+                            PackageManager.COMPONENT_ENABLED_STATE_DEFAULT
+                            && (ai.flags & ApplicationInfo.FLAG_INSTALLED) != 0) {
                         Slog.i(TAG, "Update state(" + packageName
                                 + "): DISABLED_UNTIL_USED for user " + userId);
-                        packageManager.setApplicationEnabledSetting(
+                        packageManager.setSystemAppInstallState(
                                 packageName,
-                                PackageManager.COMPONENT_ENABLED_STATE_DISABLED_UNTIL_USED,
-                                0,
-                                userId,
-                                callingPackage);
+                                false /*installed*/,
+                                userId);
                     }
 
                     // Also disable any associated apps for this carrier app if this is the first
                     // run. We avoid doing this a second time because it is brittle to rely on the
                     // distinction between "default" and "enabled".
                     if (!hasRunOnce) {
-                        List<ApplicationInfo> associatedAppList = associatedApps.get(packageName);
                         if (associatedAppList != null) {
                             for (ApplicationInfo associatedApp : associatedAppList) {
                                 if (associatedApp.enabledSetting
-                                        == PackageManager.COMPONENT_ENABLED_STATE_DEFAULT) {
+                                        == PackageManager.COMPONENT_ENABLED_STATE_DEFAULT
+                                        && (associatedApp.flags
+                                        & ApplicationInfo.FLAG_INSTALLED) != 0) {
                                     Slog.i(TAG,
                                             "Update associated state(" + associatedApp.packageName
                                                     + "): DISABLED_UNTIL_USED for user " + userId);
-                                    packageManager.setApplicationEnabledSetting(
+                                    packageManager.setSystemAppInstallState(
                                             associatedApp.packageName,
-                                            PackageManager
-                                                    .COMPONENT_ENABLED_STATE_DISABLED_UNTIL_USED,
-                                            0,
-                                            userId,
-                                            callingPackage);
+                                            false /*installed*/,
+                                            userId);
                                 }
                             }
                         }
@@ -357,7 +375,8 @@ public final class CarrierAppUtils {
             String packageName) {
         try {
             ApplicationInfo ai = packageManager.getApplicationInfo(packageName,
-                    PackageManager.MATCH_DISABLED_UNTIL_USED_COMPONENTS, userId);
+                    PackageManager.MATCH_DISABLED_UNTIL_USED_COMPONENTS
+                    | PackageManager.MATCH_HIDDEN_UNTIL_INSTALLED_COMPONENTS, userId);
             if (ai != null && ai.isSystemApp()) {
                 return ai;
             }
diff --git a/telephony/java/com/android/internal/telephony/ITelephony.aidl b/telephony/java/com/android/internal/telephony/ITelephony.aidl
index 639dd74e974..60422d18440 100644
--- a/telephony/java/com/android/internal/telephony/ITelephony.aidl
+++ b/telephony/java/com/android/internal/telephony/ITelephony.aidl
@@ -822,12 +822,6 @@ interface ITelephony {
     */
     IImsConfig getImsConfig(int slotId, int feature);
 
-    /**
-     * @return true if the IMS resolver is busy resolving a binding and should not be considered
-     * available, false if the IMS resolver is idle.
-     */
-    boolean isResolvingImsBinding();
-
     /**
     *  @return true if the ImsService to bind to for the slot id specified was set, false otherwise.
     */
diff --git a/tests/net/java/com/android/server/connectivity/TetheringTest.java b/tests/net/java/com/android/server/connectivity/TetheringTest.java
index f0f3f2c748a..4d6ea42bd77 100644
--- a/tests/net/java/com/android/server/connectivity/TetheringTest.java
+++ b/tests/net/java/com/android/server/connectivity/TetheringTest.java
@@ -71,6 +71,7 @@ import android.net.MacAddress;
 import android.net.Network;
 import android.net.NetworkCapabilities;
 import android.net.NetworkInfo;
+import android.net.NetworkRequest;
 import android.net.NetworkState;
 import android.net.NetworkUtils;
 import android.net.RouteInfo;
@@ -128,6 +129,10 @@ public class TetheringTest {
     private static final String TEST_USB_IFNAME = "test_rndis0";
     private static final String TEST_WLAN_IFNAME = "test_wlan0";
 
+    // Actual contents of the request don't matter for this test. The lack of
+    // any specific TRANSPORT_* is sufficient to identify this request.
+    private static final NetworkRequest mDefaultRequest = new NetworkRequest.Builder().build();
+
     @Mock private ApplicationInfo mApplicationInfo;
     @Mock private Context mContext;
     @Mock private INetworkManagementService mNMService;
@@ -238,6 +243,11 @@ public class TetheringTest {
             isTetheringSupportedCalls++;
             return true;
         }
+
+        @Override
+        public NetworkRequest getDefaultNetworkRequest() {
+            return mDefaultRequest;
+        }
     }
 
     private static NetworkState buildMobileUpstreamState(boolean withIPv4, boolean withIPv6,
@@ -305,6 +315,8 @@ public class TetheringTest {
                 .thenReturn(new String[0]);
         when(mResources.getIntArray(com.android.internal.R.array.config_tether_upstream_types))
                 .thenReturn(new int[0]);
+        when(mResources.getBoolean(com.android.internal.R.bool.config_tether_upstream_automatic))
+                .thenReturn(false);
         when(mNMService.listInterfaces())
                 .thenReturn(new String[] {
                         TEST_MOBILE_IFNAME, TEST_WLAN_IFNAME, TEST_USB_IFNAME});
@@ -458,6 +470,7 @@ public class TetheringTest {
     }
 
     private void prepareUsbTethering(NetworkState upstreamState) {
+        when(mUpstreamNetworkMonitor.getCurrentPreferredUpstream()).thenReturn(upstreamState);
         when(mUpstreamNetworkMonitor.selectPreferredUpstreamType(any()))
                 .thenReturn(upstreamState);
 
@@ -519,7 +532,7 @@ public class TetheringTest {
                 TEST_WLAN_IFNAME, WifiManager.IFACE_IP_MODE_LOCAL_ONLY);
         verifyNoMoreInteractions(mWifiManager);
         verifyTetheringBroadcast(TEST_WLAN_IFNAME, EXTRA_ACTIVE_LOCAL_ONLY);
-        verify(mUpstreamNetworkMonitor, times(1)).start();
+        verify(mUpstreamNetworkMonitor, times(1)).start(any(NetworkRequest.class));
         // TODO: Figure out why this isn't exactly once, for sendTetherStateChangedBroadcast().
         assertTrue(1 <= mTetheringDependencies.isTetheringSupportedCalls);
 
@@ -651,6 +664,24 @@ public class TetheringTest {
                 TEST_XLAT_MOBILE_IFNAME);
     }
 
+    @Test
+    public void configTetherUpstreamAutomaticIgnoresConfigTetherUpstreamTypes() throws Exception {
+        when(mResources.getBoolean(com.android.internal.R.bool.config_tether_upstream_automatic))
+                .thenReturn(true);
+        sendConfigurationChanged();
+
+        // Setup IPv6
+        final NetworkState upstreamState = buildMobileIPv6UpstreamState();
+        runUsbTethering(upstreamState);
+
+        // UpstreamNetworkMonitor should choose upstream automatically
+        // (in this specific case: choose the default network).
+        verify(mUpstreamNetworkMonitor, times(1)).getCurrentPreferredUpstream();
+        verify(mUpstreamNetworkMonitor, never()).selectPreferredUpstreamType(any());
+
+        verify(mUpstreamNetworkMonitor, times(1)).setCurrentUpstream(upstreamState.network);
+    }
+
     @Test
     public void workingLocalOnlyHotspotEnrichedApBroadcastWithIfaceChanged() throws Exception {
         workingLocalOnlyHotspotEnrichedApBroadcast(true);
@@ -714,7 +745,7 @@ public class TetheringTest {
                 TEST_WLAN_IFNAME, WifiManager.IFACE_IP_MODE_TETHERED);
         verifyNoMoreInteractions(mWifiManager);
         verifyTetheringBroadcast(TEST_WLAN_IFNAME, EXTRA_ACTIVE_TETHER);
-        verify(mUpstreamNetworkMonitor, times(1)).start();
+        verify(mUpstreamNetworkMonitor, times(1)).start(any(NetworkRequest.class));
         // In tethering mode, in the default configuration, an explicit request
         // for a mobile network is also made.
         verify(mUpstreamNetworkMonitor, times(1)).registerMobileNetworkRequest();
diff --git a/tests/net/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitorTest.java b/tests/net/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitorTest.java
index 9661dc24ca2..3e21a2cfb7f 100644
--- a/tests/net/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitorTest.java
+++ b/tests/net/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitorTest.java
@@ -31,6 +31,7 @@ import static org.junit.Assert.fail;
 import static org.mockito.Mockito.any;
 import static org.mockito.Mockito.anyInt;
 import static org.mockito.Mockito.anyString;
+import static org.mockito.Mockito.eq;
 import static org.mockito.Mockito.reset;
 import static org.mockito.Mockito.spy;
 import static org.mockito.Mockito.times;
@@ -73,6 +74,7 @@ import java.util.Collections;
 import java.util.HashMap;
 import java.util.HashSet;
 import java.util.Map;
+import java.util.Objects;
 import java.util.Set;
 
 
@@ -84,6 +86,10 @@ public class UpstreamNetworkMonitorTest {
     private static final boolean INCLUDES = true;
     private static final boolean EXCLUDES = false;
 
+    // Actual contents of the request don't matter for this test. The lack of
+    // any specific TRANSPORT_* is sufficient to identify this request.
+    private static final NetworkRequest mDefaultRequest = new NetworkRequest.Builder().build();
+
     @Mock private Context mContext;
     @Mock private IConnectivityManager mCS;
     @Mock private SharedLog mLog;
@@ -112,6 +118,13 @@ public class UpstreamNetworkMonitorTest {
         }
     }
 
+    @Test
+    public void testStopWithoutStartIsNonFatal() {
+        mUNM.stop();
+        mUNM.stop();
+        mUNM.stop();
+    }
+
     @Test
     public void testDoesNothingBeforeStarted() {
         assertTrue(mCM.hasNoCallbacks());
@@ -127,7 +140,7 @@ public class UpstreamNetworkMonitorTest {
     public void testDefaultNetworkIsTracked() throws Exception {
         assertEquals(0, mCM.trackingDefault.size());
 
-        mUNM.start();
+        mUNM.start(mDefaultRequest);
         assertEquals(1, mCM.trackingDefault.size());
 
         mUNM.stop();
@@ -138,7 +151,7 @@ public class UpstreamNetworkMonitorTest {
     public void testListensForAllNetworks() throws Exception {
         assertTrue(mCM.listening.isEmpty());
 
-        mUNM.start();
+        mUNM.start(mDefaultRequest);
         assertFalse(mCM.listening.isEmpty());
         assertTrue(mCM.isListeningForAll());
 
@@ -148,9 +161,11 @@ public class UpstreamNetworkMonitorTest {
 
     @Test
     public void testCallbacksRegistered() {
-        mUNM.start();
-        verify(mCM, times(1)).registerNetworkCallback(any(), any(), any());
-        verify(mCM, times(1)).registerDefaultNetworkCallback(any(), any());
+        mUNM.start(mDefaultRequest);
+        verify(mCM, times(1)).registerNetworkCallback(
+                any(NetworkRequest.class), any(NetworkCallback.class), any(Handler.class));
+        verify(mCM, times(1)).requestNetwork(
+                eq(mDefaultRequest), any(NetworkCallback.class), any(Handler.class));
 
         mUNM.stop();
         verify(mCM, times(2)).unregisterNetworkCallback(any(NetworkCallback.class));
@@ -161,7 +176,7 @@ public class UpstreamNetworkMonitorTest {
         assertFalse(mUNM.mobileNetworkRequested());
         assertEquals(0, mCM.requested.size());
 
-        mUNM.start();
+        mUNM.start(mDefaultRequest);
         assertFalse(mUNM.mobileNetworkRequested());
         assertEquals(0, mCM.requested.size());
 
@@ -184,17 +199,17 @@ public class UpstreamNetworkMonitorTest {
         assertFalse(mUNM.mobileNetworkRequested());
         assertEquals(0, mCM.requested.size());
 
-        mUNM.start();
-        verify(mCM, Mockito.times(1)).registerNetworkCallback(
+        mUNM.start(mDefaultRequest);
+        verify(mCM, times(1)).registerNetworkCallback(
                 any(NetworkRequest.class), any(NetworkCallback.class), any(Handler.class));
-        verify(mCM, Mockito.times(1)).registerDefaultNetworkCallback(
-                any(NetworkCallback.class), any(Handler.class));
+        verify(mCM, times(1)).requestNetwork(
+                eq(mDefaultRequest), any(NetworkCallback.class), any(Handler.class));
         assertFalse(mUNM.mobileNetworkRequested());
         assertEquals(0, mCM.requested.size());
 
         mUNM.updateMobileRequiresDun(true);
         mUNM.registerMobileNetworkRequest();
-        verify(mCM, Mockito.times(1)).requestNetwork(
+        verify(mCM, times(1)).requestNetwork(
                 any(NetworkRequest.class), any(NetworkCallback.class), anyInt(), anyInt(),
                 any(Handler.class));
 
@@ -222,7 +237,7 @@ public class UpstreamNetworkMonitorTest {
         assertFalse(mUNM.mobileNetworkRequested());
         assertEquals(0, mCM.requested.size());
 
-        mUNM.start();
+        mUNM.start(mDefaultRequest);
         assertFalse(mUNM.mobileNetworkRequested());
         assertEquals(0, mCM.requested.size());
 
@@ -242,7 +257,7 @@ public class UpstreamNetworkMonitorTest {
 
     @Test
     public void testUpdateMobileRequiresDun() throws Exception {
-        mUNM.start();
+        mUNM.start(mDefaultRequest);
 
         // Test going from no-DUN to DUN correctly re-registers callbacks.
         mUNM.updateMobileRequiresDun(false);
@@ -270,7 +285,7 @@ public class UpstreamNetworkMonitorTest {
         final Collection<Integer> preferredTypes = new ArrayList<>();
         preferredTypes.add(TYPE_WIFI);
 
-        mUNM.start();
+        mUNM.start(mDefaultRequest);
         // There are no networks, so there is nothing to select.
         assertSatisfiesLegacyType(TYPE_NONE, mUNM.selectPreferredUpstreamType(preferredTypes));
 
@@ -333,9 +348,48 @@ public class UpstreamNetworkMonitorTest {
         assertTrue(netReq.networkCapabilities.hasCapability(NET_CAPABILITY_DUN));
     }
 
+    @Test
+    public void testGetCurrentPreferredUpstream() throws Exception {
+        mUNM.start(mDefaultRequest);
+        mUNM.updateMobileRequiresDun(false);
+
+        // [0] Mobile connects, DUN not required -> mobile selected.
+        final TestNetworkAgent cellAgent = new TestNetworkAgent(mCM, TRANSPORT_CELLULAR);
+        cellAgent.fakeConnect();
+        mCM.makeDefaultNetwork(cellAgent);
+        assertEquals(cellAgent.networkId, mUNM.getCurrentPreferredUpstream().network);
+
+        // [1] WiFi connects but not validated/promoted to default -> mobile selected.
+        final TestNetworkAgent wifiAgent = new TestNetworkAgent(mCM, TRANSPORT_WIFI);
+        wifiAgent.fakeConnect();
+        assertEquals(cellAgent.networkId, mUNM.getCurrentPreferredUpstream().network);
+
+        // [2] WiFi validates and is promoted to the default network -> WiFi selected.
+        mCM.makeDefaultNetwork(wifiAgent);
+        assertEquals(wifiAgent.networkId, mUNM.getCurrentPreferredUpstream().network);
+
+        // [3] DUN required, no other changes -> WiFi still selected
+        mUNM.updateMobileRequiresDun(true);
+        assertEquals(wifiAgent.networkId, mUNM.getCurrentPreferredUpstream().network);
+
+        // [4] WiFi no longer validated, mobile becomes default, DUN required -> null selected.
+        mCM.makeDefaultNetwork(cellAgent);
+        assertEquals(null, mUNM.getCurrentPreferredUpstream());
+        // TODO: make sure that a DUN request has been filed. This is currently
+        // triggered by code over in Tethering, but once that has been moved
+        // into UNM we should test for this here.
+
+        // [5] DUN network arrives -> DUN selected
+        final TestNetworkAgent dunAgent = new TestNetworkAgent(mCM, TRANSPORT_CELLULAR);
+        dunAgent.networkCapabilities.addCapability(NET_CAPABILITY_DUN);
+        dunAgent.networkCapabilities.removeCapability(NET_CAPABILITY_INTERNET);
+        dunAgent.fakeConnect();
+        assertEquals(dunAgent.networkId, mUNM.getCurrentPreferredUpstream().network);
+    }
+
     @Test
     public void testLocalPrefixes() throws Exception {
-        mUNM.start();
+        mUNM.start(mDefaultRequest);
 
         // [0] Test minimum set of local prefixes.
         Set<IpPrefix> local = mUNM.getLocalPrefixes();
@@ -345,7 +399,7 @@ public class UpstreamNetworkMonitorTest {
 
         // [1] Pretend Wi-Fi connects.
         final TestNetworkAgent wifiAgent = new TestNetworkAgent(mCM, TRANSPORT_WIFI);
-        final LinkProperties wifiLp = new LinkProperties();
+        final LinkProperties wifiLp = wifiAgent.linkProperties;
         wifiLp.setInterfaceName("wlan0");
         final String[] WIFI_ADDRS = {
                 "fe80::827a:bfff:fe6f:374d", "100.112.103.18",
@@ -358,7 +412,7 @@ public class UpstreamNetworkMonitorTest {
             wifiLp.addLinkAddress(new LinkAddress(addrStr + cidr));
         }
         wifiAgent.fakeConnect();
-        wifiAgent.sendLinkProperties(wifiLp);
+        wifiAgent.sendLinkProperties();
 
         local = mUNM.getLocalPrefixes();
         assertPrefixSet(local, INCLUDES, alreadySeen);
@@ -372,7 +426,7 @@ public class UpstreamNetworkMonitorTest {
 
         // [2] Pretend mobile connects.
         final TestNetworkAgent cellAgent = new TestNetworkAgent(mCM, TRANSPORT_CELLULAR);
-        final LinkProperties cellLp = new LinkProperties();
+        final LinkProperties cellLp = cellAgent.linkProperties;
         cellLp.setInterfaceName("rmnet_data0");
         final String[] CELL_ADDRS = {
                 "10.102.211.48", "2001:db8:0:1:b50e:70d9:10c9:433d",
@@ -382,7 +436,7 @@ public class UpstreamNetworkMonitorTest {
             cellLp.addLinkAddress(new LinkAddress(addrStr + cidr));
         }
         cellAgent.fakeConnect();
-        cellAgent.sendLinkProperties(cellLp);
+        cellAgent.sendLinkProperties();
 
         local = mUNM.getLocalPrefixes();
         assertPrefixSet(local, INCLUDES, alreadySeen);
@@ -394,17 +448,18 @@ public class UpstreamNetworkMonitorTest {
         // [3] Pretend DUN connects.
         final TestNetworkAgent dunAgent = new TestNetworkAgent(mCM, TRANSPORT_CELLULAR);
         dunAgent.networkCapabilities.addCapability(NET_CAPABILITY_DUN);
-        final LinkProperties dunLp = new LinkProperties();
+        dunAgent.networkCapabilities.removeCapability(NET_CAPABILITY_INTERNET);
+        final LinkProperties dunLp = dunAgent.linkProperties;
         dunLp.setInterfaceName("rmnet_data1");
         final String[] DUN_ADDRS = {
                 "192.0.2.48", "2001:db8:1:2:b50e:70d9:10c9:433d",
         };
         for (String addrStr : DUN_ADDRS) {
             final String cidr = addrStr.contains(":") ? "/64" : "/27";
-            cellLp.addLinkAddress(new LinkAddress(addrStr + cidr));
+            dunLp.addLinkAddress(new LinkAddress(addrStr + cidr));
         }
         dunAgent.fakeConnect();
-        dunAgent.sendLinkProperties(dunLp);
+        dunAgent.sendLinkProperties();
 
         local = mUNM.getLocalPrefixes();
         assertPrefixSet(local, INCLUDES, alreadySeen);
@@ -442,6 +497,7 @@ public class UpstreamNetworkMonitorTest {
     public static class TestConnectivityManager extends ConnectivityManager {
         public Map<NetworkCallback, Handler> allCallbacks = new HashMap<>();
         public Set<NetworkCallback> trackingDefault = new HashSet<>();
+        public TestNetworkAgent defaultNetwork = null;
         public Map<NetworkCallback, NetworkRequest> listening = new HashMap<>();
         public Map<NetworkCallback, NetworkRequest> requested = new HashMap<>();
         public Map<NetworkCallback, Integer> legacyTypeMap = new HashMap<>();
@@ -483,12 +539,34 @@ public class UpstreamNetworkMonitorTest {
 
         int getNetworkId() { return ++mNetworkId; }
 
+        void makeDefaultNetwork(TestNetworkAgent agent) {
+            if (Objects.equals(defaultNetwork, agent)) return;
+
+            final TestNetworkAgent formerDefault = defaultNetwork;
+            defaultNetwork = agent;
+
+            for (NetworkCallback cb : trackingDefault) {
+                if (defaultNetwork != null) {
+                    cb.onAvailable(defaultNetwork.networkId);
+                    cb.onCapabilitiesChanged(
+                            defaultNetwork.networkId, defaultNetwork.networkCapabilities);
+                    cb.onLinkPropertiesChanged(
+                            defaultNetwork.networkId, defaultNetwork.linkProperties);
+                }
+            }
+        }
+
         @Override
         public void requestNetwork(NetworkRequest req, NetworkCallback cb, Handler h) {
             assertFalse(allCallbacks.containsKey(cb));
             allCallbacks.put(cb, h);
-            assertFalse(requested.containsKey(cb));
-            requested.put(cb, req);
+            if (mDefaultRequest.equals(req)) {
+                assertFalse(trackingDefault.contains(cb));
+                trackingDefault.add(cb);
+            } else {
+                assertFalse(requested.containsKey(cb));
+                requested.put(cb, req);
+            }
         }
 
         @Override
@@ -524,10 +602,7 @@ public class UpstreamNetworkMonitorTest {
 
         @Override
         public void registerDefaultNetworkCallback(NetworkCallback cb, Handler h) {
-            assertFalse(allCallbacks.containsKey(cb));
-            allCallbacks.put(cb, h);
-            assertFalse(trackingDefault.contains(cb));
-            trackingDefault.add(cb);
+            fail("Should never be called.");
         }
 
         @Override
@@ -561,6 +636,7 @@ public class UpstreamNetworkMonitorTest {
         public final Network networkId;
         public final int transportType;
         public final NetworkCapabilities networkCapabilities;
+        public final LinkProperties linkProperties;
 
         public TestNetworkAgent(TestConnectivityManager cm, int transportType) {
             this.cm = cm;
@@ -569,12 +645,14 @@ public class UpstreamNetworkMonitorTest {
             networkCapabilities = new NetworkCapabilities();
             networkCapabilities.addTransportType(transportType);
             networkCapabilities.addCapability(NET_CAPABILITY_INTERNET);
+            linkProperties = new LinkProperties();
         }
 
         public void fakeConnect() {
             for (NetworkCallback cb : cm.listening.keySet()) {
                 cb.onAvailable(networkId);
                 cb.onCapabilitiesChanged(networkId, copy(networkCapabilities));
+                cb.onLinkPropertiesChanged(networkId, copy(linkProperties));
             }
         }
 
@@ -584,11 +662,16 @@ public class UpstreamNetworkMonitorTest {
             }
         }
 
-        public void sendLinkProperties(LinkProperties lp) {
+        public void sendLinkProperties() {
             for (NetworkCallback cb : cm.listening.keySet()) {
-                cb.onLinkPropertiesChanged(networkId, lp);
+                cb.onLinkPropertiesChanged(networkId, copy(linkProperties));
             }
         }
+
+        @Override
+        public String toString() {
+            return String.format("TestNetworkAgent: %s %s", networkId, networkCapabilities);
+        }
     }
 
     public static class TestStateMachine extends StateMachine {
@@ -618,6 +701,10 @@ public class UpstreamNetworkMonitorTest {
         return new NetworkCapabilities(nc);
     }
 
+    static LinkProperties copy(LinkProperties lp) {
+        return new LinkProperties(lp);
+    }
+
     static void assertPrefixSet(Set<IpPrefix> prefixes, boolean expectation, String... expected) {
         final Set<String> expectedSet = new HashSet<>();
         Collections.addAll(expectedSet, expected);
diff --git a/tests/testables/src/android/testing/TestableContentResolver.java b/tests/testables/src/android/testing/TestableContentResolver.java
index 0850916ccbe..a0afef8fcda 100644
--- a/tests/testables/src/android/testing/TestableContentResolver.java
+++ b/tests/testables/src/android/testing/TestableContentResolver.java
@@ -20,6 +20,7 @@ import android.content.Context;
 import android.content.IContentProvider;
 import android.database.ContentObserver;
 import android.net.Uri;
+import android.util.ArrayMap;
 import android.util.ArraySet;
 
 import com.google.android.collect.Maps;
@@ -35,7 +36,11 @@ import java.util.Map;
  */
 public class TestableContentResolver extends ContentResolver {
 
-    private final Map<String, ContentProvider> mProviders = Maps.newHashMap();
+    public static final int STABLE = 1;
+    public static final int UNSTABLE = 2;
+
+    private final Map<String, ContentProvider> mProviders = new ArrayMap<>();
+    private final Map<String, ContentProvider> mUnstableProviders = new ArrayMap<>();
     private final ContentResolver mParent;
     private final ArraySet<ContentProvider> mInUse = new ArraySet<>();
     private boolean mFallbackToExisting;
@@ -62,7 +67,23 @@ public class TestableContentResolver extends ContentResolver {
      * subclasses, or null.
      */
     public void addProvider(String name, ContentProvider provider) {
-        mProviders.put(name, provider);
+        addProvider(name, provider, STABLE | UNSTABLE);
+    }
+
+    /**
+     * Adds access to a provider based on its authority
+     *
+     * @param name The authority name associated with the provider.
+     * @param provider An instance of {@link android.content.ContentProvider} or one of its
+     * subclasses, or null.
+     */
+    public void addProvider(String name, ContentProvider provider, int flags) {
+        if ((flags & STABLE) != 0) {
+            mProviders.put(name, provider);
+        }
+        if ((flags & UNSTABLE) != 0) {
+            mUnstableProviders.put(name, provider);
+        }
     }
 
     @Override
@@ -98,7 +119,7 @@ public class TestableContentResolver extends ContentResolver {
 
     @Override
     protected IContentProvider acquireUnstableProvider(Context c, String name) {
-        final ContentProvider provider = mProviders.get(name);
+        final ContentProvider provider = mUnstableProviders.get(name);
         if (provider != null) {
             return provider.getIContentProvider();
         } else {
@@ -128,7 +149,8 @@ public class TestableContentResolver extends ContentResolver {
     @Override
     public void notifyChange(Uri uri, ContentObserver observer, boolean syncToNetwork) {
         if (!mFallbackToExisting) return;
-        if (!mProviders.containsKey(uri.getAuthority())) {
+        if (!mProviders.containsKey(uri.getAuthority())
+                && !mUnstableProviders.containsKey(uri.getAuthority())) {
             super.notifyChange(uri, observer, syncToNetwork);
         }
     }
diff --git a/tests/testables/tests/src/android/testing/TestableContentResolverTest.java b/tests/testables/tests/src/android/testing/TestableContentResolverTest.java
new file mode 100644
index 00000000000..71afda0748c
--- /dev/null
+++ b/tests/testables/tests/src/android/testing/TestableContentResolverTest.java
@@ -0,0 +1,61 @@
+package android.testing;
+
+import android.content.ContentProvider;
+import android.content.IContentProvider;
+import android.support.test.InstrumentationRegistry;
+import android.support.test.filters.SmallTest;
+
+import org.junit.Assert;
+import org.junit.Before;
+import org.junit.Rule;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mockito;
+
+@SmallTest
+@RunWith(AndroidTestingRunner.class)
+public class TestableContentResolverTest {
+
+    @Rule
+    public TestableContext mContext = new TestableContext(InstrumentationRegistry.getContext());
+    private TestableContentResolver mContentResolver;
+
+    @Before
+    public void setup() {
+        mContentResolver = new TestableContentResolver(mContext);
+        mContentResolver.setFallbackToExisting(false);
+    }
+
+    @Test
+    public void testDefaultContentProvider() {
+        ContentProvider provider = Mockito.mock(ContentProvider.class);
+        IContentProvider iprovider = Mockito.mock(IContentProvider.class);
+        Mockito.when(provider.getIContentProvider()).thenReturn(iprovider);
+        mContentResolver.addProvider("test", provider);
+
+        Assert.assertEquals(iprovider, mContentResolver.acquireProvider(mContext, "test"));
+        Assert.assertEquals(iprovider, mContentResolver.acquireUnstableProvider(mContext, "test"));
+    }
+
+    @Test
+    public void testStableContentProvider() {
+        ContentProvider provider = Mockito.mock(ContentProvider.class);
+        IContentProvider iprovider = Mockito.mock(IContentProvider.class);
+        Mockito.when(provider.getIContentProvider()).thenReturn(iprovider);
+        mContentResolver.addProvider("test", provider, TestableContentResolver.STABLE);
+
+        Assert.assertEquals(iprovider, mContentResolver.acquireProvider(mContext, "test"));
+        Assert.assertNull(mContentResolver.acquireUnstableProvider(mContext, "test"));
+    }
+
+    @Test
+    public void testUnstableContentProvider() {
+        ContentProvider provider = Mockito.mock(ContentProvider.class);
+        IContentProvider iprovider = Mockito.mock(IContentProvider.class);
+        Mockito.when(provider.getIContentProvider()).thenReturn(iprovider);
+        mContentResolver.addProvider("test", provider, TestableContentResolver.UNSTABLE);
+
+        Assert.assertEquals(iprovider, mContentResolver.acquireUnstableProvider(mContext, "test"));
+        Assert.assertNull(mContentResolver.acquireProvider(mContext, "test"));
+    }
+}
diff --git a/tools/fonts/fontchain_linter.py b/tools/fonts/fontchain_linter.py
index a8411aa5c48..ce9becd40b1 100755
--- a/tools/fonts/fontchain_linter.py
+++ b/tools/fonts/fontchain_linter.py
@@ -524,9 +524,12 @@ LEGACY_ANDROID_EMOJI = {
     0xFE837: (ord('0'), COMBINING_KEYCAP),
 }
 
+# This is used to define the emoji that should have the same glyph.
+# i.e. previously we had gender based Kiss (0x1F48F), which had the same glyph
+# with Kiss: Woman, Man (0x1F469, 0x200D, 0x2764, 0x200D, 0x1F48B, 0x200D, 0x1F468)
+# in that case a valid row would be:
+# (0x1F469, 0x200D, 0x2764, 0x200D, 0x1F48B, 0x200D, 0x1F468): 0x1F48F,
 ZWJ_IDENTICALS = {
-    # KISS
-    (0x1F469, 0x200D, 0x2764, 0x200D, 0x1F48B, 0x200D, 0x1F468): 0x1F48F,
 }
 
 SAME_FLAG_MAPPINGS = [
diff --git a/wifi/java/android/net/wifi/IWifiManager.aidl b/wifi/java/android/net/wifi/IWifiManager.aidl
index 66ccc6cdfbf..af44b7e6cd1 100644
--- a/wifi/java/android/net/wifi/IWifiManager.aidl
+++ b/wifi/java/android/net/wifi/IWifiManager.aidl
@@ -147,6 +147,8 @@ interface IWifiManager
 
     boolean setWifiApConfiguration(in WifiConfiguration wifiConfig, String packageName);
 
+    void notifyUserOfApBandConversion(String packageName);
+
     Messenger getWifiServiceMessenger(String packageName);
 
     void enableTdls(String remoteIPAddress, boolean enable);
diff --git a/wifi/java/android/net/wifi/WifiEnterpriseConfig.java b/wifi/java/android/net/wifi/WifiEnterpriseConfig.java
index bb3af3cd168..52f7a604209 100644
--- a/wifi/java/android/net/wifi/WifiEnterpriseConfig.java
+++ b/wifi/java/android/net/wifi/WifiEnterpriseConfig.java
@@ -948,16 +948,15 @@ public class WifiEnterpriseConfig implements Parcelable {
      * for Hotspot 2.0 defined matching of AAA server certs per WFA HS2.0 spec, section 7.3.3.2,
      * second paragraph.
      *
-     * From wpa_supplicant documentation:
-     * Constraint for server domain name. If set, this FQDN is used as a suffix match requirement
+     * <p>From wpa_supplicant documentation:
+     * <p>Constraint for server domain name. If set, this FQDN is used as a suffix match requirement
      * for the AAAserver certificate in SubjectAltName dNSName element(s). If a matching dNSName is
-     * found, this constraint is met. If no dNSName values are present, this constraint is matched
-     * against SubjectName CN using same suffix match comparison.
-     * Suffix match here means that the host/domain name is compared one label at a time starting
+     * found, this constraint is met.
+     * <p>Suffix match here means that the host/domain name is compared one label at a time starting
      * from the top-level domain and all the labels in domain_suffix_match shall be included in the
      * certificate. The certificate may include additional sub-level labels in addition to the
      * required labels.
-     * For example, domain_suffix_match=example.com would match test.example.com but would not
+     * <p>For example, domain_suffix_match=example.com would match test.example.com but would not
      * match test-example.com.
      * @param domain The domain value
      */
diff --git a/wifi/java/android/net/wifi/WifiManager.java b/wifi/java/android/net/wifi/WifiManager.java
index 25f35d0523a..6963ed00b61 100644
--- a/wifi/java/android/net/wifi/WifiManager.java
+++ b/wifi/java/android/net/wifi/WifiManager.java
@@ -2169,6 +2169,21 @@ public class WifiManager {
         }
     }
 
+    /**
+     * Method that triggers a notification to the user about a conversion to their saved AP config.
+     *
+     * @hide
+     */
+    @RequiresPermission(android.Manifest.permission.NETWORK_SETTINGS)
+    public void notifyUserOfApBandConversion() {
+        Log.d(TAG, "apBand was converted, notify the user");
+        try {
+            mService.notifyUserOfApBandConversion(mContext.getOpPackageName());
+        } catch (RemoteException e) {
+            throw e.rethrowFromSystemServer();
+        }
+    }
+
     /**
      * Enable/Disable TDLS on a specific local route.
      *
-- 
2.17.1

