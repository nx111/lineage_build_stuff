From e2f265303a58ce8148ca69b8618d714c4cba0e5c Mon Sep 17 00:00:00 2001
From: Paul Keith <javelinanddart@gmail.com>
Date: Fri, 8 Feb 2019 08:42:33 -0600
Subject: [PATCH 32/45] Camera: Simplify code for Aux/Mono white and black
 lists

Change-Id: I20c5454385d4d830a9a4d61926807a7eb1407c95
---
 core/java/android/hardware/Camera.java        | 26 +++-------
 .../hardware/camera2/CameraManager.java       | 52 ++++++-------------
 2 files changed, 24 insertions(+), 54 deletions(-)

diff --git a/core/java/android/hardware/Camera.java b/core/java/android/hardware/Camera.java
index 11bf5485542..4190af61194 100644
--- a/core/java/android/hardware/Camera.java
+++ b/core/java/android/hardware/Camera.java
@@ -296,27 +296,17 @@ public class Camera {
         /* Force to expose only two cameras
          * if the package name does not falls in this bucket
          */
-        String packageList = SystemProperties.get("vendor.camera.aux.packagelist");
-        String packageBlacklist = SystemProperties.get("vendor.camera.aux.packageblacklist");
-        if (packageList.length() > 0) {
-            TextUtils.StringSplitter splitter = new TextUtils.SimpleStringSplitter(',');
-            splitter.setString(packageList);
+        String packageList = SystemProperties.get("vendor.camera.aux.packagelist", "");
+        String packageBlacklist = SystemProperties.get("vendor.camera.aux.packageblacklist", "");
+        if (!packageList.isEmpty()) {
             exposeAuxCamera = false;
-            for (String str : splitter) {
-                if (packageName.equals(str)) {
-                    exposeAuxCamera = true;
-                    break;
-                }
+            if (Arrays.asList(packageList.split(",")).contains(packageName)) {
+                exposeAuxCamera = true;
             }
-        } else if (packageBlacklist.length() > 0) {
-            TextUtils.StringSplitter splitter = new TextUtils.SimpleStringSplitter(',');
-            splitter.setString(packageBlacklist);
+        } else if (!packageBlacklist.isEmpty()) {
             exposeAuxCamera = true;
-            for (String str : splitter) {
-                if (packageName.equals(str)) {
-                    exposeAuxCamera = false;
-                    break;
-                }
+            if (Arrays.asList(packageBlacklist.split(",")).contains(packageName)) {
+                exposeAuxCamera = false;
             }
         }
         int numberOfCameras = _getNumberOfCameras();
diff --git a/core/java/android/hardware/camera2/CameraManager.java b/core/java/android/hardware/camera2/CameraManager.java
index caa26d0d28d..fa77860f273 100644
--- a/core/java/android/hardware/camera2/CameraManager.java
+++ b/core/java/android/hardware/camera2/CameraManager.java
@@ -915,27 +915,17 @@ public final class CameraManager {
 
                 boolean exposeAuxCamera = true;
                 String packageName = ActivityThread.currentOpPackageName();
-                String packageList = SystemProperties.get("vendor.camera.aux.packagelist");
-                String packageBlacklist = SystemProperties.get("vendor.camera.aux.packageblacklist");
-                if (packageList.length() > 0) {
-                    TextUtils.StringSplitter splitter = new TextUtils.SimpleStringSplitter(',');
-                    splitter.setString(packageList);
+                String packageList = SystemProperties.get("vendor.camera.aux.packagelist", "");
+                String packageBlacklist = SystemProperties.get("vendor.camera.aux.packageblacklist", "");
+                if (!packageList.isEmpty()) {
                     exposeAuxCamera = false;
-                    for (String str : splitter) {
-                        if (packageName.equals(str)) {
-                            exposeAuxCamera = true;
-                            break;
-                        }
+                    if (Arrays.asList(packageList.split(",")).contains(packageName)) {
+                        exposeAuxCamera = true;
                     }
-                } else if (packageBlacklist.length() > 0) {
-                    TextUtils.StringSplitter splitter = new TextUtils.SimpleStringSplitter(',');
-                    splitter.setString(packageBlacklist);
+                } else if (!packageBlacklist.isEmpty()) {
                     exposeAuxCamera = true;
-                    for (String str : splitter) {
-                        if (packageName.equals(str)) {
-                            exposeAuxCamera = false;
-                            break;
-                        }
+                    if (Arrays.asList(packageBlacklist.split(",")).contains(packageName)) {
+                        exposeAuxCamera = false;
                     }
                 }
                 int idCount = 0;
@@ -1136,27 +1126,17 @@ public final class CameraManager {
              */
             boolean exposeMonoCamera = true;
             String packageName = ActivityThread.currentOpPackageName();
-            String packageList = SystemProperties.get("vendor.camera.aux.packagelist");
-            String packageBlacklist = SystemProperties.get("vendor.camera.aux.packageblacklist");
-            if (packageList.length() > 0) {
-                TextUtils.StringSplitter splitter = new TextUtils.SimpleStringSplitter(',');
-                splitter.setString(packageList);
+            String packageList = SystemProperties.get("vendor.camera.aux.packagelist", "");
+            String packageBlacklist = SystemProperties.get("vendor.camera.aux.packageblacklist", "");
+            if (!packageList.isEmpty()) {
                 exposeMonoCamera = false;
-                for (String str : splitter) {
-                    if (packageName.equals(str)) {
-                        exposeMonoCamera = true;
-                        break;
-                    }
+                if (Arrays.asList(packageList.split(",")).contains(packageName)) {
+                    exposeMonoCamera = true;
                 }
-            } else if (packageBlacklist.length() > 0) {
-                TextUtils.StringSplitter splitter = new TextUtils.SimpleStringSplitter(',');
-                splitter.setString(packageBlacklist);
+            } else if (!packageBlacklist.isEmpty()) {
                 exposeMonoCamera = true;
-                for (String str : splitter) {
-                    if (packageName.equals(str)) {
-                        exposeMonoCamera = false;
-                        break;
-                    }
+                if (Arrays.asList(packageBlacklist.split(",")).contains(packageName)) {
+                    exposeMonoCamera = false;
                 }
             }
 
-- 
2.17.1

