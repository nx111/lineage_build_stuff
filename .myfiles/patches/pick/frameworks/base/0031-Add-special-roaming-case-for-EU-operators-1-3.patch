From a66328f00e351a92c76762e557a96acebe460dbc Mon Sep 17 00:00:00 2001
From: blunden <blunden2@gmail.com>
Date: Sat, 18 May 2019 17:17:29 +0200
Subject: [PATCH 31/44] Add special roaming case for EU operators [1/3]

As of 15 June 2017, mobile operators should no longer apply
surcharges to customers travelling within the EU [1]. Add an
extra roaming state to take into account this special case, which
is subject to certain limitations and can't be considered equal
to the "not roaming" case.

[1] http://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:32016R2286

Change-Id: I00f672aae1f7dc980a85df130e942784f0702a3a
---
 core/java/android/provider/Settings.java         |  7 +++++++
 .../java/android/telephony/ServiceState.java     | 16 ++++++++++++++--
 2 files changed, 21 insertions(+), 2 deletions(-)

diff --git a/core/java/android/provider/Settings.java b/core/java/android/provider/Settings.java
index d98c2784159..7a418841bdc 100644
--- a/core/java/android/provider/Settings.java
+++ b/core/java/android/provider/Settings.java
@@ -11902,6 +11902,13 @@ public final class Settings {
          */
         public static final String LTE_SERVICE_FORCED = "lte_service_forced";
 
+        /**
+         * Whether to enable roaming within the EU.
+         *
+         * @hide
+         */
+        public static final String EU_ROAMING = "eu_roaming";
+
         /**
          * Ephemeral app cookie max size in bytes.
          * <p>
diff --git a/telephony/java/android/telephony/ServiceState.java b/telephony/java/android/telephony/ServiceState.java
index 8ffdb21c616..7a09116c89a 100644
--- a/telephony/java/android/telephony/ServiceState.java
+++ b/telephony/java/android/telephony/ServiceState.java
@@ -218,6 +218,13 @@ public class ServiceState implements Parcelable {
      */
     public static final int ROAMING_TYPE_INTERNATIONAL = 3;
 
+    /**
+     * Roaming type
+     * EU : in EU roaming network
+     * @hide
+     */
+    public static final int ROAMING_TYPE_EU = 4;
+
     /**
      * Unknown ID. Could be returned by {@link #getCdmaNetworkId()} or {@link #getCdmaSystemId()}
      */
@@ -277,6 +284,9 @@ public class ServiceState implements Parcelable {
             case ROAMING_TYPE_INTERNATIONAL:
                 return "International Roaming";
 
+            case ROAMING_TYPE_EU:
+                return "EU Roaming";
+
             default:
                 return "UNKNOWN";
         }
@@ -515,7 +525,8 @@ public class ServiceState implements Parcelable {
      * @hide
      */
     public boolean getVoiceRoaming() {
-        return mVoiceRoamingType != ROAMING_TYPE_NOT_ROAMING;
+        return mVoiceRoamingType != ROAMING_TYPE_NOT_ROAMING &&
+                mVoiceRoamingType != ROAMING_TYPE_EU;
     }
 
     /**
@@ -533,7 +544,8 @@ public class ServiceState implements Parcelable {
      * @hide
      */
     public boolean getDataRoaming() {
-        return mDataRoamingType != ROAMING_TYPE_NOT_ROAMING;
+        return mDataRoamingType != ROAMING_TYPE_NOT_ROAMING &&
+                mDataRoamingType != ROAMING_TYPE_EU;
     }
 
     /**
-- 
2.17.1

