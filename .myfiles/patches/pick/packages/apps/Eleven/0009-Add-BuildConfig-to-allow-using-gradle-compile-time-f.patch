From 1ffde47836152574a09105159add120a36876203 Mon Sep 17 00:00:00 2001
From: Alexander Martinz <amartinz@shiftphones.com>
Date: Tue, 26 Feb 2019 17:20:46 +0100
Subject: [PATCH 09/20] Add BuildConfig to allow using gradle compile time
 fields

Change-Id: Id041904e356ee1e9205babbbbcaf31b2ffe9c3ef
Signed-off-by: Alexander Martinz <amartinz@shiftphones.com>
---
 Android.mk                                    |  1 +
 .../lineageos/eleven/ElevenApplication.java   | 68 ++++++++-----------
 .../org/lineageos/eleven/BuildConfig.java     | 20 ++++++
 3 files changed, 49 insertions(+), 40 deletions(-)
 create mode 100644 src_aosp/org/lineageos/eleven/BuildConfig.java

diff --git a/Android.mk b/Android.mk
index db9f2e6..ef58cac 100644
--- a/Android.mk
+++ b/Android.mk
@@ -5,6 +5,7 @@ LOCAL_MODULE_TAGS := optional
 
 LOCAL_SRC_FILES := src/org/lineageos/eleven/IElevenService.aidl
 LOCAL_SRC_FILES += $(call all-java-files-under, src)
+LOCAL_SRC_FILES += $(call all-java-files-under, src_aosp)
 
 LOCAL_RESOURCE_DIR := $(addprefix $(LOCAL_PATH)/, res)
 
diff --git a/src/org/lineageos/eleven/ElevenApplication.java b/src/org/lineageos/eleven/ElevenApplication.java
index 6ab80b8..5830cf5 100644
--- a/src/org/lineageos/eleven/ElevenApplication.java
+++ b/src/org/lineageos/eleven/ElevenApplication.java
@@ -1,14 +1,19 @@
 /*
  * Copyright (C) 2012 Andrew Neal
  * Copyright (C) 2014 The CyanogenMod Project
- * Licensed under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with the
- * License. You may obtain a copy of the License at
- * http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law
- * or agreed to in writing, software distributed under the License is
- * distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
- * KIND, either express or implied. See the License for the specific language
- * governing permissions and limitations under the License.
+ * Copyright (C) 2019 The LineageOS Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
  */
 
 package org.lineageos.eleven;
@@ -18,33 +23,16 @@ import android.os.StrictMode;
 
 import org.lineageos.eleven.cache.ImageCache;
 
-import java.util.logging.Level;
-import java.util.logging.Logger;
-
-/**
- * Used to turn off logging for jaudiotagger and free up memory when
- * {@code #onLowMemory()} is called on pre-ICS devices. On post-ICS memory is
- * released within {@link ImageCache}.
- *
- * @author Andrew Neal (andrewdneal@gmail.com)
- */
 public class ElevenApplication extends Application {
-    private static final boolean DEBUG = false;
-
-    /**
-     * {@inheritDoc}
-     */
     @Override
     public void onCreate() {
-        // Enable strict mode logging
-        enableStrictMode();
-        // Turn off logging for jaudiotagger.
-        Logger.getLogger("org.jaudiotagger").setLevel(Level.OFF);
+        super.onCreate();
+
+        if (BuildConfig.DEBUG) {
+            enableStrictMode();
+        }
     }
 
-    /**
-     * {@inheritDoc}
-     */
     @Override
     public void onLowMemory() {
         ImageCache.getInstance(this).evictAll();
@@ -52,15 +40,15 @@ public class ElevenApplication extends Application {
     }
 
     private void enableStrictMode() {
-        if (DEBUG) {
-            final StrictMode.ThreadPolicy.Builder threadPolicyBuilder = new StrictMode.ThreadPolicy.Builder()
-                    .detectAll().penaltyLog();
-            final StrictMode.VmPolicy.Builder vmPolicyBuilder = new StrictMode.VmPolicy.Builder()
-                    .detectAll().penaltyLog();
-
-            threadPolicyBuilder.penaltyFlashScreen();
-            StrictMode.setThreadPolicy(threadPolicyBuilder.build());
-            StrictMode.setVmPolicy(vmPolicyBuilder.build());
-        }
+        final StrictMode.ThreadPolicy.Builder threadPolicyBuilder = new StrictMode.ThreadPolicy.Builder()
+                .detectAll()
+                .penaltyLog()
+                .penaltyFlashScreen();
+        final StrictMode.VmPolicy.Builder vmPolicyBuilder = new StrictMode.VmPolicy.Builder()
+                .detectAll()
+                .penaltyLog();
+
+        StrictMode.setThreadPolicy(threadPolicyBuilder.build());
+        StrictMode.setVmPolicy(vmPolicyBuilder.build());
     }
 }
diff --git a/src_aosp/org/lineageos/eleven/BuildConfig.java b/src_aosp/org/lineageos/eleven/BuildConfig.java
new file mode 100644
index 0000000..5b6bb8a
--- /dev/null
+++ b/src_aosp/org/lineageos/eleven/BuildConfig.java
@@ -0,0 +1,20 @@
+/*
+ * Copyright (C) 2019 The LineageOS Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.lineageos.eleven;
+
+public final class BuildConfig {
+    public static final boolean DEBUG = Boolean.parseBoolean("false");
+}
-- 
2.17.1

