From 0258629ef0017ddbc3b0a9acd63ff234e35fcd7a Mon Sep 17 00:00:00 2001
From: Matthew Ng <ngmatthew@google.com>
Date: Fri, 13 Jul 2018 17:00:24 -0700
Subject: [PATCH 02/10] App menu icon launching app info hides taskview menu

Change-Id: I0b493229d18027adbb7c1ee15b38d859e0b3a434
Fixes: 111405044
Test: go to overview, tap icon, tap app info
---
 quickstep/src/com/android/quickstep/TaskSystemShortcut.java | 6 ------
 src/com/android/launcher3/popup/SystemShortcut.java         | 6 ++++++
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/quickstep/src/com/android/quickstep/TaskSystemShortcut.java b/quickstep/src/com/android/quickstep/TaskSystemShortcut.java
index 5a6312d4e..e5a2b5e25 100644
--- a/quickstep/src/com/android/quickstep/TaskSystemShortcut.java
+++ b/quickstep/src/com/android/quickstep/TaskSystemShortcut.java
@@ -30,7 +30,6 @@ import android.os.UserHandle;
 import android.util.Log;
 import android.view.View;
 
-import com.android.launcher3.AbstractFloatingView;
 import com.android.launcher3.BaseDraggingActivity;
 import com.android.launcher3.DeviceProfile;
 import com.android.launcher3.ItemInfo;
@@ -270,9 +269,4 @@ public class TaskSystemShortcut<T extends SystemShortcut> extends SystemShortcut
             return null;
         }
     }
-
-    private static void dismissTaskMenuView(BaseDraggingActivity activity) {
-        AbstractFloatingView.closeOpenViews(activity, true,
-                AbstractFloatingView.TYPE_ALL & ~AbstractFloatingView.TYPE_REBIND_SAFE);
-    }
 }
diff --git a/src/com/android/launcher3/popup/SystemShortcut.java b/src/com/android/launcher3/popup/SystemShortcut.java
index 0348b0bfc..a5bf68ce6 100644
--- a/src/com/android/launcher3/popup/SystemShortcut.java
+++ b/src/com/android/launcher3/popup/SystemShortcut.java
@@ -80,6 +80,7 @@ public abstract class SystemShortcut<T extends BaseDraggingActivity> extends Ite
         public View.OnClickListener getOnClickListener(
                 BaseDraggingActivity activity, ItemInfo itemInfo) {
             return (view) -> {
+                dismissTaskMenuView(activity);
                 Rect sourceBounds = activity.getViewBounds(view);
                 Bundle opts = activity.getActivityLaunchOptionsAsBundle(view);
                 new PackageManagerHelper(activity).startDetailsActivityForInfo(
@@ -122,4 +123,9 @@ public abstract class SystemShortcut<T extends BaseDraggingActivity> extends Ite
             };
         }
     }
+
+    protected static void dismissTaskMenuView(BaseDraggingActivity activity) {
+        AbstractFloatingView.closeOpenViews(activity, true,
+            AbstractFloatingView.TYPE_ALL & ~AbstractFloatingView.TYPE_REBIND_SAFE);
+    }
 }
-- 
2.17.1

