From 8cdc310d5b148cefdd6ddfacd327c1d64870d00f Mon Sep 17 00:00:00 2001
From: Bruno Martins <bgcngm@gmail.com>
Date: Sat, 28 Jul 2018 01:01:30 +0100
Subject: [PATCH 3/4] StatusBarSettings: Hide battery preference category based
 on icon visibility

Change-Id: I5abc4419d42ba17f3de9246d1302b1c2828d0dc0
---
 res/xml/status_bar_settings.xml                       |  1 +
 .../lineageparts/statusbar/StatusBarSettings.java     | 11 +++++++++++
 2 files changed, 12 insertions(+)

diff --git a/res/xml/status_bar_settings.xml b/res/xml/status_bar_settings.xml
index 4ef5fbf..85e76be 100644
--- a/res/xml/status_bar_settings.xml
+++ b/res/xml/status_bar_settings.xml
@@ -85,6 +85,7 @@
 
 <!--
     <PreferenceCategory
+        android:key="status_bar_battery_key"
         android:title="@string/status_bar_battery_title">
 
         <lineageos.preference.LineageSystemSettingListPreference
diff --git a/src/org/lineageos/lineageparts/statusbar/StatusBarSettings.java b/src/org/lineageos/lineageparts/statusbar/StatusBarSettings.java
index 9dbce30..400028f 100644
--- a/src/org/lineageos/lineageparts/statusbar/StatusBarSettings.java
+++ b/src/org/lineageos/lineageparts/statusbar/StatusBarSettings.java
@@ -41,6 +41,7 @@ import java.util.Set;
 public class StatusBarSettings extends SettingsPreferenceFragment
         implements OnPreferenceChangeListener, Searchable {
 
+    private static final String CATEGORY_BATTERY = "status_bar_battery_key";
     private static final String CATEGORY_CLOCK = "status_bar_clock_key";
 
     private static final String ICON_BLACKLIST = "icon_blacklist";
@@ -65,6 +66,7 @@ public class StatusBarSettings extends SettingsPreferenceFragment
     private LineageSystemSettingListPreference mStatusBarBattery;
     private LineageSystemSettingListPreference mStatusBarBatteryShowPercent;
 
+    private PreferenceCategory mStatusBarBatteryCategory;
     private PreferenceCategory mStatusBarClockCategory;
     private PreferenceScreen mNetworkTrafficPref;
 
@@ -102,6 +104,9 @@ public class StatusBarSettings extends SettingsPreferenceFragment
         enableStatusBarBatteryDependents(mStatusBarBattery.getIntValue(2));
 */
 
+        mStatusBarBatteryCategory =
+                (PreferenceCategory) getPreferenceScreen().findPreference(CATEGORY_BATTERY);
+
         mQuickPulldown =
                 (LineageSystemSettingListPreference) findPreference(STATUS_BAR_QUICK_QS_PULLDOWN);
         mQuickPulldown.setOnPreferenceChangeListener(this);
@@ -121,6 +126,12 @@ public class StatusBarSettings extends SettingsPreferenceFragment
             getPreferenceScreen().addPreference(mStatusBarClockCategory);
         }
 
+        if (TextUtils.delimitedStringContains(curIconBlacklist, ',', "battery")) {
+            getPreferenceScreen().removePreference(mStatusBarBatteryCategory);
+        } else {
+            getPreferenceScreen().addPreference(mStatusBarBatteryCategory);
+        }
+
         if (DateFormat.is24HourFormat(getActivity())) {
             mStatusBarAmPm.setEnabled(false);
             mStatusBarAmPm.setSummary(R.string.status_bar_am_pm_info);
-- 
2.17.1

