From 6871fb4e7fdc75e3d13e78c86420d27744d605a5 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Fri, 23 Mar 2018 17:39:47 +0200
Subject: [PATCH 01/17] Squashed merge of LA.UM.6.4.r1-06900-8x98.0 and
 LA.UM.6.6.r1-06700-89xx.0

Change-Id: Ie031bd5667c5d870ec7480204fec186006c9914e
---
 apq8098_latv/file_contexts           |   1 +
 apq8098_latv/recovery.te             |  30 +++++++
 apq8098_latv/update_engine_common.te |  39 ++++++++
 common/attributes                    |   6 +-
 common/audioserver.te                |   6 +-
 common/cameraserver.te               |   3 +
 common/chre.te                       |  39 ++++++++
 common/device.te                     |   3 +
 common/diag.te                       |   2 +
 common/domain.te                     |   1 +
 common/file.te                       |  29 ++++++
 common/file_contexts                 |  28 +++++-
 common/genfs_contexts                |  11 ++-
 common/hal_audio.te                  |   2 +
 common/hal_bluetooth_qti.te          |   2 +
 common/hal_camera.te                 |   6 ++
 common/hal_contexthub.te             |  29 ++++++
 common/hal_factory_qti.te            |  33 +++++++
 common/hal_factory_qti_default.te    |  40 +++++++++
 common/hal_gatekeeper_qti.te         |   9 ++
 common/hal_gnss_qti.te               |   4 +
 common/hal_graphics_composer.te      |   6 +-
 common/hal_keymaster_qti.te          |   9 ++
 common/hal_memtrack.te               |  11 +--
 common/hal_rcsservice.te             |   1 +
 common/hal_thermal_default.te        |   3 +
 common/hal_wifi_supplicant.te        |   2 +
 common/hostapd.te                    |   2 +
 common/hvdcp.te                      |   3 +
 common/hwservice.te                  |   1 +
 common/hwservice_contexts            |   2 +
 common/ims.te                        |   1 +
 common/init_shell.te                 |  17 +++-
 common/kernel.te                     |   1 +
 common/location.te                   |   4 +
 common/location_app.te               |   1 +
 common/mm-qcamerad.te                |   5 +-
 common/mmi.te                        |   7 ++
 common/mmi_sys.te                    |  38 ++++++++
 common/platform_app.te               |   3 +
 common/priv_app.te                   |   1 +
 common/property.te                   |   6 ++
 common/property_contexts             |   6 ++
 common/qdma_app.te                   |   3 +
 common/qdmastatsd.te                 |   6 ++
 common/qti-logkit.te                 |   7 ++
 common/qti.te                        |  11 +--
 common/qti_logkit_app.te             |   3 +-
 common/rfs_access.te                 |   8 +-
 common/rild.te                       |   1 +
 common/rmt_storage.te                |   9 +-
 common/seapp_contexts                |   4 -
 common/sec_nvm.te                    |   2 +
 common/service.te                    |   2 -
 common/service_contexts              |   3 -
 common/surfaceflinger.te             |   2 +
 common/system_app.te                 |   4 +
 common/system_server.te              |   3 +
 common/wfdservice.te                 |   4 +
 common/wigighalsvc.te                |  11 ++-
 msm8909/file_contexts                |   1 +
 msm8909/hal-server.te                |   7 ++
 msm8937/file.te                      |  29 ------
 msm8937/file_contexts                |   4 +-
 msm8937/hal-server.te                | 166 +++++++++++++++++++++++++++++++++++
 msm8937/qti-logkit.te                |  33 -------
 msm8952/zygote.te                    |   4 +-
 msm8953/file.te                      |  29 ------
 msm8953/file_contexts                |  11 ++-
 msm8953/hal_light_default.te         |  29 ++++++
 msm8953/hal_usb.te                   |  29 ++++++
 msm8953/hal_vibrator_default.te      |  29 ++++++
 msm8953/init_shell.te                |   3 +
 msm8953/mediacodec.te                |  29 ++++++
 msm8953/mediaprovider.te             |  29 ++++++
 msm8953/mm-qcamerad.te               |  30 +++++++
 msm8953/priv_app.te                  |   3 +-
 msm8953/qti-logkit.te                |  33 -------
 msm8953/untrusted_app.te             |   3 +-
 msm8976/file.te                      |  29 ------
 msm8976/file_contexts                |   1 -
 msm8976/qti-logkit.te                |  33 -------
 msm8996/amfsservice.te               |  38 ++++++++
 msm8996/file.te                      |  29 ------
 msm8996/file_contexts                |  10 ++-
 msm8996/qti-logkit.te                |  33 -------
 msm8998/file.te                      |  30 -------
 msm8998/file_contexts                |   1 -
 msm8998/init_shell.te                |   4 +
 msm8998/qti-logkit.te                |  33 -------
 msmpeafowl/wfdservice.te             |  30 +++++++
 private/file_contexts                |   1 +
 private/mediaprovider.te             |  29 ++++++
 private/mediaserver.te               |  28 ++++++
 private/mmi_sys.te                   |  42 +++++++++
 private/seapp_contexts               |   3 +
 private/service.te                   |   3 +
 private/service_contexts             |   3 +
 private/wfdservice.te                |   1 +
 public/mmi_sys.te                    |  31 +++++++
 public/service.te                    |  28 ------
 qcs605/file.te                       |  29 ++++++
 qcs605/file_contexts                 |   8 +-
 qcs605/genfs_contexts                |  28 ++++++
 qcs605/mm-qcamerad.te                |  29 ++++++
 qcs605/property.te                   |  28 ++++++
 qcs605/property_contexts             |  29 ++++++
 qcs605/qmmf-servd.te                 |  78 ++++++++++++++++
 qcs605/system_server.te              |  28 ++++++
 qcs605/vndservice.te                 |  32 +++++++
 qcs605/vndservice_contexts           |  32 +++++++
 sdm660/file.te                       |   4 +-
 sdm660/file_contexts                 |   5 +-
 sdm660/init_shell.te                 |   7 ++
 sdm660/qti-logkit.te                 |  33 -------
 sdm670/idmap.te                      |  31 +++++++
 sdm670/init_shell.te                 |   4 +
 sdm670/mediacodec.te                 |  28 ++++++
 sdm670/platform_app.te               |  31 +++++++
 sdm670/priv_app.te                   |  31 +++++++
 sdm670/system_app.te                 |  33 +++++++
 sdm670/system_server.te              |  32 +++++++
 sdm670/untrusted_app.te              |  32 +++++++
 sdm670/wfdservice.te                 |  30 +++++++
 sdm670/zygote.te                     |  31 +++++++
 sdm845/file_contexts                 |   1 +
 ssg/ssg_app.te                       |   1 +
 127 files changed, 1696 insertions(+), 436 deletions(-)
 create mode 100644 apq8098_latv/recovery.te
 create mode 100644 apq8098_latv/update_engine_common.te
 mode change 100644 => 100755 common/attributes
 create mode 100644 common/chre.te
 create mode 100644 common/hal_contexthub.te
 create mode 100755 common/hal_factory_qti.te
 create mode 100644 common/hal_factory_qti_default.te
 mode change 100644 => 100755 common/hwservice.te
 mode change 100644 => 100755 common/hwservice_contexts
 mode change 100755 => 100644 common/mmi.te
 create mode 100644 common/mmi_sys.te
 delete mode 100644 msm8937/file.te
 create mode 100644 msm8937/hal-server.te
 delete mode 100644 msm8937/qti-logkit.te
 delete mode 100644 msm8953/file.te
 create mode 100644 msm8953/hal_light_default.te
 create mode 100644 msm8953/hal_usb.te
 create mode 100644 msm8953/hal_vibrator_default.te
 create mode 100644 msm8953/mediacodec.te
 create mode 100644 msm8953/mediaprovider.te
 create mode 100644 msm8953/mm-qcamerad.te
 delete mode 100644 msm8953/qti-logkit.te
 delete mode 100644 msm8976/file.te
 delete mode 100644 msm8976/qti-logkit.te
 create mode 100644 msm8996/amfsservice.te
 delete mode 100644 msm8996/file.te
 delete mode 100644 msm8996/qti-logkit.te
 delete mode 100644 msm8998/file.te
 delete mode 100644 msm8998/qti-logkit.te
 create mode 100644 msmpeafowl/wfdservice.te
 create mode 100644 private/mediaprovider.te
 create mode 100644 private/mediaserver.te
 create mode 100644 private/mmi_sys.te
 create mode 100644 public/mmi_sys.te
 delete mode 100644 public/service.te
 create mode 100644 qcs605/file.te
 create mode 100644 qcs605/genfs_contexts
 create mode 100644 qcs605/mm-qcamerad.te
 create mode 100644 qcs605/property.te
 create mode 100644 qcs605/property_contexts
 create mode 100644 qcs605/qmmf-servd.te
 create mode 100644 qcs605/system_server.te
 create mode 100644 qcs605/vndservice.te
 create mode 100644 qcs605/vndservice_contexts
 delete mode 100644 sdm660/qti-logkit.te
 create mode 100644 sdm670/idmap.te
 create mode 100644 sdm670/mediacodec.te
 create mode 100644 sdm670/platform_app.te
 create mode 100644 sdm670/priv_app.te
 create mode 100644 sdm670/system_app.te
 create mode 100644 sdm670/system_server.te
 create mode 100644 sdm670/untrusted_app.te
 create mode 100644 sdm670/wfdservice.te
 create mode 100644 sdm670/zygote.te

diff --git a/apq8098_latv/file_contexts b/apq8098_latv/file_contexts
index 140b873..8895271 100644
--- a/apq8098_latv/file_contexts
+++ b/apq8098_latv/file_contexts
@@ -57,6 +57,7 @@
 /dev/block/platform/soc/1da4000.ufshc/by-name/cmnlib_[ab]       u:object_r:custom_ab_block_device:s0
 /dev/block/platform/soc/1da4000.ufshc/by-name/cmnlib64_[ab]     u:object_r:custom_ab_block_device:s0
 /dev/block/platform/soc/1da4000.ufshc/by-name/devcfg_[ab]       u:object_r:custom_ab_block_device:s0
+/dev/block/platform/soc/1da4000.ufshc/by-name/devcfgmedia_[ab]  u:object_r:custom_ab_block_device:s0
 /dev/block/platform/soc/1da4000.ufshc/by-name/hyp_[ab]          u:object_r:custom_ab_block_device:s0
 /dev/block/platform/soc/1da4000.ufshc/by-name/keymaster_[ab]    u:object_r:custom_ab_block_device:s0
 /dev/block/platform/soc/1da4000.ufshc/by-name/modem_[ab]        u:object_r:modem_block_device:s0
diff --git a/apq8098_latv/recovery.te b/apq8098_latv/recovery.te
new file mode 100644
index 0000000..4f75bc4
--- /dev/null
+++ b/apq8098_latv/recovery.te
@@ -0,0 +1,30 @@
+# Copyright (c) 2016, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+recovery_only(`
+    allow recovery vendor_shell_exec:file x_file_perms;
+')
diff --git a/apq8098_latv/update_engine_common.te b/apq8098_latv/update_engine_common.te
new file mode 100644
index 0000000..af64747
--- /dev/null
+++ b/apq8098_latv/update_engine_common.te
@@ -0,0 +1,39 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# Allow update_engine and update_engine_sideload (recovery) read/write on the
+# device-specific partitions it should update.
+allow update_engine_common {
+	custom_ab_block_device
+	xbl_block_device
+        boot_block_device
+	ssd_device
+	modem_block_device
+        system_block_device
+        mdtp_device
+}:blk_file rw_file_perms;
+
diff --git a/common/attributes b/common/attributes
old mode 100644
new mode 100755
index 2408170..c740337
--- a/common/attributes
+++ b/common/attributes
@@ -90,10 +90,14 @@ attribute hal_tui_comm;
 attribute hal_tui_comm_client;
 attribute hal_tui_comm_server;
 
+attribute hal_factory_qti;
+attribute hal_factory_qti_client;
+attribute hal_factory_qti_server;
+
 attribute hal_sensorscalibrate_qti;
 attribute hal_sensorscalibrate_qti_client;
 attribute hal_sensorscalibrate_qti_server;
 
 attribute hal_wigig_npt;
 attribute hal_wigig_npt_client;
-attribute hal_wigig_npt_server;
+attribute hal_wigig_npt_server;
\ No newline at end of file
diff --git a/common/audioserver.te b/common/audioserver.te
index 28cce20..6367cbf 100644
--- a/common/audioserver.te
+++ b/common/audioserver.te
@@ -1,4 +1,4 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
+# Copyright (c) 2016-2017, The Linux Foundation. All rights reserved.
 
 # Redistribution and use in source and binary forms, with or without
 # modification, are permitted provided that the following conditions are
@@ -62,11 +62,11 @@ allow audioserver audio_data_file:dir remove_name;
 allow audioserver proc_audiod:file r_file_perms;
 
 # Allow audioserver to read sysfs dir and sysfs_thermal files for speaker protection
-allow audioserver sysfs:dir r_dir_perms;
+allow audioserver sysfs_audio:dir r_dir_perms;
 allow audioserver sysfs_thermal:file r_file_perms;
 
 # Allow audioserver to access sysfs nodes
-allow audioserver sysfs:file rw_file_perms;
+allow audioserver sysfs_audio:file rw_file_perms;
 userdebug_or_eng(`
   diag_use(audioserver)
 ')
diff --git a/common/cameraserver.te b/common/cameraserver.te
index 77b32a9..c6d0aa9 100644
--- a/common/cameraserver.te
+++ b/common/cameraserver.te
@@ -58,6 +58,9 @@ allow cameraserver system_file:dir r_dir_perms;
 allow cameraserver qdsp_device:chr_file r_file_perms;
 allow cameraserver camera_prop:file r_file_perms;
 
+#allow cameraserver to access /dsp
+r_dir_file(cameraserver, adsprpcd_file);
+
 #need this in full_treble for camera perview
 allow cameraserver hal_allocator:fd use;
 
diff --git a/common/chre.te b/common/chre.te
new file mode 100644
index 0000000..0d7fc2d
--- /dev/null
+++ b/common/chre.te
@@ -0,0 +1,39 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#    * Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#    * Redistributions in binary form must reproduce the above
+#      copyright notice, this list of conditions and the following
+#      disclaimer in the documentation and/or other materials provided
+#      with the distribution.
+#    * Neither the name of The Linux Foundation nor the names of its
+#      contributors may be used to endorse or promote products derived
+#      from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# This daemon loads the Context Hub Runtime Environment (CHRE) dynamic modules
+# onto the SLPI using FastRPC, and exposes a sockets interface for clients on
+# the applications processor to interact CHRE
+type chre, domain;
+type chre_exec, exec_type, vendor_file_type, file_type;
+
+init_daemon_domain(chre)
+r_dir_file(chre, adsprpcd_file)
+
+allow chre ion_device:chr_file r_file_perms;
+allow chre qdsp_device:chr_file r_file_perms;
+allow chre dsp_device:chr_file r_file_perms;
\ No newline at end of file
diff --git a/common/device.te b/common/device.te
index 61a5d83..f4dea16 100644
--- a/common/device.te
+++ b/common/device.te
@@ -152,3 +152,6 @@ type modem_block_device, dev_type;
 
 #define bgcom char device
 type bg_daemon_device, dev_type;
+
+#define qg char device
+type qg_device, dev_type;
diff --git a/common/diag.te b/common/diag.te
index 5ac1dc7..ecd792f 100644
--- a/common/diag.te
+++ b/common/diag.te
@@ -42,4 +42,6 @@ userdebug_or_eng(`
   allow diag fuse:file r_file_perms;
   r_dir_file(diag, storage_file)
   r_dir_file(diag, mnt_user_file)
+  allow diag media_rw_data_file:file r_file_perms;
+  r_dir_file(diag, sdcardfs)
 ')
diff --git a/common/domain.te b/common/domain.te
index ad55301..08fc7cb 100644
--- a/common/domain.te
+++ b/common/domain.te
@@ -24,3 +24,4 @@ dontaudit domain persist_dpm_prop:file r_file_perms;
 allow domain sysfs_kgsl_gpuclk:file r_file_perms;
 allow domain  sysfs_kgsl_gpuclk:lnk_file r_file_perms;
 allow domain qti_debugfs:dir search;
+allow domain kgsl_debugfs:dir search;
diff --git a/common/file.te b/common/file.te
index fe60ca0..ec0cdb4 100644
--- a/common/file.te
+++ b/common/file.te
@@ -13,6 +13,7 @@ type pps_socket, file_type;
 # Define cnd socket and data file type
 type cnd_socket, file_type, mlstrustedobject;
 type cnd_data_file, file_type, data_file_type;
+type chre_socket, file_type;
 
 # Define dpmd data file type
 #type dpmd_socket, file_type;
@@ -77,6 +78,19 @@ type sysfs_graphics, sysfs_type, fs_type;
 type sysfs_usb_supply, sysfs_type, fs_type;
 type sysfs_battery_supply, sysfs_type, fs_type;
 type sysfs_usbpd_device, sysfs_type, fs_type;
+
+# sysfs module for usb_f_mtp/parameters
+type sysfs_usb_mtp_device, sysfs_type, fs_type;
+
+# sysfs module for usb_f_mtp/parameters
+type sysfs_spmi_device, sysfs_type, fs_type;
+
+# sysfs devices for enable
+type sysfs_dcc_device, sysfs_type, fs_type;
+
+# sysfs devices for video4linux
+type sysfs_video4linux_device, sysfs_type, fs_type;
+
 # sysfs vadc device for hvdcp/quickcharge
 type sysfs_vadc_dev, sysfs_type, fs_type;
 # sysfs spmi device for hvdcp/quickcharge
@@ -298,6 +312,9 @@ type sysfs_ea, fs_type, sysfs_type;
 #audio sysfs files
 type sysfs_audio, fs_type, sysfs_type;
 
+#audio sysfs files
+type sysfs_boot, fs_type, sysfs_type;
+
 # lpm sysfs files
 type sysfs_msm_stats, fs_type, sysfs_type;
 type sysfs_msm_power, fs_type, sysfs_type;
@@ -311,3 +328,15 @@ type vendor_tombstone_data_file, file_type, data_file_type;
 
 # SFS listener data file
 type data_tzstorage_file, file_type, data_file_type;
+
+# poweron_alarm sysfs file
+type sysfs_poweron_alarm, fs_type, sysfs_type;
+
+# ship mode sysfs file
+type sysfs_pon_dev, fs_type, sysfs_type;
+
+#kgsl
+type kgsl_debugfs, debugfs_type, fs_type;
+
+#sysfs emmc dload type
+type sysfs_emmc_dload, sysfs_type, fs_type;
diff --git a/common/file_contexts b/common/file_contexts
index b1e9aec..55a3940 100644
--- a/common/file_contexts
+++ b/common/file_contexts
@@ -77,7 +77,8 @@
 /dev/dri/renderD128                             u:object_r:graphics_device:s0
 /dev/wlan                                       u:object_r:wlan_device:s0
 /dev/bg_com_dev                                 u:object_r:bg_daemon_device:s0
-
+/dev/qg                                         u:object_r:qg_device:s0
+/dev/qg_battery                                 u:object_r:qg_device:s0
 ###################################
 # Dev block nodes
 #
@@ -96,6 +97,7 @@
 ###################################
 # Dev socket nodes
 #
+/dev/socket/chre                                u:object_r:chre_socket:s0
 /dev/socket/qmux_audio(/.*)?                    u:object_r:qmuxd_socket:s0
 /dev/socket/qmux_bluetooth(/.*)?                u:object_r:qmuxd_socket:s0
 /dev/socket/qmux_gps(/.*)?                      u:object_r:qmuxd_socket:s0
@@ -132,6 +134,8 @@
 /dev/socket/wpa_wigig[0-9]                      u:object_r:wpa_socket:s0
 /dev/socket/wigignpt                            u:object_r:wigignpt_socket:s0
 /dev/socket/qdma(/.*)?                          u:object_r:qdma_socket:s0
+/dev/socket/mmi                                 u:object_r:mmi_socket:s0
+/dev/socket/location(/.*)?                      u:object_r:location_socket:s0
 
 ###################################
 # System files
@@ -183,6 +187,9 @@
 /(vendor|system/vendor)/bin/mm-pp-daemon        u:object_r:mm-pp-daemon_exec:s0
 /(vendor|system/vendor)/bin/mm-pp-dpps          u:object_r:mm-pp-daemon_exec:s0
 /(vendor|system/vendor)/bin/mmi                 u:object_r:mmi_exec:s0
+/(vendor|system/vendor)/bin/mmid                u:object_r:mmi_exec:s0
+/(vendor|system/vendor)/bin/ftmdaemon           u:object_r:mmi_exec:s0
+/(vendor|system/vendor)/bin/mm-audio-ftm        u:object_r:mmi_exec:s0
 /(vendor|system/vendor)/bin/mpdecision          u:object_r:mpdecision_exec:s0
 /(vendor|system/vendor)/bin/gamed               u:object_r:gamed_exec:s0
 /(vendor|system/vendor)/bin/msm_irqbalance  u:object_r:msm_irqbalanced_exec:s0
@@ -193,6 +200,7 @@
 /(vendor|system/vendor)/bin/qmuxd               u:object_r:qmuxd_exec:s0
 /(vendor|system/vendor)/bin/port-bridge         u:object_r:port-bridge_exec:s0
 /(vendor|system/vendor)/bin/sensors.qcom        u:object_r:sensors_exec:s0
+/(vendor|system/vendor)/bin/sensors.qti         u:object_r:sensors_exec:s0
 /(vendor|system/vendor)/bin/test_diag           u:object_r:diag_exec:s0
 /(vendor|system/vendor)/bin/thermal-engine      u:object_r:thermal-engine_exec:s0
 /(vendor|system/vendor)/bin/vm_bms                              u:object_r:vm_bms_exec:s0
@@ -236,9 +244,11 @@
 /(vendor|system/vendor)/bin/hw/android\.hardware\.gnss@1\.0-service-qti u:object_r:hal_gnss_qti_exec:s0
 /(vendor|system/vendor)/bin/hw/vendor\.qti\.gnss@1\.0-service u:object_r:hal_gnss_qti_exec:s0
 /(vendor|system/vendor)/bin/hw/vendor\.qti\.gnss@1\.1-service u:object_r:hal_gnss_qti_exec:s0
+/(vendor|system/vendor)/bin/hw/vendor\.qti\.gnss@1\.2-service u:object_r:hal_gnss_qti_exec:s0
 /(vendor|system/vendor)/bin/hw/android\.hardware\.bluetooth@1\.0-service-qti  u:object_r:hal_bluetooth_qti_exec:s0
 /(vendor|system/vendor)/bin/hw/vendor\.display\.color@1\.0-service            u:object_r:hal_display_color_default_exec:s0
 /(vendor|system/vendor)/bin/hw/vendor\.qti\.hardware\.perf@1\.0-service       u:object_r:hal_perf_default_exec:s0
+/(vendor|system/vendor)/bin/hw/vendor\.qti\.hardware\.limits@1\.0-service     u:object_r:hal_thermal_default_exec:s0
 /(vendor|system/vendor)/bin/ssgqmigd            u:object_r:ssgqmigd_exec:s0
 /(vendor|system/vendor)/bin/hw/vendor\.qti\.hardware\.iop@1\.0-service        u:object_r:hal_iop_default_exec:s0
 /(vendor|system/vendor)/bin/hw/vendor\.qti\.hardware\.iop@2\.0-service        u:object_r:hal_iop_default_exec:s0
@@ -301,8 +311,10 @@
 /(vendor|system/vendor)/bin/vppservice          u:object_r:vppservice_exec:s0
 /(vendor|system/vendor)/bin/hw/vendor\.qti\.hardware\.qteeconnector@1\.0-service u:object_r:hal_qteeconnector_qti_exec:s0
 /(vendor|system/vendor)/bin/fm_qsoc_patches     u:object_r:fm_qsoc_patches_exec:s0
+/(vendor|system/vendor)/bin/chre                u:object_r:chre_exec:s0
 /(vendor|system/vendor)/bin/tloc_daemon         u:object_r:tlocd_exec:s0
 /(vendor|system/vendor)/bin/power_off_alarm      u:object_r:power_off_alarm_exec:s0
+/(vendor|system/vendor)/bin/hw/vendor\.qti\.hardware\.factory@1\.0-service      u:object_r:hal_factory_qti_default_exec:s0
 
 ###################################
 # sysfs files
@@ -313,6 +325,8 @@
 /sys/class/uio(/.*)?                                                u:object_r:sysfs_uio:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+.qcom,rmtfs_sharedmem/uio/uio[0-9]+(/.*)?        u:object_r:sysfs_uio_file:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+.qcom,rmtfs_sharedmem/uio/uio[0-9]+/maps/map[0-9]+(/.*)?    u:object_r:sysfs_uio_file:s0
+/sys/devices(/platform)?/soc.0/[a-z0-9]+.qcom,rmtfs_sharedmem/uio/uio[0-9]+(/.*)?        u:object_r:sysfs_uio_file:s0
+/sys/devices(/platform)?/soc.0/[a-z0-9]+.qcom,rmtfs_sharedmem/uio/uio[0-9]+/maps/map[0-9]+(/.*)?    u:object_r:sysfs_uio_file:s0
 /sys/devices/[^/]+bcl[^/]+(/.*)?                                    u:object_r:sysfs_thermal:s0
 /sys/devices/f9200000.*/power_supply/usb(/.*)?                      u:object_r:sysfs_usb_supply:s0
 /sys/devices/msm_dwc3/power_supply/usb(/.*)?                        u:object_r:sysfs_usb_supply:s0
@@ -333,6 +347,7 @@
 /sys/devices/soc/qpnp-smbcharger-[a-z0-9]+/power_supply/dc(/.*)?    u:object_r:sysfs_battery_supply:s0
 /sys/devices/soc/[a-z0-9]+.i2c/i2c-[0-9]/[0-9]-[a-z0-9]+/power_supply/parallel(/.*)?    u:object_r:sysfs_battery_supply:s0
 /sys/devices/soc/[a-z0-9]+.ssusb/power_supply/usb(/.*)?             u:object_r:sysfs_usb_supply:s0
+/sys/devices/soc/[a-z0-9]+.usb/power_supply/usb(/.*)?               u:object_r:sysfs_usb_supply:s0
 /sys/devices/soc/qpnp-vadc-[0-9]+(/.*)?                             u:object_r:sysfs_vadc_dev:s0
 /sys/bus/spmi/devices(/.*)?                                         u:object_r:sysfs_spmi_dev:s0
 /sys/kernel/irq_helper/irq_blacklist_on                             u:object_r:sysfs_irqbalance:s0
@@ -392,7 +407,9 @@
 /sys/devices/virtual/rotator/mdss_rotator/caps                      u:object_r:sysfs_graphics:s0
 
 /sys/devices/platform/vfb.([0-3])+/graphics/fb([0-3])+/modes          u:object_r:sysfs_graphics:s0
+/sys/module/drm/parameters/vblankoffdelay                             u:object_r:sysfs_graphics:s0
 /sys/devices/platform/soc/[a-z0-9]+.qcom,mdss_mdp/drm/card([0-3])+/card([0-3])+-DSI-1/modes u:object_r:sysfs_graphics:s0
+/sys/devices/platform/soc/[a-z0-9]+.qcom,mdss_mdp/drm/card([0-3])+/card([0-3])+-DSI-1/status u:object_r:sysfs_graphics:s0
 
 /sys/devices/virtual/workqueue/kgsl-events/cpumask                  u:object_r:sysfs_kgsl:s0
 /sys/devices/virtual/workqueue/kgsl-events/nice                     u:object_r:sysfs_kgsl:s0
@@ -461,6 +478,7 @@
 /sys/devices(/platform)?/soc/[a-f0-9]+.sdhci/mmc_host/mmc[0-9]/mmc0:[0-9]+/block/mmcblk[0-9]/mmcblk0rpmb/bdi/read_ahead_kb u:object_r:sysfs_mmc_host:s0
 /sys/devices(/platform)?/soc/[a-f0-9]+.sdhci/mmc_host/mmc[0-9]/mmc0:[0-9]+/block/mmcblk[0-9]/mmcblk0rpmb/queue/read_ahead_kb u:object_r:sysfs_mmc_host:s0
 /sys/devices/virtual/bdi/[0-9]+:[0-9]+/read_ahead_kb u:object_r:sysfs_mmc_host:s0
+/sys/devices/virtual/block/dm-[0-9]+/queue/read_ahead_kb u:object_r:sysfs_mmc_host:s0
 
 /sys/module/cpu_boost(/.*)?                                         u:object_r:sysfs_cpu_boost:s0
 /sys/module/msm_performance(/.*)?                                   u:object_r:sysfs_msm_perf:s0
@@ -469,14 +487,17 @@
 /sys/devices/virtual/input/input[0-9]+/enable_ps_sensor           u:object_r:sysfs_laser:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+\.qcom,pcie/pci[0-9:]+/[0-9:\.]+/[0-9:\.]+/wil6210/fst_link_loss            u:object_r:sysfs_wigig:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+\.qcom,pcie/pci[0-9:]+/[0-9:\.]+/[0-9:\.]+/wil6210/thermal_throttling       u:object_r:sysfs_wigig:s0
+/sys/devices(/platform)?/soc/[a-z0-9]+\.qcom,pcie/pci[0-9:]+/[0-9:\.]+/[0-9:\.]+/wil6210/snr_thresh               u:object_r:sysfs_wigig:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+\.qcom,pcie/pci[0-9:]+/[0-9:\.]+/[0-9:\.]+/net/wigig0/queues/rx-0/rps_cpus  u:object_r:sysfs_wigig:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+\.qcom,pcie/pci[0-9:]+/[0-9:\.]+/[0-9:\.]+/net/wigig0/gro_flush_timeout     u:object_r:sysfs_wigig:s0
 /sys/module/msm_core(/.*)?                                          u:object_r:sysfs_ea:s0
 /sys/module/lpm_stats(/.*)?                                         u:object_r:sysfs_msm_stats:s0
 /sys/module/lpm_levels(/.*)?                                        u:object_r:sysfs_msm_power:s0
 /sys/module/radio_iris_transport/parameters/fmsmd_set               u:object_r:sysfs_fm:s0
+/sys/module/qpnp_power_on/parameters/ship_mode_en                   u:object_r:sysfs_pon_dev:s0
 /sys/module/app_setting/parameters/lib_name                         u:object_r:sysfs_lib:s0
 /sys/module/process_reclaim(/.*)?  u:object_r:sysfs_process_reclaim:s0
+/sys/module/qpnp_rtc/parameters/poweron_alarm                       u:object_r:sysfs_poweron_alarm:s0
 
 ###################################
 # data files
@@ -489,6 +510,7 @@
 /data/rfs.*                                                         u:object_r:rfs_file:s0
 /data/hlos_rfs(/.*)?                                                u:object_r:rfs_shared_hlos_file:s0
 /data/camera(/.*)?                                                  u:object_r:camera_socket:s0
+/data/misc/camera/cam_socket[1-2]                                   u:object_r:camera_socket:s0
 /data/vendor/misc/qti_fp(/.*)?                                      u:object_r:qfp-daemon_data_file:s0
 /data/misc/qvop(/.*)?                                               u:object_r:qvop-daemon_data_file:s0
 /data/system/sensors(/.*)?                                          u:object_r:sensors_data_file:s0
@@ -637,6 +659,7 @@
 /(vendor|system/vendor)/lib(64)?/libdiag\.so                u:object_r:same_process_hal_file:s0
 /(vendor|system/vendor)/lib(64)?/libqvrservice_client\.so   u:object_r:same_process_hal_file:s0
 /(vendor|system/vendor)/lib(64)?/libqvrcamera_client\.so    u:object_r:same_process_hal_file:s0
+/(vendor|system/vendor)/lib(64)?/libvraudio_client\.so      u:object_r:same_process_hal_file:s0
 
 ###################################
 # firmware images
@@ -659,6 +682,9 @@
 /(vendor|system/vendor)/lib(64)?/libsdm-disp-vndapis.so             u:object_r:same_process_hal_file:s0
 /(vendor|system/vendor)/lib(64)?/libsdmutils.so                     u:object_r:same_process_hal_file:s0
 
+# rawdump partition
+/sys/kernel/dload/emmc_dload                                        u:object_r:sysfs_emmc_dload:s0
+/sys/kernel/dload/dload_mode                                        u:object_r:sysfs_emmc_dload:s0
 
 ##################################
 # Crypto
diff --git a/common/genfs_contexts b/common/genfs_contexts
index 7ea6941..cac3200 100644
--- a/common/genfs_contexts
+++ b/common/genfs_contexts
@@ -2,11 +2,20 @@ genfscon proc /asound/card0/state u:object_r:proc_audiod:s0
 genfscon proc /sys/vm/dirty_ratio  u:object_r:proc_dirty_ratio:s0
 genfscon sysfs /module/msm_performance/workload_modes u:object_r:sysfs_msm_perf:s0
 genfscon sysfs /devices/platform/soc/soc:qcom,l3-cdsp/devfreq/soc:qcom,l3-cdsp/userspace u:object_r:sysfs_devfreq_l3cdsp:s0
+genfscon sysfs /devices/platform/soc/soc:qcom,cpubw/devfreq u:object_r:sysfs_devfreq:s0
+genfscon sysfs /devices/platform/soc/soc:qcom,memlat-cpu0/devfreq u:object_r:sysfs_devfreq:s0
+genfscon sysfs /devices/platform/soc/soc:qcom,memlat-cpu4/devfreq u:object_r:sysfs_devfreq:s0
+genfscon sysfs /devices/platform/soc/soc:qcom,memlat-cpu6/devfreq u:object_r:sysfs_devfreq:s0
+genfscon sysfs /devices/platform/soc/soc:qcom,l3-cpu0/devfreq u:object_r:sysfs_devfreq:s0
+genfscon sysfs /devices/platform/soc/soc:qcom,l3-cpu4/devfreq u:object_r:sysfs_devfreq:s0
+genfscon sysfs /devices/platform/soc/soc:qcom,l3-cpu6/devfreq u:object_r:sysfs_devfreq:s0
+genfscon sysfs /devices/platform/soc/soc:qcom,mincpubw/devfreq u:object_r:sysfs_devfreq:s0
 genfscon sysfs /devices/soc/soc:qcom,cpubw/devfreq u:object_r:sysfs_devfreq:s0
 genfscon sysfs /devices/soc/soc:qcom,memlat-cpu0/devfreq u:object_r:sysfs_devfreq:s0
+genfscon sysfs /devices/soc/soc:qcom,memlat-cpu2/devfreq u:object_r:sysfs_devfreq:s0
 genfscon sysfs /devices/soc/soc:qcom,memlat-cpu4/devfreq u:object_r:sysfs_devfreq:s0
 genfscon sysfs /devices/soc/soc:qcom,mincpubw/devfreq u:object_r:sysfs_devfreq:s0
-genfscon debugfs /kgsl/proc u:object_r:qti_debugfs:s0
 genfscon sysfs /kernel/wcd_cpe0 u:object_r:sysfs_audio:s0
 genfscon sysfs /devices/virtual/thermal u:object_r:sysfs_thermal:s0
 genfscon sysfs /devices/virtual/kgsl/kgsl/proc u:object_r:sysfs_kgsl_proc:s0
+genfscon debugfs /kgsl/proc     u:object_r:kgsl_debugfs:s0
diff --git a/common/hal_audio.te b/common/hal_audio.te
index 435819c..ead63c1 100644
--- a/common/hal_audio.te
+++ b/common/hal_audio.te
@@ -60,5 +60,7 @@ hal_client_domain(hal_audio_default, hal_perf)
 #allow acess to wcd_cpe
 allow hal_audio sysfs_audio:file rw_file_perms;
 allow hal_audio sysfs_audio:dir r_dir_perms ;
+#allow access to adsp boot for peripheral manager
+allow hal_audio sysfs_boot:file w_file_perms ;
 #Rules for audioserver to talk to peripheral manager
 use_per_mgr(hal_audio);
diff --git a/common/hal_bluetooth_qti.te b/common/hal_bluetooth_qti.te
index fb45cd4..7106a2d 100644
--- a/common/hal_bluetooth_qti.te
+++ b/common/hal_bluetooth_qti.te
@@ -34,6 +34,8 @@ init_daemon_domain(hal_bluetooth_qti)
 # Logging for backward compatibility
 allow hal_bluetooth_qti bluetooth_data_file:dir ra_dir_perms;
 allow hal_bluetooth_qti bluetooth_data_file:file create_file_perms;
+allow hal_bluetooth_qti bluetooth_logs_data_file:dir rw_dir_perms;
+allow hal_bluetooth_qti bluetooth_logs_data_file:file create_file_perms;
 r_dir_file(hal_bluetooth_qti, firmware_file)
 
 allow hal_bluetooth {
diff --git a/common/hal_camera.te b/common/hal_camera.te
index 8dc7b0a..345f3c9 100644
--- a/common/hal_camera.te
+++ b/common/hal_camera.te
@@ -68,3 +68,9 @@ allow hal_camera vendor_camera_data_file:dir w_dir_perms;
 allow hal_camera vendor_camera_data_file:sock_file write;
 unix_socket_send(hal_camera, camera, mm-qcamerad)
 unix_socket_connect(hal_camera, thermal, thermal-engine)
+
+#Allows camera to call ADSP QDSP6 functionality
+allow hal_camera qdsp_device:chr_file r_file_perms;
+
+#allow camera to access /dsp
+r_dir_file(hal_camera, adsprpcd_file);
diff --git a/common/hal_contexthub.te b/common/hal_contexthub.te
new file mode 100644
index 0000000..946ae78
--- /dev/null
+++ b/common/hal_contexthub.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#    * Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#    * Redistributions in binary form must reproduce the above
+#      copyright notice, this list of conditions and the following
+#      disclaimer in the documentation and/or other materials provided
+#      with the distribution.
+#    * Neither the name of The Linux Foundation nor the names of its
+#      contributors may be used to endorse or promote products derived
+#      from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# Allow context hub HAL to communicate with daemon via socket
+unix_socket_connect(hal_contexthub, chre, chre)
\ No newline at end of file
diff --git a/common/hal_factory_qti.te b/common/hal_factory_qti.te
new file mode 100755
index 0000000..db7449c
--- /dev/null
+++ b/common/hal_factory_qti.te
@@ -0,0 +1,33 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#    * Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#    * Redistributions in binary form must reproduce the above
+#      copyright notice, this list of conditions and the following
+#      disclaimer in the documentation and/or other materials provided
+#      with the distribution.
+#    * Neither the name of The Linux Foundation nor the names of its
+#      contributors may be used to endorse or promote products derived
+#      from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+binder_call(hal_factory_qti_client, hal_factory_qti_server)
+binder_call(hal_factory_qti_server, hal_factory_qti_client)
+
+add_hwservice(hal_factory_qti_server, hal_factory_qti_hwservice)
+
+allow hal_factory_qti_client hal_factory_qti_hwservice:hwservice_manager find;
\ No newline at end of file
diff --git a/common/hal_factory_qti_default.te b/common/hal_factory_qti_default.te
new file mode 100644
index 0000000..8642ff9
--- /dev/null
+++ b/common/hal_factory_qti_default.te
@@ -0,0 +1,40 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#    * Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#    * Redistributions in binary form must reproduce the above
+#      copyright notice, this list of conditions and the following
+#      disclaimer in the documentation and/or other materials provided
+#      with the distribution.
+#    * Neither the name of The Linux Foundation nor the names of its
+#      contributors may be used to endorse or promote products derived
+#      from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+type hal_factory_qti_default, domain;
+hal_server_domain(hal_factory_qti_default, hal_factory_qti)
+
+type hal_factory_qti_default_exec, exec_type, vendor_file_type, file_type;
+init_daemon_domain(hal_factory_qti_default)
+
+#setprop ctrl.start to start service
+unix_socket_connect(hal_factory_qti, property, init);
+set_prop(hal_factory_qti, ctl_default_prop)
+
+# connect with daemon
+unix_socket_connect(hal_factory_qti, mmi, mmi);
+allow hal_factory_qti mmi_socket:sock_file rw_file_perms;
\ No newline at end of file
diff --git a/common/hal_gatekeeper_qti.te b/common/hal_gatekeeper_qti.te
index 68c3919..8306757 100644
--- a/common/hal_gatekeeper_qti.te
+++ b/common/hal_gatekeeper_qti.te
@@ -34,3 +34,12 @@ init_daemon_domain(hal_gatekeeper_qti)
 
 # allow tee to load firmware images
 r_dir_file(hal_gatekeeper, firmware_file)
+
+# allow access to /dev/spcom
+allow hal_gatekeeper_qti spcom_device:chr_file rw_file_perms;
+
+# allow access to skp
+allow hal_gatekeeper_qti skp_device:chr_file rw_file_perms;
+
+allow hal_gatekeeper_qti sp_keymaster_device:chr_file rw_file_perms;
+allow hal_gatekeeper_qti sp_ssr_device:chr_file rw_file_perms;
diff --git a/common/hal_gnss_qti.te b/common/hal_gnss_qti.te
index 946d3fd..6fd2cad 100644
--- a/common/hal_gnss_qti.te
+++ b/common/hal_gnss_qti.te
@@ -33,8 +33,11 @@ init_daemon_domain(hal_gnss_qti)
 hal_server_domain(hal_gnss_qti, hal_gnss)
 
 allow hal_gnss location_data_file:dir { rw_dir_perms };
+allow hal_gnss location_data_file:file create_file_perms;
 allow hal_gnss location_data_file:sock_file { create unlink };
 allow hal_gnss location:unix_dgram_socket sendto;
+allow hal_gnss location_socket:sock_file create_file_perms;
+allow hal_gnss location_socket:dir rw_dir_perms;
 
 unix_socket_connect(hal_gnss, location, location)
 
@@ -58,3 +61,4 @@ userdebug_or_eng(`
   diag_use(hal_gnss);
 ')
 use_per_mgr(hal_gnss)
+qmux_socket(hal_gnss)
diff --git a/common/hal_graphics_composer.te b/common/hal_graphics_composer.te
index 18fa235..5b6379b 100644
--- a/common/hal_graphics_composer.te
+++ b/common/hal_graphics_composer.te
@@ -63,8 +63,8 @@ allow hal_graphics_composer persist_display_file:file create_file_perms;
 # Allow only directory search to '/persist'
 allow hal_graphics_composer persist_file:dir r_dir_perms;
 
-# Allow dir search in '/oem'
-allow hal_graphics_composer oemfs:dir r_dir_perms;
+# Allow access to '/oem'
+r_dir_file(hal_graphics_composer, oemfs)
 
 # Allow pps socket access
 unix_socket_connect(hal_graphics_composer_default, pps, mm-pp-daemon)
@@ -86,4 +86,4 @@ hal_client_domain(hal_graphics_composer_default, hal_perf)
 
 # Access /dev/graphics/fb0.
 allow hal_graphics_composer graphics_device:chr_file rw_file_perms;
-allow hal_graphics_composer graphics_device:dir r_dir_perms;
\ No newline at end of file
+allow hal_graphics_composer graphics_device:dir r_dir_perms;
diff --git a/common/hal_keymaster_qti.te b/common/hal_keymaster_qti.te
index b1b772a..4a1c019 100644
--- a/common/hal_keymaster_qti.te
+++ b/common/hal_keymaster_qti.te
@@ -33,3 +33,12 @@ init_daemon_domain(hal_keymaster_qti)
 
 # allow tee to load firmware images
 r_dir_file(hal_keymaster_qti, firmware_file)
+
+# allow access to /dev/spcom
+allow hal_keymaster_qti spcom_device:chr_file rw_file_perms;
+
+# allow access to skp
+allow hal_keymaster_qti skp_device:chr_file rw_file_perms;
+
+allow hal_keymaster_qti sp_keymaster_device:chr_file rw_file_perms;
+allow hal_keymaster_qti sp_ssr_device:chr_file rw_file_perms;
diff --git a/common/hal_memtrack.te b/common/hal_memtrack.te
index b73ae09..8bdf4d3 100644
--- a/common/hal_memtrack.te
+++ b/common/hal_memtrack.te
@@ -25,8 +25,9 @@
 # # OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 # # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
-#debugfs access to audio
-userdebug_or_eng(`
-allow hal_memtrack_default qti_debugfs:dir r_dir_perms;
-allow hal_memtrack_default qti_debugfs:file rw_file_perms;
-')
+r_dir_file(hal_memtrack_default, kgsl_debugfs);
+
+# Memtrack reads proc/<pid>/cmdline to check if process is surfaceflinger.
+# Grant access if that's the case; don't log denials for other processes.
+allow hal_memtrack_default surfaceflinger:file read;
+dontaudit hal_memtrack_default { domain -surfaceflinger}:file read;
diff --git a/common/hal_rcsservice.te b/common/hal_rcsservice.te
index dcbbe79..921cf4b 100644
--- a/common/hal_rcsservice.te
+++ b/common/hal_rcsservice.te
@@ -58,3 +58,4 @@ userdebug_or_eng(`
 get_prop(hal_rcsservice, persist_dpm_prop)
 
 set_prop(hal_rcsservice, ctl_vendor_imsrcsservice_prop)
+set_prop(hal_rcsservice, qcom_ims_prop)
diff --git a/common/hal_thermal_default.te b/common/hal_thermal_default.te
index 406a160..cfa1463 100755
--- a/common/hal_thermal_default.te
+++ b/common/hal_thermal_default.te
@@ -27,3 +27,6 @@
 
 # access to /proc/stat
 allow hal_thermal  proc_stat:file r_file_perms;
+
+#access to connect thermal-engine socket.
+unix_socket_connect(hal_thermal, thermal, thermal-engine);
diff --git a/common/hal_wifi_supplicant.te b/common/hal_wifi_supplicant.te
index a852ede..3a8bc14 100644
--- a/common/hal_wifi_supplicant.te
+++ b/common/hal_wifi_supplicant.te
@@ -31,3 +31,5 @@
 allow hal_wifi_supplicant_default self:socket create_socket_perms;
 # ioctlcmd=c304, c302
 allowxperm hal_wifi_supplicant self:socket ioctl msm_sock_ipc_ioctls;
+# Allow write to proc_net.
+allow hal_wifi_supplicant_default proc_net:file write;
diff --git a/common/hostapd.te b/common/hostapd.te
index 39033b2..307bb11 100644
--- a/common/hostapd.te
+++ b/common/hostapd.te
@@ -57,3 +57,5 @@ allow hostapd wigighalsvc:unix_dgram_socket sendto;
 # allow hostapd to attach to fstman socket
 allow hostapd wpa_socket:dir r_dir_perms;
 allow hostapd wpa_socket:sock_file rw_file_perms;
+allow hostapd wifi_vendor_wpa_socket:dir r_dir_perms;
+allow hostapd wifi_vendor_wpa_socket:sock_file rw_file_perms;
diff --git a/common/hvdcp.te b/common/hvdcp.te
index a855b52..e176c9d 100644
--- a/common/hvdcp.te
+++ b/common/hvdcp.te
@@ -13,6 +13,7 @@ allow hvdcp {
     sysfs_usbpd_device
     sysfs_vadc_dev
     sysfs_spmi_dev
+    qg_device
 }:dir r_dir_perms;
 
 allow hvdcp {
@@ -21,6 +22,7 @@ allow hvdcp {
     sysfs_usbpd_device
     sysfs_vadc_dev
     sysfs_spmi_dev
+    qg_device
 }:file rw_file_perms;
 
 allow hvdcp {
@@ -28,6 +30,7 @@ allow hvdcp {
     sysfs_usb_supply
     sysfs_vadc_dev
     sysfs_spmi_dev
+    qg_device
 }:lnk_file r_file_perms;
 
 allow hvdcp self:capability { setgid setuid };
diff --git a/common/hwservice.te b/common/hwservice.te
old mode 100644
new mode 100755
index dce0bdd..eb933af
--- a/common/hwservice.te
+++ b/common/hwservice.te
@@ -45,6 +45,7 @@ type hal_esepowermanager_hwservice, hwservice_manager_type;
 type hal_voiceprint_hwservice, hwservice_manager_type;
 type hal_tui_comm_hwservice, hwservice_manager_type;
 type hal_qdutils_disp_hwservice, hwservice_manager_type;
+type hal_factory_qti_hwservice, hwservice_manager_type;
 type hal_sensorscalibrate_qti_hwservice, hwservice_manager_type;
 type hal_wigig_npt_hwservice, hwservice_manager_type;
 type hal_latency_hwservice, hwservice_manager_type;
diff --git a/common/hwservice_contexts b/common/hwservice_contexts
old mode 100644
new mode 100755
index 47cd0b6..ca2bb15
--- a/common/hwservice_contexts
+++ b/common/hwservice_contexts
@@ -71,4 +71,6 @@ vendor.qti.esepowermanager::IEsePowerManager                 u:object_r:hal_esep
 vendor.qti.voiceprint::IQtiVoicePrintService                 u:object_r:hal_voiceprint_hwservice:s0
 vendor.qti.hardware.tui_comm::ITuiComm                       u:object_r:hal_tui_comm_hwservice:s0
 vendor.qti.hardware.qdutils_disp::IQdutilsDisp               u:object_r:hal_qdutils_disp_hwservice:s0
+vendor.qti.hardware.factory::IFactory                        u:object_r:hal_factory_qti_hwservice:s0
 vendor.qti.hardware.sensorscalibrate::ISensorsCalibrate       u:object_r:hal_sensorscalibrate_qti_hwservice:s0
+vendor.qti.hardware.limits::IThermal                         u:object_r:hal_thermal_hwservice:s0
diff --git a/common/ims.te b/common/ims.te
index 7cc3ed5..5260c4b 100644
--- a/common/ims.te
+++ b/common/ims.te
@@ -35,6 +35,7 @@ unix_socket_connect(ims, netd, netd)
 unix_socket_connect(ims, ims, qmuxd)
 
 set_prop(ims, qcom_ims_prop)
+set_prop(ims, ctl_vendor_imsrcsservice_prop)
 
 # permissions needed for IMS to connect and interact with WPA supplicant
 # comment to remove compilation
diff --git a/common/init_shell.te b/common/init_shell.te
index e136fb7..f0499af 100644
--- a/common/init_shell.te
+++ b/common/init_shell.te
@@ -114,6 +114,7 @@ set_prop(qti_init_shell, graphics_vulkan_prop)
 set_prop(qti_init_shell, bservice_prop)
 #Needed for setting DSR properties from post_boot
 set_prop(qti_init_shell, reschedule_service_prop)
+set_prop(qti_init_shell, diag_mdlog_prop)
 
 allow qti_init_shell efs_boot_dev:blk_file r_file_perms;
 
@@ -146,6 +147,7 @@ r_dir_file(qti_init_shell, persist_file)
 r_dir_file(qti_init_shell, sensors_persist_file)
 r_dir_file(qti_init_shell, persist_bluetooth_file)
 allow qti_init_shell sensors_persist_file:file setattr;
+allow qti_init_shell sensors_persist_file:dir setattr;
 
 # To start of selected USF based calculators
 r_dir_file(qti_init_shell, usf_data_file)
@@ -198,8 +200,9 @@ allow qti_init_shell swap_data_file:dir rw_dir_perms;
 allow qti_init_shell swap_data_file:file create_file_perms;
 
 #For configfs permission
-allow qti_init_shell configfs:dir r_dir_perms;
-allow qti_init_shell configfs:file rw_file_perms;
+allow qti_init_shell configfs:dir create_dir_perms;
+allow qti_init_shell configfs:file create_file_perms;
+allow qti_init_shell configfs:lnk_file { create r_file_perms };
 
 #Allow read permissions to read adj
 allow qti_init_shell sysfs_lowmemorykiller:file read;
@@ -230,6 +233,7 @@ allow qti_init_shell vendor_radio_data_file:file create_file_perms;
 
 set_prop(qti_init_shell, vendor_rild_libpath_prop);
 set_prop(qti_init_shell, system_radio_prop)
+set_prop(qti_init_shell, radio_prop)
 
 allow qti_init_shell fm_qsoc_patches_exec:file rx_file_perms;
 
@@ -255,3 +259,12 @@ set_prop(qti_init_shell, mmi_prop);
 allow qti_init_shell proc_meminfo:file r_file_perms;
 
 allow qti_init_shell sysfs_msm_power:file rw_file_perms;
+allow qti_init_shell  sysfs_devices_system_cpu:dir w_file_perms;
+allow qti_init_shell  sysfs_devices_system_cpu:file rw_file_perms;
+
+allow qti_init_shell sysfs_usb_mtp_device:dir r_dir_perms;
+allow qti_init_shell sysfs_usb_mtp_device:file rw_file_perms;
+
+# For IO Cgroups
+allow qti_init_shell cgroup:dir { mounton create_dir_perms };
+allow qti_init_shell cgroup:file { create_file_perms };
diff --git a/common/kernel.te b/common/kernel.te
index e7193eb..1ce1a6d 100755
--- a/common/kernel.te
+++ b/common/kernel.te
@@ -4,6 +4,7 @@ userdebug_or_eng(`
  #allow kernel self:capability { dac_read_search dac_override };
   allow kernel self:socket create_socket_perms_no_ioctl;
   r_dir_file(kernel, qti_debugfs);
+  allow kernel debugfs_mmc:dir search;
 ')
 
 # Access firmware_file
diff --git a/common/location.te b/common/location.te
index c669a36..68bd8da 100644
--- a/common/location.te
+++ b/common/location.te
@@ -19,6 +19,7 @@ allow location location_data_file:{ file fifo_file } create_file_perms;
 allow location location_data_file:sock_file { write unlink };
 allow location location_exec:file x_file_perms;
 allow location location_socket:sock_file create_file_perms;
+allow location location_socket:dir rw_dir_perms;
 allow location self:capability { setuid setgid net_admin net_bind_service };
 allow location self:{
     socket
@@ -92,3 +93,6 @@ allow location self:capability2 wake_alarm;
 
 #access to qdma socket
 qdma_file_socket(location);
+
+#allow qdma prop
+get_prop(location, qdma_prop);
diff --git a/common/location_app.te b/common/location_app.te
index 9472c58..a74b8d1 100644
--- a/common/location_app.te
+++ b/common/location_app.te
@@ -3,6 +3,7 @@ app_domain(location_app)
 binder_use(location_app)
 hal_client_domain(location_app, hal_gnss)
 hal_client_domain(location_app, hal_perf)
+hal_client_domain(location_app, hal_iop)
 
 qmux_socket(location_app)
 
diff --git a/common/mm-qcamerad.te b/common/mm-qcamerad.te
index 000b93d..687e809 100644
--- a/common/mm-qcamerad.te
+++ b/common/mm-qcamerad.te
@@ -69,7 +69,7 @@ binder_call(mm-qcamerad, mmi);
 #Allow camera to access laser nodes
 allow mm-qcamerad input_device:dir r_dir_perms;
 allow mm-qcamerad input_device:chr_file r_file_perms;
-allow mm-qcamerad sysfs:file rw_file_perms;
+allow mm-qcamerad sysfs_laser:file rw_file_perms;
 
 hal_client_domain(mm-qcamerad, hal_graphics_allocator)
 allow mm-qcamerad ion_device:chr_file rw_file_perms;
@@ -78,6 +78,9 @@ allow mm-qcamerad ion_device:chr_file rw_file_perms;
 allow mm-qcamerad fwk_sensor_hwservice:hwservice_manager find;
 binder_call(mm-qcamerad, system_server)
 
+#allow camera to access system file/dir for CAC3 functionality
+allow mm-qcamerad system_file:dir r_dir_perms;
+
 # from sensors team
 
 allow mm-qcamerad self:socket create_socket_perms;
diff --git a/common/mmi.te b/common/mmi.te
old mode 100755
new mode 100644
index 0136e00..9cc2021
--- a/common/mmi.te
+++ b/common/mmi.te
@@ -135,6 +135,13 @@ unix_socket_connect(mmi, cnd, cnd);
 unix_socket_connect(mmi, netmgrd, netmgrd);
 net_domain(mmi);
 
+#mmi to start:mmid/ftmdaemon/mm-audio-ftm application
+allow mmi mmi_exec:file execute_no_trans;
+allow mmi proc:file r_file_perms;
+allow mmi sysfs_battery_supply:dir search;
+allow mmi sysfs_battery_supply:file rw_file_perms;
+allow mmi sysfs_pon_dev:file rw_file_perms;
+
 #read sysfs to operate LEDs
 allow mmi sysfs_leds:dir r_dir_perms;
 allow mmi sysfs_leds:lnk_file r_file_perms;
diff --git a/common/mmi_sys.te b/common/mmi_sys.te
new file mode 100644
index 0000000..ccd5df9
--- /dev/null
+++ b/common/mmi_sys.te
@@ -0,0 +1,38 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+#mmi_sys basic
+allow mmi_sys hal_graphics_allocator_default:fd use;
+r_dir_file(mmi_sys, sysfs_graphics)
+
+#boot mode switch
+set_prop(mmi_sys, boot_mode_prop)
+
+#diag
+userdebug_or_eng(`
+    diag_use(mmi_sys)
+')
diff --git a/common/platform_app.te b/common/platform_app.te
index 4e55759..2e506da 100644
--- a/common/platform_app.te
+++ b/common/platform_app.te
@@ -24,3 +24,6 @@ get_prop(platform_app, debug_gralloc_prop)
 
 #for perf-hal call
 hal_client_domain(platform_app, hal_perf)
+
+#for iop-hal call
+hal_client_domain(platform_app, hal_iop)
diff --git a/common/priv_app.te b/common/priv_app.te
index b551cd7..4f59b4d 100644
--- a/common/priv_app.te
+++ b/common/priv_app.te
@@ -26,3 +26,4 @@
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
 hal_client_domain(priv_app, hal_perf)
+hal_client_domain(priv_app, hal_iop)
diff --git a/common/property.te b/common/property.te
index aac91ad..897b87e 100644
--- a/common/property.te
+++ b/common/property.te
@@ -109,6 +109,9 @@ type bservice_prop, property_type;
 #Delayed Service Reschedule property
 type reschedule_service_prop, property_type;
 
+#mdlog property
+type diag_mdlog_prop, property_type;
+
 #boot mode property
 type boot_mode_prop, property_type;
 #properties for nfc
@@ -126,6 +129,9 @@ type vendor_system_prop, property_type;
 #crash property
 type crash_prop, property_type;
 
+#qdma property
+type qdma_prop, property_type;
+
 type mmi_prop, property_type;
 
 #imsrcsservice
diff --git a/common/property_contexts b/common/property_contexts
index f38a761..9b138cd 100644
--- a/common/property_contexts
+++ b/common/property_contexts
@@ -32,6 +32,7 @@ hw.fm.                     u:object_r:fm_prop:s0
 sys.usf.                   u:object_r:usf_prop:s0
 ro.qc.sdk.us.                 u:object_r:usf_prop:s0
 radio.atfwd.               u:object_r:radio_prop:s0
+persist.radio.atfwd.       u:object_r:radio_prop:s0
 ctl.qmuxd                  u:object_r:ctl_qmuxd_prop:s0
 ctl.netmgrd                u:object_r:ctl_netmgrd_prop:s0
 ctl.port-bridge            u:object_r:ctl_port-bridge_prop:s0
@@ -49,6 +50,8 @@ ctl.sensors                u:object_r:sensors_prop:s0
 ctl.vendor.msm_irqbalance         u:object_r:msm_irqbalance_prop:s0
 ctl.vendor.msm_irqbl_sdm630       u:object_r:msm_irqbl_sdm630_prop:s0
 ctl.vendor.msm_irqbal_lb          u:object_r:msm_irqbalance_prop:s0
+ctl.diag_mdlog_start       u:object_r:diag_mdlog_prop:s0
+ctl.diag_mdlog_stop        u:object_r:diag_mdlog_prop:s0
 camera.                    u:object_r:camera_prop:s0
 persist.camera.            u:object_r:camera_prop:s0
 vendor.spcom.              u:object_r:spcomlib_prop:s0
@@ -117,6 +120,9 @@ vendor.radio               u:object_r:radio_prop:s0
 ro.vendor.ril.             u:object_r:radio_prop:s0
 persist.vendor.sys.        u:object_r:vendor_system_prop:s0
 
+# qdma property
+vendor.qti.qdma.        u:object_r:qdma_prop:s0
+
 #crashdata property
 persist.vendor.crash.cnt         u:object_r:crash_prop:s0
 persist.vendor.crash.detect        u:object_r:crash_prop:s0
diff --git a/common/qdma_app.te b/common/qdma_app.te
index 786ac9d..818dddb 100644
--- a/common/qdma_app.te
+++ b/common/qdma_app.te
@@ -59,3 +59,6 @@ unix_socket_connect(qdma_app, dpmtcm, dpmd)
 # allow qdma_socket
 allow qdma_app qdma_socket:dir w_dir_perms;
 allow qdma_app qdma_socket:sock_file create_file_perms;
+
+# allow qdma_prop
+set_prop(qdma_app, qdma_prop);
diff --git a/common/qdmastatsd.te b/common/qdmastatsd.te
index 6908463..83a5591 100644
--- a/common/qdmastatsd.te
+++ b/common/qdmastatsd.te
@@ -33,6 +33,9 @@ init_daemon_domain(qdmastatsd)
 allow qdmastatsd qdma_data_file:file create_file_perms;
 allow qdmastatsd qdma_data_file:dir create_dir_perms;
 
+# access to /dev/ramdump_microdump_modem
+allow qdmastatsd ramdump_device:chr_file r_file_perms;
+
 # access to /sys/class/power_supply/bms/charge_counter
 # access to /sys/class/power_supply/battery/capacity
 # access to /sys/class/power_supply/battery/status
@@ -92,3 +95,6 @@ userdebug_or_eng(`
 
 # for dmesg
 #read_logd(qdmastatsd);
+
+# allow qdma_prop
+set_prop(qdmastatsd, qdma_prop);
diff --git a/common/qti-logkit.te b/common/qti-logkit.te
index 52c956b..8c78cf8 100644
--- a/common/qti-logkit.te
+++ b/common/qti-logkit.te
@@ -79,3 +79,10 @@ binder_call(qti_logkit, system_server)
 # allow access to recovery directory
 allow qti_logkit cache_recovery_file:dir rw_dir_perms;
 allow qti_logkit cache_recovery_file:file create_file_perms;
+
+# allow qti_logkit for rawdump partition
+allow qti_logkit block_device:dir r_dir_perms;
+allow qti_logkit rawdump_block_device:blk_file rw_file_perms;
+
+# allow qti_logkit for sysfs emmc dload node
+allow qti_logkit sysfs_emmc_dload:file rw_file_perms;
diff --git a/common/qti.te b/common/qti.te
index 148bdde..2666c79 100644
--- a/common/qti.te
+++ b/common/qti.te
@@ -13,14 +13,6 @@ allow qti {
 
 qmux_socket(qti)
 
-allow qti self:capability {
-    net_admin
-    net_raw
-    fsetid
-    sys_module
-    dac_override
-};
-
 allow qti self:{
     netlink_socket
     socket
@@ -31,9 +23,10 @@ allow qti self:socket ioctl;
 allowxperm qti self:socket ioctl msm_sock_ipc_ioctls;
 allow qti { vendor_shell_exec system_file }:file rx_file_perms;
 
+allow qti sysfs_data:file r_file_perms;
+
 #diag
 userdebug_or_eng(`
     diag_use(qti)
     allow qti sysfs:file r_file_perms;
-    allow qti sysfs_data:file r_file_perms;
 ')
diff --git a/common/qti_logkit_app.te b/common/qti_logkit_app.te
index da18fd5..065e006 100644
--- a/common/qti_logkit_app.te
+++ b/common/qti_logkit_app.te
@@ -40,7 +40,7 @@ allow qti_logkit_app surfaceflinger_service:service_manager find;
 net_domain(qti_logkit_app)
 
 userdebug_or_eng(`
-# allow qti_logkit_app debugfs:file r_file_perms;
+  # allow qti_logkit_app debugfs:file r_file_perms;
   allow qti_logkit_app su:unix_dgram_socket sendto;
   allow qti_logkit_app persist_file:dir r_dir_perms;
   allow qti_logkit_app sensors_persist_file:dir r_dir_perms;
@@ -55,6 +55,7 @@ userdebug_or_eng(`
 
   # allow to read ssr ramdump
   allow qti_logkit_app ssr_ramdump_data_file:dir r_dir_perms;
+  allow qti_logkit_app ssr_ramdump_data_file:file r_file_perms;
 ')
 
 # allow access to qti_logkit
diff --git a/common/rfs_access.te b/common/rfs_access.te
index dae60ce..46b224d 100644
--- a/common/rfs_access.te
+++ b/common/rfs_access.te
@@ -45,11 +45,9 @@ allow rfs_access rfs_shared_hlos_file:file create_file_perms;
 allow rfs_access tombstone_data_file:dir create_dir_perms;
 allow rfs_access tombstone_data_file:file create_file_perms;
 
-userdebug_or_eng(`
-    #For ramdump entries in /data/vendor/tombstones.
-    allow rfs_access vendor_tombstone_data_file:dir create_dir_perms;
-    allow rfs_access vendor_tombstone_data_file:file create_file_perms;
-')
+#For ramdump entries in /data/vendor/tombstones.
+allow rfs_access vendor_tombstone_data_file:dir create_dir_perms;
+allow rfs_access vendor_tombstone_data_file:file create_file_perms;
 
 #For firmware entries in /firmware to read NHLOS.bin files ( only perms to read and get attributes).
 r_dir_file(rfs_access, firmware_file)
diff --git a/common/rild.te b/common/rild.te
index f3b7fc3..49af004 100644
--- a/common/rild.te
+++ b/common/rild.te
@@ -27,6 +27,7 @@ r_dir_file(rild, netmgrd)
 netmgr_socket(rild);
 
 #allow rild { mediaserver_service audioserver_service }:service_manager find;
+allow rild toolbox_exec:file rx_file_perms;
 
 # Rule for RILD to talk to peripheral manager
 use_per_mgr(rild);
diff --git a/common/rmt_storage.te b/common/rmt_storage.te
index b56cb64..3196bfc 100644
--- a/common/rmt_storage.te
+++ b/common/rmt_storage.te
@@ -33,12 +33,9 @@ allow rmt_storage uio_device:chr_file rw_file_perms;
 #For access to the kmsg device
 allow rmt_storage kmsg_device:chr_file w_file_perms;
 
-#debugfs access
-userdebug_or_eng(`
-allow rmt_storage qti_debugfs:dir r_dir_perms;
-allow rmt_storage qti_debugfs:file rw_file_perms;
-')
-
 #sysfs_uio
 r_dir_file(rmt_storage, sysfs_uio)
 r_dir_file(rmt_storage, sysfs_uio_file)
+
+#sysfs_ssr
+r_dir_file(rmt_storage, sysfs_ssr)
diff --git a/common/seapp_contexts b/common/seapp_contexts
index 1addb5c..959d3c5 100644
--- a/common/seapp_contexts
+++ b/common/seapp_contexts
@@ -9,10 +9,6 @@ user=system seinfo=platform name=com.qualcomm.qti.auth.fidocryptoservice domain=
 #Add new domain for MDTP services
 user=system seinfo=platform name=com.qualcomm.qti.securemsm.mdtp.MdtpService domain=mdtpservice_app type=mdtp_svc_app_data_file
 
-
-# AtFwd and FastDormancy apps
-user=system seinfo=platform name=com.qualcomm.telephony domain=qtelephony type=system_app_data_file
-
 #Add new domain for QDMA
 user=system seinfo=platform name=com.qualcomm.qti.qdma domain=qdma_app type=qdma_app_data_file
 
diff --git a/common/sec_nvm.te b/common/sec_nvm.te
index be2fce9..dc1b184 100644
--- a/common/sec_nvm.te
+++ b/common/sec_nvm.te
@@ -48,6 +48,8 @@ allow sec_nvm sec_nvm_device:chr_file rw_file_perms;
 allow sec_nvm spss_data_file:file rw_file_perms;
 
 # Allow to rw secnvm files
+allow sec_nvm persist_file:dir search;
+allow sec_nvm persist_secnvm_file:dir rw_dir_perms;
 allow sec_nvm persist_secnvm_file:file create_file_perms;
 
 # Allow access to ion device
diff --git a/common/service.te b/common/service.te
index 8681f0c..14e9153 100644
--- a/common/service.te
+++ b/common/service.te
@@ -13,5 +13,3 @@ type dtseagleservice_service,     service_manager_type;
 type gba_auth_service,            service_manager_type;
 type mdtpdaemon_service,          service_manager_type;
 type qtitetherservice_service,    service_manager_type;
-type wigigp2p_service,            app_api_service, system_server_service, service_manager_type;
-type wigig_service,               app_api_service, system_server_service, service_manager_type;
diff --git a/common/service_contexts b/common/service_contexts
index 2b44523..7cea549 100644
--- a/common/service_contexts
+++ b/common/service_contexts
@@ -35,7 +35,6 @@ improveTouch.TouchService                      u:object_r:improve_touch_service:
 improveTouch.TouchManagerService               u:object_r:improve_touch_service:s0
 improveTouch.GestureManagerService             u:object_r:improve_touch_service:s0
 improveTouch.HandBiometricManagerService       u:object_r:improve_touch_service:s0
-wfdservice                                     u:object_r:wfdservice_service:s0
 DigitalPen                                     u:object_r:usf_service:s0
 dts_eagle_service                              u:object_r:dtseagleservice_service:s0
 com.qualcomm.qti.secota.service.SecotaNService u:object_r:secotad_service:s0
@@ -43,8 +42,6 @@ mdtp                                           u:object_r:mdtpdaemon_service:s0
 qtitetherservice                               u:object_r:qtitetherservice_service:s0
 com.qualcomm.qti.seemp.health                  u:object_r:seemp_health_daemon_service:s0
 com.qualcomm.qti.uceservice                    u:object_r:imsrcs_service:s0
-wigigp2p                                       u:object_r:wigigp2p_service:s0
-wigig                                          u:object_r:wigig_service:s0
 # DOLBY_START
 media.dolby_memoryservice                      u:object_r:audioserver_service:s0
 # DOLBY_END
diff --git a/common/surfaceflinger.te b/common/surfaceflinger.te
index 75d2983..86e4618 100644
--- a/common/surfaceflinger.te
+++ b/common/surfaceflinger.te
@@ -13,6 +13,8 @@ binder_call(surfaceflinger, poweroffhandler);
 binder_call(surfaceflinger, location)
 binder_call(surfaceflinger, tee)
 
+hal_client_domain(surfaceflinger, hal_display_config)
+
 # access to /data/misc/display for dumping input frames
 allow surfaceflinger display_misc_file:dir create_dir_perms;
 allow surfaceflinger display_misc_file:file create_file_perms;
diff --git a/common/system_app.te b/common/system_app.te
index 3f9eacc..0346ee1 100755
--- a/common/system_app.te
+++ b/common/system_app.te
@@ -212,6 +212,7 @@ allow system_app mmi_data_file:file create_file_perms;
 binder_call( system_app, update_engine )
 
 hal_client_domain(system_app, hal_perf)
+hal_client_domain(system_app, hal_iop)
 
 #allow system_app access ioctl
 allowxperm system_app self:socket ioctl msm_sock_ipc_ioctls;
@@ -227,6 +228,9 @@ allow system_app vendor_radio_data_file:file create_file_perms;
 hal_client_domain(system_app, hal_qdutils_disp);
 hal_client_domain(system_app, hal_tui_comm);
 
+#allow system_app access factory
+hal_client_domain(system_app, hal_factory_qti);
+
 allow system_app graphics_device:chr_file r_file_perms;
 allow system_app graphics_device:dir r_dir_perms;
 
diff --git a/common/system_server.te b/common/system_server.te
index 9db06fc..c64455c 100644
--- a/common/system_server.te
+++ b/common/system_server.te
@@ -197,4 +197,7 @@ allow system_server sysfs_wigig:file rw_file_perms;
 # allow system_server to access IOP HAL service
 hal_client_domain(system_server, hal_iop)
 
+#kgsl
+r_dir_file(system_server, kgsl_debugfs);
+
 allow system_server qti_debugfs:file r_file_perms;
diff --git a/common/wfdservice.te b/common/wfdservice.te
index e52c23e..09cf00f 100644
--- a/common/wfdservice.te
+++ b/common/wfdservice.te
@@ -21,3 +21,7 @@ hal_client_domain(wfdservice, wifidisplayhalservice);
 #Denial seen - SELinux : avc:  denied  { find } for interface=com.qualcomm.qti.wifidisplayhal::IHDCPSession
 #pid=3530 scontext=u:r:wfdservice:s0 tcontext=u:object_r:wifidisplayhalservice_hwservice:s0 tclass=hwservice_manager
 allow wfdservice wifidisplayhalservice_hwservice:hwservice_manager find;
+
+# Denial seen - SELinux : avc:  denied  { find } for interface=vendor.display.config::IDisplayConfig
+# pid=4252 scontext=u:r:wfdservice:s0 tcontext=u:object_r:hal_display_config_hwservice:s0 tclass=hwservice_manager
+hal_client_domain(wfdservice, hal_display_config);
diff --git a/common/wigighalsvc.te b/common/wigighalsvc.te
index e1c5781..0a35ca6 100644
--- a/common/wigighalsvc.te
+++ b/common/wigighalsvc.te
@@ -44,8 +44,9 @@ add_hwservice(hal_wigig, hal_wigig_hwservice)
 # allow start/stop services via ctl.start and ctl.stop
 set_prop(hal_wigig, ctl_vendor_wigigsvc_prop)
 
-# read wigig properties
-get_prop(hal_wigig, wigig_prop);
+# access wigig properties
+# need to write vendor.wigig.driver.status
+set_prop(hal_wigig, wigig_prop);
 
 # access wifi vendor data files
 r_dir_file(hal_wigig, wifi_vendor_data_file)
@@ -60,3 +61,9 @@ allow hal_wigig wpa_socket:sock_file create_file_perms;
 # connect to wigig_hostapd by socket
 allow hal_wigig wigig_hostapd_socket:dir rw_dir_perms;
 allow hal_wigig wigig_hostapd_socket:sock_file create_file_perms;
+
+# insmod /vendor/lib/modules/wil6210.ko
+allow hal_wigig self:capability sys_module;
+allow hal_wigig kernel:key search;
+allow hal_wigig vendor_file:system module_load;
+allow hal_wigig proc_modules:file r_file_perms;
diff --git a/msm8909/file_contexts b/msm8909/file_contexts
index 97795b5..bfc630d 100644
--- a/msm8909/file_contexts
+++ b/msm8909/file_contexts
@@ -88,6 +88,7 @@
 /sys/devices/soc/[a-z0-9]+.i2c/i2c-[0-9]/[0-9]-[a-z0-9]+/input/input[0-9]/ap3426-light(/.*)?             u:object_r:sysfs_sensors:s0
 /sys/devices/soc/[a-z0-9]+.i2c/i2c-[0-9]/[0-9]-[a-z0-9]+/input/input[0-9]/ap3426-proximity(/.*)?         u:object_r:sysfs_sensors:s0
 /sys/devices/virtual/input/input[0-9]/akm8963-mag(/.*)?                                                  u:object_r:sysfs_sensors:s0
+/sys/kernel/boot_adsp/boot                                                                               u:object_r:sysfs_boot:s0
 ###############################################
 # Bin seen on target
 #HAL Server
diff --git a/msm8909/hal-server.te b/msm8909/hal-server.te
index 3a22af7..8a77a9b 100644
--- a/msm8909/hal-server.te
+++ b/msm8909/hal-server.te
@@ -33,6 +33,7 @@ typeattribute hal-server  hal_audio_server;
 typeattribute hal-server  hal_sensors_server;
 typeattribute hal-server  hal_broadcastradio_server;
 typeattribute hal-server  hal_drm_server;
+typeattribute hal-server hal_drm;
 typeattribute hal-server  hal_configstore_client;
 
 init_daemon_domain(hal-server)
@@ -101,6 +102,8 @@ hal_client_domain(hal-server, hal_perf)
 #allow acess to wcd_cpe
 allow hal-server sysfs_audio:file rw_file_perms;
 allow hal-server sysfs_audio:dir r_dir_perms;
+#allow access to adsp boot for peripheral manager
+allow hal-server sysfs_boot:file w_file_perms ;
 
 ##########################
 # sensors  services
@@ -127,6 +130,7 @@ allow hal-server system_data_file:lnk_file r_file_perms;
 # Allow access to ion memory allocation device
 allow hal-server ion_device:chr_file rw_file_perms;
 allow hal-server hal_graphics_allocator:fd use;
+allow hal-server hal_allocator:fd use;
 
 # Allow access to fds allocated by mediaserver
 allow hal-server mediaserver:fd use;
@@ -137,6 +141,9 @@ allow hal-server media_data_file:file create_file_perms;
 
 allow hal-server sysfs:file r_file_perms;
 
+allow hal-server serialno_prop:file read;
+allow hal-server untrusted_app_25:fd use;
+
 ##########################
 # Config Store
 #
diff --git a/msm8937/file.te b/msm8937/file.te
deleted file mode 100644
index 10d4146..0000000
--- a/msm8937/file.te
+++ /dev/null
@@ -1,29 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-#sysfs emmc dload type
-type sysfs_emmc_dload, sysfs_type, fs_type;
diff --git a/msm8937/file_contexts b/msm8937/file_contexts
index 781e6ec..580119c 100644
--- a/msm8937/file_contexts
+++ b/msm8937/file_contexts
@@ -52,7 +52,6 @@
 
 #rawdump partition
 /dev/block/platform/soc/7824900.sdhci/by-name/rawdump               u:object_r:rawdump_block_device:s0
-/sys/kernel/dload/emmc_dload                                        u:object_r:sysfs_emmc_dload:s0
 
 ############################################################################################
 #Same hal process libs
@@ -85,3 +84,6 @@
 /dev/block/platform/soc/7824900.sdhci/by-name/tz_[ab]               u:object_r:custom_ab_block_device:s0
 /dev/block/platform/soc/7824900.sdhci/by-name/vendor_[ab]           u:object_r:system_block_device:s0
 /dev/block/platform/soc/7824900.sdhci/by-name/sbl1_[ab]             u:object_r:xbl_block_device:s0
+
+#HAL Server
+/(vendor|system/vendor)/bin/hw/hal-server             u:object_r:hal-server_exec:s0
diff --git a/msm8937/hal-server.te b/msm8937/hal-server.te
new file mode 100644
index 0000000..c897a7e
--- /dev/null
+++ b/msm8937/hal-server.te
@@ -0,0 +1,166 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+type hal-server, domain;
+type hal-server_exec, exec_type, vendor_file_type, file_type;
+
+# need to hw_service
+typeattribute hal-server  hal_audio_server;
+typeattribute hal-server  hal_sensors_server;
+typeattribute hal-server  hal_broadcastradio_server;
+typeattribute hal-server  hal_drm_server;
+typeattribute hal-server  hal_drm;
+
+init_daemon_domain(hal-server)
+
+############################
+# Common section which is generic
+# needed by most of the domains/services
+#
+vndbinder_use(hal-server)
+use_per_mgr(hal-server)
+hwbinder_use(hal-server)
+
+get_prop(hal-server, hwservicemanager_prop)
+
+#DRM/Audio need this
+r_dir_file(hal-server,  firmware_file)
+
+#reading of system_file and execute is already provided via domain.te
+allow hal-server system_file:lnk_file r_file_perms;
+
+# Read access to pseudo filesystems
+allow hal-server cgroup:dir create_dir_perms;
+allow hal-server cgroup:file rw_file_perms;
+r_dir_file(hal-server,  system_file)
+
+##########################
+# Audio  services
+#
+
+# Allow hal-server to read soundcard state under /proc/asound
+r_dir_file(hal-server,  proc_audiod)
+
+# Need this for reading of  /proc/asound/cards
+# hal_audio (/system/sepolicy has this) looks like this
+# is genric node .
+r_dir_file(hal-server, proc)
+
+allow hal-server audio_data_file:dir rw_dir_perms;
+allow hal-server audio_data_file:file create_file_perms;
+
+#r_dir_file(hal_audio, proc)
+allow hal-server audio_device:dir r_dir_perms;
+allow hal-server audio_device:chr_file rw_file_perms;
+
+#Set scheduling info for apps ( picked for system_server public file)
+allow system_server hal-server:process { getsched setsched };
+
+# Allow hal_audio_default to read sysfs_thermal dir/files for speaker protection
+r_dir_file(hal-server, sysfs_thermal)
+
+#Allow hal audio to use Binder IPC
+
+userdebug_or_eng(`
+  diag_use(hal-server)
+  #Allow access to debug fs
+  allow hal-server debugfs:dir r_dir_perms;
+  allow hal-server qti_debugfs:dir r_dir_perms;
+  allow hal-server qti_debugfs:file rw_file_perms;
+')
+
+#Split A2dp specific
+binder_call(hal-server,bluetooth)
+
+#for perf hal call
+hal_client_domain(hal-server, hal_perf)
+#allow acess to wcd_cpe
+allow hal-server sysfs_audio:file rw_file_perms;
+allow hal-server sysfs_audio:dir r_dir_perms;
+
+##########################
+# sensors  services
+#
+allow hal-server hidl_base_hwservice:hwservice_manager add;
+allow hal-server sysfs_sensors:dir r_dir_perms;
+allow hal-server sysfs_sensors:file rw_file_perms;
+allow hal-server sysfs_sensors:lnk_file read;
+allow hal-server input_device:dir r_dir_perms;
+allow hal-server input_device:chr_file r_file_perms;
+allow hal-server persist_file:dir search;
+allow hal-server self:socket create_socket_perms;
+r_dir_file(hal-server, sensors_persist_file)
+wakelock_use(hal-server)
+# ioctlcmd=c304
+allowxperm hal-server self:socket ioctl msm_sock_ipc_ioctls;
+##########################
+# DRM services
+#
+# Required by Widevine DRM (b/22990512)
+allow hal-server self:process execmem;
+
+# Read files already opened under /data
+allow hal-server system_data_file:dir { search getattr };
+allow hal-server system_data_file:file { getattr read };
+allow hal-server system_data_file:lnk_file r_file_perms;
+
+# Allow access to ion memory allocation device
+allow hal-server ion_device:chr_file rw_file_perms;
+allow hal-server hal_graphics_allocator:fd use;
+allow hal-server hal_allocator:fd use;
+
+# Allow access to fds allocated by mediaserver
+allow hal-server mediaserver:fd use;
+
+# Allow access to app_data and media_data_files
+allow hal-server media_data_file:dir create_dir_perms;
+allow hal-server media_data_file:file create_file_perms;
+
+allow hal-server sysfs:file r_file_perms;
+
+allow hal-server serialno_prop:file read;
+allow hal-server untrusted_app_25:fd use;
+
+##########################
+# Config Store
+#
+#TODO: Need to clean this up later
+allow hal_graphics_composer_default sysfs:file r_file_perms;
+
+binder_call(hal_sensors_server, hal-server)
+binder_call(hal_drm_default, hal-server)
+binder_call(hal_audio_server,  hal-server)
+binder_call(hal-server, hal_audio_server)
+
+##############
+# for add_hwservice replacement
+#
+#allow hal-server hal_configstore_ISurfaceFlingerConfigs:hwservice_manager find;
+allow hal-server hal_sensors_hwservice:hwservice_manager find;
+allow hal-server hal_audio_hwservice:hwservice_manager find;
+allow hal-server hal_drm_hwservice:hwservice_manager find;
+allow hal_sensors_default  hidl_base_hwservice:hwservice_manager add;
diff --git a/msm8937/qti-logkit.te b/msm8937/qti-logkit.te
deleted file mode 100644
index 725cf47..0000000
--- a/msm8937/qti-logkit.te
+++ /dev/null
@@ -1,33 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-# allow qti_logkit for rawdump partition
-allow qti_logkit block_device:dir r_dir_perms;
-allow qti_logkit rawdump_block_device:blk_file rw_file_perms;
-
-# allow qti_logkit for sysfs emmc dload node
-allow qti_logkit sysfs_emmc_dload:file rw_file_perms;
diff --git a/msm8952/zygote.te b/msm8952/zygote.te
index e7ef41f..72629c3 100644
--- a/msm8952/zygote.te
+++ b/msm8952/zygote.te
@@ -30,4 +30,6 @@ allow zygote persist_file:dir r_dir_perms;
 allow zygote regionalization_file:dir r_dir_perms;
 allow zygote regionalization_file:file r_file_perms;
 allow zygote oemfs:dir r_dir_perms;
-allow zygote oemfs:file r_file_perms;
\ No newline at end of file
+allow zygote oemfs:file r_file_perms;
+allow zygote media_msm8956_version_prop:file r_file_perms;
+allow zygote media_msm8956hw_prop:file r_file_perms;
diff --git a/msm8953/file.te b/msm8953/file.te
deleted file mode 100644
index 10d4146..0000000
--- a/msm8953/file.te
+++ /dev/null
@@ -1,29 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-#sysfs emmc dload type
-type sysfs_emmc_dload, sysfs_type, fs_type;
diff --git a/msm8953/file_contexts b/msm8953/file_contexts
index 00d100e..1ea6355 100644
--- a/msm8953/file_contexts
+++ b/msm8953/file_contexts
@@ -50,7 +50,16 @@
 
 #rawdump partition
 /dev/block/platform/soc/7824900.sdhci/by-name/rawdump               u:object_r:rawdump_block_device:s0
-/sys/kernel/dload/emmc_dload                                        u:object_r:sysfs_emmc_dload:s0
+
+/sys/module/usb_f_mtp/parameters(/.*)?                              u:object_r:sysfs_usb_mtp_device:s0
+/sys/devices/platform/soc/200f000\.qcom,spmi/spmi-0/spmi0-02/200f000\.qcom,spmi:qcom,pmi8950@2:qcom,qpnp-smbcharger/leds/red/brightness    u:object_r:sysfs_spmi_device:s0
+/sys/devices/platform/soc/200f000\.qcom,spmi/spmi-0/spmi0-03/200f000\.qcom,spmi:qcom,pmi8950@3:qcom,haptic@c000/leds/vibrator/activate     u:object_r:sysfs_spmi_device:s0
+/sys/devices/platform/soc/200f000.qcom,spmi/spmi-0/spmi0-03/200f000.qcom,spmi:qcom,pmi632@3:qcom,vibrator@5700/leds/vibrator/activate      u:object_r:sysfs_spmi_device:s0
+
+/sys/devices/platform/soc/b3000.dcc(/.*)?                           u:object_r:sysfs_dcc_device:s0
+
+#video4linux_
+/sys/devices/platform/soc/1b00000.qcom,msm-cam/video4linux/video0/name u:object_r:sysfs_video4linux_device:s0
 
 ############################################################################################
 #Same hal process libs
diff --git a/msm8953/hal_light_default.te b/msm8953/hal_light_default.te
new file mode 100644
index 0000000..eeffa24
--- /dev/null
+++ b/msm8953/hal_light_default.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+allow hal_light_default sysfs_spmi_device:dir r_dir_perms;
+allow hal_light_default sysfs_spmi_device:file rw_file_perms;
diff --git a/msm8953/hal_usb.te b/msm8953/hal_usb.te
new file mode 100644
index 0000000..b22f848
--- /dev/null
+++ b/msm8953/hal_usb.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+allow hal_usb sysfs_usb_mtp_device:dir r_dir_perms;
+allow hal_usb sysfs_usb_mtp_device:file rw_file_perms;
diff --git a/msm8953/hal_vibrator_default.te b/msm8953/hal_vibrator_default.te
new file mode 100644
index 0000000..99425a0
--- /dev/null
+++ b/msm8953/hal_vibrator_default.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+allow hal_vibrator_default sysfs_spmi_device:dir r_dir_perms;
+allow hal_vibrator_default sysfs_spmi_device:file rw_file_perms;
diff --git a/msm8953/init_shell.te b/msm8953/init_shell.te
index 4e46f08..1e10a27 100644
--- a/msm8953/init_shell.te
+++ b/msm8953/init_shell.te
@@ -33,3 +33,6 @@ set_prop(qti_init_shell, media_msm8953_version_prop)
 # For regionalization
 allow qti_init_shell regionalization_file:dir r_dir_perms;
 allow qti_init_shell regionalization_file:file create_file_perms;
+
+# For dcc
+allow qti_init_shell sysfs_dcc_device:file rw_file_perms;
diff --git a/msm8953/mediacodec.te b/msm8953/mediacodec.te
new file mode 100644
index 0000000..266931b
--- /dev/null
+++ b/msm8953/mediacodec.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# allow mediacodec to access media.msm8953version
+allow mediacodec media_msm8953_version_prop:file r_file_perms;
diff --git a/msm8953/mediaprovider.te b/msm8953/mediaprovider.te
new file mode 100644
index 0000000..1a9c786
--- /dev/null
+++ b/msm8953/mediaprovider.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# allow mediaprovider to access media.msm8953version
+allow mediaprovider media_msm8953_version_prop:file r_file_perms;
diff --git a/msm8953/mm-qcamerad.te b/msm8953/mm-qcamerad.te
new file mode 100644
index 0000000..5ed285a
--- /dev/null
+++ b/msm8953/mm-qcamerad.te
@@ -0,0 +1,30 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+#for v4L node "name" access
+allow mm-qcamerad sysfs_graphics:file r_file_perms;
+allow mm-qcamerad sysfs_video4linux_device:file rw_file_perms;
diff --git a/msm8953/priv_app.te b/msm8953/priv_app.te
index 467fc8f..ddea9af 100644
--- a/msm8953/priv_app.te
+++ b/msm8953/priv_app.te
@@ -29,4 +29,5 @@
 allow priv_app oemfs:lnk_file { read getattr };
 #for regionalization
 allow priv_app regionalization_file:file r_file_perms;
-allow priv_app regionalization_file:dir r_dir_perms;
\ No newline at end of file
+allow priv_app regionalization_file:dir r_dir_perms;
+allow priv_app media_msm8953_version_prop:file r_file_perms;
diff --git a/msm8953/qti-logkit.te b/msm8953/qti-logkit.te
deleted file mode 100644
index 725cf47..0000000
--- a/msm8953/qti-logkit.te
+++ /dev/null
@@ -1,33 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-# allow qti_logkit for rawdump partition
-allow qti_logkit block_device:dir r_dir_perms;
-allow qti_logkit rawdump_block_device:blk_file rw_file_perms;
-
-# allow qti_logkit for sysfs emmc dload node
-allow qti_logkit sysfs_emmc_dload:file rw_file_perms;
diff --git a/msm8953/untrusted_app.te b/msm8953/untrusted_app.te
index 556470e..8c7dd8b 100644
--- a/msm8953/untrusted_app.te
+++ b/msm8953/untrusted_app.te
@@ -30,4 +30,5 @@
 allow untrusted_app oemfs:lnk_file { read getattr };
 #for regionalization
 allow untrusted_app regionalization_file:file r_file_perms;
-allow untrusted_app regionalization_file:dir r_dir_perms;
\ No newline at end of file
+allow untrusted_app regionalization_file:dir r_dir_perms;
+allow untrusted_app media_msm8953_version_prop:file r_file_perms;
diff --git a/msm8976/file.te b/msm8976/file.te
deleted file mode 100644
index 10d4146..0000000
--- a/msm8976/file.te
+++ /dev/null
@@ -1,29 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-#sysfs emmc dload type
-type sysfs_emmc_dload, sysfs_type, fs_type;
diff --git a/msm8976/file_contexts b/msm8976/file_contexts
index 8a9ea58..fdc22bd 100644
--- a/msm8976/file_contexts
+++ b/msm8976/file_contexts
@@ -27,4 +27,3 @@
 
 #rawdump partition
 /dev/block/platform/soc/7824900.sdhci/by-name/rawdump               u:object_r:rawdump_block_device:s0
-/sys/kernel/dload/emmc_dload                                        u:object_r:sysfs_emmc_dload:s0
diff --git a/msm8976/qti-logkit.te b/msm8976/qti-logkit.te
deleted file mode 100644
index 725cf47..0000000
--- a/msm8976/qti-logkit.te
+++ /dev/null
@@ -1,33 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-# allow qti_logkit for rawdump partition
-allow qti_logkit block_device:dir r_dir_perms;
-allow qti_logkit rawdump_block_device:blk_file rw_file_perms;
-
-# allow qti_logkit for sysfs emmc dload node
-allow qti_logkit sysfs_emmc_dload:file rw_file_perms;
diff --git a/msm8996/amfsservice.te b/msm8996/amfsservice.te
new file mode 100644
index 0000000..5e51764
--- /dev/null
+++ b/msm8996/amfsservice.te
@@ -0,0 +1,38 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# amfsservice daemon
+type amfsservice, domain;
+type amfsservice_exec, exec_type, vendor_file_type, file_type;
+
+# Started by init
+init_daemon_domain(amfsservice)
+
+# For reading files under /vendor
+allow amfsservice vendor_file:dir r_dir_perms;
+allow amfsservice vendor_configs_file:dir r_dir_perms;
+allow amfsservice audio_device:chr_file rw_file_perms;
diff --git a/msm8996/file.te b/msm8996/file.te
deleted file mode 100644
index 5000486..0000000
--- a/msm8996/file.te
+++ /dev/null
@@ -1,29 +0,0 @@
-# Copyright (c) 2015, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-#sysfs emmc dload type
-type sysfs_emmc_dload, sysfs_type, fs_type;
diff --git a/msm8996/file_contexts b/msm8996/file_contexts
index fde7244..f7b8f40 100644
--- a/msm8996/file_contexts
+++ b/msm8996/file_contexts
@@ -28,6 +28,10 @@
 ###################################
 # Dev block nodes
 
+# Dev nodes
+/dev/spidev0.0                                                                  u:object_r:audio_device:s0
+/dev/i2c-6                                                                      u:object_r:audio_device:s0
+
 # common
 /dev/block/mmcblk0rpmb                                                          u:object_r:rpmb_device:s0
 /dev/block/mmcblk0                                                              u:object_r:root_block_device:s0
@@ -85,8 +89,9 @@
 ###################################
 # System files
 #
-/(vendor|system/vendor)/bin/seccamd u:object_r:seccamd_exec:s0
-/(vendor|system/vendor)/bin/hw/android\.hardware\.automotive\.vehicle@2\.0-hal-service          u:object_r:hal_automotive_vehicle_qti_exec:s0
+/(vendor|system/vendor)/bin/amfsservice                                         u:object_r:amfsservice_exec:s0
+/(vendor|system/vendor)/bin/seccamd                                             u:object_r:seccamd_exec:s0
+/(vendor|system/vendor)/bin/hw/vendor.qti.hardware.automotive.vehicle@1.0-service          u:object_r:hal_automotive_vehicle_qti_exec:s0
 
 ###################################
 # sysfs files
@@ -97,7 +102,6 @@
 
 #rawdump partition
 /dev/block/platform/soc/7464900.sdhci/by-name/rawdump                           u:object_r:rawdump_block_device:s0
-/sys/kernel/dload/emmc_dload                                                    u:object_r:sysfs_emmc_dload:s0
 
 ############################################################################################
 #Same hal process libs
diff --git a/msm8996/qti-logkit.te b/msm8996/qti-logkit.te
deleted file mode 100644
index 725cf47..0000000
--- a/msm8996/qti-logkit.te
+++ /dev/null
@@ -1,33 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-# allow qti_logkit for rawdump partition
-allow qti_logkit block_device:dir r_dir_perms;
-allow qti_logkit rawdump_block_device:blk_file rw_file_perms;
-
-# allow qti_logkit for sysfs emmc dload node
-allow qti_logkit sysfs_emmc_dload:file rw_file_perms;
diff --git a/msm8998/file.te b/msm8998/file.te
deleted file mode 100644
index 0129ce2..0000000
--- a/msm8998/file.te
+++ /dev/null
@@ -1,30 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-#sysfs emmc dload type
-type sysfs_emmc_dload, sysfs_type, fs_type;
-
diff --git a/msm8998/file_contexts b/msm8998/file_contexts
index d5a6b40..4e7efe1 100644
--- a/msm8998/file_contexts
+++ b/msm8998/file_contexts
@@ -48,7 +48,6 @@
 
 #rawdump partition
 /dev/block/platform/soc/1da4000.ufshc/by-name/rawdump                            u:object_r:rawdump_block_device:s0
-/sys/kernel/dload/emmc_dload                                                     u:object_r:sysfs_emmc_dload:s0
 
 #Same hal process libs
 /(vendor|system/vendor)/lib(64)?/hw/gralloc\.msm8998\.so        u:object_r:same_process_hal_file:s0
diff --git a/msm8998/init_shell.te b/msm8998/init_shell.te
index 70f12d9..ea1e27e 100644
--- a/msm8998/init_shell.te
+++ b/msm8998/init_shell.te
@@ -31,3 +31,7 @@ allow qti_init_shell regionalization_file:file create_file_perms;
 
 # For VR
 set_prop(qti_init_shell, ctl_qvrd_prop)
+
+#For sensors
+allow qti_init_shell sensors_persist_file:dir create_dir_perms;
+allow qti_init_shell sensors_persist_file:file create_file_perms;
diff --git a/msm8998/qti-logkit.te b/msm8998/qti-logkit.te
deleted file mode 100644
index 725cf47..0000000
--- a/msm8998/qti-logkit.te
+++ /dev/null
@@ -1,33 +0,0 @@
-# Copyright (c) 2016, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-# allow qti_logkit for rawdump partition
-allow qti_logkit block_device:dir r_dir_perms;
-allow qti_logkit rawdump_block_device:blk_file rw_file_perms;
-
-# allow qti_logkit for sysfs emmc dload node
-allow qti_logkit sysfs_emmc_dload:file rw_file_perms;
diff --git a/msmpeafowl/wfdservice.te b/msmpeafowl/wfdservice.te
new file mode 100644
index 0000000..bc7dfce
--- /dev/null
+++ b/msmpeafowl/wfdservice.te
@@ -0,0 +1,30 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+
+#Allow access to read property file
+get_prop(wfdservice,media_sdm670_version_prop)
diff --git a/private/file_contexts b/private/file_contexts
index 16ec4cf..85d9c86 100644
--- a/private/file_contexts
+++ b/private/file_contexts
@@ -47,6 +47,7 @@
 /system/bin/smcinvoked                          u:object_r:smcinvoke_daemon_exec:s0
 /system/bin/qvrservice                          u:object_r:qvrd_exec:s0
 /system/bin/wfdservice                          u:object_r:wfdservice_exec:s0
+/system/bin/mmi                                 u:object_r:mmi_sys_exec:s0
 
 ####### data files ################
 /data/misc/seemp(/.*)?                          u:object_r:seemp_data_file:s0
diff --git a/private/mediaprovider.te b/private/mediaprovider.te
new file mode 100644
index 0000000..5f708d2
--- /dev/null
+++ b/private/mediaprovider.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+allow mediaprovider dpmtcm_socket:sock_file w_file_perms;
+allow mediaprovider dpmwrapper_socket:sock_file w_file_perms;
diff --git a/private/mediaserver.te b/private/mediaserver.te
new file mode 100644
index 0000000..1e1f15c
--- /dev/null
+++ b/private/mediaserver.te
@@ -0,0 +1,28 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+unix_socket_send(mediaserver, seempdw, seempd)
diff --git a/private/mmi_sys.te b/private/mmi_sys.te
new file mode 100644
index 0000000..790d112
--- /dev/null
+++ b/private/mmi_sys.te
@@ -0,0 +1,42 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+#init
+init_daemon_domain(mmi_sys)
+
+#Allow mmi to use IPC
+binder_call(mmi_sys,surfaceflinger)
+binder_use(mmi_sys)
+
+#mmi_sys
+allow mmi_sys ion_device:chr_file read;
+allow mmi_sys kmsg_device:chr_file { open write };
+r_dir_file(mmi_sys, sysfs_leds)
+allow mmi_sys ion_device:chr_file { ioctl open };
+allow mmi_sys surfaceflinger_service:service_manager find;
+allow mmi_sys hal_graphics_mapper_hwservice:hwservice_manager find;
+hwbinder_use(mmi_sys)
diff --git a/private/seapp_contexts b/private/seapp_contexts
index 3c7e64d..7a4dcad 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -1,2 +1,5 @@
 #add new domain for DataServices
 user=system seinfo=platform name=.dataservices domain=dataservice_app type=system_app_data_file
+
+# AtFwd and FastDormancy apps
+user=system seinfo=platform name=com.qualcomm.telephony domain=qtelephony type=system_app_data_file
diff --git a/private/service.te b/private/service.te
index a17fd8b..a8ea18a 100644
--- a/private/service.te
+++ b/private/service.te
@@ -33,3 +33,6 @@ type color_service,               service_manager_type;
 type MinkBinderSvc,               app_api_service, service_manager_type;
 type izat_service,                app_api_service, system_api_service, service_manager_type;
 type regionalization_service,     system_api_service, service_manager_type;
+type wfdservice_service,          service_manager_type;
+type wigigp2p_service,            app_api_service, system_server_service, service_manager_type;
+type wigig_service,               app_api_service, system_server_service, service_manager_type;
diff --git a/private/service_contexts b/private/service_contexts
index b9735e0..6a66b28 100644
--- a/private/service_contexts
+++ b/private/service_contexts
@@ -39,3 +39,6 @@ extphone                                       u:object_r:radio_service:s0
 qti.ims.ext                                    u:object_r:radio_service:s0
 com.qti.snapdragon.sdk.display.IColorService   u:object_r:color_service:s0
 regionalization                                u:object_r:regionalization_service:s0
+wfdservice                                     u:object_r:wfdservice_service:s0
+wigigp2p                                       u:object_r:wigigp2p_service:s0
+wigig                                          u:object_r:wigig_service:s0
diff --git a/private/wfdservice.te b/private/wfdservice.te
index 78c1d5d..0616e54 100644
--- a/private/wfdservice.te
+++ b/private/wfdservice.te
@@ -111,6 +111,7 @@ binder_call(wfdservice, mediacodec);
 
 #Allow wfdservice to query interface name of network (p2p etc.)
 allow wfdservice self:netlink_socket create_socket_perms_no_ioctl;
+allow wfdservice self:netlink_generic_socket create_socket_perms_no_ioctl;
 
 #Allow ion device access
 allow wfdservice ion_device:chr_file r_file_perms;
diff --git a/public/mmi_sys.te b/public/mmi_sys.te
new file mode 100644
index 0000000..7770fa2
--- /dev/null
+++ b/public/mmi_sys.te
@@ -0,0 +1,31 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+type mmi_sys, domain, coredomain;
+
+type mmi_sys_exec, exec_type, file_type;
+
diff --git a/public/service.te b/public/service.te
deleted file mode 100644
index 7d929f9..0000000
--- a/public/service.te
+++ /dev/null
@@ -1,28 +0,0 @@
-# Copyright (c) 2017, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-type wfdservice_service,          service_manager_type;
diff --git a/qcs605/file.te b/qcs605/file.te
new file mode 100644
index 0000000..c403cfe
--- /dev/null
+++ b/qcs605/file.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# qmmf data file
+type qmmf_data_file, file_type, data_file_type;
diff --git a/qcs605/file_contexts b/qcs605/file_contexts
index 323cec2..40b3d16 100644
--- a/qcs605/file_contexts
+++ b/qcs605/file_contexts
@@ -1,4 +1,4 @@
-# Copyright (c) 2016-2017, The Linux Foundation. All rights reserved.
+# Copyright (c) 2016-2018, The Linux Foundation. All rights reserved.
 #
 # Redistribution and use in source and binary forms, with or without
 # modification, are permitted provided that the following conditions are
@@ -148,3 +148,9 @@
 # same process HAL libs
 /vendor/lib(64)?/hw/gralloc\.qcs605\.so   u:object_r:same_process_hal_file:s0
 /vendor/lib(64)?/hw/vulkan\.qcs605\.so    u:object_r:same_process_hal_file:s0
+
+# qmmf server
+/(vendor|system/vendor)/bin/qmmf-server   u:object_r:qmmf-servd_exec:s0
+
+# qmmf data files
+/data/misc/qmmf(/.*)?                     u:object_r:qmmf_data_file:s0
diff --git a/qcs605/genfs_contexts b/qcs605/genfs_contexts
new file mode 100644
index 0000000..4c40db3
--- /dev/null
+++ b/qcs605/genfs_contexts
@@ -0,0 +1,28 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+genfscon proc /asound/cards u:object_r:proc_audiod:s0
diff --git a/qcs605/mm-qcamerad.te b/qcs605/mm-qcamerad.te
new file mode 100644
index 0000000..5e48baf
--- /dev/null
+++ b/qcs605/mm-qcamerad.te
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+#Allow fd use for qmmf-server
+allow mm-qcamerad qmmf-servd:fd use;
diff --git a/qcs605/property.te b/qcs605/property.te
new file mode 100644
index 0000000..f7bf0ae
--- /dev/null
+++ b/qcs605/property.te
@@ -0,0 +1,28 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+type qmmf_prop, property_type;
diff --git a/qcs605/property_contexts b/qcs605/property_contexts
new file mode 100644
index 0000000..057446f
--- /dev/null
+++ b/qcs605/property_contexts
@@ -0,0 +1,29 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+qmmf.             u:object_r:qmmf_prop:s0
+persist.qmmf.     u:object_r:qmmf_prop:s0
diff --git a/qcs605/qmmf-servd.te b/qcs605/qmmf-servd.te
new file mode 100644
index 0000000..080d528
--- /dev/null
+++ b/qcs605/qmmf-servd.te
@@ -0,0 +1,78 @@
+# Copyright (c) 2017-2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+type qmmf-servd, domain;
+type qmmf-servd_exec, exec_type, vendor_file_type, file_type;
+init_daemon_domain(qmmf-servd)
+
+vndbinder_use(qmmf-servd);
+
+userdebug_or_eng(`
+  # Allow access to debugfs
+  allow qmmf-servd qti_debugfs:dir r_dir_perms;
+  allow qmmf-servd qti_debugfs:file rw_file_perms;
+')
+
+# Allow access to video devices
+allow qmmf-servd { gpu_device video_device }:chr_file rw_file_perms;
+
+# Allow access to camera socket file
+allow qmmf-servd camera_data_file:dir w_dir_perms;
+allow qmmf-servd camera_data_file:file create_file_perms;
+
+hal_client_domain(qmmf-servd, hal_perf)
+unix_socket_connect(qmmf-servd, property, init)
+
+# Allow qmmf to get properties
+get_prop(qmmf-servd, bluetooth_prop)
+get_prop(qmmf-servd, camera_prop)
+set_prop(qmmf-servd, qmmf_prop)
+
+# Allow qmmf to talk with mm-qcamera daemon
+allow qmmf-servd mm-qcamerad:unix_dgram_socket sendto;
+
+# Allow qmmf to register it's services
+allow qmmf-servd { qmmf_system_service
+                   qmmf_recorder_service
+                   qmmf_audio_service
+                   qmmf_player_service
+                   qmmf_display_service
+                 }:service_manager { add find };
+
+allow qmmf-servd qmmf_data_file:dir rw_dir_perms;
+
+allow qmmf-servd audio_device:dir search;
+allow qmmf-servd audio_device:chr_file rw_file_perms;
+allow qmmf-servd audio_data_file:dir rw_dir_perms;
+allow qmmf-servd audio_data_file:file create_file_perms;
+allow qmmf-servd proc_audiod:file r_file_perms;
+
+allow qmmf-servd ion_device:chr_file r_file_perms;
+
+hal_client_domain(qmmf-servd, hal_graphics_allocator)
+hal_client_domain(qmmf-servd, hal_configstore)
+r_dir_file(qmmf-servd, oemfs)
diff --git a/qcs605/system_server.te b/qcs605/system_server.te
new file mode 100644
index 0000000..65d315e
--- /dev/null
+++ b/qcs605/system_server.te
@@ -0,0 +1,28 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+allow system_server proc_audiod:file r_file_perms;
diff --git a/qcs605/vndservice.te b/qcs605/vndservice.te
new file mode 100644
index 0000000..6cb544c
--- /dev/null
+++ b/qcs605/vndservice.te
@@ -0,0 +1,32 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#    * Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#    * Redistributions in binary form must reproduce the above
+#      copyright notice, this list of conditions and the following
+#      disclaimer in the documentation and/or other materials provided
+#      with the distribution.
+#    * Neither the name of The Linux Foundation nor the names of its
+#      contributors may be used to endorse or promote products derived
+#      from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+type qmmf_audio_service,          vndservice_manager_type;
+type qmmf_recorder_service,       vndservice_manager_type;
+type qmmf_player_service,         vndservice_manager_type;
+type qmmf_display_service,        vndservice_manager_type;
+type qmmf_system_service,         vndservice_manager_type;
diff --git a/qcs605/vndservice_contexts b/qcs605/vndservice_contexts
new file mode 100644
index 0000000..fad8886
--- /dev/null
+++ b/qcs605/vndservice_contexts
@@ -0,0 +1,32 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#    * Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#    * Redistributions in binary form must reproduce the above
+#      copyright notice, this list of conditions and the following
+#      disclaimer in the documentation and/or other materials provided
+#      with the distribution.
+#    * Neither the name of The Linux Foundation nor the names of its
+#      contributors may be used to endorse or promote products derived
+#      from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+qmmf_system.service                            u:object_r:qmmf_system_service:s0
+qmmf_audio.service                             u:object_r:qmmf_audio_service:s0
+qmmf_recorder.service                          u:object_r:qmmf_recorder_service:s0
+qmmf_player.service                            u:object_r:qmmf_player_service:s0
+qmmf_display.service                           u:object_r:qmmf_display_service:s0
diff --git a/sdm660/file.te b/sdm660/file.te
index 7144270..814b29a 100644
--- a/sdm660/file.te
+++ b/sdm660/file.te
@@ -25,5 +25,5 @@
 # OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
-#sysfs emmc dload type
-type sysfs_emmc_dload, sysfs_type, fs_type;
+#sysfs rndis usb type
+type sysfs_rndis_usb, sysfs_type, fs_type;
diff --git a/sdm660/file_contexts b/sdm660/file_contexts
index 8f79d11..dec0949 100644
--- a/sdm660/file_contexts
+++ b/sdm660/file_contexts
@@ -146,8 +146,6 @@
 
 ##################################
 # rawdump partition
-/sys/kernel/dload/emmc_dload                                                    u:object_r:sysfs_emmc_dload:s0
-/sys/kernel/dload/dload_mode                                                    u:object_r:sysfs_emmc_dload:s0
 
 #EMMC
 /dev/block/platform/soc/c0c4000.sdhci/by-name/rawdump                           u:object_r:rawdump_block_device:s0
@@ -156,3 +154,6 @@
 #UFS
 /dev/block/platform/soc/1da4000.ufshc/by-name/rawdump                           u:object_r:rawdump_block_device:s0
 /dev/block/platform/soc/1da4000.ufshc/by-name/ramdump                           u:object_r:rawdump_block_device:s0
+
+#USB
+/sys/module/usb_f_qcrndis/parameters/rndis_dl_max_xfer_size			u:object_r:sysfs_rndis_usb:s0
diff --git a/sdm660/init_shell.te b/sdm660/init_shell.te
index 5f2ea56..9921fc7 100644
--- a/sdm660/init_shell.te
+++ b/sdm660/init_shell.te
@@ -28,3 +28,10 @@
 # For regionalization
 allow qti_init_shell regionalization_file:dir r_dir_perms;
 allow qti_init_shell regionalization_file:file create_file_perms;
+
+#For sensors
+allow qti_init_shell sensors_persist_file:dir create_dir_perms;
+allow qti_init_shell sensors_persist_file:file create_file_perms;
+
+#For USB
+allow qti_init_shell sysfs_rndis_usb:file rw_file_perms;
diff --git a/sdm660/qti-logkit.te b/sdm660/qti-logkit.te
deleted file mode 100644
index af328f5..0000000
--- a/sdm660/qti-logkit.te
+++ /dev/null
@@ -1,33 +0,0 @@
-# Copyright (c) 2017, The Linux Foundation. All rights reserved.
-#
-# Redistribution and use in source and binary forms, with or without
-# modification, are permitted provided that the following conditions are
-# met:
-#     * Redistributions of source code must retain the above copyright
-#       notice, this list of conditions and the following disclaimer.
-#     * Redistributions in binary form must reproduce the above
-#       copyright notice, this list of conditions and the following
-#       disclaimer in the documentation and/or other materials provided
-#       with the distribution.
-#     * Neither the name of The Linux Foundation nor the names of its
-#       contributors may be used to endorse or promote products derived
-#       from this software without specific prior written permission.
-#
-# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
-# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
-# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
-# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
-# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
-# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
-# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
-# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
-# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
-# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-
-# allow qti_logkit for rawdump partition
-allow qti_logkit block_device:dir r_dir_perms;
-allow qti_logkit rawdump_block_device:blk_file rw_file_perms;
-
-# allow qti_logkit for sysfs emmc dload node
-allow qti_logkit sysfs_emmc_dload:file rw_file_perms;
diff --git a/sdm670/idmap.te b/sdm670/idmap.te
new file mode 100644
index 0000000..a90e2da
--- /dev/null
+++ b/sdm670/idmap.te
@@ -0,0 +1,31 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+#for oemfs
+r_dir_file(idmap, oemfs);
+#for regionalization
+r_dir_file(idmap, regionalization_file);
diff --git a/sdm670/init_shell.te b/sdm670/init_shell.te
index 42d6007..10612c8 100644
--- a/sdm670/init_shell.te
+++ b/sdm670/init_shell.te
@@ -27,3 +27,7 @@
 
 # media_sdm670_version_prop - to choose target version specific media_codecs.xml
 set_prop(qti_init_shell, media_sdm670_version_prop)
+
+# For regionalization
+allow qti_init_shell regionalization_file:dir r_dir_perms;
+allow qti_init_shell regionalization_file:file create_file_perms;
diff --git a/sdm670/mediacodec.te b/sdm670/mediacodec.te
new file mode 100644
index 0000000..7d5510e
--- /dev/null
+++ b/sdm670/mediacodec.te
@@ -0,0 +1,28 @@
+# Copyright (c) 2018, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+allow mediacodec media_sdm670_version_prop:file r_file_perms;
diff --git a/sdm670/platform_app.te b/sdm670/platform_app.te
new file mode 100644
index 0000000..fa604fa
--- /dev/null
+++ b/sdm670/platform_app.te
@@ -0,0 +1,31 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+#for oemfs
+allow platform_app oemfs:lnk_file { read getattr };
+#for regionalization
+r_dir_file(platform_app, regionalization_file);
diff --git a/sdm670/priv_app.te b/sdm670/priv_app.te
new file mode 100644
index 0000000..3488e36
--- /dev/null
+++ b/sdm670/priv_app.te
@@ -0,0 +1,31 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+#for oemfs
+allow priv_app oemfs:lnk_file { read getattr };
+#for regionalization
+r_dir_file(priv_app, regionalization_file);
diff --git a/sdm670/system_app.te b/sdm670/system_app.te
new file mode 100644
index 0000000..46356cb
--- /dev/null
+++ b/sdm670/system_app.te
@@ -0,0 +1,33 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+#for oemfs
+allow system_app oemfs:lnk_file { read getattr };
+#for regionalization
+r_dir_file(system_app, regionalization_file);
+allow system_app vendor_radio_data_file:dir rw_dir_perms;
+allow system_app vendor_radio_data_file:file create_file_perms;
diff --git a/sdm670/system_server.te b/sdm670/system_server.te
new file mode 100644
index 0000000..22b433b
--- /dev/null
+++ b/sdm670/system_server.te
@@ -0,0 +1,32 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# For Regionalization service
+allow system_server regionalization_file:file rw_file_perms;
+allow system_server regionalization_file:dir r_dir_perms;
+allow system_server resourcecache_data_file:dir create_dir_perms;
+allow system_server resourcecache_data_file:file create_file_perms;
diff --git a/sdm670/untrusted_app.te b/sdm670/untrusted_app.te
new file mode 100644
index 0000000..9565f1b
--- /dev/null
+++ b/sdm670/untrusted_app.te
@@ -0,0 +1,32 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+
+# for oemfs
+allow untrusted_app oemfs:lnk_file { read getattr };
+#for regionalization
+r_dir_file(untrusted_app, regionalization_file);
diff --git a/sdm670/wfdservice.te b/sdm670/wfdservice.te
new file mode 100644
index 0000000..bc7dfce
--- /dev/null
+++ b/sdm670/wfdservice.te
@@ -0,0 +1,30 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+
+#Allow access to read property file
+get_prop(wfdservice,media_sdm670_version_prop)
diff --git a/sdm670/zygote.te b/sdm670/zygote.te
new file mode 100644
index 0000000..d1a3bed
--- /dev/null
+++ b/sdm670/zygote.te
@@ -0,0 +1,31 @@
+# Copyright (c) 2017, The Linux Foundation. All rights reserved.
+#
+# Redistribution and use in source and binary forms, with or without
+# modification, are permitted provided that the following conditions are
+# met:
+#     * Redistributions of source code must retain the above copyright
+#       notice, this list of conditions and the following disclaimer.
+#     * Redistributions in binary form must reproduce the above
+#       copyright notice, this list of conditions and the following
+#       disclaimer in the documentation and/or other materials provided
+#       with the distribution.
+#     * Neither the name of The Linux Foundation nor the names of its
+#       contributors may be used to endorse or promote products derived
+#       from this software without specific prior written permission.
+#
+# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
+# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
+# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
+# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+
+# For regionalization
+allow zygote persist_file:dir r_dir_perms;
+r_dir_file(zygote, regionalization_file);
+r_dir_file(zygote, oemfs);
diff --git a/sdm845/file_contexts b/sdm845/file_contexts
index b2680c8..020f4da 100644
--- a/sdm845/file_contexts
+++ b/sdm845/file_contexts
@@ -93,6 +93,7 @@
 # Same process file
 /(vendor|system/vendor)/lib(64)?/hw/gralloc\.sdm845\.so   u:object_r:same_process_hal_file:s0
 /(vendor|system/vendor)/lib(64)?/hw/vulkan\.sdm845\.so    u:object_r:same_process_hal_file:s0
+/(vendor|system/vendor)/bin/sscrpcd       u:object_r:sensors_exec:s0
 
 # sdm845 specific sysfs file
 /sys/devices/platform/soc/17d41000.qcom,cpucc/17d41000.qcom,cpucc:qcom,wil6210/subsys8/name    u:object_r:sysfs_ssr:s0
diff --git a/ssg/ssg_app.te b/ssg/ssg_app.te
index 20cbc56..dd18955 100644
--- a/ssg/ssg_app.te
+++ b/ssg/ssg_app.te
@@ -38,6 +38,7 @@ net_domain(ssg_app)
 unix_socket_connect(ssg_app, mlid, mlid)
 unix_socket_connect(ssg_app, ssgqmig, ssgqmigd)
 unix_socket_connect(ssg_app, ssgtzd, ssgtzd)
+unix_socket_connect(ssg_app, dpmtcm, dpmd)
 
 allow ssg_app radio_service:service_manager find;
 allow ssg_app surfaceflinger_service:service_manager find;
-- 
2.7.4

